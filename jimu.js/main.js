// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"jimu/ConfigManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dojo/Deferred dojo/on ./utils ./WidgetManager ./shared/AppVersionManager ./ConfigLoader ./tokenUtils ./portalUrlUtils ./portalUtils esri/config".split(" "),function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x){function p(r,u){var y=a.clone(r),z=g.widgetProperties;"undefined"===typeof u&&(u=!1);delete y.mode;g.visitElement(y,function(A,C){A.widgets?(delete A.isOnScreen,delete A.gid,
"jimu.js/images/group_icon.png"===A.icon&&delete A.icon,delete A.openType,C.isOnScreen&&A.panel&&g.isEqual(A.panel,y.widgetOnScreen.panel)&&delete A.panel):(A.icon&&A.icon===A.folderUrl+"images/icon.png?wab_dv\x3d"+window.deployVersion&&delete A.icon,delete A.panel,delete A.folderUrl,delete A.amdFolder,delete A.thumbnail,delete A.configFile,delete A.gid,delete A.isOnScreen,z.forEach(function(E){delete A[E]}),u?("undefined"===typeof A.openAtStart&&(A.openAtStart=!1),A.config||delete A.config):(A.visible&&
delete A.visible,A.manifest&&A.label===A.manifest.label&&delete A.label,A.isDefaultConfig&&(delete A.config,delete A.isDefaultConfig)),delete A.manifest)});delete y.rawAppConfig;delete y._ssl;delete y.getConfigElementById;delete y.getConfigElementsByName;delete y.getConfigElementByLabel;delete y.processNoUriWidgets;delete y.addElementId;delete y.getCleanConfig;delete y.visitElement;delete y.agolConfig;delete y._itemData;delete y.oldWabVersion;return y}var h=null;var t=b(null,{urlParams:null,appConfig:null,
configFile:null,_configLoaded:!1,portalSelf:null,constructor:function(r){this.urlParams=r||{};this.listenBuilderEvents();this.versionManager=new e;this.widgetManager=q.getInstance();this.configLoader=m.getInstance(this.urlParams,{versionManager:this.versionManager});"config"===this.urlParams.mode&&window.parent.setConfigViewerTopic&&a.isFunction(window.parent.setConfigViewerTopic)&&window.parent.setConfigViewerTopic(f);"preview"===this.urlParams.mode&&window.parent.setPreviewViewerTopic&&a.isFunction(window.parent.setPreviewViewerTopic)&&
window.parent.setPreviewViewerTopic(f);k(window,"resize",a.hitch(this,this._onWindowResize))},listenBuilderEvents:function(){f.subscribe("builder/widgetChanged",a.hitch(this,this._onWidgetChanged));f.subscribe("builder/groupChanged",a.hitch(this,this._onGroupChanged));f.subscribe("builder/widgetPoolChanged",a.hitch(this,this._onWidgetPoolChanged));f.subscribe("builder/openAtStartChange",a.hitch(this,this._onOpenAtStartChanged));f.subscribe("builder/onScreenOrderChanged",a.hitch(this,this._onScreenOrderChanged));
f.subscribe("builder/layoutDefinitionChanged",a.hitch(this,this._onLayoutDefinitionChanged));f.subscribe("builder/sceneViewChanged",a.hitch(this,this._onSceneViewChanged));f.subscribe("builder/mapOptionsChanged",a.hitch(this,this._onMapOptionsChanged));f.subscribe("builder/appAttributeChanged",a.hitch(this,this._onAppAttributeChanged));f.subscribe("builder/setAppConfig",a.hitch(this,this._onAppConfigSet));f.subscribe("builder/themeChanged",a.hitch(this,this._onThemeChanged));f.subscribe("builder/layoutChanged",
a.hitch(this,this._onLayoutChanged));f.subscribe("builder/styleChanged",a.hitch(this,this._onStyleChanged));f.subscribe("builder/syncExtent",a.hitch(this,this._onSyncExtent));f.subscribe("builder/loadingPageChanged",a.hitch(this,this._onLoadingPageChanged));f.subscribe("builder/templateConfigChanged",a.hitch(this,this._onTemplateConfigChanged));f.subscribe("builder/sharedThemeChanged",a.hitch(this,this._onSharedThemeChanged))},loadConfig:function(){if("preview"!==this.urlParams.mode&&"config"!==this.urlParams.mode)return this.configLoader.loadConfig().then(a.hitch(this,
function(r){this.portalSelf=this.configLoader.portalSelf;this.appConfig=this._addDefaultValues(r);window.appInfo.isRunInMobile=this._isRunInMobile();console.timeEnd("Load Config");r=this.getAppConfig();f.publish("appConfigLoaded",r);return r}),a.hitch(this,function(r){console.error(r);r&&r.message&&"string"===typeof r.message&&this._showErrorMessage(r)}))},_showErrorMessage:function(r){if(!1===r.isSelfOrigin){d.create("div",{"class":"app-error",innerHTML:g.sanitizeHTML(r.message||r)},document.body);
r=d.create("div",{"class":"app-error",innerHTML:g.sanitizeHTML(window.jimuNls.common.close)},document.body);d.setStyle(r,{"margin-top":"80px","padding-top":0,background:"none",cursor:"pointer"});k(r,"click",a.hitch(this,function(){window.close()}));d.setStyle(r,"display","none");r=d.create("div",{"class":"app-error"},document.body);d.setStyle(r,{"margin-top":"90px","padding-top":0,background:"none"});r=d.create("div",{"class":"app-error-advanced-button",innerHTML:g.sanitizeHTML(window.jimuNls.advancedOptions)},
r);d.setStyle(r,{margin:"0 auto 0 auto",padding:"8px 12px 8px 12px",color:"#666",background:"none",border:"1px solid #ccc",display:"inline-block","border-radius":"4px",cursor:"pointer"});k(r,"click",a.hitch(this,function(){d.setStyle(y,"display","block")}));r=window.location.href;var u=w.getStandardPortalUrl(window.location.origin);u=w.getArcgisOnlineUrl(u);r=r.replace(window.location.origin,u);r=window.jimuNls.proceedTo.replace("${value}","\x3ca href\x3d"+r+"\x3e"+r+"\x3c/a\x3e");var y=d.create("div",
{"class":"app-error",innerHTML:g.sanitizeHTML(r)},document.body);d.setStyle(y,{"margin-top":"140px",display:"none","padding-top":0,background:"none"});d.setStyle(jimuConfig.loadingId,"display","none")}else d.create("div",{"class":"app-error",innerHTML:g.sanitizeHTML("Unable to create map: "+(r.message||r))},document.body)},getAppConfig:function(){if(window.appInfo.isRunInMobile){var r=a.clone(this._getMobileConfig(this.appConfig));r._originConfig=a.clone(this.appConfig)}else r=a.clone(this.appConfig);
r.getConfigElementById=function(u){return g.getConfigElementById(this,u)};r.getConfigElementByLabel=function(u){return g.getConfigElementByLabel(this,u)};r.getConfigElementsByName=function(u){return g.getConfigElementsByName(this,u)};r.getCleanConfig=function(u){return this._originConfig?p(this._originConfig,u):p(this,u)};r.visitElement=function(u){g.visitElement(this,u)};return r},_onWindowResize:function(){var r=this._isRunInMobile();window.appInfo.isRunInMobile!==r&&(window.appInfo.isRunInMobile=
r,this.appConfig&&f.publish("appConfigChanged",this.getAppConfig(),"layoutChange"))},_isRunInMobile:function(){var r=d.getMarginBox(window.jimuConfig.layoutId);if(r.w<=window.jimuConfig.breakPoints[0]||r.h<=window.jimuConfig.breakPoints[0])return d.addClass(window.jimuConfig.layoutId,"jimu-ismobile"),!0;d.removeClass(window.jimuConfig.layoutId,"jimu-ismobile");return!1},_getMobileConfig:function(r){return g.mixinAppConfigPosition(r,r.mobileLayout)},_onWidgetChanged:function(r){var u=g.reCreateObject(r);
r=g.getConfigElementById(this.appConfig,r.id);!1!==u.inPanel||r.uri||(u.closeable=!0);for(var y in u)r[y]=u[y];delete r.isDefaultConfig;this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);f.publish("appConfigChanged",this.getAppConfig(),"widgetChange",u)},_onGroupChanged:function(r){var u=g.reCreateObject(r);r=g.getConfigElementById(this.appConfig,r.id);for(var y in u)r[y]=u[y];this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);
f.publish("appConfigChanged",this.getAppConfig(),"groupChange",u)},_onWidgetPoolChanged:function(r){r=g.reCreateObject(r);if(1===this.widgetManager.getControllerWidgets().length)this.appConfig.widgetPool.widgets=r.widgets,this.appConfig.widgetPool.groups=r.groups;else{var u=g.getConfigElementById(this.appConfig,r.controllerId);c.forEach(u.controlledWidgets,function(y){this._removeWidgetOrGroupFromPoolById(this.appConfig,y)},this);c.forEach(u.controlledGroups,function(y){this._removeWidgetOrGroupFromPoolById(this.appConfig,
y)},this);this.appConfig.widgetPool.widgets="undefined"===typeof this.appConfig.widgetPool.widgets?r.widgets:this.appConfig.widgetPool.widgets.concat(r.widgets);this.appConfig.widgetPool.groups="undefined"===typeof this.appConfig.widgetPool.groups?r.groups:this.appConfig.widgetPool.groups.concat(r.groups);this.configLoader.addNeedValues(this.appConfig);u.controlledWidgets=c.map(r.widgets,function(y){return y.id});u.controlledGroups=c.map(r.groups,function(y){return y.id})}this.configLoader.addNeedValues(this.appConfig);
this._addDefaultValues(this.appConfig);f.publish("appConfigChanged",this.getAppConfig(),"widgetPoolChange",r)},_removeWidgetOrGroupFromPoolById:function(r,u){c.some(r.widgetPool.widgets,function(y,z){if(y.id===u)return r.widgetPool.widgets.splice(z,1),!0});c.some(r.widgetPool.groups,function(y,z){if(y.id===u)return r.widgetPool.groups.splice(z,1),!0})},_onOpenAtStartChanged:function(r){var u=g.reCreateObject(r),y=this.appConfig;r.isOnScreen?(y=y.widgetOnScreen&&y.widgetOnScreen.widgets)&&0<y.length&&
c.forEach(y,a.hitch(this,function(z){z.id===r.id?z.openAtStart=!z.openAtStart:delete z.openAtStart})):((y=y.widgetPool)&&y.groups&&0<y.groups.length&&c.forEach(y.groups,a.hitch(this,function(z){z.id===r.id?z.openAtStart=!z.openAtStart:delete z.openAtStart})),y&&y.widgets&&0<y.widgets.length&&c.forEach(y.widgets,a.hitch(this,function(z){z.id===r.id?z.openAtStart=!z.openAtStart:delete z.openAtStart})));f.publish("appConfigChanged",this.getAppConfig(),"openAtStartChange",u)},_onScreenOrderChanged:function(r){var u=
g.reCreateObject(r);c.forEach(this.appConfig.widgetOnScreen.widgets,function(y){y.isController||(!1!==y.inPanel||!0!==y.closeable)&&!0!==y.inPanel&&y.uri||c.some(u,function(z){if(y.id===z.id)return y.position=z.position,!0})},this);f.publish("appConfigChanged",this.getAppConfig(),"onScreenOrderChange",u)},_onAppAttributeChanged:function(r){r=g.reCreateObject(r);a.mixin(this.appConfig,r);this.configLoader.processProxy(this.appConfig);this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);
f.publish("appConfigChanged",this.getAppConfig(),"attributeChange",r)},_onLoadingPageChanged:function(r){r=g.reCreateObject(r);if("backgroundColor"in r)this.appConfig.loadingPage.backgroundColor=r.backgroundColor;else if("backgroundImage"in r){var u=this.appConfig.loadingPage.backgroundImage||{};this.appConfig.loadingPage.backgroundImage=a.mixin(u,r.backgroundImage)}else"loadingGif"in r&&(u=this.appConfig.loadingPage.loadingGif||{},this.appConfig.loadingPage.loadingGif=a.mixin(u,r.loadingGif));this.configLoader.addNeedValues(this.appConfig);
this._addDefaultValues(this.appConfig);f.publish("appConfigChanged",this.getAppConfig(),"loadingPageChange",r)},_onTemplateConfigChanged:function(r){r=g.reCreateObject(r);this.appConfig.templateConfig=r;this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);f.publish("appConfigChanged",this.getAppConfig(),"templateConfigChange",r)},_onLayoutDefinitionChanged:function(r){r=g.reCreateObject(r);g.isEqual(this.appConfig.layoutDefinition,r.layoutDefinition)||(this.appConfig.layoutDefinition=
r.layoutDefinition,this.appConfig.widgetOnScreen.groups=g.handleGridLayoutOnScreenGroupChange(this.appConfig.widgetOnScreen.groups,r.groupIds),this.configLoader.addNeedValues(this.appConfig),this._addDefaultValues(this.appConfig),f.publish("appConfigChanged",this.getAppConfig(),"layoutDefinitionChange",r.layoutDefinition))},_onSceneViewChanged:function(r){r=g.reCreateObject(r);r.itemId&&r.itemId!==this.appConfig.map.itemId&&this.appConfig.map.mapOptions&&g.deleteMapOptions(this.appConfig.map.mapOptions);
a.mixin(this.appConfig.map,r);this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);f.publish("appConfigChanged",this.getAppConfig(),"mapChange",r)},_onMapOptionsChanged:function(r){r=g.reCreateObject(r);this.appConfig.map.mapOptions||(this.appConfig.map.mapOptions={});a.mixin(this.appConfig.map.mapOptions,r);f.publish("appConfigChanged",this.getAppConfig(),"mapOptionsChange",r)},_onThemeChanged:function(r){this._getAppConfigFromTheme(r).then(a.hitch(this,function(u){this.appConfig=
u;f.publish("appConfigChanged",this.getAppConfig(),"themeChange",r.getName())}))},_onLayoutChanged:function(r){this.appConfig=g.mixinAppConfigPosition(this.appConfig,r.layoutConfig);this.appConfig.layoutDefinition=r.layoutConfig.layoutDefinition;this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);this._addDefaultPanelAndPosition(this.appConfig);f.publish("appConfigChanged",this.getAppConfig(),"layoutChange",r.name)},_onStyleChanged:function(r){this.appConfig.theme.styles=
this._genStyles(this.appConfig.theme.styles,r.name);r.isCustom?this.appConfig.theme.customStyles={mainBackgroundColor:r.styleColor}:(delete this.appConfig.theme.customStyles,delete this.appConfig.titleColor,this.appConfig.theme.sharedTheme={isPortalSupport:this.appConfig.theme.sharedTheme.isPortalSupport,useHeader:!1,useLogo:!1});f.publish("appConfigChanged",this.getAppConfig(),"styleChange",r.name)},_onSharedThemeChanged:function(r){var u=this.appConfig.theme.sharedTheme;r=g.reCreateObject(r);r.useHeader&&
!u.useHeader&&(this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?(this.appConfig.theme.customStyles={mainBackgroundColor:this.portalSelf.portalProperties.sharedTheme.header.background},this.appConfig.titleColor=this.portalSelf.portalProperties.sharedTheme.header.text,this._onAppAttributeChanged({titleColor:this.appConfig.titleColor})):console.error("Portal does not support sharedTheme."));!r.useHeader&&u.useHeader&&(delete this.appConfig.titleColor,this._onAppAttributeChanged({titleColor:this.appConfig.titleColor}));
r.useLogo&&!u.useLogo&&(this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?(this.appConfig.logo=this.portalSelf.portalProperties.sharedTheme.logo&&this.portalSelf.portalProperties.sharedTheme.logo.small?this.portalSelf.portalProperties.sharedTheme.logo.small:"images/app-logo.png",this.appConfig.logoLink=this.portalSelf.portalProperties.sharedTheme.logo.link,this._onAppAttributeChanged({logo:this.appConfig.logo,logoLink:this.appConfig.logoLink})):console.error("Portal does not support sharedTheme."));
!r.useLogo&&u.useLogo&&this._onAppAttributeChanged({logo:this.appConfig.logo});a.mixin(u,r);f.publish("appConfigChanged",this.getAppConfig(),"sharedThemeChange",r)},_onSyncExtent:function(r){f.publish("syncExtent",r)},_genStyles:function(r,u){var y=[];y.push(u);c.forEach(r,function(z){0>y.indexOf(z)&&y.push(z)});return y},_getAppConfigFromTheme:function(r){var u=new n,y=[],z=this.getAppConfig().getCleanConfig();z.mode=this.urlParams.mode;c.forEach(z.widgetPool.groups,function(E){delete E.panel},this);
if(r.appConfig){var A=a.clone(r.appConfig);A.map=z.map;A.map.position=r.appConfig.map.position;this._copyPoolToThemePool(z,A);A.links=z.links;A.title=z.title;A.subtitle=z.subtitle;A.logo=z.logo}else{var C=r.getCurrentLayout();y=r.getCurrentStyle();A=a.clone(z);C=a.clone(C.layoutConfig);A.widgetOnScreen=C.widgetOnScreen;C.widgetPool&&(c.forEach(C.widgetPool.widgets,function(E){E.isPreconfiguredInTheme=!0}),c.forEach(C.widgetPool.groups,function(E){E.isPreconfiguredInTheme=!0}));this._copyPoolToThemePool(z,
C);A.widgetPool=C.widgetPool;C.map&&C.map.position&&(A.map.position=C.map.position);A.mobileLayout=C.mobileLayout;A.layoutDefinition=C.layoutDefinition;y=this._genStyles(c.map(r.getStyles(),function(E){return E.name}),y.name);A.theme={name:r.getName(),styles:y,version:r.getVersion()};this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?(A.theme.sharedTheme={useHeader:!0,useLogo:!0,isPortalSupport:!0},A.theme.customStyles={mainBackgroundColor:this.portalSelf.portalProperties.sharedTheme.header.background}):
(A.theme.sharedTheme={useHeader:!1,useLogo:!1,isPortalSupport:!1},A.theme.customStyles={mainBackgroundColor:""});A.titleColor=z.titleColor;A.logoLink=z.logoLink}this.configLoader.addNeedValues(A);this.configLoader.loadWidgetsManifest(A).then(a.hitch(this,function(){this._addDefaultValues(A);u.resolve(A)}));return u},_copyPoolToThemePool:function(r,u){var y=r.widgetPool;u.widgetPool||(u.widgetPool={});r=u.widgetPool;var z=c.filter(r.widgets,function(B){if(B.isPreconfiguredInTheme||!c.some(y.widgets,
function(D){return D.name===B.name}))return!0}),A=c.filter(r.groups,function(B){return B.isPreconfiguredInTheme}),C=c.filter(y.widgets,function(B){return!B.isPreconfiguredInTheme}),E=c.filter(y.groups,function(B){return!B.isPreconfiguredInTheme});C=this._getPoolWidgetsWithoutDuplicated(C,u.widgetOnScreen.widgets||[]);r.widgets=C.concat(z);r.groups=E.concat(A)},_getPoolWidgetsWithoutDuplicated:function(r,u){for(var y=a.clone(r),z=this.getAppConfig(),A=r.length-1;0<=A;A--)for(var C=u.length-1;0<=C;C--)if(u[C].uri){var E=
u[C].name;E||(E=g.getWidgetNameFromUri(u[C].uri));var B=z.getConfigElementById(r[A].id);r[A]&&r[A].name===E&&!1===B.supportMultiInstance&&(console.log("Widget",r[A].name,"is not copied to new theme because this widget exists in new theme."),y.splice(A,1))}return y},_onAppConfigSet:function(r){r=g.reCreateObject(r);window.appInfo.isRunInMobile=this._isRunInMobile();this.configLoader.processProxy(r);this.configLoader.addNeedValues(r);this._addDefaultValues(r);l.setPortalUrl(r.portalUrl);window.portalUrl=
r.portalUrl;this.appConfig?(r.map.itemId&&r.map.itemId!==this.appConfig.map.itemId&&g.deleteMapOptions(r.map.mapOptions),this.appConfig=r,f.publish("appConfigChanged",this.getAppConfig(),"resetConfig",r)):(this.appConfig=r,v.getPortal(r.portalUrl).loadSelfInfo().then(a.hitch(this,function(u){this.portalSelf=u;f.publish("appConfigLoaded",this.getAppConfig())})))},_addDefaultValues:function(r){this._addDefaultPortalUrl(r);this._addDefaultGeometryService(r);this._addDefaultStyle(r);this._addDefaultMap(r);
this._addDefaultVisible(r);this._addDefaultSharedTheme(r);"undefined"===typeof r.widgetOnScreen&&(r.widgetOnScreen={});"undefined"===typeof r.widgetPool&&(r.widgetPool={});this._addDefaultPanelAndPosition(r);this._addDefaultOfWidgetGroup(r);(r.widgetPool.widgets&&0<r.widgetPool.widgets.length&&void 0===r.widgetPool.widgets[0].index||r.widgetPool.groups&&0<r.widgetPool.groups.length&&void 0===r.widgetPool.groups[0].index)&&this._addIndexForWidgetPool(r);return r},_addDefaultPortalUrl:function(r){"undefined"===
typeof r.portalUrl&&(r.portalUrl="http://www.arcgis.com/");r.portalUrl&&"/"!==r.portalUrl.substr(r.portalUrl.length-1)&&(r.portalUrl+="/")},_addDefaultGeometryService:function(r){var u=r&&r.geometryService;u=u&&"string"===typeof u&&a.trim(u)?a.trim(u):this.portalSelf.helperServices.geometry.url;r.geometryService=u;x.geometryServiceUrl=u;g.setGlobalGeometryService(r.geometryService)},_addDefaultStyle:function(r){!r.theme||r.theme.styles&&0!==r.theme.styles.length||(r.theme.styles=["default"])},_addDefaultMap:function(r){r.map.id=
"map";"undefined"===typeof r.map["3D"]&&"undefined"===typeof r.map["2D"]&&(r.map["2D"]=!0);"undefined"===typeof r.map.position&&(r.map.position={left:0,right:0,top:0,bottom:0});"undefined"===typeof r.map.portalUrl&&(r.map.portalUrl=r.portalUrl)},_addDefaultVisible:function(r){g.visitElement(r,function(u){void 0===u.visible&&(u.visible=!0)})},_addDefaultSharedTheme:function(r){r.theme.sharedTheme?("undefined"===typeof r.theme.sharedTheme.useHeader&&(r.theme.sharedTheme.useHeader=!1),"undefined"===
typeof r.theme.sharedTheme.useLogo&&(r.theme.sharedTheme.useLogo=!1)):r.theme.sharedTheme={useHeader:!1,useLogo:!1}},_addDefaultPanelAndPosition:function(r){this._addOnScreenDefaultPanelAndPosition(r);this._addPoolDefaultPanelAndPosition(r)},_addOnScreenDefaultPanelAndPosition:function(r){var u;if(r=r.widgetOnScreen){var y=r.panel&&r.panel.positionRelativeTo?r.panel.positionRelativeTo:"map";"undefined"===typeof r.panel||"undefined"===typeof r.panel.uri?r.panel={uri:"jimu/OnScreenWidgetPanel",position:{relativeTo:y}}:
"undefined"===typeof r.panel.position?r.panel.position={relativeTo:y}:"undefined"===typeof r.panel.position.relativeTo&&(r.panel.position.relativeTo=y);if(r.widgets)for(y=0;y<r.widgets.length;y++)r.widgets[y].position||(r.widgets[y].position={}),r.widgets[y].position.relativeTo||(r.widgets[y].position.relativeTo=r.widgets[y]&&r.widgets[y].positionRelativeTo?r.widgets[y].positionRelativeTo:"map"),!0!==r.widgets[y].inPanel||r.widgets[y].panel||(r.widgets[y].panel=a.clone(r.panel),r.widgets[y].panel.position=
r.widgets[y].position,r.widgets[y].panel.position.relativeTo=r.widgets[y].position.relativeTo);if(r.groups)for(y=0;y<r.groups.length;y++)for(r.groups[y].panel||(r.groups[y].panel=r.panel),r.groups[y].panel&&!r.groups[y].panel.position&&(r.groups[y].panel.position={}),r.groups[y].panel.position.relativeTo||(r.groups[y].panel.position.relativeTo=r.groups[y].panel.positionRelativeTo?r.groups[y].panel.positionRelativeTo:"map"),r.groups[y].widgets||(r.groups[y].widgets=[]),u=0;u<r.groups[y].widgets.length;u++)r.groups[y].widgets[u].panel=
r.groups[y].panel}},_addPoolDefaultPanelAndPosition:function(r){var u,y=r.widgetPool;if(y){var z=y.panel&&y.panel.positionRelativeTo?y.panel.positionRelativeTo:"map";"undefined"===typeof y.panel||"undefined"===typeof y.panel.uri?y.panel={uri:"jimu/OnScreenWidgetPanel",position:{relativeTo:z}}:"undefined"===typeof y.panel.position?y.panel.position={relativeTo:z}:"undefined"===typeof y.panel.position.relativeTo&&(y.panel.position.relativeTo=z);if(y.groups)for(z=0;z<y.groups.length;z++)for(y.groups[z].panel?
y.groups[z].panel.position.relativeTo||(y.groups[z].panel.position.relativeTo=y.groups[z].panel.positionRelativeTo?y.groups[z].panel.positionRelativeTo:"map"):y.groups[z].panel=y.panel,y.groups[z].widgets||(y.groups[z].widgets=[]),u=0;u<y.groups[z].widgets.length;u++)y.groups[z].widgets[u].panel=y.groups[z].panel;if(y.widgets)for(z=0;z<y.widgets.length;z++)!1===y.widgets[z].inPanel?(u=y.widgets[z].positionRelativeTo?y.widgets[z].positionRelativeTo:"map",y.widgets[z].position)?y.widgets[z].position.relativeTo||
(y.widgets[z].position.relativeTo=u):y.widgets[z].position={relativeTo:u}:y.widgets[z].panel||(y.widgets[z].panel=r.widgetPool.panel)}},_addDefaultOfWidgetGroup:function(r){g.visitElement(r,a.hitch(this,function(u,y){u.isOnScreen=y.isOnScreen;u.widgets?(u.gid=u.id,1===u.widgets.length?(u.label||(u.label=u.widgets[0].label?u.widgets[0].label:"Group"),u.icon||(u.icon=u.widgets[0].uri?this._getDefaultIconFromUri(u.widgets[0].uri):"jimu.js/images/group_icon.png")):(u.icon=u.icon?u.icon:"jimu.js/images/group_icon.png",
u.label=u.label?u.label:window.jimuNls.common.group+"_"+y.index)):(u.gid=y.groupId,u.uri&&g.processWidgetSetting(u))}))},_getDefaultIconFromUri:function(r){r=r.split("/");r.pop();return r.join("/")+"/images/icon.png"},_addIndexForWidgetPool:function(r){var u=0,y,z;if(r.widgetPool.widgets)for(y=0;y<r.widgetPool.widgets.length;y++)r.widgetPool.widgets[y].index=u,u++;if(r.widgetPool.groups)for(y=0;y<r.widgetPool.groups.length;y++)for(r.widgetPool.groups[y].index=u,u++,z=0;z<r.widgetPool.groups[y].widgets.length;z++)r.widgetPool.groups[y].widgets[z].index=
z}});t.getInstance=function(r){null===h?h=new t(r):r&&(h.urlParams=r);window.getAppConfig=a.hitch(h,h.getAppConfig);return h};return t})},"dojo/_base/html":function(){define("./kernel ../dom ../dom-style ../dom-attr ../dom-prop ../dom-class ../dom-construct ../dom-geometry".split(" "),function(b,a,c,d,f,n,k,g){b.byId=a.byId;b.isDescendant=a.isDescendant;b.setSelectable=a.setSelectable;b.getAttr=d.get;b.setAttr=d.set;b.hasAttr=d.has;b.removeAttr=d.remove;b.getNodeProp=d.getNodeProp;b.attr=function(q,
e,m){return 2==arguments.length?d["string"==typeof e?"get":"set"](q,e):d.set(q,e,m)};b.hasClass=n.contains;b.addClass=n.add;b.removeClass=n.remove;b.toggleClass=n.toggle;b.replaceClass=n.replace;b._toDom=b.toDom=k.toDom;b.place=k.place;b.create=k.create;b.empty=function(q){k.empty(q)};b._destroyElement=b.destroy=function(q){k.destroy(q)};b._getPadExtents=b.getPadExtents=g.getPadExtents;b._getBorderExtents=b.getBorderExtents=g.getBorderExtents;b._getPadBorderExtents=b.getPadBorderExtents=g.getPadBorderExtents;
b._getMarginExtents=b.getMarginExtents=g.getMarginExtents;b._getMarginSize=b.getMarginSize=g.getMarginSize;b._getMarginBox=b.getMarginBox=g.getMarginBox;b.setMarginBox=g.setMarginBox;b._getContentBox=b.getContentBox=g.getContentBox;b.setContentSize=g.setContentSize;b._isBodyLtr=b.isBodyLtr=g.isBodyLtr;b._docScroll=b.docScroll=g.docScroll;b._getIeDocumentElementOffset=b.getIeDocumentElementOffset=g.getIeDocumentElementOffset;b._fixIeBiDiScrollLeft=b.fixIeBiDiScrollLeft=g.fixIeBiDiScrollLeft;b.position=
g.position;b.marginBox=function(q,e){return e?g.setMarginBox(q,e):g.getMarginBox(q)};b.contentBox=function(q,e){return e?g.setContentSize(q,e):g.getContentBox(q)};b.coords=function(q,e){b.deprecated("dojo.coords()","Use dojo.position() or dojo.marginBox().");q=a.byId(q);var m=c.getComputedStyle(q);m=g.getMarginBox(q,m);q=g.position(q,e);m.x=q.x;m.y=q.y;return m};b.getProp=f.get;b.setProp=f.set;b.prop=function(q,e,m){return 2==arguments.length?f["string"==typeof e?"get":"set"](q,e):f.set(q,e,m)};b.getStyle=
c.get;b.setStyle=c.set;b.getComputedStyle=c.getComputedStyle;b.__toPixelValue=b.toPixelValue=c.toPixelValue;b.style=function(q,e,m){switch(arguments.length){case 1:return c.get(q);case 2:return c["string"==typeof e?"get":"set"](q,e)}return c.set(q,e,m)};return b})},"jimu/utils":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/sniff dojo/_base/config dojo/io-query dojo/query dojo/NodeList-traverse dojo/Deferred dojo/promise/all dojo/on dojo/json dojo/cookie dojo/number dojo/date/locale dojo/i18n!dojo/cldr/nls/number dojox/encoding/base64 esri/kernel esri/config esri/geometry/SpatialReference esri/geometry/Extent esri/geometry/Multipoint esri/geometry/Polyline esri/geometry/Polygon esri/geometry/support/webMercatorUtils esri/rest/geometryService esri/rest/support/ProjectParameters esri/core/urlUtils esri/request ./shared/utils".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A,C,E,B,D,F,K,L){function G(H,S){var I=H.match(/url\([^)]+\)/gi),Q;if(null===I||""===S)return H;for(Q=0;Q<I.length;Q++){var N=I[Q].match(/(url\(["|']?)(.*)((?:['|"]?)\))/i);if(4<=N.length){var T=N[2];/^data:image\/.*;/.test(T)||(S.endWith("/")||(S+="/"),H=H.replace(N[1]+T+N[3],N[1]+S+T+N[3]))}}return H}function O(H,S){var I=Array.isArray(S),Q=I&&[]||{};I?(H=H||[],Q=Q.concat(H),S.forEach(function(N,T){"undefined"===typeof H[T]?Q[T]=N:"object"===
typeof N?Q[T]=O(H[T],N):-1===H.indexOf(N)&&Q.push(N)})):(H&&"object"===typeof H&&Object.keys(H).forEach(function(N){Q[N]=H[N]}),Object.keys(S).forEach(function(N){Q[N]="object"===typeof S[N]&&S[N]?H[N]?O(H[N],S[N]):S[N]:S[N]}));return Q}function P(H){var S={};var I=H.indexOf("/");H.substring(0,I);I=H.substring(0,H.lastIndexOf("/")+1);S.folderUrl=require(M.getRequireConfig()).toUrl(I);S.amdFolder=I;S.url=S.folderUrl;if(/^http(s)?:\/\//.test(H)||/^\/\//.test(H))S.isRemote=!0;return S}function J(H){H.panels.forEach(function(S){S.uri=
"panels/"+S.name+"/Panel.js"});H.styles.forEach(function(S){S.uri="styles/"+S.name+"/style.css"});H.layouts.forEach(function(S){S.uri="layouts/"+S.name+"/config.json";S.icon="layouts/"+S.name+"/icon.png";S.RTLIcon="layouts/"+S.name+"/icon_rtl.png"})}function R(H,S){var I=H.map(function(T){return T.id});a.forEach(S,function(T){0>I.indexOf(T)&&H.push({id:T,widgets:[]})},this);var Q=[];H=a.filter(H,function(T){return 0>S.indexOf(T.id)?(Q.push(T),!1):!0},this);if(0===H.length)return[];var N=H[H.length-
1];a.forEach(Q,function(T){N.widgets=N.widgets.concat(T.widgets)},this);return H=H.sort(function(T,aa){return S.indexOf(T.id)-S.indexOf(aa.id)})}function X(H,S,I){function Q(T,aa){return b.isArray(T[aa.key])?T[aa.key][aa.index]:T[aa.key]}S=function(T){var aa=[];T.split("_").forEach(function(Z){var da=!1;"--"===Z.slice(Z.length-2)&&(da=!0,Z=Z.slice(0,Z.length-2));var fa=Z.search(/\[[0-9]+\]/);-1===fa&&(fa=Z.length);aa.push({key:Z.slice(0,fa),index:Number(Z.slice(fa+1,-1)),deleteFlag:da})});return aa}(S);
for(var N=1;N<S.length-1;N++)if(H=Q(H,S[N]),!H)return;if(S[S.length-1].deleteFlag)!0===I&&(b.isArray(H[S[S.length-1].key])?delete H[S[S.length-1].key][S[S.length-1].index]:delete H[S[S.length-1].key]);else if(b.isArray(H[S[S.length-1].key])){if(void 0===I)return H[S[S.length-1].key][S[S.length-1].index];H[S[S.length-1].key][S[S.length-1].index]=I}else{if(void 0===I)return H[S[S.length-1].key];H[S[S.length-1].key]=I}}function U(H,S,I){function Q(Z){Z=M.template.getSearchRange(S,Z,"]");var da=S.slice(Z.firstPos,
Z.lastPos);return-1!==Z.firstPos?(da=S.slice(Z.firstPos+da.indexOf("[")+1,Z.lastPos-1),Z=S.slice(Z.lastPos+1),(da=M.getConfigElementById(H,da))?{object:da,key:"section_"+Z,state:"isSection"}:{state:"deleted"}):{state:"isNotSection"}}var N=H,T=S=S.replace(/\//g,"_"),aa=Q("groups\\[.+\\]");if("deleted"!==aa.state&&("isSection"===aa.state&&(N=aa.object,T=aa.key),aa=Q("widgets\\[.+\\]"),"delete"!==aa.state))return"isSection"===aa.state&&(N=aa.object,T=aa.key),X(N,T,I)}var M={},V={geometryService:"http://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer"};
b.mixin(M,L);window.atob||(window.atob=function(H){H=h.decode(H);for(var S="",I=0,Q=H.length;I<Q;I++)S+=String.fromCharCode(H[I]);return S});window.btob||(window.btob=function(H){for(var S=[],I=0,Q=H.length;I<Q;I++)S.push(String.charCodeAt(H[I]));return h.encode(S)});var Y=[];require.on("error",function(H){a.forEach(Y,function(S){H.info[0]&&-1<H.info[0].indexOf(S.resKey)&&S.def.reject(H);for(var I in H.info)-1<I.indexOf(S.resKey)&&S.def.reject(H)})});M.checkError=function(H,S){Y.push({resKey:H,def:S})};
M.replacePlaceHolder=function(H,S){var I=l.stringify(H),Q=I.match(/\$\{(\w)+\}/g);if(null===Q)return H;for(H=0;H<Q.length;H++){var N=Q[H].match(/(\w)+/g)[0];S[N]&&(I=I.replace(Q[H],S[N]))}return l.parse(I)};M.changeUnit=function(H){var S=Math.abs(H);H=Math.floor(S);var I=Math.floor(60*(S-H));S=(60*(60*(S-H)-I)).toFixed(2);return H+"\u00b0"+(10>I?"0"+I:I)+"'"+(10>S?"0"+S:S)+'"'};M.formatTime=function(H){var S=H/1E3;H=Math.floor(S/60);S=Number(S-60*H).toFixed(1);return(10>H?"0"+H:H)+":"+(10>S?"0"+S:
S)};M.parseTime=function(H){var S=/(\d{2,}):(\d{2})\.(\d{1})/;if(!S.test(H))return console.log("wrong time format."),-1;H=H.match(S);return 1E3*(60*parseInt(H[1],10)+parseInt(H[2],10)+parseInt(H[3],10)/10)};M.preloadImg=function(H,S){var I=[];I="string"===typeof H?[H]:H;a.forEach(I,function(Q){(new Image).src=S?S+Q:Q})};M.setWABLogoDefaultAlt=function(H){if(H){H=k("img",H);for(var S=["img_1412759111499","img_1545621838463","img_1560482577021"],I=0,Q=H.length;I<Q;I++){var N=H[I];-1<S.indexOf(c.getAttr(N,
"id"))&&!c.getAttr(N,"alt")&&c.setAttr(N,"alt","ArcGIS Web AppBuilder.png")}}};var W=null;M.getImagesSize=function(H){var S=new q;if(!H||0!==H.indexOf("http"))return S.reject(),S;null===W&&(W=c.create("img",{id:"__test-image-size",style:{position:"absolute",left:"-9999px",top:"-9999px"}},document.body));var I=m(W,"load",function(){clearTimeout(Q);Q=null;I.remove();var N=c.getContentBox(W);1===N.w&&1===N.h||0===N.w||0===N.h?S.reject():S.resolve([N.w,N.h])},{}),Q=setTimeout(function(){clearTimeout(Q);
Q=null;S.reject()},5E3);c.setAttr(W,"src",H);return S};M.getPositionStyle=function(H){var S={};if(!H)return S;H=b.clone(H);if(window.isRTL){if("undefined"!==typeof H.left&&"undefined"!==typeof H.right){var I=H.left;H.left=H.right;H.right=I}else"undefined"!==typeof H.left?(H.right=H.left,delete H.left):"undefined"!==typeof H.right&&(H.left=H.right,delete H.right);"undefined"!==typeof H.paddingLeft&&"undefined"!==typeof H.paddingRight?(I=H.paddingLeft,H.paddingLeft=H.paddingRight,H.paddingRight=I):
"undefined"!==typeof H.paddingLeft?(H.paddingRight=H.paddingLeft,delete H.paddingLeft):"undefined"!==typeof H.paddingRight&&(H.paddingLeft=H.paddingRight,delete H.paddingRight);"undefined"!==typeof H.marginLeft&&"undefined"!==typeof H.marginRight?(I=H.marginLeft,H.marginLeft=H.marginRight,H.marginRight=I):"undefined"!==typeof H.marginLeft?(H.marginRight=H.marginLeft,delete H.marginLeft):"undefined"!==typeof H.marginRight&&(H.marginLeft=H.marginRight,delete H.marginRight)}I="left top right bottom width height padding paddingLeft paddingRight paddingTop paddingBottom margin marginLeft marginRight marginTop marginBottom".split(" ");
for(var Q=0;Q<I.length;Q++){var N=I[Q];"number"===typeof H[N]?S[N]=H[N]+"px":"undefined"!==typeof H[N]?S[N]=H[N]:"padding"===N.substr(0,7)||"margin"===N.substr(0,7)?S[N]=0:S[N]="auto"}S.zIndex="undefined"===typeof H.zIndex?"auto":H.zIndex;return S};M.isEqual=function(H,S){function I(T,aa){var Z;if(null===T&&null===aa||"undefined"===typeof T&&"undefined"===typeof aa)return!0;if(null===T&&null!==aa||null===aa&&null!==T||"undefined"===typeof T&&"undefined"!==typeof aa||"undefined"===typeof aa&&"undefined"!==
typeof T)return!1;if(isNaN(T)&&isNaN(aa)&&"number"===typeof T&&"number"===typeof aa||T===aa)return!0;if("function"===typeof T&&"function"===typeof aa||T instanceof Date&&aa instanceof Date||T instanceof RegExp&&aa instanceof RegExp||T instanceof String&&aa instanceof String||T instanceof Number&&aa instanceof Number)return T.toString()===aa.toString();if(-1<Q.indexOf(T)||-1<N.indexOf(aa))return!1;if(null!==aa){for(Z in aa)if(aa.hasOwnProperty(Z)!==T.hasOwnProperty(Z)||typeof aa[Z]!==typeof T[Z])return!1;
for(Z in T){if(aa.hasOwnProperty(Z)!==T.hasOwnProperty(Z)||typeof aa[Z]!==typeof T[Z])return!1;switch(typeof T[Z]){case "object":case "function":Q.push(T);N.push(aa);if(!I(T[Z],aa[Z]))return!1;Q.pop();N.pop();break;default:if(T[Z]!==aa[Z])return!1}}}return!0}var Q=[];var N=[];return I(H,S)?!0:!1};M.getUriInfo=P;M.file={loadFileAPI:function(){var H=new q;H.resolve();return H},supportHTML5:function(){return window.File&&window.FileReader&&window.FileList&&window.Blob?!0:!1},supportFileAPI:function(){return d("safari")&&
6>d("safari")?!1:window.FileAPI&&window.FileAPI.readAsDataURL?!0:!1},isEnabledFlash:function(){var H=null;if(document.all)try{H=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(S){H=null}else navigator.plugins&&0<navigator.plugins.length&&(H=navigator.plugins["Shockwave Flash"]);return!!H},containSeparator:function(H){return 0<=H.indexOf("/")?!0:0<=H.indexOf("\\")?!0:!1},getNameFromPath:function(H){var S="";S=0<=H.indexOf("/")?"/":"\\";H=H.split(S);return 0<H.length?H[H.length-1]:null},getFolderFromPath:function(H){return H.substr(0,
H.length-M.file.getNameFromPath(H).length)},readFile:function(H,S,I,Q){if(this.supportHTML5()){var N=H.target.files[0];N&&(N.type.match(S)?N.size>=I?Q({errCode:"exceed"}):(H=new FileReader,H.onload=function(aa){Q(null,N.name,aa.target.result)},H.readAsDataURL(N)):Q({errCode:"invalidType"}))}else if(this.supportFileAPI()){var T=window.FileAPI.getFiles(H);T[0].type.match(S)?T[0].size>=I?Q({errCode:"exceed"}):window.FileAPI.readAsDataURL(T[0],function(aa){aa&&aa.result?Q(null,T[0].name,aa.result):Q({errCode:"readError"})}):
Q({errCode:"invalidType"})}}};M.processWidgetSetting=function(H){if(!H.uri)return H;b.mixin(H,P(H.uri));H.icon||(H.icon=H.amdFolder+"images/icon.png");H.thumbnail||(H.thumbnail=H.amdFolder+"images/thumbnail.png");return H};M.getRequireConfig=function(){if(jimuConfig){var H=[];jimuConfig.widgetsPackage&&(H=H.concat(jimuConfig.widgetsPackage));jimuConfig.themesPackage&&(H=H.concat(jimuConfig.themesPackage));jimuConfig.configsPackage&&(H=H.concat(jimuConfig.configsPackage));return{packages:H}}return{}};
M.getTypeByGeometryType=function(H){var S="",I="esriGeometryLine esriGeometryCircularArc esriGeometryEllipticArc esriGeometryBezier3Curve esriGeometryPath esriGeometryPolyline".split(" "),Q=["esriGeometryRing","esriGeometryPolygon","esriGeometryEnvelope"];0<=["esriGeometryPoint","esriGeometryMultipoint"].indexOf(H)?S="point":0<=I.indexOf(H)?S="polyline":0<=Q.indexOf(H)&&(S="polygon");return S};M.getSymbolTypeByGeometryType=function(H){var S=null;H=M.getTypeByGeometryType(H);"point"===H?S="marker":
"polyline"===H?S="line":"polygon"===H&&(S="fill");return S};M.getServices=function(){return V};M.restoreToDefaultWebMapExtent=function(H,S,I){var Q=new q;if(!H||"esri.Map"!==H.declaredClass)return setTimeout(function(){Q.reject("Invalid map.")},0),Q;S=S&&S.itemInfo;if(!S)return setTimeout(function(){Q.reject("Invalid itemInfo")},0),Q;S=S.item&&S.item.extent;if(!S)return setTimeout(function(){Q.reject("Invalid itemInfo.item.extent")}),Q;var N=new u({wkid:4326});N=new y(S[0][0],S[0][1],S[1][0],S[1][1],
N);if(4326===parseInt(H.spatialReference.wkid,10))return H.setExtent(N);if(H.spatialReference.isWebMercator)return N=E.geographicToWebMercator(N),H.setExtent(N);S=new D;S.geometries=[N];S.outSR=H.spatialReference;N=null;if(N=r&&r.defaults&&r.defaults.geometryServiceUrl&&"string"===typeof r.defaults.geometryServiceUrl&&b.trim(r.defaults.geometryServiceUrl)?r.defaults.geometryServiceUrl:I&&"string"===typeof I&&b.trim(I)?I:M.getServices()&&M.getServices().geometryService)return N=b.trim(N),B.project(N,
S).then(function(T){if(T=T&&T[0])return H.setExtent(T);Q.reject("Invalid projected geometry.");return Q},function(T){console.error(T);Q.reject(T);return Q}),Q};M.getAncestorWindow=function(){for(var H=window;H&&H.parent&&H!==H.parent;)H=H.parent;return H};M.getAncestorDom=function(H,S,I){if(H&&1===H.nodeType&&S&&"function"===typeof S){var Q=100,N=document.body;I&&("number"===typeof I?(I=parseInt(I,10),0<I&&(Q=I)):1===I.nodeType&&(N=I));for(I=0;H.parentNode&&I<Q&&c.isDescendant(H.parentNode,N);){if(S(H.parentNode))return H.parentNode;
H=H.parentNode;I++}}return null};M.bindClickAndDblclickEvents=function(H,S,I,Q){var N=null;if(H&&1===H.nodeType&&S&&"function"===typeof S&&I&&"function"===typeof I){var T=200;Q&&"number"===typeof Q&&(Q=parseInt(Q,10),0<Q&&(T=Q));var aa=0;N=m(H,"click",function(Z){aa++;1===aa?setTimeout(function(){1===aa&&(aa=0,S(Z))},T):2===aa&&(aa=0,I(Z))})}return N};M.isScrollToBottom=function(H){var S=c.getContentBox(H);return 1>H.scrollHeight-(H.scrollTop+S.h)};M.getAllItemTypes=function(){var H=[];H=H.concat(["Web Map",
"Web Scene","CityEngine Web Scene"]).concat("Feature Service;Map Service;Image Service;KML;WMS;Feature Collection;Feature Collection Template;Geodata Service;Globe Service".split(";")).concat(["Geometry Service","Geocoding Service","Network Analysis Service","Geoprocessing Service"]).concat(["Web Mapping Application","Mobile Application","Code Attachment","Operations Dashboard Add In","Operation View"]).concat("Symbol Set;Color Set;Shapefile;CSV;Service Definition;Document Link;Microsoft Word;Microsoft PowerPoint;Microsoft Excel;PDF;Image;Visio Document".split(";"));
return H=H.concat("Map Document;Map Package;Tile Package;ArcPad Package;Explorer Map;Globe Document;Scene Document;Published Map;Map Template;Windows Mobile Package".split(";")).concat(["Layer","Layer Package","Explorer Layer"]).concat(["Geoprocessing Package","Geoprocessing Sample","Locator Package","Rule Package"]).concat("Workflow Manager Package;Desktop Application;Desktop Application Template;Code Sample;Desktop Add In;Explorer Add In".split(";"))};M.getItemQueryStringByTypes=function(H){var S=
"",I=M.getAllItemTypes();if(H&&0<H.length&&0<H.length){var Q="";a.forEach(H,function(N,T){Q+=' type:"'+N+'" ';T!==H.length-1&&(Q+=" OR ")});S=" ( "+Q+" ) ";I=H.concat(I);I=a.filter(I,function(N){return a.every(H,function(T){return 0>T.toLowerCase().indexOf(N.toLowerCase())})});a.forEach(I,function(N){S+=' -type:"'+N+'" '})}return S};M.getItemQueryStringByTypeKeywords=function(H){var S="";H&&0<H.length&&(S=' typekeywords:"'+H.join(",")+'" ');return S};M.isNotEmptyString=function(H,S){var I=H&&"string"===
typeof H;return I?S?I&&b.trim(H):!0:!1};M.isValidNumber=function(H){return"number"===typeof H&&!isNaN(H)};M.isObject=function(H){return H&&"object"===typeof H};M.getRandomString=function(){var H=Math.random().toString();return H=H.slice(2,H.length)};M._getDomainsByServerName=function(H){var S=H.split("."),I=S.length;return a.map(S,b.hitch(this,function(Q,N){Q=S.slice(N,I);var T="",aa=Q.length-1;a.forEach(Q,b.hitch(this,function(Z,da){T+=Z;da!==aa&&(T+=".")}));return T}))};M.removeCookie=function(H,
S){var I=this._getDomainsByServerName(window.location.hostname);a.forEach(I,b.hitch(this,function(Q){w(H,null,{expires:-1,path:S});w(H,null,{expires:-1,path:S,domain:Q});w(H,null,{expires:-1,path:S,domain:"."+Q})}))};M.isLocaleChanged=function(H,S){return!H.startWith(S)};M.hashToObject=function(H){H=H.replace("#","");H=n.queryToObject(H);for(var S in H)if(H.hasOwnProperty(S))try{H[S]=l.parse(H[S])}catch(I){}return H};M.reCreateObject=function(H){function S(Q){var N=[];Q.forEach(function(T){Array.isArray(T)?
N.push(S(T)):"object"===typeof T?N.push(I(T)):N.push(T)});return N}function I(Q){var N={},T;for(T in Q)Q.hasOwnProperty(T)&&(null===Q[T]?N[T]=null:Array.isArray(Q[T])?N[T]=S(Q[T]):N[T]="object"===typeof Q[T]?I(Q[T]):Q[T]);return N}return Array.isArray(H)?S(H):I(H)};M.setVerticalCenter=function(H){setTimeout(function(){var S=k(".jimu-vcenter-text",H),I,Q;a.forEach(S,function(N){I=c.getContentBox(N).h;c.setStyle(N,{lineHeight:I+"px"})},this);S=k(".jimu-vcenter",H);a.forEach(S,function(N){I=c.getContentBox(N).h;
Q=c.getContentBox(k(N).parent()[0]).h;c.setStyle(N,{marginTop:(Q-I)/2+"px"})},this)},10)};M.merge=O;M.loadStyleLink=function(H,S,I){var Q=new q,N=require(M.getRequireConfig()).toUrl(S);if(require.cache["url:"+N]){var T=require.cache["url:"+N];var aa=N.split("/").pop();N=N.substr(0,N.length-aa.length);T=G(T,N);H=I?c.create("style",{id:H,type:"text/css"},c.byId(I),"before"):c.create("style",{id:H,type:"text/css"},document.getElementsByTagName("head")[0]);H.styleSheet&&!H.sheet?H.styleSheet.cssText=
T:H.appendChild(c.toDom(T));Q.resolve("load");return Q}T=I?c.create("link",{id:H,rel:"stylesheet",type:"text/css",href:N},c.byId(I),"before"):c.create("link",{id:H,rel:"stylesheet",type:"text/css",href:N},document.getElementsByTagName("head")[0]);m(T,"load",function(){Q.resolve("load")});var Z=setInterval(function(){var da;if(a.some(document.styleSheets,function(fa){if(fa.href&&fa.href.substr(fa.href.indexOf(S),fa.href.length)===S)return da=fa,!0}))try{!Q.isFulfilled()&&(da.cssRules&&da.cssRules.length||
da.rules&&da.rules.length)&&Q.resolve("load"),clearInterval(Z)}catch(fa){}},50);return Q};M.changeLocation=function(H){window.history.pushState&&window.history.pushState({path:H},"",H)};M.urlToObject=function(H){var S=null;-1===H.indexOf("#")?(S=F.urlToObject(H),S.hash=null):(H=H.split("#"),S=F.urlToObject(H[0]),S.hash=H[1]?-1<H[1].indexOf("\x3d")?n.queryToObject(H[1]):H[1]:null);return S};M.addManifestProperies=function(H){H.icon=H.url+"images/icon.png";"theme"===H.category?J(H):("undefined"!==typeof H["2D"]&&
(H.support2D=H["2D"]),"undefined"!==typeof H["3D"]&&(H.support3D=H["3D"]),"undefined"===typeof H["2D"]&&"undefined"===typeof H["3D"]&&(H.support2D=!0),delete H["2D"],delete H["3D"],"undefined"===typeof H.properties&&(H.properties={}),L.processWidgetProperties(H))};M.getUniqueValues=function(H,S){var I=new q;H=H.replace(/\/*$/g,"")+"/generateRenderer";S=l.stringify({type:"uniqueValueDef",uniqueValueFields:[S]});K(H,{query:{classificationDef:S,f:"json"},responseType:"json",callbackParamName:"callback"}).then(b.hitch(this,
function(Q){var N=Q.data;Q=[];(N=N&&N.uniqueValueInfos)&&0<N.length&&(Q=a.map(N,b.hitch(this,function(T){return T.value})));I.resolve(Q)}),b.hitch(this,function(Q){I.reject(Q)}));return I};M.combineRadioCheckBoxWithLabel=function(H,S){var I=!1;if(H&&1===H.nodeType&&"input"===H.tagName.toLowerCase()){var Q=H.getAttribute("type")||"";Q=Q.toLowerCase();if("radio"===Q||"checkbox"===Q)I=!0}Q=!1;S&&1===S.nodeType&&"label"===S.tagName.toLowerCase()&&(Q=!0);I&&Q&&(I=H.getAttribute("id"),I||(I="input_"+M.getRandomString(),
H.setAttribute("id",I)),S.setAttribute("for",I),c.setStyle(S,"cursor","pointer"))};M.convertExtentToPolygon=function(H){var S=H.xmin,I=H.xmax,Q=H.ymin,N=H.ymax;return new C({rings:[[[S,N],[I,N],[I,Q],[S,Q],[S,N]]],spatialReference:H.toJson()})};M.combineGeometries=function(H){function S(ka){var ha={points:[],spatialReference:ka[0].spatialReference.toJson()};a.forEach(ka,function(ba){ha.points=ha.points.concat(ba.points)});return new z(ha)}function I(ka){var ha={paths:[],spatialReference:ka[0].spatialReference.toJson()};
a.forEach(ka,function(ba){ha.paths=ha.paths.concat(ba.paths)});return new A(ha)}function Q(ka){var ha={rings:[],spatialReference:ka[0].spatialReference.toJson()};a.forEach(ka,function(ba){"polygon"===ba.type?ha.rings=ha.rings.concat(ba.rings):"extent"===ba.type&&(ba=M.convertExtentToPolygon(ba),ha.rings=ha.rings.concat(ba.rings))});return new C(ha)}var N=null;if(H&&0<H.length)if(1===H.length)N=H[0];else{for(var T=null,aa=null,Z=null,da=null,fa=0;fa<H.length;fa++){T=H[fa];switch(T.type){case "point":case "multipoint":da=
"point";break;case "polyline":da="polyline";break;case "polygon":case "extent":da="polygon";break;default:return null}if(0===fa)Z=da;else if(Z!==da)return null;if(fa!==H.length-1&&(aa=H[fa+1],!T.spatialReference.equals(aa.spatialReference)))return null}"point"===da?N=S(H):"polyline"===da?N=I(H):"polygon"===da&&(N=Q(H))}return N};M.isFeaturelayerUrlSupportQuery=function(H,S){var I=!1,Q=/\/featureserver\//gi.test(H);H=/\/mapserver\//gi.test(H);S=(S||"").toLowerCase();Q?I=0<=S.indexOf("query"):H&&(I=
0<=S.indexOf("data"));return I};M.isImageServiceSupportQuery=function(H){return 0<=(H||"").toLowerCase().indexOf("catalog")};M.isStringEndWith=function(H,S){return H.lastIndexOf(S)+S.length===H.length};M.processManifestLabel=function(H,S){var I=S.split("-")[0];H.label=H.i18nLabels&&(H.i18nLabels[S]||H.i18nLabels[I]||H.i18nLabels.defaultLabel)||H.label||H.name;H.layouts&&a.forEach(H.layouts,function(Q){var N="i18nLabels_layout_"+Q.name;Q.label=H[N]&&(H[N][S]||H[N].defaultLabel)||Q.label||Q.name});
H.styles&&a.forEach(H.styles,function(Q){var N="i18nLabels_style_"+Q.name;Q.label=H[N]&&(H[N][S]||H[N].defaultLabel)||Q.label||Q.name})};M.addManifest2WidgetJson=function(H,S){b.mixin(H,S.properties);H.name=S.name;H.label||(H.label=S.label);H.manifest=S};M.widgetJson=function(){var H={addManifest2WidgetJson:function(S,I){b.mixin(S,I.properties);S.name=I.name;S.label||(S.label=I.label);S.manifest=I;S.isRemote=I.isRemote;S.isRemote&&(S.itemId=I.itemId);I.featureActions&&(S.featureActions=I.featureActions);
S.icon||(S.icon=I.icon);S.thumbnail||(S.thumbnail=I.thumbnail);S.folderUrl=I.folderUrl;S.amdFolder=I.amdFolder},removeManifestFromWidgetJson:function(S){if(S.manifest){for(var I in S.manifest.properties)S[I]=void 0;S.name=void 0;S.label=void 0;S.featureActions=void 0;S.manifest=void 0}},getUriFromItem:function(S){return S.url?H.getFolderUrlFromItem(S)+"Widget":null},getFolderUrlFromItem:function(S){if(!S.url)return null;S=/manifest\.json$/.test(S.url)?S.url.substring(0,S.url.length-13):/\/$/.test(S.url)?
S.url:S.url+"/";"https:"===window.location.protocol&&(S=S.replace(/^http:\/\//,"https://"));return S}};return H}();M.addI18NLabel=function(H){var S=new q;if(H.i18nLabels)return S.resolve(H),S;H.i18nLabels={};if(H.properties&&!1===H.properties.hasLocale)return S.resolve(H),S;var I="widget"===H.category?"_widgetLabel":"_themeLabel";require(M.getRequireConfig(),["dojo/i18n!"+H.amdFolder+"nls/strings"],function(Q){H.i18nLabels[dojoConfig.locale]=Q[I];"theme"===H.category&&(H.layouts&&H.layouts.forEach(function(N){H["i18nLabels_layout_"+
N.name]={};H["i18nLabels_layout_"+N.name][dojoConfig.locale]=Q["_layout_"+N.name]}),H.styles&&H.styles.forEach(function(N){H["i18nLabels_style_"+N.name]={};H["i18nLabels_style_"+N.name][dojoConfig.locale]=Q["_style_"+N.name]}));S.resolve(H)});return S};M.localizeNumber=function(H,S){var I=(H.toString().split(".")[1]||"").length,Q="";Q=S&&isFinite(S.places)&&S.places;Q=0<Q||0<I?"#,###,###,##0.0"+Array.prototype.join.call({length:0<Q?Q+1:I},"0"):"#,###,###,##0";I={locale:f.locale,pattern:Q};b.mixin(I,
S||{});try{return v.format(H,I)}catch(N){return console.error(N),H.toLocaleString()}};M.parseNumber=function(H,S){var I={locale:f.locale};b.mixin(I,S||{});try{return v.parse(H,I)}catch(Q){return console.error(Q),H}};M.localizeDate=function(H,S){var I={locale:f.locale,fullYear:!0};b.mixin(I,S||{});try{return x.format(H,I)}catch(Q){return console.error(Q),"date"===I.selector?H.toLocaleDateString():"time"===I.selector?H.toLocaleTimeString():H.toLocaleString()}};M.localizeNumberByFieldInfo=function(H,
S){var I=null;I=b.exists("format.places",S)&&S.format.places;I=M.localizeNumber(H,{places:I});return b.exists("format.digitSeparator",S)&&!S.format.digitSeparator?I.toString().replace(new RegExp("\\"+p.group,"g"),""):I};M.fieldFormatter={getFormattedUrl:function(H){if(H&&"string"===typeof H){var S=H.indexOf("http:");-1===S&&(S=H.indexOf("https:"));if(-1<S&&-1===H.indexOf("href\x3d")){var I=H.indexOf(" ",S);-1===I&&(I=H.length);var Q=H.substring(S,I);H=H.substring(0,S)+'\x3cA href\x3d"'+Q+'" target\x3d"_blank"\x3e'+
Q+"\x3c/A\x3e"+H.substring(I,H.length)}}return H||""},getFormattedNumber:function(H,S){if("number"===typeof H){var I=(H.toString().split(".")[1]||"").length;H=M.localizeNumberByFieldInfo(H,{format:{places:S&&"number"===typeof S.places?parseInt(S.places,10):I,digitSeparator:S&&S.digitSeparator}});return'\x3cspan class\x3d"jimu-numeric-value"\x3e'+(H||"")+"\x3c/span\x3e"}return H},getFormattedDate:function(H){H&&(H=M.localizeDate(new Date(H),{fullYear:!0}));return H||""},getCodedValue:function(H,S){if(H&&
H.codedValues){for(var I=0,Q=H.codedValues.length;I<Q;I++){var N=H.codedValues[I];if(M.isDefined(S)&&b.exists("code",N)&&S.toString()===N.code.toString())return N.name}return S}return S||null},getTypeName:function(H,S){for(var I=S.length,Q=0;Q<I;Q++)if(H===S[Q].id)return S[Q].name;return H}};M.addRelativePathInCss=G;M.url={isAbsolute:function(H){return H?H.startWith("http")||H.startWith("/"):!1},removeQueryParamFromUrl:function(H,S){H=F.urlToObject(H);H.query&&delete H.query[S];S=H.path;for(var I in H.query)S=
S===H.path?S+"?"+I+"\x3d"+H.query[I]:S+"\x26"+I+"\x3d"+H.query[I];return S},addQueryParamToUrl:function(H,S,I){H=F.urlToObject(H);H.query||(H.query={});H.query[S]=I;S=H.path;for(var Q in H.query)S=S===H.path?S+"?"+Q+"\x3d"+H.query[Q]:S+"\x26"+Q+"\x3d"+H.query[Q];return S}};M.processUrlInWidgetConfig=function(H,S){if(H)return H.startWith("data:")||H.startWith("http")||H.startWith("/")?H:H.startWith("${appPath}")?H.replace("${appPath}",window.appInfo.appPath):S+H};M.processUrlInAppConfig=function(H){if(H)return H.startWith("data:")||
H.startWith("http")||H.startWith("/")?H:window.appInfo.appPath+H};M.getLocationUrlWithoutHashAndQueryParams=function(){var H=window.location,S=H.protocol+"//"+H.host+H.pathname;H=F.urlToObject(H.href);H.query&&H.query.apiurl&&(S=M.url.addQueryParamToUrl(S,"apiurl",H.query.apiurl));return S};M.getDefaultWebMapThumbnail=function(){return require.toUrl("jimu/images/webmap.png")};M.invertColor=function(H){H=H.substring(1);3===H.length&&(H=H.slice(0,1)+H.slice(0,1)+H.slice(1,1)+H.slice(1,1)+H.slice(2,
1)+H.slice(2,1));H=parseInt(H,16);return 7829367<H?"#000000":"#ffffff"};M.mixinAppConfigPosition=function(H,S){var I=b.clone(H);if(!S)return I;S=b.clone(S);var Q=I.widgetOnScreen,N=S.widgetOnScreen;N&&N.widgets&&("[object Object]"===Object.prototype.toString.call(N.widgets)?a.forEach(Q.widgets,function(T,aa){aa=T.uri?T.uri:"ph_"+aa;N.widgets[aa]&&N.widgets[aa].position&&(N.widgets[aa].position.relativeTo||(N.widgets[aa].position.relativeTo="map"),T.position=N.widgets[aa].position)},this):a.forEach(N.widgets,
function(T,aa){T.position&&!T.position.relativeTo&&(T.position.relativeTo="map");Q.widgets[aa]&&T.position&&(Q.widgets[aa].position=T.position)}));N&&N.groups&&("[object Object]"===Object.prototype.toString.call(N.groups)?a.forEach(Q.groups,function(T,aa){aa=T.label?T.label:"g_"+aa;N.groups[aa]&&N.groups[aa].panel&&N.groups[aa].panel.position&&(N.groups[aa].panel.position.relativeTo||(N.groups[aa].panel.position.relativeTo="map"),T.panel.position=N.groups[aa].panel.position)},this):(H=H.layoutDefinition?
H.layoutDefinition.manager:"jimu/layoutManagers/AbsolutePositionLayoutManager","jimu/layoutManagers/AbsolutePositionLayoutManager"===H?a.forEach(N.groups,function(T,aa){T.panel&&T.panel.position&&!T.panel.position.relativeTo&&(T.panel.position.relativeTo="map");Q.groups[aa]&&T.panel&&T.panel.position&&(Q.groups[aa].panel.position=T.panel.position)}):"jimu/layoutManagers/GridLayoutManager"===H&&(Q.groups=R(Q.groups,N.groups.map(function(T){return T.id})))));S.map&&S.map.position&&(I.map?I.map.position=
S.map.position:I.map={position:S.map.position});S.widgetPool&&S.widgetPool.panel&&(S.widgetPool.panel.position&&!S.widgetPool.panel.position.relativeTo&&(S.widgetPool.panel.position.relativeTo="map"),I.widgetPool.panel.position=S.widgetPool.panel.position);S.mobileLayout&&(I.mobileLayout=S.mobileLayout);return I};M.handleGridLayoutOnScreenGroupChange=R;M.template={groupIdentification:"groups\\[.+\\]",widgetIdentification:"widgets\\[.+\\]",getSearchRange:function(H,S,I){var Q=-1;S=H.search(new RegExp(S));
0<=S&&(H=H.slice(S,H.length),H=H.indexOf(I),Q=S+H+I.length);return{firstPos:S,lastPos:Q}},setConfigValue:function(H,S,I){X(H,S,I)},getConfigValue:function(H,S){return X(H,S)},setConfigValueWithId:function(H,S,I){U(H,S,I)},getConfigValueWithId:function(H,S){return U(H,S)},getKeyInfo:function(H){var S=this.getWidgetIdByKey(H);if(null!==S)return{type:"widget",id:S};H=this.getGroupIdByKey(H);return null!==H?{type:"group",id:H}:{type:"unknow",id:null}},getWidgetIdByKey:function(H){var S=M.template.getSearchRange(H,
M.template.widgetIdentification,"]");if(-1===S.firstPos)H=null;else{var I=H.slice(S.firstPos,S.lastPos);H=H.slice(S.firstPos+I.indexOf("[")+1,S.lastPos-1)}return H},getGroupIdByKey:function(H){var S=M.template.getSearchRange(H,M.template.groupIdentification,"]");if(-1===S.firstPos)H=null;else{var I=H.slice(S.firstPos,S.lastPos);H=H.slice(S.firstPos+I.indexOf("[")+1,S.lastPos-1)}return H},getConfigedWidgetsByTemplateConfig:function(H){var S=[],I=M.template.widgetIdentification+"_config",Q;a.forEach(H.configurationSettings,
function(N){a.forEach(N.fields,function(T){T.fieldName&&(Q=M.template.getSearchRange(T.fieldName,I,"]"),0<=Q.firstPos&&(T=M.template.getWidgetIdByKey(T.fieldName),-1===S.indexOf(T)&&S.push(T)))},this)},this);return S},mergeTemplateAppConfigToAppConfig:function(H,S,I){function Q(Z){var da=[];a.forEach(Z,function(fa){fa&&da.push(fa)},this);return da}var N=H.widgetOnScreen,T=H.portalUrl;S.values.webmap&&(H.map.itemId=S.values.webmap);I&&(H.map.mapOptions&&M.deleteMapOptions(H.map.mapOptions),H.map.portalUrl=
T,S.values.app_title||(S.values.app_title=I.title),S.values.app_subtitle||(S.values.app_subtitle=I.snippet));for(var aa in S.values)"webmap"!==aa&&M.template.setConfigValueWithId(H,aa,S.values[aa]);H.widgetPool.widgets=Q(H.widgetPool.widgets);N.widgets=Q(N.widgets);if(H.widgetPool.groups)for(S=0;S<H.widgetPool.groups.length;S++)H.widgetPool.groups[S].widgets=Q(H.widgetPool.groups[S].widgets);if(N.groups)for(S=0;S<N.groups.length;S++)N.groups[S].widgets=Q(N.groups[S].widgets);return H}};M.deleteMapOptions=
function(H){H&&(delete H.extent,delete H.lods,delete H.center,delete H.scale,delete H.zoom,delete H.maxScale,delete H.maxZoom,delete H.minScale,delete H.minZoom,delete H.initialState)};M.localeIsSame=function(H,S){return H.split("-")[0]===S.split("-")[0]};M.graphicsExtent=function(){return null};M.sanitizeHTML=function(H){return html_sanitize(H,function(S){return S},function(S){return S})};M.stripHTML=function(H){return H?-1<H.indexOf("\x3c")&&-1<H.indexOf("\x3e")?H.replace(/<(?:.|\s)*?>/g,""):H:
H};M.removeSuffixSlashes=function(H){return H.replace(/\/*$/g,"")};M.getBestDisplayAttributes=function(H,S){var I={},Q=null,N;for(N in H)Q=M.getBestDisplayValue(N,H,S),I[N]=Q;return I};M.getBestDisplayValue=function(H,S,I){var Q="",N=null;b.isArrayLike(I)?N=M.getFieldInfoByFieldName(I,H):"object"===typeof I&&I.name===H&&(N=I);N&&(Q=S[H],"esriFieldTypeDate"===N.type?Q&&(H=new Date(parseInt(Q,10)),Q=M._tryLocaleDate(H)):"number"===typeof Q&&(N.domain&&"codedValue"===N.domain.type?a.some(N.domain.codedValues,
function(T){if(T.code===Q)return Q=T.name,!0}):Q=M._tryLocaleNumber(Q)));if(null===Q||void 0===Q)Q="";return Q};M._tryLocaleNumber=function(H){var S=M.localizeNumber(H);if(null===S||void 0===S)S=H;return S};M._tryLocaleDate=function(H){var S=M.localizeDate(H);S||(S=H.toLocaleDateString());return S};M.getFieldInfoByFieldName=function(H,S){var I=null;H&&0<H.length&&a.some(H,b.hitch(this,function(Q){return Q.name===S?(I=Q,!0):!1}));return I};M.containsNonLatinCharacter=function(H){for(var S=0;S<H.length;S++)if(255<
H.charCodeAt(S))return!0;return!1};M.isVersion4API=function(){return 0===t.version.indexOf("4")};M.getEsriConfig=function(){return r};M.getEsriConfigRequestObject=function(){var H=null;return H=M.isVersion4API()?r.request:r.defaults.io};M.setGlobalGeometryService=function(H){M.isVersion4API()?r.geometryServiceUrl=H:r.defaults.geometryServiceUrl=H;return H};M.getQueryableFeatureLayersFromMap=function(H){var S=[];H.layers&&(S=H.layers.filter(function(I){return"esri.layers.FeatureLayer"===I.declaredClass&&
I.url&&I.supportedQueryFormats&&0<=I.supportedQueryFormats.toUpperCase().indexOf("JSON")}));return S};M.has=function(H){var S=d(H);if(S)return S;if("ie"===H.toLowerCase()){H=0;var I=/MSIE (\d+\.\d+);/.test(navigator.userAgent),Q=!!navigator.userAgent.match(/Trident\/7.0/),N=navigator.userAgent.indexOf("rv:11.0");I&&(H=Number(RegExp.$1));-1!==navigator.appVersion.indexOf("MSIE 10")&&(H=10);Q&&-1!==N&&(H=11);return 11===H&&11||S}if("edge"===H.toLowerCase())return navigator.userAgent.split("Edge/")[1]||
S};M.detectUserAgent=function(){var H={},S={},I=navigator.userAgent,Q=navigator.platform,N=I.match(/Web[kK]it[\/]{0,1}([\d.]+)/),T=I.match(/(Android);?[\s\/]+([\d.]+)?/),aa=!!I.match(/\(Macintosh; Intel /),Z=I.match(/(iPad).*OS\s([\d_]+)/),da=I.match(/(iPod)(.*OS\s([\d_]+))?/),fa=!Z&&I.match(/(iPhone\sOS)\s([\d_]+)/),ka=I.match(/(webOS|hpwOS)[\s\/]([\d.]+)/);Q=/Win\d{2}|Windows/.test(Q);var ha=I.match(/Windows Phone ([\d.]+)/),ba=ka&&I.match(/TouchPad/),ea=I.match(/Kindle\/([\d.]+)/),ca=I.match(/Silk\/([\d._]+)/),
ia=I.match(/(BlackBerry).*Version\/([\d.]+)/),la=I.match(/(BB10).*Version\/([\d.]+)/),oa=I.match(/(RIM\sTablet\sOS)\s([\d.]+)/),na=I.match(/PlayBook/),ra=I.match(/Chrome\/([\d.]+)/)||I.match(/CriOS\/([\d.]+)/),ta=I.match(/Firefox\/([\d.]+)/),ma=I.match(/\((?:Mobile|Tablet); rv:([\d.]+)\).*Firefox\/[\d.]+/),pa=I.match(/MSIE\s([\d.]+)/)||I.match(/Trident\/[\d](?=[^\?]+).*rv:([0-9.].)/),ja=!ra&&I.match(/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/),qa=ja||I.match(/Version\/([\d.]+)([^S](Safari)|[^M]*(Mobile)[^S]*(Safari))/);
S.webkit=!!N;S.webkit&&(S.version=N[1]);T&&(H.android=!0,H.version=T[2]);fa&&!da&&(H.ios=H.iphone=!0,H.version=fa[2].replace(/_/g,"."));Z&&(H.ios=H.ipad=!0,H.version=Z[2].replace(/_/g,"."));da&&(H.ios=H.ipod=!0,H.version=da[3]?da[3].replace(/_/g,"."):null);ha&&(H.wp=!0,H.version=ha[1]);ka&&(H.webos=!0,H.version=ka[2]);ba&&(H.touchpad=!0);ia&&(H.blackberry=!0,H.version=ia[2]);la&&(H.bb10=!0,H.version=la[2]);oa&&(H.rimtabletos=!0,H.version=oa[2]);na&&(S.playbook=!0);ea&&(H.kindle=!0,H.version=ea[1]);
ca&&(S.silk=!0,S.version=ca[1]);!ca&&H.android&&I.match(/Kindle Fire/)&&(S.silk=!0);ra&&(S.chrome=!0,S.version=ra[1]);ta&&(S.firefox=!0,S.version=ta[1]);ma&&(H.firefoxos=!0,H.version=ma[1]);pa&&(S.ie=!0,S.version=pa[1]);qa&&(aa||H.ios||Q)&&(S.safari=!0,H.ios||(S.version=qa[1]));ja&&(S.webview=!0);H.tablet=!!(Z||na||T&&!I.match(/Mobile/)||ta&&I.match(/Tablet/)||pa&&!I.match(/Phone/)&&I.match(/Touch/));H.phone=!(H.tablet||H.ipod||!(T||fa||ka||ia||la||ra&&I.match(/Android/)||ra&&I.match(/CriOS\/([\d.]+)/)||
ta&&I.match(/Mobile/)||pa&&I.match(/Touch/)));return{os:H,browser:S}};M.isMobileUa=function(){var H=M.detectUserAgent();return!0===H.os.phone||!0===H.os.tablet?!0:!1};M.isNeedHttpsButNot=function(){var H=navigator.geolocation,S=window.hasOwnProperty("isSecureContext");return(S&&window.isSecureContext||!S&&"https:"===window.location.protocol)&&H?!1:!0};M.isInConfigOrPreviewWindow=function(){var H=!1;try{H=!window.isBuilder&&window.parent&&window.parent!==window&&window.parent.isBuilder}catch(S){H=
!1}return!!H};M.getAppHref=function(){var H="";return H=M.isInConfigOrPreviewWindow()?window.parent.location.href:window.location.href};M.getAppIdFromUrl=function(){var H=!0,S=M.getAppHref();if(-1!==S.indexOf("id\x3d")||-1!==S.indexOf("appid\x3d")||-1!==S.indexOf("apps"))H=!1;if(!0===H)return S;H=this.urlToObject(window.location.href);if(H.query&&(H.query.id||H.query.appid))return H.query.id||H.query.appid;if(window.appInfo){if(window.appInfo.id)return window.appInfo.id;if(window.appInfo.appPath){if(H=
window.appInfo.appPath.split("/"),H.length&&2<H.length)return H[H.length-2]}else console.error("CAN NOT getAppIdFromUrl")}};M.getEditorContentHeight=function(H,S,I){var Q=new q;this._content=H;this._dom=S;this._domParam=I;var N=setTimeout(b.hitch(this,function(){clearTimeout(N);N=null;var T=0,aa=this._domParam.contentWidth;try{var Z=document.createElement("div");Z.setAttribute("id","fakeContent");c.setStyle(Z,"background-size","contain");Z.innerHTML=this._content;this._dom.appendChild(Z);if(Z){var da=
k("img",Z);if(da&&da.length)for(var fa=0,ka=da.length;fa<ka;fa++)c.setStyle(da[fa],"maxWidth",aa-20+"px");c.setStyle(Z,"position","absolute");c.setStyle(Z,"width",aa+"px");c.setStyle(Z,"left","-99999px");c.setStyle(Z,"top","-99999px");c.setStyle(Z,"visibility","hidden");var ha=c.getContentBox(Z);ha.h&&(T=ha.h,T+=this._domParam.contentMarginTop+this._domParam.footerHeight+8)}}catch(ba){console.error("can't getEditorContentHeight"+ba),T=200}Q.resolve(T)}),1500);return Q};M.getEditorTextColor=function(H,
S){return{name:"dijit.editor.plugins.EditorTextColor",custom:{recordUID:M.getColorRecordName(H),forceAttr:S}}};M.getEditorBackgroundColor=function(H){return{name:"dijit.editor.plugins.EditorBackgroundColor",custom:{recordUID:M.getColorRecordName(H)}}};M.getColorRecordName=function(H){return"wab_cr_"+(H||"")};M.isEsriDomain=function(H){return/^https?:\/\/(?:[\w\-_]+\.)+(?:esri|arcgis)\.com/.test(H)};M.b64toBlob=function(H,S,I){S=S||"";I=I||512;H=window.atob(H.replace(/^data:image\/(png|jpg|jpeg|gif);base64,/,
""));for(var Q=[],N=0;N<H.length;N+=I){for(var T=H.slice(N,N+I),aa=Array(T.length),Z=0;Z<T.length;Z++)aa[Z]=T.charCodeAt(Z);T=new Uint8Array(aa);Q.push(T)}return new Blob(Q,{type:S})};M.subtractionArray=function(H,S){for(var I=H.length-1;0<=I;I--)for(var Q=H[I],N=S.length-1;0<=N;N--)if(Q===S[N]){H.splice(I,1);S.splice(N,1);break}return H};M.resourcesUrlToBlob=function(H){return K({url:H,handleAs:"blob"})};M.processItemResourceOfAppConfig=function(H,S){function I(da){var fa=da.obj,ka=da.key,ha={obj:fa,
key:ka};"number"===typeof da.i?(ha.i=da.i,ha.value=fa[ka][da.i]):ha.value=fa[ka];return ha}function Q(da){for(var fa in da)if("object"===typeof da[fa])if(Array.isArray(da[fa]))for(var ka=da,ha=fa,ba=0;ba<ka[ha].length;ba++)"string"===typeof ka[ha][ba]?N(ka,ha,ba):"object"===typeof ka[ha][ba]&&Q(ka[ha][ba]);else Q(da[fa]);else"string"===typeof da[fa]&&N(da,fa)}function N(da,fa,ka){"number"===typeof ka?S.test(da[fa][ka])&&(Z=S.func(I({obj:da,key:fa,i:ka})),"function"===typeof Z.then?aa.push(Z):T.push(Z)):
S.test(da[fa])&&(Z=S.func(I({obj:da,key:fa})),"function"===typeof Z.then?aa.push(Z):T.push(Z))}var T=[],aa=[],Z;Q(H);return 0<aa.length?e(aa).then(function(da){0<T.length&&(da=da.concat(T));return{appConfig:H,result:da}}):{appConfig:H,result:T}};M.isDefined=function(H){return void 0!==H&&null!==H};M.getDefaultPopupInfo=function(H,S,I){var Q=null;H&&H.fields&&(Q={title:S,fieldInfos:[],description:null,showAttachments:!0,mediaInfos:[]},a.forEach(H.fields,function(N){var T=!1;I?a.some(I,b.hitch(this,
function(aa){return aa&&N.name.toLowerCase()===aa.toLowerCase()}))&&(T=!0):T=!0;T&&(T=this.getDefaultPortalFieldInfo(N),T.visible=!0,T.isEditable=N.editable,Q.fieldInfos.push(T))},this));return Q};M.getDefaultPortalFieldInfo=function(H){var S=H.name;S={fieldName:S,label:H.alias||S,tooltip:"",visible:!1,format:null,stringFieldOption:"textbox"};switch(H.type){case "esriFieldTypeSmallInteger":case "esriFieldTypeInteger":S.format={places:0,digitSeparator:!0};break;case "esriFieldTypeSingle":case "esriFieldTypeDouble":S.format=
{places:2,digitSeparator:!0};break;case "esriFieldTypeDate":S.format={dateFormat:"longMonthDayYear"}}return S};M.getStyleColorInTheme=function(H){var S=new q;if(window&&window.isBuilder){var I="./stemapp3d/themes/";var Q=window.appConfig}else I="./themes/",Q=window.getAppConfig();if(Q&&Q.theme.customStyles&&Q.theme.customStyles.mainBackgroundColor)return S.resolve(Q.theme.customStyles.mainBackgroundColor),S.promise;var N=Q.theme.name,T=Q.theme.styles[0];H&&(T=H);K(I+N+"/manifest.json",{responseType:"json"}).then(b.hitch(this,
function(aa){if(aa&&aa.data){aa=aa.data.styles;for(var Z=0;Z<aa.length;Z++){var da=aa[Z];da.name===T&&S.resolve(da.styleColor)}}}),b.hitch(this,function(aa){console.error(aa);S.reject(null)}));return S.promise};M.dynamicLinkXssFilter=function(H){return H.toLowerCase().trim().startsWith("javascript:")?H.substring(11):H};return M})},"dojo/NodeList-traverse":function(){define(["./query","./_base/lang","./_base/array"],function(b,a,c){var d=b.NodeList;a.extend(d,{_buildArrayFromCallback:function(f){for(var n=
[],k=0;k<this.length;k++){var g=f.call(this[k],this[k],n);g&&(n=n.concat(g))}return n},_getUniqueAsNodeList:function(f){for(var n=[],k=0,g;g=f[k];k++)1==g.nodeType&&-1==c.indexOf(n,g)&&n.push(g);return this._wrap(n,null,this._NodeListCtor)},_getUniqueNodeListWithParent:function(f,n){f=this._getUniqueAsNodeList(f);f=n?b._filterResult(f,n):f;return f._stash(this)},_getRelatedUniqueNodes:function(f,n){return this._getUniqueNodeListWithParent(this._buildArrayFromCallback(n),f)},children:function(f){return this._getRelatedUniqueNodes(f,
function(n,k){return a._toArray(n.childNodes)})},closest:function(f,n){return this._getRelatedUniqueNodes(null,function(k,g){do if(b._filterResult([k],f,n).length)return k;while(k!=n&&(k=k.parentNode)&&1==k.nodeType);return null})},parent:function(f){return this._getRelatedUniqueNodes(f,function(n,k){return n.parentNode})},parents:function(f){return this._getRelatedUniqueNodes(f,function(n,k){for(k=[];n.parentNode;)n=n.parentNode,k.push(n);return k})},siblings:function(f){return this._getRelatedUniqueNodes(f,
function(n,k){k=[];for(var g=n.parentNode&&n.parentNode.childNodes,q=0;q<g.length;q++)g[q]!=n&&k.push(g[q]);return k})},next:function(f){return this._getRelatedUniqueNodes(f,function(n,k){for(n=n.nextSibling;n&&1!=n.nodeType;)n=n.nextSibling;return n})},nextAll:function(f){return this._getRelatedUniqueNodes(f,function(n,k){for(k=[];n=n.nextSibling;)1==n.nodeType&&k.push(n);return k})},prev:function(f){return this._getRelatedUniqueNodes(f,function(n,k){for(n=n.previousSibling;n&&1!=n.nodeType;)n=n.previousSibling;
return n})},prevAll:function(f){return this._getRelatedUniqueNodes(f,function(n,k){for(k=[];n=n.previousSibling;)1==n.nodeType&&k.push(n);return k})},andSelf:function(){return this.concat(this._parent)},first:function(){return this._wrap(this[0]&&[this[0]]||[],this)},last:function(){return this._wrap(this.length?[this[this.length-1]]:[],this)},even:function(){return this.filter(function(f,n){return 0!=n%2})},odd:function(){return this.filter(function(f,n){return 0==n%2})}});return d})},"dojo/promise/all":function(){define(["../_base/array",
"../_base/lang","../Deferred","../when"],function(b,a,c,d){var f=b.some;return function(n){var k,g;a.isArray(n)?g=n:n&&"object"===typeof n&&(k=n);var q=[];if(k){g=[];for(var e in k)Object.hasOwnProperty.call(k,e)&&(q.push(e),g.push(k[e]));var m={}}else g&&(m=[]);if(!g||!g.length)return(new c).resolve(m);var l=new c;l.promise.always(function(){m=q=null});var w=g.length;f(g,function(v,x){k||q.push(x);d(v,function(p){l.isFulfilled()||(m[q[x]]=p,0===--w&&l.resolve(m))},l.reject);return l.isFulfilled()});
return l.promise}})},"dojo/cookie":function(){define(["./_base/kernel","./regexp"],function(b,a){b.cookie=function(c,d,f){var n=document.cookie;if(1==arguments.length)var k=(k=n.match(new RegExp("(?:^|; )"+a.escapeString(c)+"\x3d([^;]*)")))?decodeURIComponent(k[1]):void 0;else{f=f||{};n=f.expires;if("number"==typeof n){var g=new Date;g.setTime(g.getTime()+864E5*n);n=f.expires=g}n&&n.toUTCString&&(f.expires=n.toUTCString());d=encodeURIComponent(d);n=c+"\x3d"+d;for(var q in f)n+="; "+q,g=f[q],!0!==
g&&(n+="\x3d"+g);document.cookie=n}return k};b.cookie.isSupported=function(){"cookieEnabled"in navigator||(this("__djCookieTest__","CookiesAllowed"),navigator.cookieEnabled="CookiesAllowed"==this("__djCookieTest__"),navigator.cookieEnabled&&this("__djCookieTest__","",{expires:-1}));return navigator.cookieEnabled};return b.cookie})},"dojo/regexp":function(){define(["./_base/kernel","./_base/lang"],function(b,a){var c={};a.setObject("dojo.regexp",c);c.escapeString=function(d,f){return d.replace(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,
function(n){return f&&-1!=f.indexOf(n)?n:"\\"+n})};c.buildGroupRE=function(d,f,n){if(!(d instanceof Array))return f(d);for(var k=[],g=0;g<d.length;g++)k.push(f(d[g]));return c.group(k.join("|"),n)};c.group=function(d,f){return"("+(f?"?:":"")+d+")"};return c})},"dojo/number":function(){define(["./_base/lang","./i18n","./i18n!./cldr/nls/number","./string","./regexp"],function(b,a,c,d,f){var n={};b.setObject("dojo.number",n);n.format=function(g,q){q=b.mixin({},q||{});var e=a.normalizeLocale(q.locale);
e=a.getLocalization("dojo.cldr","number",e);q.customs=e;e=q.pattern||e[(q.type||"decimal")+"Format"];return isNaN(g)||Infinity==Math.abs(g)?null:n._applyPattern(g,e,q)};n._numberPatternRE=/[#0,]*[#0](?:\.0*#*)?/;n._applyPattern=function(g,q,e){e=e||{};var m=e.customs.group,l=e.customs.decimal;q=q.split(";");var w=q[0];q=q[0>g?1:0]||"-"+w;if(-1!=q.indexOf("%"))g*=100;else if(-1!=q.indexOf("\u2030"))g*=1E3;else if(-1!=q.indexOf("\u00a4"))m=e.customs.currencyGroup||m,l=e.customs.currencyDecimal||l,q=
q.replace(/([\s\xa0\u202f]*)(\u00a4{1,3})([\s\xa0\u202f]*)/,function(x,p,h,t){return(x=e[["symbol","currency","displayName"][h.length-1]]||e.currency||"")?p+x+t:""});else if(-1!=q.indexOf("E"))throw Error("exponential notation not supported");var v=n._numberPatternRE;w=w.match(v);if(!w)throw Error("unable to find a number expression in pattern: "+q);!1===e.fractional&&(e.places=0);return q.replace(v,n._formatAbsolute(g,w[0],{decimal:l,group:m,places:e.places,round:e.round}))};n.round=function(g,q,
e){e=10/(e||10);return(e*+g).toFixed(q)/e};if(0==(.9).toFixed()){var k=n.round;n.round=function(g,q,e){var m=Math.pow(10,-q||0),l=Math.abs(g);if(!g||l>=m)m=0;else if(l/=m,.5>l||.95<=l)m=0;return k(g,q,e)+(0<g?m:-m)}}n._formatAbsolute=function(g,q,e){e=e||{};!0===e.places&&(e.places=0);Infinity===e.places&&(e.places=6);q=q.split(".");var m="string"==typeof e.places&&e.places.indexOf(","),l=e.places;m?l=e.places.substring(m+1):0<=l||(l=(q[1]||[]).length);0>e.round||(g=n.round(g,l,e.round));g=String(Math.abs(g)).split(".");
var w=g[1]||"";q[1]||e.places?(m&&(e.places=e.places.substring(0,m)),m=void 0!==e.places?e.places:q[1]&&q[1].lastIndexOf("0")+1,m>w.length&&(g[1]=d.pad(w,m,"0",!0)),l<w.length&&(g[1]=w.substr(0,l))):g[1]&&g.pop();l=q[0].replace(",","");m=l.indexOf("0");-1!=m&&(m=l.length-m,m>g[0].length&&(g[0]=d.pad(g[0],m)),-1==l.indexOf("#")&&(g[0]=g[0].substr(g[0].length-m)));l=q[0].lastIndexOf(",");var v;if(-1!=l){var x=q[0].length-l-1;q=q[0].substr(0,l);l=q.lastIndexOf(",");-1!=l&&(v=q.length-l-1)}q=[];for(l=
g[0];l;)m=l.length-x,q.push(0<m?l.substr(m):l),l=0<m?l.slice(0,m):"",v&&(x=v,v=void 0);g[0]=q.reverse().join(e.group||",");return g.join(e.decimal||".")};n.regexp=function(g){return n._parseInfo(g).regexp};n._parseInfo=function(g){g=g||{};var q=a.normalizeLocale(g.locale);q=a.getLocalization("dojo.cldr","number",q);var e=g.pattern||q[(g.type||"decimal")+"Format"],m=q.group,l=q.decimal,w=1;if(-1!=e.indexOf("%"))w/=100;else if(-1!=e.indexOf("\u2030"))w/=1E3;else{var v=-1!=e.indexOf("\u00a4");v&&(m=
q.currencyGroup||m,l=q.currencyDecimal||l)}q=e.split(";");1==q.length&&q.push("-"+q[0]);q=f.buildGroupRE(q,function(x){x="(?:"+f.escapeString(x,".")+")";return x.replace(n._numberPatternRE,function(p){var h={signed:!1,separator:g.strict?m:[m,""],fractional:g.fractional,decimal:l,exponent:!1};p=p.split(".");var t=g.places;1==p.length&&1!=w&&(p[1]="###");1==p.length||0===t?h.fractional=!1:(void 0===t&&(t=g.pattern?p[1].lastIndexOf("0")+1:Infinity),t&&void 0==g.fractional&&(h.fractional=!0),!g.places&&
t<p[1].length&&(t+=","+p[1].length),h.places=t);p=p[0].split(",");1<p.length&&(h.groupSize=p.pop().length,1<p.length&&(h.groupSize2=p.pop().length));return"("+n._realNumberRegexp(h)+")"})},!0);v&&(q=q.replace(/([\s\xa0\u202f]*)(\u00a4{1,3})([\s\xa0\u202f]*)/g,function(x,p,h,t){x=f.escapeString(g[["symbol","currency","displayName"][h.length-1]]||g.currency||"");if(!x)return"";p=p?"[\\s\\xa0\\u202f]":"";t=t?"[\\s\\xa0\\u202f]":"";return g.strict?p+x+t:(p&&(p+="*"),t&&(t+="*"),"(?:"+p+x+t+")?")}));return{regexp:q.replace(/[\xa0\u202f ]/g,
"[\\s\\xa0\\u202f]"),group:m,decimal:l,factor:w}};n.parse=function(g,q){q=n._parseInfo(q);g=(new RegExp("^"+q.regexp+"$")).exec(g);if(!g)return NaN;var e=g[1];if(!g[1]){if(!g[2])return NaN;e=g[2];q.factor*=-1}e=e.replace(new RegExp("["+q.group+"\\s\\xa0\\u202f]","g"),"").replace(q.decimal,".");return e*q.factor};n._realNumberRegexp=function(g){g=g||{};"places"in g||(g.places=Infinity);"string"!=typeof g.decimal&&(g.decimal=".");"fractional"in g&&!/^0/.test(g.places)||(g.fractional=[!0,!1]);"exponent"in
g||(g.exponent=[!0,!1]);"eSigned"in g||(g.eSigned=[!0,!1]);var q=n._integerRegexp(g),e=f.buildGroupRE(g.fractional,function(l){var w="";l&&0!==g.places&&(w="\\"+g.decimal,w=Infinity==g.places?"(?:"+w+"\\d+)?":w+("\\d{"+g.places+"}"));return w},!0),m=f.buildGroupRE(g.exponent,function(l){return l?"([eE]"+n._integerRegexp({signed:g.eSigned})+")":""});q+=e;e&&(q="(?:(?:"+q+")|(?:"+e+"))");return q+m};n._integerRegexp=function(g){g=g||{};"signed"in g||(g.signed=[!0,!1]);"separator"in g?"groupSize"in g||
(g.groupSize=3):g.separator="";var q=f.buildGroupRE(g.signed,function(m){return m?"[-+]":""},!0),e=f.buildGroupRE(g.separator,function(m){if(!m)return"(?:\\d+)";m=f.escapeString(m);" "==m?m="\\s":"\u00a0"==m?m="\\s\\xa0":"\u202f"==m&&(m="\\s\\u202f");var l=g.groupSize,w=g.groupSize2;return w?(m="(?:0|[1-9]\\d{0,"+(w-1)+"}(?:["+m+"]\\d{"+w+"})*["+m+"]\\d{"+l+"})",0<l-w?"(?:"+m+"|(?:0|[1-9]\\d{0,"+(l-1)+"}))":m):"(?:0|[1-9]\\d{0,"+(l-1)+"}(?:["+m+"]\\d{"+l+"})*)"},!0);return q+e};return n})},"dojo/i18n":function(){define("./_base/kernel require ./has ./_base/array ./_base/config ./_base/lang ./has!host-browser?./_base/xhr ./json module".split(" "),
function(b,a,c,d,f,n,k,g,q){c.add("dojo-preload-i18n-Api",1);k=b.i18n={};var e=/(^.*(^|\/)nls)(\/|$)([^\/]*)\/?([^\/]*)/,m=function(C,E,B,D){var F=[B+D];E=E.split("-");for(var K="",L=0;L<E.length;L++)if(K+=(K?"-":"")+E[L],!C||C[K])F.push(B+K+"/"+D),F.specificity=K;return F},l={},w=function(C,E,B){B=B?B.toLowerCase():b.locale;C=C.replace(/\./g,"/");E=E.replace(/\./g,"/");return/root/i.test(B)?C+"/nls/"+E:C+"/nls/"+B+"/"+E},v=b.getL10nName=function(C,E,B){return C=q.id+"!"+w(C,E,B)},x=function(C,E,
B,D,F,K){C([E],function(L){var G=n.clone(L.root||L.ROOT),O=m(!L._v1x&&L,F,B,D);C(O,function(){for(var P=1;P<O.length;P++)G=n.mixin(n.clone(G),arguments[P]);l[E+"/"+F]=G;G.$locale=O.specificity;K()})})},p=function(C){var E=f.extraLocale||[];E=n.isArray(E)?E:[E];E.push(C);return E},h=function(C,E,B){var D=e.exec(C),F=D[1]+"/",K=D[5]||D[4],L=F+K,G=(D=D[5]&&D[4])||b.locale||"",O=L+"/"+G;D=D?[G]:p(G);var P=D.length,J=function(){--P||B(n.delegate(l[O]))};G=C.split("*");var R="preload"==G[1];if(c("dojo-preload-i18n-Api")){if(R&&
(l[C]||(l[C]=1,y(G[2],g.parse(G[3]),1,E)),B(1)),(G=R)||(r&&u.push([C,E,B]),G=r&&!l[O]),G)return}else if(R){B(1);return}d.forEach(D,function(X){var U=L+"/"+X;c("dojo-preload-i18n-Api")&&z(U);l[U]?J():x(E,L,F,K,X,J)})};c("dojo-preload-i18n-Api");var t=k.normalizeLocale=function(C){C=C?C.toLowerCase():b.locale;return"root"==C?"ROOT":C},r=0,u=[],y=k._preloadLocalizations=function(C,E,B,D){function F(O,P){D([O],P)}function K(O,P){for(O=O.split("-");O.length;){if(P(O.join("-")))return;O.pop()}P("ROOT")}
function L(){for(--r;!r&&u.length;)h.apply(null,u.shift())}function G(O){O=t(O);K(O,function(P){if(0<=d.indexOf(E,P)){var J=C.replace(/\./g,"/")+"_"+P;r++;F(J,function(R){for(var X in R){var U=R[X],M=X.match(/(.+)\/([^\/]+)$/);if(M){var V=M[2];M=M[1]+"/";if(U._localized){var Y;if("ROOT"===P){var W=Y=U._localized;delete U._localized;W.root=U;l[a.toAbsMid(X)]=W}else Y=U._localized,l[a.toAbsMid(M+V+"/"+P)]=U;P!==O&&function(H,S,I,Q){var N=[],T=[];K(O,function(aa){Q[aa]&&(N.push(a.toAbsMid(H+aa+"/"+S)),
T.push(a.toAbsMid(H+S+"/"+aa)))});N.length?(r++,D(N,function(){for(var aa=N.length-1;0<=aa;aa--)I=n.mixin(n.clone(I),arguments[aa]),l[T[aa]]=I;l[a.toAbsMid(H+S+"/"+O)]=n.clone(I);L()})):l[a.toAbsMid(H+S+"/"+O)]=I}(M,V,U,Y)}}}L()});return!0}return!1})}D=D||a;G();d.forEach(b.config.extraLocale,G)},z=function(){},A={};z=function(C){for(var E,B=C.split("/"),D=b.global[B[0]],F=1;D&&F<B.length-1;D=D[B[F++]]);D&&((E=D[B[F]])||(E=D[B[F].replace(/-/g,"_")]),E&&(l[C]=E));return E};k.getLocalization=function(C,
E,B){var D,F=w(C,E,B);if(A[F])return A[F];h(F,a,function(K){D=A[F]=K});return D};return n.mixin(k,{dynamic:!0,normalize:function(C,E){return/^\./.test(C)?E(C):C},load:h,cache:l,getL10nName:v})})},"dojo/date/locale":function(){define("../_base/lang ../_base/array ../date ../cldr/supplemental ../i18n ../regexp ../string ../i18n!../cldr/nls/gregorian module".split(" "),function(b,a,c,d,f,n,k,g,q){function e(h,t,r,u){return u.replace(/([a-z])\1*/ig,function(y){var z=y.charAt(0);y=y.length;var A=["abbr",
"wide","narrow"];switch(z){case "G":var C=t[4>y?"eraAbbr":"eraNames"][0>h.getFullYear()?0:1];break;case "y":C=h.getFullYear();switch(y){case 1:break;case 2:if(!r.fullYear){C=String(C);C=C.substr(C.length-2);break}default:var E=!0}break;case "Q":case "q":C=Math.ceil((h.getMonth()+1)/3);E=!0;break;case "M":case "L":C=h.getMonth();3>y?(C+=1,E=!0):(z=["months","L"==z?"standAlone":"format",A[y-3]].join("-"),C=t[z][C]);break;case "w":C=w._getWeekOfYear(h,0);E=!0;break;case "d":C=h.getDate();E=!0;break;
case "D":C=w._getDayOfYear(h);E=!0;break;case "e":case "c":if(C=h.getDay(),2>y){C=(C-d.getFirstDayOfWeek(r.locale)+8)%7;break}case "E":C=h.getDay();3>y?(C+=1,E=!0):(z=["days","c"==z?"standAlone":"format",A[y-3]].join("-"),C=t[z][C]);break;case "a":z=12>h.getHours()?"am":"pm";C=r[z]||t["dayPeriods-format-wide-"+z];break;case "h":case "H":case "K":case "k":E=h.getHours();switch(z){case "h":C=E%12||12;break;case "H":C=E;break;case "K":C=E%12;break;case "k":C=E||24}E=!0;break;case "m":C=h.getMinutes();
E=!0;break;case "s":C=h.getSeconds();E=!0;break;case "S":C=Math.round(h.getMilliseconds()*Math.pow(10,y-3));E=!0;break;case "v":case "z":if(C=w._getZone(h,!0,r))break;y=4;case "Z":z=w._getZone(h,!1,r);z=[0>=z?"+":"-",k.pad(Math.floor(Math.abs(z)/60),2),k.pad(Math.abs(z)%60,2)];4==y&&(z.splice(0,0,"GMT"),z.splice(3,0,":"));C=z.join("");break;default:throw Error("dojo.date.locale.format: invalid pattern char: "+u);}E&&(C=k.pad(C,y));return C})}function m(h,t,r,u){var y=function(C){return C};t=t||y;
r=r||y;u=u||y;var z=h.match(/(''|[^'])+/g),A="'"==h.charAt(0);a.forEach(z,function(C,E){C?(z[E]=(A?r:t)(C.replace(/''/g,"'")),A=!A):z[E]=""});return u(z.join(""))}function l(h,t,r,u){u=n.escapeString(u);r.strict||(u=u.replace(" a"," ?a"));return u.replace(/([a-z])\1*/ig,function(y){var z=y.charAt(0);var A=y.length,C="",E="";r.strict?(1<A&&(C="0{"+(A-1)+"}"),2<A&&(E="0{"+(A-2)+"}")):(C="0?",E="0{0,2}");switch(z){case "y":z="\\d{2,4}";break;case "M":case "L":2<A?(z=t["months-"+("L"==z?"standAlone":
"format")+"-"+v[A-3]].slice(0).join("|"),r.strict||(z=z.replace(/\./g,""),z="(?:"+z+")\\.?")):z="1[0-2]|"+C+"[1-9]";break;case "D":z="[12][0-9][0-9]|3[0-5][0-9]|36[0-6]|"+C+"[1-9][0-9]|"+E+"[1-9]";break;case "d":z="3[01]|[12]\\d|"+C+"[1-9]";break;case "w":z="[1-4][0-9]|5[0-3]|"+C+"[1-9]";break;case "E":case "e":case "c":z=".+?";break;case "h":z="1[0-2]|"+C+"[1-9]";break;case "k":z="1[01]|"+C+"\\d";break;case "H":z="1\\d|2[0-3]|"+C+"\\d";break;case "K":z="1\\d|2[0-4]|"+C+"[1-9]";break;case "m":case "s":z=
"[0-5]\\d";break;case "S":z="\\d{"+A+"}";break;case "a":A=r.am||t["dayPeriods-format-wide-am"];C=r.pm||t["dayPeriods-format-wide-pm"];z=A+"|"+C;r.strict||(A!=A.toLowerCase()&&(z+="|"+A.toLowerCase()),C!=C.toLowerCase()&&(z+="|"+C.toLowerCase()),-1!=z.indexOf(".")&&(z+="|"+z.replace(/\./g,"")));z=z.replace(/\./g,"\\.");break;default:z=".*"}h&&h.push(y);return"("+z+")"}).replace(/[\xa0 ]/g,"[\\s\\xa0]")}var w={};b.setObject(q.id.replace(/\//g,"."),w);w._getZone=function(h,t,r){return t?c.getTimezoneName(h):
h.getTimezoneOffset()};w.format=function(h,t){t=t||{};var r=f.normalizeLocale(t.locale),u=t.formatLength||"short";r=w._getGregorianBundle(r);var y=[];h=b.hitch(this,e,h,r,t);if("year"==t.selector)return m(r["dateFormatItem-yyyy"]||"yyyy",h);var z;"date"!=t.selector&&(z=t.timePattern||r["timeFormat-"+u])&&y.push(m(z,h));"time"!=t.selector&&(z=t.datePattern||r["dateFormat-"+u])&&y.push(m(z,h));return 1==y.length?y[0]:r["dateTimeFormat-"+u].replace(/'/g,"").replace(/\{(\d+)\}/g,function(A,C){return y[C]})};
w.regexp=function(h){return w._parseInfo(h).regexp};w._parseInfo=function(h){h=h||{};var t=f.normalizeLocale(h.locale);t=w._getGregorianBundle(t);var r=h.formatLength||"short",u=h.datePattern||t["dateFormat-"+r],y=h.timePattern||t["timeFormat-"+r];r="date"==h.selector?u:"time"==h.selector?y:t["dateTimeFormat-"+r].replace(/\{(\d+)\}/g,function(A,C){return[y,u][C]});var z=[];return{regexp:m(r,b.hitch(this,l,z,t,h)),tokens:z,bundle:t}};w.parse=function(h,t){var r=/[\u200E\u200F\u202A\u202E]/g,u=w._parseInfo(t),
y=u.tokens,z=u.bundle;h=(new RegExp("^"+u.regexp.replace(r,"")+"$",u.strict?"":"i")).exec(h&&h.replace(r,""));if(!h)return null;var A=["abbr","wide","narrow"],C=[1970,0,1,0,0,0,0],E="";h=a.every(h,function(D,F){if(!F)return!0;var K=y[F-1];F=K.length;K=K.charAt(0);switch(K){case "y":if(2!=F&&t.strict)C[0]=D;else if(100>D)D=Number(D),K=""+(new Date).getFullYear(),F=100*K.substring(0,2),K=Math.min(Number(K.substring(2,4))+20,99),C[0]=D<K?F+D:F-100+D;else{if(t.strict)return!1;C[0]=D}break;case "M":case "L":if(2<
F){if(F=z["months-"+("L"==K?"standAlone":"format")+"-"+A[F-3]].concat(),t.strict||(D=D.replace(".","").toLowerCase(),F=a.map(F,function(G){return G.replace(".","").toLowerCase()})),D=a.indexOf(F,D),-1==D)return!1}else D--;C[1]=D;break;case "E":case "e":case "c":F=z["days-"+("c"==K?"standAlone":"format")+"-"+A[F-3]].concat();t.strict||(D=D.toLowerCase(),F=a.map(F,function(G){return G.toLowerCase()}));D=a.indexOf(F,D);if(-1==D)return!1;break;case "D":C[1]=0;case "d":C[2]=D;break;case "a":F=t.am||z["dayPeriods-format-wide-am"];
K=t.pm||z["dayPeriods-format-wide-pm"];if(!t.strict){var L=/\./g;D=D.replace(L,"").toLowerCase();F=F.replace(L,"").toLowerCase();K=K.replace(L,"").toLowerCase()}if(t.strict&&D!=F&&D!=K)return!1;E=D==K?"p":D==F?"a":"";break;case "K":24==D&&(D=0);case "h":case "H":case "k":if(23<D)return!1;C[3]=D;break;case "m":C[4]=D;break;case "s":C[5]=D;break;case "S":C[6]=D}return!0});r=+C[3];"p"===E&&12>r?C[3]=r+12:"a"===E&&12==r&&(C[3]=0);r=new Date(C[0],C[1],C[2],C[3],C[4],C[5],C[6]);t.strict&&r.setFullYear(C[0]);
var B=y.join("");u=-1!=B.indexOf("d");B=-1!=B.indexOf("M");if(!h||B&&r.getMonth()>C[1]||u&&r.getDate()>C[2])return null;if(B&&r.getMonth()<C[1]||u&&r.getDate()<C[2])r=c.add(r,"hour",1);return r};var v=["abbr","wide","narrow"],x=[],p={};w.addCustomFormats=function(h,t){x.push({pkg:h,name:t});p={}};w._getGregorianBundle=function(h){if(p[h])return p[h];var t={};a.forEach(x,function(r){r=f.getLocalization(r.pkg,r.name,h);t=b.mixin(t,r)},this);return p[h]=t};w.addCustomFormats(q.id.replace(/\/date\/locale$/,
".cldr"),"gregorian");w.getNames=function(h,t,r,u){u=w._getGregorianBundle(u);h=[h,r,t];if("standAlone"==r){r=h.join("-");var y=u[r];1==y[0]&&(y=void 0)}h[1]="format";return(y||u[h.join("-")]).concat()};w.isWeekend=function(h,t){t=d.getWeekend(t);h=(h||new Date).getDay();t.end<t.start&&(t.end+=7,h<t.start&&(h+=7));return h>=t.start&&h<=t.end};w._getDayOfYear=function(h){return c.difference(new Date(h.getFullYear(),0,1,h.getHours()),h)+1};w._getWeekOfYear=function(h,t){1==arguments.length&&(t=0);var r=
(new Date(h.getFullYear(),0,1)).getDay(),u=(r-t+7)%7;u=Math.floor((w._getDayOfYear(h)+u-1)/7);r==t&&u++;return u};return w})},"dojo/date":function(){define(["./has","./_base/lang"],function(b,a){var c={getDaysInMonth:function(d){var f=d.getMonth();return 1==f&&c.isLeapYear(d)?29:[31,28,31,30,31,30,31,31,30,31,30,31][f]},isLeapYear:function(d){d=d.getFullYear();return!(d%400)||!(d%4)&&!!(d%100)},getTimezoneName:function(d){var f=d.toString(),n="",k=f.indexOf("(");if(-1<k)n=f.substring(++k,f.indexOf(")"));
else if(k=/([A-Z\/]+) \d{4}$/,f=f.match(k))n=f[1];else if(f=d.toLocaleString(),k=/ ([A-Z\/]+)$/,f=f.match(k))n=f[1];return"AM"==n||"PM"==n?"":n},compare:function(d,f,n){d=new Date(+d);f=new Date(+(f||new Date));"date"==n?(d.setHours(0,0,0,0),f.setHours(0,0,0,0)):"time"==n&&(d.setFullYear(0,0,0),f.setFullYear(0,0,0));return d>f?1:d<f?-1:0},add:function(d,f,n){var k=new Date(+d),g=!1,q="Date";switch(f){case "day":break;case "weekday":if(f=n%5)var e=parseInt(n/5);else f=0<n?5:-5,e=0<n?(n-5)/5:(n+5)/
5;var m=d.getDay(),l=0;6==m&&0<n?l=1:0==m&&0>n&&(l=-1);m+=f;if(0==m||6==m)l=0<n?2:-2;n=7*e+f+l;break;case "year":q="FullYear";g=!0;break;case "week":n*=7;break;case "quarter":n*=3;case "month":g=!0;q="Month";break;default:q="UTC"+f.charAt(0).toUpperCase()+f.substring(1)+"s"}if(q)k["set"+q](k["get"+q]()+n);g&&k.getDate()<d.getDate()&&k.setDate(0);return k},difference:function(d,f,n){f=f||new Date;n=n||"day";var k=f.getFullYear()-d.getFullYear(),g=1;switch(n){case "quarter":d=d.getMonth();f=f.getMonth();
g=Math.floor(f/3)+1+4*k-(Math.floor(d/3)+1);break;case "weekday":k=Math.round(c.difference(d,f,"day"));n=parseInt(c.difference(d,f,"week"));if(0==k%7)k=5*n;else{g=0;var q=d.getDay(),e=f.getDay();n=parseInt(k/7);f=k%7;d=new Date(d);d.setDate(d.getDate()+7*n);d=d.getDay();if(0<k)switch(!0){case 6==q:g=-1;break;case 0==q:g=0;break;case 6==e:g=-1;break;case 0==e:g=-2;break;case 5<d+f:g=-2}else if(0>k)switch(!0){case 6==q:g=0;break;case 0==q:g=1;break;case 6==e:g=2;break;case 0==e:g=1;break;case 0>d+f:g=
2}k=k+g-2*n}g=k;break;case "year":g=k;break;case "month":g=f.getMonth()-d.getMonth()+12*k;break;case "week":g=parseInt(c.difference(d,f,"day")/7);break;case "day":g/=24;case "hour":g/=60;case "minute":g/=60;case "second":g/=1E3;case "millisecond":g*=f.getTime()-d.getTime()}return Math.round(g)}};a.mixin(a.getObject("dojo.date",!0),c);return c})},"dojo/cldr/supplemental":function(){define(["../_base/lang","../i18n"],function(b,a){var c={};b.setObject("dojo.cldr.supplemental",c);c.getFirstDayOfWeek=
function(d){d={bd:5,mv:5,ae:6,af:6,bh:6,dj:6,dz:6,eg:6,iq:6,ir:6,jo:6,kw:6,ly:6,ma:6,om:6,qa:6,sa:6,sd:6,sy:6,ye:6,ag:0,ar:0,as:0,au:0,br:0,bs:0,bt:0,bw:0,by:0,bz:0,ca:0,cn:0,co:0,dm:0,"do":0,et:0,gt:0,gu:0,hk:0,hn:0,id:0,ie:0,il:0,"in":0,jm:0,jp:0,ke:0,kh:0,kr:0,la:0,mh:0,mm:0,mo:0,mt:0,mx:0,mz:0,ni:0,np:0,nz:0,pa:0,pe:0,ph:0,pk:0,pr:0,py:0,sg:0,sv:0,th:0,tn:0,tt:0,tw:0,um:0,us:0,ve:0,vi:0,ws:0,za:0,zw:0}[c._region(d)];return void 0===d?1:d};c._region=function(d){d=a.normalizeLocale(d);d=d.split("-");
var f=d[1];f?4==f.length&&(f=d[2]):f={aa:"et",ab:"ge",af:"za",ak:"gh",am:"et",ar:"eg",as:"in",av:"ru",ay:"bo",az:"az",ba:"ru",be:"by",bg:"bg",bi:"vu",bm:"ml",bn:"bd",bo:"cn",br:"fr",bs:"ba",ca:"es",ce:"ru",ch:"gu",co:"fr",cr:"ca",cs:"cz",cv:"ru",cy:"gb",da:"dk",de:"de",dv:"mv",dz:"bt",ee:"gh",el:"gr",en:"us",es:"es",et:"ee",eu:"es",fa:"ir",ff:"sn",fi:"fi",fj:"fj",fo:"fo",fr:"fr",fy:"nl",ga:"ie",gd:"gb",gl:"es",gn:"py",gu:"in",gv:"gb",ha:"ng",he:"il",hi:"in",ho:"pg",hr:"hr",ht:"ht",hu:"hu",hy:"am",
ia:"fr",id:"id",ig:"ng",ii:"cn",ik:"us","in":"id",is:"is",it:"it",iu:"ca",iw:"il",ja:"jp",ji:"ua",jv:"id",jw:"id",ka:"ge",kg:"cd",ki:"ke",kj:"na",kk:"kz",kl:"gl",km:"kh",kn:"in",ko:"kr",ks:"in",ku:"tr",kv:"ru",kw:"gb",ky:"kg",la:"va",lb:"lu",lg:"ug",li:"nl",ln:"cd",lo:"la",lt:"lt",lu:"cd",lv:"lv",mg:"mg",mh:"mh",mi:"nz",mk:"mk",ml:"in",mn:"mn",mo:"ro",mr:"in",ms:"my",mt:"mt",my:"mm",na:"nr",nb:"no",nd:"zw",ne:"np",ng:"na",nl:"nl",nn:"no",no:"no",nr:"za",nv:"us",ny:"mw",oc:"fr",om:"et",or:"in",os:"ge",
pa:"in",pl:"pl",ps:"af",pt:"br",qu:"pe",rm:"ch",rn:"bi",ro:"ro",ru:"ru",rw:"rw",sa:"in",sd:"in",se:"no",sg:"cf",si:"lk",sk:"sk",sl:"si",sm:"ws",sn:"zw",so:"so",sq:"al",sr:"rs",ss:"za",st:"za",su:"id",sv:"se",sw:"tz",ta:"in",te:"in",tg:"tj",th:"th",ti:"et",tk:"tm",tl:"ph",tn:"za",to:"to",tr:"tr",ts:"za",tt:"ru",ty:"pf",ug:"cn",uk:"ua",ur:"pk",uz:"uz",ve:"za",vi:"vn",wa:"be",wo:"sn",xh:"za",yi:"il",yo:"ng",za:"cn",zh:"cn",zu:"za",ace:"id",ady:"ru",agq:"cm",alt:"ru",amo:"ng",asa:"tz",ast:"es",awa:"in",
bal:"pk",ban:"id",bas:"cm",bax:"cm",bbc:"id",bem:"zm",bez:"tz",bfq:"in",bft:"pk",bfy:"in",bhb:"in",bho:"in",bik:"ph",bin:"ng",bjj:"in",bku:"ph",bqv:"ci",bra:"in",brx:"in",bss:"cm",btv:"pk",bua:"ru",buc:"yt",bug:"id",bya:"id",byn:"er",cch:"ng",ccp:"in",ceb:"ph",cgg:"ug",chk:"fm",chm:"ru",chp:"ca",chr:"us",cja:"kh",cjm:"vn",ckb:"iq",crk:"ca",csb:"pl",dar:"ru",dav:"ke",den:"ca",dgr:"ca",dje:"ne",doi:"in",dsb:"de",dua:"cm",dyo:"sn",dyu:"bf",ebu:"ke",efi:"ng",ewo:"cm",fan:"gq",fil:"ph",fon:"bj",fur:"it",
gaa:"gh",gag:"md",gbm:"in",gcr:"gf",gez:"et",gil:"ki",gon:"in",gor:"id",grt:"in",gsw:"ch",guz:"ke",gwi:"ca",haw:"us",hil:"ph",hne:"in",hnn:"ph",hoc:"in",hoj:"in",ibb:"ng",ilo:"ph",inh:"ru",jgo:"cm",jmc:"tz",kaa:"uz",kab:"dz",kaj:"ng",kam:"ke",kbd:"ru",kcg:"ng",kde:"tz",kdt:"th",kea:"cv",ken:"cm",kfo:"ci",kfr:"in",kha:"in",khb:"cn",khq:"ml",kht:"in",kkj:"cm",kln:"ke",kmb:"ao",koi:"ru",kok:"in",kos:"fm",kpe:"lr",krc:"ru",kri:"sl",krl:"ru",kru:"in",ksb:"tz",ksf:"cm",ksh:"de",kum:"ru",lag:"tz",lah:"pk",
lbe:"ru",lcp:"cn",lep:"in",lez:"ru",lif:"np",lis:"cn",lki:"ir",lmn:"in",lol:"cd",lua:"cd",luo:"ke",luy:"ke",lwl:"th",mad:"id",mag:"in",mai:"in",mak:"id",man:"gn",mas:"ke",mdf:"ru",mdh:"ph",mdr:"id",men:"sl",mer:"ke",mfe:"mu",mgh:"mz",mgo:"cm",min:"id",mni:"in",mnk:"gm",mnw:"mm",mos:"bf",mua:"cm",mwr:"in",myv:"ru",nap:"it",naq:"na",nds:"de","new":"np",niu:"nu",nmg:"cm",nnh:"cm",nod:"th",nso:"za",nus:"sd",nym:"tz",nyn:"ug",pag:"ph",pam:"ph",pap:"bq",pau:"pw",pon:"fm",prd:"ir",raj:"in",rcf:"re",rej:"id",
rjs:"np",rkt:"in",rof:"tz",rwk:"tz",saf:"gh",sah:"ru",saq:"ke",sas:"id",sat:"in",saz:"in",sbp:"tz",scn:"it",sco:"gb",sdh:"ir",seh:"mz",ses:"ml",shi:"ma",shn:"mm",sid:"et",sma:"se",smj:"se",smn:"fi",sms:"fi",snk:"ml",srn:"sr",srr:"sn",ssy:"er",suk:"tz",sus:"gn",swb:"yt",swc:"cd",syl:"bd",syr:"sy",tbw:"ph",tcy:"in",tdd:"cn",tem:"sl",teo:"ug",tet:"tl",tig:"er",tiv:"ng",tkl:"tk",tmh:"ne",tpi:"pg",trv:"tw",tsg:"ph",tts:"th",tum:"mw",tvl:"tv",twq:"ne",tyv:"ru",tzm:"ma",udm:"ru",uli:"fm",umb:"ao",unr:"in",
unx:"in",vai:"lr",vun:"tz",wae:"ch",wal:"et",war:"ph",xog:"ug",xsr:"np",yao:"mz",yap:"fm",yav:"cm",zza:"tr"}[d[0]];return f};c.getWeekend=function(d){var f=c._region(d);d={"in":0,af:4,dz:4,ir:4,om:4,sa:4,ye:4,ae:5,bh:5,eg:5,il:5,iq:5,jo:5,kw:5,ly:5,ma:5,qa:5,sd:5,sy:5,tn:5}[f];f={af:5,dz:5,ir:5,om:5,sa:5,ye:5,ae:6,bh:5,eg:6,il:6,iq:6,jo:6,kw:6,ly:6,ma:6,qa:6,sd:6,sy:6,tn:6}[f];void 0===d&&(d=6);void 0===f&&(f=0);return{start:d,end:f}};return c})},"dojox/encoding/base64":function(){define(["dojo/_base/lang"],
function(b){b=b.getObject("dojox.encoding.base64",!0);b.encode=function(a){var c=[],d=a.length,f=d%3;d-=f;for(var n=0;n<d;){var k=a[n++]<<16|a[n++]<<8|a[n++];c.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(k>>>18&63));c.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(k>>>12&63));c.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(k>>>6&63));c.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(k&
63))}switch(f){case 2:k=a[n++]<<16|a[n++]<<8;c.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(k>>>18&63));c.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(k>>>12&63));c.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(k>>>6&63));c.push("\x3d");break;case 1:k=a[n++]<<16,c.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(k>>>18&63)),c.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(k>>>
12&63)),c.push("\x3d"),c.push("\x3d")}return c.join("")};b.decode=function(a){a=a.split("");for(var c=[],d=a.length;"\x3d"==a[--d];);for(var f=0;f<d;){var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a[f++])<<18;f<=d&&(n|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a[f++])<<12);f<=d&&(n|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a[f++])<<6);f<=d&&(n|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a[f++]));
c.push(n>>>16&255);c.push(n>>>8&255);c.push(n&255)}for(;0==c[c.length-1];)c.pop();return c};return b})},"esri/rest/geometryService":function(){define("exports ./geometryService/areasAndLengths ./geometryService/autoComplete ./geometryService/buffer ./geometryService/convexHull ./geometryService/cut ./geometryService/densify ./geometryService/difference ./geometryService/distance ./geometryService/fromGeoCoordinateString ./geometryService/generalize ./geometryService/intersect ./geometryService/labelPoints ./geometryService/lengths ./geometryService/offset ./geometryService/project ./geometryService/relation ./geometryService/reshape ./geometryService/simplify ./geometryService/toGeoCoordinateString ./geometryService/trimExtend ./geometryService/union ./geometryService/units".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A){b.areasAndLengths=a.areasAndLengths;b.autoComplete=c.autoComplete;b.buffer=d.buffer;b.convexHull=f.convexHull;b.cut=n.cut;b.densify=k.densify;b.difference=g.difference;b.distance=q.distance;b.fromGeoCoordinateString=e.fromGeoCoordinateString;b.generalize=m.generalize;b.intersect=l.intersect;b.labelPoints=w.labelPoints;b.lengths=v.lengths;b.offset=x.offset;b.project=p.project;b.relation=h.relation;b.reshape=t.reshape;b.simplify=r.simplify;b.toGeoCoordinateString=
u.toGeoCoordinateString;b.trimExtend=y.trimExtend;b.union=z.union;b.conversionTypeKebabDict=A.conversionTypeKebabDict;b.units=A.units;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/rest/geometryService/areasAndLengths":function(){define(["exports","../../request","../utils"],function(b,a,c){b.areasAndLengths=async function(d,f,n){d=c.parseUrl(d);f={...d.query,f:"json",...f.toJSON()};n=c.asValidOptions(f,n);return a(d.path+"/areasAndLengths",n).then(k=>k.data)};Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/rest/geometryService/autoComplete":function(){define("exports ../../geometry ../../request ../../geometry/support/spatialReferenceUtils ../utils ./utils ../../geometry/Polygon".split(" "),function(b,a,c,d,f,n,k){b.autoComplete=async function(g,q,e,m){const l=q[0].spatialReference;g=f.parseUrl(g);q={...g.query,f:"json",sr:d.srToRESTValue(l),polygons:JSON.stringify(n.encodeGeometries(q).geometries),polylines:JSON.stringify(n.encodeGeometries(e).geometries)};
m=f.asValidOptions(q,m);return c(g.path+"/autoComplete",m).then(({data:w})=>(w.geometries||[]).map(({rings:v})=>new k({spatialReference:l,rings:v})))};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/rest/geometryService/buffer":function(){define(["exports","../../geometry","../../request","../utils","../../geometry/Polygon"],function(b,a,c,d,f){b.buffer=async function(n,k,g){n=d.parseUrl(n);const q={...n.query,f:"json",...k.toJSON()},e=k.outSpatialReference||k.geometries[0].spatialReference;
k=d.asValidOptions(q,g);return c(n.path+"/buffer",k).then(m=>(m.data.geometries||[]).map(({rings:l})=>new f({spatialReference:e,rings:l})))};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/rest/geometryService/convexHull":function(){define(["exports","../../request","../../geometry/support/jsonUtils","../utils","./utils"],function(b,a,c,d,f){b.convexHull=async function(n,k,g){const q=k[0].spatialReference;n=d.parseUrl(n);k={...n.query,f:"json",sr:JSON.stringify(q.toJSON()),geometries:JSON.stringify(f.encodeGeometries(k))};
g=d.asValidOptions(k,g);return a(n.path+"/convexHull",g).then(({data:e})=>c.fromJSON(e.geometry).set({spatialReference:q}))};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/rest/geometryService/densify":function(){define(["exports","../../request","../../geometry/support/jsonUtils","../utils"],function(b,a,c,d){b.densify=async function(f,n,k){const g=n.geometries?.[0].spatialReference;f=d.parseUrl(f);n={...f.query,f:"json",...n.toJSON()};k=d.asValidOptions(n,k);return a(f.path+
"/densify",k).then(({data:q})=>(q.geometries||[]).map(e=>c.fromJSON(e).set({spatialReference:g})))};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/rest/geometryService/difference":function(){define(["exports","../../request","../../geometry/support/jsonUtils","../utils","./utils"],function(b,a,c,d,f){b.difference=async function(n,k,g,q){const e=k[0].spatialReference;n=d.parseUrl(n);k={query:{...n.query,f:"json",sr:JSON.stringify(e.toJSON()),geometries:JSON.stringify(f.encodeGeometries(k)),
geometry:JSON.stringify({geometryType:c.getJsonType(g),geometry:g.toJSON()})}};q&&(k={...q,...k});return a(n.path+"/difference",k).then(({data:m})=>(m.geometries||[]).map(l=>c.fromJSON(l).set({spatialReference:e})))};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/rest/geometryService/distance":function(){define(["exports","../../request","../utils"],function(b,a,c){b.distance=async function(d,f,n){d=c.parseUrl(d);f={...d.query,f:"json",...f.toJSON()};n=c.asValidOptions(f,n);
return a(d.path+"/distance",n).then(({data:k})=>k&&k.distance)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/rest/geometryService/fromGeoCoordinateString":function(){define(["exports","../../request","../../geometry/support/spatialReferenceUtils","../utils","./units"],function(b,a,c,d,f){b.fromGeoCoordinateString=async function(n,k,g){const q={};q.sr=null!=k.sr&&"object"===typeof k.sr?c.srToRESTValue(k.sr):k.sr;q.strings=JSON.stringify(k.strings);q.conversionType=f.conversionTypeKebabDict.toJSON(k.conversionType||
"mgrs");q.conversionMode=k.conversionMode;n=d.parseUrl(n);g=d.asValidOptions({...n.query,f:"json",...q},g);return a(n.path+"/fromGeoCoordinateString",g).then(({data:e})=>e.coordinates)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/rest/geometryService/units":function(){define(["exports","../../core/jsonMap"],function(b,a){a=new a.JSONMap({MGRS:"mgrs",USNG:"usng",UTM:"utm",GeoRef:"geo-ref",GARS:"gars",DMS:"dms",DDM:"ddm",DD:"dd"});b.conversionTypeKebabDict=a;b.units={UNIT_METER:9001,
UNIT_GERMAN_METER:9031,UNIT_FOOT:9002,UNIT_SURVEY_FOOT:9003,UNIT_CLARKE_FOOT:9005,UNIT_FATHOM:9014,UNIT_NAUTICAL_MILE:9030,UNIT_SURVEY_CHAIN:9033,UNIT_SURVEY_LINK:9034,UNIT_SURVEY_MILE:9035,UNIT_KILOMETER:9036,UNIT_CLARKE_YARD:9037,UNIT_CLARKE_CHAIN:9038,UNIT_CLARKE_LINK:9039,UNIT_SEARS_YARD:9040,UNIT_SEARS_FOOT:9041,UNIT_SEARS_CHAIN:9042,UNIT_SEARS_LINK:9043,UNIT_BENOIT_1895A_YARD:9050,UNIT_BENOIT_1895A_FOOT:9051,UNIT_BENOIT_1895A_CHAIN:9052,UNIT_BENOIT_1895A_LINK:9053,UNIT_BENOIT_1895B_YARD:9060,
UNIT_BENOIT_1895B_FOOT:9061,UNIT_BENOIT_1895B_CHAIN:9062,UNIT_BENOIT_1895B_LINK:9063,UNIT_INDIAN_FOOT:9080,UNIT_INDIAN_1937_FOOT:9081,UNIT_INDIAN_1962_FOOT:9082,UNIT_INDIAN_1975_FOOT:9083,UNIT_INDIAN_YARD:9084,UNIT_INDIAN_1937_YARD:9085,UNIT_INDIAN_1962_YARD:9086,UNIT_INDIAN_1975_YARD:9087,UNIT_FOOT_1865:9070,UNIT_RADIAN:9101,UNIT_DEGREE:9102,UNIT_ARCMINUTE:9103,UNIT_ARCSECOND:9104,UNIT_GRAD:9105,UNIT_GON:9106,UNIT_MICRORADIAN:9109,UNIT_ARCMINUTE_CENTESIMAL:9112,UNIT_ARCSECOND_CENTESIMAL:9113,UNIT_MIL6400:9114,
UNIT_BRITISH_1936_FOOT:9095,UNIT_GOLDCOAST_FOOT:9094,UNIT_INTERNATIONAL_CHAIN:109003,UNIT_INTERNATIONAL_LINK:109004,UNIT_INTERNATIONAL_YARD:109001,UNIT_STATUTE_MILE:9093,UNIT_SURVEY_YARD:109002,UNIT_50KILOMETER_LENGTH:109030,UNIT_150KILOMETER_LENGTH:109031,UNIT_DECIMETER:109005,UNIT_CENTIMETER:109006,UNIT_MILLIMETER:109007,UNIT_INTERNATIONAL_INCH:109008,UNIT_US_SURVEY_INCH:109009,UNIT_INTERNATIONAL_ROD:109010,UNIT_US_SURVEY_ROD:109011,UNIT_US_NAUTICAL_MILE:109012,UNIT_UK_NAUTICAL_MILE:109013,UNIT_SQUARE_INCHES:"esriSquareInches",
UNIT_SQUARE_FEET:"esriSquareFeet",UNIT_SQUARE_YARDS:"esriSquareYards",UNIT_ACRES:"esriAcres",UNIT_SQUARE_MILES:"esriSquareMiles",UNIT_SQUARE_MILLIMETERS:"esriSquareMillimeters",UNIT_SQUARE_CENTIMETERS:"esriSquareCentimeters",UNIT_SQUARE_DECIMETERS:"esriSquareDecimeters",UNIT_SQUARE_METERS:"esriSquareMeters",UNIT_ARES:"esriAres",UNIT_HECTARES:"esriHectares",UNIT_SQUARE_KILOMETERS:"esriSquareKilometers"};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/rest/geometryService/generalize":function(){define("exports ../../request ../../geometry/support/jsonUtils ../utils ../operations/generalize ../support/GeneralizeParameters".split(" "),
function(b,a,c,d,f,n){b.generalize=async function(k,g,q){g=n.from(g);const e=g.toJSON();g=f.generalizeToRESTParameters(g);k=d.parseUrl(k);const m=e.geometries[0].spatialReference;q=d.asValidOptions({...k.query,f:"json",...g},q);return a(k.path+"/generalize",q).then(({data:l})=>(l.geometries||[]).map(w=>c.fromJSON(w).set({spatialReference:m})))};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/rest/operations/generalize":function(){define(["exports","../../core/jsonMap","../../geometry/support/jsonUtils"],
function(b,a,c){const d=new a.JSONMap({109006:"centimeters",9102:"decimal-degrees",109005:"decimeters",9002:"feet",109009:"inches",9036:"kilometers",9001:"meters",9035:"miles",109007:"millimeters",109012:"nautical-miles",9096:"yards"});b.generalizeToRESTParameters=function(f){const {geometries:n,deviationUnit:k,maxDeviation:g}=f.toJSON();f={maxDeviation:g};n&&n.length&&(f.geometries=JSON.stringify({geometryType:c.getJsonType(n[0]),geometries:n}),f.sr=JSON.stringify(n[0].spatialReference));d.write(k,
f,"deviationUnit");return f};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/GeneralizeParameters":function(){define("../../chunks/tslib.es6 ../../core/arrayUtils ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/has ../../core/accessorSupport/decorators/subclass ../../geometry/support/jsonUtils".split(" "),function(b,a,c,d,f,n,k,g){c=class extends c.JSONSupport{constructor(q){super(q);this.maxDeviation=
this.geometries=this.deviationUnit=null}};b.__decorate([d.property({type:String,json:{write:!0}})],c.prototype,"deviationUnit",void 0);b.__decorate([d.property({json:{read:{reader:q=>q?q.map(e=>g.fromJSON(e)).filter(a.isSome):null},write:{writer:(q,e)=>{e.geometries=q?.map(m=>m.toJSON())??null}}}})],c.prototype,"geometries",void 0);b.__decorate([d.property({type:Number,json:{write:!0}})],c.prototype,"maxDeviation",void 0);c=b.__decorate([k.subclass("esri.rest.support.GeneralizeParameters")],c);c.from=
f.ensureType(c);return c})},"esri/rest/geometryService/intersect":function(){define(["exports","../../request","../../geometry/support/jsonUtils","../utils","./utils"],function(b,a,c,d,f){b.intersect=async function(n,k,g,q){const e=k[0].spatialReference;n=d.parseUrl(n);k={...n.query,f:"json",sr:JSON.stringify(e.toJSON()),geometries:JSON.stringify(f.encodeGeometries(k)),geometry:JSON.stringify({geometryType:c.getJsonType(g),geometry:g.toJSON()})};q=d.asValidOptions(k,q);return a(n.path+"/intersect",
q).then(({data:m})=>(m.geometries||[]).map(l=>c.fromJSON(l).set({spatialReference:e})))};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/rest/geometryService/labelPoints":function(){define(["exports","../../request","../../geometry/support/jsonUtils","../../geometry/support/spatialReferenceUtils","../utils"],function(b,a,c,d,f){b.labelPoints=function(n,k,g){var q=k.map(m=>m.toJSON());const e=k[0].spatialReference;n=f.parseUrl(n);q={...n.query,f:"json",sr:d.srToRESTValue(e),polygons:JSON.stringify(q)};
g=f.asValidOptions(q,g);return a(n.path+"/labelPoints",g).then(({data:m})=>(m.labelPoints||[]).map(l=>c.fromJSON(l).set({spatialReference:e})))};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/rest/geometryService/lengths":function(){define(["exports","../../request","../utils","../operations/lengths","../support/LengthsParameters"],function(b,a,c,d,f){b.lengths=async function(n,k,g){k=f.from(k);k=d.lengthsToRESTParameters(k);n=c.parseUrl(n);g=c.asValidOptions({...n.query,f:"json",
...k},g);return a(n.path+"/lengths",g).then(({data:q})=>q)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/rest/operations/lengths":function(){define(["exports","../../core/jsonMap","../../geometry/support/spatialReferenceUtils"],function(b,a,c){const d=new a.JSONMap({preserveShape:"preserve-shape"});b.lengthsToRESTParameters=function(f){const {polylines:n,lengthUnit:k,geodesic:g,calculationType:q}=f.toJSON(),e={};e.polylines=JSON.stringify(n);e.sr=c.srToRESTValue(f.polylines[0].spatialReference);
k&&(e.lengthUnit=k);g&&(e.geodesic=g);q&&(e.calculationType=d.toJSON(q));return e};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/LengthsParameters":function(){define("../../chunks/tslib.es6 ../../geometry ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../geometry/support/jsonUtils ../../geometry/Polyline".split(" "),
function(b,a,c,d,f,n,k,g,q,e){a=class extends c.JSONSupport{constructor(m){super(m);this.polylines=this.lengthUnit=this.geodesic=this.calculationType=null}};b.__decorate([d.property({type:String,json:{write:!0}})],a.prototype,"calculationType",void 0);b.__decorate([d.property({type:Boolean,json:{write:!0}})],a.prototype,"geodesic",void 0);b.__decorate([d.property({json:{write:!0}})],a.prototype,"lengthUnit",void 0);b.__decorate([d.property({type:[e],json:{read:{reader:m=>m?m.map(l=>q.fromJSON(l)):
null},write:{writer:(m,l)=>{l.polylines=m.map(w=>w.toJSON())}}}})],a.prototype,"polylines",void 0);a=b.__decorate([g.subclass("esri.rest.support.LengthsParameters")],a);a.from=f.ensureType(a);return a})},"esri/rest/geometryService/offset":function(){define("exports ../../request ../../geometry/support/jsonUtils ../utils ../operations/offset ../support/OffsetParameters".split(" "),function(b,a,c,d,f,n){b.offset=async function(k,g,q){g=n.from(g);const e=f.offsetToRESTParameters(g);k=d.parseUrl(k);const m=
g.geometries?.[0].spatialReference;g=d.asValidOptions({...k.query,f:"json",...e},q);return a(k.path+"/offset",g).then(({data:l})=>(l.geometries||[]).map(w=>c.fromJSON(w).set({spatialReference:m})))};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/rest/operations/offset":function(){define(["exports","../../core/jsonMap","../../geometry/support/jsonUtils"],function(b,a,c){const d=new a.JSONMap({esriGeometryOffsetBevelled:"bevelled",esriGeometryOffsetMitered:"mitered",esriGeometryOffsetRounded:"rounded"}),
f=new a.JSONMap({9001:"meters",9002:"feet",9036:"kilometers",9093:"miles",109012:"nautical-miles",109001:"yards"});b.offsetToRESTParameters=function(n){const {geometries:k,bevelRatio:g,offsetDistance:q,offsetHow:e,offsetUnit:m}=n.toJSON();n={bevelRatio:g,offsetDistance:q};k&&k.length&&(n.geometries=JSON.stringify({geometryType:c.getJsonType(k[0]),geometries:k}),n.sr=JSON.stringify(k[0].spatialReference));e&&(n.offsetHow=d.toJSON(e));m&&(n.offsetUnit=f.toJSON(m));return n};Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/OffsetParameters":function(){define("../../chunks/tslib.es6 ../../core/arrayUtils ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/has ../../core/accessorSupport/decorators/subclass ../../geometry/support/jsonUtils".split(" "),function(b,a,c,d,f,n,k,g){c=class extends c.JSONSupport{constructor(q){super(q);this.offsetUnit=this.offsetHow=this.offsetDistance=this.geometries=
this.bevelRatio=null}};b.__decorate([d.property({type:Number,json:{write:!0}})],c.prototype,"bevelRatio",void 0);b.__decorate([d.property({json:{read:{reader:q=>q?q.map(e=>g.fromJSON(e)).filter(a.isSome):null},write:{writer:(q,e)=>{e.geometries=q?.map(m=>m.toJSON())??null}}}})],c.prototype,"geometries",void 0);b.__decorate([d.property({type:Number,json:{write:!0}})],c.prototype,"offsetDistance",void 0);b.__decorate([d.property({type:String,json:{write:!0}})],c.prototype,"offsetHow",void 0);b.__decorate([d.property({type:String,
json:{write:!0}})],c.prototype,"offsetUnit",void 0);c=b.__decorate([k.subclass("esri.rest.support.OffsetParameters")],c);c.from=f.ensureType(c);return c})},"esri/rest/geometryService/project":function(){define("exports ../../request ../../core/accessorSupport/ensureType ../../geometry/support/jsonUtils ../utils ./utils ../support/ProjectParameters".split(" "),function(b,a,c,d,f,n,k){const g=c.ensureType(k);b.project=async function(q,e,m){e=g(e);q=f.parseUrl(q);const l={...q.query,f:"json",...e.toJSON()},
w=e.outSpatialReference,v=d.getJsonType(e.geometries[0]);e=f.asValidOptions(l,m);return a(q.path+"/project",e).then(({data:{geometries:x}})=>n.decodeGeometries(x,v,w))};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/ProjectParameters":function(){define("../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../geometry/support/jsonUtils ../../geometry/support/spatialReferenceUtils".split(" "),
function(b,a,c,d,f,n,k,g,q){a=class extends a.JSONSupport{constructor(e){super(e);this.geometries=[];this.transformForward=this.transformation=this.outSpatialReference=null}toJSON(){const e=this.geometries.map(w=>w.toJSON()),m=this.geometries[0],l={};l.outSR=q.srToRESTValue(this.outSpatialReference);l.inSR=q.srToRESTValue(m.spatialReference);l.geometries=JSON.stringify({geometryType:g.getJsonType(m),geometries:e});this.transformation&&(l.transformation=this.transformation.wkid||JSON.stringify(this.transformation));
null!=this.transformForward&&(l.transformForward=this.transformForward);return l}};b.__decorate([c.property()],a.prototype,"geometries",void 0);b.__decorate([c.property({json:{read:{source:"outSR"}}})],a.prototype,"outSpatialReference",void 0);b.__decorate([c.property()],a.prototype,"transformation",void 0);b.__decorate([c.property()],a.prototype,"transformForward",void 0);return a=b.__decorate([k.subclass("esri.rest.support.ProjectParameters")],a)})},"esri/rest/geometryService/relation":function(){define(["exports",
"../../request","../utils","../operations/relation","../support/RelationParameters"],function(b,a,c,d,f){b.relation=async function(n,k,g){k=f.from(k);k=d.relationToRESTParameters(k);n=c.parseUrl(n);g=c.asValidOptions({...n.query,f:"json",...k},g);return a(n.path+"/relation",g).then(({data:q})=>q.relations)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/rest/operations/relation":function(){define(["exports","../../core/jsonMap","../../geometry/support/jsonUtils","../../geometry/support/spatialReferenceUtils"],
function(b,a,c,d){const f=new a.JSONMap({esriGeometryRelationCross:"cross",esriGeometryRelationDisjoint:"disjoint",esriGeometryRelationIn:"in",esriGeometryRelationInteriorIntersection:"interior-intersection",esriGeometryRelationIntersection:"intersection",esriGeometryRelationLineCoincidence:"line-coincidence",esriGeometryRelationLineTouch:"line-touch",esriGeometryRelationOverlap:"overlap",esriGeometryRelationPointTouch:"point-touch",esriGeometryRelationTouch:"touch",esriGeometryRelationWithin:"within",
esriGeometryRelationRelation:"relation"});b.relationToRESTParameters=function(n){const {geometries1:k,geometries2:g,relation:q,relationParameter:e}=n.toJSON();n={};k?.length&&(n.geometries1=JSON.stringify({geometryType:c.getJsonType(k[0]),geometries:k}),n.sr=d.srToRESTValue(k[0].spatialReference));g&&0<g.length&&(n.geometries2=JSON.stringify({geometryType:c.getJsonType(g[0]),geometries:g}));q&&(n.relation=f.toJSON(q));e&&(n.relationParam=e);return n};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/rest/support/RelationParameters":function(){define("../../chunks/tslib.es6 ../../core/arrayUtils ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/has ../../core/accessorSupport/decorators/subclass ../../geometry/support/jsonUtils".split(" "),function(b,a,c,d,f,n,k,g){c=class extends c.JSONSupport{constructor(q){super(q);this.relationParameter=this.relation=this.geometries2=this.geometries1=null}};b.__decorate([d.property({json:{read:{reader:q=>
q?q.map(e=>g.fromJSON(e)).filter(a.isSome):null},write:{writer:(q,e)=>{e.geometries1=q?.map(m=>m.toJSON())??null}}}})],c.prototype,"geometries1",void 0);b.__decorate([d.property({json:{read:{reader:q=>q?q.map(e=>g.fromJSON(e)).filter(a.isSome):null},write:{writer:(q,e)=>{e.geometries2=q?.map(m=>m.toJSON())??null}}}})],c.prototype,"geometries2",void 0);b.__decorate([d.property({type:String,json:{write:!0}})],c.prototype,"relation",void 0);b.__decorate([d.property({type:String,json:{write:!0}})],c.prototype,
"relationParameter",void 0);c=b.__decorate([k.subclass("esri.rest.support.RelationParameters")],c);c.from=f.ensureType(c);return c})},"esri/rest/geometryService/reshape":function(){define(["exports","../../request","../../geometry/support/jsonUtils","../../geometry/support/spatialReferenceUtils","../utils"],function(b,a,c,d,f){b.reshape=async function(n,k,g,q){const e=k.spatialReference;n=f.parseUrl(n);k={...n.query,f:"json",sr:d.srToRESTValue(e),target:JSON.stringify({geometryType:c.getJsonType(k),
geometry:k.toJSON()}),reshaper:JSON.stringify(g.toJSON())};q=f.asValidOptions(k,q);return a(n.path+"/reshape",q).then(({data:m})=>c.fromJSON(m.geometry).set({spatialReference:e}))};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/rest/geometryService/toGeoCoordinateString":function(){define(["exports","../../request","../../geometry/support/spatialReferenceUtils","../utils","./units"],function(b,a,c,d,f){b.toGeoCoordinateString=async function(n,k,g){const q={};q.sr=null!=k.sr&&
"object"===typeof k.sr?c.srToRESTValue(k.sr):k.sr;q.coordinates=JSON.stringify(k.coordinates);q.conversionType=f.conversionTypeKebabDict.toJSON(k.conversionType||"mgrs");q.conversionMode=k.conversionMode;q.numOfDigits=k.numOfDigits;q.rounding=k.rounding;q.addSpaces=k.addSpaces;n=d.parseUrl(n);g=d.asValidOptions({...n.query,f:"json",...q},g);return a(n.path+"/toGeoCoordinateString",g).then(({data:e})=>e.strings)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/rest/geometryService/trimExtend":function(){define("exports ../../geometry ../../request ../utils ../operations/trimExtend ../support/TrimExtendParameters ../../geometry/Polyline".split(" "),
function(b,a,c,d,f,n,k){b.trimExtend=async function(g,q,e){q=n.from(q);const m=f.trimExtendToRESTParameters(q);g=d.parseUrl(g);const l=q.sr;q=d.asValidOptions({...g.query,f:"json",...m},e);return c(g.path+"/trimExtend",q).then(({data:w})=>(w.geometries||[]).map(({paths:v})=>new k({spatialReference:l,paths:v})))};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/rest/operations/trimExtend":function(){define(["exports","../../core/jsonMap"],function(b,a){const c=new a.JSONMap({0:"default-curve-extension",
1:"relocate-ends",2:"keep-end-attributes",4:"no-end-attributes",8:"no-extend-at-from",16:"no-extend-at-to"});b.trimExtendToRESTParameters=function(d){const {extendHow:f,polylines:n,trimExtendTo:k}=d.toJSON();d={};d.extendHow=c.toJSON(f);n?.length&&(d.polylines=JSON.stringify(n),d.sr=JSON.stringify(n[0].spatialReference));k&&(d.trimExtendTo=JSON.stringify(k));return d};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/TrimExtendParameters":function(){define("../../chunks/tslib.es6 ../../geometry ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../geometry/support/jsonUtils ../../geometry/Polyline".split(" "),
function(b,a,c,d,f,n,k,g,q,e){a=class extends c.JSONSupport{constructor(m){super(m);this.extendHow="default-curve-extension";this.trimExtendTo=this.polylines=null}};b.__decorate([d.property({type:String,json:{write:!0}})],a.prototype,"extendHow",void 0);b.__decorate([d.property({type:[e],json:{read:{reader:m=>m?m.map(l=>q.fromJSON(l)):null},write:{writer:(m,l)=>{l.polylines=m.map(w=>w.toJSON())}}}})],a.prototype,"polylines",void 0);b.__decorate([d.property({json:{read:{reader:m=>m?q.fromJSON(m):null},
write:{writer:(m,l)=>{l.trimExtendTo=m.toJSON()}}}})],a.prototype,"trimExtendTo",void 0);a=b.__decorate([g.subclass("esri.rest.support.TrimExtendParameters")],a);a.from=f.ensureType(a);return a})},"esri/rest/geometryService/union":function(){define(["exports","../../request","../../geometry/support/jsonUtils","../utils","./utils"],function(b,a,c,d,f){b.union=async function(n,k,g){const q=k[0].spatialReference;n=d.parseUrl(n);k={...n.query,f:"json",sr:JSON.stringify(q.toJSON()),geometries:JSON.stringify(f.encodeGeometries(k))};
g=d.asValidOptions(k,g);return a(n.path+"/union",g).then(({data:e})=>c.fromJSON(e.geometry).set({spatialReference:q}))};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"jimu/shared/utils":function(){define(["./basePortalUrlUtils"],function(b){function a(f,n){function k(g,q){var e,m,l="widgetOnScreen"===g;if(f[g]){if(f[g].groups)for(e=0;e<f[g].groups.length;e++){var w=f[g].groups[e];q(w,{index:e,isWidget:!1,groupId:w.id,isThemeWidget:!1,isOnScreen:l});if(f[g].groups[e].widgets)for(m=
0;m<f[g].groups[e].widgets.length;m++){var v=f[g].groups[e].widgets[m];q(v,{index:m,isWidget:!0,groupId:w.id,isThemeWidget:v.uri&&-1<v.uri.indexOf("themes/"+f.theme.name),isOnScreen:l})}}if(f[g].widgets)for(e=0;e<f[g].widgets.length;e++)v=f[g].widgets[e],q(f[g].widgets[e],{index:e,isWidget:!0,groupId:g,isThemeWidget:v.uri&&-1<v.uri.indexOf("themes/"+f.theme.name),isOnScreen:l})}}k("widgetOnScreen",n);k("widgetPool",n)}var c={},d="inPanel hasLocale hasStyle hasConfig hasUIFile hasSettingPage hasSettingUIFile hasSettingLocale hasSettingStyle keepConfigAfterMapSwitched isController hasVersionManager isThemeWidget supportMultiInstance mirrorIconForRTL".split(" ");
c.visitElement=a;c.getConfigElementById=function(f,n){var k;if("map"===n)return f.map;a(f,function(g){if(g.id===n)return k=g,!0});return k};c.getConfigElementByLabel=function(f,n){var k;if("map"===n)return f.map;a(f,function(g){if(g.label||g.name===n)return k=g,!0});return k};c.getConfigElementsByName=function(f,n){var k=[];if("map"===n)return[f.map];a(f,function(g){g.name===n&&k.push(g)});return k};c.getWidgetNameFromUri=function(f){f=f.split("/");f.pop();return f.pop()};c.getAmdFolderFromUri=function(f){f=
f.split("/");f.pop();return f.join("/")+"/"};c.widgetProperties=d;c.processWidgetProperties=function(f){"undefined"===typeof f.properties.isController&&(f.properties.isController=!1);"undefined"===typeof f.properties.isThemeWidget&&(f.properties.isThemeWidget=!1);"undefined"===typeof f.properties.hasVersionManager&&(f.properties.hasVersionManager=!1);"undefined"===typeof f.properties.mirrorIconForRTL&&(f.properties.mirrorIconForRTL=!1);d.forEach(function(n){"undefined"===typeof f.properties[n]&&(f.properties[n]=
!0)})};c.getControllerWidgets=function(f){var n=[];f.visitElement(function(k){k.isController&&n.push(k)});return n};c.isHostedService=function(f){var n=b.getServerByUrl(f);return(new RegExp(n+"/[^/]+/[^/]+/rest/services","gi")).test(f)};return c})},"jimu/shared/basePortalUrlUtils":function(){define(function(){var b={declaredClass:"jimu.shared.basePortalUrlUtils"};"function"!==typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s*/gi,"").replace(/\s*$/gi,"")});"function"!==
typeof String.prototype.startWith&&(String.prototype.startWith=function(a){return this.substr(0,a.length)===a});"function"!==typeof String.prototype.endWith&&(String.prototype.endWith=function(a){return this.substr(this.length-a.length,a.length)===a});b.getServerByUrl=function(a){a=(a||"").trim();a=a.replace(/^(http(s?):?)\/\//gi,"");0===a.indexOf("//")&&(a=a.slice(2));return a.split("/")[0]};b.getServerWithProtocol=function(a){var c="";if(a=(a||"").trim()){var d=b.getServerByUrl(a);if(!d)return c;
var f=b.getProtocol(a);f?c=f+"://"+d:0===a.indexOf("//")&&(c="//"+d)}return c};b.isSameServer=function(a,c){a=b.getServerByUrl(a)||"";c=b.getServerByUrl(c)||"";return a.toLowerCase()===c.toLowerCase()};b.isOnline=function(a){return 0<=b.getServerByUrl(a).toLowerCase().indexOf(".arcgis.com")};b.isArcGIScom=function(a){a=b.getServerByUrl(a).toLowerCase();return"www.arcgis.com"===a||"arcgis.com"===a};b.getStandardPortalUrl=function(a){var c=b.getServerByUrl(a);if(""===c)return"";b.isOnline(c)?(b.isArcGIScom(c)&&
(c="www.arcgis.com"),a=b.addProtocol(a),a=b.getProtocol(a)+"://"+c):(a=(a||"").trim().replace(/sharing(.*)/gi,"").replace(/\/*$/g,""),a=b.addProtocol(a),a.replace(new RegExp("http(s?)://"+c,"g"),"")||(a+="/arcgis"));return a};b.isSamePortalUrl=function(a,c){var d=/^http(s?):\/\//gi,f=/^\/\//gi;a=b.getStandardPortalUrl(a).toLowerCase().replace(d,"").replace(f,"");c=b.getStandardPortalUrl(c).toLowerCase().replace(d,"").replace(f,"");return a===c};b.addProtocol=function(a){if(-1>=a.toLowerCase().indexOf("http://")&&
-1>=a.toLowerCase().indexOf("https://")){var c="";"undefined"!==typeof window&&window.location?(c=window.location.protocol,a=a.startWith("//")?c+a:a.startWith("/")?c+"//"+window.location.host+a:c+"//"+a):(c="http:",a.startWith("//")&&(a=c+a))}return a};b.getProtocol=function(a){var c="";a=a.toLowerCase();0===a.indexOf("https://")?c="https":0===a.indexOf("http://")&&(c="http");return c};b.updateUrlProtocolByOtherUrl=function(a,c){c=c.toLowerCase();0===c.indexOf("https://")?a=b.setHttpsProtocol(a):
0===c.indexOf("http://")&&(a=b.setHttpProtocol(a));return a};b.removeProtocol=function(a){return a.replace(/^http(s?):\/\//i,"//")};b.setHttpProtocol=function(a){a=b.addProtocol(a);return a.replace(/^https:\/\//,"http://")};b.setHttpsProtocol=function(a){a=b.addProtocol(a);return a.replace(/^http:\/\//,"https://")};b.setProtocol=function(a,c){return 0<=c.indexOf("https")?b.setHttpsProtocol(a):0<=c.indexOf("http")?b.setHttpProtocol(a):a};b.getSharingUrl=function(a){var c="";(a=b.getStandardPortalUrl(a))&&
(c=a+"/sharing");return c};b.getOAuth2Url=function(a){var c="";(a=b.getStandardPortalUrl(a))&&(c=a+"/sharing/oauth2");return c};b.getAppIdUrl=function(a,c){var d="";(a=b.getStandardPortalUrl(a))&&(d=a+"/sharing/oauth2/apps/"+c);return d};b.getSignInUrl=function(a){var c="";(a=b.getStandardPortalUrl(a))&&(c=a+"/home/signin.html");return c};b.getBaseSearchUrl=function(a){var c="";a=b.getStandardPortalUrl(a);(a=a.replace(/\/*$/g,""))&&(c=a+"/sharing/rest/search");return c};b.getBaseItemUrl=function(a){var c=
"";(a=b.getStandardPortalUrl(a))&&(c=a+"/sharing/rest/content/items");return c};b.getItemUrl=function(a,c){var d="";(a=b.getBaseItemUrl(a))&&c&&(d=a+"/"+c);return d};b.getItemDataUrl=function(a,c){var d="";(a=b.getItemUrl(a,c))&&(d=a+"/data");return d};b.getGenerateTokenUrl=function(a){var c="";a&&(a=b.getStandardPortalUrl(a),c=a+"/sharing/generateToken");return c};b.getItemDetailsPageUrl=function(a,c){var d="";a&&c&&(a=b.getStandardPortalUrl(a),d=a+"/home/item.html?id\x3d"+c);return d};b.getUserProfilePageUrl=
function(a,c){var d="";a&&c&&(a=b.getStandardPortalUrl(a),d=a+"/home/user.html?user\x3d"+c);return d};b.getBaseGroupUrl=function(a){var c="";(a=b.getStandardPortalUrl(a))&&(c=a+"/sharing/rest/community/groups");return c};b.getPortalSelfInfoUrl=function(a){var c="";(a=b.getStandardPortalUrl(a||""))&&(c=a+"/sharing/portals/self");return c};b.getCommunitySelfUrl=function(a){var c="";(a=b.getStandardPortalUrl(a||""))&&(c=a+"/sharing/rest/community/self");return c};b.getBaseUserUrl=function(a){var c="";
(a=b.getStandardPortalUrl(a))&&(c=a+"/sharing/rest/community/users");return c};b.getUserUrl=function(a,c){var d="",f=b.getBaseUserUrl(a);a&&c&&(d=f+"/"+c);return d};b.getUserTagsUrl=function(a,c){var d="",f=b.getUserUrl(a,c);a&&c&&(d=f+"/tags");return d};b.getUserThumbnailUrl=function(a,c,d){var f="";(a=b.getUserUrl(a,c))&&d&&(f=a+"/info/"+d);return f};b.getContentUrl=function(a){var c="";a&&(a=b.getStandardPortalUrl(a),c=a+"/sharing/rest/content");return c};b.getUserContentUrl=function(a,c,d){var f=
"";f="";a&&c&&(f=b.getContentUrl(a),f=d?f+"/users/"+c+"/"+d:f+"/users/"+c);return f};b.getUserContentItemUrl=function(a,c,d){var f="";f="";a&&c&&d&&(f=b.getUserContentUrl(a,c),f=f+"/items/"+d);return f};b.getItemResourceUrl=function(a,c,d){var f="";f="";a&&c&&(f=b.getContentUrl(a),f=d?f+"/items/"+c+"/resources/"+d:f+"/items/"+c+"/resources");return f};b.getAddItemUrl=function(a,c,d){var f="";f="";a&&c&&(f=b.getUserContentUrl(a,c,d),f+="/addItem");return f};b.getDeleteItemUrl=function(a,c,d){var f=
"";(a=b.getUserItemsUrl(a,c))&&(f=a+"/"+d+"/delete");return f};b.getUserItemsUrl=function(a,c,d){var f="";f="";a&&c&&(f=b.getUserContentUrl(a,c,d),f+="/items");return f};b.getUpdateItemUrl=function(a,c,d,f){var n="";n="";a&&c&&(n=b.getUserItemsUrl(a,c,f),n=n+"/"+d+"/update");return n};b.shareItemUrl=function(a,c,d,f){var n="";n="";a&&c&&(n=b.getUserItemsUrl(a,c,f),n=n+"/"+d+"/share");return n};b.getHomeIndexUrl=function(a){var c="";(a=b.getStandardPortalUrl(a))&&(c=a+"/home/index.html");return c};
b.getHomeMapViewerUrl=function(a,c){var d="";if(a=b.getStandardPortalUrl(a))d=a+"/home/webmap/viewer.html",d=c?d+("?webmap\x3d"+c):d+"?useExisting\x3d1";return d};b.getHomeGalleryUrl=function(a){var c="";(a=b.getStandardPortalUrl(a))&&(c=a+"/home/gallery.html");return c};b.getHomeGroupsUrl=function(a){var c="";(a=b.getStandardPortalUrl(a))&&(c=a+"/home/groups.html");return c};b.getHomeMyContentUrl=function(a){var c="";(a=b.getStandardPortalUrl(a))&&(c=a+"/home/content.html");return c};b.getHomeMyOrganizationUrl=
function(a){var c="";(a=b.getStandardPortalUrl(a))&&(c=a+"/home/organization.html");return c};b.getHomeUserUrl=function(a){var c="";(a=b.getStandardPortalUrl(a))&&(c=a+"/home/user.html");return c};b.getPortalHelpUrl=function(a,c){var d="";(a=b.getStandardPortalUrl(a))&&(d=a+"/portalhelp/"+(c||"en")+"/portal/");return d};b.getPortalAdminHelpUrl=function(a,c){var d="";(a=b.getStandardPortalUrl(a))&&(d=a+"/portalhelp/"+(c||"en")+"/admin/help/");return d};b.getPortalProxyUrl=function(a){var c="";(a=b.getStandardPortalUrl(a))&&
(c=a+"/sharing/proxy");return c};b.getOAuth2SignOutUrl=function(a){var c="";(a=b.getStandardPortalUrl(a))&&(c=a+"/sharing/oauth2/signout");return c};b.getNewPrintUrl=function(a){var c="";if(a=b.getStandardPortalUrl(a))a=b.setHttpProtocol(a),c=a+"/sharing/tools/newPrint";return c};b.getArcgisOnlineUrl=function(a){return a.endsWith("mapsdevext.arcgis.com")||a.endsWith("mapsdevext.arcgis.com/")?"https://devext.arcgis.com":a.endsWith("mapsqa.arcgis.com")||a.endsWith("mapsqa.arcgis.com/")?"https://qaext.arcgis.com":
"https://www.arcgis.com"};return b})},"jimu/WidgetManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/Deferred dojo/topic dojo/Evented dojo/on dojo/aspect dojo/json dojo/query dojo/request/xhr dojo/promise/all ./utils jimu/tokenUtils ./dijit/Message ./portalUrlUtils ./portalUtils".split(" "),function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t){var r=null,u=b(k,{constructor:function(){this.loaded=[];this.missedActions=[];this.activeWidget=null;this.widgetsUri=
{};window.isBuilder?(n.subscribe("app/sceneViewLoaded",a.hitch(this,this._onSceneViewLoaded)),n.subscribe("app/sceneViewChanged",a.hitch(this,this._onSceneViewChanged))):(n.subscribe("sceneViewLoaded",a.hitch(this,this._onSceneViewLoaded)),n.subscribe("sceneViewChanged",a.hitch(this,this._onSceneViewChanged)));window.isBuilder?(n.subscribe("app/appConfigLoaded",a.hitch(this,this._onAppConfigLoaded)),n.subscribe("app/appConfigChanged",a.hitch(this,this._onAppConfigChanged))):(n.subscribe("appConfigLoaded",
a.hitch(this,this._onAppConfigLoaded)),n.subscribe("appConfigChanged",a.hitch(this,this._onAppConfigChanged)));n.subscribe("userSignIn",a.hitch(this,this._onUserSignIn));n.subscribe("userSignOut",a.hitch(this,this._onUserSignOut));n.subscribe("builder/actionTriggered",a.hitch(this,this._onActionTriggered));n.subscribe("/dnd/move/start",a.hitch(this,this._onMoveStart))},loadWidget:function(y){var z=new f,A;y=a.clone(y);y.folderUrl||v.processWidgetSetting(y);(A=this.getWidgetById(y.id))?z.resolve(A):
this.getWidgetUri(y).then(a.hitch(this,function(C){y.uri=C;w([this.loadWidgetClass(y),this.loadWidgetManifest(y)]).then(a.hitch(this,function(E){var B=E[0],D=E[1];this.loadWidgetResources(D).then(a.hitch(this,function(F){try{var K=this.createWidget(D,B,F);console.log("widget ["+D.uri+"] created.")}catch(L){console.log("create ["+D.uri+"] error:"+L.stack),new p({message:window.jimuNls.createWidgetError+": "+D.uri}),z.reject(L)}setTimeout(a.hitch(this,function(){z.resolve(K);this.emit("widget-created",
K);n.publish("widgetCreated",K)}),50)}),function(F){z.reject(F)})}),function(E){z.reject(E)})}));return z},loadWidgetClass:function(y){var z=new f;var A=y.isRemote?y.uri+".js":y.uri;require(v.getRequireConfig(),[A],a.hitch(this,function(C){z.resolve(C)}));v.checkError(y.uri,z);return z},loadWidgetResources:function(y){var z=new f,A=[];var C=a.clone(y);y=this.tryLoadWidgetConfig(C);var E=this._tryLoadResource(C,"i18n");var B=this._tryLoadResource(C,"style");C=this._tryLoadResource(C,"template");A.push(y);
A.push(E);A.push(C);A.push(B);w(A).then(a.hitch(this,function(D){var F={};F.config=D[0];F.i18n=D[1];F.template=D[2];F.style=D[3];z.resolve(F)}),function(D){z.reject(D)});return z},getWidgetUri:function(y){if(this.widgetsUri[y.id])return this.widgetsUri[y.id];var z=y.itemId?t.getPortal(window.portalUrl).getItemById(y.itemId).then(function(A){if(h.isOnline(window.portalUrl)){if(!h.isOnline(A.url)||"Web AppBuilder Widget"!==A.type)return(new f).reject("Not allow.",y.itemId)}else if("AppBuilder Extension"!==
A.type)return(new f).reject("Not allow.",y.itemId);return v.widgetJson.getUriFromItem(A)}):v.getUriInfo(y.uri).isRemote?(new f).reject("Not allow.",y.uri):(new f).resolve(y.uri);return this.widgetsUri[y.id]=z},loadWidgetManifest:function(y){var z=new f;return this.getWidgetUri(y).then(a.hitch(this,function(A){y.uri=A;if(y.manifest)return z.resolve(y),z;A=v.getUriInfo(A).folderUrl+"manifest.json";l(A,{handleAs:"json",headers:{"X-Requested-With":null}}).then(a.hitch(this,function(C){if(C.error&&C.error.code)return z.reject(C.error);
C.amdFolder=y.amdFolder;C.category="widget";y.label?(this._processManifest(C),v.addManifest2WidgetJson(y,C),z.resolve(y)):v.addI18NLabel(C).then(a.hitch(this,function(){this._processManifest(C);v.addManifest2WidgetJson(y,C);z.resolve(y)}))}),function(C){z.reject(C)});return z}))},getWidgetMarginBox:function(y){if("string"===typeof y&&(y=this.getWidgetById(y),!y))return{};if(y._marginBox)return y._marginBox;y.setPosition({left:-9999,top:-9999,relativeTo:y.position.relativeTo});this.openWidget(y);y._marginBox=
y.getMarginBox();this.closeWidget(y);return y._marginBox},_processManifest:function(y){v.addManifestProperies(y);v.processManifestLabel(y,window.dojoConfig.locale)},createWidget:function(y,z,A){if(this.getWidgetById(y.id))return this.getWidgetById(y.id);A.config&&A.i18n&&(A.config=v.replacePlaceHolder(A.config,A.i18n));y.rawConfig=y.config;y.config=A.config||{};this.appConfig._appData&&this._mergeAgolConfig(y);y.nls=A.i18n||{};A.template&&(y.templateString=A.template);y["class"]="jimu-widget";y.label||
(y.label=y.name);y.sceneView=this.sceneView;y.appConfig=this.appConfig;A={};for(var C in y)y.hasOwnProperty(C)&&(A[C]=y[C]);A.widgetManager=this;y=new z(A);y.clazz=z;q.after(y,"startup",a.hitch(this,this._postWidgetStartup,y));q.before(y,"destroy",a.hitch(this,this._onDestroyWidget,y));g(y.domNode,"click",a.hitch(this,this._onClickWidget,y));this.loaded.push(y);return y},getAllWidgets:function(){return this.loaded},destroyAllWidgets:function(){var y=c.map(this.loaded,function(z){return z.id});c.forEach(y,
function(z){this.destroyWidget(z)},this);this.loaded=[]},loadWidgetSettingPage:function(y){var z=new f;y=a.clone(y);y.id+="_setting";w([this.loadWidgetSettingClass(y)]).then(a.hitch(this,function(A){var C=A[0];this.loadWidgetSettingPageResources(y).then(a.hitch(this,function(E){var B={nls:E.i18n,appConfig:this.appConfig,sceneView:this.sceneView,"class":"jimu-widget-setting"};null!==E.template&&(B.templateString=E.template);for(var D in y)y.hasOwnProperty(D)&&(B[D]=y[D]);try{var F=new C(B);q.before(F,
"destroy",a.hitch(this,this._onDestroyWidgetSetting,F));z.resolve(F)}catch(K){new p({message:window.jimuNls.createWidgetSettingError+":"+y.uri}),z.reject(K)}}),function(E){console.log(E)})}),function(A){z.reject(A)});return z},loadWidgetSettingClass:function(y){var z=new f;var A=y.isRemote?y.folderUrl+"setting/Setting.js":y.amdFolder+"setting/Setting";require(v.getRequireConfig(),[A],a.hitch(this,function(C){z.resolve(C)}));v.checkError(y.folderUrl+"setting/Setting.js",z);return z},loadWidgetSettingPageResources:function(y){var z=
new f,A=[];y=a.clone(y);var C=this._tryLoadResource(y,"settingI18n");var E=this._tryLoadResource(y,"settingTemplate");y=this._tryLoadResource(y,"settingStyle");A.push(C);A.push(E);A.push(y);w(A).then(a.hitch(this,function(B){var D={};D.i18n=B[0]||{};D.template=B[1];D.style=B[2];z.resolve(D)}),function(B){console.log(B)});return z},getWidgetById:function(y){var z;c.some(this.loaded,function(A){if(A.id===y)return z=A,!0},this);return z},getWidgetByLabel:function(y){var z;c.some(this.loaded,function(A){if(A.label===
y)return z=A,!0},this);return z},getWidgetsByName:function(y){var z=[];c.some(this.loaded,function(A){A.name===y&&z.push(A)},this);return z},changeWindowStateTo:function(y,z){"normal"===z?this.normalizeWidget(y):"minimized"===z?this.minimizeWidget(y):"maximized"===z?this.maximizeWidget(y):console.log("error state: "+z)},closeWidget:function(y){if("string"===typeof y&&(y=this.getWidgetById(y),!y))return;if("closed"!==y.state){this.activeWidget&&this.activeWidget.id===y.id&&(this.activeWidget.onDeActive(),
this.activeWidget=null);d.setStyle(y.domNode,"display","none");y.setState("closed");try{y.onClose()}catch(z){console.log(console.error("fail to close widget "+y.name+". "+z.stack))}}},openWidget:function(y){if("string"===typeof y&&(y=this.getWidgetById(y),!y))return;if(!y.started)try{y.started=!0,y.startup()}catch(z){console.error("fail to startup widget "+y.name+". "+z.stack)}if("closed"===y.state){d.setStyle(y.domNode,"display","");y.setState("opened");try{y.onOpen()}catch(z){console.error("fail to open widget "+
y.name+". "+z.stack)}}},activateWidget:function(y){if("string"===typeof y&&(y=this.getWidgetById(y),!y))return;"opened"===y.state&&this._activeWidget(y)},maximizeWidget:function(y){if("string"===typeof y&&(y=this.getWidgetById(y),!y))return;"closed"===y.state&&this.openWidget(y);y.setWindowState("maximized");try{y.onMaximize()}catch(z){console.log(console.error("fail to maximize widget "+y.name+". "+z.stack))}},minimizeWidget:function(y){if("string"===typeof y&&(y=this.getWidgetById(y),!y))return;
"closed"===y.state&&this.openWidget(y);y.setWindowState("minimized");try{y.onMinimize()}catch(z){console.log(console.error("fail to minimize widget "+y.name+". "+z.stack))}},normalizeWidget:function(y){if("string"===typeof y&&(y=this.getWidgetById(y),!y))return;"closed"===y.state&&this.openWidget(y);y.setWindowState("normal");try{y.onNormalize()}catch(z){console.log(console.error("fail to normalize widget "+y.name+". "+z.stack))}},destroyWidget:function(y){if("string"===typeof y&&(y=this.getWidgetById(y),
!y))return;this._removeWidget(y);try{y.destroy()}catch(z){console.log(console.error("fail to destroy widget "+y.name+". "+z.stack))}},tryLoadWidgetConfig:function(y){return this._tryLoadWidgetConfig(y).then(a.hitch(this,function(z){return this._upgradeWidgetConfig(y,z).then(function(A){return y.config=A})}))},triggerWidgetOpen:function(y){function z(B){var D=q.after(B,"onOpen",function(){D.remove();A.resolve(B)})}var A=new f,C=this.getWidgetById(y);if(C){if("closed"!==C.state)return A.resolve(C),
A;z(C)}else var E=n.subscribe("widgetCreated",a.hitch(this,function(B){B.id===y&&(E.remove(),A.resolve(B))}));n.publish("openWidget",y);return A},_tryLoadWidgetConfig:function(y){var z=new f;if(y.config&&a.isObject(y.config))return z.resolve(y.config),z;if(y.config){if(require.cache["url:"+y.config])return z.resolve(e.parse(require.cache["url:"+y.config])),z;z=v.processUrlInAppConfig(y.config);z=z.split("/");z[z.length-1]=encodeURIComponent(z[z.length-1]);z=z.join("/");return l(z,{handleAs:"json"})}return this._tryLoadResource(y,
"config").then(function(A){y.isDefaultConfig=!0;return A})},_upgradeWidgetConfig:function(y,z){var A=new f,C=y.manifest.version,E=y.version,B;if(C===E)return A.resolve(z),A;if(!1===y.hasVersionManager)return y.version=C,A.resolve(z),A;require(v.getRequireConfig(),[y.amdFolder+"VersionManager"],a.hitch(this,function(D){D=new D;var F=D.getVersionIndex(E),K=D.getVersionIndex(C);if(F>K)A.reject("Bad widget version number, "+y.name+","+E);else try{B=D.upgrade(z,E,C),y.version=C,A.resolve(B)}catch(L){console.log("Read widget ["+
y.name+"] old config error,"+L.stack),A.resolve(z)}}));return A},loadWidgetStyle:function(y){var z="widget/style/"+y.uri,A=new f;z=this._replaceId(z);return d.byId(z)?(A.resolve("load"),A):v.loadStyleLink(z,y.styleFile,"theme_"+this.appConfig.theme.name+"_style_common")},loadWidgetSettingStyle:function(y){var z="widget/style/"+y.uri+"/setting",A=new f;z=this._replaceId(z);return d.byId(z)?(A.resolve("load"),A):v.loadStyleLink(z,y.settingStyleFile)},loadWidgetConfig:function(y){y=require(v.getRequireConfig()).toUrl(y.configFile);
if(require.cache["url:"+y]){var z=new f;z.resolve(e.parse(require.cache["url:"+y]));return z}return l(y,{handleAs:"json"})},loadWidgetI18n:function(y){var z=new f;require(v.getRequireConfig(),["dojo/i18n!"+y.i18nFile],function(A){z.resolve(A)});return z},loadWidgetSettingI18n:function(y){var z=new f;require(v.getRequireConfig(),["dojo/i18n!"+y.settingI18nFile],function(A){z.resolve(A)});return z},loadWidgetTemplate:function(y){var z=new f;require(v.getRequireConfig(),["dojo/text!"+y.templateFile],
function(A){z.resolve(A)});v.checkError(y.templateFile,z);return z},loadWidgetSettingTemplate:function(y){var z=new f;require(v.getRequireConfig(),["dojo/text!"+y.settingTemplateFile],function(A){z.resolve(A)});v.checkError(y.settingTemplateFile,z);return z},removeWidgetStyle:function(y){d.destroy(this._replaceId("widget/style/"+y.uri))},removeWidgetSettingStyle:function(y){d.destroy(this._replaceId("widget/style/"+y.uri+"/setting"))},getControllerWidgets:function(){return c.filter(this.loaded,function(y){return y.isController})},
getOffPanelWidgets:function(){return c.filter(this.loaded,function(y){return!y.inPanel})},getOnScreenOffPanelWidgets:function(){return c.filter(this.loaded,function(y){return y.isOnScreen&&!y.inPanel})},closeOtherWidgetsInTheSameGroup:function(y){if("string"===typeof y&&(y=this.getWidgetById(y),!y))return;for(var z=0;z<this.loaded.length;z++)this.loaded[z].gid===y.gid&&this.loaded[z].id!==y.id&&this.closeWidget(this.loaded[z])},closeAllWidgetsInGroup:function(y){for(var z=0;z<this.loaded.length;z++)this.loaded[z].gid===
y&&this.closeWidget(this.loaded[z])},_mergeAgolConfig:function(y){var z=this.appConfig._appData.values,A="widgets["+y.id+"]",C;for(C in z){var E=C.replace(/\//g,"_").indexOf(A+"_config");0<=E&&v.template.setConfigValue(y,C.replace(/\//g,"_").substr(E,C.length).replace(A,"widget"),z[C])}},_onUserSignIn:function(y){c.forEach(this.loaded,function(z){z.onSignIn(y)},this)},_onUserSignOut:function(){c.forEach(this.loaded,function(y){y.onSignOut()},this)},_activeWidget:function(y){if(this.activeWidget){if(this.activeWidget.id===
y.id){!1===this.activeWidget.inPanel&&this.activeWidget.moveTopOnActive&&d.setStyle(this.activeWidget.domNode,"zIndex",101);return}"active"===this.activeWidget.state&&(this.activeWidget.setState("opened"),!1===this.activeWidget.inPanel&&d.setStyle(y.domNode,"zIndex","zIndex"in y.position?y.position.zIndex:"auto"),this.activeWidget.onDeActive())}this.activeWidget=y;"opened"===this.activeWidget.state&&(this.activeWidget.setState("active"),!1===this.activeWidget.inPanel&&this.activeWidget.moveTopOnActive&&
d.setStyle(this.activeWidget.domNode,"zIndex",101),this.activeWidget.onActive(),n.publish("widgetActived",y))},_onClickWidget:function(y,z){var A=m(".jimu-widget",y.domNode);if(0<A.length)for(var C=0;C<A.length;C++)if(z.target===A[C]||d.isDescendant(z.target,A[C]))return;this._activeWidget(y)},_onMoveStart:function(y){c.forEach(this.loaded,function(z){z.domNode===y.node&&this._activeWidget(z)},this)},_onAppConfigLoaded:function(y){this.appConfig=y=a.clone(y);x.setPortalUrl(y.portalUrl)},_onSceneViewLoaded:function(y){this.sceneView=
y},_onSceneViewChanged:function(y){this.sceneView=y},_onAppConfigChanged:function(y,z,A,C){var E=a.clone(y);this.appConfig=E;c.forEach(this.loaded,function(B){B&&(B.onAppConfigChanged(E,z,A,C),"widgetChange"===z&&this._onConfigChanged(A.id,A.config,C))},this)},_onConfigChanged:function(y,z){if(y=this.getWidgetById(y))y.onConfigChanged(z),a.mixin(y.config,z)},_onActionTriggered:function(y){if("map"!==y.elementId&&"app"!==y.elementId){var z=this.getWidgetById(y.elementId);if(z)z.onAction(y.action,y.data);
else this.missedActions.push({id:y.elementId,action:{name:y.action,data:y.data}});c.forEach(this.getControllerWidgets(),function(A){if(A.widgetIsControlled(y.elementId))A.onAction(y.action,{widgetId:y.elementId,data:y.data})},this)}},_postWidgetStartup:function(y){y.started=!0;v.setVerticalCenter(y.domNode);q.after(y,"resize",a.hitch(this,v.setVerticalCenter,y.domNode));this.openWidget(y);var z=x.getPortalCredential(this.appConfig.portalUrl);if(z)y.onSignIn(z);else y.onSignOut();this._triggerMissedAction(y)},
_triggerMissedAction:function(y){this.missedActions.forEach(function(z){if(z.id===y.id)y.onAction(z.action.name,z.action.data)})},_remove:function(y){delete this.widgetsUri[y];return c.some(this.loaded,function(z,A){if(z.id===y)return this.loaded.splice(A,1),!0},this)},_tryLoadResource:function(y,z){var A=new f,C=function(){if("config"===z)var B=this.loadWidgetConfig(y);else if("style"===z)B=this.loadWidgetStyle(y);else if("i18n"===z)B=this.loadWidgetI18n(y);else if("template"===z)B=this.loadWidgetTemplate(y);
else if("settingTemplate"===z)B=this.loadWidgetSettingTemplate(y);else if("settingStyle"===z)B=this.loadWidgetSettingStyle(y);else if("settingI18n"===z)B=this.loadWidgetSettingI18n(y);else return A;B.then(function(D){A.resolve(D)},function(D){console.error("Load widget resource error. resource:",z);console.error(D);new p({message:window.jimuNls.loadWidgetResourceError+": "+y.uri});A.reject(D)})};if("config"===z){var E=y.amdFolder+"config.json";y.configFile=E;E="hasConfig"}else if("style"===z)E=y.amdFolder+
"css/style.css",y.styleFile=E,E="hasStyle";else if("i18n"===z)E=y.amdFolder+"nls/strings.js",y.i18nFile=y.isRemote?E:y.amdFolder+"nls/strings",E="hasLocale";else if("template"===z)E=y.amdFolder+"Widget.html",y.templateFile=E,E="hasUIFile";else if("settingTemplate"===z)E=y.amdFolder+"setting/Setting.html",y.settingTemplateFile=E,E="hasSettingUIFile";else if("settingI18n"===z)E=y.amdFolder+"setting/nls/strings.js",y.settingI18nFile=y.isRemote?E:y.amdFolder+"setting/nls/strings",E="hasSettingLocale";
else if("settingStyle"===z)E=y.amdFolder+"setting/css/style.css",y.settingStyleFile=E,E="hasSettingStyle";else return A;y[E]?C.apply(this):A.resolve(null);return A},_replaceId:function(y){return y.replace(/\//g,"_").replace(/\./g,"_")},_onDestroyWidget:function(y){"closed"!==y.state&&this.closeWidget(y);this._removeWidget(y);console.log("destroy widget ["+y.uri+"].")},_onDestroyWidgetSetting:function(y){this.removeWidgetSettingStyle(y)},_removeWidget:function(y){if("string"===typeof y&&(y=this.getWidgetById(y),
!y))return;this.activeWidget&&this.activeWidget.id===y.id&&(this.activeWidget=null);this._remove(y.id);0===this.getWidgetsByName(y.name).length&&this.removeWidgetStyle(y)}});u.getInstance=function(y){null===r&&(r=new u(y),window._widgetManager=r);return r};return u})},"jimu/tokenUtils":function(){define("require dojo/_base/lang dojo/_base/array dojo/aspect dojo/Deferred dojo/cookie dojo/json dojo/topic dojo/request/script esri/kernel esri/request esri/core/urlUtils esri/identity/IdentityManager esri/identity/OAuthInfo jimu/portalUrlUtils jimu/utils".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p){"function"!==typeof n.getAll&&(n.getAll=function(t){var r=[];(t=n(t))&&r.push(t);return r});var h={portalUrl:null,cookiePath:"/",_started:!1,webTierPortalUrls:[],isInBuilderWindow:function(){return!!window.isBuilder},isInConfigOrPreviewWindow:function(){return p.isInConfigOrPreviewWindow()},isStringStartWith:function(t,r){return t.substr(0,r.length)===r},getCookiePath:function(){return this.cookiePath},setPortalUrl:function(t){(t=x.getStandardPortalUrl(t))&&
(t+="/");this.portalUrl=t},getPortalUrl:function(){return this.portalUrl},isWebTierPortal:function(t){var r=new f,u=x.getStandardPortalUrl(t);t=u+"/sharing";var y=x.setHttpsProtocol(u+"/sharing/generateToken?f\x3djson"),z=x.setHttpsProtocol(t);q.get(y,{jsonp:"callback"}).then(a.hitch(this,function(A){A.token?(this.webTierPortalUrls.push(u),this.removeWabAuthInfo(),e.id.getCredential(z).then(a.hitch(this,function(C){function E(F){var K=F.creationTime||(new Date).getTime(),L=F.expires;0<K&&0<L&&L>K&&
setTimeout(function(){q.get(y,{jsonp:"callback"}).then(function(G){G.token&&(F.token=G.token,F.expires=G.expires,F.creationTime=(new Date).getTime(),F.refreshServerTokens(),E(F))},function(G){console.error(G)})},.8*(L-K))}C.token||(C.token=A.token);C.expires||(C.expires=A.expires);var B=p.getEsriConfigRequestObject(),D=l.isTrustedServer(C.server,!0);-1<D&&B.corsEnabledServers&&B.corsEnabledServers.splice(D,1);this._pushCorsEnabledServerInfo({host:x.getServerByUrl(u),withCredentials:!0});r.resolve(!0);
E(C)}),a.hitch(this,function(){r.resolve(!0)}))):r.resolve(!1)}),a.hitch(this,function(A){console.error(A);r.reject(A)}));return r},addAuthorizedCrossOriginDomains:function(t){if(t&&0<t.length)for(var r=0;r<t.length;r++)this.addWithCredentialDomain(t[r])},addWithCredentialDomain:function(t){if(t&&"string"===typeof t){var r=p.getEsriConfigRequestObject().corsEnabledServers||[],u=x.getServerByUrl(t);(t=x.getServerWithProtocol(t))||(t="http://"+u);t=l.isTrustedServer(t,!0);-1<t&&r.splice(t,1);this._pushCorsEnabledServerInfo({host:u,
withCredentials:!0})}},_pushCorsEnabledServerInfo:function(t){if(t){var r=p.getEsriConfigRequestObject(),u=r.corsEnabledServers||[],y="charAt charCodeAt concat endsWith indexOf lastIndexOf localeCompare match replace search slice split startsWith substr substring toLocaleLowerCase toLocaleUpperCase toLowerCase toString toUpperCase trim trimLeft trimRight valueOf".split(" ");if("object"===typeof t&&"string"===typeof t.host){for(var z in t.host)t[z]="function"===typeof t.host[z]?function(){return t.host[z].apply(t.host,
arguments)}:t.host[z];t.length=t.host.length;c.forEach(y,function(A){"function"===typeof t.host[A]&&(t[A]=function(){return t.host[A].apply(t.host,arguments)})});t.withCredentials&&r.webTierAuthServers&&0>r.webTierAuthServers.indexOf(t.host)&&r.webTierAuthServers.push(t.host)}u.push(t)}},tryRegisterCredential:function(t){return this.isValidCredential(t)?c.some(e.id.credentials,a.hitch(this,function(r){return t.token===r.token}))?!1:(e.id.credentials.push(t),!0):!1},registerToken:function(t){var r=
x.getSharingUrl(this.portalUrl);e.id.findCredential(r)&&c.some(e.id.credentials,a.hitch(this,function(u,y){if(this.isValidPortalCredentialOfPortalUrl(this.portalUrl,u))return e.id.credentials.splice(y,1),!0}));return this._getTokenInfo(t).then(function(u){e.id.registerToken(u)})},_getTokenInfo:function(t){var r=x.getPortalSelfInfoUrl(this.portalUrl);return q.get(r+("?f\x3djson\x26token\x3d"+t),{jsonp:"callback"}).then(a.hitch(this,function(u){if(u.user)return{server:x.getSharingUrl(this.portalUrl),
ssl:u.allSSL,token:t,userId:u.user.username};throw Error(window.jimuNls.urlParams.invalidToken);}),function(u){console.error(u);throw Error(window.jimuNls.urlParams.validateTokenError);})},_isInvalidPortalUrl:function(t){return t&&"string"===typeof t&&a.trim(t)},signInPortal:function(t){var r=new f;if(this._isInvalidPortalUrl(t)){t=x.getStandardPortalUrl(t);var u=x.getSharingUrl(t),y=this.getPortalCredential(t);y?setTimeout(a.hitch(this,function(){r.resolve(y)}),0):r=e.id.getCredential(u)}else setTimeout(a.hitch(this,
function(){r.reject("Invalid portalurl.")}),0);return r},_loadPortalSelfInfo:function(t){t=x.getPortalSelfInfoUrl(t);var r=new f;m(t,{responseType:"json",query:{f:"json"},callbackParamName:"callback"}).then(a.hitch(this,function(u){r.resolve(u.data)}),a.hitch(this,function(u){r.reject(u)}));return r},registerOAuthInfo:function(t,r,u){if(!t||"string"!==typeof t||!r||"string"!==typeof r)return null;u||(u=0);u=e.id.findOAuthInfo(t);u||(u=window.location.protocol+"//"+window.location.host+b.toUrl("jimu")+
"/oauth-callback.html",u=new v({appId:r,expiration:20160,portalUrl:t,authNamespace:"/",popup:!0,flowType:"auto",popupCallbackUrl:u}),e.id.registerOAuthInfos([u]));u.appId=r;return u},signOutAll:function(t){var r=x.getStandardPortalUrl(this.portalUrl)+"/sharing/rest",u=x.getPortalSignInUrlFromLocation();u=u+"?returnUrl\x3d"+encodeURIComponent(window.location.href);var y=p.getLocationUrlWithoutHashAndQueryParams();y=p.url.addQueryParamToUrl(y,"action","setportalurl");window.appInfo.isRunInPortal?(this.removeEsriAuthCookieStorage(),
window.location.href=r+"/oauth2/signout?client_id\x3darcgisonline\x26redirect_uri\x3d"+u):(this.removeWabAuthInfo(),t&&t.supportsOAuth?(t=r+"/oauth2/signout?client_id\x3d"+t.appId+"\x26redirect_uri\x3d"+y,window.location.href=t):window.location.href=y)},userHaveSignInPortal:function(t){return!!this.getPortalCredential(a.trim(t||""))},isValidCredential:function(t){var r=!1;if(t){r=t.token;var u=t.server,y=t.scope;r=r&&"string"===typeof r&&a.trim(r);u=u&&"string"===typeof u&&a.trim(u);y="portal"===
y||"server"===y;var z=!0;t.expires&&(t=parseInt(t.expires,10),z=(new Date).getTime(),z=t>z);r=r&&u&&y&&z}return r},isValidPortalCredentialOfPortalUrl:function(t,r){var u=!1;this.isValidCredential(r)&&(u="portal"===r.scope,t=x.isSameServer(t,r.server),u=u&&t);return u},getPortalCredential:function(t){var r=null;t=a.trim(t||"");if(!t)return null;t=x.getStandardPortalUrl(t);return r=this._filterPortalCredential(t,e.id.credentials)},saveAndRegisterCookieToCredential:function(t){t=a.clone(t);t.referer=
window.location.host;t.scope="portal";t.isAdmin=!!t.isAdmin;this.saveWabAuthInfo(t);var r=t.server+"/sharing/rest";t.server=r;e.id.registerToken(t);return e.id.findCredential(r,t.userId)},registerAuth2Hash:function(t){t=a.clone(t);var r=1E3*parseInt(t.expires_in,10);r=(new Date).getTime()+r;var u=x.getStandardPortalUrl(t.state.portalUrl);return this.saveAndRegisterCookieToCredential({referer:window.location.host,server:u,token:t.access_token,expires:r,userId:t.username,scope:"portal",isAdmin:!!t.isAdmin})},
readWabAuthInfo:function(){var t=null,r=localStorage.getItem("wab_token");try{var u=n("wab_auth");u&&(t=k.parse(u),t.token=r)}catch(y){console.error(y)}return t},saveWabAuthInfo:function(t){t=a.clone(t);this.removeWabAuthInfo();localStorage.setItem("wab_token",t.token);delete t.token;n("wab_auth",k.stringify(t),{expires:new Date(t.expires),path:"/"})},removeWabAuthInfo:function(){this.removeCookie("wab_auth");localStorage.removeItem("wab_token")},removeEsriAuthCookieStorage:function(){window.localStorage&&
window.localStorage.removeItem("esriJSAPIOAuth");window.sessionStorage&&window.sessionStorage.removeItem("esriJSAPIOAuth")},_filterPortalCredential:function(t,r){var u=null;r&&0<r.length&&(r=c.filter(r,a.hitch(this,function(y){return this.isValidPortalCredentialOfPortalUrl(t,y)})),0<r.length&&(u=r[r.length-1]));return u},_removePortalCredential:function(t){var r=a.trim(t||"");if(r){r=x.getStandardPortalUrl(r);for(t=c.filter(e.id.credentials,a.hitch(this,function(u){return this.isValidPortalCredentialOfPortalUrl(r,
u)}));0<t.length;)t[0].destroy(),t.splice(0,1);e.id.credentials=c.filter(e.id.credentials,a.hitch(this,function(u){return!this.isValidPortalCredentialOfPortalUrl(r,u)}))}},getUserIdByToken:function(t,r){var u=new f;if(t&&"string"===typeof t&&r&&"string"===typeof r){var y=x.getStandardPortalUrl(r);r=c.filter(e.id.credentials,a.hitch(this,function(A){var C=A.token===t&&A.userId;A=x.isSameServer(y,A.server);return C&&A}));if(0<r.length){var z=r[0];setTimeout(a.hitch(this,function(){u.resolve(z.userId)}),
0);return u}r=x.getCommunitySelfUrl(y);m(r,{responseType:"json",query:{f:"json"},callbackParamName:"callback"}).then(a.hitch(this,function(A){A=A&&A.data;u.resolve(A&&A.username||"")}),a.hitch(this,function(A){console.error(A);u.reject("fail to get userId by token")}))}else setTimeout(a.hitch(this,function(){u.reject("invalid parameters")}),0);return u},xtGetCredentialFromCookie:function(t){var r=this.readWabAuthInfo();if(!r||"object"!==typeof r||!x.isSameServer(t,r.server)||window.location.host!==
r.referer)return null;r.expires=parseInt(r.expires,10);var u=(new Date).getTime();if(!(r.expires>u))return this.removeCookie("wab_auth"),null;t+="/sharing/rest";r.server=t;(u=e.id.findCredential(t))||e.id.registerToken(r);return u=e.id.findCredential(t)},removeCookie:function(t){var r=this.getCookiePath();p.removeCookie(t,r)},_getDomainsByServerName:function(t){var r=t.split("."),u=r.length;return c.map(r,a.hitch(this,function(y,z){y=r.slice(z,u);var A="",C=y.length-1;c.forEach(y,a.hitch(this,function(E,
B){A+=E;B!==C&&(A+=".")}));return A}))},_publishCurrentPortalUserSignIn:function(t){if(this.isValidCredential(t))try{g.publish("userSignIn",t)}catch(r){console.error(r)}},_publishAnyUserSignIn:function(t){if(this.isValidCredential(t))try{g.publish("anyUserSignIn",t)}catch(r){console.error(r)}},_publishCurrentPortalUserSignOut:function(t){try{g.publish("userSignOut",t)}catch(r){console.error(r)}},_signInSuccess:function(t){try{this.isValidPortalCredentialOfPortalUrl(this.portalUrl,t)&&this._publishCurrentPortalUserSignIn(t),
this._publishAnyUserSignIn(t)}catch(r){console.error(r)}},_bindEvents:function(){d.after(e.id,"signIn",a.hitch(this,function(t,r){console.log(r[1]);d.after(t,"callback",a.hitch(this,function(u,y){this._signInSuccess(y[0],!1)}));return t}))},isStart:function(){return this._started},startup:function(){if(!this._started){if(this.isInConfigOrPreviewWindow()){var t=window.parent;if(t){var r=t.esri&&t.esri.id;if(r){w.initialize(r.toJson());var u=p.getEsriConfigRequestObject();t=t.esriConfig.defaults.io;
u.trustedServers||(u.trustedServers=[]);c.forEach(t.corsEnabledServers||[],a.hitch(this,function(y){y&&y.host&&y.withCredentials&&u.trustedServers.push(y.host)}))}}}this._bindEvents();this._started=!0}}};h.startup();return h})},"jimu/portalUrlUtils":function(){define(["dojo/_base/lang","jimu/shared/basePortalUrlUtils"],function(b,a){var c=b.clone(a);c.declaredClass="jimu.portalUrlUtils";c.getPortalUrlFromLocation=function(){return c.getPortalServerFromLocation()+c.getDeployContextFromLocation()};
c.getPortalSignInUrlFromLocation=function(){return c.getPortalUrlFromLocation()+"home/signin.html"};c.getPortalServerFromLocation=function(){return window.location.protocol+"//"+window.location.host};c.getDeployContextFromLocation=function(){var d=window.location.href.split("?")[0],f=d.indexOf("/home/");0>f&&(f=d.indexOf("/apps/"));d=d.substring(d.indexOf(window.location.host)+window.location.host.length+1,f);"/"!==d&&(d="/"+d+"/");return d};c.getRestBaseUrlFromLocation=function(){return window.location.protocol+
"//"+window.location.host+c.getDeployContextFromLocation()+"sharing/rest/"};return c})},"jimu/dijit/Message":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/keys dojo/on jimu/dijit/Popup jimu/utils".split(" "),function(b,a,c,d,f,n,k){return b(n,{baseClass:"jimu-popup jimu-message",declaredClass:"jimu.dijit.Message",type:"message",message:"",autoHeight:!0,maxWidth:350,maxHeight:180,postMixInProperties:function(){this.content=this.message},_createTitleNode:function(){this.titleLabel&&
(this.titleNode=c.create("div",{"class":"title"},this.domNode),this.titleLabeNode=c.create("span",{"class":"title-label jimu-float-leading",innerHTML:k.sanitizeHTML(this.titleLabel)||"\x26nbsp"},this.titleNode),this.closeBtnNode=c.create("div",{"class":"close-btn jimu-float-trailing"},this.titleNode),this.own(f(this.closeBtnNode,"click",a.hitch(this,this.close))))},_preProcessing:function(){0===this.buttons.length&&this.buttons.push({label:window.jimuNls.common.ok,key:d.ENTER,onClick:a.hitch(this,
this.close)})},_increaseZIndex:function(){c.setStyle(this.domNode,"zIndex",501);c.setStyle(this.overlayNode,"zIndex",500)}})})},"jimu/dijit/Popup":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/fx dojo/on dojo/sniff dojo/touch dojo/query dojo/dnd/move dijit/_WidgetBase jimu/utils".split(" "),function(b,a,c,d,f,n,k,g,q,e,m,l){var w=0;return b(m,{declaredClass:"jimu.dijit.Popup",baseClass:"jimu-popup",titleLabel:"",content:null,container:null,buttons:[],
enabledButtons:[],disabledButtons:[],onClose:null,_fixedHeight:!1,autoHeight:!1,maxHeight:800,maxWidth:1024,constructor:function(){this.buttons=[];this.enabledButtons=[];this.disabledButtons=[];this.pauseKeyHandles=[];this.container=jimuConfig.layoutId},postCreate:function(){this._preProcessing();this.inherited(arguments);this._initDomNode();this._positioning();d.place(this.domNode,this.container);setTimeout(a.hitch(this,function(){this._moveToMiddle()}),50);this.own(n(window,"resize",a.hitch(this,
function(){this._fixedHeight||this.autoHeight?(this._calculatePosition(),this._moveToMiddle()):this._positioning()})));this.overlayNode=d.create("div",{"class":"jimu-overlay"},this.container);this._increaseZIndex();f.animateProperty({node:this.domNode,properties:{opacity:1},duration:200}).play();this.domNode.focus()},_preProcessing:function(){"number"===typeof this.height&&(this._fixedHeight=!0,this.autoHeight=!1);this.autoHeight&&(this.maxHeight=598)},_createTitleNode:function(){this.titleNode=d.create("div",
{"class":"title"},this.domNode);this.titleLabeNode=d.create("span",{"class":"title-label jimu-float-leading",innerHTML:l.sanitizeHTML(this.titleLabel)||"\x26nbsp"},this.titleNode);this.closeBtnNode=d.create("div",{"class":"close-btn jimu-icon jimu-icon-close jimu-float-trailing"},this.titleNode);var v=null;v="ontouchstart"in document?g.press:"click";this.own(n(this.closeBtnNode,v,a.hitch(this,this.close)))},_initDomNode:function(){this._createTitleNode();this.contentContainerNode=d.create("div",{"class":"content"},
this.domNode);this.content&&("string"===typeof this.content?this.contentContainerNode.innerHTML=this.content:this.content.domNode?(this.content.placeAt(this.contentContainerNode),this.content.popup=this):1===this.content.nodeType&&d.place(this.content,this.contentContainerNode));this.buttonContainer=d.create("div",{"class":"button-container"},this.domNode);0===this.buttons.length&&d.setStyle(this.buttonContainer,"display","none");for(var v=this.buttons.length-1;-1<v;v--)this._createButton(this.buttons[v]),
this.buttons[v].disable&&this.disableButton(v)},_limitButtonsMaxWidth:function(){var v=this.enabledButtons.length;if(0!==v){var x=d.getContentBox(this.buttonContainer),p=d.getMarginExtents(this.enabledButtons[0]),h=d.getPadBorderExtents(this.enabledButtons[0]),t=0;h=8===k("ie")?h.l+h.r:0;t=(x.w-(p.l+p.r+h)*v)/v;0<t&&(c.forEach(this.enabledButtons,a.hitch(this,function(r){d.setStyle(r,"maxWidth",t+"px")})),c.forEach(this.disabledButtons,a.hitch(this,function(r){d.setStyle(r,"maxWidth",t+"px")})))}},
_moveableNode:function(v,x){this.moveable&&(this.moveable.destroy(),this.moveable=null);var p=d.getMarginBox(this.container);p.l=p.l-v+x;p.w+=2*(v-x);this.moveable=new e.boxConstrainedMoveable(this.domNode,{box:p,handle:this.titleNode||this.contentContainerNode,within:!0});this.own(n(this.moveable,"Moving",a.hitch(this,this.onMoving)));this.own(n(this.moveable,"MoveStop",a.hitch(this,this.onMoveStop)))},_getHeaderBox:function(){return 0===q("#header").length?{t:0,l:0,w:0,h:0}:d.getMarginBox("header")},
_getFooterBox:function(){return 0===q(".footer",this.container).length?{t:0,l:0,w:0,h:0}:d.getMarginBox(q(".footer",this.container)[0])},_calculatePosition:function(){var v=d.getContentBox(this.container),x=this._getHeaderBox(),p=this._getFooterBox();p=v.h-x.h-p.h-40;var h=0;h=this._fixedHeight?this.height:this.autoHeight?p-200:this.height=p>this.maxHeight?this.maxHeight:p;p=(p-h)/2+x.h+20;p=p<x.h?x.h:p;this.width=this.width||this.maxWidth;d.setStyle(this.domNode,{left:(v.w-this.width)/2+"px",top:p+
"px",width:this.width+"px"})},_calculateHeight:function(){this.autoHeight?(d.setStyle(this.domNode,"height","auto"),d.addClass(this.contentContainerNode,"content-static"),0===this.buttons.length&&d.setStyle(this.contentContainerNode,{marginBottom:"15px"})):(d.setStyle(this.domNode,"height",this.height+"px"),d.addClass(this.contentContainerNode,"content-absolute"),d.addClass(this.buttonContainer,"button-container-absolute"),0===this.buttons.length&&d.setStyle(this.contentContainerNode,{bottom:"15px"}));
this._moveableNode(this.width,100)},_moveToMiddle:function(){if(this.autoHeight){var v=d.getMarginBox(this.domNode),x=d.getContentBox(this.container),p=this._getHeaderBox(),h=this._getFooterBox();h=x.h-p.h-h.h-40;var t=0;t=v.h||h-200;v=(h-t)/2+p.h+20;v=v<p.h?p.h:v;d.setStyle(this.domNode,{left:(x.w-this.width)/2+"px",top:v+"px",width:this.width+"px"})}},_positioning:function(){this._calculatePosition();this._calculateHeight()},_increaseZIndex:function(){d.setStyle(this.domNode,"zIndex",w+200+1);d.setStyle(this.overlayNode,
"zIndex",w+200);w++},setTitleLabel:function(v){this.titleNode.innerHTML=l.stripHTML(v)},onMoving:function(v){d.setStyle(v.node,"opacity",.9)},onMoveStop:function(v){d.setStyle(v.node,"opacity",1)},close:function(){if(!this.onClose||!1!==this.onClose()){var v=this.domNode.parentNode,x=a.clone(this.domNode);d.setStyle(this.domNode,"display","none");d.destroy(this.overlayNode);this.destroy();this.moveable.destroy();d.place(x,v);f.animateProperty({node:x,properties:{opacity:0},duration:200,onEnd:function(){d.destroy(x)}}).play()}},
addButton:function(v){this._createButton(v)},_createButton:function(v){var x=" ";v.classNames&&0<v.classNames.length&&"function"===typeof v.classNames.join&&(x+=v.classNames.join(" "));var p=d.create("div",{"class":"jimu-btn jimu-float-trailing jimu-trailing-margin1 "+x,innerHTML:v.label,title:v.title},this.buttonContainer);this.enabledButtons.unshift(p);x=d.create("div",{"class":"jimu-btn jimu-state-disabled jimu-float-trailing jimu-trailing-margin1 "+x,title:v.title,innerHTML:v.label,style:{display:"none"}},
this.buttonContainer);this.disabledButtons.unshift(x);this.own(n(p,"click",a.hitch(this,function(h){if(v.onClick)v.onClick(h);else this.close()})))},setButtonProps:function(v,x){"number"===typeof v&&isFinite(v)||(x=v,v=0);if(x&&0!==this.enabledButtons.length)for(var p in x)"title"===p?(d.setAttr(this.enabledButtons[v],"title",x[p]),d.setAttr(this.disabledButtons[v],"title",x[p])):"label"===p&&(d.setProp(this.enabledButtons[v],"innerHTML",x[p]),d.setProp(this.disabledButtons[v],"innerHTML",x[p]))},
enableButton:function(v){"number"===typeof v&&isFinite(v)&&v<this.enabledButtons.length?(d.setStyle(this.enabledButtons[v],"display","inline-block"),d.setStyle(this.disabledButtons[v],"display","none")):(c.forEach(this.enabledButtons[v],a.hitch(this,function(x){d.setStyle(x,"display","inline-block")})),c.forEach(this.disabledButtons[v],a.hitch(this,function(x){d.setStyle(x,"display","none")})))},disableButton:function(v){"number"===typeof v&&isFinite(v)&&v<this.disabledButtons.length?(d.setStyle(this.disabledButtons[v],
"display","inline-block"),d.setStyle(this.enabledButtons[v],"display","none")):(c.forEach(this.disabledButtons,a.hitch(this,function(x){d.setStyle(x,"display","inline-block")})),c.forEach(this.enabledButtons,a.hitch(this,function(x){d.setStyle(x,"display","none")})))},showButton:function(v){this.enableButton(v)},hideButton:function(v){"number"===typeof v&&isFinite(v)&&v<this.disabledButtons.length?(d.setStyle(this.disabledButtons[v],"display","none"),d.setStyle(this.enabledButtons[v],"display","none")):
(c.forEach(this.disabledButtons,a.hitch(this,function(x){d.setStyle(x,"display","none")})),c.forEach(this.enabledButtons,a.hitch(this,function(x){d.setStyle(x,"display","none")})))}})})},"dojo/_base/fx":function(){define("./kernel ./config ./lang ../Evented ./Color ../aspect ../sniff ../dom ../dom-style".split(" "),function(b,a,c,d,f,n,k,g,q){var e=c.mixin,m={},l=m._Line=function(r,u){this.start=r;this.end=u};l.prototype.getValue=function(r){return(this.end-this.start)*r+this.start};var w=m.Animation=
function(r){e(this,r);c.isArray(this.curve)&&(this.curve=new l(this.curve[0],this.curve[1]))};w.prototype=new d;c.extend(w,{duration:350,repeat:0,rate:20,_percent:0,_startRepeatCount:0,_getStep:function(){var r=this._percent,u=this.easing;return u?u(r):r},_fire:function(r,u){u=u||[];if(this[r])if(a.debugAtAllCosts)this[r].apply(this,u);else try{this[r].apply(this,u)}catch(y){console.error("exception in animation handler for:",r),console.error(y)}return this},play:function(r,u){this._delayTimer&&this._clearTimer();
if(u)this._stopTimer(),this._active=this._paused=!1,this._percent=0;else if(this._active&&!this._paused)return this;this._fire("beforeBegin",[this.node]);r=r||this.delay;u=c.hitch(this,"_play",u);if(0<r)return this._delayTimer=setTimeout(u,r),this;u();return this},_play:function(r){this._delayTimer&&this._clearTimer();this._startTime=(new Date).valueOf();this._paused&&(this._startTime-=this.duration*this._percent);this._active=!0;this._paused=!1;r=this.curve.getValue(this._getStep());this._percent||
(this._startRepeatCount||(this._startRepeatCount=this.repeat),this._fire("onBegin",[r]));this._fire("onPlay",[r]);this._cycle();return this},pause:function(){this._delayTimer&&this._clearTimer();this._stopTimer();if(!this._active)return this;this._paused=!0;this._fire("onPause",[this.curve.getValue(this._getStep())]);return this},gotoPercent:function(r,u){this._stopTimer();this._active=this._paused=!0;this._percent=r;u&&this.play();return this},stop:function(r){this._delayTimer&&this._clearTimer();
if(!this._timer)return this;this._stopTimer();r&&(this._percent=1);this._fire("onStop",[this.curve.getValue(this._getStep())]);this._active=this._paused=!1;return this},destroy:function(){this.stop()},status:function(){return this._active?this._paused?"paused":"playing":"stopped"},_cycle:function(){if(this._active){var r=(new Date).valueOf();r=0===this.duration?1:(r-this._startTime)/this.duration;1<=r&&(r=1);this._percent=r;this.easing&&(r=this.easing(r));this._fire("onAnimate",[this.curve.getValue(r)]);
1>this._percent?this._startTimer():(this._active=!1,0<this.repeat?(this.repeat--,this.play(null,!0)):-1==this.repeat?this.play(null,!0):this._startRepeatCount&&(this.repeat=this._startRepeatCount,this._startRepeatCount=0),this._percent=0,this._fire("onEnd",[this.node]),!this.repeat&&this._stopTimer())}return this},_clearTimer:function(){clearTimeout(this._delayTimer);delete this._delayTimer}});var v=0,x=null,p={run:function(){}};c.extend(w,{_startTimer:function(){this._timer||(this._timer=n.after(p,
"run",c.hitch(this,"_cycle"),!0),v++);x||(x=setInterval(c.hitch(p,"run"),this.rate))},_stopTimer:function(){this._timer&&(this._timer.remove(),this._timer=null,v--);0>=v&&(clearInterval(x),x=null,v=0)}});var h=k("ie")?function(r){var u=r.style;u.width.length||"auto"!=q.get(r,"width")||(u.width="auto")}:function(){};m._fade=function(r){r.node=g.byId(r.node);var u=e({properties:{}},r);r=u.properties.opacity={};r.start="start"in u?u.start:function(){return+q.get(u.node,"opacity")||0};r.end=u.end;r=m.animateProperty(u);
n.after(r,"beforeBegin",c.partial(h,u.node),!0);return r};m.fadeIn=function(r){return m._fade(e({end:1},r))};m.fadeOut=function(r){return m._fade(e({end:0},r))};m._defaultEasing=function(r){return.5+Math.sin((r+1.5)*Math.PI)/2};var t=function(r){this._properties=r;for(var u in r){var y=r[u];y.start instanceof f&&(y.tempColor=new f)}};t.prototype.getValue=function(r){var u={},y;for(y in this._properties){var z=this._properties[y],A=z.start;A instanceof f?u[y]=f.blendColors(A,z.end,r,z.tempColor).toCss():
c.isArray(A)||(u[y]=(z.end-A)*r+A+("opacity"!=y?z.units||"px":0))}return u};m.animateProperty=function(r){var u=r.node=g.byId(r.node);r.easing||(r.easing=b._defaultEasing);r=new w(r);n.after(r,"beforeBegin",c.hitch(r,function(){var y={},z;for(z in this.properties){if("width"==z||"height"==z)this.node.display="block";var A=this.properties[z];c.isFunction(A)&&(A=A(u));A=y[z]=e({},c.isObject(A)?A:{end:A});c.isFunction(A.start)&&(A.start=A.start(u));c.isFunction(A.end)&&(A.end=A.end(u));var C=0<=z.toLowerCase().indexOf("color"),
E=function(B,D){var F={height:B.offsetHeight,width:B.offsetWidth}[D];if(void 0!==F)return F;F=q.get(B,D);return"opacity"==D?+F:C?F:parseFloat(F)};"end"in A?"start"in A||(A.start=E(u,z)):A.end=E(u,z);C?(A.start=new f(A.start),A.end=new f(A.end)):A.start="opacity"==z?+A.start:parseFloat(A.start)}this.curve=new t(y)}),!0);n.after(r,"onAnimate",c.hitch(q,"set",r.node),!0);return r};m.anim=function(r,u,y,z,A,C){return m.animateProperty({node:r,duration:y||w.prototype.duration,properties:u,easing:z,onEnd:A}).play(C||
0)};e(b,m);b._Animation=w;return m})},"dojo/touch":function(){define("./_base/kernel ./aspect ./dom ./dom-class ./_base/lang ./on ./has ./mouse ./domReady ./_base/window".split(" "),function(b,a,c,d,f,n,k,g,q,e){function m(B,D,F){return F?function(K,L){return n(K,F,L)}:x?function(K,L){var G=n(K,D,function(P){L.call(this,P);E=(new Date).getTime()}),O=n(K,B,function(P){(!E||(new Date).getTime()>E+1E3)&&L.call(this,P)});return{remove:function(){G.remove();O.remove()}}}:function(K,L){return n(K,B,L)}}
function l(B){do if(void 0!==B.dojoClick)return B;while(B=B.parentNode)}function w(B,D,F){if(!g.isRight(B)){var K=l(B.target);if(h=!B.target.disabled&&K&&K.dojoClick)if(r=(t="useTarget"==h)?K:B.target,t&&B.preventDefault(),u=B.changedTouches?B.changedTouches[0].pageX-e.global.pageXOffset:B.clientX,y=B.changedTouches?B.changedTouches[0].pageY-e.global.pageYOffset:B.clientY,z=("object"==typeof h?h.x:"number"==typeof h?h:0)||4,A=("object"==typeof h?h.y:"number"==typeof h?h:0)||4,!p){p=!0;var L=function(G){h=
t?c.isDescendant(e.doc.elementFromPoint(G.changedTouches?G.changedTouches[0].pageX-e.global.pageXOffset:G.clientX,G.changedTouches?G.changedTouches[0].pageY-e.global.pageYOffset:G.clientY),r):h&&(G.changedTouches?G.changedTouches[0].target:G.target)==r&&Math.abs((G.changedTouches?G.changedTouches[0].pageX-e.global.pageXOffset:G.clientX)-u)<=z&&Math.abs((G.changedTouches?G.changedTouches[0].pageY-e.global.pageYOffset:G.clientY)-y)<=A};e.doc.addEventListener(D,function(G){g.isRight(G)||(L(G),t&&G.preventDefault())},
!0);e.doc.addEventListener(F,function(G){if(!g.isRight(G)&&(L(G),h)){C=(new Date).getTime();var O=t?r:G.target;"LABEL"===O.tagName&&(O=c.byId(O.getAttribute("for"))||O);var P=G.changedTouches?G.changedTouches[0]:G,J=function(M){var V=document.createEvent("MouseEvents");V._dojo_click=!0;V.initMouseEvent(M,!0,!0,G.view,G.detail,P.screenX,P.screenY,P.clientX,P.clientY,G.ctrlKey,G.altKey,G.shiftKey,G.metaKey,0,null);return V},R=J("mousedown"),X=J("mouseup"),U=J("click");setTimeout(function(){n.emit(O,
"mousedown",R);n.emit(O,"mouseup",X);n.emit(O,"click",U);C=(new Date).getTime()},0)}},!0);B=function(G){e.doc.addEventListener(G,function(O){var P=O.target;h&&!O._dojo_click&&(new Date).getTime()<=C+1E3&&("INPUT"!=P.tagName||!d.contains(P,"dijitOffScreen"))&&(O.stopPropagation(),O.stopImmediatePropagation&&O.stopImmediatePropagation(),"click"==G&&("INPUT"!=P.tagName||"radio"==P.type&&(d.contains(P,"dijitCheckBoxInput")||d.contains(P,"mblRadioButton"))||"checkbox"==P.type&&(d.contains(P,"dijitCheckBoxInput")||
d.contains(P,"mblCheckBox")))&&"TEXTAREA"!=P.tagName&&"AUDIO"!=P.tagName&&"VIDEO"!=P.tagName&&O.preventDefault())},!0)};B("click");B("mousedown");B("mouseup")}}}k("ios");var v=function(){var B={},D;for(D in{down:1,move:1,up:1,cancel:1,over:1,out:1})B[D]="pointer"+D;return B}(),x=k("touch-events"),p,h,t=!1,r,u,y,z,A,C,E;k("touch")&&q(function(){e.doc.addEventListener(v.down,function(B){w(B,v.move,v.up)},!0)});a={press:m("mousedown","touchstart",v.down),move:m("mousemove","dojotouchmove",v.move),release:m("mouseup",
"dojotouchend",v.up),cancel:m(g.leave,"touchcancel",v.cancel),over:m("mouseover","dojotouchover",v.over),out:m("mouseout","dojotouchout",v.out),enter:g._eventHandler(m("mouseover","dojotouchover",v.over)),leave:g._eventHandler(m("mouseout","dojotouchout",v.out))};return b.touch=a})},"dojo/dnd/move":function(){define("../_base/declare ../dom-geometry ../dom-style ./common ./Mover ./Moveable".split(" "),function(b,a,c,d,f,n){d=b("dojo.dnd.move.constrainedMoveable",n,{constraints:function(){},within:!1,
constructor:function(k,g){g||(g={});this.constraints=g.constraints;this.within=g.within},onFirstMove:function(k){var g=this.constraintBox=this.constraints.call(this,k);g.r=g.l+g.w;g.b=g.t+g.h;this.within&&(k=a.getMarginSize(k.node),g.r-=k.w,g.b-=k.h)},onMove:function(k,g){var q=this.constraintBox,e=k.node.style;this.onMoving(k,g);g.l=g.l<q.l?q.l:q.r<g.l?q.r:g.l;g.t=g.t<q.t?q.t:q.b<g.t?q.b:g.t;e.left=g.l+"px";e.top=g.t+"px";this.onMoved(k,g)}});f=b("dojo.dnd.move.boxConstrainedMoveable",d,{box:{},
constructor:function(k,g){var q=g&&g.box;this.constraints=function(){return q}}});b=b("dojo.dnd.move.parentConstrainedMoveable",d,{area:"content",constructor:function(k,g){var q=g&&g.area;this.constraints=function(){var e=this.node.parentNode,m=c.getComputedStyle(e),l=a.getMarginBox(e,m);if("margin"==q)return l;var w=a.getMarginExtents(e,m);l.l+=w.l;l.t+=w.t;l.w-=w.w;l.h-=w.h;if("border"==q)return l;w=a.getBorderExtents(e,m);l.l+=w.l;l.t+=w.t;l.w-=w.w;l.h-=w.h;if("padding"==q)return l;w=a.getPadExtents(e,
m);l.l+=w.l;l.t+=w.t;l.w-=w.w;l.h-=w.h;return l}}});return{constrainedMoveable:d,boxConstrainedMoveable:f,parentConstrainedMoveable:b}})},"dojo/dnd/common":function(){define(["../sniff","../_base/kernel","../_base/lang","../dom"],function(b,a,c,d){var f=c.getObject("dojo.dnd",!0);f.getCopyKeyState=function(n){return n.metaKey};f._uniqueId=0;f.getUniqueId=function(){do var n=a._scopeName+"Unique"+ ++f._uniqueId;while(d.byId(n));return n};f._empty={};f.isFormElement=function(n){n=n.target;3==n.nodeType&&
(n=n.parentNode);return 0<=" a button textarea input select option ".indexOf(" "+n.tagName.toLowerCase()+" ")};return f})},"dojo/dnd/Mover":function(){define("../_base/array ../_base/declare ../_base/lang ../sniff ../_base/window ../dom ../dom-geometry ../dom-style ../Evented ../on ../touch ./common ./autoscroll".split(" "),function(b,a,c,d,f,n,k,g,q,e,m,l,w){return a("dojo.dnd.Mover",[q],{constructor:function(v,x,p){function h(t){t.preventDefault();t.stopPropagation()}this.node=n.byId(v);this.marginBox=
{l:x.pageX,t:x.pageY};this.mouseButton=x.button;x=this.host=p;v=v.ownerDocument;this.events=[e(v,m.move,c.hitch(this,"onFirstMove")),e(v,m.move,c.hitch(this,"onMouseMove")),e(v,m.release,c.hitch(this,"onMouseUp")),e(v,"dragstart",h),e(v.body,"selectstart",h)];w.autoScrollStart(v);if(x&&x.onMoveStart)x.onMoveStart(this)},onMouseMove:function(v){w.autoScroll(v);var x=this.marginBox;this.host.onMove(this,{l:x.l+v.pageX,t:x.t+v.pageY},v);v.preventDefault();v.stopPropagation()},onMouseUp:function(v){(d("webkit")&&
2==this.mouseButton?0==v.button:this.mouseButton==v.button)&&this.destroy();v.preventDefault();v.stopPropagation()},onFirstMove:function(v){var x=this.node.style,p=this.host;switch(x.position){case "relative":case "absolute":var h=Math.round(parseFloat(x.left))||0;x=Math.round(parseFloat(x.top))||0;break;default:x.position="absolute";x=k.getMarginBox(this.node);h=f.doc.body;var t=g.getComputedStyle(h),r=k.getMarginBox(h,t);t=k.getContentBox(h,t);h=x.l-(t.l-r.l);x=x.t-(t.t-r.t)}this.marginBox.l=h-
this.marginBox.l;this.marginBox.t=x-this.marginBox.t;if(p&&p.onFirstMove)p.onFirstMove(this,v);this.events.shift().remove()},destroy:function(){b.forEach(this.events,function(x){x.remove()});var v=this.host;if(v&&v.onMoveStop)v.onMoveStop(this);this.events=this.node=this.host=null}})})},"dojo/dnd/autoscroll":function(){define("../_base/lang ../sniff ../_base/window ../dom-geometry ../dom-style ../window".split(" "),function(b,a,c,d,f,n){var k={};b.setObject("dojo.dnd.autoscroll",k);k.getViewport=
n.getBox;k.V_TRIGGER_AUTOSCROLL=32;k.H_TRIGGER_AUTOSCROLL=32;k.V_AUTOSCROLL_VALUE=16;k.H_AUTOSCROLL_VALUE=16;var g,q=c.doc,e=Infinity,m=Infinity;k.autoScrollStart=function(l){q=l;g=n.getBox(q);l=c.body(q).parentNode;e=Math.max(l.scrollHeight-g.h,0);m=Math.max(l.scrollWidth-g.w,0)};k.autoScroll=function(l){var w=g||n.getBox(q),v=c.body(q).parentNode,x=0,p=0;l.clientX<k.H_TRIGGER_AUTOSCROLL?x=-k.H_AUTOSCROLL_VALUE:l.clientX>w.w-k.H_TRIGGER_AUTOSCROLL&&(x=Math.min(k.H_AUTOSCROLL_VALUE,m-v.scrollLeft));
l.clientY<k.V_TRIGGER_AUTOSCROLL?p=-k.V_AUTOSCROLL_VALUE:l.clientY>w.h-k.V_TRIGGER_AUTOSCROLL&&(p=Math.min(k.V_AUTOSCROLL_VALUE,e-v.scrollTop));window.scrollBy(x,p)};k._validNodes={div:1,p:1,td:1};k._validOverflow={auto:1,scroll:1};k.autoScrollNodes=function(l){for(var w,v,x,p,h,t=0,r=0,u=l.target;u;){if(1==u.nodeType&&u.tagName.toLowerCase()in k._validNodes){x=f.getComputedStyle(u);h=x.overflowX.toLowerCase()in k._validOverflow;p=x.overflowY.toLowerCase()in k._validOverflow;if(h||p)w=d.getContentBox(u,
x),v=d.position(u,!0);if(h){x=Math.min(k.H_TRIGGER_AUTOSCROLL,w.w/2);h=l.pageX-v.x;if(a("webkit")||a("opera"))h+=c.body().scrollLeft;t=0;0<h&&h<w.w&&(h<x?t=-x:h>w.w-x&&(t=x),u.scrollLeft+=t)}if(p){p=Math.min(k.V_TRIGGER_AUTOSCROLL,w.h/2);x=l.pageY-v.y;if(a("webkit")||a("opera"))x+=c.body().scrollTop;r=0;0<x&&x<w.h&&(x<p?r=-p:x>w.h-p&&(r=p),u.scrollTop+=r)}if(t||r)return}try{u=u.parentNode}catch(y){u=null}}k.autoScroll(l)};return k})},"dojo/window":function(){define("./_base/lang ./sniff ./_base/window ./dom ./dom-geometry ./dom-style ./dom-construct".split(" "),
function(b,a,c,d,f,n,k){a.add("rtl-adjust-position-for-verticalScrollBar",function(q,e){q=c.body(e);e=k.create("div",{style:{overflow:"scroll",overflowX:"visible",direction:"rtl",visibility:"hidden",position:"absolute",left:"0",top:"0",width:"64px",height:"64px"}},q,"last");var m=k.create("div",{style:{overflow:"hidden",direction:"ltr"}},e,"last"),l=0!=f.position(m).x;e.removeChild(m);q.removeChild(e);return l});a.add("position-fixed-support",function(q,e){q=c.body(e);e=k.create("span",{style:{visibility:"hidden",
position:"fixed",left:"1px",top:"1px"}},q,"last");var m=k.create("span",{style:{position:"fixed",left:"0",top:"0"}},e,"last"),l=f.position(m).x!=f.position(e).x;e.removeChild(m);q.removeChild(e);return l});var g={getBox:function(q){q=q||c.doc;var e="BackCompat"==q.compatMode?c.body(q):q.documentElement,m=f.docScroll(q);if(a("touch")){var l=g.get(q);q=l.innerWidth||e.clientWidth;e=l.innerHeight||e.clientHeight}else q=e.clientWidth,e=e.clientHeight;return{l:m.x,t:m.y,w:q,h:e}},get:function(q){if(a("ie")&&
g!==document.parentWindow){q.parentWindow.execScript("document._parentWindow \x3d window;","Javascript");var e=q._parentWindow;q._parentWindow=null;return e}return q.parentWindow||q.defaultView},scrollIntoView:function(q,e){try{q=d.byId(q);var m=q.ownerDocument||c.doc,l=c.body(m),w=m.documentElement||l.parentNode,v=a("ie")||0,x=a("webkit");if(q!=l&&q!=w){var p="BackCompat"==m.compatMode,h=Math.min(l.clientWidth||w.clientWidth,w.clientWidth||l.clientWidth),t=Math.min(l.clientHeight||w.clientHeight,
w.clientHeight||l.clientHeight);m=x||p?l:w;var r=e||f.position(q),u=q.parentNode;e=function(J){return 6>=v||7==v&&p?!1:a("position-fixed-support")&&"fixed"==n.get(J,"position").toLowerCase()};var y=this;x=function(J,R,X){"BODY"==J.tagName||"HTML"==J.tagName?y.get(J.ownerDocument).scrollBy(R,X):(R&&(J.scrollLeft+=R),X&&(J.scrollTop+=X))};if(!e(q))for(;u;){u==l&&(u=m);var z=f.position(u),A=e(u),C="rtl"==n.getComputedStyle(u).direction.toLowerCase();if(u==m)z.w=h,z.h=t,m==w&&v&&C&&(z.x+=m.offsetWidth-
z.w),z.x=0,z.y=0;else{var E=f.getPadBorderExtents(u);z.w-=E.w;z.h-=E.h;z.x+=E.l;z.y+=E.t;var B=u.clientWidth,D=z.w-B;0<B&&0<D&&(C&&a("rtl-adjust-position-for-verticalScrollBar")&&(z.x+=D),z.w=B);B=u.clientHeight;D=z.h-B;0<B&&0<D&&(z.h=B)}A&&(0>z.y&&(z.h+=z.y,z.y=0),0>z.x&&(z.w+=z.x,z.x=0),z.y+z.h>t&&(z.h=t-z.y),z.x+z.w>h&&(z.w=h-z.x));var F=r.x-z.x,K=r.y-z.y,L=F+r.w-z.w,G=K+r.h-z.h;if(0<L*F&&(u.scrollLeft||u==m||u.scrollWidth>u.offsetHeight)){var O=Math[0>F?"max":"min"](F,L);C&&8==v&&!p&&(O=-O);var P=
u.scrollLeft;x(u,O,0);O=u.scrollLeft-P;r.x-=O}0<G*K&&(u.scrollTop||u==m||u.scrollHeight>u.offsetHeight)&&(O=Math.ceil(Math[0>K?"max":"min"](K,G)),P=u.scrollTop,x(u,0,O),O=u.scrollTop-P,r.y-=O);u=u!=m&&!A&&u.parentNode}}}catch(J){console.error("scrollIntoView: "+J),q.scrollIntoView(!1)}}};b.setObject("dojo.window",g);return g})},"dojo/dnd/Moveable":function(){define("../_base/array ../_base/declare ../_base/lang ../dom ../dom-class ../Evented ../has ../on ../topic ../touch ./common ./Mover ../_base/window".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w){var v,x=function(){};x=function(p,h){"touchAction"in document.body.style?v="touchAction":"msTouchAction"in document.body.style&&(v="msTouchAction");x=function(t,r){t.style[v]=r};x(p,h)};return a("dojo.dnd.Moveable",[n],{handle:"",delay:0,skip:!1,constructor:function(p,h){this.node=d.byId(p);x(this.node,"none");h||(h={});this.handle=h.handle?d.byId(h.handle):null;this.handle||(this.handle=this.node);this.delay=0<h.delay?h.delay:0;this.skip=h.skip;this.mover=h.mover?
h.mover:l;this.events=[g(this.handle,e.press,c.hitch(this,"onMouseDown")),g(this.handle,"dragstart",c.hitch(this,"onSelectStart")),g(this.handle,"selectstart",c.hitch(this,"onSelectStart"))]},markupFactory:function(p,h,t){return new t(h,p)},destroy:function(){b.forEach(this.events,function(p){p.remove()});x(this.node,"");this.events=this.node=this.handle=null},onMouseDown:function(p){if(!this.skip||!m.isFormElement(p)){if(this.delay)this.events.push(g(this.handle,e.move,c.hitch(this,"onMouseMove")),
g(this.handle.ownerDocument,e.release,c.hitch(this,"onMouseUp"))),this._lastX=p.pageX,this._lastY=p.pageY;else this.onDragDetected(p);p.stopPropagation();p.preventDefault()}},onMouseMove:function(p){if(Math.abs(p.pageX-this._lastX)>this.delay||Math.abs(p.pageY-this._lastY)>this.delay)this.onMouseUp(p),this.onDragDetected(p);p.stopPropagation();p.preventDefault()},onMouseUp:function(p){for(var h=0;2>h;++h)this.events.pop().remove();p.stopPropagation();p.preventDefault()},onSelectStart:function(p){this.skip&&
m.isFormElement(p)||(p.stopPropagation(),p.preventDefault())},onDragDetected:function(p){new this.mover(this.node,p,this)},onMoveStart:function(p){q.publish("/dnd/move/start",p);f.add(w.body(),"dojoMove");f.add(this.node,"dojoMoveItem")},onMoveStop:function(p){q.publish("/dnd/move/stop",p);f.remove(w.body(),"dojoMove");f.remove(this.node,"dojoMoveItem")},onFirstMove:function(){},onMove:function(p,h){this.onMoving(p,h);var t=p.node.style;t.left=h.l+"px";t.top=h.t+"px";this.onMoved(p,h)},onMoving:function(){},
onMoved:function(){}})})},"dijit/_WidgetBase":function(){define("require dojo/_base/array dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/_base/kernel dojo/_base/lang dojo/on dojo/ready dojo/Stateful dojo/topic dojo/_base/window ./Destroyable dojo/has!dojo-bidi?./_BidiMixin ./registry".split(" "),function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A){function C(B){return function(D){g[D?
"set":"remove"](this.domNode,B,D);this._set(B,D)}}w.add("dijit-legacy-requires",!v.isAsync);w.add("dojo-bidi",!1);w("dijit-legacy-requires")&&h(0,function(){b(["dijit/_base/manager"])});var E={};d=n("dijit._WidgetBase",[t,y],{id:"",_setIdAttr:"domNode",lang:"",_setLangAttr:C("lang"),dir:"",_setDirAttr:C("dir"),"class":"",_setClassAttr:{node:"domNode",type:"class"},_setTypeAttr:null,style:"",title:"",tooltip:"",baseClass:"",srcNodeRef:null,domNode:null,containerNode:null,ownerDocument:null,_setOwnerDocumentAttr:function(B){this._set("ownerDocument",
B)},attributeMap:{},_blankGif:d.blankGif||b.toUrl("dojo/resources/blank.gif"),textDir:"",_introspect:function(){var B=this.constructor;if(!B._setterAttrs){var D=B.prototype,F=B._setterAttrs=[];B=B._onMap={};for(var K in D.attributeMap)F.push(K);for(K in D)/^on/.test(K)&&(B[K.substring(2).toLowerCase()]=K),/^_set[A-Z](.*)Attr$/.test(K)&&(K=K.charAt(4).toLowerCase()+K.substr(5,K.length-9),D.attributeMap&&K in D.attributeMap||F.push(K))}},postscript:function(B,D){this.create(B,D)},create:function(B,
D){this._introspect();this.srcNodeRef=k.byId(D);this._connects=[];this._supportingWidgets=[];this.srcNodeRef&&this.srcNodeRef.id&&"string"==typeof this.srcNodeRef.id&&(this.id=this.srcNodeRef.id);B&&(this.params=B,x.mixin(this,B));this.postMixInProperties();this.id||(this.id=A.getUniqueId(this.declaredClass.replace(/\./g,"_")),this.params&&delete this.params.id);this.ownerDocument=this.ownerDocument||(this.srcNodeRef?this.srcNodeRef.ownerDocument:document);this.ownerDocumentBody=u.body(this.ownerDocument);
A.add(this);this.buildRendering();if(this.domNode){this._applyAttributes();if((B=this.srcNodeRef)&&B.parentNode&&this.domNode!==B){B.parentNode.replaceChild(this.domNode,B);var F=!0}this.domNode.setAttribute("widgetId",this.id)}this.postCreate();F&&delete this.srcNodeRef;this._created=!0},_applyAttributes:function(){var B={},D;for(D in this.params||{})B[D]=this._get(D);a.forEach(this.constructor._setterAttrs,function(F){if(!(F in B)){var K=this._get(F);K&&this.set(F,K)}},this);for(D in B)this.set(D,
B[D])},postMixInProperties:function(){},buildRendering:function(){this.domNode||(this.domNode=this.srcNodeRef||this.ownerDocument.createElement("div"));if(this.baseClass){var B=this.baseClass.split(" ");this.isLeftToRight()||(B=B.concat(a.map(B,function(D){return D+"Rtl"})));q.add(this.domNode,B)}},postCreate:function(){},startup:function(){this._started||(this._started=!0,a.forEach(this.getChildren(),function(B){B._started||B._destroyed||!x.isFunction(B.startup)||(B.startup(),B._started=!0)}))},
destroyRecursive:function(B){this._beingDestroyed=!0;this.destroyDescendants(B);this.destroy(B)},destroy:function(B){function D(F){F.destroyRecursive?F.destroyRecursive(B):F.destroy&&F.destroy(B)}this._beingDestroyed=!0;this.uninitialize();a.forEach(this._connects,x.hitch(this,"disconnect"));a.forEach(this._supportingWidgets,D);this.domNode&&a.forEach(A.findWidgets(this.domNode,this.containerNode),D);this.destroyRendering(B);A.remove(this.id);this._destroyed=!0},destroyRendering:function(B){this.bgIframe&&
(this.bgIframe.destroy(B),delete this.bgIframe);this.domNode&&(B?g.remove(this.domNode,"widgetId"):e.destroy(this.domNode),delete this.domNode);this.srcNodeRef&&(B||e.destroy(this.srcNodeRef),delete this.srcNodeRef)},destroyDescendants:function(B){a.forEach(this.getChildren(),function(D){D.destroyRecursive&&D.destroyRecursive(B)})},uninitialize:function(){return!1},_setStyleAttr:function(B){var D=this.domNode;x.isObject(B)?l.set(D,B):D.style.cssText=D.style.cssText?D.style.cssText+("; "+B):B;this._set("style",
B)},_attrToDom:function(B,D,F){F=3<=arguments.length?F:this.attributeMap[B];a.forEach(x.isArray(F)?F:[F],function(K){var L=this[K.node||K||"domNode"];switch(K.type||"attribute"){case "attribute":x.isFunction(D)&&(D=x.hitch(this,D));K=K.attribute?K.attribute:/^on[A-Z][a-zA-Z]*$/.test(B)?B.toLowerCase():B;L.tagName?g.set(L,K,D):L.set(K,D);break;case "innerText":L.innerHTML="";L.appendChild(this.ownerDocument.createTextNode(D));break;case "textContent":L.textContent=D;break;case "innerHTML":L.innerHTML=
D;break;case "class":q.replace(L,D,this[B]);break;case "toggleClass":q.toggle(L,K.className||B,D)}},this)},get:function(B){var D=this._getAttrNames(B);return this[D.g]?this[D.g]():this._get(B)},set:function(B,D){if("object"===typeof B){for(var F in B)this.set(F,B[F]);return this}F=this._getAttrNames(B);var K=this[F.s];if(x.isFunction(K))var L=K.apply(this,Array.prototype.slice.call(arguments,1));else{K=this.focusNode&&!x.isFunction(this.focusNode)?"focusNode":"domNode";var G=this[K]&&this[K].tagName,
O;if((O=G)&&!(O=E[G])){O=this[K];var P={};for(J in O)P[J.toLowerCase()]=!0;O=E[G]=P}var J=O;F=B in this.attributeMap?this.attributeMap[B]:F.s in this?this[F.s]:J&&F.l in J&&"function"!=typeof D||/^aria-|^data-|^role$/.test(B)?K:null;null!=F&&this._attrToDom(B,D,F);this._set(B,D)}return L||this},_attrPairNames:{},_getAttrNames:function(B){var D=this._attrPairNames;if(D[B])return D[B];var F=B.replace(/^[a-z]|-[a-zA-Z]/g,function(K){return K.charAt(K.length-1).toUpperCase()});return D[B]={n:B+"Node",
s:"_set"+F+"Attr",g:"_get"+F+"Attr",l:F.toLowerCase()}},_set:function(B,D){var F=this[B];this[B]=D;!this._created||F===D||F!==F&&D!==D||(this._watchCallbacks&&this._watchCallbacks(B,F,D),this.emit("attrmodified-"+B,{detail:{prevValue:F,newValue:D}}))},_get:function(B){return this[B]},emit:function(B,D,F){D=D||{};void 0===D.bubbles&&(D.bubbles=!0);void 0===D.cancelable&&(D.cancelable=!0);D.detail||(D.detail={});D.detail.widget=this;var K,L=this["on"+B];L&&(K=L.apply(this,F?F:[D]));this._started&&!this._beingDestroyed&&
p.emit(this.domNode,B.toLowerCase(),D);return K},on:function(B,D){var F=this._onMap(B);return F?c.after(this,F,D,!0):this.own(p(this.domNode,B,D))[0]},_onMap:function(B){var D=this.constructor,F=D._onMap;if(!F){F=D._onMap={};for(var K in D.prototype)/^on/.test(K)&&(F[K.replace(/^on/,"").toLowerCase()]=K)}return F["string"==typeof B&&B.toLowerCase()]},toString:function(){return"[Widget "+this.declaredClass+", "+(this.id||"NO ID")+"]"},getChildren:function(){return this.containerNode?A.findWidgets(this.containerNode):
[]},getParent:function(){return A.getEnclosingWidget(this.domNode.parentNode)},connect:function(B,D,F){return this.own(f.connect(B,D,this,F))[0]},disconnect:function(B){B.remove()},subscribe:function(B,D){return this.own(r.subscribe(B,x.hitch(this,D)))[0]},unsubscribe:function(B){B.remove()},isLeftToRight:function(){return this.dir?"ltr"==this.dir.toLowerCase():m.isBodyLtr(this.ownerDocument)},isFocusable:function(){return this.focus&&"none"!=l.get(this.domNode,"display")},placeAt:function(B,D){var F=
!B.tagName&&A.byId(B);!F||!F.addChild||D&&"number"!==typeof D?(B=F&&"domNode"in F?F.containerNode&&!/after|before|replace/.test(D||"")?F.containerNode:F.domNode:k.byId(B,this.ownerDocument),e.place(this.domNode,B,D),!this._started&&(this.getParent()||{})._started&&this.startup()):F.addChild(this,D);return this},defer:function(B,D){var F=setTimeout(x.hitch(this,function(){F&&(F=null,this._destroyed||x.hitch(this,B)())}),D||0);return{remove:function(){F&&(clearTimeout(F),F=null);return null}}}});w("dojo-bidi")&&
d.extend(z);return d})},"dojo/Stateful":function(){define(["./_base/declare","./_base/lang","./_base/array","./when"],function(b,a,c,d){return b("dojo.Stateful",null,{_attrPairNames:{},_getAttrNames:function(f){var n=this._attrPairNames;return n[f]?n[f]:n[f]={s:"_"+f+"Setter",g:"_"+f+"Getter"}},postscript:function(f){f&&this.set(f)},_get:function(f,n){return"function"===typeof this[n.g]?this[n.g]():this[f]},get:function(f){return this._get(f,this._getAttrNames(f))},set:function(f,n){if("object"===
typeof f){for(var k in f)f.hasOwnProperty(k)&&"_watchCallbacks"!=k&&this.set(k,f[k]);return this}k=this._getAttrNames(f);var g=this._get(f,k);k=this[k.s];var q;"function"===typeof k?q=k.apply(this,Array.prototype.slice.call(arguments,1)):this[f]=n;if(this._watchCallbacks){var e=this;d(q,function(){e._watchCallbacks(f,g,n)})}return this},_changeAttrValue:function(f,n){var k=this.get(f);this[f]=n;this._watchCallbacks&&this._watchCallbacks(f,k,n);return this},watch:function(f,n){var k=this._watchCallbacks;
if(!k){var g=this;k=this._watchCallbacks=function(e,m,l,w){var v=function(x){if(x){x=x.slice();for(var p=0,h=x.length;p<h;p++)x[p].call(g,e,m,l)}};v(k["_"+e]);w||v(k["*"])}}n||"function"!==typeof f?f="_"+f:(n=f,f="*");var q=k[f];"object"!==typeof q&&(q=k[f]=[]);q.push(n);f={};f.unwatch=f.remove=function(){var e=c.indexOf(q,n);-1<e&&q.splice(e,1)};return f}})})},"dijit/Destroyable":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare"],function(b,a,c){return c("dijit.Destroyable",
null,{destroy:function(d){this._destroyed=!0},own:function(){var d=["destroyRecursive","destroy","remove"];b.forEach(arguments,function(f){function n(){k.remove();b.forEach(g,function(e){e.remove()})}var k=a.before(this,"destroy",function(e){f[q](e)}),g=[];if(f.then){var q="cancel";f.then(n,n)}else b.forEach(d,function(e){"function"===typeof f[e]&&(q||(q=e),g.push(a.after(f,e,n,!0)))})},this);return arguments}})})},"dijit/registry":function(){define(["dojo/_base/array","dojo/_base/window","./main"],
function(b,a,c){var d={},f={},n={length:0,add:function(k){if(f[k.id])throw Error("Tried to register widget with id\x3d\x3d"+k.id+" but that id is already registered");f[k.id]=k;this.length++},remove:function(k){f[k]&&(delete f[k],this.length--)},byId:function(k){return"string"==typeof k?f[k]:k},byNode:function(k){return f[k.getAttribute("widgetId")]},toArray:function(){var k=[],g;for(g in f)k.push(f[g]);return k},getUniqueId:function(k){do var g=k+"_"+(k in d?++d[k]:d[k]=0);while(f[g]);return"dijit"==
c._scopeName?g:c._scopeName+"_"+g},findWidgets:function(k,g){function q(m){for(m=m.firstChild;m;m=m.nextSibling)if(1==m.nodeType){var l=m.getAttribute("widgetId");l?(l=f[l])&&e.push(l):m!==g&&q(m)}}var e=[];q(k);return e},_destroyAll:function(){c._curFocus=null;c._prevFocus=null;c._activeStack=[];b.forEach(n.findWidgets(a.body()),function(k){k._destroyed||(k.destroyRecursive?k.destroyRecursive():k.destroy&&k.destroy())})},getEnclosingWidget:function(k){for(;k;){var g=1==k.nodeType&&k.getAttribute("widgetId");
if(g)return f[g];k=k.parentNode}return null},_hash:f};return c.registry=n})},"jimu/portalUtils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/config dojo/Deferred dojo/topic dojo/json esri/request ./utils ./portalUrlUtils ./tokenUtils".split(" "),function(b,a,c,d,f,n,k,g,q,e,m){var l=b([],{declaredClass:"jimu.Portal",selfUrl:null,user:null,selfInfo:null,portalUrl:null,credential:null,constructor:function(h){this.portalUrl=e.getStandardPortalUrl(h);this.selfUrl=
e.getPortalSelfInfoUrl(h)},loadSelfInfo:function(){var h=new f,t={query:{f:"json"},responseType:"json",callbackParamName:"callback",cacheBust:!0};this.isValidCredential()&&(t.query.token=this.credential.token);g(this.selfUrl,t).then(a.hitch(this,function(r){r=r.data;var u=r.user;delete r.user;a.mixin(this,r);r.user=u;h.resolve(r)}),a.hitch(this,function(r){console.error(r);h.reject(r)}));return h},_checkCredential:function(){var h=m.isValidCredential(this.credential);h||this.clearCredentialAndUser();
return h},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.credential=m.getPortalCredential(this.portalUrl))},signIn:function(){var h=new f;this.updateCredential();this.isValidCredential()?setTimeout(a.hitch(this,function(){h.resolve(this.credential)}),0):h=m.signInPortal(this.portalUrl);return h},haveSignIn:function(){return m.userHaveSignInPortal(this.portalUrl)},clearCredentialAndUser:function(){this.user=
this.credential=null},getSigninSettingsOfSelfInfo:function(){this.updateCredential();var h=new f,t=this.selfUrl+"/signinSettings";this.isValidCredential()?g(t,{handleAs:"json",query:{f:"json",token:this.credential.token},callbackParamName:"callback"}).then(a.hitch(this,function(r){h.resolve(r.data)}),a.hitch(this,function(r){h.reject(r)})):h.resolve({});return h},getUser:function(){this.updateCredential();var h=new f;this.user&&"jimu.PortalUser"===this.user.declaredClass?setTimeout(a.hitch(this,function(){this.user.updateCredential();
h.resolve(this.user)}),0):this.isValidCredential()?this.credential.userId?this._getUser(this.credential.userId).then(a.hitch(this,function(t){this.user=t;h.resolve(this.user)}),a.hitch(this,function(t){console.error(t);h.reject(t)})):m.getUserIdByToken(this.credential.token,this.portalUrl).then(a.hitch(this,function(t){this.credential.userId=t;this._getUser(this.credential.userId).then(a.hitch(this,function(r){this.user=r;h.resolve(this.user)}),a.hitch(this,function(r){console.error(r);h.reject(r)}))}),
a.hitch(this,function(t){console.error(t);h.reject(t)})):setTimeout(a.hitch(this,function(){h.reject("credential is null.")}),0);return h},queryItems:function(h){this.updateCredential();var t=new f,r=e.getBaseSearchUrl(this.portalUrl),u={f:"json"};h&&(u=a.mixin(u,h));this.isValidCredential()&&(u.token=this.credential.token);u.sortField||u.sortOrder||(u.sortField="title",u.sortOrder="asc");g(r,{responseType:"json",query:u,callbackParamName:"callback"}).then(a.hitch(this,function(y){y=y.data;y.results=
c.map(y.results,a.hitch(this,function(z){z.portalUrl=this.portalUrl;z.credential=this.credential;z.portal=this;return new x(z)}));t.resolve(y)}),a.hitch(this,function(y){console.error(y);t.reject(y)}));return t},getItemData:function(h){this.updateCredential();h=e.getItemDataUrl(this.portalUrl,h);var t={responseType:"json",query:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(t.query.token=this.credential.token);var r=new f;g(h,t).then(a.hitch(this,function(u){r.resolve(u.data)}),
a.hitch(this,function(u){r.reject(u)}));return r},getItemById:function(h){var t=new f;this.updateCredential();h=e.getItemUrl(this.portalUrl,h);var r={responseType:"json",query:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(r.query.token=this.credential.token);g(h,r).then(a.hitch(this,function(u){u=u.data;u.portalUrl=this.portalUrl;u.credential=this.credential;u.portal=this;u=new x(u);t.resolve(u)}),a.hitch(this,function(u){console.error(u);t.reject(u)}));return t},getAppById:function(h){var t=
new f;this.updateCredential();this.isValidCredential()?(h=e.getAppIdUrl(this.portalUrl,h),g(h,{responseType:"json",query:{f:"json",token:this.credential.token}}).then(a.hitch(this,function(r){t.resolve(r.data)}),a.hitch(this,function(r){t.reject(r)}))):setTimeout(a.hitch(this,function(){t.reject("token is null.")}),0);return t},queryGroups:function(h){this.updateCredential();var t=new f,r=e.getBaseGroupUrl(this.portalUrl),u={f:"json"};h&&(u=a.mixin(u,h));this.isValidCredential()&&(u.token=this.credential.token);
g(r,{responseType:"json",query:u,callbackParamName:"callback"}).then(a.hitch(this,function(y){y=y.data;y.results=c.map(y.results,a.hitch(this,function(z){z.portalUrl=this.portalUrl;z.credential=this.credential;z.portal=this;return new v(z)}));t.resolve(y)}),a.hitch(this,function(y){console.error(y);t.reject(y)}));return t},registerApp:function(h,t,r){var u=new f;this.updateCredential();if(this.isValidCredential()){var y=this.credential&&this.credential.token,z=e.getOAuth2Url(this.portalUrl);g(z+"/registerApp",
{query:{itemId:h,appType:t,redirect_uris:k.stringify(r),token:y,f:"json"},responseType:"json",method:"post"}).then(a.hitch(this,function(A){u.resolve(A.data)}),a.hitch(this,function(A){u.reject(A)}))}else setTimeout(a.hitch(this,function(){u.reject("token is null.")}),0);return u},createAndRegisterApp:function(h){var t=new f;this.updateCredential();this.isValidCredential()?this.getUser().then(a.hitch(this,function(r){r.addItem({title:"ArcGIS Web AppBuilder",type:"Web Mapping Application",text:"",
snippet:"",tags:"Registered App for OAuth"},"").then(a.hitch(this,function(u){u.success?this.registerApp(u.id,"browser",h).then(a.hitch(this,function(y){t.resolve(y)}),a.hitch(this,function(y){console.error(y);t.reject(y)})):t.reject("create app failed")}),a.hitch(this,function(u){console.error(u);t.reject(u)}))}),a.hitch(this,function(r){console.error(r);t.reject(r)})):setTimeout(a.hitch(this,function(){t.reject("token is null.")}),0);return t},_getUser:function(h){this.updateCredential();var t=
new f;h=e.getUserUrl(this.portalUrl,h);var r={query:{f:"json"},responseType:"json",callbackParamName:"callback"};this.isValidCredential()&&(r.query.token=this.credential&&this.credential.token);g(h,r).then(a.hitch(this,function(u){u=u.data;u.portalUrl=this.portalUrl;u.credential=this.credential;u.portal=this;this.user=new w(u);t.resolve(this.user)}),a.hitch(this,function(u){console.error(u);t.reject(u)}));return t},getItemResources:function(h,t,r){r||(r=100);h=e.getStandardPortalUrl(h);h=e.getItemResourceUrl(h,
t);return g({url:h,content:{f:"json",num:r}}).then(function(u){if(u&&u.resources)return u.resources})},addResource:function(h,t,r,u,y){h=e.getStandardPortalUrl(h);var z=this.getPortal(h),A=new FormData;A.append("file",r,u);A.append("fileName",u);A.append("f","json");var C="";y?(A.append("resourcesPrefix",y),C=y+"/"+u):C=u;return z.getItemById(t,!0).then(function(E){E=e.getUserContentItemUrl(h,E.owner,t);return g({url:E+"/addResources",form:A}).then(function(B){var D="";B&&B.success&&(D=e.getItemResourceUrl(h,
"${itemId}",C));return D},function(B){console.error(B.message||B);return B})})},removeResources:function(h,t,r,u){var y={resource:u?u+"/"+r:r,f:"json"};h=e.getStandardPortalUrl(h);return this.getPortal(h).getItemById(t,!0).then(function(z){z=e.getUserContentItemUrl(h,z.owner,t);return g({url:z+"/removeResources",content:y},{usePost:!0}).then(function(A){return A},function(A){console.error(A.message||A);return A})})}}),w=b([],{declaredClass:"jimu.PortalUser",portalUrl:null,credential:null,portal:null,
constructor:function(h){h&&a.mixin(this,h)},_checkCredential:function(){var h=m.isValidCredential(this.credential);h||(this.credential=null);return h},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},getGroups:function(){var h=[];this.groups&&(h=c.map(this.groups,a.hitch(this,function(t){t.portalUrl=this.portalUrl;t.credential=this.credential;
t.portal=this.portal;return new v(t)})));return h},getItemsByKeywords:function(h,t){return this.portal.queryItems({start:t||1,num:100,q:"owner:"+this.username+' AND typekeywords:"'+h+'"'})},getContent:function(){this.updateCredential();var h=e.getUserContentUrl(this.portalUrl,this.username),t={responseType:"json",query:{f:"json"},callbackParamName:"callback"};this.isValidCredential&&(t.query.token=this.credential.token);var r=new f;g(h,t).then(a.hitch(this,function(u){r.resolve(u.data)}),a.hitch(this,
function(u){r.reject(u)}));return r},getTags:function(){this.updateCredential();var h=e.getUserTagsUrl(this.portalUrl,this.username),t={responseType:"json",query:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(t.query.token=this.credential.token);var r=new f;g(h,t).then(a.hitch(this,function(u){r.resolve(u.data)}),a.hitch(this,function(u){r.reject(u)}));return r},addItem:function(h,t){this.updateCredential();var r=new f;if(this.isValidCredential()){var u={f:"json",token:this.credential.token};
h&&(u=a.mixin(u,h));h=e.getAddItemUrl(this.portalUrl,this.username,t);g(h,{responseType:"json",callbackParamName:"callback",query:u,method:"post"}).then(a.hitch(this,function(y){r.resolve(y.data)}),a.hitch(this,function(y){console.error(y);r.reject(y)}))}else setTimeout(a.hitch(this,function(){r.reject("token is null.")}),0);return r},deleteItem:function(h){this.updateCredential();var t=new f;this.isValidCredential()?(h=e.getDeleteItemUrl(this.portalUrl,this.username,h),g(h,{query:{token:this.credential.token,
f:"json"},responseType:"json",method:"post"}).then(a.hitch(this,function(r){t.resolve(r.data)}),a.hitch(this,function(r){t.reject(r)}))):setTimeout(a.hitch(this,function(){t.reject("token is null.")}),0);return t},getItemById:function(h,t){this.updateCredential();var r=new f;t=e.getUserItemsUrl(this.portalUrl,this.username,t);var u={responseType:"json",query:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(u.query.token=this.credential.token);g(t+"/"+h,u).then(a.hitch(this,function(y){y=
y.data;y.portalUrl=this.portalUrl;y.credential=this.credential;y.portal=this;y=new x(y);r.resolve(y)}),a.hitch(this,function(y){console.error(y);r.reject(y)}));return r},shareItem:function(h,t,r){this.updateCredential();var u=new f;this.isValidCredential()?(t=e.shareItemUrl(this.portalUrl,this.username,t,r),r={responseType:"json",callbackParamName:"callback",query:{f:"json",token:this.credential.token},method:"post"},h&&(h.content&&!h.query&&(h.query=h.content),r.query=a.mixin(r.query,h)),g(t,r).then(a.hitch(this,
function(y){u.resolve(y.data)}),a.hitch(this,function(y){console.error(y);u.reject(y)}))):setTimeout(a.hitch(this,function(){u.reject("token is null.")}),0);return u},updateItem:function(h,t){this.updateCredential();var r=new f;this.isValidCredential()?this.portal.getItemById(h).then(a.hitch(this,function(u){var y={f:"json",token:this.credential.token};t&&(y=a.mixin(y,t));u=e.getUpdateItemUrl(this.portalUrl,this.username,h,u.ownerFolder);g(u,{responseType:"json",callbackParamName:"callback",timeout:1E5,
query:y,method:"post"}).then(a.hitch(this,function(z){r.resolve(z.data)}),a.hitch(this,function(z){console.error(z);r.reject(z)}))}),a.hitch(this,function(u){console.error(u);r.reject(u)})):setTimeout(a.hitch(this,function(){r.reject("token is null.")}),0);return r},isAdminRole:function(){return"org_admin"===this.role||"account_admin"===this.role},isPublisherRole:function(){return"org_publisher"===this.role||"account_publisher"===this.role},isUserRole:function(){return"org_user"===this.role||"account_user"===
this.role}}),v=b([],{declaredClass:"jimu.PortalGroup",portalUrl:null,credential:null,portal:null,constructor:function(h){h&&a.mixin(this,h)},_checkCredential:function(){var h=m.isValidCredential(this.credential);h||(this.credential=null);return h},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},queryItems:function(h){h.q="group:"+this.id+
" AND "+h.q;return this.portal.queryItems(h)}}),x=b([],{declaredClass:"jimu.PortalItem",itemUrl:null,detailsPageUrl:null,ownerPageUrl:null,portalUrl:null,credential:null,portal:null,token:null,constructor:function(h){h&&a.mixin(this,h);this.itemUrl=e.getItemUrl(this.portalUrl,this.id);!this.thumbnailUrl&&this.thumbnail&&this.itemUrl&&(this.thumbnailUrl=this.itemUrl+"/info/"+this.thumbnail);this.token=this.credential&&this.credential.token;this.thumbnailUrl&&this.token&&(this.thumbnailUrl+="?token\x3d"+
this.token);this.portalUrl&&this.id&&(this.detailsPageUrl=e.getItemDetailsPageUrl(this.portalUrl,this.id));this.portalUrl&&this.owner&&(this.ownerPageUrl=e.getUserProfilePageUrl(this.portalUrl,this.owner))},_checkCredential:function(){var h=m.isValidCredential(this.credential);h||(this.credential=null);return h},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},
getItemData:function(){return this.portal.getItemData(this.id)}}),p={portals:[],webMapQueryStr:" "+q.getItemQueryStringByTypes(["Web Map"])+" ",webSceneQueryStr:" "+q.getItemQueryStringByTypes(["Web Scene"])+" ",_findPortal:function(h){for(var t=0;t<this.portals.length;t++){var r=this.portals[t];if(e.isSamePortalUrl(h,r.portalUrl))return r.updateCredential(),r}return null},getPortal:function(h){if(!h||"string"!==typeof h||!a.trim(h))return null;h=e.getStandardPortalUrl(h);var t=this._findPortal(h);
t||(t=new l(h),t.credential=m.getPortalCredential(t.portalUrl),t.updateCredential(),this.portals.push(t));return t},getPortalSelfInfo:function(h){return this.getPortal(h).loadSelfInfo()},getBasemapGalleryGroup:function(h){return this._getPortalSelfGroup(h,"basemapGalleryGroupQuery")},getTemplatesGroup:function(h){return this._getPortalSelfGroup(h,"templatesGroupQuery")},getUnits:function(h){var t="english",r="",u=new f;this.getPortal(h).getUser().then(a.hitch(this,function(y){y&&y.units?t=y.units:
(r=d.locale,t=r.startWith("en")?"english":"metric");u.resolve(t)}),a.hitch(this,function(y){console.warn(y);this.getPortalSelfInfo(h).then(a.hitch(this,function(z){var A=null;z&&z.units?A=z.units:(r=z&&z.culture||d.locale,A=r.startWith("en")?"english":"metric");u.resolve(A)}),a.hitch(this,function(z){console.warn(z);r=d.locale;t=r.startWith("en")?"english":"metric";u.resolve(t)}))}));return u.promise},_getPortalSelfGroup:function(h,t){var r=new f,u=this.getPortal(h);u||setTimeout(a.hitch(this,function(){r.reject()}),
0);this.getPortalSelfInfo(h).then(a.hitch(this,function(y){u.queryGroups({f:"json",q:y[t]}).then(a.hitch(this,function(z){0<z.results.length?(z=z.results[0],z.portalUrl=u.portalUrl,z.credential=u.credential,z.portal=u,z=new v(z),r.resolve(z)):r.reject("Can't find portal self group.")}),a.hitch(this,function(z){console.error(z);r.reject(z)}))}),a.hitch(this,function(y){console.error(y);r.reject(y)}));return r},getWebMapsFromBasemapGalleryGroup:function(h){var t=new f;this.getBasemapGalleryGroup(h).then(a.hitch(this,
function(r){r?r.queryItems({start:1,num:100,f:"json",q:this.webMapQueryStr}).then(a.hitch(this,function(u){t.resolve(u)}),a.hitch(this,function(u){console.error(u);t.reject(u)})):t.reject()}),a.hitch(this,function(r){console.error(r);t.reject(r)}));return t},getDefaultWebScene:function(h){var t=new f,r=this.getPortal(h);r.getUser().then(a.hitch(this,function(u){r.queryItems({start:1,num:1,f:"json",q:this.webSceneQueryStr+' AND owner:"'+u.username+'" ',sortField:"numViews",sortOrder:"desc"}).then(a.hitch(this,
function(y){y=y.results;y=c.filter(y,a.hitch(this,function(z){return z.type&&"web scene"===z.type.toLowerCase()}));0<y.length?t.resolve(y[0].id):t.resolve(null)}),a.hitch(this,function(y){t.reject(y)}))}),a.hitch(this,function(){t.reject("not sign in")}));return t},getDefaultWebMap:function(h){var t=new f;this.getPortalSelfInfo(h).then(a.hitch(this,function(r){var u=r.defaultBasemap&&r.defaultBasemap.id;u?t.resolve(u):this._getDefaultWebMapByBasemapGallery(h,r).then(a.hitch(this,function(y){y?t.resolve(y):
this._getMostNumViewsWebMap(h).then(a.hitch(this,function(z){z?t.resolve(z):t.reject()}),a.hitch(this,function(z){console.error(z);t.reject(z)}))}),a.hitch(this,function(y){console.error(y);t.reject(y)}))}),a.hitch(this,function(r){console.error(r);t.reject(r)}));return t},_getDefaultWebMapByBasemapGallery:function(h,t){var r=new f,u=this.getPortal(h),y=t.defaultBasemap&&t.defaultBasemap.title;u.queryGroups({f:"json",q:t.basemapGalleryGroupQuery}).then(a.hitch(this,function(z){z=z.results;0<z.length?
u.queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND group:"+z[0].id+" AND title:"+y}).then(a.hitch(this,function(A){A=A.results;A=c.filter(A,a.hitch(this,function(C){return C.type&&"web map"===C.type.toLowerCase()}));0<A.length?r.resolve(A[0].id):(console.log("Can't find web map under basemapGalleryGroupQuery."),u.queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND title:"+y}).then(a.hitch(this,function(C){C=C.results;C=c.filter(C,a.hitch(this,function(B){return B.type&&"web map"===
B.type.toLowerCase()}));if(0<C.length){var E=C[0];u.getItemData(E.id).then(a.hitch(this,function(B){B&&(B.operationalLayers||B.baseMap||B.version)?r.resolve(E.id):r.resolve(null)}),a.hitch(this,function(){r.resolve(null)}))}else console.log("Can't find web map by defaultBasemap.title."),r.resolve(null)}),a.hitch(this,function(C){console.error(C);r.reject(C)})))}),a.hitch(this,function(A){console.error(A);r.reject(A)})):(console.log("Can't find group by basemapGalleryGroupQuery."),r.resolve(null))}),
a.hitch(this,function(z){console.error(z);r.reject(z)}));return r},_getMostNumViewsWebMap:function(h){var t=new f;this.getPortal(h).queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND access:public AND owner:esri_en",sortField:"numViews",sortOrder:"desc"}).then(a.hitch(this,function(r){r=r.results;r=c.filter(r,a.hitch(this,function(u){return u.type&&"web map"===u.type.toLowerCase()}));0<r.length?t.resolve(r[0].id):t.reject("Can't find most-num-views web map.")}),a.hitch(this,function(r){console.error(r);
t.reject(r)}));return t}};n.subscribe("userSignOut",function(h){(h=p._findPortal(h))&&h.clearCredentialAndUser()});return p})},"jimu/shared/AppVersionManager":function(){define(["./BaseVersionManager"],function(b){function a(){this.versions=[{version:"2.0beta",description:"The version for Developer Edition beta 2.0.",upgrader:function(c){return c},compatible:!0},{version:"2.0",description:"The version for Online 4.1.",upgrader:function(c){return c},compatible:!0},{version:"2.0.1",description:"The version for Developer Edition 2.0.",
upgrader:function(c){var d=null,f=0,n=c.widgetOnScreen.widgets;if(n&&0<n.length)for(f=0;f<n.length;f++)d=n[f],"widgets/Viz/Widget"===d.uri&&(d.uri="widgets/3DFx/Widget",d.name="3DFx");if((n=c.widgetPool.widgets)&&0<n.length)for(f=0;f<n.length;f++)d=n[f],"widgets/Viz/Widget"===d.uri&&(d.uri="widgets/3DFx/Widget",d.name="3DFx");return c},compatible:!0},{version:"2.1",description:"The version for Online 4.2.",upgrader:function(c){return c},compatible:!0},{version:"2.2",description:"The version for Online 4.3.",
upgrader:function(c){return c},compatible:!0},{version:"2.3",description:"The version for Online 4.4.",upgrader:function(c){return c},compatible:!0},{version:"2.4",description:"The version for Online 5.1.",upgrader:function(c){return c},compatible:!0},{version:"2.5",description:"The version for Online 5.2.",upgrader:function(c){return c},compatible:!0},{version:"2.6",description:"The version for Online 5.3.",upgrader:function(c){return c},compatible:!0},{version:"2.7",description:"The version for Online 5.4.",
upgrader:function(c){(function(){function d(f){var n=0,k=0;if(c[f].widgets)for(n=0;n<c[f].widgets.length;n++)if("widgets/Environment/Widget"===c[f].widgets[n].uri){c[f].widgets[n].uri="widgets/Daylight/Widget";break}if(c[f].groups)for(n=0;n<c[f].groups.length;n++){var g=c[f].groups[n];for(k=0;k<g.widgets.length;k++)if("widgets/Environment/Widget"===g.widgets[k].uri){g.widgets[k].uri="widgets/Daylight/Widget";break}}}d("widgetOnScreen");d("widgetPool")})();return c},compatible:!0},{version:"2.8",description:"The version for Online 6.1.",
upgrader:function(c){return c},compatible:!0},{version:"2.9",description:"The version for Online 6.2.",upgrader:function(c){return c},compatible:!0},{version:"2.10",description:"The version for Online 6.3.",upgrader:function(c){return c},compatible:!0},{version:"2.11",description:"The version for Online 6.4.",upgrader:function(c){return c},compatible:!0},{version:"2.12",description:"The version for Online 7.1",upgrader:function(c){return c},compatible:!0},{version:"2.13",description:"The version for Online 7.2",
upgrader:function(c){return c},compatible:!0},{version:"2.14",description:"The version for Online 7.3",upgrader:function(c){return c},compatible:!0},{version:"2.15",description:"The version for Online 7.4",upgrader:function(c){return c},compatible:!0},{version:"2.16",description:"The version for Online 8.1",upgrader:function(c){return c},compatible:!0},{version:"2.17",description:"The version for Online 8.2",upgrader:function(c){return c},compatible:!0},{version:"2.18",description:"The version for Online 8.3",
upgrader:function(c){return c},compatible:!0},{version:"2.19",description:"The version for Online 8.4",upgrader:function(c){return c},compatible:!0},{version:"2.20",description:"The version for Online 9.1",upgrader:function(c){return c},compatible:!0},{version:"2.21",description:"The version for Online 9.2",upgrader:function(c){return c},compatible:!0},{version:"2.22",description:"The version for Online 9.3",upgrader:function(c){return c},compatible:!0},{version:"2.23",description:"The version for Online 9.4",
upgrader:function(c){return c},compatible:!0},{version:"2.24",description:"The version for Online 10.1",upgrader:function(c){return c},compatible:!0},{version:"2.25",description:"The version for Online 10.2",upgrader:function(c){return c},compatible:!0},{version:"2.26",description:"The version for Online 10.3",upgrader:function(c){return c},compatible:!0},{version:"2.27",description:"The version for Online 2023.R01",upgrader:function(c){return c},compatible:!0},{version:"2.28",description:"The version for Online 2023.R02",
upgrader:function(c){return c},compatible:!0},{version:"2.29",description:"The version for Online 2023.R03",upgrader:function(c){return c},compatible:!0}];this.isCompatible=function(c,d){c=this.getVersionIndex(c);d=this.getVersionIndex(d);for(c+=1;c<=d;c++)if(!1===this.versions[c].compatible)return!1;return!0}}a.prototype=new b;return a.prototype.constructor=a})},"jimu/shared/BaseVersionManager":function(){define(function(){return function(){this.versions=[];this.upgrade=function(b,a,c){a=this.getVersionIndex(a);
c=this.getVersionIndex(c);if(a>=c)throw Error("New version should be higher than the old version.");for(a+=1;a<=c;a++)this.versions[a].upgrader&&(b=this.versions[a].upgrader(b));return b};this.getVersionIndex=function(b){b=this.fixVersion(b);var a,c;for(c=0;c<this.versions.length;c++)this.versions[c].version===b&&(a=c);null===b&&(a=-1);void 0===a&&(a=this.versions.length-1);return a};this.fixVersion=function(b){return b?b:null}}})},"jimu/ConfigLoader":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/config dojo/cookie dojo/Deferred dojo/promise/all dojo/request/xhr ./utils ./privilegeUtils ./WidgetManager ./shared/utils ./tokenUtils ./portalUtils ./appConfigResourceUtils ./portalUrlUtils ./AppStateManager esri/identity/IdentityManager esri/core/urlUtils".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u){var y=null;var z=b(null,{urlParams:null,appConfig:null,rawAppConfig:null,configFile:null,_configLoaded:!1,portalSelf:null,constructor:function(A,C){this._removeHash(A);this.urlParams=A||{};this.widgetManager=l.getInstance();a.mixin(this,C)},loadConfig:function(){console.time("Load Config");return this._tryLoadConfig().then(a.hitch(this,function(A){var C=this.checkConfig(A);if(C)throw C;this.rawAppConfig=a.clone(A);t.getInstance().setRawAppConfig(this.rawAppConfig);
A=this._upgradeAppConfig(A);this._processAfterTryLoad(A);this.appConfig=A;if(this.urlParams.id)return this.loadWidgetsManifest(A).then(a.hitch(this,function(){return this._upgradeAllWidgetsConfig(A)})).then(a.hitch(this,function(E){return this.insertAppIdtoResourceUrlofAppConfig(E,this.urlParams.id)})).then(a.hitch(this,function(){this._configLoaded=!0;A.title&&(document.title=window.isBuilder?e.stripHTML(A.title)+" - ArcGIS Web AppBuilder":e.stripHTML(A.title));this._readAndSetSharedTheme(A);return this.getAppConfig()}));
v.setPortalUrl(A.portalUrl);return this._proesssWebTierAndSignin(A).then(a.hitch(this,function(){if(this.urlParams.appid){if(window.appInfo.isRunInPortal){var E=h.getStandardPortalUrl(A.portalUrl),B=x.getPortal(E);return m.checkIsSelfOrigin(this.urlParams.appid,B,v.isInBuilderWindow()).then(a.hitch(this,function(D){if(!D)throw D=Error(window.jimuNls.orgUrlMessage),D.isSelfOrigin=!1,D;})).then(a.hitch(this,function(){return m.checkEssentialAppsLicense(this.urlParams.appid,B,v.isInBuilderWindow()).then(a.hitch(this,
function(){return this._getAppConfigFromTemplateAppId(A.portalUrl,this.urlParams.appid).then(a.hitch(this,function(D){this._tryUpdateAppConfigByLocationUrl(D);return this._processInPortalAppProtocol(D)}))}),a.hitch(this,function(D){console.error(D);if(D&&D.isBlockedByOrg)throw Error(window.jimuNls.blockedByAdminErrorForApp);throw Error(window.jimuNls.essentialAppsLicenseErrorForApp);}))}))}return this._processNotInPortalAppProtocol(A).then(a.hitch(this,function(D){return this._getAppDataAddTemplateDataFromTemplateAppId(D.portalUrl,
this.urlParams.appid).then(a.hitch(this,function(F){F.appData.appConfig&&(D=F.appData.appConfig);D._appData=F.appData;D.templateConfig=F.templateData;D.isTemplateApp=!0;return D}))}))}return this._processNotInPortalAppProtocol(A)})).then(a.hitch(this,function(E){this._processAfterTryLoad(E);this.appConfig=E;return E.map.itemId?E:x.getDefaultWebScene(E.portalUrl).then(function(B){E.map.itemId=B;return E})})).then(a.hitch(this,function(E){return this.loadWidgetsManifest(E)})).then(a.hitch(this,function(E){return E._appData?
E._appData.values&&E._appData.values.webmap?x.getPortal(E.portalUrl).getItemById(E._appData.values.webmap).then(a.hitch(this,function(B){return e.template.mergeTemplateAppConfigToAppConfig(E,E._appData,B)})):e.template.mergeTemplateAppConfigToAppConfig(E,E._appData):E})).then(a.hitch(this,function(E){return this._upgradeAllWidgetsConfig(E)})).then(a.hitch(this,function(E){return E._wabAppId?this.processResourceInAppConfigForConfigLoader(E,this.urlParams):E.appItemId&&-1<window.JSON.stringify(E).indexOf("${itemId}")?
this.insertAppIdtoResourceUrlofAppConfig(E,E.appItemId):E})).then(a.hitch(this,function(E){this.appConfig=E;this._configLoaded=!0;E.title&&(document.title=e.stripHTML(E.title));this._readAndSetSharedTheme(E);return this.getAppConfig()}))}),a.hitch(this,function(A){var C=new k;C.reject(A);return C}))},processResourceInAppConfigForConfigLoader:function(A,C){var E=A.portalUrl,B=A.appItemId,D=C.appid,F=new k,K=a.clone(A);this.insertAppIdtoResourceUrlofAppConfig(K,D).then(function(){if("config"===C.mode){var L=
this.getResourceUrlsOfAppConfig(A).result;0!==L.length?x.getItemResources(E,D).then(function(G){if(0===G.length)return L=L.map(function(O){return{resUrl:O}}),p.AddResourcesToItemForAppSave(E,L,B,D).then(function(){F.resolve(K)},function(O){console.warn("Add resource to template based app error:"+O.message||O);F.resolve(K)});F.resolve(K)},function(G){console.warn("Get resource of template based item error:"+G.message||G);F.resolve(K)}):F.resolve(K)}else F.resolve(K)}.bind(this),function(L){console.warn("Insert appId to resource url of appConfig error:"+
L.message||L);F.resolve(K)});return F},getResourceUrlsOfAppConfig:function(A){var C={test:function(E){return/^https?:\/\/(.)+\/sharing\/rest\/content\/items/.test(E)},func:a.hitch(this,function(E){return E.value})};return e.processItemResourceOfAppConfig(A,C)},insertAppIdtoResourceUrlofAppConfig:function(A,C){function E(K){return/^https?:\/\/(.)+\/sharing\/rest\/content\/items/.test(K)}function B(K,L){var G=L.obj,O=L.key,P={obj:G,key:O};"number"===typeof L.i?(P.i=L.i,P.value=G[O][L.i]):P.value=G[O];
L=P;K=F.processItemIdAndTokenOfResources(L.value,K);G=L.obj;O=L.key;"number"===typeof L.i?G[O][L.i]=K:G[O]=K;return!0}var D=A.portalUrl,F=this;return x.getPortal(D).getItemById(C).then(a.hitch(this,function(K){K={test:E,func:a.hitch(this,B,{appId:C,isPublic:"public"===K.access,portalUrl:D})};return e.processItemResourceOfAppConfig(A,K).appConfig}))},processItemIdAndTokenOfResources:function(A,C){0<A.indexOf("${itemId}")&&(A=A.replace("${itemId}",C.appId));/(\?|&)token=.+/.test(A)&&(A=A.replace(/(\?|&)token=.+/,
""));C.isPublic||(C=v.getPortalCredential(C.portalUrl))&&(A+="?token\x3d"+C.token);return A},getAppConfig:function(){var A=a.clone(this.appConfig);A.getConfigElementById=function(C){return e.getConfigElementById(this,C)};A.getConfigElementsByName=function(C){return e.getConfigElementsByName(this,C)};A.visitElement=function(C){e.visitElement(this,C)};this._addAuthorizedCrossOriginDomains(this.portalSelf,A);return A},_addAuthorizedCrossOriginDomains:function(A,C){A&&A.authorizedCrossOriginDomains&&
v.addAuthorizedCrossOriginDomains(A.authorizedCrossOriginDomains);C&&C.authorizedCrossOriginDomains&&v.addAuthorizedCrossOriginDomains(C.authorizedCrossOriginDomains)},checkConfig:function(A){return(A=this._getRepeatedId(A))?"repeated id:"+A:null},processProxy:function(A){var C=e.getEsriConfigRequestObject();C.alwaysUseProxy=A.httpProxy&&A.httpProxy.useProxy&&A.httpProxy.alwaysUseProxy;C.proxyUrl="";C.proxyRules=[];A.httpProxy&&A.httpProxy.useProxy&&A.httpProxy.url&&(C.proxyUrl=A.httpProxy.url);A.httpProxy&&
A.httpProxy.useProxy&&A.httpProxy.rules&&c.forEach(A.httpProxy.rules,function(E){u.addProxyRule(E)})},addNeedValues:function(A){this._processNoUriWidgets(A);this._processEmptyGroups(A);this._addElementId(A);this._processWidgetJsons(A)},showError:function(A){d.create("div",{"class":"app-error",innerHTML:e.sanitizeHTML(A.message)},document.body)},_tryLoadConfig:function(){if(this.urlParams.config)return this.configFile=this.urlParams.config,q(this.configFile,{handleAs:"json",headers:{"X-Requested-With":null}}).then(a.hitch(this,
function(B){v.setPortalUrl(B.portalUrl);B.portalUrl&&(window.portalUrl=B.portalUrl);return this.urlParams.token?v.registerToken(this.urlParams.token).then(function(){return B}):B}));if(this.urlParams.id){window.appInfo.isRunInPortal=!0;var A=h.getPortalUrlFromLocation(),C=new k;v.setPortalUrl(A);window.portalUrl=A;if(this.urlParams.token)var E=v.registerToken(this.urlParams.token);else E=new k,E.resolve();E.then(a.hitch(this,function(){var B=x.getPortal(A);B.loadSelfInfo().then(a.hitch(this,function(D){this.portalSelf=
D;D.allSSL&&"http:"===window.location.protocol?(window.location.href=h.setHttpsProtocol(window.location.href),C.reject()):this._processSignIn(A).then(a.hitch(this,function(){this._getAppConfigFromAppId(A,this.urlParams.id).then(a.hitch(this,function(F){return m.checkIsSelfOrigin(this.urlParams.id,B,v.isInBuilderWindow()).then(a.hitch(this,function(K){if(K)return F;K=Error(window.jimuNls.orgUrlMessage);K.isSelfOrigin=!1;throw K;}))})).then(a.hitch(this,function(F){return m.checkEssentialAppsLicense(this.urlParams.id,
B,v.isInBuilderWindow()).then(a.hitch(this,function(){this._tryUpdateAppConfigByLocationUrl(F);return this._processInPortalAppProtocol(F)}),a.hitch(this,function(K){console.error(K);if(K&&K.isBlockedByOrg)throw Error(window.jimuNls.blockedByAdminErrorForApp);throw Error(window.jimuNls.essentialAppsLicenseErrorForApp);}))})).then(function(F){C.resolve(F)},function(F){C.reject(F)})}))}))}),a.hitch(this,function(B){this.showError(B)}));return C}this.configFile="config.json";return q(this.configFile,
{handleAs:"json"}).then(a.hitch(this,function(B){v.setPortalUrl(B.portalUrl);B.portalUrl&&(window.portalUrl=B.portalUrl);return this.urlParams.token?v.registerToken(this.urlParams.token).then(function(){return B}):B}))},_upgradeAppConfig:function(A){var C=window.wabVersion,E=A.wabVersion;if(C===E)return A;var B=this.versionManager.getVersionIndex(E),D=this.versionManager.getVersionIndex(C);if(B>D)throw Error("Bad version number, "+E);A=this.versionManager.upgrade(A,E,C);A.wabVersion=C;A.isUpgraded=
!0;return A},_upgradeAllWidgetsConfig:function(A){var C=new k,E=[];if(!A.isUpgraded)return C.resolve(A),C;delete A.isUpgraded;w.visitElement(A,a.hitch(this,function(B){B.uri&&(B.config?(B=this.widgetManager.tryLoadWidgetConfig(B),E.push(B)):B.version=B.manifest.version)}));g(E).then(a.hitch(this,function(){C.resolve(A)}),function(B){C.reject(B)});return C},_processAfterTryLoad:function(A){this._setPortalUrl(A);this._tryUpdateAppConfigByLocationUrl(A);this._processUrlParams(A);this.addNeedValues(A);
this.processProxy(A);r.tokenValidity=10080;return A},_readAndSetSharedTheme:function(A){A.theme.sharedTheme||(A.theme.sharedTheme={useHeader:!1,useLogo:!1},A.theme.sharedTheme.isPortalSupport=this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?!0:!1);A.theme.sharedTheme.useHeader&&(A.theme.sharedTheme.isPortalSupport&&this.portalSelf.portalProperties?(A.theme.customStyles={mainBackgroundColor:this.portalSelf.portalProperties.sharedTheme.header.background},A.titleColor=this.portalSelf.portalProperties.sharedTheme.header.text):
console.error("Portal does not support sharedTheme."));A.theme.sharedTheme.useLogo&&(A.theme.sharedTheme.isPortalSupport&&this.portalSelf.portalProperties?(A.logo=this.portalSelf.portalProperties.sharedTheme.logo.small?this.portalSelf.portalProperties.sharedTheme.logo.small:"images/app-logo.png",!A.logoLink&&this.portalSelf.portalProperties.sharedTheme.logo.link&&(A.logoLink=this.portalSelf.portalProperties.sharedTheme.logo.link)):(console.error("Portal does not support sharedTheme, use default logo."),
A.logo="images/app-logo.png"))},_tryUpdateAppConfigByLocationUrl:function(A){if(!(this.urlParams.config&&-1<this.urlParams.config.indexOf("arcgis.com/sharing/rest/content/items/"))){var C=h.getPortalUrlFromLocation();C=h.getStandardPortalUrl(C);h.isOnline(C)&&(C=h.updateUrlProtocolByOtherUrl(C,A.portalUrl),A.map.portalUrl&&h.isSamePortalUrl(A.portalUrl,A.map.portalUrl)&&(A.map.portalUrl=C),A.portalUrl=C,A.httpProxy&&A.httpProxy.url&&(A.httpProxy.url=h.getPortalProxyUrl(C)))}},_processWidgetJsons:function(A){w.visitElement(A,
function(C,E){E.isWidget&&C.uri&&e.processWidgetSetting(C)})},_processNoUriWidgets:function(A){var C=0;w.visitElement(A,function(E,B){B.isWidget&&!E.uri&&(C++,E.placeholderIndex=C)})},_processEmptyGroups:function(A){var C=0;A.widgetOnScreen.groups&&c.forEach(A.widgetOnScreen.groups,function(E){if(!E.widgets||E.widgets&&0===E.widgets.length)C++,E.placeholderIndex=C})},_addElementId:function(A){var C=0,E;w.visitElement(A,function(B){if(B.id){B.id=B.id.replace(/\//g,"_");var D=B.id.lastIndexOf("_");
-1<D&&(E=B.id.substr(D+1),C=Math.max(C,E))}});w.visitElement(A,function(B){B.id||(C++,B.id=B.uri?B.uri.replace(/\//g,"_")+"_"+C:"_"+C)})},_setPortalUrl:function(A){if(A.portalUrl){var C=h.getPortalUrlFromLocation(),E=h.isOnline(C);h.isSamePortalUrl(A.portalUrl,C)||E||(window.appInfo.isRunInPortal=!1)}else window.isXT&&n("wab_portalurl")?A.portalUrl=n("wab_portalurl"):(window.appInfo.isRunInPortal=!0,A.portalUrl=h.getPortalUrlFromLocation())},_changePortalUrlProtocol:function(A,C){A.portalUrl=h.setProtocol(A.portalUrl,
C);A.map.portalUrl&&(A.map.portalUrl=h.setProtocol(A.map.portalUrl,C));A.httpProxy&&(A.httpProxy.url=h.setProtocol(A.httpProxy.url,C),A.httpProxy&&A.httpProxy.rules&&c.forEach(A.httpProxy.rules,a.hitch(this,function(E){E.proxyUrl=h.setProtocol(E.proxyUrl,C)})))},_processInPortalAppProtocol:function(A){var C=new k,E=x.getPortal(A.portalUrl),B=a.hitch(this,function(D){if("https:"===window.location.protocol)this._changePortalUrlProtocol(A,"https");else{if(D){window.location.href=h.setHttpsProtocol(window.location.href);
C.reject();return}this._changePortalUrlProtocol(A,"http")}this._checkLocale();C.resolve(A)});E.loadSelfInfo().then(a.hitch(this,function(D){this.portalSelf=D;"private"===D.access?(D=0===A.portalUrl.toLowerCase().indexOf("https://"),B(D)):B(D.allSSL)}),a.hitch(this,function(D){C.reject(D)}));return C},_processNotInPortalAppProtocol:function(A){var C=new k;A.portalUrl?x.getPortal(A.portalUrl).loadSelfInfo().then(a.hitch(this,function(E){this.portalSelf=E;var B="https:"===window.location.protocol;(E.allSSL||
B)&&this._changePortalUrlProtocol(A,"https");0!==A.portalUrl.toLowerCase().indexOf("https://")||B||v.isInConfigOrPreviewWindow()?C.resolve(A):(window.location.href=h.setHttpsProtocol(window.location.href),C.reject())}),a.hitch(this,function(E){C.reject(E)})):C.resolve(A);return C},_proesssWebTierAndSignin:function(A){var C=new k,E=!1,B=A.portalUrl;this._processWebTier(A).then(a.hitch(this,function(D){E=D;return x.getPortal(B).loadSelfInfo()})).then(a.hitch(this,function(D){this.portalSelf=D;return this._processSignIn(B,
E)})).then(a.hitch(this,function(){C.resolve()}),function(D){C.reject(D)});return C},_processWebTier:function(A){var C=new k,E=A.portalUrl;A.isWebTier?(v.addAuthorizedCrossOriginDomains([E]),v.isWebTierPortal(E).then(a.hitch(this,function(){var B=v.getPortalCredential(E);B&&B.ssl&&"http:"===window.location.protocol&&!v.isInConfigOrPreviewWindow()?window.location.href=h.setHttpsProtocol(window.location.href):C.resolve(A.isWebTier)}),a.hitch(this,function(B){C.reject(B)}))):C.resolve(!1);return C},
_processSignIn:function(A,C){var E=new k,B=x.getPortal(A),D=h.getSharingUrl(A);window.appInfo.isRunInPortal?(C=r.checkSignInStatus(D),C.catch(function(){}).then(a.hitch(this,function(){E.resolve()}))):(v.isInBuilderWindow()||v.isInConfigOrPreviewWindow()||!this.portalSelf.supportsOAuth||!this.rawAppConfig.appId||C||v.registerOAuthInfo(A,this.rawAppConfig.appId,this.portalSelf.currentVersion),C=r.checkSignInStatus(D),C.catch(function(){}).then(a.hitch(this,function(){v.xtGetCredentialFromCookie(A);
B.loadSelfInfo().then(a.hitch(this,function(F){this.portalSelf=F;this._checkLocale();E.resolve()}))})));return E},_checkLocale:function(){if(!v.isInConfigOrPreviewWindow()){var A=this.portalSelf.user&&this.portalSelf.user.culture||f.locale;A="hi"===A?"en":A.toLowerCase();!this.urlParams.locale&&e.isLocaleChanged(f.locale,A)&&(n("wab_app_locale",A),window.location.reload())}},_getAppConfigFromTemplateAppId:function(A,C){var E=x.getPortal(A);return this._getWabAppIdAndDataFromTemplateAppId(A,C).then(a.hitch(this,
function(B){var D=B.appId,F=B.appData;return g([this._getAppConfigFromAppId(A,D),E.getItemData(F.source)]).then(a.hitch(this,function(K){if(F.appConfig){var L=F.appConfig;delete F.appConfig}else L=K[0];L=this._upgradeAppConfig(L);K=K[1];L._appData=F;L._wabAppId=D;L.templateConfig=K;L.isTemplateApp=!0;return L}))}))},_getAppDataAddTemplateDataFromTemplateAppId:function(A,C){var E=x.getPortal(A);return E.getItemData(C).then(function(B){return E.getItemData(B.source).then(function(D){return{appData:B,
templateData:D}})})},_getWabAppIdAndDataFromTemplateAppId:function(A,C){var E=new k,B=x.getPortal(A);B.getItemData(C).then(a.hitch(this,function(D){B.getItemById(D.source).then(a.hitch(this,function(F){F=u.urlToObject(F.url);E.resolve({appId:F.query.id,appData:D})}))}),function(D){E.reject(D)});return E},_getAppConfigFromAppId:function(A,C){return x.getPortal(A).getItemData(C)},_removeHash:function(A){for(var C in A)A[C]&&(A[C]=A[C].replace("#",""))},loadWidgetsManifest:function(A){function C(F,K,
L){function G(O){return F.loadWidgetManifest(O).then(function(P){return P},function(P){console.log("Widget failed to load, it is removed.",O.name);P.stack?console.error(P.stack):console.log(P);E(A,O)})}return K.itemId?x.getPortal(L).getItemById(K.itemId).then(function(O){var P=e.isEsriDomain(O.url)?!0:v.getPortalCredential(A.portalUrl)?!0:!1;if(P)return K.uri=e.widgetJson.getUriFromItem(O),G(K);console.log("Widget is not useable, it is removed.",K.name);E(A,K)}):G(K)}function E(F,K){function L(G){F[G]&&
F[G].widgets&&(F[G].widgets=F[G].widgets.filter(function(O){if(K)return O.id!==K.id;O.uri&&!O.manifest&&console.error("Widget is removed because it is not loaded successfully.",O.uri);return O.manifest}));F[G]&&F[G].groups&&F[G].groups.forEach(function(O){O.widgets&&(O.widgets=O.widgets.filter(function(P){if(K)return P.id!==K.id;P.uri&&!P.manifest&&console.error("Widget is removed because it is not loaded successfully.",P.uri);return P.manifest}))})}L("widgetOnScreen");L("widgetPool")}var B=[],D=
new k;A._buildInfo&&A._buildInfo.widgetManifestsMerged?this._loadMergedWidgetManifests().then(a.hitch(this,function(F){w.visitElement(A,a.hitch(this,function(K){K.widgets||!K.uri&&!K.itemId||(K.uri&&F[K.uri]?(this._addNeedValuesForManifest(F[K.uri],K.uri),e.widgetJson.addManifest2WidgetJson(K,F[K.uri])):B.push(C(this.widgetManager,K,A.portalUrl)))}));g(B).then(function(){D.resolve(A)})})):(w.visitElement(A,a.hitch(this,function(F){F.widgets||!F.uri&&!F.itemId||B.push(C(this.widgetManager,F,A.portalUrl))})),
g(B).then(function(){D.resolve(A)}));setTimeout(function(){D.isResolved()||(E(A),D.resolve(A))},6E4);return D},_addNeedValuesForManifest:function(A,C){a.mixin(A,e.getUriInfo(C));e.addManifestProperies(A);e.processManifestLabel(A,f.locale)},_loadMergedWidgetManifests:function(){return q(window.appInfo.appPath+"widgets/widgets-manifest.json",{handleAs:"json"})},_getRepeatedId:function(A){var C=[],E;w.visitElement(A,function(B){if(0<C.indexOf(B.id))return E=B.id,!0;C.push(B.id)});return E},_processUrlParams:function(A){var C=
this.urlParams.itemid||this.urlParams.webmap;C&&A.map.itemId!==C&&(A.map.mapOptions&&e.deleteMapOptions(A.map.mapOptions),A.map.itemId=C);this.urlParams.mode&&(A.mode=this.urlParams.mode);A.map.mapOptions||(A.map.mapOptions={});this.urlParams.scale&&(A.map.mapOptions.scale=this.urlParams.scale);if(this.urlParams.level||this.urlParams.zoom)A.map.mapOptions.zoom=this.urlParams.level||this.urlParams.zoom}});z.getInstance=function(A,C){null===y?y=new z(A,C):(y.urlParams=A,y.options=C);return y};return z})},
"jimu/privilegeUtils":function(){define(["dojo/Deferred","esri/identity/IdentityManager","esri/request","jimu/tokenUtils","jimu/portalUrlUtils"],function(b,a,c,d,f){return{checkEssentialAppsLicense:function(n,k,g){var q=f.getStandardPortalUrl(k.portalUrl),e=f.getSharingUrl(q),m=new b;(g?a.checkAppAccess(e,"arcgisWebApps"):k.getItemById(n).then(function(l){return"public"===l.access?{isPublicApp:!0}:a.checkAppAccess(e,"arcgisWebApps",{force:!0})})).then(function(l){k.getSigninSettingsOfSelfInfo().then(function(w){w&&
w.blockedApps&&w.blockedApps.indexOf&&-1<w.blockedApps.indexOf("webappbuilder")?m.reject({message:"wab is blocked by org admin",isBlockedByOrg:!0}):m.resolve(l)},function(w){m.reject({message:w&&w.message,isBlockedByOrg:!1})})},function(l){m.reject({message:l&&l.message,isBlockedByOrg:!1})});return m},checkIsSelfOrigin:function(n,k,g){var q=!0,e=f.getPortalUrlFromLocation();e=f.getStandardPortalUrl(e);n=f.getItemUrl(e,n);var m=window.location.host;e=d.userHaveSignInPortal(e);m=0<=["www.arcgis.com",
"devext.arcgis.com","qaext.arcgis.com"].indexOf(m);var l=window.location!==window.parent.location;if(k.isPortal||g||m||e||l)k=new b,k.resolve(q);else return c(n,{handleAs:"json",query:{f:"json"},callbackParamName:"callback"}).then(function(w){w=w.data;w.contentOrigin&&"self"!==w.contentOrigin&&(q=!1);return q});return k}}})},"jimu/appConfigResourceUtils":function(){define(["dojo/Deferred","dojo/promise/all","jimu/portalUtils","jimu/utils"],function(b,a,c,d){return{AddResourcesToItemForAppSave:function(f,
n,k,g){n=n||[];if(0===n.length){var q=new b;q.resolve(n);return q}n=n.map(function(e){var m=e.resUrl.split("resources/")[1],l=new b;e.b64?(e=d.b64toBlob(e.b64),l.resolve({blob:e,fileName:m.split("/")[1],prefixName:m.split("/")[0]})):(e=e.resUrl,0<e.indexOf("${itemId}")&&(e=e.replace("${itemId}",k)),d.resourcesUrlToBlob(e).then(function(w){l.resolve({blob:w,fileName:m.split("/")[1],prefixName:m.split("/")[0]},function(v){console.error(v.message||v);l.reject(v)})}));return l});return a(n).then(function(e){if(e instanceof
Array&&0<e.length)return e=e.map(function(m){var l=k;g&&(l=g);return c.addResource(f,l,m.blob,m.fileName,m.prefixName)}.bind(this)),a(e).then(function(m){return m})}.bind(this))}}})},"jimu/AppStateManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/json esri/geometry/Extent esri/geometry/SpatialReference libs/storejs/store libs/md5/md5 jimu/tokenUtils".split(" "),function(b,a,c,d,f,n,k,g,q){var e=null,m=b(null,{rawAppConfig:null,mapMd5:null,appStateKey:null,setRawAppConfig:function(l){this.rawAppConfig=
l},_getAppStateMd5:function(){if("string"!==typeof this.mapMd5){var l=d.stringify(this.rawAppConfig.map);this.mapMd5=g(l)}return this.mapMd5},_getAppStateKey:function(){return this.appStateKey?this.appStateKey:this.appStateKey="wab_appstate_"+this.urlParams.id||this.urlParams.appid||window.path},getWabAppState:function(){var l=new c,w={};if(q.isInConfigOrPreviewWindow()||!this.rawAppConfig||!this.rawAppConfig.map)return l.resolve(w),l;var v=this._getAppStateKey(),x=k.get(v);x&&x.appStateMd5===this._getAppStateMd5()?
(v=x.map&&x.map.extent,x=x.map&&x.map.layers,v&&(w.extent=new f(v.xmin,v.ymin,v.xmax,v.ymax,new n(v.spatialReference))),x&&(w.layers=x)):k.remove(v);l.resolve(w);return l},saveWabAppState:function(l,w){if(l&&!q.isInConfigOrPreviewWindow()){var v=this._getAppStateKey(),x={extent:{xmin:l.extent.xmin,xmax:l.extent.xmax,ymin:l.extent.ymin,ymax:l.extent.ymax,spatialReference:{wkid:l.extent.spatialReference.wkid,wkt:l.extent.spatialReference.wkt}},layers:{}};w&&w.traversalLayerInfosOfWebmap&&w.traversalLayerInfosOfWebmap(a.hitch(this,
function(p){x.layers[p.id]={visible:p.isShowInMap()}}));k.set(v,{map:x,appStateMd5:this._getAppStateMd5()})}}});m.getInstance=function(l){null===e&&(e=new m);e.urlParams=l;return e};return m})},"jimu/LayoutManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dijit/_WidgetBase dojo/topic dojo/on dojo/query dojo/Deferred dojo/promise/all dojo/debounce require ./MapManager ./utils".split(" "),function(b,a,c,d,f,n,k,g,q,e,m,l,w){var v=null;var x=b([d],{constructor:function(p,
h){this.own(f.subscribe("appConfigLoaded",a.hitch(this,this._onAppConfigLoaded)));this.own(f.subscribe("appConfigChanged",a.hitch(this,this._onAppConfigChanged)));this.own(f.subscribe("sceneViewLoaded",a.hitch(this,this._onSceneViewLoaded)));this.own(f.subscribe("sceneViewChanged",a.hitch(this,this._onSceneViewChanged)));this.own(f.subscribe("beforeSceneViewDestory",a.hitch(this,this._onBeforeSceneViewDestroy)));this.own(f.subscribe("builder/actionTriggered",a.hitch(this,this._onActionTriggered)));
this.own(f.subscribe("openWidget",a.hitch(this,this._onOpenWidgetRequest)));this.own(n(window,"resize",e(a.hitch(this,this.resize),200)));this.id=h},postCreate:function(){this.containerNode=this.domNode},sceneView:null,mapId:"map",mapDiv:null,layoutManager:null,animTime:500,resize:function(){this.layoutManager&&this.layoutManager.resize()},_onAppConfigLoaded:function(p){this.appConfig=a.clone(p);this._loadLayoutManager(this.appConfig).then(a.hitch(this,function(h){this.layoutManager=h;this.layoutManager.onEnter(this.appConfig,
this.mapId).then(a.hitch(this,function(){this.mapDiv=this.layoutManager.getMapDiv();this._loadMap(this.mapId);this.appConfig.theme&&this._loadTheme(this.appConfig.theme)}))}))},_loadLayoutManager:function(p){p=p.layoutDefinition?p.layoutDefinition.manager:"jimu/layoutManagers/AbsolutePositionLayoutManager";var h=new g;m([p],a.hitch(this,function(t){t=t.getInstance();this.sceneView&&t.setSceneView(this.sceneView);h.resolve(t)}));return h},_loadMap:function(){this.mapManager=l.getInstance({appConfig:this.appConfig,
urlParams:this.urlParams},this.mapId);this.mapManager.showMap()},_onSceneViewLoaded:function(p){this.sceneView=p;this.layoutManager.setSceneView(p);this.layoutManager.loadAndLayout(this.appConfig)},_loadTheme:function(p){var h=new g;m(["themes/"+p.name+"/main"],a.hitch(this,function(){q([this._loadThemeCommonStyle(p),this._loadThemeCurrentStyle(p)]).then(a.hitch(this,function(){this._addCustomStyle(p);this.layoutManager.onThemeLoad();h.resolve()}))}));return h},_loadThemeCommonStyle:function(p){c.addClass(this.domNode,
p.name);return w.loadStyleLink(this._getThemeCommonStyleId(p),"themes/"+p.name+"/common.css")},_loadThemeCurrentStyle:function(p){c.addClass(this.domNode,p.styles[0]);return w.loadStyleLink(this._getThemeCurrentStyleId(p),"themes/"+p.name+"/styles/"+p.styles[0]+"/style.css")},_addCustomStyle:function(p){var h=a.getObject("customStyles",!1,p);if(h){var t=".jimu-main-background{background-color: ${mainBackgroundColor} !important;}";(p=this._getFixedThemeStyles(p))&&(t+=p);t=a.replace(t,h,/\$\{([^\}]+)\}/g);
h=c.create("style",{type:"text/css"});try{h.appendChild(document.createTextNode(t))}catch(r){h.styleSheet.cssText=t}h.setAttribute("source","custom");document.head.appendChild(h)}},_getFixedThemeStyles:function(p){var h=".esriPopup .titlePane {background-color: ${mainBackgroundColor} !important;}";"PlateauTheme"===p.name?h+=".jimu-widget-header-controller .jimu-title, .jimu-widget-header-controller .jimu-subtitle{color: ${mainBackgroundColor} !important;}.jimu-widget-header-controller .links .jimu-link{color: ${mainBackgroundColor} !important;}.jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation, .jimu-widget-mylocation .place-holder, .jimu-widget-zoomslider.vertical .zoom-in, .jimu-widget-zoomslider.vertical .zoom-out, .jimu-widget-extent-navigate.vertical .operation{background-color: ${mainBackgroundColor} !important;}.jimu-preload-widget-icon-panel \x3e .jimu-panel-title, .jimu-foldable-panel \x3e .jimu-panel-title, .jimu-title-panel \x3e .title{color: ${mainBackgroundColor} !important;}.jimu-panel{border-color: ${mainBackgroundColor} !important;}.jimu-widget-header-controller{border-bottom-color: ${mainBackgroundColor} !important;}.jimu-tab\x3e.control\x3e.tab{color: ${mainBackgroundColor} !important; border-color: ${mainBackgroundColor} !important}":
"BillboardTheme"===p.name?h+=".jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation, .jimu-widget-mylocation .place-holder, .jimu-widget-zoomslider.vertical .zoom-in, .jimu-widget-zoomslider.vertical .zoom-out, .jimu-widget-extent-navigate .operation, .jimu-widget-navigate, .jimu-widget-home, .jimu-widget-compass, .jimu-widget-fullScreen, .jimu-widget-zoom .esri-zoom .esri-widget, .jimu-widget-placeholder{background-color: ${mainBackgroundColor} !important;}.jimu-widget-onscreen-icon{background-color: ${mainBackgroundColor} !important;}":
"BoxTheme"===p.name?h+=".jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation, .jimu-widget-mylocation .place-holder, .jimu-widget-zoomslider.vertical .zoom-in, .jimu-widget-zoomslider.vertical .zoom-out, .jimu-widget-extent-navigate, .jimu-widget-navigate, .jimu-widget-home, .jimu-widget-compass, .jimu-widget-fullScreen, .jimu-widget-zoom .esri-zoom .esri-widget, .jimu-widget-placeholder{background-color: ${mainBackgroundColor} !important;}":"TabTheme"===p.name?h+=".tab-widget-frame .title-label{color: ${mainBackgroundColor} !important;}":
"DartTheme"===p.name&&(h+=".jimu-widget-fullScreen .fullScreen{background-color: ${mainBackgroundColor} !important;}");return h},_onAppConfigChanged:function(p,h,t){p=a.clone(p);switch(h){case "themeChange":this._onThemeChange(p);break;case "styleChange":this._onStyleChange(p);break;case "layoutChange":this._onLayoutChange(p);break;case "widgetChange":this._onWidgetChange(p,t);break;case "groupChange":this._onGroupChange(p,t);break;case "widgetPoolChange":this._onWidgetPoolChange(p,t);break;case "resetConfig":this._onResetConfig(p);
break;case "loadingPageChange":this._onLoadingPageChange(p,t);break;case "layoutDefinitionChange":this._onLayoutDefinitionChange(p,t);break;case "onScreenGroupsChange":this._onOnScreenGroupsChange(p,t);break;case "onScreenOrderChange":this._onOnScreenOrderChange(p,t)}this.appConfig=p},_onSceneViewChanged:function(p){this.sceneView=p;this.layoutManager.setSceneView(p);this.layoutManager.loadAndLayout(this.appConfig)},_onBeforeSceneViewDestroy:function(){this.layoutManager.destroyOnScreenWidgetsAndGroups()},
_onActionTriggered:function(p){this.layoutManager.onActionTriggered(p)},_onWidgetChange:function(p,h){this.layoutManager.onWidgetChange(p,h)},_onGroupChange:function(p,h){this.layoutManager.onGroupChange(p,h)},_onWidgetPoolChange:function(p,h){this.layoutManager.onWidgetPoolChange(p,h)},_onLayoutDefinitionChange:function(p,h){this.layoutManager.onLayoutDefinitionChange(p,h)},_onOnScreenGroupsChange:function(p,h){this.layoutManager.onOnScreenGroupsChange(p,h)},_onOnScreenOrderChange:function(p,h){this.layoutManager.onOnScreenOrderChange(p,
h)},_onThemeChange:function(p){this.layoutManager.destroyOnScreenWidgetsAndGroups();this._removeThemeCommonStyle(this.appConfig.theme);this._removeThemeCurrentStyle(this.appConfig.theme);this._removeCustomStyle();q([this._loadLayoutManager(p),this._loadTheme(p.theme)]).then(a.hitch(this,function(h){var t=h[0];this.layoutManager.name!==t.name?(this.layoutManager.onLeave(),t.onEnter(p,this.mapId).then(a.hitch(this,function(){this.layoutManager=t;this.layoutManager.loadAndLayout(p)}))):this.layoutManager.loadAndLayout(p)}))},
_onResetConfig:function(p){var h=this.appConfig;f.publish("appConfigChanged",p,"mapChange",p);this.appConfig=h;this._loadLayoutManager(p).then(a.hitch(this,function(t){this.layoutManager=t;this._removeThemeCommonStyle(this.appConfig.theme);this._removeThemeCurrentStyle(this.appConfig.theme);this._removeCustomStyle();this._loadTheme(this.appConfig.theme)}))},_onLoadingPageChange:function(p,h){"backgroundColor"in h?c.setStyle(jimuConfig.loadingId,"background-color",p.loadingPage.backgroundColor):"backgroundImage"in
h?(p=p.loadingPage.backgroundImage,p.visible&&p.uri?(c.setStyle(jimuConfig.loadingImageId,"background-image","url('"+p.uri+"')"),c.setStyle(jimuConfig.loadingImageId,"width",p.width+"px"),c.setStyle(jimuConfig.loadingImageId,"height",p.height+"px")):(c.setStyle(jimuConfig.loadingImageId,"background-image","url('')"),c.setStyle(jimuConfig.loadingImageId,"width","0px"),c.setStyle(jimuConfig.loadingImageId,"height","0px"))):"loadingGif"in h&&(p=p.loadingPage.loadingGif,p.visible&&p.uri?(c.setStyle(jimuConfig.loadingGifId,
"background-image","url('"+p.uri+"')"),c.setStyle(jimuConfig.loadingGifId,"width",p.width+"px"),c.setStyle(jimuConfig.loadingGifId,"height",p.height+"px")):(c.setStyle(jimuConfig.loadingGifId,"background-image","url('')"),c.setStyle(jimuConfig.loadingGifId,"width","0px"),c.setStyle(jimuConfig.loadingGifId,"height","0px")))},_onStyleChange:function(p){this._removeThemeCurrentStyle(this.appConfig.theme);this._loadThemeCurrentStyle(p.theme);this._removeCustomStyle();this._addCustomStyle(p.theme)},_onLayoutChange:function(p){this.layoutManager.onLayoutChange(p)},
_removeThemeCommonStyle:function(p){c.removeClass(this.domNode,p.name);c.destroy(this._getThemeCommonStyleId(p))},_removeThemeCurrentStyle:function(p){c.removeClass(this.domNode,p.styles[0]);c.destroy(this._getThemeCurrentStyleId(p))},_removeCustomStyle:function(){k('style[source\x3d"custom"]',document.head).forEach(function(p){c.destroy(p)})},_getThemeCommonStyleId:function(p){return"theme_"+p.name+"_style_common"},_getThemeCurrentStyleId:function(p){return"theme_"+p.name+"_style_"+p.styles[0]},
_doPostLoad:function(){m(["dynamic-modules/postload"])},_onOpenWidgetRequest:function(p){this.layoutManager.openWidget(p)}});x.getInstance=function(p,h){null===v&&(v=new x(p,h),window._layoutManager=v);return v};return x})},"dojo/debounce":function(){define([],function(){return function(b,a){var c;return function(){c&&clearTimeout(c);var d=this,f=arguments;c=setTimeout(function(){b.apply(d,f)},a)}}})},"jimu/MapManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dojo/on dojo/keys esri/geometry/Extent esri/geometry/Point ./utils ./dijit/LoadingShelter ./AppStateManager ./WebSceneLoader esri/Viewpoint".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v){var x=null,p=b(null,{appConfig:null,mapDivId:"",map:null,previousInfoWindow:null,mobileInfoWindow:null,isMobileInfoWindow:!1,layerInfosObj:null,constructor:function(h,t){this.appConfig=h.appConfig;this.urlParams=h.urlParams;this.id=this.mapDivId=t;this.appStateManager=l.getInstance(this.urlParams);f.subscribe("appConfigChanged",a.hitch(this,this.onAppConfigChanged));f.subscribe("changeMapPosition",a.hitch(this,this.onChangeMapPosition));f.subscribe("syncViewpoint",
a.hitch(this,this.onSyncViewpoint));n(window,"resize",a.hitch(this,this.onWindowResize));n(window,"beforeunload",a.hitch(this,this.onBeforeUnload))},showMap:function(){this._showMap(this.appConfig)},_showMap:function(h){console.time("Load Map");this.loading=new m;this.loading.placeAt(this.mapDivId);this.loading.startup();h.map["3D"]?h.map.itemId?this._show3DWebScene(h):console.log("No webscene found. Please set map.itemId in config.json."):h.map.itemId?this._show2DWebMap(h):console.log("No webmap found. Please set map.itemId in config.json.")},
onBeforeUnload:function(){this.appStateManager.saveWabAppState(this.map,this.layerInfosObj)},onWindowResize:function(){this.map&&this.map.resize&&(this.map.resize(),this.resetInfoWindow(!1))},getMapInfoWindow:function(){return{mobile:this._mapMobileInfoWindow,bigScreen:this._mapInfoWindow}},resetInfoWindow:function(h){h&&(this._mapInfoWindow=this.map.infoWindow,this._mapMobileInfoWindow&&this._mapMobileInfoWindow.destroy(),this.isMobileInfoWindow=!1);window.appInfo.isRunInMobile&&!this.isMobileInfoWindow?
this.isMobileInfoWindow=!0:!window.appInfo.isRunInMobile&&this.isMobileInfoWindow&&(this.isMobileInfoWindow=!1)},onChangeMapPosition:function(h){var t=a.clone(this.mapPosition);a.mixin(t,h);this.setMapPosition(t)},setMapPosition:function(h){this.mapPosition=h;h=e.getPositionStyle(h);d.setStyle(this.mapDivId,h);this.map&&this.map.resize&&this.map.resize()},getMapPosition:function(){return this.mapPosition},onSyncViewpoint:function(h){this.sceneView&&(this.sceneView.viewpoint=h.clone())},_visitConfigMapLayers:function(h,
t){c.forEach(h.map.basemaps,function(r,u){r.isOperationalLayer=!1;t(r,u)},this);c.forEach(h.map.operationallayers,function(r,u){r.isOperationalLayer=!0;t(r,u)},this)},_destroySceneView:function(){if(this.sceneView)try{this.sceneView.destroy()}catch(h){console.error(h)}this.sceneView=null;window._sceneView=null},_show3DWebScene:function(h){var t=h.map.portalUrl,r=h.map.itemId;this._destroySceneView();w.createMap(this.mapDivId,t,r).then(a.hitch(this,function(u){this._publishSceneViewEvent(u);if(h.map.mapOptions)if((u=
h.map.mapOptions.initialState)&&u.viewpoint)try{var y=v.fromJSON(u.viewpoint);y&&(this.sceneView.map.initialViewProperties.viewpoint=y,this.sceneView.viewpoint=y.clone())}catch(z){console.error(z)}else this.sceneView.map.initialViewProperties.viewpoint=this.sceneView.viewpoint}),a.hitch(this,function(){this.loading&&this.loading.destroy();f.publish("mapCreatedFailed")}))},_publishSceneViewEvent:function(h){window._sceneView=h;console.timeEnd("Load Map");this.loading&&this.loading.destroy();this.sceneView?
(this.sceneView=h,console.log("sceneView changed"),f.publish("sceneViewChanged",this.sceneView)):(this.sceneView=h,console.log("sceneView loaded"),f.publish("sceneViewLoaded",this.sceneView))},_show2DWebMap:function(h){h.map.mapOptions||(h.map.mapOptions={});var t=this._processMapOptions(h.map.mapOptions)||{};t.isZoomSlider=!1;e.createWebMap(h.map.portalUrl,h.map.itemId,this.mapDivId,{mapOptions:t,bingMapsKey:h.bingMapsKey,usePopupManager:!0}).then(a.hitch(this,function(r){var u=r.map;u.hideZoomSlider();
u.infoWindow.resize(270,316);u.itemId=h.map.itemId;u.itemInfo=r.itemInfo;u.webMapResponse=r;u.enableSnapping({snapKey:k.copyKey});d.setStyle(u.root,"zIndex",0);u._initialExtent=u.extent;c.forEach("extent center marker find query scale level".split(" "),function(y){},this);this._publishMapEvent(u)}),a.hitch(this,function(){this.loading&&this.loading.destroy();f.publish("mapCreatedFailed")}))},_processMapOptions:function(h){if(h)return h.lods||delete h.lods,h.lods&&0===h.lods.length&&delete h.lods,
h=a.clone(h),h.extent&&(h.extent=new g(h.extent)),h.center&&!a.isArrayLike(h.center)&&(h.center=new q(h.center)),h},onAppConfigChanged:function(h,t,r){this.appConfig=h;"mapChange"===t?this._recreateMap(h):"mapOptionsChange"===t&&r.initialState&&(h=r.initialState.viewpoint)&&(this.sceneView.map.initialViewProperties.viewpoint=v.fromJSON(h),this.sceneView.animateTo(v.fromJSON(h)))},_recreateMap:function(h){this.sceneView&&(f.publish("beforeSceneViewDestory",this.sceneView),this._destroySceneView());
this._showMap(h)},disableWebMapPopup:function(){},enableWebMapPopup:function(){}});p.getInstance=function(h,t){null===x&&(x=new p(h,t));return x};return p})},"jimu/dijit/LoadingShelter":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/LoadingShelter.html","dojo/_base/html"],function(b,a,c,d,f){return b([a,c],{baseClass:"jimu-loading-shelter",declaredClass:"jimu.dijit.LoadingShelter",templateString:d,loadingText:null,hidden:!1,showLoading:!0,
postMixInProperties:function(){this.nls=window.jimuNls.loadingShelter},postCreate:function(){this.inherited(arguments);this.hidden&&f.setStyle(this.domNode,"display","none");f.setStyle(this.domNode,{width:"100%",height:"100%"});this.showLoading||f.setStyle(this.imgDiv,"display","none");"string"===typeof this.loadingText&&(this.textNode.innerHTML=this.loadingText)},show:function(n){this.domNode&&this.hidden&&("string"===typeof n&&(this.textNode.innerHTML=n),f.setStyle(this.domNode,"display","block"),
this.hidden=!1)},hide:function(){this.domNode&&!this.hidden&&(f.setStyle(this.domNode,"display","none"),this.hidden=!0)}})})},"dijit/_TemplatedMixin":function(){define("dojo/cache dojo/_base/declare dojo/dom-construct dojo/_base/lang dojo/on dojo/sniff dojo/string ./_AttachMixin".split(" "),function(b,a,c,d,f,n,k,g){var q=a("dijit._TemplatedMixin",g,{templateString:null,templatePath:null,_skipNodeCache:!1,searchContainerNode:!0,_stringRepl:function(e){var m=this.declaredClass,l=this;return k.substitute(e,
this,function(w,v){"!"==v.charAt(0)&&(w=d.getObject(v.substr(1),!1,l));if("undefined"==typeof w)throw Error(m+" template:"+v);return null==w?"":"!"==v.charAt(0)?w:this._escapeValue(""+w)},this)},_escapeValue:function(e){return e.replace(/["'<>&]/g,function(m){return{"\x26":"\x26amp;","\x3c":"\x26lt;","\x3e":"\x26gt;",'"':"\x26quot;","'":"\x26#x27;"}[m]})},buildRendering:function(){if(!this._rendered){this.templateString||(this.templateString=b(this.templatePath,{sanitize:!0}));var e=q.getCachedTemplate(this.templateString,
this._skipNodeCache,this.ownerDocument);if(d.isString(e)){var m=c.toDom(this._stringRepl(e),this.ownerDocument);if(1!=m.nodeType)throw Error("Invalid template: "+e);}else m=e.cloneNode(!0);this.domNode=m}this.inherited(arguments);this._rendered||this._fillContent(this.srcNodeRef);this._rendered=!0},_fillContent:function(e){var m=this.containerNode;if(e&&m)for(;e.hasChildNodes();)m.appendChild(e.firstChild)}});q._templateCache={};q.getCachedTemplate=function(e,m,l){var w=q._templateCache,v=e,x=w[v];
if(x){try{if(!x.ownerDocument||x.ownerDocument==(l||document))return x}catch(p){}c.destroy(x)}e=k.trim(e);if(m||e.match(/\$\{([^\}]+)\}/g))return w[v]=e;m=c.toDom(e,l);if(1!=m.nodeType)throw Error("Invalid template: "+e);return w[v]=m};n("ie")&&f(window,"unload",function(){var e=q._templateCache,m;for(m in e){var l=e[m];"object"==typeof l&&c.destroy(l);delete e[m]}});return q})},"dojo/cache":function(){define(["./_base/kernel","./text"],function(b){return b.cache})},"dojo/text":function(){define(["./_base/kernel",
"require","./has","./has!host-browser?./request"],function(b,a,c,d){var f;c("host-browser")?f=function(e,m,l){d(e,{sync:!!m,headers:{"X-Requested-With":null}}).then(l)}:a.getText?f=a.getText:console.error("dojo/text plugin failed to load because loader does not support getText");var n={},k=function(e){if(e){e=e.replace(/^\s*<\?xml(\s)+version=['"](\d)*.(\d)*['"](\s)*\?>/im,"");var m=e.match(/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im);m&&(e=m[1])}else e="";return e},g={},q={};b.cache=function(e,m,l){if("string"==
typeof e)if(/\//.test(e)){var w=e;l=m}else w=a.toUrl(e.replace(/\./g,"/")+(m?"/"+m:""));else w=e+"",l=m;e=void 0!=l&&"string"!=typeof l?l.value:l;l=l&&l.sanitize;if("string"==typeof e)return n[w]=e,l?k(e):e;if(null===e)return delete n[w],null;w in n||f(w,!0,function(v){n[w]=v});return l?k(n[w]):n[w]};return{dynamic:!0,normalize:function(e,m){e=e.split("!");var l=e[0];return(/^\./.test(l)?m(l):l)+(e[1]?"!"+e[1]:"")},load:function(e,m,l){e=e.split("!");var w=1<e.length,v=e[0],x=m.toUrl(e[0]);e="url:"+
x;var p=g,h=function(r){l(w?k(r):r)};v in n?p=n[v]:m.cache&&e in m.cache?p=m.cache[e]:x in n&&(p=n[x]);if(p===g)if(q[x])q[x].push(h);else{var t=q[x]=[h];f(x,!m.async,function(r){n[v]=n[x]=r;for(var u=0;u<t.length;)t[u++](r);delete q[x]})}else h(p)}}})},"dijit/_AttachMixin":function(){define("require dojo/_base/array dojo/_base/connect dojo/_base/declare dojo/_base/lang dojo/mouse dojo/on dojo/touch ./_WidgetBase".split(" "),function(b,a,c,d,f,n,k,g,q){var e=f.delegate(g,{mouseenter:n.enter,mouseleave:n.leave,
keypress:c._keypress}),m;c=d("dijit._AttachMixin",null,{constructor:function(){this._attachPoints=[];this._attachEvents=[]},buildRendering:function(){this.inherited(arguments);this._attachTemplateNodes(this.domNode);this._beforeFillContent()},_beforeFillContent:function(){},_attachTemplateNodes:function(l){for(var w=l;;)if(1==w.nodeType&&(this._processTemplateNode(w,function(v,x){return v.getAttribute(x)},this._attach)||this.searchContainerNode)&&w.firstChild)w=w.firstChild;else{if(w==l)break;for(;!w.nextSibling;)if(w=
w.parentNode,w==l)return;w=w.nextSibling}},_processTemplateNode:function(l,w,v){var x=!0,p=this.attachScope||this,h=w(l,"dojoAttachPoint")||w(l,"data-dojo-attach-point");if(h)for(var t=h.split(/\s*,\s*/);h=t.shift();)f.isArray(p[h])?p[h].push(l):p[h]=l,x="containerNode"!=h,this._attachPoints.push(h);if(w=w(l,"dojoAttachEvent")||w(l,"data-dojo-attach-event"))for(h=w.split(/\s*,\s*/),t=f.trim;w=h.shift();)if(w){var r=null;-1!=w.indexOf(":")?(r=w.split(":"),w=t(r[0]),r=t(r[1])):w=t(w);r||(r=w);this._attachEvents.push(v(l,
w,f.hitch(p,r)))}return x},_attach:function(l,w,v){w=w.replace(/^on/,"").toLowerCase();w="dijitclick"==w?m||(m=b("./a11yclick")):e[w]||w;return k(l,w,v)},_detachTemplateNodes:function(){var l=this.attachScope||this;a.forEach(this._attachPoints,function(w){delete l[w]});this._attachPoints=[];a.forEach(this._attachEvents,function(w){w.remove()});this._attachEvents=[]},destroyRendering:function(){this._detachTemplateNodes();this.inherited(arguments)}});f.extend(q,{dojoAttachEvent:"",dojoAttachPoint:""});
return c})},"jimu/WebSceneLoader":function(){define("dojo/Deferred dojo/_base/lang dojo/_base/array dojo/_base/html dojo/promise/all esri/kernel esri/WebScene esri/views/SceneView esri/portal/Portal esri/portal/PortalItem esri/core/has ./utils ./portalUtils ./portalUrlUtils".split(" "),function(b,a,c,d,f,n,k,g,q,e,m,l,w,v){return{createMap:function(x,p,h){var t=new b;this._isWebGLAvailable()?t=this._createMap(x,p,h):(t.reject("The browser doesn't support webgl."),(x=a.getObject("webSceneLoader.webglSupportTip",
!1,window.jimuNls))||(x="3D web apps aren't supported in your browser."),d.create("div",{"class":"app-error",innerHTML:x},document.body));return t},_createMap:function(x,p,h){l.getEsriConfig().portalUrl=v.getStandardPortalUrl(p);var t=new b,r=[];q._default=null;var u=new k({portalItem:new e({id:h,portal:{url:v.getStandardPortalUrl(p)}})}),y=new g({map:u,container:x,constraints:{collision:{enabled:!1},tilt:{max:179.99}}});r.push(y.when());p=w.getPortal(p);r.push(p.getItemById(h));r.push(p.getItemData(h));
f(r).then(a.hitch(this,function(z){y.popup&&(y.popup.closeOnViewChangeEnabled=!0);u.id=x;u.itemId=h;u.itemInfo={item:z[1],itemData:z[2]};this._handleLocalScene(y);t.resolve(y)}),a.hitch(this,function(z){console.error(z);t.reject(z)}));return t},_handleLocalScene:function(x){try{x.viewingMode&&"local"===x.viewingMode.toLowerCase()&&(a.setObject("constraints.collision.enabled",!1,x),a.setObject("constraints.tilt.max",179.99,x))}catch(p){console.error(p)}},_handleAttribution:function(x){try{if("4.0"!==
n.version){var p=x.ui&&x.ui._components;p&&0<p.length&&c.some(p,function(h){return(h=h&&h._widget)&&"esri.widgets.Attribution"===h.declaredClass?(h.domNode.parentNode.style.width="100%",d.create("span",{innerHTML:"Powered by Esri","class":"esri-attribution-powered-by"},h.domNode),!0):!1})}}catch(h){console.error(h)}},_isWebGLAvailable:function(){try{var x=document.createElement("canvas");return!(!window.WebGLRenderingContext||!x.getContext("webgl")&&!x.getContext("experimental-webgl"))}catch(p){return!1}},
_isWebGL2Available:function(){try{var x=document.createElement("canvas");return!(!window.WebGL2RenderingContext||!x.getContext("webgl2"))}catch(p){return!1}}}})},"esri/WebScene":function(){define("require ./chunks/tslib.es6 ./kernel ./Map ./Viewpoint ./core/Collection ./core/Error ./core/lang ./core/Loadable ./core/loadAll ./core/Logger ./core/maybe ./core/MultiOriginJSONSupport ./core/Promise ./core/promiseUtils ./core/reactiveUtils ./core/urlUtils ./core/accessorSupport/decorators/property ./core/accessorSupport/ensureType ./core/accessorSupport/decorators/reader ./core/accessorSupport/decorators/subclass ./core/accessorSupport/decorators/writer ./core/accessorSupport/originUtils ./core/accessorSupport/read ./geometry/Extent ./geometry/HeightModelInfo ./geometry/projection ./geometry/SpatialReference ./geometry/support/heightModelInfoUtils ./geometry/support/jsonUtils ./geometry/support/spatialReferenceUtils ./portal/Portal ./portal/PortalItem ./portal/support/portalItemUtils ./support/basemapUtils ./support/MapFloorInfo ./support/tagSymbols ./support/webSceneUtils ./views/ViewingMode ./views/support/spatialReferenceSupport ./webdoc/interfaces ./webdoc/saveAPIKeyUtils ./webdoc/support/saveUtils ./webdoc/support/thumbnailUtils ./webscene/ApplicationProperties ./webscene/Environment ./webscene/InitialViewProperties ./webscene/Presentation ./webscene/TransportationNetwork ./webscene/Version ./webscene/support/schemaValidatorLoader".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A,C,E,B,D,F,K,L,G,O,P,J,R,X,U,M,V,Y,W,H,S,I,Q,N,T,aa,Z,da,fa){const ka=new da.Version(1,32);d=class extends q.LoadableMixin(v.EsriPromiseMixin(w.MultiOriginJSONMixin(d))){constructor(ba){super(ba);this[ha]=!0;this._layersIdGCTimeoutId=void 0;this.clippingArea=this.applicationProperties=this._updateFromPromise=null;this.clippingEnabled=!1;this.floorInfo=null;this.heightModelInfo=void 0;this.transportationNetworks=this.sourceVersion=null;this.presentation=
new aa;this.initialViewProperties=new T;this.resourceInfo=this.portalItem=null;this._debouncedSaveOperations=x.debounce(async(ea,ca,ia)=>{switch(ea){case W.SaveOperationType.SAVE:return this._saveImpl(ca);case W.SaveOperationType.SAVE_AS:return this._saveAsImpl(ia,ca)}});this._resourceReferences={portalItem:null,paths:[]};this.authoringAppVersion=this.authoringApp=null;this._isAuthoringAppVersionSetByUser=this._isAuthoringAppSetByUser=!1}initialize(){this.when().catch(ba=>{m.getLogger(this).error("#load()",
"Failed to load web scene",ba)});if(this.resourceInfo){let ba;try{ba=this._validateJSON(this.resourceInfo)}catch(ea){this.addResolvingPromise(Promise.reject(ea));return}this.read(ba);this.addResolvingPromise(this._validateSpatialReference());this.addResolvingPromise(this._validateHeightModelInfo())}this.addHandles(p.on(()=>this.allLayers,"change",()=>this._scheduleLayersIdGC()))}destroy(){this._unscheduleLayersIdGC();this.presentation&&this.presentation.destroy();this.portalItem=l.destroyMaybe(this.portalItem)}writeClippingArea(ba,
ea){ea.clippingArea||(ea.clippingArea={});ea.clippingArea.geometry=ba.toJSON()}readClippingEnabled(ba,ea){return ea.clippingArea?!!ea.clippingArea.clip:!1}writeClippingEnabled(ba,ea){this.clippingArea&&(ea.clippingArea||(ea.clippingArea={}),ea.clippingArea.clip=ba)}writeLayers(ba,ea,ca,ia){ea[ca]=this._layersToJSON(ba,"operational-layers",ia)}readSourceVersion(ba,ea){const [ca,ia]=ea.version.split(".");return new da.Version(parseInt(ca,10),parseInt(ia,10))}writeSourceVersion(ba,ea,ca){ea[ca]=`${ka.major}.${ka.minor}`}writeTables(ba,
ea,ca,ia){ba=this._layersToJSON(ba,"tables",ia);ba.length&&(ea[ca]=ba)}get thumbnailUrl(){return this.portalItem?.thumbnailUrl??null}set thumbnailUrl(ba){ba?this._override("thumbnailUrl",ba):(this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"))}set authoringApp(ba){this._isAuthoringAppSetByUser=!0;this._set("authoringApp",ba)}writeAuthoringApp(ba,ea){ea.authoringApp=ba&&this._isAuthoringAppSetByUser?ba:"ArcGIS API for JavaScript"}set authoringAppVersion(ba){this._isAuthoringAppVersionSetByUser=
!0;this._set("authoringAppVersion",ba)}writeAuthoringAppVersion(ba,ea){ea.authoringAppVersion=ba&&this._isAuthoringAppVersionSetByUser?ba:c.version}writeGround(ba,ea,ca,ia){ea[ca]=ba?ba.write({},ia):{transparency:0,layers:[]}}readInitialViewProperties(ba,ea){ba={};ea.initialState?.environment&&(ba.environment=N.fromJSON(ea.initialState.environment));ba.spatialReference=ea.spatialReference?F.fromJSON(ea.spatialReference):F.WebMercator;ba.viewingMode=ea.viewingMode??"global";ea.initialState?.viewpoint&&
(ba.viewpoint=f.fromJSON(ea.initialState.viewpoint));return new T(ba)}get spatialReference(){return this.initialViewProperties?.spatialReference??F.WebMercator}get viewingMode(){return this.initialViewProperties?.viewingMode??"global"}load(ba){const ea=this.ground;this.addResolvingPromise(this._loadFromSource().then(()=>{ea&&ea!==this.ground&&ea.destroy()}));return Promise.resolve(this)}loadAll(){return e.loadAll(this,ba=>{const ea=this.presentation&&this.presentation.slides;ba(this.ground,this.basemap,
this.layers,ea&&ea.map(ca=>ca.basemap),this.tables)})}read(ba,ea){ea={...ea,origin:"web-scene"};const ca=this._isAuthoringAppVersionSetByUser,ia=this._isAuthoringAppSetByUser;C.readLoadable(this,ba,la=>super.read(ba,la),ea);ia||(this._isAuthoringAppSetByUser=!1);ca||(this._isAuthoringAppVersionSetByUser=!1);if(ba.baseMap&&Array.isArray(ba.baseMap.elevationLayers)&&(this.sourceVersion?.supportsVisibleElevationLayersInSlides??!1)){ea=ba.baseMap.elevationLayers.map(ra=>({id:ra.id}));const la=this.presentation.slides,
oa=(ra,ta)=>ra.visibleLayers.some(ma=>ma.id===ta),na=ea.filter(ra=>!la.some(ta=>oa(ta,ra.id)));la.forEach(ra=>{ra.visibleLayers.addMany(na)})}}_writeBasemapElevationLayers(ba){const ea=ba.ground?.layers;!ba.baseMap&&ea?.length&&(ba.baseMap={title:"Basemap",baseMapLayers:[]});ba.baseMap&&(ba.baseMap.elevationLayers=g.clone(ea))}_layersToJSON(ba,ea,ca){const ia={...ca,layerContainerType:ea};return ba.map(la=>this._verifyWritableLayer(la,ca)?la.write({},ia):null).filter(la=>!!la).toArray()}_verifyWritableLayer(ba,
ea){return ba.persistenceEnabled?"write"in ba?!0:(ea?.messages&&ea.messages.push(new k("layer:unsupported",`Layers (${ba.title}, ${ba.id}) of type '${ba.declaredClass}' cannot be persisted in web scenes`,{layer:ba})),!1):!1}write(ba,ea){if("loaded"!==this.loadStatus)throw ea=new k("webscene:not-loaded","Web scene must be loaded before it can be serialized"),m.getLogger(this).error("#toJSON()","Web scene must be loaded before it can be serialized",this.loadError||this.loadStatus),ea;this._runLayersIdGC();
var ca=!ea?.messages;ea={messages:[],...ea,origin:"web-scene"};ba=super.write(ba,ea);if(ca&&(ea=ea.messages?.filter(ia=>"web-document-write:property-required"===ia.name)??[],ea.length))throw ca=new k("web-document:property-required","One or more properties that are required in the webscene JSON are missing, see details for the specific errors",{errors:ea}),m.getLogger(this).error("#toJSON()","One or more properties that are required in the webscene JSON are missing",ea),ca;this._writeBasemapElevationLayers(ba);
return ba}async save(ba){return this._debouncedSaveOperations(W.SaveOperationType.SAVE,ba)}async _saveImpl(ba){if(!this.portalItem)throw new k("webscene:portal-item-not-set","Portal item to save to has not been set on the WebScene");H.validateSaveAPIKey(this.portalItem);if("Web Scene"!==this.portalItem?.type)throw new k("webscene:portal-item-wrong-type",'Portal item needs to have type "Web Scene"');const ea=this._updateFromPromise;await this._ensureLoadBeforeSave();const ca=this._enableVerifyItemRelativeUrls({origin:"web-scene",
url:this.portalItem.itemUrl?h.urlToObject(this.portalItem.itemUrl):null,messages:[],portal:this.portalItem.portal??O.getDefault(),portalItem:this.portalItem,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}}),ia=this.write({},ca);await Promise.all(ca.resources.pendingOperations);await this._verifySave(ia,ca,ba);this._updateTypeKeywords(this.portalItem);await S.updateItemWithResources(this.portalItem,ia,this._resourceReferences,ca,null);A.updateOrigins(ca);
ea&&await ea;await this._saveThumbnail();return this.portalItem}async saveAs(ba,ea){return this._debouncedSaveOperations(W.SaveOperationType.SAVE_AS,ea,ba)}async _saveAsImpl(ba,ea){ba=P.from(ba);if(!ba)throw new k("webscene:portal-item-required","saveAs requires a portal item to save to");H.validateSaveAPIKey(ba);ba.id&&(ba=ba.clone(),ba.id=null);const ca=ba.portal||O.getDefault();await this._ensureLoadBeforeSave();ba.type="Web Scene";ba.portal=ca;const ia=this._enableVerifyItemRelativeUrls({origin:"web-scene",
url:null,messages:[],portal:ca,portalItem:ba,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}}),la=this.write({},ia);await Promise.all(ia.resources.pendingOperations);await this._verifySaveAs(la,ia,ea);const oa=this.thumbnailUrl,na=!this._isOverridden("thumbnailUrl");this._updateTypeKeywords(ba);await ca.signIn();if(!ca.user)throw new k("webscene:user-not-signed-in","saveAs requires a user to be signed in to the portal");await ca.user.addItem({item:ba,
folder:ea?.folder,data:la});await S.saveResources(this._resourceReferences,ia,null);this.portalItem=ba;w.MultiOriginJSONSupport.prototype.read.call(this,{version:la.version,authoringApp:la.authoringApp,authoringAppVersion:la.authoringAppVersion},{name:"web-scene",ignoreDefaults:!0,url:ba.itemUrl?h.urlToObject(ba.itemUrl):void 0});A.updateOrigins(ia);oa&&(this.thumbnailUrl=na?h.addQueryParameter(oa,"w","8192"):oa);ia.portalItem=ba;await this._saveThumbnail();return ba}async _saveThumbnail(){this._isOverridden("thumbnailUrl")&&
(await this.portalItem?.updateThumbnail({thumbnail:this.thumbnailUrl}),this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"))}_verifySave(ba,ea,ca,ia=!1){if(!G.isEarth(this.spatialReference))return Promise.reject(new k("webscene:unsupported-spatial-reference","Webscenes using spatial reference systems from Mars or Moon can not be saved currently."));let la=ea.messages?.filter(oa=>"error"===oa.type).map(oa=>new k(oa.name,oa.message,oa.details))??[];ea.blockedRelativeUrls&&(la=la.concat(ea.blockedRelativeUrls.map(oa=>
new k("url:unsupported",`Relative url '${oa}' is not supported in Web Scene`))));ca&&ca.ignoreUnsupported&&(la=la.filter(oa=>"layer:unsupported"!==oa.name&&"symbol:unsupported"!==oa.name&&"symbol-layer:unsupported"!==oa.name&&"property:unsupported"!==oa.name&&"url:unsupported"!==oa.name&&"scenemodification:unsupported"!==oa.name));ca?.requiredPropertyChecksDisabled&&(la=la.filter(oa=>"web-document-write:property-required"!==oa.name));ea=!!ca?.strictSchemaValidationEnabled;ca=fa.getLoader();return(ea&&
ca?ca().then(oa=>{oa=oa.validate(ba);if(0<oa.length){const na=`webscene did not validate:\n${oa.join("\n")}`;m.getLogger(this).error(`${ia?"saveAs":"save"}(): ${na}`)}return oa.map(na=>new k("webscene:schema-validation",na))}).then(oa=>{if(0<oa.length)throw M.createSchemaValidationError(oa.concat(la));return la}):Promise.resolve(la)).then(oa=>{if(0<oa.length)throw new k("webscene:save","Failed to save webscene due to unsupported or invalid content. See 'details.errors' for more detailed information",
{errors:oa});})}_verifySaveAs(ba,ea,ca){return this.canNotSaveAs(ea)?Promise.reject(M.createCopyError()):this._verifySave(ba,ea,ca,!0)}verifySaveAs(ba){const ea=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),ca=this.write({},ea);return this._verifySaveAs(ca,ea,ba)}canNotSaveAs(ba){ba||(ba=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),this.write({},ba));return 0<(ba.verifyItemRelativeUrls?.writtenUrls?.length??0)}async updateFrom(ba,ea={}){this._updateFromPromise=
ba=this._updateFrom(ba,ea);await ba;this._updateFromPromise===ba&&(this._updateFromPromise=null)}async _updateFrom(ba,ea={}){await ba.whenReady();!ea.environmentExcluded&&ba.environment&&(this.initialViewProperties.environment=N.prototype.clone.apply(ba.environment));!ea.viewpointExcluded&&ba.viewpoint&&(this.initialViewProperties.viewpoint=ba.viewpoint.clone());this.initialViewProperties.spatialReference=ba.spatialReference.clone();this.initialViewProperties.viewingMode=ba.viewingMode;null!=ba.clippingArea?
ba.clippingArea!==this.clippingArea&&(this.clippingArea=ba.clippingArea.clone(),this.clippingEnabled=!0):this.clippingEnabled=!1;ba.heightModelInfo&&(this.heightModelInfo=ba.heightModelInfo.clone());if(ba.map===this)for(const ca of ba.allLayerViews)"visible"in ca&&"visible"in ca.layer&&ca._isOverridden("visible")&&(ca.layer.visible=ca.visible);(!1===ea.thumbnailExcluded||null==ea.thumbnailExcluded&&!ea.viewpointExcluded)&&await this._updateFromThumbnail(ba,ea.thumbnailSize??void 0)}async _updateFromThumbnail(ba,
ea){ea=I.getOptimalThumbnailSize(ba,ea);this.thumbnailUrl=(await ba.takeScreenshot({format:"jpg",width:ea.width,height:ea.height,disableDecorations:!0})).dataUrl}_loadFromSource(){return this.resourceInfo?this._loadFromJSON(this.resourceInfo,{origin:"web-scene"}):this.portalItem?.id?this._loadFromItem(this.portalItem):this._loadObjectsWithLayers()}_readAndLoadFromJSON(ba,ea){ba=this._validateJSON(ba);this.read(ba,ea);return this._loadFromJSON(ba,ea)}_extractOperationalLayers(ba){const ea=[];if(!this.sourceVersion?.supportsGround&&
ba.baseMap&&Array.isArray(ba.baseMap.elevationLayers))for(const la of ba.baseMap.elevationLayers)ea.push(la);const ca=[],ia=la=>{la.layers&&(la.layers=la.layers.filter(ia));return"ArcGISTiledElevationServiceLayer"===la.layerType?(this.sourceVersion?.supportsGround||ca.push(la),!1):!0};return{operationalLayers:ba.operationalLayers?ba.operationalLayers.filter(ia):[],operationalElevationLayers:ca,basemapElevationLayers:ea}}async _loadFromJSON(ba,ea){const ca=new n;await this._validateSpatialReference();
await this._validateHeightModelInfo();const {populateOperationalLayers:ia}=await new Promise((ta,ma)=>b(["./layers/support/layersCreator"],ta,ma)),{operationalLayers:la,operationalElevationLayers:oa,basemapElevationLayers:na}=this._extractOperationalLayers(ba),ra=[];ea={context:{...ea,layerContainerType:"operational-layers"}};this.portalItem&&(ea.context.portal=this.portalItem.portal||O.getDefault());0<na.length&&ra.push(ia(this.ground.layers,na,{...ea,context:{...ea.context,layerContainerType:"ground"},
defaultLayerType:"ArcGISTiledElevationServiceLayer"}));0<oa.length&&ra.push(ia(ca,oa,{...ea,context:{...ea.context,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"}));la&&0<la.length&&ra.push(ia(this.layers,la,ea));ba.tables?.length&&ra.push(ia(this.tables,ba.tables,{...ea,context:{...ea.context,layerContainerType:"tables"},defaultLayerType:"ArcGISFeatureLayer"}));await Promise.allSettled(ra);await this._loadObjectsWithLayers();this.ground.layers.addMany(ca)}async _ensureLoadBeforeSave(){await this.load();
await this._loadObjectsWithLayers();const ba=[];var ea=[...this.allLayers.items];for(const {basemap:ca}of this.presentation.slides.items)ca&&(ea.push(...ca.baseLayers.items),ea.push(...ca.referenceLayers.items));for(const ca of ea)"beforeSave"in ca&&"function"===typeof ca.beforeSave&&(ea=ca.beforeSave())&&ba.push(ea);await Promise.allSettled(ba)}async _loadObjectsWithLayers(){const ba=[];this.ground&&ba.push(this.ground.load());this.basemap&&ba.push(this.basemap.load());this.presentation.slides.forEach(ea=>
{ea.basemap&&ba.push(ea.basemap.load())});await Promise.allSettled(ba)}async _loadFromItem(ba){await ba.load().catch(ia=>{throw new k("webscene:load-portal-item","Failed to load portal item",{error:ia});});if("Web Scene"!==ba.type)throw new k("webscene:invalid-portal-item","Invalid portal item type '${type}', expected 'Web Scene'",{type:ba.type});const ea=await ba.fetchData();this.resourceInfo=ea;const ca={origin:"web-scene",url:h.urlToObject(ba.itemUrl),portal:ba.portal||O.getDefault(),portalItem:ba,
readResourcePaths:[]};await this._readAndLoadFromJSON(ea,ca);this._resourceReferences={portalItem:ba,paths:ca.readResourcePaths??[]}}_validateSpatialReference(){const ba=this.initialViewProperties,ea=this._sceneSpatialReference;let ca=void 0;if("local"!==ba.viewingMode){if(!Y.isSpatialReferenceSupported(ea,V.ViewingMode.Global))return Promise.reject(new k("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in global mode, only Web Mercator, WGS84 GCS or CGCS2000 are supported",
{spatialReference:ea,viewingMode:ba.viewingMode}));ca=oa=>!oa||D.canProjectWithoutEngine(oa,ea)}else{if(!Y.isSpatialReferenceSupported(ea,V.ViewingMode.Local))return Promise.reject(new k("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in local mode, only projected coordinate systems are supported",{spatialReference:ea,viewingMode:ba.viewingMode}));ca=oa=>!oa||oa.equals(ea)}const ia=oa=>oa?.camera?.position.spatialReference??oa?.targetGeometry?.spatialReference;
var la=ia(ba.viewpoint);return la&&!ca(la)?Promise.reject(new k("webscene:incompatible-camera-spatial-reference","Camera spatial reference (${cameraSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{cameraSpatialReference:la,sceneSpatialReference:ea,viewingMode:ba.viewingMode})):(la=this.presentation.slides.find(oa=>!ca(ia(oa.viewpoint))))?(la=ia(la.viewpoint),Promise.reject(new k("webscene:incompatible-slide-spatial-reference","Slide spatial reference (${slideSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",
{slideSpatialReference:la,sceneSpatialReference:ea,viewingMode:ba.viewingMode}))):Promise.resolve()}_validateHeightModelInfo(){const ba=K.validateWebSceneError(this.heightModelInfo,this._sceneSpatialReference);return ba?Promise.reject(ba):Promise.resolve()}_validateJSON(ba){const ea=da.Version.parse(ba.version||"","webscene");ka.validate(ea);ba.version=`${ea.major}.${ea.minor}`;1===ea.major&&2>=ea.minor&&(ba.spatialReference=F.WebMercator.toJSON());return ba}_updateTypeKeywords(ba){J.toggleTypeKeword(ba,
J.TypeKeyword.LOCAL_SCENE,"local"===this.initialViewProperties.viewingMode);J.toggleTypeKeword(ba,J.TypeKeyword.DEVELOPER_BASEMAP,R.hasDeveloperBasemapLayer(this.basemap)||this.presentation.slides.some(({basemap:ea})=>!!ea&&R.hasDeveloperBasemapLayer(ea)));ba.typeKeywords&&(ba.typeKeywords=ba.typeKeywords.filter((ea,ca,ia)=>ia.indexOf(ea)===ca))}get _sceneSpatialReference(){return this.initialViewProperties.spatialReference||F.WebMercator}get _verifyItemRelativeRootPath(){return this.portalItem?.itemUrl?
h.urlToObject(this.portalItem.itemUrl).path:null}_enableVerifyItemRelativeUrls(ba){const ea=this._verifyItemRelativeRootPath;ea&&(ba.verifyItemRelativeUrls={rootPath:ea,writtenUrls:[]});return ba}_unscheduleLayersIdGC(){this._layersIdGCTimeoutId&&(clearTimeout(this._layersIdGCTimeoutId),this._layersIdGCTimeoutId=0)}_scheduleLayersIdGC(){this._unscheduleLayersIdGC();this._layersIdGCTimeoutId=setTimeout(()=>{this._layersIdGCTimeoutId=0;this._runLayersIdGC()},3E3)}_runLayersIdGC(){this._unscheduleLayersIdGC();
var ba=this.applicationProperties?.viewing?.search;const ea=ca=>this.allLayers.some(ia=>ia.id===ca&&ia.persistenceEnabled);ba&&ba.layers&&(ba.layers=ba.layers.filter(ca=>ea(ca.id)));(ba=this.presentation&&this.presentation.slides)&&ba.forEach(ca=>{ca.visibleLayers&&(ca.visibleLayers=ca.visibleLayers.filter(ia=>ea(ia.id)))})}static fromJSON(ba){if(!ba)throw new k("webscene:empty-resource","Expected a JSON resource but got nothing");return new this({resourceInfo:ba})}};var ha=U.WebSceneTag;d.version=
`${ka.major}.${ka.minor}`;a.__decorate([t.property({type:Q,json:{write:!0}})],d.prototype,"applicationProperties",void 0);a.__decorate([t.property({type:E,json:{read:{source:"clippingArea.geometry",reader:L.fromJSON},write:{target:"clippingArea.geometry"}}})],d.prototype,"clippingArea",void 0);a.__decorate([z.writer("clippingArea")],d.prototype,"writeClippingArea",null);a.__decorate([t.property({type:Boolean,json:{write:{target:"clippingArea.clip"}}})],d.prototype,"clippingEnabled",void 0);a.__decorate([u.reader("clippingEnabled",
["clippingArea"])],d.prototype,"readClippingEnabled",null);a.__decorate([z.writer("clippingEnabled")],d.prototype,"writeClippingEnabled",null);a.__decorate([t.property({type:X,json:{read:{source:"mapFloorInfo"},write:{target:"mapFloorInfo"}}})],d.prototype,"floorInfo",void 0);a.__decorate([t.property({type:B,json:{write:!0}})],d.prototype,"heightModelInfo",void 0);a.__decorate([t.property({json:{write:{target:"operationalLayers",ignoreOrigin:!0}}})],d.prototype,"layers",void 0);a.__decorate([z.writer("layers")],
d.prototype,"writeLayers",null);a.__decorate([t.property({readOnly:!0,type:da.Version,json:{type:(()=>{const ba=[],ea=ka.major;for(let ca=8;ca<=ka.minor;ca++)ba.push(`${ea}.${ca}`);return ba})(),write:{ignoreOrigin:!0,target:"version",isRequired:!0,overridePolicy:()=>({enabled:!0,allowNull:!0,ignoreOrigin:!0})}}})],d.prototype,"sourceVersion",void 0);a.__decorate([u.reader("sourceVersion",["version"])],d.prototype,"readSourceVersion",null);a.__decorate([z.writer("sourceVersion")],d.prototype,"writeSourceVersion",
null);a.__decorate([t.property({json:{read:!1,write:{enabled:!0,ignoreOrigin:!0}}})],d.prototype,"tables",void 0);a.__decorate([z.writer("tables")],d.prototype,"writeTables",null);a.__decorate([t.property()],d.prototype,"thumbnailUrl",null);a.__decorate([t.property({type:String,json:{write:{writerEnsuresNonNull:!0,ignoreOrigin:!0}}})],d.prototype,"authoringApp",null);a.__decorate([z.writer("authoringApp")],d.prototype,"writeAuthoringApp",null);a.__decorate([t.property({type:String,json:{write:{writerEnsuresNonNull:!0,
ignoreOrigin:!0}}})],d.prototype,"authoringAppVersion",null);a.__decorate([z.writer("authoringAppVersion")],d.prototype,"writeAuthoringAppVersion",null);a.__decorate([t.property({json:{write:{isRequired:!0,allowNull:!0,ignoreOrigin:!0,enabled:!0}}})],d.prototype,"ground",void 0);a.__decorate([z.writer("ground")],d.prototype,"writeGround",null);a.__decorate([t.property({type:n.ofType(Z),json:{write:!0}})],d.prototype,"transportationNetworks",void 0);a.__decorate([t.property({type:aa,nonNullable:!0,
json:{write:{ignoreOrigin:!0,writer:(ba,ea,ca,ia)=>{ba.slides&&0<ba.slides.length&&(ea.presentation=ba.write({},{...ia,isPresentation:!0}))}}}})],d.prototype,"presentation",void 0);a.__decorate([t.property({type:T,nonNullable:!0,json:{write:{target:"initialState",isRequired:!0,ignoreOrigin:!0},default:()=>new T({viewingMode:"global",spatialReference:F.WebMercator})}})],d.prototype,"initialViewProperties",void 0);a.__decorate([u.reader("initialViewProperties",["initialState.environment","initialState.viewpoint",
"spatialReference","viewingMode"])],d.prototype,"readInitialViewProperties",null);a.__decorate([t.property({type:F,json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0}}})],d.prototype,"spatialReference",null);a.__decorate([t.property({type:["local","global"],json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0}}})],d.prototype,"viewingMode",null);a.__decorate([t.property({type:P})],d.prototype,"portalItem",void 0);a.__decorate([t.property()],d.prototype,"resourceInfo",void 0);return d=a.__decorate([y.subclass("esri.WebScene")],
d)})},"esri/core/accessorSupport/originUtils":function(){define(["exports","../multiOriginJSONSupportUtils"],function(b,a){b.updateOrigins=function(c){c?.writtenProperties&&c.writtenProperties.forEach(({target:d,propName:f,newOrigin:n})=>{a.isMultiOriginJSONMixin(d)&&n&&d.originOf(f)!==n&&d.updateOrigin(f,n)})};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/core/multiOriginJSONSupportUtils":function(){define(["exports"],function(b){b.isMultiOriginJSONMixin=function(a){return a&&
"getAtOrigin"in a&&"originOf"in a};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/support/MapFloorInfo":function(){define("../chunks/tslib.es6 ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ../layers/support/FacilityLayerInfo ../layers/support/LevelLayerInfo ../layers/support/SiteLayerInfo".split(" "),function(b,a,c,d,f,n,k,g,q,e){a=class extends a.JSONSupport{constructor(m){super(m);
this.siteLayer=this.facilityLayer=this.levelLayer=null}};b.__decorate([c.property({type:q,json:{write:!0}})],a.prototype,"levelLayer",void 0);b.__decorate([c.property({type:g,json:{write:!0}})],a.prototype,"facilityLayer",void 0);b.__decorate([c.property({type:e,json:{write:!0}})],a.prototype,"siteLayer",void 0);return a=b.__decorate([k.subclass("esri.support.MapFloorInfo")],a)})},"esri/layers/support/FacilityLayerInfo":function(){define("../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),
function(b,a,c,d,f,n,k){a=class extends a.JSONSupport{constructor(g){super(g);this.sublayerId=this.siteIdField=this.nameField=this.layerId=this.facilityIdField=null}};b.__decorate([c.property({type:String,json:{write:!0}})],a.prototype,"facilityIdField",void 0);b.__decorate([c.property({type:String,json:{write:!0}})],a.prototype,"layerId",void 0);b.__decorate([c.property({type:String,json:{write:!0}})],a.prototype,"nameField",void 0);b.__decorate([c.property({type:String,json:{write:!0}})],a.prototype,
"siteIdField",void 0);b.__decorate([c.property({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],a.prototype,"sublayerId",void 0);return a=b.__decorate([k.subclass("esri.layers.support.FacilityLayerInfo")],a)})},"esri/layers/support/LevelLayerInfo":function(){define("../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),
function(b,a,c,d,f,n,k){a=class extends a.JSONSupport{constructor(g){super(g);this.verticalOrderField=this.sublayerId=this.shortNameField=this.longNameField=this.levelNumberField=this.levelIdField=this.layerId=this.facilityIdField=null}};b.__decorate([c.property({type:String,json:{write:!0}})],a.prototype,"facilityIdField",void 0);b.__decorate([c.property({type:String,json:{write:!0}})],a.prototype,"layerId",void 0);b.__decorate([c.property({type:String,json:{write:!0}})],a.prototype,"levelIdField",
void 0);b.__decorate([c.property({type:String,json:{write:!0}})],a.prototype,"levelNumberField",void 0);b.__decorate([c.property({type:String,json:{write:!0}})],a.prototype,"longNameField",void 0);b.__decorate([c.property({type:String,json:{write:!0}})],a.prototype,"shortNameField",void 0);b.__decorate([c.property({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],a.prototype,"sublayerId",void 0);b.__decorate([c.property({type:String,
json:{write:!0}})],a.prototype,"verticalOrderField",void 0);return a=b.__decorate([k.subclass("esri.layers.support.LevelLayerInfo")],a)})},"esri/layers/support/SiteLayerInfo":function(){define("../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),function(b,a,c,d,f,n,k){a=class extends a.JSONSupport{constructor(g){super(g);this.sublayerId=
this.siteIdField=this.nameField=this.layerId=null}};b.__decorate([c.property({type:String,json:{write:!0}})],a.prototype,"layerId",void 0);b.__decorate([c.property({type:String,json:{write:!0}})],a.prototype,"nameField",void 0);b.__decorate([c.property({type:String,json:{write:!0}})],a.prototype,"siteIdField",void 0);b.__decorate([c.property({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],a.prototype,"sublayerId",void 0);return a=
b.__decorate([k.subclass("esri.layers.support.SiteLayerInfo")],a)})},"esri/support/tagSymbols":function(){define(["exports"],function(b){const a=Symbol("WebScene");b.WebSceneTag=a;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/support/webSceneUtils":function(){define(["exports","../core/Error"],function(b,a){b.createCopyError=function(){return new a("webscene:failed-to-copy-embedded-resources","Copying of embedded resources is currently not supported")};b.createSchemaValidationError=
function(c){return new a("webscene:schema-validation","Failed to save webscene due to schema validation errors. See 'details.errors' for more detailed information",{errors:c})};b.schemaValidationErrorName="webscene:schema-validation";Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/spatialReferenceSupport":function(){define(["exports","../../geometry/support/SupportedGCSWkids","../ViewingMode"],function(b,a,c){b.isSpatialReferenceSupported=function(d,f){return null==
d?!1:null==f?!0:f===c.ViewingMode.Local?d.isGeographic?d.isWGS84||d.wkid===a.SupportedGCSWkids.CGCS2000:!0:d.isWebMercator||d.isWGS84||d.wkid===a.SupportedGCSWkids.CGCS2000||d.wkid===a.SupportedGCSWkids.GCSMARS2000||d.wkid===a.SupportedGCSWkids.GCSMARS2000_SPHERE||d.wkid===a.SupportedGCSWkids.GCSMOON2000};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/webdoc/saveAPIKeyUtils":function(){define(["exports","../config","../core/Error","../support/apiKeyUtils"],function(b,a,c,d){b.validateSaveAPIKey=
function(f){if(a.apiKey&&d.supportsApiKey(f.portal.url))throw new c("save-api-key-utils:api-key-not-supported",`Saving is not supported on ${f.portal.url} when using an api key`);};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/webdoc/support/saveUtils":function(){define("exports ../../core/asyncUtils ../../core/Error ../../core/promiseUtils ../../core/uuid ../../portal/support/resourceUtils".split(" "),function(b,a,c,d,f,n){async function k(m,l,w=null){if(l?.resources){var v=
l.portalItem===m.portalItem?new Set(m.paths):new Set;m.paths.length=0;m.portalItem=l.portalItem;var x=new Set(l.resources.toKeep.map(t=>t.resource.path)),p=new Set,h=[];x.forEach(t=>{v.delete(t);m.paths.push(t)});for(const t of l.resources.toUpdate)if(v.delete(t.resource.path),x.has(t.resource.path)||p.has(t.resource.path)){const {resource:r,content:u,finish:y,error:z}=t,A=n.getSiblingOfSameTypeI(r,f.generateUUID());m.paths.push(A.path);h.push(q({resource:A,content:u,compress:t.compress,finish:y,
error:z},w))}else m.paths.push(t.resource.path),h.push(e(t,w)),p.add(t.resource.path);for(const t of l.resources.toAdd)m.paths.push(t.resource.path),v.has(t.resource.path)?v.delete(t.resource.path):h.push(q(t,w));if(0===h.length)return v;l=await d.allSettledErrors(h);d.throwIfAborted(w);if(0<l.length)throw new c("save:resources","Failed to save one or more resources",{errors:l});return v}}async function g(m,l,w=null){if(m&&l.portalItem){var v=[];for(const x of m)m=l.portalItem.resourceFromPath(x),
v.push(m.portalItem.removeResource(m,w));await d.eachAlways(v)}}async function q(m,l){l={...(null!=l?l:{}),compress:m.compress};l=await a.result(m.resource.portalItem.addResource(m.resource,await n.contentToBlob(m.content),l));if(!0===l.ok)m.finish?.(m.resource);else throw m.error?.(l.error),l.error;}async function e(m,l){l=await a.result(m.resource.update(await n.contentToBlob(m.content),l));if(!0===l.ok)m.finish?.(m.resource);else throw m.error?.(l.error),l.error;}b.beforeSave=async function(m){const l=
[];for(const w of m.allLayers)"beforeSave"in w&&"function"===typeof w.beforeSave&&(m=w.beforeSave())&&l.push(m);await Promise.allSettled(l)};b.saveResources=async function(m,l,w=null){m=await k(m,l,w);await g(m,l,w)};b.updateItemWithResources=async function(m,l,w,v,x=null){w=await k(w,v,x);await m.update({data:l});await g(w,v,x)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/portal/support/resourceUtils":function(){define(["exports","../../request","../../core/Error","../../core/urlUtils"],
function(b,a,c,d){function f(k){const g=k.lastIndexOf("/");return-1===g?[".",k]:[k.slice(0,g),k.slice(g+1)]}function n(k){{const l=d.getPathExtension(k);k=null==l?[k,""]:[k.slice(0,k.length-l.length-1),`.${l}`]}const [g,q]=k,[e,m]=f(g);return[e,m,q]}b.addOrUpdateResource=async function(k,g,q,e){if(!k.hasPath())throw new c(`portal-item-resource-${g}:invalid-path`,"Resource does not have a valid path");const m=k.portalItem;await m.load(e);g=d.join(m.userItemUrl,"add"===g?"addResources":"updateResources");
const [l,w]=f(k.path),v=new FormData;l&&"."!==l&&v.append("resourcesPrefix",l);null!=e&&e.compress&&v.append("compress","true");v.append("fileName",w);v.append("file",q,w);v.append("f","json");e?.access&&v.append("access",e.access);await m.portal.request(g,{method:"post",body:v,signal:e?.signal});return k};b.contentToBlob=async function(k){return"blob"===k.type?k.blob:"json"===k.type?new Blob([k.jsonString],{type:"application/json"}):(await a(k.url,{responseType:"blob"})).data};b.fetchResources=async function(k,
g={},q){await k.load(q);const e=d.join(k.itemUrl,"resources"),{start:m=1,num:l=10,sortOrder:w="asc",sortField:v="created"}=g;g=await k.portal.request(e,{query:{start:m,num:l,sortOrder:w,sortField:v,token:k.apiKey},signal:q?.signal});return{total:g.total,nextStart:g.nextStart,resources:g.resources.map(({created:x,size:p,resource:h})=>({created:new Date(x),size:p,resource:k.resourceFromPath(h)}))}};b.getSiblingOfSameType=function(k,g){if(!k.hasPath())return null;const [q,,e]=n(k.path);return k.portalItem.resourceFromPath(d.join(q,
g+e))};b.getSiblingOfSameTypeI=function(k,g){if(!k.hasPath())return null;const [q,,e]=n(k.path);return k.portalItem.resourceFromPath(d.join(q,g+e))};b.removeAllResources=async function(k,g){await k.load(g);const q=d.join(k.userItemUrl,"removeResources");return k.portal.request(q,{method:"post",query:{deleteAll:!0},signal:g?.signal})};b.removeResource=async function(k,g,q){if(!g.hasPath())throw new c("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await k.load(q);
const e=d.join(k.userItemUrl,"removeResources");await k.portal.request(e,{method:"post",query:{resource:g.path},signal:q?.signal});g.portalItem=null};b.splitPrefixFileNameAndExtension=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/webdoc/support/thumbnailUtils":function(){define(["exports"],function(b){const a={width:600,height:400};b.getOptimalThumbnailSize=function(c,d){d=d||a;let {width:f,height:n}=d;d=f/n;1.5>d?n=f/1.5:1.5<d&&(f=1.5*n);f>c.width&&(n*=c.width/f,f=c.width);
n>c.height&&(f*=c.height/n,n=c.height);return{width:Math.round(f),height:Math.round(n)}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/webscene/ApplicationProperties":function(){define("../chunks/tslib.es6 ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ../webdoc/applicationProperties/Viewing".split(" "),function(b,a,c,d,f,n,k,g){var q;a=q=class extends a.JSONSupport{constructor(e){super(e);
this.viewing=null}clone(){return new q({viewing:this.viewing?this.viewing.clone():null})}};b.__decorate([c.property({type:g,json:{write:!0}})],a.prototype,"viewing",void 0);return a=q=b.__decorate([k.subclass("esri.webscene.ApplicationProperties")],a)})},"esri/webdoc/applicationProperties/Viewing":function(){define("../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ./Search".split(" "),
function(b,a,c,d,f,n,k){var g;a=g=class extends a.JSONSupport{constructor(q){super(q);this.search=null}clone(){return new g(c.clone({search:this.search}))}};b.__decorate([d.property({type:k,json:{write:!0}})],a.prototype,"search",void 0);return a=g=b.__decorate([n.subclass("esri.webdoc.applicationProperties.Viewing")],a)})},"esri/webdoc/applicationProperties/Search":function(){define("../../chunks/tslib.es6 ../../core/Collection ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/accessorSupport/extensions/serializableProperty/writePolicyUtils ./SearchLayer ./SearchTable".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l){var w;const v=a.ofType(m),x=a.ofType(l);a=w=class extends c.JSONSupport{constructor(p){super(p);this.enabled=this.addressSearchEnabled=!0;this.hintText=null;this.layers=new v;this.tables=new x}readAddressSearchEnabled(p){return!p}writeAddressSearchEnabled(p,h,t){h[t]=!p}clone(){return new w(d.clone({addressSearchEnabled:this.addressSearchEnabled,enabled:this.enabled,hintText:this.hintText,layers:this.layers,tables:this.tables}))}};b.__decorate([f.property({type:Boolean,
nonNullable:!0,json:{read:{source:"disablePlaceFinder"},write:{target:"disablePlaceFinder",isRequired:!0},origins:{"web-scene":{read:!1,write:!1}}}})],a.prototype,"addressSearchEnabled",void 0);b.__decorate([k.reader("addressSearchEnabled")],a.prototype,"readAddressSearchEnabled",null);b.__decorate([q.writer("addressSearchEnabled")],a.prototype,"writeAddressSearchEnabled",null);b.__decorate([f.property({type:Boolean,nonNullable:!0,json:{write:!0,origins:{"web-map":{write:{isRequired:!0}},"web-scene":{default:!0,
write:!0}}}})],a.prototype,"enabled",void 0);b.__decorate([f.property({type:String,json:{write:!0}})],a.prototype,"hintText",void 0);b.__decorate([f.property({type:v,json:{write:{overridePolicy:e.writeNonEmptyCollectionPolicy},origins:{"web-scene":{write:{isRequired:!0}}}}})],a.prototype,"layers",void 0);b.__decorate([f.property({type:x,json:{read:!0,write:{overridePolicy:e.writeNonEmptyCollectionPolicy}}})],a.prototype,"tables",void 0);return a=w=b.__decorate([g.subclass("esri.webdoc.applicationProperties.Search")],
a)})},"esri/core/accessorSupport/extensions/serializableProperty/writePolicyUtils":function(){define(["exports"],function(b){b.writeNonEmptyCollectionPolicy=function(a){return{enabled:!!a?.length}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/webdoc/applicationProperties/SearchLayer":function(){define("../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ./SearchLayerField".split(" "),
function(b,a,c,d,f,n,k){var g;a=g=class extends a.JSONSupport{constructor(q){super(q);this.subLayer=this.id=this.field=null}clone(){return new g(c.clone({field:this.field,id:this.id,subLayer:this.subLayer}))}};b.__decorate([d.property({type:k,json:{write:{isRequired:!0}}})],a.prototype,"field",void 0);b.__decorate([d.property({type:String,json:{write:{isRequired:!0}}})],a.prototype,"id",void 0);b.__decorate([d.property({type:f.Integer,json:{write:!0}})],a.prototype,"subLayer",void 0);return a=g=b.__decorate([n.subclass("esri.webdoc.applicationProperties.SearchLayer")],
a)})},"esri/webdoc/applicationProperties/SearchLayerField":function(){define("../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass ../../layers/support/fieldType".split(" "),function(b,a,c,d,f,n,k,g,q){var e;a=e=class extends a.JSONSupport{constructor(m){super(m);this.exactMatch=!1;this.type=
this.name=null}clone(){return new e({exactMatch:this.exactMatch,type:this.type,name:this.name})}};b.__decorate([c.property({type:Boolean,json:{write:!0}})],a.prototype,"exactMatch",void 0);b.__decorate([c.property({type:String,json:{write:!0}})],a.prototype,"name",void 0);b.__decorate([k.enumeration(q.kebabDict)],a.prototype,"type",void 0);return a=e=b.__decorate([g.subclass("esri.webdoc.applicationProperties.SearchLayerField")],a)})},"esri/webdoc/applicationProperties/SearchTable":function(){define("../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ./SearchTableField".split(" "),
function(b,a,c,d,f,n,k){var g;a=g=class extends a.JSONSupport{constructor(q){super(q);this.id=this.field=null}clone(){return new g(c.clone({field:this.field,id:this.id}))}};b.__decorate([d.property({type:k,json:{write:{isRequired:!0}}})],a.prototype,"field",void 0);b.__decorate([d.property({type:String,json:{write:{isRequired:!0}}})],a.prototype,"id",void 0);return a=g=b.__decorate([n.subclass("esri.webdoc.applicationProperties.SearchTable")],a)})},"esri/webdoc/applicationProperties/SearchTableField":function(){define("../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass ../../layers/support/fieldType".split(" "),
function(b,a,c,d,f,n,k,g,q){var e;a=e=class extends a.JSONSupport{constructor(m){super(m);this.exactMatch=!1;this.type=this.name=null}clone(){return new e({exactMatch:this.exactMatch,type:this.type,name:this.name})}};b.__decorate([c.property({type:Boolean,json:{write:!0}})],a.prototype,"exactMatch",void 0);b.__decorate([c.property({type:String,json:{write:!0}})],a.prototype,"name",void 0);b.__decorate([k.enumeration(q.kebabDict)],a.prototype,"type",void 0);return a=e=b.__decorate([g.subclass("esri.webdoc.applicationProperties.SearchTableField")],
a)})},"esri/webscene/Environment":function(){define("../chunks/tslib.es6 ../core/JSONSupport ../core/lang ../core/Logger ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass ../views/3d/environment/SunnyWeather ../views/3d/environment/weather ./lightingTypes ./SunLighting ./VirtualLighting ./background/utils".split(" "),function(b,a,c,d,f,n,k,g,q,e,m,l,w){var v;const x=d.getLogger("esri.webscene.Environment");d=(p,h,t)=>({enabled:!t||
!t.isPresentation});a=v=class extends a.JSONSupport{constructor(p){super(p);this.lighting=new m;this.background=null;this.starsEnabled=this.atmosphereEnabled=!0}set weather(p){q.validateWeatherType(p?.type,x)&&this._set("weather",p)}clone(){return new v(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&"virtual"===this.lighting.type?l.prototype.clone.call(this.lighting):m.prototype.clone.call(this.lighting),background:c.clone(this.background),atmosphereEnabled:this.atmosphereEnabled,
starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};b.__decorate([f.property({types:e.lightingTypes,nonNullable:!0,json:{write:!0}})],a.prototype,"lighting",void 0);b.__decorate([f.property(w.backgroundProperty)],a.prototype,"background",void 0);b.__decorate([f.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:d}}})],a.prototype,"atmosphereEnabled",void 0);b.__decorate([f.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:d}}})],a.prototype,"starsEnabled",
void 0);b.__decorate([f.property({types:q.weatherTypes,nonNullable:!0,json:{write:!0},value:new g})],a.prototype,"weather",null);return a=v=b.__decorate([k.subclass("esri.webscene.Environment")],a)})},"esri/views/3d/environment/SunnyWeather":function(){define("../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),
function(b,a,c,d,f,n,k,g){var q;a=q=class extends a.JSONSupport{constructor(e){super(e);this.type="sunny";this.cloudCover=.5}clone(){return new q({cloudCover:this.cloudCover})}};b.__decorate([k.enumeration({sunny:"sunny"})],a.prototype,"type",void 0);b.__decorate([c.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],a.prototype,"cloudCover",void 0);return a=q=b.__decorate([g.subclass("esri.views.3d.environment.SunnyWeather")],a)})},"esri/views/3d/environment/weather":function(){define("exports ./CloudyWeather ./FoggyWeather ./RainyWeather ./SnowyWeather ./SunnyWeather".split(" "),
function(b,a,c,d,f,n){a={key:"type",base:n,typeMap:{sunny:n,cloudy:a,rainy:d,snowy:f,foggy:c}};const k=Object.keys(a.typeMap);b.cloudsHeight=1E5;b.validateWeatherType=function(g,q){return k.includes(g)?!0:(q.error(`"${g}" is not a valid weather type`),!1)};b.weatherHeightLimit=1E4;b.weatherTypes=a;b.weatherTypesArray=k;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudyWeather":function(){define("../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),
function(b,a,c,d,f,n,k,g){var q;a=q=class extends a.JSONSupport{constructor(e){super(e);this.type="cloudy";this.cloudCover=.5}clone(){return new q({cloudCover:this.cloudCover})}};b.__decorate([k.enumeration({cloudy:"cloudy"})],a.prototype,"type",void 0);b.__decorate([c.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],a.prototype,"cloudCover",void 0);return a=q=b.__decorate([g.subclass("esri.views.3d.environment.CloudyWeather")],a)})},"esri/views/3d/environment/FoggyWeather":function(){define("../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),
function(b,a,c,d,f,n,k,g){var q;a=q=class extends a.JSONSupport{constructor(e){super(e);this.type="foggy";this.fogStrength=.5}clone(){return new q({fogStrength:this.fogStrength})}};b.__decorate([k.enumeration({foggy:"foggy"})],a.prototype,"type",void 0);b.__decorate([c.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],a.prototype,"fogStrength",void 0);return a=q=b.__decorate([g.subclass("esri.views.3d.environment.FoggyWeather")],a)})},"esri/views/3d/environment/RainyWeather":function(){define("../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),
function(b,a,c,d,f,n,k,g){var q;a=q=class extends a.JSONSupport{constructor(e){super(e);this.type="rainy";this.precipitation=this.cloudCover=.5}clone(){return new q({cloudCover:this.cloudCover,precipitation:this.precipitation})}};b.__decorate([k.enumeration({rainy:"rainy"})],a.prototype,"type",void 0);b.__decorate([c.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],a.prototype,"cloudCover",void 0);b.__decorate([c.property({type:Number,nonNullable:!0,range:{min:0,max:1},
json:{write:!0}})],a.prototype,"precipitation",void 0);return a=q=b.__decorate([g.subclass("esri.views.3d.environment.RainyWeather")],a)})},"esri/views/3d/environment/SnowyWeather":function(){define("../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),
function(b,a,c,d,f,n,k,g){var q;a=q=class extends a.JSONSupport{constructor(e){super(e);this.type="snowy";this.precipitation=this.cloudCover=.5;this.snowCover="disabled"}clone(){return new q({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};b.__decorate([k.enumeration({snowy:"snowy"})],a.prototype,"type",void 0);b.__decorate([c.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],a.prototype,"cloudCover",void 0);b.__decorate([c.property({type:Number,
nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],a.prototype,"precipitation",void 0);b.__decorate([c.property({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],a.prototype,"snowCover",void 0);return a=q=b.__decorate([g.subclass("esri.views.3d.environment.SnowyWeather")],a)})},"esri/webscene/lightingTypes":function(){define(["exports","./SunLighting","./VirtualLighting"],function(b,a,c){b.lightingTypes={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:a,virtual:c}};Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/webscene/SunLighting":function(){define("../chunks/tslib.es6 ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer".split(" "),function(b,a,c,d,f,n,k,g,q){var e;a=e=class extends a.JSONSupport{constructor(m){super(m);this.type="sun";this.date=null;this.directShadowsEnabled=
!1;this.displayUTCOffset=null}readDate(m,l){return null!=l.datetime&&new Date(l.datetime)||null}writeDate(m,l,w){l[w]=m.getTime()}readDirectShadowsEnabled(m,l){return!!l.directShadows}writedirectShadowsEnabled(m,l,w){m&&(l[w]=m)}writeDisplayUTCOffset(m,l){null!=m&&(l.displayUTCOffset=m)}clone(){return new e(this.cloneConstructProperties())}cloneConstructProperties(){const m={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=this.displayUTCOffset?this.displayUTCOffset:null};null!=
this.date&&(m.date=new Date(this.date.getTime()));return m}};b.__decorate([c.property({readOnly:!0,type:["sun"],json:{write:!0}})],a.prototype,"type",void 0);b.__decorate([c.property({type:Date,json:{type:Number,write:{target:"datetime"}}})],a.prototype,"date",void 0);b.__decorate([k.reader("date",["datetime"])],a.prototype,"readDate",null);b.__decorate([q.writer("date")],a.prototype,"writeDate",null);b.__decorate([c.property({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],a.prototype,
"directShadowsEnabled",void 0);b.__decorate([k.reader("directShadowsEnabled",["directShadows"])],a.prototype,"readDirectShadowsEnabled",null);b.__decorate([q.writer("directShadowsEnabled")],a.prototype,"writedirectShadowsEnabled",null);b.__decorate([c.property({type:Number,json:{write:!0}})],a.prototype,"displayUTCOffset",void 0);b.__decorate([q.writer("displayUTCOffset")],a.prototype,"writeDisplayUTCOffset",null);return a=e=b.__decorate([g.subclass("esri.webscene.SunLighting")],a)})},"esri/webscene/VirtualLighting":function(){define("../chunks/tslib.es6 ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass".split(" "),
function(b,a,c,d,f,n,k){var g;a=g=class extends a.JSONSupport{constructor(q){super(q);this.type="virtual";this.directShadowsEnabled=!1}clone(){return new g(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};b.__decorate([c.property({readOnly:!0,type:["virtual"],json:{write:!0}})],a.prototype,"type",void 0);b.__decorate([c.property({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],a.prototype,"directShadowsEnabled",void 0);
return a=g=b.__decorate([k.subclass("esri.webscene.VirtualLighting")],a)})},"esri/webscene/background/utils":function(){define(["exports","./Background","./ColorBackground"],function(b,a,c){a={base:a,key:"type",typeMap:{color:c}};a={types:a,json:{read:function(d){return(f,n,k)=>{if(!f)return f;for(const g in d.typeMap)if(f.type===g)return n=new d.typeMap[g],n.read(f,k),n}}(a),write:{overridePolicy:(d,f,n)=>({enabled:!n||!n.isPresentation})}}};b.backgroundProperty=a;Object.defineProperty(b,Symbol.toStringTag,
{value:"Module"})})},"esri/webscene/background/Background":function(){define("../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),function(b,a,c,d,f,n,k){a=class extends a.JSONSupport{constructor(g){super(g)}clone(){}};b.__decorate([c.property({readOnly:!0,json:{read:!1}})],a.prototype,"type",void 0);return a=b.__decorate([k.subclass("esri.webscene.background.Background")],
a)})},"esri/webscene/background/ColorBackground":function(){define("../../chunks/tslib.es6 ../../Color ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass ../../symbols/support/materialUtils ./Background".split(" "),function(b,a,c,d,f,n,k,g,q,e){var m;d={...q.colorAndTransparencyProperty,nonNullable:!0};e=m=class extends e{constructor(l){super(l);
this.type="color";this.color=new a([0,0,0,1])}clone(){return new m(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};b.__decorate([k.enumeration({color:"color"},{readOnly:!0})],e.prototype,"type",void 0);b.__decorate([c.property(d)],e.prototype,"color",void 0);return e=m=b.__decorate([g.subclass("esri.webscene.background.ColorBackground")],e)})},"esri/webscene/InitialViewProperties":function(){define("../chunks/tslib.es6 ../Viewpoint ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ../geometry/SpatialReference ./Environment".split(" "),
function(b,a,c,d,f,n,k,g,q,e){var m;c=m=class extends c.JSONSupport{constructor(l){super(l);this.environment=new e;this.viewpoint=this.spatialReference=null}set viewingMode(l){this._set("viewingMode",l)}clone(){return new m({environment:this.environment.clone(),spatialReference:this.spatialReference?this.spatialReference.clone():null,viewingMode:this.viewingMode,viewpoint:this.viewpoint?this.viewpoint.clone():null})}};b.__decorate([d.property({type:e,json:{write:{isRequired:!0}}})],c.prototype,"environment",
void 0);b.__decorate([d.property({type:q})],c.prototype,"spatialReference",void 0);b.__decorate([d.property({type:["local","global"]})],c.prototype,"viewingMode",null);b.__decorate([d.property({type:a,json:{write:{isRequired:!0}}})],c.prototype,"viewpoint",void 0);return c=m=b.__decorate([g.subclass("esri.webscene.InitialViewProperties")],c)})},"esri/webscene/Presentation":function(){define("../chunks/tslib.es6 ../core/Collection ../core/collectionUtils ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/cast ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ./Slide".split(" "),
function(b,a,c,d,f,n,k,g,q,e){const m=a.ofType(e);a=class extends d.JSONSupport{constructor(l){super(l);this.slides=new m}destroy(){this.slides.forEach(l=>l.destroy());this.slides.removeAll()}set slides(l){l&&(l=l.filter(w=>!!w.viewpoint));this._set("slides",c.referenceSetter(l,this._get("slides"),m))}clone(){return new this.constructor({slides:this.slides.clone()})}};b.__decorate([f.property({type:m,nonNullable:!0,json:{write:!0}}),n.cast(c.castForReferenceSetter)],a.prototype,"slides",null);return a=
b.__decorate([q.subclass("esri.webscene.Presentation")],a)})},"esri/webscene/Slide":function(){define("require ../chunks/tslib.es6 ../Basemap ../Viewpoint ../core/asyncUtils ../core/Collection ../core/collectionUtils ../core/JSONSupport ../core/Logger ../core/mathUtils ../core/maybe ../core/promiseUtils ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/cast ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ../core/accessorSupport/ensureType ../chunks/vec3 ../chunks/vec3f64 ../layers/Layer ../support/basemapUtils ../views/support/Scheduler ../webdoc/support/SlideThumbnail ./SunLighting ./VirtualLighting ./support/Description ./support/SlideEnvironment ./support/SlideGround ./support/SlideVisibleLayer ./support/Title".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A,C,E,B,D,F,K,L,G,O){function P(M){if("building-scene"===M.type||"map-image"===M.type)return M.allSublayers.toArray()}function J(M){if(M=P(M))return M.filter(V=>V.visible).map(V=>V.id)}function R(M,V){M=V-M;43200<M&&(M-=86400);-43200>M&&(M+=86400);return M}let X=0;const U=n.ofType(G.SlideVisibleLayer);g=class extends g.JSONSupport{constructor(M){super(M);this.id=Date.now().toString(16)+"-slide-"+X++;this.title=new O;this.description=new F;this.hidden=
!1;this.thumbnail=new E.SlideThumbnail;this.ground=this.basemap=this.viewpoint=null;this.environment=new K.SlideEnvironment;this.visibleLayers=new U}destroy(){this.visibleLayers.removeAll();this.basemap=null;this.thumbnail=m.destroyMaybe(this.thumbnail);this.thumbnail=this.title=this.description=null}castTitle(M){return"string"===typeof M?new O({text:M}):r.ensureType(O,M)}castDescription(M){return"string"===typeof M?new F({text:M}):r.ensureType(F,M)}castThumbnail(M){return"string"===typeof M?new E.SlideThumbnail({url:M}):
r.ensureType(E.SlideThumbnail,M)}castBasemap(M){return A.ensureType(M)}set visibleLayers(M){this._set("visibleLayers",k.referenceSetter(M,this._get("visibleLayers"),U))}castVisibleLayers(M){return M&&"function"===typeof M.map?M.map(V=>{if("string"===typeof V)return{id:V};if(V instanceof z){const Y=J(V);return{id:V.id,sublayerIds:Y}}if(V.id)return{id:V.id,sublayerIds:"sublayerIds"in V?V.sublayerIds:void 0};q.getLogger(this).warn('Invalid visible layer, expected { id }, Layer or "id"');return V}):null}clone(){return new this.constructor({id:this.id,
title:this.title.clone(),thumbnail:this.thumbnail.clone(),description:this.description&&this.description.clone()||null,viewpoint:this.viewpoint&&this.viewpoint.clone()||null,basemap:this.basemap?.clone()||null,ground:this.ground?.clone()||null,visibleLayers:this.visibleLayers.clone(),environment:this.environment&&this.environment.clone()||null,hidden:this.hidden})}async _updateVisibleLayersFrom(M){const V=[];await Promise.allSettled(this._getLayers(M.map).map(Y=>M.whenLayerView(Y).then(W=>{if(W.visible){const H=
J(Y);V.push(new G.SlideVisibleLayer({id:W.layer.id,sublayerIds:H}))}})).toArray());this.visibleLayers.removeAll();this.visibleLayers.addMany(V)}updateFrom(M,V){const Y={format:"png",quality:80,width:120,height:75,disableDecorations:!0,...V?.screenshot};return M.when(()=>{this.viewpoint=M.viewpoint.clone();this.environment.lighting="virtual"===M.environment.lighting.type?D.prototype.clone.apply(M.environment.lighting):B.prototype.clone.apply(M.environment.lighting);this.environment.weather=M.environment.weather.clone();
this.basemap=M.map.basemap&&M.map.basemap.clone()||null;this.ground=M.map.ground?L.fromGround(M.map.ground):null;return this._updateVisibleLayersFrom(M)}).then(()=>M.takeScreenshot(Y)).then(W=>{this.thumbnail=new E.SlideThumbnail({url:W.dataUrl});return this})}async applyTo(M,V){null!=this._applyToController&&this._applyToController.abort();let Y=new AbortController;this._applyToController=Y;const W=l.onAbortOrThrow(V,()=>Y?.abort()),H=M.resourceController.scheduler.registerTask(C.TaskPriority.SLIDE);
let S=!1;const I={animate:!0,...V,signal:this._applyToController.signal};V=await f.result(M.addUpdatingPromise((async()=>{await Promise.all([H.schedule(async()=>S=await this._setViewpointOfInterest(M,I)),H.schedule(()=>this._applyBasemap(M,I),I.signal)]);await this._loadLayersWithSublayerVisibility(M);await Promise.all([H.schedule(()=>this._applyLayerVisibility(M),I.signal),H.schedule(()=>this._applyGround(M),I.signal),H.schedule(()=>this._applyViewpoint(M,I),I.signal)]);await H.schedule(()=>M.environment.weather=
this.environment.weather.clone())})()));S&&(M.contentCamera=null);H.remove();this._applyToController===Y&&(this._applyToController=null);Y=null;W?.remove();if(!1===V.ok)throw V.error;return this}async _applyBasemap(M,V){if(this.basemap){try{await this.basemap.load(V)}catch(Y){if(l.isAbortError(Y))throw Y;}M.map.basemap=A.clonePreservingTiledLayers(this.basemap,M.map.basemap)}}_applyGround(M){this.ground&&(M.map.ground=this.ground.cloneAndApplyTo(M.map.ground))}_getLayers(M){const V=new n;this._collectLayers(M,
V);this._collectLayers(M.ground,V);return V}_collectLayers(M,V){M.layers.forEach(Y=>{Y.persistenceEnabled&&(V.add(Y),"layers"in Y&&this._collectLayers(Y,V))})}async _loadLayersWithSublayerVisibility(M){this.visibleLayers&&await Promise.allSettled(this._getLayers(M.map).items.map(V=>this.visibleLayers.find(Y=>Y.id===V.id)?.sublayerIds?V.load():null))}_applyLayerVisibility(M){this.visibleLayers&&this._getLayers(M.map).forEach(V=>{var Y=this.visibleLayers.find(H=>H.id===V.id);V.visible=null!=Y;const W=
Y?.sublayerIds;Y=P(V);W&&Y&&Y.forEach(H=>H.visible=W.includes(H.id))})}async _setViewpointOfInterest(M,V){if(M.state.fixedContentCamera||!this.viewpoint||V?.ignoreViewpoint||!V?.useDestinationCamera)return!1;({toCameraAsync:V}=await new Promise((Y,W)=>b(["../views/3d/support/viewpointUtils"],Y,W)));V=await V(M,this.viewpoint);M.contentCamera=V;return null!=V}async _applyViewpoint(M,V){this._applyCachedCameraTrackingEnabled(M);if(this.viewpoint&&!V.ignoreViewpoint){null!=this.viewpoint.camera&&(this.viewpoint.camera.fov=
M.camera.fov);const Y=this.environment.lighting;if(V.animate&&"sun"===Y.type&&Y.date)return this._animateToLighting(M,V);V.animate&&(M.environment.applyLighting(Y.clone()),await M.goTo(this.viewpoint,V));M.viewpoint=this.viewpoint}M.environment.applyLighting(this.environment.lighting.clone())}async _animateToLighting(M,V){let Y=null;"virtual"!==M.environment.lighting.type&&"virtual"!==this.environment.lighting.type&&("global"===M.viewingMode&&(Y=this._animateLightingWithCamera(M,M.environment.lighting,
this.environment.lighting)),M.environment.cachedCameraTrackingEnabled=M.environment.lighting.cameraTrackingEnabled,M.environment.lighting.cameraTrackingEnabled=!1);M.environment.lighting.directShadowsEnabled=this.environment.lighting.directShadowsEnabled;"virtual"===this.environment.lighting.type||"virtual"===M.environment.lighting.type?(M.environment.applyLighting(this.environment.lighting.clone()),"virtual"!==M.environment.lighting.type&&(M.environment.cachedCameraTrackingEnabled=M.environment.lighting.cameraTrackingEnabled,
M.environment.lighting.cameraTrackingEnabled=!1)):null!=this.environment.lighting.displayUTCOffset&&(M.environment.lighting.displayUTCOffset=this.environment.lighting.displayUTCOffset);return M.goTo(this.viewpoint,V).then(()=>{this._applyCachedCameraTrackingEnabled(M);M.environment.applyLighting(this.environment.lighting.clone())}).catch(W=>{null==M.animation&&this._applyCachedCameraTrackingEnabled(M);throw W;}).finally(()=>{m.removeMaybe(Y)})}_applyCachedCameraTrackingEnabled(M){null!=M.environment.cachedCameraTrackingEnabled&&
(M.environment.lighting.cameraTrackingEnabled=M.environment.cachedCameraTrackingEnabled,M.environment.cachedCameraTrackingEnabled=null)}_getTime(M){const V=M.getTime();M=3600*M.getUTCHours()+60*M.getUTCMinutes()+M.getUTCSeconds();return[V,M]}_setTime(M,V,Y){M.setTime(V);M.setUTCHours(Y/3600);M.setUTCMinutes(Y%3600/60);M.setUTCSeconds(Y%3600%60);return M}_animateLightingWithCamera(M,V,Y){const [W,H]=this._getTime(new Date(V.date.toString())),[S,I]=this._getTime(Y.date),Q=R(H,I),N=M.renderCoordsHelper,
T=y.create();N.toRenderCoords(M.camera.position,T);const aa=y.create(),Z=y.create();null!=this.viewpoint.camera&&N.toRenderCoords(this.viewpoint.camera.position,aa);const da=new Date;return w.when(()=>M.camera,fa=>{N.toRenderCoords(fa.position,Z);var ka=u.squaredDistance(T,Z);const ha=u.squaredDistance(aa,Z);fa=0;0!==ka+ha&&(fa=ka/(ka+ha));ka=W+(S-W)*fa;fa=e.moduloPositive(H+Q*fa,86400);V.date=this._setTime(da,ka,fa)})}static createFrom(M,V){return(new this).updateFrom(M,V)}};a.__decorate([v.property({type:String,
json:{write:{isRequired:!0}}})],g.prototype,"id",void 0);a.__decorate([v.property({type:O,json:{default:()=>new O({text:""}),write:{isRequired:!0}}})],g.prototype,"title",void 0);a.__decorate([x.cast("title")],g.prototype,"castTitle",null);a.__decorate([v.property({type:F,json:{write:{overridePolicy(M){return{enabled:!(!M||!M.text)}}}}})],g.prototype,"description",void 0);a.__decorate([x.cast("description")],g.prototype,"castDescription",null);a.__decorate([v.property({type:Boolean,nonNullable:!0,
json:{write:!0,default:!1}})],g.prototype,"hidden",void 0);a.__decorate([v.property({type:E.SlideThumbnail,json:{default:()=>new E.SlideThumbnail({url:""}),write:{isRequired:!0}}})],g.prototype,"thumbnail",void 0);a.__decorate([x.cast("thumbnail")],g.prototype,"castThumbnail",null);a.__decorate([v.property({type:d,nonNullable:!0,json:{write:{isRequired:!0}}})],g.prototype,"viewpoint",void 0);a.__decorate([v.property({type:c,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],g.prototype,"basemap",
void 0);a.__decorate([x.cast("basemap")],g.prototype,"castBasemap",null);a.__decorate([v.property({type:L,json:{write:!0}})],g.prototype,"ground",void 0);a.__decorate([v.property({type:U,json:{write:{isRequired:!0}}})],g.prototype,"visibleLayers",null);a.__decorate([x.cast("visibleLayers")],g.prototype,"castVisibleLayers",null);a.__decorate([v.property({type:K.SlideEnvironment,json:{write:!0}})],g.prototype,"environment",void 0);return g=a.__decorate([t.subclass("esri.webscene.Slide")],g)})},"esri/views/support/Scheduler":function(){define("exports ../../core/Handles ../../core/has ../../core/Logger ../../core/maybe ../../core/PerformanceSampler ../../core/PooledArray ../../core/promiseUtils ../../core/reactiveUtils ../../core/signal ../../core/time ../../layers/support/PromiseQueue ./debugFlags ./RenderState".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v){function x(B){return p.has(B)?p.get(B):"number"===typeof B?B:1}b.Task=void 0;(function(B){B[B.YIELD=1]="YIELD"})(b.Task||(b.Task={}));b.TaskPriority=void 0;(function(B){B.RESOURCE_CONTROLLER_IMMEDIATE="immediate";B.RESOURCE_CONTROLLER="schedule";B.SLIDE="slide";B.STREAM_DATA_LOADER="stream loader";B.ELEVATION_QUERY="elevation query";B.TERRAIN_SURFACE="terrain";B.SURFACE_GEOMETRY_UPDATES="surface geometry updates";B.LOD_RENDERER="LoD renderer";B.GRAPHICS_CORE=
"Graphics3D";B.I3S_CONTROLLER="I3S";B.POINT_CLOUD_LAYER="point cloud";B.FEATURE_TILE_FETCHER="feature fetcher";B.OVERLAY="overlay";B.STAGE="stage";B.GRAPHICS_DECONFLICTOR="graphics deconflictor";B.FILTER_VISIBILITY="Graphics3D filter visibility";B.SCALE_VISIBILITY="Graphics3D scale visibility";B.FRUSTUM_VISIBILITY="Graphics3D frustum visibility";B.POINT_OF_INTEREST_FREQUENT="POI frequent";B.POINT_OF_INTEREST_INFREQUENT="POI infrequent";B.LABELER="labeler";B.FEATURE_QUERY_ENGINE="feature query";B.FEATURE_TILE_TREE=
"feature tile tree";B.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree";B.ELEVATION_ALIGNMENT="elevation alignment";B.TEXT_TEXTURE_ATLAS="text texture atlas";B.TEXTURE_UNLOAD="texture unload";B.LINE_OF_SIGHT_TOOL="line of sight tool";B.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool";B.ELEVATION_PROFILE="elevation profile";B.SNAPPING="snapping";B.SHADOW_ACCUMULATOR="shadow accumulator";B.CLOUDS_GENERATOR="clouds generator";B[B.NONE=0]="NONE";B[B.TEST_PRIO=1]="TEST_PRIO"})(b.TaskPriority||
(b.TaskPriority={}));const p=new Map([[b.TaskPriority.RESOURCE_CONTROLLER_IMMEDIATE,0],[b.TaskPriority.RESOURCE_CONTROLLER,4],[b.TaskPriority.SLIDE,0],[b.TaskPriority.STREAM_DATA_LOADER,0],[b.TaskPriority.ELEVATION_QUERY,0],[b.TaskPriority.TERRAIN_SURFACE,1],[b.TaskPriority.SURFACE_GEOMETRY_UPDATES,1],[b.TaskPriority.LOD_RENDERER,2],[b.TaskPriority.GRAPHICS_CORE,2],[b.TaskPriority.I3S_CONTROLLER,2],[b.TaskPriority.POINT_CLOUD_LAYER,2],[b.TaskPriority.FEATURE_TILE_FETCHER,2],[b.TaskPriority.OVERLAY,
4],[b.TaskPriority.STAGE,4],[b.TaskPriority.GRAPHICS_DECONFLICTOR,4],[b.TaskPriority.FILTER_VISIBILITY,4],[b.TaskPriority.SCALE_VISIBILITY,4],[b.TaskPriority.FRUSTUM_VISIBILITY,4],[b.TaskPriority.CLOUDS_GENERATOR,4],[b.TaskPriority.POINT_OF_INTEREST_FREQUENT,6],[b.TaskPriority.POINT_OF_INTEREST_INFREQUENT,30],[b.TaskPriority.LABELER,8],[b.TaskPriority.FEATURE_QUERY_ENGINE,8],[b.TaskPriority.FEATURE_TILE_TREE,16],[b.TaskPriority.FEATURE_TILE_TREE_ACTIVE,0],[b.TaskPriority.ELEVATION_ALIGNMENT,12],[b.TaskPriority.TEXT_TEXTURE_ATLAS,
12],[b.TaskPriority.TEXTURE_UNLOAD,12],[b.TaskPriority.LINE_OF_SIGHT_TOOL,16],[b.TaskPriority.LINE_OF_SIGHT_TOOL_INTERACTIVE,0],[b.TaskPriority.SNAPPING,0],[b.TaskPriority.SHADOW_ACCUMULATOR,30]]),h=m.Milliseconds(6.5),t=m.Milliseconds(1),r=m.Milliseconds(30),u=m.Milliseconds(1E3/30),y=m.Milliseconds(100);var z;(function(B){class D{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some(L=>L.needsUpdate)}constructor(){this._updating=e.signal(!0);this._microTaskQueued=
!1;this._frameNumber=0;this.performanceInfo={total:new n("total"),tasks:new Map};this._frameTaskTimes=new Map;this._budget=new K;this._state=v.RenderState.INTERACTING;this._tasks=new k;this._runQueue=new k;this._load=0;this._idleStateCallbacks=new k;this._debug=this._forceTask=this._idleUpdatesStartFired=!1;this._debugHandle=q.watch(()=>w.SCHEDULER_LOG_SLOW_TASKS,G=>this._debug=G,q.initial);for(const G of Object.keys(b.TaskPriority))this.performanceInfo.tasks.set(b.TaskPriority[G],new n(b.TaskPriority[G]));
const L=this;this._test={FRAME_SAFETY_BUDGET:h,INTERACTING_BUDGET:u,IDLE_BUDGET:y,get availableBudget(){return L._budget.budget},usedBudget:0,getBudget:()=>L._budget,setBudget:G=>L._budget=G,updateTask:G=>this._updateTask(G),getState:G=>this._getState(G),getRuntime:G=>this._getRuntime(G),frameTaskTimes:this._frameTaskTimes,resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}destroy(){this._tasks.toArray().forEach(L=>L.remove());this._tasks.clear();f.removeMaybe(this._debugHandle);
this._microTaskQueued=!1;this._updatingChanged()}taskRunningChanged(L){this._updatingChanged();L&&0<this._budget.remaining&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,0<this._budget.remaining&&this._schedule()&&this.frame())}))}registerTask(L,G){const O=x(L);G=new F(this,L,G,O);this._tasks.push(G);this._updatingChanged();this.performanceInfo.tasks.has(L)||this.performanceInfo.tasks.set(L,new n(L));return G}registerIdleStateCallbacks(L,
G){const O={idleBegin:L,idleEnd:G};this._idleStateCallbacks.push(O);this.state===v.RenderState.IDLE&&this._idleUpdatesStartFired&&O.idleBegin();const P=this;return{remove:()=>this._removeIdleStateCallbacks(O),set idleBegin(J){P._idleUpdatesStartFired&&(O.idleEnd(),P._state===v.RenderState.IDLE&&J());O.idleBegin=J},set idleEnd(J){O.idleEnd=J}}}get load(){return this._load}set state(L){this._state!==L&&(this._state=L,this.state!==v.RenderState.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=
!1,this._idleStateCallbacks.forAll(G=>G.idleEnd())))}get state(){return this._state}updateBudget(L){this._test.usedBudget=0;++this._frameNumber;let G=h,O=L.frameDuration,P=t;switch(this.state){case v.RenderState.IDLE:G=m.Milliseconds(0);O=m.Milliseconds(Math.max(y,L.frameDuration));P=r;break;case v.RenderState.INTERACTING:O=m.Milliseconds(Math.max(u,L.frameDuration))}O=m.Milliseconds(O-L.elapsedFrameTime-G);if(this.state!==v.RenderState.IDLE&&O<t&&!this._forceTask)return this._forceTask=!0,!1;O=m.Milliseconds(Math.max(O,
P));this._budget.reset(O,this.state);this._updateLoad();return this._schedule()}frame(){this._microTaskQueued=this._forceTask=!1;switch(this.state){case v.RenderState.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(L=>L.idleBegin()));this._runIdle();break;case v.RenderState.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}stopFrame(){this._budget.reset(m.Milliseconds(0),this._state);this._budget.madeProgress()}_removeIdleStateCallbacks(L){this._idleUpdatesStartFired&&
L.idleEnd();this._idleStateCallbacks.removeUnordered(L)}removeTask(L){this._tasks.removeUnordered(L);this._runQueue.removeUnordered(L);this._updatingChanged()}_updateTask(L){this._tasks.forAll(G=>{G.name===L&&G.setPriority(L)})}_getState(L){if(this._runQueue.some(O=>O.name===L))return b.TaskState.SCHEDULED;let G=b.TaskState.IDLE;this._tasks.forAll(O=>{O.name===L&&O.needsUpdate&&(1>=O.schedulePriority?G=b.TaskState.READY:G!==b.TaskState.READY&&(G=b.TaskState.WAITING))});return G}_getRuntime(L){let G=
0;this._tasks.forAll(O=>{O.name===L&&(G+=O.runtime)});return G}_resetRuntimes(){this._tasks.forAll(L=>L.runtime=0)}_getRunning(){const L=new Map;this._tasks.forAll(O=>{O.needsUpdate&&L.set(O.name,(L.get(O.name)||0)+1)});if(0===L.size)return null;let G="";L.forEach((O,P)=>{G=1<O?G+` ${O}x ${P}`:G+` ${P}`});return G}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const L=this._tasks.reduce((G,O)=>O.needsUpdate?++G:G,0);this._load=.9*this._load+L*(1-.9)}_schedule(){this._runQueue.filterInPlace(L=>
{if(L.needsUpdate)return!0;L.schedulePriority=L.basePriority;return!1});for(this._tasks.forAll(L=>{0===L.basePriority&&L.needsUpdate&&!this._runQueue.includes(L)&&L.blockFrame!==this._frameNumber&&this._runQueue.unshift(L)});0===this._runQueue.length;){let L=!1;this._tasks.forAll(G=>{if(G.needsUpdate&&0!==G.schedulePriority&&0!==G.basePriority&&G.blockFrame!==this._frameNumber)switch(L=!0,G.schedulePriority){case 1:G.schedulePriority=0;this._runQueue.push(G);break;default:--G.schedulePriority}});
if(!L)return this._updatingChanged(),!1}this._updatingChanged();return!0}_run(){const L=this._budget.now();this._startFrameTaskTimes();do for(;0<this._runQueue.length;){var G=this._budget.now();const O=this._runQueue.pop();this._budget.resetProgress();try{O.task.runTask(this._budget)===b.Task.YIELD&&(O.blockFrame=this._frameNumber)}catch(P){d.getLogger("esri.views.support.Scheduler").error(`Exception in task "${O.name}"`,P),O.blockFrame=this._frameNumber}!this._budget.hasProgressed&&O.blockFrame!==
this._frameNumber&&O.needsUpdate&&(O.blockFrame=this._frameNumber);O.schedulePriority=O.basePriority;G=this._budget.now()-G;O.runtime+=G;this._frameTaskTimes.set(O.priority,this._frameTaskTimes.get(O.priority)+G);this._debug&&G>2*this._budget.budget&&console.log("Task",O.name,"used",G,"of max",this._budget.budget,"ms");if(0>=this._budget.remaining){this._updatingChanged();this._recordFrameTaskTimes(this._budget.now()-L);return}}while(this._schedule());this._updatingChanged();this._recordFrameTaskTimes(this._budget.now()-
L)}_startFrameTaskTimes(){for(const L of Object.keys(b.TaskPriority))this._frameTaskTimes.set(b.TaskPriority[L],0)}_recordFrameTaskTimes(L){this._frameTaskTimes.forEach((G,O)=>this.performanceInfo.tasks.get(O).record(G));this.performanceInfo.total.record(L)}get test(){return this._test}}B.Scheduler=D;class F{get task(){return this._task.value}get updating(){return this._queue.running}constructor(L,G,O,P){this._scheduler=L;this.name=G;this._basePriority=P;this.runtime=this.blockFrame=0;this._queue=
new l.PromiseQueue;this._handles=new a;this.schedulePriority=this._basePriority;this._task=e.signal(null!=O?O:this._queue);this._handles.add(q.when(()=>this.task.running,J=>L.taskRunningChanged(J)))}remove(){this.processQueue(A);this._scheduler.removeTask(this);this.schedule=E.schedule;this.reschedule=E.reschedule;this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(L){this.name=L;L=x(L);if(0===this._basePriority||0!==this.schedulePriority)this.schedulePriority=L;this._basePriority=
L}get priority(){return this.name}set priority(L){this.setPriority(L)}get needsUpdate(){return this.updating||this.task.running}schedule(L,G,O){return this._queue.push(L,G,O)}reschedule(L,G,O){return this._queue.unshift(L,G,O)}processQueue(L){this._queue.runTask(L)}}class K{constructor(){this._begin="undefined"!==typeof performance?performance.now():0;this._budget=0;this._state=v.RenderState.IDLE;this._progressed=this._done=!1;this._enabled=!0}run(L){if(this.done)return!1;!0===L()&&this.madeProgress();
return!0}get done(){return this._done}get budget(){return this._budget}madeProgress(){this._progressed=!0;return this._done=this.elapsed>=this._budget&&this._enabled}get state(){return this._state}get enabled(){return this._enabled}set enabled(L){this._enabled=L}reset(L,G){this._begin=this.now();this._budget=L;this._state=G;this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return performance.now()-this._begin}resetProgress(){this._done=
this._progressed=!1}get hasProgressed(){return this._progressed}}B.Budget=K})(z||(z={}));b.TaskState=void 0;(function(B){B.SCHEDULED="s";B.READY="r";B.WAITING="w";B.IDLE="i"})(b.TaskState||(b.TaskState={}));const A=(()=>{const B=new z.Budget;B.enabled=!1;return B})();class C{remove(){}processQueue(){}schedule(B,D,F){try{if(g.isAborted(D)){const K=g.createAbortError();return F?Promise.resolve(F(K)):Promise.reject(K)}return g.when(B(A))}catch(K){return Promise.reject(K)}}reschedule(B,D,F){return this.schedule(B,
D,F)}}const E=new C;b.ImmediateTask=E;b.getTaskPriority=x;b.newScheduler=function(){return new z.Scheduler};b.noBudget=A;b.taskPriorities=p;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/PromiseQueue":function(){define(["exports","../../core/promiseUtils","../../core/signal"],function(b,a,c){class d{constructor(){this._tasks=[];this._running=c.signal(!1)}get length(){return this._tasks.length}get running(){return this._running.value}destroy(){this.cancelAll()}runTask(n){for(;!n.done&&
this._process(n);)n.madeProgress()}push(n,k,g){this._running.value=!0;return new Promise((q,e)=>this._tasks.push(new f(q,e,n,k,g)))}unshift(n,k,g){this._running.value=!0;return new Promise((q,e)=>this._tasks.unshift(new f(q,e,n,k,g)))}_process(n){if(0===this._tasks.length)return!1;const k=this._tasks.shift();try{const g=a.isAborted(k.signal);if(g&&!k.abortCallback)k.reject(a.createAbortError());else{const q=g?k.abortCallback?.(a.createAbortError()):k.callback(n);a.isPromiseLike(q)?q.then(k.resolve,
k.reject):k.resolve(q)}}catch(g){k.reject(g)}this._running.value=0<this._tasks.length;return!0}cancelAll(){const n=a.createAbortError();for(const k of this._tasks)if(k.abortCallback){const g=k.abortCallback(n);k.resolve(g)}else k.reject(n);this._tasks.length=0;this._running.value=!1}}class f{constructor(n,k,g,q,e){this.resolve=n;this.reject=k;this.callback=g;this.signal=q;this.abortCallback=e}}b.PromiseQueue=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/debugFlags":function(){define("../../chunks/tslib.es6 ../../core/Accessor ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),
function(b,a,c,d,f,n,k){a=class extends a{constructor(){super(...arguments);this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=this.SCHEDULER_LOG_SLOW_TASKS=!1}};b.__decorate([c.property()],a.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0);b.__decorate([c.property()],a.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0);a=b.__decorate([k.subclass("esri.views.support.DebugFlags")],a);return new a})},"esri/views/support/RenderState":function(){define(["exports"],function(b){b.RenderState=
void 0;var a=b.RenderState||(b.RenderState={});a[a.ANIMATING=0]="ANIMATING";a[a.INTERACTING=1]="INTERACTING";a[a.IDLE=2]="IDLE";Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/webdoc/support/SlideThumbnail":function(){define("exports ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),function(b,a,c,d,f,
n,k,g){var q;b.SlideThumbnail=q=class extends c.JSONSupport{constructor(){super(...arguments);this.url=""}destroy(){this.url=""}clone(){return new q({url:this.url})}};a.__decorate([d.property({type:String,json:{write:{isRequired:!0}}})],b.SlideThumbnail.prototype,"url",void 0);b.SlideThumbnail=q=a.__decorate([g.subclass("esri.webdoc.support.SlideThumbnail")],b.SlideThumbnail);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/webscene/support/Description":function(){define("../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),
function(b,a,c,d,f,n,k){var g;a=g=class extends a.JSONSupport{constructor(){super(...arguments);this.text=""}clone(){return new g({text:this.text})}};b.__decorate([c.property({type:String,json:{write:!0}})],a.prototype,"text",void 0);return a=g=b.__decorate([k.subclass("esri.webscene.support.Description")],a)})},"esri/webscene/support/SlideEnvironment":function(){define("exports ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../views/3d/environment/SunnyWeather ../../views/3d/environment/weather ../lightingTypes ../SunLighting".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m){var l;b.SlideEnvironment=l=class extends c.JSONSupport{constructor(){super(...arguments);this.lighting=new m;this.weather=new g}clone(){return new l({lighting:d.clone(this.lighting),weather:d.clone(this.weather)})}};a.__decorate([f.property({types:e.lightingTypes,json:{write:!0}})],b.SlideEnvironment.prototype,"lighting",void 0);a.__decorate([f.property({types:q.weatherTypes,json:{write:!0}})],b.SlideEnvironment.prototype,"weather",void 0);b.SlideEnvironment=l=a.__decorate([k.subclass("esri.webscene.Environment")],
b.SlideEnvironment);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/webscene/support/SlideGround":function(){define("../../chunks/tslib.es6 ../../Ground ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../webdoc/support/opacityUtils".split(" "),function(b,a,c,d,f,n,k,g,q){var e;c=e=class extends c.JSONSupport{constructor(){super(...arguments);
this.opacity=null}clone(){return new e({opacity:this.opacity})}cloneAndApplyTo(m){if(null==this.opacity)return m;m=m?.clone()??new a;m.opacity=this.opacity;return m}static fromGround(m){return new e({opacity:m.opacity})}};b.__decorate([d.property({type:Number,json:{type:f.Integer,read:{reader:q.transparencyToOpacity,source:"transparency"},write:{writer:(m,l)=>{l.transparency=q.opacityToTransparency(m)},target:"transparency"}}})],c.prototype,"opacity",void 0);return c=e=b.__decorate([g.subclass("esri.webscene.support.SlideGround")],
c)})},"esri/webscene/support/SlideVisibleLayer":function(){define("exports ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),function(b,a,c,d,f,n,k){var g;b.SlideVisibleLayer=g=class extends c.JSONSupport{constructor(q){super(q);this.id="";this.sublayerIds=null}clone(){return new g({id:this.id,sublayerIds:d.clone(this.sublayerIds)})}};a.__decorate([f.property({type:String,
json:{write:!0}})],b.SlideVisibleLayer.prototype,"id",void 0);a.__decorate([f.property({type:[n.Integer],json:{read:{source:"subLayerIds"},write:{target:"subLayerIds"}}})],b.SlideVisibleLayer.prototype,"sublayerIds",void 0);b.SlideVisibleLayer=g=a.__decorate([k.subclass("esri.webscene.support.SlideVisibleLayer")],b.SlideVisibleLayer);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/webscene/support/Title":function(){define("../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),
function(b,a,c,d,f,n,k){var g;a=g=class extends a.JSONSupport{constructor(){super(...arguments);this.text=""}clone(){return new g({text:this.text})}};b.__decorate([c.property({type:String,json:{write:{isRequired:!0}}})],a.prototype,"text",void 0);return a=g=b.__decorate([k.subclass("esri.webscene.support.Title")],a)})},"esri/webscene/TransportationNetwork":function(){define("../chunks/tslib.es6 ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass".split(" "),
function(b,a,c,d,f,n,k){var g;a=g=class extends a.JSONSupport{constructor(q){super(q)}clone(){return new g({name:this.name,path:this.path,title:this.title})}};b.__decorate([c.property({type:String,json:{write:!0}})],a.prototype,"name",void 0);b.__decorate([c.property({type:String,json:{write:!0}})],a.prototype,"path",void 0);b.__decorate([c.property({type:String,json:{write:!0}})],a.prototype,"title",void 0);return a=g=b.__decorate([k.subclass("esri.webscene.TransportationNetwork")],a)})},"esri/webscene/Version":function(){define(["exports",
"../core/Version"],function(b,a){class c extends a.Version{constructor(d,f){super(d,f,"webscene")}get supportsGround(){return this.since(1,8)}get supportsVisibleElevationLayersInSlides(){return this.lessThan(1,8)}}b.Version=c;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/webscene/support/schemaValidatorLoader":function(){define(["exports"],function(b){let a=null;b.getLoader=function(){return a};b.registerLoader=function(c){a=c};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/views/SceneView":function(){define("require ../chunks/tslib.es6 ../Camera ../geometry ../Graphic ../Viewpoint ../core/Collection ../core/domUtils ../core/Error ../core/events ../core/handleUtils ../core/has ../core/iteratorUtils ../core/Logger ../core/maybe ../core/ObservableChangesType ../core/promiseUtils ../core/reactiveUtils ../core/scheduling ../core/screenUtils ../core/workers/workers ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/cast ../core/arrayUtils ../core/accessorSupport/decorators/subclass ../core/accessorSupport/ensureType ../chunks/vec3f64 ../core/support/OwningCollection ../geometry/HeightModelInfo ../geometry/projection ../geometry/projection/projectBoundingRect ../geometry/projection/projectPointToVector ../geometry/projection/projectVectorToVector ../geometry/support/aaBoundingRect ../chunks/boundedPlane ../geometry/support/coordinateSystem ../geometry/support/scaleUtils ../layers/LayerConstants ../layers/support/layerUtils ../support/AnalysesCollection ./BreakpointsOwner ./DOMContainer ./GroundView ./PopupView ./View ./ViewAnimation ./ViewingMode ./3d/layerViewModuleImportUtils ./3d/analysis/AnalysisViewManager3D ./3d/constraints/Constraints ./3d/environment/SceneViewEnvironment ./3d/environment/SceneViewEnvironmentManager ./3d/input/SceneInputManager ./3d/layers/graphics/GraphicsDeconflictor ./3d/layers/graphics/Labeler ./3d/layers/support/FeatureTileTree3D ./3d/state/ViewState ./3d/state/ViewStateManager ./3d/state/helpers/SceneIntersectionHelper ./3d/support/CombinedElevationProvider ./3d/support/debugFlags ./3d/support/DisplayQualityProfile ./3d/support/ElevationProvider ./3d/support/HighlightOptions ./3d/support/MapCoordsHelper ./3d/support/PropertiesPool ./3d/support/QualitySettings ./3d/support/RenderCoordsHelper ./3d/support/ResourceController ./3d/support/SceneViewPerformanceInfo ./3d/support/SharedSymbolResources ./3d/support/TextureCollection ./3d/support/pointsOfInterest/PointsOfInterest ./3d/terrain/TerrainSurface ./3d/terrain/terrainUtils ./3d/webgl-engine/Stage ./3d/webgl-engine/lib/basicInterfaces ./3d/webgl-engine/lib/Intersector ./3d/webgl-engine/lib/IntersectorInterfaces ./3d/webgl-engine/lib/intersectorUtils ./3d/webgl-engine/lib/intersectorUtilsConversions ./3d/webgl-engine/lib/verticalOffsetUtils ./support/hitTestSelectUtils ./support/layerViewUtils ./support/screenshotUtils ./support/screenUtils ./support/spatialReferenceSupport ./support/WebGLRequirements ./ui/DefaultUI ./ui/3d/DefaultUI3D ../webscene/Environment ../geometry/Extent ../geometry/SpatialReference ../geometry/Point".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A,C,E,B,D,F,K,L,G,O,P,J,R,X,U,M,V,Y,W,H,S,I,Q,N,T,aa,Z,da,fa,ka,ha,ba,ea,ca,ia,la,oa,na,ra,ta,ma,pa,ja,qa,ua,wa,za,Aa,Fa,Da,Ha,Ka,La,Na,Ra,Sa,sa,va,ya,Ea,Ca,Ga,Ja,Ma,Ta,Va,Wa,hb,Ya,cb,Xa,fb){function Za(xa,Ba){xa.layerUids||(xa.layerUids=new Set);xa.layerUids.add(Ba)}function bb(xa,Ba){return null!=xa&&L.canProjectWithoutEngine(xa.spatialReference,Ba)?L.project(xa,Ba):null}let Oa=class extends W.BreakpointsOwner(I.PopupView(H.DOMContainer(Q))){constructor(xa){super(xa);
this._initialDefaultSpatialReference=this._clippingArea=this._userClippingArea=null;this._defaults={};this._externallySet={environment:!1};this._createGraphicsViewController=null;this._resolveWhenReady=[];this._propertiesPool=new qa.PropertiesPool({slicePlane:R.BoundedPlaneClass},this);this._resourceController=za.newResourceController(this);this._defaultToMapOptions={include:new Set};this._defaultHitTestOptions={exclude:new Set};this.deconflictor=new ba.GraphicsDeconflictor({view:this});this.labeler=
new ea.Labeler({view:this,deconflictor:this.deconflictor.labels});this.sharedSymbolResources=null;this.analyses=new Y.AnalysesCollection;this.canvas=this.elevationProvider=this.basemapTerrain=null;this.constraints=new da.Constraints;this.environmentManager=new ka.SceneViewEnvironmentManager;this.floors=new k;this.fullOpacity=1;this.graphicsView=null;this.analysisViewManager=new Z({view:this});this.map=this.groundView=null;this.screenSizePerspectiveEnabled=!0;this.state=new ia;this.spatialReference=
null;this.preserveDrawingBufferEnabled=this.alphaCompositingEnabled=!1;this.supersampleScreenshotsEnabled=!0;this.type="3d";this.ui=new hb;this._lastUpdateTime=this._numUpdating=0;this.updatingProgress=.5;this.highlightOptions=new pa;y.initialize();xa?.environment||(this._defaults.environment=new fa,this.environment=this._defaults.environment);const Ba=(Ia=null)=>{if(null==Ia||Ia.type!==p.ObservableChangesType.MOVE)this._updatingChanged(),this.map&&this.map.allLayers.forEach(async Qa=>{try{await Qa.when()}catch{}this._updatingChanged()})};
this.addHandles([t.on(()=>this.map?.allLayers,"after-changes",Ia=>Ba(Ia),{onListenerAdd:()=>Ba(),onListenerRemove:()=>Ba(),sync:!0}),this.allLayerViews.on("after-changes",Ia=>this._updateUpdatingMonitors(Ia)),t.watch(()=>this.map,Ia=>{Ia&&"load"in Ia&&Ia.load&&Ia.load().catch(()=>{})})]);this.inputManager=new ha({view:this});this.stateManager=new la.ViewStateManager({view:this})}initialize(){this.groundView=new S({view:this});this._updateUpdatingMonitors();const xa=()=>this._updateDefaultToMapOptions();
this.addHandles(t.on(()=>this.map?.allLayers,"after-changes",xa,{onListenerAdd:xa,onListenerRemove:xa}));this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,Ba=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=Ba)},t.initial);this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,Ba=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=Ba)},t.initial);this.updatingHandles.add(()=>this.qualitySettings.frameRate??
0,Ba=>r.setFrameDuration(0<Ba?1E3/Math.ceil(Ba):0),t.initial);this.updatingHandles.add(()=>this.map?.ground,xa,t.syncAndInitial);this.updatingHandles.add(()=>this.map?.ground?.opacity,()=>this._updateDefaultHitTestOptions(),t.syncAndInitial);this.addHandles(t.watch(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),t.sync))}destroy(){this.destroyed||(this.updatingHandles.removeAll(),this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),
this.sharedSymbolResources=x.destroyMaybe(this.sharedSymbolResources),this._set("labeler",x.destroyMaybe(this.labeler)),this._set("deconflictor",x.destroyMaybe(this.deconflictor)),this._resourceController=x.destroyMaybe(this._resourceController),this._set("stateManager",x.destroyMaybe(this.stateManager)),this._set("inputManager",x.destroyMaybe(this.inputManager)),this.state.destroy(),this._propertiesPool.destroy(),this.removeHandles("updatingMonitors"),this._set("environmentManager",x.destroyMaybe(this.environmentManager)),
this._set("environment",x.destroyMaybe(this.environment)),this.groundView=x.destroyMaybe(this.groundView),this._exitBasemapTerrain(),this._stage?.destroy())}get renderSpatialReference(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){return this.basemapTerrain?.spatialReference}get animation(){return this.state?.animation}get camera(){return this.stateManager?.camera}set camera(xa){this.stateManager&&(this.stateManager.camera=xa)}get contentCamera(){return this.stateManager?.contentCamera}set contentCamera(xa){this.stateManager&&
(this.stateManager.contentCamera=xa)}installContentCameraReset(xa={sticky:!1}){return this.stateManager.installContentCameraReset(xa)}get center(){return this.stateManager?.center}set center(xa){this.stateManager&&(this.stateManager.center=xa)}get clippingArea(){if("global"===this.viewingMode)return null;const xa=this.map;let Ba=this._userClippingArea||x.maybeProperty(xa,"clippingArea");if(!this._userClippingArea&&!x.maybeProperty(xa,"clippingEnabled")||null==Ba)return this._clippingArea=null;if(!(Ba instanceof
cb))return v.getLogger(this).error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea;if(this.spatialReference&&(Ba=bb(Ba,this.spatialReference),null==Ba))return v.getLogger(this).error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea;Ba=Ba.clone();null==Ba.intersection(this._groundAndLayersExtent)&&(Ba.xmin=Ba.xmax,Ba.ymin=Ba.ymax);Ba.zmin=void 0;Ba.zmax=void 0;Ba.equals(this._clippingArea)||(this._clippingArea=
Ba);return this._clippingArea}set clippingArea(xa){this.ready&&"global"===this.viewingMode&&null!=xa?v.getLogger(this).error("#clippingArea\x3d","Clipping area is only supported in local viewingMode"):this._userClippingArea=xa}get renderDataExtent(){if(this.state.viewingMode===T.ViewingMode.Global)return null;const xa=this.renderSpatialReference,Ba=this.dataExtent;return null==Ba||null==xa||Ba.spatialReference.equals(xa)?Ba:bb(Ba,xa)}get dataExtent(){let xa=this._groundAndLayersExtent;var Ba=bb(this.clippingArea,
this.spatialReference||Xa.WGS84);null!=Ba&&(xa=null!=xa?xa.intersection(Ba):Ba);Ba=this._get("dataExtent");return null!=xa&&xa.equals(Ba)?Ba:xa}get _groundAndLayersExtent(){const xa=this.spatialReference||Xa.WGS84;let Ba;const Ia=Pa=>{Pa=bb(Pa,xa);null!=Pa&&(null!=Ba?Ba.union(Pa):Ba=Pa.clone())};var Qa=this.basemapTerrain;if(Qa?.spatialReference){const Pa=Qa.groundExtent;Ia(new cb({xmin:Pa[0],ymin:Pa[1],zmin:0,xmax:Pa[2],ymax:Pa[3],zmax:0,spatialReference:Qa.spatialReference}))}this.map&&this.map.allLayers.forEach(Pa=>
{null==Pa.fullExtent||"graphics"===Pa.type&&Pa.internal||Ia(Pa.fullExtent)});if(null==Ba)return null;Ba.hasZ?(Ba.zmin=Math.min(0,Ba.zmin??0),Ba.zmax=Math.max(0,Ba.zmax??0)):(Ba.zmin=0,Ba.zmax=0);Qa=this._get("_groundAndLayersExtent");return Ba.equals(Qa)?Qa:Ba}set environment(xa){xa!==this._defaults.environment&&(this._externallySet.environment=!0);this._set("environment",xa)}castEnvironment(xa){return xa?xa instanceof fa?xa:xa instanceof Ya?null!=this.environment?this.environment.cloneWithWebsceneEnvironment(xa):
fa.fromWebsceneEnvironment(xa):B.ensureType(fa,xa):new fa}get extent(){return this.stateManager?.extent}set extent(xa){this.stateManager&&(this.stateManager.extent=xa)}get screenCenter(){return this.stateManager?.screenCenter}get frustum(){return this.stateManager?.frustum}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get _defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){return this.navigating||(this.toolViewManager?.interacting??
!1)}get stationary(){return!this.animation&&!this.resizing&&(null==this.state||this.state.stationary)}get navigating(){return this.state?.navigating??!1}get padding(){return this.stateManager?.padding}set padding(xa){this.stateManager&&(this.stateManager.padding=xa)}set qualityProfile(xa){ta.isValidProfile(xa)&&(ta.apply(xa,this.qualitySettings),this._set("qualityProfile",xa))}get qualityProfile(){return this._get("qualityProfile")||ta.getDefaultProfile()}set slicePlane(xa){null!=this._stage&&this._stage.renderer.setParameters({slicePlane:xa});
if(null==xa)this._set("slicePlane",null);else{var Ba=this._propertiesPool.get("slicePlane");R.copy(xa,Ba);this._set("slicePlane",Ba)}}get typeSpecificPreconditionsReady(){return!!this.viewingMode}get resolution(){return null!=this.spatialReference?U.getResolutionForScale(this.scale,this.spatialReference):0}get scale(){return this.stateManager?.scale}set scale(xa){this.stateManager&&(this.stateManager.scale=xa)}get heightModelInfo(){const xa=this.getDefaultHeightModelInfo();return null!=xa?K.deriveUnitFromSR(xa,
this.spatialReference):null}get updating(){if(this.destroyed)return!1;let xa=0,Ba=this.layerViewManager.updating,Ia=Ba?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(Ua=>{Ua.isFulfilled()?Ua.updating&&(Ba=!0,Ua.suspended||La.isSurfaceLayerView(Ua)||(++Ia,xa+=Ua.updatingProgress)):++Ia});for(var Qa of this._updatingObjects)null!=Qa&&Qa.updating&&(Ia+=.1,xa+=.05);for(var Pa of this._updatingObjectsWithProgress)null!=Pa&&Pa.updating&&(++Ia,xa+=Pa.updatingProgress);Qa=!this.stateManager.test.updatingIgnoreRenderState&&
this.state.updating;(Ba=!!(Ba||0<Ia||this.updatingHandles.updating||!this.ready||!this.stationary||Qa||this._createGraphicsViewController||this.inputManager?.updating||this.map?.allLayers?.some(Ua=>!Ua.isFulfilled())||this.textures?.updating))?(this._numUpdating=Math.max(Ia,this._numUpdating),xa+=this._numUpdating-Ia):this._numUpdating=0;xa=0<this._numUpdating?xa/this._numUpdating:Ba?0:1;this._get("updatingProgress")!==xa&&(Qa=performance.now(),1>xa&&(Pa=Math.min((Qa-this._lastUpdateTime)/2E3,1),
xa=this.updatingProgress*(1-Pa)+xa*Pa),this._set("updatingProgress",xa),this._lastUpdateTime=Ba&&1>xa?Qa:0);return Ba}get _updatingObjects(){return[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this._featureTreeDebugger,this.toolViewManager,this.analysisViewManager]}get _updatingObjectsWithProgress(){return[this.deconflictor,this.labeler,this.basemapTerrain]}get viewingMode(){var xa=this._predeterminedViewingMode;
return null!=xa?T.stringFromViewingMode(xa):(xa=this.spatialReference)?null!=this.defaultsFromMap?.viewingMode&&xa.equals(this.defaultsFromMap.spatialReference)?T.stringFromViewingMode(this.defaultsFromMap.viewingMode):Ta.isSpatialReferenceSupported(xa,T.ViewingMode.Global)?"global":"local":"global"}set viewingMode(xa){this.ready?v.getLogger(this).error("#viewingMode","viewingMode cannot be set once view is ready"):this._overrideIfSome("viewingMode",xa)}get viewpoint(){return this.stateManager?.viewpoint}set viewpoint(xa){this.stateManager&&
(this.stateManager.viewpoint=xa)}get zoom(){return this.stateManager.zoom}set zoom(xa){this.stateManager&&(this.stateManager.zoom=xa)}get resourceController(){return this._resourceController}get quality(){return this._resourceController?.memoryController?.memoryFactor??1}get resolutionScale(){return Math.sqrt(Math.min(1,this.quality/.75))}get performanceInfo(){return new Aa(this)}on(xa,Ba,Ia,Qa){return(Ia=this.viewEvents.on(xa,Ba,Ia,Qa))?Ia:super.on(xa,Ba)}hasEventListener(xa){return super.hasEventListener(xa)||
this.viewEvents.hasHandler(xa)}toMap(xa,Ba){if(!this.ready)return v.getLogger(this).error("#toMap()","Scene view cannot be used before it is ready"),null;Ba=Ba?this.externalToInternalIntersectOptions(Ba):this._defaultToMapOptions;var Ia=null!=Ba.graphics&&(null!=Ba.graphics.include||null!=Ba.graphics.exclude);xa=Ma.isSupportedScreenPointEvent(xa)?Ma.createScreenPointFromSupportedEvent(this,xa):xa;xa=u.screenPointObjectToArray(xa);Ba.enableDraped=Ba.include&&!Ba.include.has(Ea.terrainId)||Ba.exclude&&
Ba.exclude.has(Ea.terrainId);const Qa=this.sceneIntersectionHelper,Pa=Sa.newIntersector(this.state.viewingMode);Pa.options.selectionMode=!0;Pa.options.store=Ia?sa.StoreResults.ALL:sa.StoreResults.MIN;Qa.intersectIntersectorScreen(xa,Pa,Ba);if(Ia){for(const Ua of Pa.results.all)if(Ia=ya.toHit(Ua,this),null==Ia||"graphic"!==Ia.type||this._testGraphicUidFilter(Ba.graphics,Ia.graphic))return this._intersectResultToMapPoint(Ua);return null}return this._intersectResultToMapPoint(Pa.results.min)}toScreen(xa){if(!this.ready)return v.getLogger(this).error("#toScreen()",
"Scene view cannot be used before it is ready"),null;const Ba=(null==xa.z?ma.getElevationAtPoint(this.elevationProvider,xa):null)??0;O.projectPointToVector(xa,db,this.renderSpatialReference,Ba);this.state.camera.projectToScreen(db,kb);return u.createScreenPoint(kb[0],kb[1])}pixelSizeAt(xa){if(!this.ready)return v.getLogger(this).error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null;if(!xa)return 0;O.projectPointToVector(xa,db,this.renderSpatialReference);return this.state.camera.computeScreenPixelSizeAt(db)}overlayPixelSizeInMapUnits(xa){const Ba=
this.basemapTerrain.overlayManager;return Ba?Ba.overlayPixelSizeInMapUnits(xa,()=>this.pixelSizeAt(xa)):1}hitTest(xa,Ba){if(!this.ready)return v.getLogger(this).error("#hitTest()","Scene view cannot be used before it is ready"),null;xa=Ma.isSupportedScreenPointEvent(xa)?Ma.createScreenPointFromSupportedEvent(this,xa):xa;var Ia=u.createScreenPointArray(xa.x,xa.y),Qa=Ba?this.externalToInternalIntersectOptions(Ba):this._defaultHitTestOptions;Qa.requiresGroundFeedback=!0;Qa.enableDraped=!0;Ba=Sa.newIntersector(this.state.viewingMode);
Ba.options.selectionMode=!0;Ba.options.store=sa.StoreResults.ALL;this.sceneIntersectionHelper.intersectIntersectorScreen(Ia,Ba,Qa);Ia=this._intersectResultsToHits(Ba.results.all,Qa.graphics);Qa=Ba.results.ground;var Pa=ya.toOwner(Qa,this);Pa=null!=Pa&&"type"in Pa&&"integrated-mesh"===Pa.type?Pa:null;xa={screenPoint:xa,results:Ia,ground:{mapPoint:this._intersectResultToMapPoint(Qa),distance:va.isValidIntersectorResult(Qa)?Qa.distanceInRenderSpace:0,layer:Pa}};ra.debugFlags.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&
(xa.intersector=Ba);return Promise.resolve(xa)}async popupHitTest(xa){const {results:Ba,ground:Ia}=await Ca.hitTestSelectSimilarDistance(this,xa);let Qa=null;!(0===Ba.length||1E-5>Math.abs((Ba[0].distance??0)-Ia.distance))||Ia.layer&&"integrated-mesh"===Ia.layer.type||(Qa=Ia.mapPoint);return{results:Ba,screenPoint:xa,mapPoint:Qa}}goTo(xa,Ba){return this.updatingHandles.addPromise(this.stateManager.goTo(xa,Ba))}async whenAnalysisView(xa){if(null==xa.parent)throw new q("view:no-analysisview-for-analysis",
"The analysis has not been added to view.analyses",{analysis:xa});switch(xa.parent.type){case "line-of-sight":case "dimension":return(await this.whenLayerView(xa.parent)).whenAnalysisView();default:return this.analysisViewManager.whenAnalysisView(xa)}}whenLayerView(xa){return super.whenLayerView(xa)}async takeScreenshot(xa){xa=this._completeSettings(xa);await this.whenReady();const Ba=await this._stage.renderView.takeScreenshot(xa);return Ja.encode(Ba,xa,this._pixelFormat())}async _takeScreenshot(xa){xa=
this._completeSettings(xa);await this.whenReady();xa=await this._stage.renderView.takeScreenshot(xa);return Ja.encodeData(xa,this._pixelFormat())}async _takeScreenshotWithObjectAndLayerId(xa){xa=this._completeSettings(xa);await this.whenReady();xa=await this._stage.renderView.takeScreenshotWithOID(xa);return[Ja.encodeData(xa[0],this._pixelFormat()),Ja.encodeData(xa[1],this._pixelFormat())]}_completeSettings(xa){xa=Ja.toRenderSettings(xa,this);xa.pixelRatio/=this.state.pixelRatio;return Ja.screenshotSuperSampleSettings(xa,
this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){return{takeScreenshot:xa=>this._takeScreenshot(xa),takeScreenshotWithObjectAndLayerId:xa=>this._takeScreenshotWithObjectAndLayerId(xa)}}async takeScreenshotWithObjectAndLayerId(xa){if(!l("enable-feature:objectAndLayerId-rendering"))throw Error("has enable-feature:objectAndLayerId-rendering must be true");var Ba=this._completeSettings(xa);await this.whenReady();
var Ia=await this._stage.renderView.takeScreenshotWithOID(Ba);Ba=Ja.encode(Ia[0],Ba,this._pixelFormat());xa=this._completeSettings(xa);xa.format="png";Ia=Ja.encode(Ia[1],xa,this._pixelFormat());return[Ba,Ia]}getColorToObjectAndLayerIdMapping(){if(null==this._stage.renderView.objectAndLayerIdRenderHelper)throw Error("has enable-feature:objectAndLayerId-rendering must be true");return this._stage.renderView.objectAndLayerIdRenderHelper.getColorToObjectAndLayerIdMapping()}addUpdatingPromise(xa){return this.updatingHandles.addPromise(xa)}importLayerView(xa){return aa.layerView3DImporter.importLayerView(xa)}hasLayerViewModule(xa){return aa.layerView3DImporter.hasLayerViewModule(xa)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){return this.map&&
"initialViewProperties"in this.map&&this.map.initialViewProperties?.spatialReference||this.defaultsFromMap?.spatialReference||this.defaultsFromMap?.ready&&this._initialDefaultSpatialReference||null}async validate(){let xa=Va.check(this.type);const Ba=l("safari");Ba&&9>Ba&&(xa=new q("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari \x3c 9)",{type:"safari",requiredVersion:9,detectedVersion:Ba}));if(null!=xa)throw v.getLogger(this).warn("#validate()",xa.message),xa;
}get _predeterminedViewingMode(){const xa=this._isOverridden("viewingMode")?this._get("viewingMode"):(this.map&&"initialViewProperties"in this.map?this.map.initialViewProperties?.viewingMode:null)??null;return null!=xa?T.viewingModeFromString(xa):null}getSpatialReferenceSupport({spatialReference:xa,layer:Ba}){var Ia=this._predeterminedViewingMode;if(null!=Ia)return this._validateSpatialReferenceForViewingMode(xa,Ba,Ia)?{constraints:this._makeSpatialReferenceConstraints(xa,Ba,Ia)}:null;Ia=this._validateSpatialReferenceForViewingMode(xa,
Ba,T.ViewingMode.Local);const Qa=this._validateSpatialReferenceForViewingMode(xa,Ba,T.ViewingMode.Global);return Ia||Qa?Ia&&Qa?{constraints:this._makeSpatialReferenceConstraints(xa,Ba,null)}:Ia?{constraints:this._makeSpatialReferenceConstraints(xa,Ba,T.ViewingMode.Local)}:{constraints:this._makeSpatialReferenceConstraints(xa,Ba,T.ViewingMode.Global)}:null}_validateSpatialReferenceForViewingMode(xa,Ba,Ia){return Ta.isSpatialReferenceSupported(xa,Ia)?null==Ba||V.isImageryTileLayer(Ba)?!0:V.isTiledLayer(Ba)&&
null==La.getTiledLayerInfo(Ba,xa,Ia)||V.isVoxelLayer(Ba)&&Ia===T.ViewingMode.Global?!1:!0:!1}_makeSpatialReferenceConstraints(xa,Ba,Ia){if(null==Ba)return[{spatialReference:xa,viewingMode:Ia}];const Qa=xa.isWebMercator,Pa=xa.isWGS84;return V.isImageryTileLayer(Ba)&&(Qa||Pa)?(Pa&&Ia!==T.ViewingMode.Local?null===La.checkIfTileInfoSupportedForView(Ba.tileInfo,Ba.fullExtent,xa,T.ViewingMode.Global):1)?[{spatialReference:xa,viewingMode:Ia},{spatialReference:Xa.WebMercator,viewingMode:Ia}]:[{spatialReference:Qa?
Xa.WGS84:Xa.WebMercator,viewingMode:Ia}]:V.isTiledLayer(Ba)||V.isVoxelLayer(Ba)||!Qa&&!Pa?V.isTiledLayer(Ba)&&Qa&&Ia!==T.ViewingMode.Global?[{spatialReference:xa,viewingMode:Ia},{spatialReference:Xa.WGS84,viewingMode:T.ViewingMode.Local}]:[{spatialReference:xa,viewingMode:Ia}]:[{spatialReference:xa,viewingMode:Ia},{spatialReference:Qa?Xa.WGS84:Xa.WebMercator,viewingMode:Ia}]}_validateSpatialReference(xa){const Ba=null!=this.getSpatialReferenceSupport({spatialReference:xa}),Ia=this._predeterminedViewingMode;
Ba||(null!=Ia?v.getLogger(this).warnOnce(`Spatial reference defined on view not supported in ${T.stringFromViewingMode(Ia)} viewing mode.`):xa.isGeographic&&v.getLogger(this).warnOnce("Spatial reference is geographic but not supported."));return Ba}whenReady(){return new Promise(xa=>{this.ready?xa(this):this._resolveWhenReady.push(xa)})}computeMapPointFromVec3d(xa,Ba){let Ia=this.spatialReference||Xa.WGS84;P.projectVectorToVector(xa,this.renderSpatialReference,xa,Ia)||(Ia=Xa.WGS84,P.projectVectorToVector(xa,
this.renderSpatialReference,xa,Ia));Ba?(Ba.x=xa[0],Ba.y=xa[1],Ba.z=xa[2],Ba.spatialReference=Ia):Ba=new fb(xa,Ia);return Ba}trackGraphicState(xa){if(!xa.graphic)return v.getLogger(this).error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const Ba=this.getViewForGraphic(xa.graphic);let Ia=null,Qa=!1;const Pa=Ua=>{!Qa&&null!=Ua&&"processor"in Ua&&"graphics-3d"===Ua.processor?.type&&Ua.processor.graphicsCore&&(Ia=Ua.processor.graphicsCore.trackGraphicState(xa))};
null!=Ba?Pa(Ba):this.whenViewForGraphic(xa.graphic,{waitForLayer:!0}).then(Ua=>Pa(Ua),()=>{}).catch(()=>{});return m.makeHandle(()=>{Qa=!0;null!=Ia&&(Ia.remove(),Ia=null)})}highlight(xa){if(Array.isArray(xa))return m.handlesGroup(xa.map(Ia=>this.highlight(Ia)));if(k.isCollection(xa))return m.handlesGroup(xa.toArray().map(Ia=>this.highlight(Ia)));const Ba=this.getViewForGraphic(xa);return Ba&&"highlight"in Ba?Ba.highlight(xa):m.makeHandle()}maskOccludee(xa){if(!xa)return v.getLogger(this).error("maskOccludee",
"GraphicState.graphic must not be null or undefined to mask an occludee"),null;const Ba=this.getViewForGraphic(xa);let Ia=null,Qa=!1;const Pa=Ua=>{!Qa&&null!=Ua&&Ga.occludeesSupported(Ua)&&(Ia=Ua.maskOccludee(xa))};null!=Ba?Pa(Ba):this.whenViewForGraphic(xa,{waitForLayer:!0}).then(Ua=>Pa(Ua),()=>{}).catch(()=>{});return m.makeHandle(()=>{Qa=!0;null!=Ia&&(Ia.remove(),Ia=null)})}getViewForGraphic(xa){return xa.layer===this.graphics?this.graphicsView:xa.layer?this.allLayerViews.find(Ba=>Ba.layer===xa.layer):
null}graphicChanged(xa){null!=this.graphicsView&&this.graphicsView.graphicChanged(xa)}async whenViewForGraphic(xa,Ba){if(xa.layer===this)return await t.whenOnce(()=>this.graphicsView),this.graphicsView;if(!xa.layer||!this.map)throw new q("no-view-for-graphic");return Ba&&Ba.waitForLayer&&!this.map.allLayers.includes(xa.layer)?new Promise((Ia,Qa)=>{const Pa=this.map.allLayers.on("change",Ua=>{Ua.added.includes(xa.layer)&&(Pa.remove(),this.whenLayerView(xa.layer).then(Ia,Qa))})}):this.whenLayerView(xa.layer)}externalToInternalIntersectOptions(xa){const Ba=
this._externalToInternalRenderItems(xa.include,$a.INCLUDE);xa=this._externalToInternalRenderItems(xa.exclude,$a.EXCLUDE);return{include:Ba.layerUids,exclude:xa.layerUids,graphics:{include:Ba.graphicUids,exclude:xa.graphicUids}}}_intersectResultToMapPoint(xa,Ba){return xa.getIntersectionPoint(db)?(Ba=this.computeMapPointFromVec3d(db,Ba),xa.intersector===sa.IntersectorType.TERRAIN&&this.basemapTerrain&&(Ba.z=ma.getElevationAtPoint(this.basemapTerrain,Ba)??0),Ba):null}_intersectResultsToHits(xa,Ba){const Ia=
[];let Qa=null;for(let jb=0;jb<xa.length;jb++){var Pa=xa[jb],Ua=ya.toOwner(Pa,this);if(null!=Ua&&(Ua===this.map.ground||"type"in Ua&&"integrated-mesh"===Ua.type))break;Ua=ya.toHit(Pa,this);if(null!=Ua){if("graphic"===Ua.type){null==Qa&&jb!==xa.length-1&&(Qa=new Set);if(null!=Qa){var ab=this._getGraphicFilterUid(Ua.graphic);if(Qa.has(ab))continue;Qa.add(ab)}if(!this._testGraphicUidFilter(Ba,Ua.graphic))continue}ab=this._intersectResultToMapPoint(Pa);Pa=Pa.distanceInRenderSpace;if("media"===Ua.type){const eb=
Ua.element.toSource(ab);Ia.push({...Ua,mapPoint:ab,distance:Pa,sourcePoint:eb})}else Ia.push({...Ua,mapPoint:ab,distance:Pa})}}return Ia}_getGraphicFilterUid(xa){var Ba=xa.sourceLayer,Ia=xa.layer;if(Ba=Ba&&"objectIdField"in Ba?Ba:Ia&&"objectIdField"in Ia?Ia:Ba)if(Ia=Ba.objectIdField??M.fallbackObjectIDAttribute,Ia=xa.attributes?.[Ia])return`o-${Ba.id}-${Ia}`;return`u-${xa.uid}`}_testGraphicUidFilter(xa,Ba){Ba=this._getGraphicFilterUid(Ba);return null==xa||(null==xa.include||xa.include.has(Ba))&&(null==
xa.exclude||!xa.exclude.has(Ba))}_externalToInternalRenderItems(xa,Ba,Ia={layerUids:void 0,graphicUids:void 0}){if(!xa)return Ia;if(xa instanceof f){var Qa=this._getGraphicFilterUid(xa);Ia.graphicUids||(Ia.graphicUids=new Set);Ia.graphicUids.add(Qa);Ba===$a.INCLUDE&&(null!=this.graphicsView&&xa.layer===this?Za(Ia,this.graphicsView.processor.layer.id):xa.layer&&Za(Ia,xa.layer.uid))}else if(w.isIterable(xa))for(Qa of xa)Qa===this.graphics&&null!=this.graphicsView?Za(Ia,this.graphicsView.processor.layer.id):
Qa===this.map.ground?Za(Ia,Ea.terrainId):this._externalToInternalRenderItems(Qa,Ba,Ia);else"uid"in xa&&Za(Ia,xa.uid);return Ia}_initBasemapTerrain(){this._set("basemapTerrain",new Ka({view:this}));this._set("elevationProvider",new na.CombinedElevationProvider({view:this}));this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),
this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem();this.state.createInitialCamera();this._initBasemapTerrain();this._set("pointsOfInterest",new Ha.PointsOfInterest({view:this}));this._set("featureTiles",new ca.FeatureTileTree3D({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,
terrain:this.basemapTerrain}));const xa=()=>{var Ba=this.basemapTerrain?.extent;this.clippingArea||Ba?Ba&&this.basemapTerrain.spatialReference?(Ba=null!=this.basemapTerrain.extent&&null!=this.basemapTerrain.spatialReference?L.project(J.toExtent(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null,this.featureTiles.filterExtent=null!=this.clippingArea?this.clippingArea.intersection(Ba):Ba):this.featureTiles.filterExtent=this.clippingArea:this.featureTiles.filterExtent=
null};this.addHandles([this.updatingHandles.add(()=>ra.debugFlags.FEATURE_TILE_TREE_SHOW_TILES,Ba=>{Ba&&this.featureTiles&&!this._featureTreeDebugger?this.updatingHandles.addPromise(new Promise((Ia,Qa)=>b(["./3d/layers/support/FeatureTileTree3DDebugger"],Ia,Qa))).then(({FeatureTileTree3DDebugger:Ia})=>{!this._featureTreeDebugger&&ra.debugFlags.FEATURE_TILE_TREE_SHOW_TILES&&(this._featureTreeDebugger=new Ia({view:this}))}):Ba||!this._featureTreeDebugger||ra.debugFlags.FEATURE_TILE_TREE_SHOW_TILES||
(this._featureTreeDebugger.destroy(),this._featureTreeDebugger=null)},t.syncAndInitial),this.updatingHandles.add(()=>this.clippingArea,xa,t.syncAndInitial),this.updatingHandles.add(()=>this.basemapTerrain.extent,xa,t.syncAndInitial)],"feature-tiles");this.stateManager.init()}_exitGlobe(){this.state&&(this.stateManager.exit(),this.removeHandles("render-coords-helper"),this.removeHandles("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",
null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){var xa=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(xa)||this._set("mapCoordsHelper",new ja.MapCoordsHelper(this.map,xa));const Ba=this.state.isGlobal;xa=X.renderSRFromViewSR(Ba,xa);xa!==this.renderSpatialReference&&(this._set("renderCoordsHelper",wa.RenderCoordsHelper.create(this.state.viewingMode,xa)),Ba||this.addHandles(t.watch(()=>
this.basemapTerrain?.extent,Ia=>{const Qa=this.renderCoordsHelper.spatialReference;null==Ia||0===Ia[0]&&0===Ia[1]&&0===Ia[2]&&0===Ia[3]||!G.projectBoundingRect(Ia,this.basemapTerrain.spatialReference,ib,Qa)||(this.renderCoordsHelper.extent=ib)},t.sync),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(Sa.defaultTolerance/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.mapCoordsHelper&&
(this.removeHandles("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(xa=null){if(null==xa||xa.type!==p.ObservableChangesType.MOVE)this.removeHandles("updatingMonitors"),this.allLayerViews.forEach(Ba=>{Ba.destroyed||(this.addHandles(t.watch(()=>[Ba.updating,Ba.updatingProgress],()=>this._updatingChanged(),t.sync),"updatingMonitors"),Ba.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),
this._updatingChanged()}async _prepareScreenshotOverlay(){this.overlay&&await this.overlay.prepare()}_renderScreenshotOverlay(xa,Ba,Ia){if(!this.overlay||!this.overlay.hasVisibleItems)return Ia;const Qa=xa.getContext("2d");Qa.putImageData(Ia,0,0);this.overlay.renderCanvas(xa,{disableDecorations:Ba===Ra.Decorations.OFF});return Qa.getImageData(0,0,Ia.width,Ia.height)}_initStage(){const xa={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,
preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{prepareOverlay:()=>this._prepareScreenshotOverlay(),renderOverlay:(Ia,Qa,Pa)=>this._renderScreenshotOverlay(Ia,Qa,Pa)}};var Ba=new oa.SceneIntersectionHelper(this.state.viewingMode,Ia=>this._stage.layers.forAll(Ia),this);this._set("sceneIntersectionHelper",Ba);Ba=g.byId(this.surface);this._stage=new Na.Stage({view:this,options:xa,container:Ba});this._stage.renderer.setParameters({slicePlane:this.slicePlane});
this.addHandles([this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,Ia=>this._stage.renderer.setParameters({highQualityTransparency:Ia}),t.initial),t.watch(()=>this.magnifier,Ia=>this._stage.renderView.magnifier=Ia,t.syncAndInitial),this.on("pointer-move",()=>this._stage?.renderer.resetAnimation()),e.on(this._stage.renderView.canvas,"webglcontextlost",Ia=>this.fatalError=new q("webgl-context-lost",Ia.statusMessage))],"stage");this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(Sa.defaultTolerance/
this.renderCoordsHelper.unitInMeters);this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null);this._stage=x.destroyMaybe(this._stage);this.removeHandles("stage");this._set("canvas",null)}_initSurface(xa){this._exitSurface();this.state.init(xa,this.spatialReference);this._initStage();this._initGlobe();this.sharedSymbolResources=new Fa.SharedSymbolResources({view:this,viewingMode:xa,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,
viewState:this.state})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(!this.graphicsView&&!this._createGraphicsViewController&&0!==this.graphics.length){this.removeHandles("graphics-view");this._createGraphicsViewController=new AbortController;var xa=()=>{this._createGraphicsViewController=null;this._updatingChanged()};
this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(xa,xa);this._updatingChanged()}}async _createGraphicsViewAsync(xa){const Ba=(await new Promise((Ia,Qa)=>b(["./3d/layers/GraphicsView3D"],Pa=>Ia(Object.freeze(Object.defineProperty({__proto__:null,default:Pa},Symbol.toStringTag,{value:"Module"}))),Qa))).default;h.throwIfAborted(xa);await t.whenOnce(()=>this.basemapTerrain?.ready,xa);this._set("graphicsView",new Ba({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&
(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null);this.removeHandles("graphics-view");null!=this.graphicsView&&(this.removeHandles(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){var xa=T.viewingModeFromString(this.viewingMode);xa===T.ViewingMode.Global&&(this._clippingArea=null);this._initSurface(xa);this._set("ready",!0);this.addHandles(t.on(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),
"graphics-view");this._createGraphicsViewIfNeeded();!this._externallySet.environment&&({map:xa}=this,xa=xa&&"initialViewProperties"in xa?xa.initialViewProperties?.environment:void 0)&&(this.environment=xa);this.labeler.setup();this.environmentManager.connectView(this);this.inputManager.connect();this._set("textures",new Da.TextureCollection(this._stage,this.resourceController.scheduler));xa=this._resolveWhenReady;this._resolveWhenReady=[];xa.forEach(Ba=>Ba(this))}_teardown(){this._initialDefaultSpatialReference=
null;this.inputManager.disconnect();this.environmentManager.disconnectView();this.labeler.dispose();this._disposeGraphicsView();this.removeHandles("graphics-view");this._set("textures",x.destroyMaybe(this.textures));this._exitSurface();this._set("ready",!1)}_updateDefaultToMapOptions(){this._defaultToMapOptions.include.clear();if(this.map){this.map.ground&&this._defaultToMapOptions.include.add(Ea.terrainId);for(const xa of this.map.allLayers.items)"integrated-mesh"===xa.type&&this._defaultToMapOptions.include.add(xa.uid)}}_updateDefaultHitTestOptions(){this._defaultHitTestOptions.exclude.clear();
if(this.map){this.map.ground&&1>this.map.ground.opacity&&this._defaultHitTestOptions.exclude.add(Ea.terrainId);for(const xa of this.map.allLayers.items)"integrated-mesh"===xa.type&&1>xa.opacity&&this._defaultHitTestOptions.exclude.add(xa.uid)}}};Oa.type="3d";a.__decorate([z.property()],Oa.prototype,"_userClippingArea",void 0);a.__decorate([z.property()],Oa.prototype,"_resourceController",void 0);a.__decorate([z.property()],Oa.prototype,"_stage",void 0);a.__decorate([z.property({readOnly:!0})],Oa.prototype,
"deconflictor",void 0);a.__decorate([z.property({readOnly:!0})],Oa.prototype,"labeler",void 0);a.__decorate([z.property(F.owningCollectionProperty(Y.AnalysesCollection,"analyses"))],Oa.prototype,"analyses",void 0);a.__decorate([z.property({type:N,readOnly:!0})],Oa.prototype,"animation",null);a.__decorate([z.property({readOnly:!0})],Oa.prototype,"basemapTerrain",void 0);a.__decorate([z.property({readOnly:!0})],Oa.prototype,"elevationProvider",void 0);a.__decorate([z.property()],Oa.prototype,"camera",
null);a.__decorate([z.property({type:c})],Oa.prototype,"contentCamera",null);a.__decorate([z.property({readOnly:!0})],Oa.prototype,"canvas",void 0);a.__decorate([z.property({type:fb})],Oa.prototype,"center",null);a.__decorate([z.property({type:cb})],Oa.prototype,"clippingArea",null);a.__decorate([z.property({type:da.Constraints})],Oa.prototype,"constraints",void 0);a.__decorate([z.property({type:cb,readOnly:!0})],Oa.prototype,"renderDataExtent",null);a.__decorate([z.property({type:cb,readOnly:!0})],
Oa.prototype,"dataExtent",null);a.__decorate([z.property({type:cb,readOnly:!0})],Oa.prototype,"_groundAndLayersExtent",null);a.__decorate([z.property({value:null,type:fa})],Oa.prototype,"environment",null);a.__decorate([A.cast("environment")],Oa.prototype,"castEnvironment",null);a.__decorate([z.property({readOnly:!0})],Oa.prototype,"environmentManager",void 0);a.__decorate([z.property({type:cb})],Oa.prototype,"extent",null);a.__decorate([z.property()],Oa.prototype,"floors",void 0);a.__decorate([z.property()],
Oa.prototype,"screenCenter",null);a.__decorate([z.property()],Oa.prototype,"frustum",null);a.__decorate([z.property({type:Number,readOnly:!0})],Oa.prototype,"fullOpacity",void 0);a.__decorate([z.property({readOnly:!0})],Oa.prototype,"graphicsView",void 0);a.__decorate([z.property({readOnly:!0})],Oa.prototype,"analysisViewManager",void 0);a.__decorate([z.property()],Oa.prototype,"groundView",void 0);a.__decorate([z.property({type:Boolean})],Oa.prototype,"initialExtentRequired",null);a.__decorate([z.property()],
Oa.prototype,"_defaultsFromMapSettings",null);a.__decorate([z.property()],Oa.prototype,"interacting",null);a.__decorate([z.property()],Oa.prototype,"stationary",null);a.__decorate([z.property()],Oa.prototype,"navigating",null);a.__decorate([z.property()],Oa.prototype,"map",void 0);a.__decorate([z.property({readOnly:!0})],Oa.prototype,"mapCoordsHelper",void 0);a.__decorate([z.property()],Oa.prototype,"padding",null);a.__decorate([z.property({type:Ha.PointsOfInterest,readOnly:!0})],Oa.prototype,"pointsOfInterest",
void 0);a.__decorate([z.property({type:ca.FeatureTileTree3D,readOnly:!0})],Oa.prototype,"featureTiles",void 0);a.__decorate([z.property()],Oa.prototype,"_featureTreeDebugger",void 0);a.__decorate([z.property({type:Boolean})],Oa.prototype,"screenSizePerspectiveEnabled",void 0);a.__decorate([z.property({constructOnly:!0})],Oa.prototype,"deactivatedWebGLExtensions",void 0);a.__decorate([z.property({constructOnly:!0})],Oa.prototype,"debugWebGLExtensions",void 0);a.__decorate([z.property({constructOnly:!0})],
Oa.prototype,"renderCanvas",void 0);a.__decorate([z.property({constructOnly:!0})],Oa.prototype,"state",void 0);a.__decorate([z.property({readOnly:!0})],Oa.prototype,"inputManager",void 0);a.__decorate([z.property({readOnly:!0})],Oa.prototype,"stateManager",void 0);a.__decorate([z.property({type:["low","medium","high"]})],Oa.prototype,"qualityProfile",null);a.__decorate([z.property({type:ua,get(){let xa=this._get("qualitySettings");xa||(xa=new ua,ta.apply(this.qualityProfile,xa));return xa}})],Oa.prototype,
"qualitySettings",void 0);a.__decorate([z.property()],Oa.prototype,"slicePlane",null);a.__decorate([z.property({readOnly:!0})],Oa.prototype,"typeSpecificPreconditionsReady",null);a.__decorate([z.property({readOnly:!0})],Oa.prototype,"renderCoordsHelper",void 0);a.__decorate([z.property({readOnly:!0})],Oa.prototype,"sceneIntersectionHelper",void 0);a.__decorate([z.property({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],Oa.prototype,"resolution",null);a.__decorate([z.property({type:Number})],
Oa.prototype,"scale",null);a.__decorate([z.property()],Oa.prototype,"heightModelInfo",null);a.__decorate([z.property()],Oa.prototype,"spatialReference",void 0);a.__decorate([z.property({type:Boolean,constructOnly:!0})],Oa.prototype,"alphaCompositingEnabled",void 0);a.__decorate([z.property({constructOnly:!0})],Oa.prototype,"preserveDrawingBufferEnabled",void 0);a.__decorate([z.property({type:Boolean})],Oa.prototype,"supersampleScreenshotsEnabled",void 0);a.__decorate([z.property({readOnly:!0})],Oa.prototype,
"type",void 0);a.__decorate([z.property(),A.cast(xa=>xa instanceof Wa?xa:B.ensureClass(hb,xa))],Oa.prototype,"ui",void 0);a.__decorate([z.property({type:Boolean,readOnly:!0,dependsOn:"graphicsView.updating basemapView.updating basemapTerrain.updating layerViewManager.updating layerViewManager.updatingRemaining _resourceController.updating _stage.updating featureTiles.updating pointsOfInterest.updating environmentManager.updating overlay.updating updatingHandles.updating featureTreeDebugger.updating labeler.updating deconflictor.updating ready stationary inputManager.updating toolViewManager.updating analysisViewManager.updating state.updating textures.updating".split(" ")})],
Oa.prototype,"updating",null);a.__decorate([z.property()],Oa.prototype,"_updatingObjects",null);a.__decorate([z.property()],Oa.prototype,"_updatingObjectsWithProgress",null);a.__decorate([z.property({type:Number,readOnly:!0,dependsOn:["updating"]})],Oa.prototype,"updatingProgress",void 0);a.__decorate([z.property({type:["global","local"]})],Oa.prototype,"viewingMode",null);a.__decorate([z.property({type:n})],Oa.prototype,"viewpoint",null);a.__decorate([z.property({type:Number})],Oa.prototype,"zoom",
null);a.__decorate([z.property({type:pa})],Oa.prototype,"highlightOptions",void 0);a.__decorate([z.property({readOnly:!0})],Oa.prototype,"quality",null);a.__decorate([z.property({readOnly:!0})],Oa.prototype,"resolutionScale",null);a.__decorate([z.property()],Oa.prototype,"textures",void 0);Oa=a.__decorate([E.subclass("esri.views.SceneView")],Oa);var $a;(function(xa){xa[xa.INCLUDE=0]="INCLUDE";xa[xa.EXCLUDE=1]="EXCLUDE"})($a||($a={}));const db=D.create(),kb=u.createScreenPointArray(),ib=J.create();
return Oa})},"esri/geometry/projection/projectBoundingRect":function(){define(["exports","../../chunks/vec3f64","./projectBuffer","../support/aaBoundingRect","../support/spatialReferenceUtils"],function(b,a,c,d,f){const n=a.create();b.projectBoundingRect=function(k,g,q,e){if(null==k)return!1;if(f.equals(g,e))return d.copy(q,k),!0;n[0]=k[0];n[1]=k[1];n[2]=0;if(!c.projectBuffer(n,g,0,n,e,0,1))return!1;q[0]=n[0];q[1]=n[1];n[0]=k[2];n[1]=k[3];n[2]=0;if(!c.projectBuffer(n,g,0,n,e,0,1))return!1;q[2]=n[0];
q[3]=n[1];return!0};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/projectPointToVector":function(){define(["exports","../../chunks/vec3f64","./projectBuffer"],function(b,a,c){const d=a.create();b.projectPointToVector=function(f,n,k,g=0){d[0]=f.x;d[1]=f.y;const q=f.z;d[2]=void 0!==q?q:g;return c.projectBuffer(d,f.spatialReference,0,n,k,0,1)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/projectVectorToVector":function(){define(["exports",
"../../chunks/vec3f64","./projectBuffer"],function(b,a,c){const d=a.create();b.projectVectorToVector=function(f,n,k,g){if(null==n||null==g||2>f.length)return!1;2===f.length&&(d[0]=f[0],d[1]=f[1],d[2]=0,f=d);return c.projectBuffer(f,n,0,k,g,0,1)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/boundedPlane":function(){define("exports ../core/has ../core/Logger ../core/mathUtils ../core/ObjectStack ./mat4 ./mat4f64 ./vec3 ./vec3f64 ../geometry/support/Axis ../geometry/support/lineSegment ../geometry/support/plane ../geometry/support/ray ../geometry/support/vector ../geometry/support/vectorStacks".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x){function p(ca=aa){return{plane:l.create(ca.plane),origin:q.clone(ca.origin),basis1:q.clone(ca.basis1),basis2:q.clone(ca.basis2)}}function h(ca,ia,la){const oa=ka.get();oa.origin=ca;oa.basis1=ia;oa.basis2=la;oa.plane=l.wrap(0,0,0,0);y(oa);return oa}function t(ca,ia=p()){return u(ca.origin,ca.basis1,ca.basis2,ia)}function r(ca,ia){g.copy(ia.origin,ca.origin);g.copy(ia.basis1,ca.basis1);g.copy(ia.basis2,ca.basis2);l.copy(ia.plane,ca.plane)}function u(ca,ia,la,
oa=p()){g.copy(oa.origin,ca);g.copy(oa.basis1,ia);g.copy(oa.basis2,la);y(oa);1E-6<Math.abs(g.dot(oa.basis1,oa.basis2)/(g.length(oa.basis1)*g.length(oa.basis2)))&&N.warn("fromValues()","Provided basis vectors are not perpendicular");1E-6<Math.abs(g.dot(oa.basis1,W(oa)))&&N.warn("fromValues()","Basis vectors and plane normal are not perpendicular");1E-6<Math.abs(-g.dot(W(oa),oa.origin)-oa.plane[3])&&N.warn("fromValues()","Plane offset is not consistent with plane origin");return oa}function y(ca){l.fromVectorsAndPoint(ca.basis2,
ca.basis1,ca.origin,ca.plane)}function z(ca,ia,la){ca!==la&&t(ca,la);ca=g.scale(x.sv3d.get(),W(ca),ia);g.add(la.origin,la.origin,ca);la.plane[3]-=ia;return la}function A(ca,ia,la){C(ia,la);z(la,X(ca,ca.origin),la);return la}function C(ca,ia=p()){const la=(ca[2]-ca[0])/2,oa=(ca[3]-ca[1])/2;g.set(ia.origin,ca[0]+la,ca[1]+oa,0);g.set(ia.basis1,la,0,0);g.set(ia.basis2,0,oa,0);l.fromValues(0,0,1,0,ia.plane);return ia}function E(ca,ia,la){return l.intersectRay(ca.plane,ia,la)?H(ca,la):!1}function B(ca,
ia,la){if(E(ca,ia,la))return la;ca=D(ca,ia,x.sv3d.get());g.add(la,ia.origin,g.scale(x.sv3d.get(),ia.direction,g.distance(ia.origin,ca)/g.length(ia.direction)));return la}function D(ca,ia,la){const oa=Z.get();var na=Z.get();Q(ca,ia,oa,na);na=Number.POSITIVE_INFINITY;for(const ta of ha){var ra=I(ca,ta,da.get());const ma=x.sv3d.get();l.intersectLineSegment(oa,ra,ma)&&(ra=g.direction(x.sv3d.get(),ia.origin,ma),ra=Math.abs(d.acosClamped(g.dot(ia.direction,ra))),ra<na&&(na=ra,g.copy(la,ma)))}return na===
Number.POSITIVE_INFINITY?F(ca,ia,la):la}function F(ca,ia,la){if(E(ca,ia,la))return la;const oa=Z.get(),na=Z.get();Q(ca,ia,oa,na);let ra=Number.POSITIVE_INFINITY;for(const ma of ha){var ta=I(ca,ma,da.get());const pa=x.sv3d.get();l.intersectLineSegmentClamp(oa,ta,pa)&&(ta=w.distance2(ia,pa),l.isPointInside(na,pa)&&ta<ra&&(ra=ta,g.copy(la,pa)))}G(ca,ia.origin)<ra&&K(ca,ia.origin,la);return la}function K(ca,ia,la){var oa=l.projectPoint(ca.plane,ia,x.sv3d.get());ia=m.projectPointClamp(S(ca,ca.basis1),
oa,-1,1,x.sv3d.get());oa=m.projectPointClamp(S(ca,ca.basis2),oa,-1,1,x.sv3d.get());g.subtract(la,g.add(x.sv3d.get(),ia,oa),ca.origin);return la}function L(ca,ia,la){const {origin:oa,basis1:na,basis2:ra}=ca,ta=g.subtract(x.sv3d.get(),ia,oa);ia=v.projectPointSignedLength(na,ta);const ma=v.projectPointSignedLength(ra,ta);ca=v.projectPointSignedLength(W(ca),ta);return g.set(la,ia,ma,ca)}function G(ca,ia){ia=L(ca,ia,x.sv3d.get());const {basis1:la,basis2:oa}=ca;ca=g.length(la);var na=g.length(oa);ca=Math.max(Math.abs(ia[0])-
ca,0);na=Math.max(Math.abs(ia[1])-na,0);ia=ia[2];return ca*ca+na*na+ia*ia}function O(ca,ia){return Math.sqrt(G(ca,ia))}function P(ca,ia){let la=Number.NEGATIVE_INFINITY;for(const na of ha){var oa=I(ca,na,da.get());oa=m.distance2(oa,ia);oa>la&&(la=oa)}return Math.sqrt(la)}function J(ca,ia){return l.isPointInside(ca.plane,ia)&&H(ca,ia)}function R(ca,ia,la,oa){switch(la){case e.Axis.X:g.copy(oa,ca.basis1);g.normalize(oa,oa);break;case e.Axis.Y:g.copy(oa,ca.basis2);g.normalize(oa,oa);break;case e.Axis.Z:g.copy(oa,
W(ca))}return oa}function X(ca,ia){const la=-ca.plane[3];return v.projectPointSignedLength(W(ca),ia)-la}function U(ca,ia,la,oa){const na=X(ca,ia);ca=g.scale(fa,W(ca),la-na);g.add(oa,ia,ca);return oa}function M(ca,ia){return g.exactEquals(ca.basis1,ia.basis1)&&g.exactEquals(ca.basis2,ia.basis2)&&g.exactEquals(ca.origin,ia.origin)}function V(ca,ia,la){ca!==la&&t(ca,la);n.invert(ba,ia);n.transpose(ba,ba);g.transformMat4(la.basis1,ca.basis1,ba);g.transformMat4(la.basis2,ca.basis2,ba);g.transformMat4(l.normal(la.plane),
l.normal(ca.plane),ba);g.transformMat4(la.origin,ca.origin,ia);l.setOffsetFromPoint(la.plane,la.plane,la.origin);return la}function Y(ca,ia,la,oa){ca!==oa&&t(ca,oa);n.fromRotation(ea,ia,la);g.transformMat4(oa.basis1,ca.basis1,ea);g.transformMat4(oa.basis2,ca.basis2,ea);y(oa);return oa}function W(ca){return l.normal(ca.plane)}function H(ca,ia){const la=g.subtract(x.sv3d.get(),ia,ca.origin);ia=g.squaredLength(ca.basis1);const oa=g.squaredLength(ca.basis2),na=g.dot(ca.basis1,la);ca=g.dot(ca.basis2,la);
return 0>-na-ia&&0>na-ia&&0>-ca-oa&&0>ca-oa}function S(ca,ia){const la=da.get();g.copy(la.origin,ca.origin);g.copy(la.vector,ia);return la}function I(ca,ia,la){const {basis1:oa,basis2:na,origin:ra}=ca;ca=g.scale(x.sv3d.get(),oa,ia.origin[0]);const ta=g.scale(x.sv3d.get(),na,ia.origin[1]);g.add(la.origin,ca,ta);g.add(la.origin,la.origin,ra);ca=g.scale(x.sv3d.get(),oa,ia.direction[0]);ia=g.scale(x.sv3d.get(),na,ia.direction[1]);g.scale(la.vector,g.add(ca,ca,ia),2);return la}function Q(ca,ia,la,oa){ca=
W(ca);l.fromVectorsAndPoint(ca,ia.direction,ia.origin,la);l.fromVectorsAndPoint(l.normal(la),ca,ia.origin,oa)}const N=c.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");class T{constructor(){this.plane=l.create();this.origin=q.create();this.basis1=q.create();this.basis2=q.create()}}a=T;const aa={plane:l.create(),origin:q.fromValues(0,0,0),basis1:q.fromValues(1,0,0),basis2:q.fromValues(0,1,0)},Z=new f.ObjectStack(l.create),da=new f.ObjectStack(m.create),fa=q.create(),ka=new f.ObjectStack(()=>
p()),ha=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],ba=k.create(),ea=k.create();f=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:a,altitudeAt:X,axisAt:R,closestPoint:F,closestPointOnSilhouette:D,copy:t,copyWithoutVerify:r,create:p,distance:O,distance2:G,distanceToSilhouette:P,elevate:z,equals:M,extrusionContainsPoint:J,fromAABoundingRect:C,fromValues:u,intersectRay:E,intersectRayClosestSilhouette:B,
normal:W,projectPoint:K,projectPointLocal:L,rotate:Y,setAltitudeAt:U,setExtent:A,transform:V,up:aa,updateUnboundedPlane:y,wrap:h},Symbol.toStringTag,{value:"Module"}));b.BoundedPlaneClass=a;b.altitudeAt=X;b.axisAt=R;b.boundedPlane=f;b.closestPoint=F;b.closestPointOnSilhouette=D;b.copy=t;b.copyWithoutVerify=r;b.create=p;b.distance=O;b.distance2=G;b.distanceToSilhouette=P;b.elevate=z;b.equals=M;b.extrusionContainsPoint=J;b.fromAABoundingRect=C;b.fromValues=u;b.intersectRay=E;b.intersectRayClosestSilhouette=
B;b.normal=W;b.projectPoint=K;b.projectPointLocal=L;b.rotate=Y;b.setAltitudeAt=U;b.setExtent=A;b.transform=V;b.up=aa;b.updateUnboundedPlane=y;b.wrap=h})},"esri/core/ObjectStack":function(){define(["exports","./nextTick"],function(b,a){class c{constructor(d){this._allocator=d;this._items=[];this._itemsPtr=0;this._grow()}get(){0===this._itemsPtr&&a.nextTick(()=>this._reset());this._itemsPtr===this._items.length&&this._grow();return this._items[this._itemsPtr++]}_reset(){this._items.length=Math.min(Math.min(3*
Math.max(8,this._itemsPtr),this._itemsPtr+3072),this._items.length);this._itemsPtr=0}_grow(){for(let d=0;d<Math.max(8,Math.min(this._items.length,1024));d++)this._items.push(this._allocator())}}b.ObjectStack=c;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/lineSegment":function(){define("exports ../../core/mathUtils ../../core/ObjectStack ../../chunks/vec3 ../../chunks/vec3f64 ./vectorStacks".split(" "),function(b,a,c,d,f,n){function k(x){return x?{origin:f.clone(x.origin),
vector:f.clone(x.vector)}:{origin:f.create(),vector:f.create()}}function g(x,p){const h=v.get();h.origin=x;h.vector=p;return h}function q(x,p,h=k()){d.copy(h.origin,x);d.copy(h.vector,p);return h}function e(x,p){p=d.subtract(n.sv3d.get(),p,x.origin);var h=d.dot(x.vector,p);const t=d.dot(x.vector,x.vector);h=a.clamp(h/t,0,1);x=d.subtract(n.sv3d.get(),d.scale(n.sv3d.get(),x.vector,h),p);return d.dot(x,x)}function m(x,p,h,t,r){const {vector:u,origin:y}=x;p=d.subtract(n.sv3d.get(),p,y);p=d.dot(u,p)/d.squaredLength(u);
d.scale(r,u,a.clamp(p,h,t));return d.add(r,r,x.origin)}function l(x,p,h,t){const r=x.origin;var u=d.add(n.sv3d.get(),r,x.vector);x=p.origin;var y=d.add(n.sv3d.get(),x,p.vector),z=n.sv3d.get();p=n.sv3d.get();z[0]=r[0]-x[0];z[1]=r[1]-x[1];z[2]=r[2]-x[2];p[0]=y[0]-x[0];p[1]=y[1]-x[1];p[2]=y[2]-x[2];if(1E-6>Math.abs(p[0])&&1E-6>Math.abs(p[1])&&1E-6>Math.abs(p[2]))return!1;y=n.sv3d.get();y[0]=u[0]-r[0];y[1]=u[1]-r[1];y[2]=u[2]-r[2];if(1E-6>Math.abs(y[0])&&1E-6>Math.abs(y[1])&&1E-6>Math.abs(y[2]))return!1;
u=z[0]*p[0]+z[1]*p[1]+z[2]*p[2];var A=p[0]*y[0]+p[1]*y[1]+p[2]*y[2];const C=p[0]*p[0]+p[1]*p[1]+p[2]*p[2],E=(y[0]*y[0]+y[1]*y[1]+y[2]*y[2])*C-A*A;if(1E-6>Math.abs(E))return!1;z=(u*A-(z[0]*y[0]+z[1]*y[1]+z[2]*y[2])*C)/E;u=(u+A*z)/C;h&&(z=a.clamp(z,0,1),u=a.clamp(u,0,1));h=n.sv3d.get();A=n.sv3d.get();h[0]=r[0]+z*y[0];h[1]=r[1]+z*y[1];h[2]=r[2]+z*y[2];A[0]=x[0]+u*p[0];A[1]=x[1]+u*p[1];A[2]=x[2]+u*p[2];t.tA=z;t.tB=u;t.pA=h;t.pB=A;t.distance2=d.squaredDistance(h,A);return!0}const w={tA:0,tB:0,pA:f.create(),
pB:f.create(),distance2:0},v=new c.ObjectStack(()=>k());b.closestLineSegmentDistance2=function(x,p){return l(x,p,!0,w)?w.distance2:null};b.closestLineSegmentPoint=function(x,p,h){return l(x,p,!0,w)?(d.copy(h,w.pA),!0):!1};b.closestRayDistance2=function(x,p){if(l(x,g(p.origin,p.direction),!1,w)){const {tA:h,pB:t,distance2:r}=w;if(0<=h&&1>=h)return r;if(0>h)return d.squaredDistance(x.origin,t);if(1<h)return d.squaredDistance(d.add(n.sv3d.get(),x.origin,x.vector),t)}return null};b.copy=function(x,p=
k()){return q(x.origin,x.vector,p)};b.create=k;b.distance=function(x,p){return Math.sqrt(e(x,p))};b.distance2=e;b.fromPoints=function(x,p,h=k()){d.copy(h.origin,x);d.subtract(h.vector,p,x);return h};b.fromValues=q;b.pointAt=function(x,p,h){return d.add(h,x.origin,d.scale(h,x.vector,p))};b.projectPoint=function(x,p,h){return m(x,p,0,1,h)};b.projectPointClamp=m;b.wrap=g;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/vectorStacks":function(){define(["exports",
"../../core/VectorStack"],function(b,a){const c=a.VectorStack.createVec2f64(),d=a.VectorStack.createVec3f64(),f=a.VectorStack.createVec4f64(),n=a.VectorStack.createMat3f64(),k=a.VectorStack.createMat4f64();a=a.VectorStack.createQuatf64();b.sm3d=n;b.sm4d=k;b.sq4d=a;b.sv2d=c;b.sv3d=d;b.sv4d=f;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/core/VectorStack":function(){define("exports ./ByteSizeUnit ./nextTick ../chunks/mat3f64 ../chunks/mat4f64 ../chunks/quatf64 ../chunks/vec2f64 ../chunks/vec3f64 ../chunks/vec4f64".split(" "),
function(b,a,c,d,f,n,k,g,q){class e{constructor(l,w,v){this._itemByteSize=l;this._itemCreate=w;this._buffers=[];this._items=[];this._itemsPtr=0;this._itemsPerBuffer=Math.ceil(v/this._itemByteSize)}get(){0===this._itemsPtr&&c.nextTick(()=>this._reset());const l=Math.floor(this._itemsPtr/this._itemsPerBuffer);for(;this._buffers.length<=l;){const w=new ArrayBuffer(this._itemsPerBuffer*this._itemByteSize);for(let v=0;v<this._itemsPerBuffer;++v)this._items.push(this._itemCreate(w,v*this._itemByteSize));
this._buffers.push(w)}return this._items[this._itemsPtr++]}_reset(){const l=2*(Math.floor(this._itemsPtr/this._itemsPerBuffer)+1);for(;this._buffers.length>l;)this._buffers.pop(),this._items.length=this._buffers.length*this._itemsPerBuffer;this._itemsPtr=0}static createVec2f64(l=m){return new e(16,k.createView,l)}static createVec3f64(l=m){return new e(24,g.createView,l)}static createVec4f64(l=m){return new e(32,q.createView,l)}static createMat3f64(l=m){return new e(72,d.createView,l)}static createMat4f64(l=
m){return new e(128,f.createView,l)}static createQuatf64(l=m){return new e(32,n.createView,l)}get test(){return{size:this._buffers.length*this._itemsPerBuffer*this._itemByteSize}}}const m=4*a.ByteSizeUnit.KILOBYTES;b.VectorStack=e;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/mat3f64":function(){define(["exports"],function(b){function a(){return[1,0,0,0,1,0,0,0,1]}function c(k){return[k[0],k[1],k[2],k[3],k[4],k[5],k[6],k[7],k[8]]}function d(k,g,q,e,m,l,w,v,x){return[k,
g,q,e,m,l,w,v,x]}function f(k,g){return new Float64Array(k,g,9)}const n=Object.freeze(Object.defineProperty({__proto__:null,clone:c,create:a,createView:f,fromValues:d},Symbol.toStringTag,{value:"Module"}));b.clone=c;b.create=a;b.createView=f;b.fromValues=d;b.mat3f64=n})},"esri/chunks/quatf64":function(){define(["exports"],function(b){function a(){return[0,0,0,1]}function c(g){return[g[0],g[1],g[2],g[3]]}function d(g,q,e,m){return[g,q,e,m]}function f(g,q){return new Float64Array(g,q,4)}const n=a(),
k=Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:n,clone:c,create:a,createView:f,fromValues:d},Symbol.toStringTag,{value:"Module"}));b.IDENTITY=n;b.clone=c;b.create=a;b.createView=f;b.fromValues=d;b.quatf64=k})},"esri/chunks/vec2f64":function(){define(["exports"],function(b){function a(){return[0,0]}function c(p){return[p[0],p[1]]}function d(p,h){return[p,h]}function f(p,h=[0,0]){const t=Math.min(2,p.length);for(let r=0;r<t;++r)h[r]=p[r];return h}function n(p,h){return new Float64Array(p,
h,2)}function k(){return[0,0]}function g(){return[1,1]}function q(){return[1,0]}function e(){return[0,1]}const m=[0,0],l=[1,1],w=[1,0],v=[0,1],x=Object.freeze(Object.defineProperty({__proto__:null,ONES:l,UNIT_X:w,UNIT_Y:v,ZEROS:m,clone:c,create:a,createView:n,fromArray:f,fromValues:d,ones:g,unitX:q,unitY:e,zeros:k},Symbol.toStringTag,{value:"Module"}));b.ONES=l;b.UNIT_X=w;b.UNIT_Y=v;b.ZEROS=m;b.clone=c;b.create=a;b.createView=n;b.fromArray=f;b.fromValues=d;b.ones=g;b.unitX=q;b.unitY=e;b.vec2f64=x;
b.zeros=k})},"esri/geometry/support/plane":function(){define("exports ../../core/mathUtils ../../chunks/vec3 ../../chunks/vec3f64 ../../chunks/vec4 ../../chunks/common ../../chunks/sphere ./vector ./vectorStacks ../../views/3d/support/mathUtils".split(" "),function(b,a,c,d,f,n,k,g,q,e){function m(G=D){return[G[0],G[1],G[2],G[3]]}function l(G,O){return w(O[0],O[1],O[2],O[3],G)}function w(G,O,P,J,R=m()){R[0]=G;R[1]=O;R[2]=P;R[3]=J;return R}function v(G,O,P){var J=O[0]*O[0]+O[1]*O[1]+O[2]*O[2];J=1E-5<
Math.abs(J-1)&&1E-12<J?1/Math.sqrt(J):1;P[0]=O[0]*J;P[1]=O[1]*J;P[2]=O[2]*J;P[3]=-(P[0]*G[0]+P[1]*G[1]+P[2]*G[2]);return P}function x(G,O,P,J=m()){var R=P[0]-O[0],X=P[1]-O[1],U=P[2]-O[2];P=G[0]-O[0];const M=G[1]-O[1],V=G[2]-O[2];O=X*V-U*M;U=U*P-R*V;R=R*M-X*P;X=O*O+U*U+R*R;X=1E-5<Math.abs(X-1)&&1E-12<X?1/Math.sqrt(X):1;J[0]=O*X;J[1]=U*X;J[2]=R*X;J[3]=-(J[0]*G[0]+J[1]*G[1]+J[2]*G[2]);return J}function p(G,O,P,J=0,R=Math.floor(1/3*P),X=Math.floor(2/3*P)){if(3>P)return!1;O(y,J);let U=R,M=!1;for(;U<P-
1&&!M;)O(z,U),U++,M=!c.exactEquals(y,z);if(!M)return!1;U=Math.max(U,X);for(M=!1;U<P&&!M;)O(A,U),U++,c.subtract(C,y,z),c.normalize(C,C),c.subtract(E,z,A),c.normalize(E,E),M=!c.exactEquals(y,A)&&!c.exactEquals(z,A)&&.99619469809>Math.abs(c.dot(C,E));if(!M)return 0===J&&1===R&&2===X?!1:p(G,O,P,0,1,2);x(y,z,A,G);return!0}function h(G,O,P){G=c.scale(q.sv3d.get(),G,c.dot(G,O));c.subtract(P,O,G);return P}function t(G,O){return c.dot(G,O)+G[3]}function r(G,O,P,J,R){const X=c.dot(G,P);if(0===X)return!1;G=
-(c.dot(G,O)+G[3])/X;J&F.CLAMP&&(G=a.clamp(G,0,1));if(!(J&F.INFINITE_MIN)&&0>G||!(J&F.INFINITE_MAX)&&1<G)return!1;c.add(R,O,c.scale(R,P,G));return!0}const u=f.exactEquals;f=f.equals;const y=d.create(),z=d.create(),A=d.create(),C=d.create(),E=d.create(),B=(()=>{const G=d.create();return(O,P,J)=>{c.cross(G,O,P);if(c.squaredLength(G)<n.getEpsilon())return!1;c.normalize(G,G);const [R,X,U]=G,M=J.origin,V=Math.abs(R),Y=Math.abs(X),W=Math.abs(U),[H,S,I]=O,[Q,N,T]=P;O=O[3];P=P[3];V>Y&&V>W?(M[1]=(P*I-O*T)/
R,M[2]=(O*N-P*S)/R):Y>W?(M[0]=(O*T-P*I)/X,M[2]=(P*H-O*Q)/X):(M[0]=(P*S-O*N)/U,M[1]=(O*Q-P*H)/U);c.copy(J.direction,G);return!0}})(),D=[0,0,1,0];var F;(function(G){G[G.NONE=0]="NONE";G[G.CLAMP=1]="CLAMP";G[G.INFINITE_MIN=4]="INFINITE_MIN";G[G.INFINITE_MAX=8]="INFINITE_MAX"})(F||(F={}));const K=F.INFINITE_MIN|F.INFINITE_MAX,L=F.INFINITE_MAX;b.clip=function(G,O){const P=c.dot(G,O.ray.direction);G=-t(G,O.ray.origin);if(0>G&&0<=P)return!1;if(-1E-6<P&&1E-6>P)return 0<G;if((0>G||0>P)&&!(0>G&&0>P))return!0;
G/=P;0<P?G<O.c1&&(O.c1=G):G>O.c0&&(O.c0=G);return O.c0<=O.c1};b.clipInfinite=function(G,O){const P=c.dot(G,O.ray.direction);G=-t(G,O.ray.origin);if(-1E-6<P&&1E-6>P)return 0<G;G/=P;0<P?G<O.c1&&(O.c1=G):G>O.c0&&(O.c0=G);return O.c0<=O.c1};b.copy=l;b.create=m;b.distance=function(G,O){return Math.abs(t(G,O))};b.equals=f;b.exactEquals=u;b.fromArray=function(G,O,P=!0){const J=O.length/3;return p(G,(R,X)=>c.set(R,O[3*X],O[3*X+1],O[3*X+2]),P?J-1:J)};b.fromManyPoints=p;b.fromNormalAndOffset=function(G,O,P){c.copy(P,
G);P[3]=O;return P};b.fromPoints=x;b.fromPositionAndNormal=v;b.fromValues=w;b.fromVectorsAndPoint=function(G,O,P,J){c.cross(A,O,G);return v(P,A,J)};b.intersectLine=function(G,O,P,J){P=c.subtract(q.sv3d.get(),P,O);return r(G,O,P,K,J)};b.intersectLineSegment=function(G,O,P){return r(G,O.origin,O.vector,F.NONE,P)};b.intersectLineSegmentClamp=function(G,O,P){return r(G,O.origin,O.vector,F.CLAMP,P)};b.intersectPlanes=B;b.intersectRay=function(G,O,P){return null!=O?r(G,O.origin,O.direction,L,P):!1};b.isPointInside=
function(G,O){return 0<=t(G,O)};b.isPointOutside=function(G,O){return 0>t(G,O)};b.isSphereFullyInside=function(G,O){return 0<=t(G,k.getCenter(O))-O[3]};b.isSphereFullyOutside=function(G,O){return 0>t(G,k.getCenter(O))+O[3]};b.isVertical=function(G){return Math.abs(G[2])<n.getEpsilon()};b.negate=function(G,O){O[0]=-G[0];O[1]=-G[1];O[2]=-G[2];O[3]=-G[3];return O};b.normal=function(G){return G};b.projectPoint=function(G,O,P){const J=c.scale(q.sv3d.get(),G,-G[3]);O=c.subtract(q.sv3d.get(),O,J);G=h(G,
O,q.sv3d.get());c.add(P,G,J);return P};b.projectPointLocal=function(G,O,P,J){var R=q.sv3d.get(),X=q.sv3d.get();e.tangentFrame(G,R,X);O=c.subtract(q.sv3d.get(),P,O);R=g.projectPointSignedLength(R,O);X=g.projectPointSignedLength(X,O);G=g.projectPointSignedLength(G,O);return c.set(J,R,X,G)};b.projectVector=h;b.setOffsetFromPoint=function(G,O,P){O!==G&&l(G,O);G[3]=-c.dot(G,P);return G};b.signedDistance=t;b.up=D;b.wrap=function(G=D[0],O=D[1],P=D[2],J=D[3]){return w(G,O,P,J,q.sv4d.get())};Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/chunks/sphere":function(){define("exports ../core/has ../core/Logger ../core/mathUtils ./mat4 ./vec3 ./vec3f64 ./vec4 ./vec4f64 ./common ../geometry/support/Axis ../geometry/support/ray ../geometry/support/vector ../geometry/support/vectorStacks".split(" "),function(b,a,c,d,f,n,k,g,q,e,m,l,w,v){function x(){return q.create()}function p(Z,da=x()){return g.copy(da,Z)}function h(Z,da){return q.fromValues(Z[0],Z[1],Z[2],da)}function t(Z){return Z}function r(Z){Z[0]=
Z[1]=Z[2]=Z[3]=0}function u(Z,da){Z[0]=Z[1]=Z[2]=0;Z[3]=da;return Z}function y(Z){return Z[3]}function z(Z){return Z}function A(Z,da,fa,ka){return q.fromValues(Z,da,fa,ka)}function C(Z,da,fa){Z!==fa&&n.copy(fa,Z);fa[3]=Z[3]+da;return fa}function E(Z,da,fa){c.getLogger("esri.geometry.support.sphere").error("sphere.setExtent is not yet supported");return Z===fa?fa:p(Z,fa)}function B(Z,da,fa){if(null==da||!F(Z,da,S))return!1;let {t0:ka,t1:ha}=S;if(0>ka||ha<ka&&0<ha)ka=ha;if(0>ka)return!1;if(fa){const {origin:ba,
direction:ea}=da;fa[0]=ba[0]+ea[0]*ka;fa[1]=ba[1]+ea[1]*ka;fa[2]=ba[2]+ea[2]*ka}return!0}function D(Z,da,fa){da=l.fromPoints(da,fa);if(!F(Z,da,S))return[];const {origin:ka,direction:ha}=da,{t0:ba,t1:ea}=S;da=ca=>{const ia=k.create();n.scaleAndAdd(ia,ka,ha,ca);return P(Z,ia,ia)};return Math.abs(ba-ea)<e.getEpsilon()?[da(ba)]:[da(ba),da(ea)]}function F(Z,da,fa){const {origin:ka,direction:ha}=da,ba=I;ba[0]=ka[0]-Z[0];ba[1]=ka[1]-Z[1];ba[2]=ka[2]-Z[2];da=ha[0]*ha[0]+ha[1]*ha[1]+ha[2]*ha[2];if(0===da)return!1;
const ea=2*(ha[0]*ba[0]+ha[1]*ba[1]+ha[2]*ba[2]);Z=ea*ea-4*da*(ba[0]*ba[0]+ba[1]*ba[1]+ba[2]*ba[2]-Z[3]*Z[3]);if(0>Z)return!1;Z=Math.sqrt(Z);fa.t0=(-ea-Z)/(2*da);fa.t1=(-ea+Z)/(2*da);return!0}function K(Z,da){return B(Z,da,null)}function L(Z,da,fa){if(B(Z,da,fa))return fa;Z=G(Z,da,v.sv3d.get());n.add(fa,da.origin,n.scale(v.sv3d.get(),da.direction,n.distance(da.origin,Z)/n.length(da.direction)));return fa}function G(Z,da,fa){const ka=v.sv3d.get(),ha=v.sm4d.get();n.cross(ka,da.origin,da.direction);
const ba=Z[3];n.cross(fa,ka,da.origin);n.scale(fa,fa,1/n.length(fa)*ba);Z=R(Z,da.origin);da=w.angle(da.origin,fa);f.fromRotation(ha,da+Z,ka);n.transformMat4(fa,fa,ha);return fa}function O(Z,da,fa){if(B(Z,da,fa))return fa;l.closestPoint(da,Z,fa);return P(Z,fa,fa)}function P(Z,da,fa){da=n.subtract(v.sv3d.get(),da,Z);da=n.scale(v.sv3d.get(),da,Z[3]/n.length(da));return n.add(fa,da,Z)}function J(Z,da){da=n.subtract(v.sv3d.get(),da,Z);da=n.squaredLength(da);return Math.sqrt(Math.abs(da-Z[3]*Z[3]))}function R(Z,
da){da=n.subtract(v.sv3d.get(),da,Z);da=n.length(da);Z=Z[3];return d.acosClamped(Z/(Z+Math.abs(Z-da)))}function X(Z,da,fa,ka){Z=n.subtract(Q,da,Z);switch(fa){case m.Axis.X:return fa=d.cartesianToSpherical(Z,Q)[2],n.set(ka,-Math.sin(fa),Math.cos(fa),0);case m.Axis.Y:return Z=d.cartesianToSpherical(Z,Q),fa=Z[1],Z=Z[2],da=Math.sin(fa),n.set(ka,-da*Math.cos(Z),-da*Math.sin(Z),Math.cos(fa));case m.Axis.Z:return n.normalize(ka,Z)}}function U(Z,da){da=n.subtract(N,da,Z);return n.length(da)-Z[3]}function M(Z,
da,fa,ka){const ha=U(Z,da);Z=X(Z,da,m.Axis.Z,N);fa=n.scale(N,Z,fa-ha);return n.add(ka,da,fa)}function V(Z,da){da=n.squaredDistance(Z,da);Z=Z[3];return da<=Z*Z}function Y(Z,da,fa=x()){const ka=n.distance(Z,da),ha=Z[3],ba=da[3];if(ka+ba<ha)return g.copy(fa,Z),fa;if(ka+ha<ba)return g.copy(fa,da),fa;n.lerp(fa,Z,da,(ka+ba-ha)/(2*ka));fa[3]=(ka+ha+ba)/2;return fa}a=x();const W=g.equals,H=g.equals,S={t0:0,t1:0},I=k.create(),Q=k.create(),N=k.create(),T=x(),aa=Object.freeze(Object.defineProperty({__proto__:null,
NullSphere:a,altitudeAt:U,angleToSilhouette:R,axisAt:X,clear:r,closestPoint:O,closestPointOnSilhouette:G,containsPoint:V,copy:p,create:x,distanceToSilhouette:J,elevate:C,equals:H,exactEquals:W,fromCenterAndRadius:h,fromRadius:u,fromValues:A,getCenter:z,getRadius:y,intersectLine:D,intersectRay:B,intersectRayClosestSilhouette:L,intersectsRay:K,projectPoint:P,setAltitudeAt:M,setExtent:E,tmpSphere:T,union:Y,wrap:t},Symbol.toStringTag,{value:"Module"}));b.NullSphere=a;b.altitudeAt=U;b.angleToSilhouette=
R;b.axisAt=X;b.clear=r;b.closestPoint=O;b.closestPointOnSilhouette=G;b.containsPoint=V;b.copy=p;b.create=x;b.distanceToSilhouette=J;b.elevate=C;b.equals=H;b.exactEquals=W;b.fromCenterAndRadius=h;b.fromRadius=u;b.fromValues=A;b.getCenter=z;b.getRadius=y;b.intersectLine=D;b.intersectRay=B;b.intersectRayClosestSilhouette=L;b.intersectsRay=K;b.projectPoint=P;b.setAltitudeAt=M;b.setExtent=E;b.sphere=aa;b.tmpSphere=T;b.union=Y;b.wrap=t})},"esri/geometry/support/ray":function(){define("exports ../../core/arrayUtils ../../core/ObjectStack ../../chunks/vec3 ../../chunks/vec3f64 ./vectorStacks".split(" "),
function(b,a,c,d,f,n){function k(l){return l?g(f.clone(l.origin),f.clone(l.direction)):g(f.create(),f.create())}function g(l,w){return{origin:l,direction:w}}function q(l,w,v=k()){d.copy(v.origin,l);d.copy(v.direction,w);return v}function e(l,w){l=d.cross(n.sv3d.get(),d.normalize(n.sv3d.get(),l.direction),d.subtract(n.sv3d.get(),w,l.origin));return d.dot(l,l)}const m=new c.ObjectStack(()=>k());b.closestPoint=function(l,w,v){w=d.dot(l.direction,d.subtract(v,w,l.origin));d.add(v,l.origin,d.scale(v,l.direction,
w));return v};b.copy=function(l,w=k()){return q(l.origin,l.direction,w)};b.create=k;b.distance=function(l,w){return Math.sqrt(e(l,w))};b.distance2=e;b.equals=function(l,w){return a.equals(l.origin,w.origin)&&a.equals(l.direction,w.direction)};b.fromPoints=function(l,w,v=k()){d.copy(v.origin,l);d.subtract(v.direction,w,l);return v};b.fromValues=q;b.wrap=function(l,w){const v=m.get();v.origin=l;v.direction=w;return v};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/vector":function(){define(["exports",
"../../core/mathUtils","../../chunks/vec3","../../chunks/vec3f64"],function(b,a,c,d){const f=d.create(),n=d.create();b.angle=function(k,g){k=c.dot(k,g)/(c.length(k)*c.length(g));return-a.acosClamped(k)};b.angleAroundAxis=function(k,g,q){c.normalize(f,k);c.normalize(n,g);k=c.dot(f,n);k=a.acosClamped(k);g=c.cross(f,f,n);return 0>c.dot(g,q)?2*Math.PI-k:k};b.projectPoint=function(k,g,q){g=c.dot(k,g)/c.dot(k,k);return c.scale(q,k,g)};b.projectPointSignedLength=function(k,g){return c.dot(k,g)/c.length(k)};
Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/mathUtils":function(){define(["exports","../../../core/mathUtils","../../../chunks/vec3","../../../chunks/vec3f64"],function(b,a,c,d){const f=d.create(),n=d.create(),k=d.create(),g=d.create(),q=d.create();b.angle=function(e,m,l){e=c.normalize(g,e);m=c.normalize(q,m);const w=a.acosClamped(c.dot(e,m));return l&&(e=c.cross(k,e,m),0>c.dot(e,l))?-w:w};b.bilerp=function(e,m,l,w,v,x){e+=(m-e)*v;return e+(l+(w-l)*v-e)*
x};b.cosCapped=function(e,m){return e>m?Math.cos(m):Math.cos(e)};b.fovx2fovy=function(e,m,l){return 2*Math.atan(l*Math.tan(.5*e)/m)};b.fovy2fovx=function(e,m,l){return 2*Math.atan(m*Math.tan(.5*e)/l)};b.makeOrthonormal=function(e,m,l){l=l||e;const w=c.dot(e,m);c.set(l,e[0]-w*m[0],e[1]-w*m[1],e[2]-w*m[2]);c.normalize(l,l)};b.makePiecewiseLinearFunction=function(e){const m=e.length;return l=>{if(l<=e[0][0])return e[0][1];if(l>=e[m-1][0])return e[m-1][1];let w=1;for(;l>e[w][0];)w++;const v=e[w][0];l=
(v-l)/(v-e[w-1][0]);return l*e[w-1][1]+(1-l)*e[w][1]}};b.maxScale=function(e){return Math.sqrt(Math.max(e[0]*e[0]+e[4]*e[4]+e[8]*e[8],e[1]*e[1]+e[5]*e[5]+e[9]*e[9],e[2]*e[2]+e[6]*e[6]+e[10]*e[10]))};b.planeFromPoints=function(e,m,l,w){c.subtract(f,m,e);c.subtract(n,l,e);c.cross(w,f,n);c.normalize(w,w);w[3]=-c.dot(e,w)};b.scaleFromMatrix=function(e,m){c.set(e,Math.sqrt(m[0]*m[0]+m[4]*m[4]+m[8]*m[8]),Math.sqrt(m[1]*m[1]+m[5]*m[5]+m[9]*m[9]),Math.sqrt(m[2]*m[2]+m[6]*m[6]+m[10]*m[10]));return e};b.slerp=
function(e,m,l,w=d.create()){const v=c.length(e);var x=c.length(m),p=c.dot(e,m)/(v*x);if(.9999999999999999>p){p=Math.acos(p);const h=((1-l)*v+l*x)/Math.sin(p);x=h/x*Math.sin(l*p);c.scale(g,e,h/v*Math.sin((1-l)*p));c.scale(q,m,x);return c.add(w,g,q)}return c.lerp(w,e,m,l)};b.slerpTangent=function(e,m,l,w=d.create(),v=d.create()){const x=c.length(e),p=c.length(m);var h=c.dot(e,m)/(x*p);if(.9999999999999999>h){h=Math.acos(h);const t=Math.sin(h),r=Math.sin(l*h),u=Math.sin((1-l)*h),y=(1-l)*x+l*p,z=y/t,
A=z/p*r;c.scale(g,e,z/x*u);c.scale(q,m,A);c.add(w,g,q);c.scale(g,e,1/x*(-Math.cos((1-l)*h)*h*y+u*(-x+p)));c.scale(q,m,1/p*(Math.cos(l*h)*h*y+r*(-x+p)));c.add(v,g,q);c.scale(v,v,1/t);return v}c.lerp(w,e,m,l);c.subtract(v,m,e);c.normalize(v,v);return v};b.tangentFrame=function(e,m,l){Math.abs(e[0])>Math.abs(e[1])?c.set(m,0,1,0):c.set(m,1,0,0);c.cross(l,e,m);c.normalize(m,m);c.cross(m,l,e);c.normalize(l,l)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/coordinateSystem":function(){define("exports ../../chunks/mat4 ../../chunks/vec3 ../../chunks/vec3f64 ../ellipsoidUtils ../SpatialReference ../spatialReferenceEllipsoidUtils ./Axis ../../chunks/boundedPlane ../../chunks/sphere".split(" "),
function(b,a,c,d,f,n,k,g,q,e){function m(t){return{operations:t,value:t.create()}}function l(t,r,u=m(t)){u.operations=t;t.copy(r,u.value);return u}function w(t,r,u,y){return t.operations.setAltitudeAt(t.value,r,u,y)}const v=2**50,x=d.create(),p={operations:null,value:null},h=d.create();b.altitudeAt=function(t,r){return t.operations.altitudeAt(t.value,r)};b.axisAt=function(t,r,u,y){return t.operations.axisAt(t.value,r,u,y)};b.closestPoint=function(t,r,u){return t.operations.closestPoint(t.value,r,
u)};b.closestPointOnSilhouette=function(t,r,u){return t.operations.closestPointOnSilhouette(t.value,r,u)};b.coordinateSystemFromOneAxisAndNormalVector=function(t,r,u,y,z){c.copy(u,t);c.copy(h,r);c.normalize(h,h);c.cross(y,h,u);c.cross(z,y,u)};b.create=function(t){const {value:r,operations:u}=t;return{operations:u,value:u.create(r)}};b.createFromOperations=m;b.createGlobal=function(t){return l(e.sphere,e.fromValues(0,0,0,f.getReferenceEllipsoid(t).radius))};b.createLocal=function(){return l(q.boundedPlane,
q.fromValues([0,0,0],[v,0,0],[0,v,0]))};b.distanceToSilhouette=function(t,r){return t.operations.distanceToSilhouette(t.value,r)};b.elevate=function(t,r,u){return t.operations.elevate(t.value,r,u.value)};b.fromValues=l;b.intersectRay=function(t,r,u){return t.operations.intersectRay(t.value,r,u)};b.intersectRayClosestSilhouette=function(t,r,u){return t.operations.intersectRayClosestSilhouette(t.value,r,u)};b.intersectsRay=function(t,r){return t.operations.intersectRay(t.value,r,null)};b.normalAt=function(t,
r,u){return t.operations.axisAt(t.value,r,g.Axis.Z,u)};b.renderSRFromViewSR=function(t,r){return t?k.getSphericalPCPF(r):r.isGeographic?n.PlateCarree:r};b.setAltitudeAt=w;b.setAltitudeOfTransformation=function(t,r,u,y){r!==y&&a.copy(y,r);c.set(x,y[12],y[13],y[14]);w(t,x,u,x);y[12]=x[0];y[13]=x[1];y[14]=x[2];return y};b.setExtent=function(t,r,u){t.operations.setExtent(t.value,r,u.value);return u};b.vectorCoordinates=function(t,r,u,y,z){z[0]=c.dot(t,r);z[1]=c.dot(t,u);z[2]=c.dot(t,y);return z};b.wrap=
function(t,r){p.operations=t;p.value=r;return p};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/spatialReferenceEllipsoidUtils":function(){define(["exports","./ellipsoidUtils","./SpatialReference","./support/spatialReferenceUtils"],function(b,a,c,d){const f=new c(a.SphericalECEFSpatialReferenceLike),n=new c(a.SphericalPCPFMarsLike),k=new c(a.SphericalPCPFMoonLike);a=new c(a.WGS84ECEFSpatialReferenceLike);b.SphericalECEFSpatialReference=f;b.SphericalPCPFMars=n;b.SphericalPCPFMoon=
k;b.WGS84ECEFSpatialReference=a;b.getSphericalPCPF=function(g){return g&&(d.isMars(g)||d.equals(g,n))?n:g&&(d.isMoon(g)||d.equals(g,k))?k:f};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/scaleUtils":function(){define(["exports","../../core/mathUtils","../../core/unitUtils"],function(b,a,c){function d(f,n){n=c.getMetersPerUnitForSR(n);return f/(n*c.inchesPerMeter*96)}b.getExtentForScale=function(f,n){const k=f.extent;f=f.width-(f.padding?f.padding.left+f.padding.right:
0);n=d(n,k.spatialReference);return k.clone().expand(n*f/k.width)};b.getResolutionForScale=d;b.getResolutionInMetersForScale=function(f){return f/(96*c.inchesPerMeter)};b.getScale=function(f,n){n=n||f.extent;f=f.width;const k=c.getMetersPerUnitForSR(n?.spatialReference);return n&&f?n.width/f*k*c.inchesPerMeter*96:0};b.getScaleForResolution=function(f,n){n=c.getMetersPerUnitForSR(n);return f*n*c.inchesPerMeter*96};b.isInScaleRange=function(f,n,k){if(n=0===n||a.floatEqualAbsolute(f,n)||f<n)n=0===k||
a.floatEqualAbsolute(f,k)||f>k;return n};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/LayerConstants":function(){define(["exports"],function(b){b.fallbackObjectIDAttribute="OBJECTID";Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/BreakpointsOwner":function(){define("exports ../chunks/tslib.es6 ../core/ArrayPool ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass".split(" "),
function(b,a,c,d,f,n,k,g,q){function e(w,v){return v?m[w].valueToClassName[v].split(" "):[]}const m={widthBreakpoint:{getValue(w){const v=w.viewSize[0];w=w.breakpoints;const x=this.values;return v<=w.xsmall?x.xsmall:v<=w.small?x.small:v<=w.medium?x.medium:v<=w.large?x.large:x.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",
small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",
xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(w){const v=w.viewSize[1];w=w.breakpoints;const x=this.values;return v<=w.xsmall?x.xsmall:v<=w.small?x.small:v<=w.medium?x.medium:v<=w.large?x.large:x.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",
small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",
xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(w){w=w.viewSize;const v=this.values;return w[1]>=w[0]?v.portrait:v.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},l={xsmall:544,small:768,medium:992,large:1200};b.BreakpointsOwner=
w=>{w=class extends w{constructor(...v){super(...v);this.heightBreakpoint=this.widthBreakpoint=this.orientation=null;this.breakpoints=l}initialize(){this.addHandles(d.watch(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),d.initial))}destroy(){this.destroyed||this._removeActiveClassNames()}set breakpoints(v){var x=this._get("breakpoints");if(v!==x){x=(x=v)&&x.xsmall<x.small&&x.small<x.medium&&x.medium<x.large;if(!x){const p=JSON.stringify(l,null,2);console.warn("provided breakpoints are not valid, using defaults:"+
p)}v=x?v:l;this._set("breakpoints",{...v})}}_updateClassNames(){if(this.container){var v=c.acquire(),x=c.acquire(),p=!1,h;for(h in m){const t=this[h],r=m[h].getValue({viewSize:this.size,breakpoints:this.breakpoints});t!==r&&(p=!0,this[h]=r,e(h,t).forEach(u=>x.push(u)),e(h,r).forEach(u=>v.push(u)))}p&&(this._applyClassNameChanges(v,x),c.release(v),c.release(x))}}_applyClassNameChanges(v,x){const p=this.container;p&&(x.forEach(h=>p.classList.remove(h)),v.forEach(h=>p.classList.add(h)))}_removeActiveClassNames(){const v=
this.container;if(v)for(var x in m)e(x,this[x]).forEach(p=>v.classList.remove(p))}};a.__decorate([f.property()],w.prototype,"breakpoints",null);a.__decorate([f.property()],w.prototype,"orientation",void 0);a.__decorate([f.property()],w.prototype,"widthBreakpoint",void 0);a.__decorate([f.property()],w.prototype,"heightBreakpoint",void 0);return w=a.__decorate([q.subclass("esri.views.BreakpointsOwner")],w)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/DOMContainer":function(){define("exports ../chunks/tslib.es6 ../intl ../core/domUtils ../core/events ../core/has ../core/Logger ../core/maybe ../core/reactiveUtils ../core/scheduling ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/accessorSupport/decorators/subclass ./overlay/ViewOverlay ../intl/locale ../intl/messages".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h){function t(u){u&&(d.empty(u),u.parentNode&&u.parentNode.removeChild(u))}const r=[0,0];b.DOMContainer=u=>{u=class extends u{constructor(...y){super(...y);this._freqInfo={freq:16,time:750};this._overlayRenderTaskHandle=null;this.height=0;this.position=this.overlay=this.messagesCommon=null;this.resizing=!1;this.surface=this.root=null;this.suspended=!0;this.userContent=this.ui=null;this.width=0;this.widthBreakpoint=null;this.addHandles([q.watch(()=>this.cursor,
z=>{const {surface:A}=this;A&&A.setAttribute("data-cursor",z)}),q.watch(()=>this.navigating,z=>{const {surface:A}=this;A&&A.setAttribute("data-navigating",z.toString())})])}initialize(){const y=n("mac"),z=async()=>{y&&(await q.whenOnce(()=>this.ready),this.messagesCommon=await h.fetchMessageBundle("esri/t9n/common").catch(()=>{}))};z();this.addHandles([q.watch(()=>this.ui,(A,C)=>this._handleUIChange(A,C),q.initial),this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused")),
p.onLocaleChange(z)])}destroy(){this.destroyed||(this.ui=g.destroyMaybe(this.ui),this.container=null)}get container(){return this._get("container")??null}set container(y){var z=this._get("container");const A=d.byId(y);A||"string"!==typeof y||k.getLogger(this).error("#container",`element with id '${y}' not found`);if(z!==A)if(this._stopMeasuring(),z&&(z.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&
(this.overlay.destroy(),this._set("overlay",null)),this.root&&(t(this.root),this._set("root",null)),this.userContent&&(d.reparent(this.userContent,z),t(this.userContent),this._set("userContent",null))),A){A.classList.add("esri-view");y=document.createElement("div");y.className="esri-view-user-storage";d.reparent(A,y);A.appendChild(y);this._set("userContent",y);y=document.createElement("div");y.className="esri-view-root";A.insertBefore(y,A.firstChild);this._set("root",y);z=document.createElement("div");
z.className="esri-view-surface";z.setAttribute("role","application");z.tabIndex=0;y.appendChild(z);this._set("surface",z);var C=new x;y.appendChild(C.surface);this._set("overlay",C);this.addHandles(q.watch(()=>C.needsRender,E=>{this._overlayRenderTaskHandle=E&&!this._overlayRenderTaskHandle?e.addFrameTask({render:()=>this.overlay?.render()}):g.removeMaybe(this._overlayRenderTaskHandle)}));this.forceDOMReadyCycle();this._set("container",A);this._startMeasuring()}else this._set("width",0),this._set("height",
0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),this._set("container",null)}get focused(){const y=document.activeElement===this.surface;return document.hasFocus()&&y}get size(){return[this.width,this.height]}blur(){this.surface?.blur()}focus(){this.surface?.focus()}pageToContainer(y,z,A){const C=this.position;y-=C?C[0]:0;z-=C?C[1]:0;A?(A[0]=y,A[1]=z):A=[y,z];return A}containerToPage(y,z,A){const C=this.position;y+=C?C[0]:0;z+=C?C[1]:0;A?(A[0]=y,A[1]=z):A=[y,z];return A}_handleUIChange(y,
z){this.removeHandles("ui");z&&z!==y&&z.destroy();y&&(y.view=this,this.addHandles(q.watch(()=>this.root,A=>{if(A){const C=document.createElement("div");A.appendChild(C);A=C}else A=null;y.container=A},q.initial),"ui"));this._set("ui",y)}_stopMeasuring(){this.removeHandles("measuring");this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const y=this._freqInfo;y.freq=16;y.time=750;this.addHandles([f.on(window,"resize",()=>{y.freq=16;y.time=750}),e.addFrameTask({prepare:z=>{const A=this._measure(),
C=this._freqInfo;C.time+=z.deltaTime;A&&(C.freq=16,this._get("resizing")||this._set("resizing",!0));C.time<C.freq||(C.time=0,this._position()||A?C.freq=16:C.freq=Math.min(750,2*C.freq),!A&&512<=C.freq&&this._get("resizing")&&this._set("resizing",!1))}})],"measuring");this._measure();this._position()}_measure(){var y=this.container;const z=y?y.clientWidth:0;y=y?y.clientHeight:0;if(0===z||0===y)return this.suspended||this._set("suspended",!0),!1;const A=this.width,C=this.height;if(z===A&&y===C)return this.suspended&&
this._set("suspended",!1),!1;this._set("width",z);this._set("height",y);this.suspended&&this._set("suspended",!1);this.emit("resize",{oldWidth:A,oldHeight:C,width:z,height:y});return!0}_position(){var y=this.container;const z=this.position;var A;if(A=y)A=(y.ownerDocument||window.document).defaultView,y=y.getBoundingClientRect(),r[0]=y.left+(A?.pageXOffset??0),r[1]=y.top+(A?.pageYOffset??0),A=r;y=A;return y?z&&y[0]===z[0]&&y[1]===z[1]?!1:(this._set("position",[y[0],y[1]]),!0):!1}forceDOMReadyCycle(){}};
a.__decorate([m.property()],u.prototype,"container",null);a.__decorate([m.property({readOnly:!0})],u.prototype,"focused",null);a.__decorate([m.property({readOnly:!0})],u.prototype,"height",void 0);a.__decorate([m.property()],u.prototype,"messagesCommon",void 0);a.__decorate([m.property({type:x})],u.prototype,"overlay",void 0);a.__decorate([m.property({readOnly:!0})],u.prototype,"position",void 0);a.__decorate([m.property({readOnly:!0})],u.prototype,"resizing",void 0);a.__decorate([m.property({readOnly:!0})],
u.prototype,"root",void 0);a.__decorate([m.property({value:null,readOnly:!0})],u.prototype,"size",null);a.__decorate([m.property({readOnly:!0})],u.prototype,"surface",void 0);a.__decorate([m.property({readOnly:!0})],u.prototype,"suspended",void 0);a.__decorate([m.property()],u.prototype,"ui",void 0);a.__decorate([m.property({readOnly:!0})],u.prototype,"userContent",void 0);a.__decorate([m.property({readOnly:!0})],u.prototype,"width",void 0);a.__decorate([m.property()],u.prototype,"widthBreakpoint",
void 0);return u=a.__decorate([v.subclass("esri.views.DOMContainer")],u)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/overlay/ViewOverlay":function(){define("../../chunks/tslib.es6 ../../core/Accessor ../../core/Collection ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../core/support/UpdatingHandles ../../libs/maquette/projection ../../libs/maquette/projector".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m){a=class extends a{constructor(){super(...arguments);this.items=new c;this._watchUpdatingTracking=new q.UpdatingHandles;this._callbacks=new Map;this._projector=m.createProjector();this._hiddenProjector=m.createProjector()}get needsRender(){return 0<this.items.length}get updating(){return this._watchUpdatingTracking?.updating??!1}initialize(){const l=document.createElement("div");l.className="esri-overlay-surface";this._set("surface",l);this._hiddenSurface=document.createElement("div");
this._hiddenSurface.setAttribute("style","visibility: hidden;");l.appendChild(this._hiddenSurface);this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,w=>{for(const v of w.added){const x=()=>v.render();this._callbacks.set(v,x);this._projector.append(this.surface,x)}for(const v of w.removed)w=this._projector.detach(this._callbacks.get(v)),this.surface.removeChild(w.domNode),this._callbacks.delete(v)})}addItem(l){this.items.add(l)}removeItem(l){this.items.remove(l)}destroy(){this.items.removeAll();
this._callbacks.forEach(l=>this._projector.detach(l));this._projector=this._callbacks=null;this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(l){const w=this._hiddenSurface,v=this._hiddenProjector;let x;const p=()=>x=l.render();v.append(w,p);v.renderNow();const h={left:0,top:0,right:0,bottom:0};if(x?.domNode){const t=x.domNode.getBoundingClientRect();h.left=t.left;h.top=t.top;h.right=t.right;h.bottom=t.bottom}for(v.detach(p);w.firstChild;)w.removeChild(w.firstChild);
return h}overlaps(l,w){l=this.computeBoundingRect(l);w=this.computeBoundingRect(w);return Math.max(l.left,w.left)<=Math.min(l.right,w.right)&&Math.max(l.top,w.top)<=Math.min(l.bottom,w.bottom)}get hasVisibleItems(){return this.items.some(l=>l.visible)}async prepare(){await document.fonts.load(this._fontString()).catch(()=>{})}renderCanvas(l,w){const v=!!w?.disableDecorations;if(this.items.some(p=>p.visible&&!(v&&p.isDecoration))){var x=l.getContext("2d");x.save();x.font=this._fontString();this.items.forEach(p=>
{v&&p.isDecoration||(x.save(),p.renderCanvas(x),x.restore())});x.restore()}}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};b.__decorate([d.property({readOnly:!0})],a.prototype,"surface",void 0);b.__decorate([d.property({readOnly:!0})],a.prototype,"items",void 0);b.__decorate([d.property({readOnly:!0})],a.prototype,"needsRender",null);b.__decorate([d.property({readOnly:!0})],a.prototype,"_watchUpdatingTracking",void 0);b.__decorate([d.property({readOnly:!0})],a.prototype,
"updating",null);return a=b.__decorate([g.subclass("esri.views.overlay.ViewOverlay")],a)})},"esri/views/GroundView":function(){define("../chunks/tslib.es6 ../core/Accessor ../core/Collection ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ./3d/support/cameraUtils ./support/GroundViewElevationSampler".split(" "),function(b,a,c,d,f,n,k,g,q,e,m){a=class extends a{constructor(l){super(l);
this.view=null;this.layerViews=new c}initialize(){this.addHandles(d.when(()=>this.view?.map?.ground,l=>l.load()));this.addHandles(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))}destroy(){this._set("view",null);for(const l of this.layerViews)l.destroy();this.layerViews.length=0}get elevationSampler(){return this.view&&"2d"!==this.view.type&&this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new m({view:this.view}):null}get extent(){const l=this.view;
return l&&"2d"!==l.type&&l.ready?e.toExtent(l,l.state.camera,l.pointsOfInterest.centerOnSurfaceFrequent.renderLocation):null}get updating(){return this.suspended?!1:this.layerViews.some(l=>l.updating)}get suspended(){return!this.view||this.view.suspended}_layerViewsAfterChangesHandler(){this.removeHandles("updating");this.addHandles(this.layerViews.map(l=>d.watch(()=>l.updating,()=>this._updateUpdating(),d.sync)).toArray(),"updating");this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};
b.__decorate([f.property({readOnly:!0})],a.prototype,"elevationSampler",null);b.__decorate([f.property({readOnly:!0})],a.prototype,"extent",null);b.__decorate([f.property({type:Boolean,readOnly:!0})],a.prototype,"updating",null);b.__decorate([f.property({constructOnly:!0})],a.prototype,"view",void 0);b.__decorate([f.property({type:c,readOnly:!0})],a.prototype,"layerViews",void 0);b.__decorate([f.property({readOnly:!0})],a.prototype,"suspended",null);return a=b.__decorate([q.subclass("esri.views.GroundView")],
a)})},"esri/views/3d/support/cameraUtils":function(){define("exports ../../../Camera ../../../core/Cyclical ../../../core/Logger ../../../core/mathUtils ../../../core/promiseUtils ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/ellipsoidUtils ../../../geometry/Point ../../../geometry/projection ../../../geometry/SpatialReference ../../../geometry/projection/projectPointToVector ../../../geometry/projection/projectPointToVectorWithEngine ../../../geometry/projection/projectVectorToPoint ../../../geometry/projection/projectVectorToPointWithEngine ../../../geometry/projection/projectVectorToVector ../../ViewingMode ../camera/intersectionUtils ../../../chunks/cameraUtilsPlanar ../../../chunks/cameraUtilsSpherical ./earthUtils ./ElevationProvider ../../support/spatialReferenceSupport".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A,C){function E(ha){return ha.spatialReference??l.WGS84}function B(ha){return"global"===ha.viewingMode?y.cameraUtilsSpherical:u.cameraUtilsPlanar}function D(ha,ba,ea){const ca=ha.state.camera,ia=ca.width/2/ca.pixelRatio;ha.renderCoordsHelper.viewingMode===t.ViewingMode.Global&&null!=ea&&(ba*=Math.cos(f.deg2rad(ea)));ba/=ha.renderCoordsHelper.unitInMeters;return ia/(96*39.37/ba)/Math.tan(ca.fovX/2)}function F(ha,ba,ea){const ca=ha.state.camera;ba=
96*39.37/(ca.width/2/ca.pixelRatio/(ba*Math.tan(ca.fovX/2)));ha.renderCoordsHelper.viewingMode===t.ViewingMode.Global&&null!=ea&&(ba/=Math.cos(f.deg2rad(ea)));return ba*ha.renderCoordsHelper.unitInMeters}async function K(ha,ba,ea,ca,ia,la){ba=await X(ha,ca.heading,ca.tilt,ba,ea,ia,la);n.throwIfAborted(la);return Q(ha,ba,ca.fov,la)}function L(ha,ba,ea,ca,ia){return B(ha).directionToHeadingTilt(ba,ea,ca,ia)}function G(ha,ba){return!!(ha.basemapTerrain&&ha.renderCoordsHelper.fromRenderCoords(ba,Z,ha.spatialReference)&&
ha.elevationProvider&&(A.getElevationAtPoint(ha.elevationProvider,Z)??0)>Z[2]-1)}async function O(ha,ba,ea){if(G(ha,ba))return!0;const {elevationProvider:ca,spatialReference:ia,renderCoordsHelper:la}=ha;if(null==ca||!la.fromRenderCoords(ba,Z,ia))return!1;const [oa,na,ra]=Z;ha=await ca.queryElevation(oa,na,ra,ia,"ground",ea)??0;n.throwIfAborted(ea);return ha>ra-1}async function P(ha,ba,ea){const ca=g.create();if(null==ba)return k.copy(ca,ha.state.camera.center);if(ba instanceof e){const {renderSpatialReference:ia,
basemapTerrain:la,elevationProvider:oa}=ha,na=ba.spatialReference;await v.projectPointToVectorWithEngine(ba,ca,ia,0,{signal:ea});n.throwIfAborted(ea);null==ba.z&&null!=la&&null!=oa&&(ba=await oa.queryElevation(ba.x,ba.y,ba.z??0,na,"ground",ea),n.throwIfAborted(ea),null!=ba&&ha.renderCoordsHelper.setAltitude(ca,ba));return ca}return k.copy(ca,ba)}function J(ha,ba){const ea=g.create();if(null==ba)return k.copy(ea,ha.state.camera.center);if(ba instanceof e){if(!w.projectPointToVector(ba,ea,ha.renderSpatialReference))return null;
const {basemapTerrain:ca,elevationProvider:ia}=ha;null==ba.z&&null!=ca&&null!=ia&&(ba=A.getElevationAtPoint(ia,ba),null!=ba&&ha.renderCoordsHelper.setAltitude(ea,ba));return ea}return k.copy(ea,ba)}function R(ha,ba,ea,ca,ia,la){const oa=ca instanceof e?ca:null;ca=J(ha,ca);return U(ha,ba,ea,oa,ca,ia,la)}async function X(ha,ba,ea,ca,ia,la,oa){const na=ca instanceof e?ca:null;ca=await P(ha,ca,oa);n.throwIfAborted(oa);return M(ha,ba,ea,na,ca,ia,la,oa)}function U(ha,ba,ea,ca,ia,la,oa){if(null==ia)return null;
ca??(ca=x.projectVectorToPoint(ia,ha.renderSpatialReference,E(ha)));if(null==ca)return null;const na=V(ha,ba,ea,ia,la,oa);if(Y(ha,ea,oa)&&G(ha,na.eye)){const {tilt:ra,mode:ta}=W(ha,ea,ia,la);return U(ha,ba,ra,ca,ia,la,ta)}return{...na,center:g.clone(ia)}}async function M(ha,ba,ea,ca,ia,la,oa,na){ca??(ca=await p.projectVectorToPointWithEngine(ia,ha.renderSpatialReference,E(ha),{signal:na}));n.throwIfAborted(na);const ra=V(ha,ba,ea,ia,la,oa);if(Y(ha,ea,oa)&&await O(ha,ra.eye,na)){n.throwIfAborted(na);
const {tilt:ta,mode:ma}=W(ha,ea,ia,la);return M(ha,ba,ta,ca,ia,la,ma,na)}return{...ra,center:g.clone(ia)}}function V(ha,ba,ea,ca,ia,la){ia=Math.max(ia,ha.state.constraints.minimumPoiDistance);var oa=ea;ea=ia;var na=0;if(la=la===b.OrientationMode.ADJUST)if(na=ha.pointsOfInterest.centerOnSurfaceFrequent.distance,8<Math.log(ea/na)/Math.LN2)la=!0;else{var ra=ha.renderSpatialReference,ta=E(ha);la=x.projectVectorToPoint(ca,ra,ta);ra=x.projectVectorToPoint(ha.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,
ra,ta);null==la||null==ra?la=!1:(na*=Math.tan(.5*ha.state.camera.fov),la=5<ra.distance(la)/na)}la?(ba=0,oa=B(ha).eyeTiltToLookAtTilt(oa,ca,ea),ha.state.constraints.tilt?(la=ha.state.constraints.tilt(ea),la.max=Math.min(la.max,.5*Math.PI),na=Math.min(oa,la.min*(1-.7)+.7*la.max)):na=oa):na=B(ha).eyeTiltToLookAtTilt(oa,ca,ea);oa=na=ha.state.constraints.clampTilt(ea,na);ea=oa=B(ha).lookAtTiltToEyeTilt(oa,ca,ea);ha=B(ha).eyeForCenterWithHeadingTilt;return ha(ca,ia,ba,ea)}function Y(ha,ba,ea){const ca=
ha.map.ground.navigationConstraint;return ea===b.OrientationMode.ADJUST&&"global"===ha.viewingMode&&0<ba&&(null==ca||"stay-above"===ca.type)}function W(ha,ba,ea,ca){{let la=B(ha).eyeTiltToLookAtTilt(ba,ea,ca);if(ha.state.constraints.tilt){var ia=ha.state.constraints.tilt(ca);la=Math.min(la,.5*Math.PI);ia=ia.min*(1-.7)+.7*la}else ia=la}ha=B(ha).lookAtTiltToEyeTilt(ia,ea,ca);return{tilt:ha,mode:1>ba-ha?b.OrientationMode.LOCKED:b.OrientationMode.ADJUST}}function H(ha,ba){const {state:ea,spatialReference:ca}=
ha;ha=ba.spatialReference;return ea.isGlobal&&C.isSpatialReferenceSupported(ha,t.ViewingMode.Global)||ea.isLocal&&ca.equals(ha)}function S(ha,ba){let ea;if(ha.state.isGlobal){const la=new e(ba.xmin,ba.ymin,ba.spatialReference),oa=new e(ba.xmax,ba.ymax,ba.spatialReference),na=ba.spatialReference.isGeographic?fa:da;var ca=new e({x:na.center(la.x,oa.x),y:(oa.y+la.y)/2,z:null!=ba.zmax&&null!=ba.zmin?(ba.zmax+ba.zmin)/2:void 0,spatialReference:ba.spatialReference});const ra=q.getReferenceEllipsoid(ba.spatialReference);
var ia=z.getGreatCircleSpanAt(ca,la,oa);ea=ia.lon;ia=ia.lat;na.diff(la.x,oa.x)>na.range/2&&(ea+=ra.halfCircumference);ea=Math.min(ea,ra.halfCircumference);ia=Math.min(ia,ra.halfCircumference)}else ca=ha.renderSpatialReference??ba.spatialReference,ca.equals(ba.spatialReference)||(ba=m.project(ba,ca)),ea=ba.xmax-ba.xmin,ia=ba.ymax-ba.ymin,ca=new e({x:ba.xmin+.5*ea,y:ba.ymin+.5*ia,z:null!=ba.zmax&&null!=ba.zmin?(ba.zmax+ba.zmin)/2:void 0,spatialReference:ca});ha=ha.state.camera;return{center:ca,distance:Math.max(1/
Math.tan(ha.fovX/2)*ea*.5,1/Math.tan(ha.fovY/2)*ia*.5,1/Math.tan(ha.fov/2)*(null!=ba.zmax&&null!=ba.zmin?ba.zmax-ba.zmin:0)*.5)/1}}function I(ha,ba,ea,ca){if(null==ba)return null;ha=x.projectVectorToPoint(ba.eye,ha.renderSpatialReference,E(ha));if(null==ha)return null;ca??(ca=new a);ca.position=ha;ca.heading=ba.heading;ca.tilt=ba.tilt;ca.fov=ea;return ca}async function Q(ha,ba,ea,ca){ha=await p.projectVectorToPointWithEngine(ba.eye,ha.renderSpatialReference,E(ha),{signal:ca});n.throwIfAborted(ca);
return new a(ha,ba.heading,ba.tilt,ea)}const N=d.getLogger("esri.views.3d.support.cameraUtils"),T=g.create(),aa={heading:0,tilt:0},Z=g.create(),da=new c.Cyclical(-2.0037508342788905E7,2.0037508342788905E7),fa=new c.Cyclical(-180,180);b.OrientationMode=void 0;(function(ha){ha[ha.LOCKED=0]="LOCKED";ha[ha.ADJUST=1]="ADJUST"})(b.OrientationMode||(b.OrientationMode={}));const ka=g.create();b.computeScale=function(ha,ba){h.projectVectorToVector(ba.center,ha.renderSpatialReference,T,l.WGS84);return F(ha,
ba.distance,T[1])};b.directionToHeadingTilt=L;b.distanceToScale=F;b.externalToInternal=function(ha,ba){if(null==ba)return null;var ea=ha.renderSpatialReference;const ca=B(ha).headingTiltToDirectionUp,ia=g.create();if(!w.projectPointToVector(ba.position,ia,ea))return null;ea=ca(ia,ba.heading,ba.tilt);k.scale(ea.direction,ea.direction,ha.state.camera.distance);k.add(ea.direction,ea.direction,ia);ha=r.cameraOnContentAlongViewDirection(ha,ia,ea.direction,ea.up);ha.fov=f.deg2rad(ba.fov);return ha};b.fromCenterDistanceAsync=
K;b.fromCenterDistanceSync=function(ha,ba,ea,ca,ia,la){ba=R(ha,ca.heading,ca.tilt,ba,ea,ia);return I(ha,ba,ca.fov,la)};b.fromCenterScale=async function(ha,ba,ea,ca,ia,la){ea=D(ha,ea,ba.latitude);return K(ha,ba,ea,ca,ia,la)};b.fromExtentAsync=async function(ha,ba,ea,ca,ia,la){ba=H(ha,ba)?ba:await m.projectWithZConversion(ba,ha.spatialReference,{signal:la});n.throwIfAborted(la);const {center:oa,distance:na}=S(ha,ba);ea=await X(ha,ea,ca,oa,na,ia,la);n.throwIfAborted(la);return Q(ha,ea,ha.camera.fov,
la)};b.fromExtentSync=function(ha,ba,ea,ca,ia,la){let oa;try{oa=H(ha,ba)?ba:m.project(ba,ha.spatialReference)}catch(ta){return null}const {center:na,distance:ra}=S(ha,oa);ba=R(ha,ea,ca,na,ra,ia);return null==ba?null:I(ha,ba,ha.camera.fov,la)};b.getObserverForPointAtDistanceAsync=X;b.getObserverForPointAtDistanceSync=R;b.getViewSR=E;b.headingTiltToDirectionUp=function(ha,ba,ea,ca,ia){return B(ha).headingTiltToDirectionUp(ba,ea,ca,ia)};b.internalToExternal=function(ha,ba,ea){const ca=ha.renderSpatialReference,
ia=L(ha,ba.eye,ba.viewForward,ba.up,aa);ha=E(ha);h.projectVectorToVector(ba.eye,ca,ka,ha)||(ha=l.WGS84,h.projectVectorToVector(ba.eye,ca,ka,ha));if(null==ea)return new a(new e(ka,ha),ia.heading,ia.tilt,f.rad2deg(ba.fov));ea.position.x=ka[0];ea.position.y=ka[1];ea.position.z=ka[2];ea.position.spatialReference=ha;ea.heading=ia.heading;ea.tilt=ia.tilt;ea.fov=f.rad2deg(ba.fov);return ea};b.scaleToDistance=D;b.scaleToZoom=function(ha,ba){if(ha=ha.basemapTerrain?.tilingScheme)return ha.levelAtScale(ba);
N.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")};b.toExtent=function(ha,ba,ea){const ca=x.projectVectorToPoint(ea,ha.renderSpatialReference,E(ha));if(null==ca)return null;var ia=Math.tan(ba.fovX/2),la=Math.tan(ba.fovY/2);ba=k.dist(ba.eye,ea);ia*=2*ba;la*=2*ba;return"global"===ha.viewingMode?y.toExtent(ha,ca,ia,la):u.toExtent(ha,ca,ia,la)};b.zoomToScale=function(ha,ba){if(ha=ha.basemapTerrain?.tilingScheme)return ha.scaleAtLevel(ba);N.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")};
Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/projectPointToVectorWithEngine":function(){define("exports ../../chunks/vec3f64 ../projection ./projectBuffer ../support/spatialReferenceUtils ../../layers/graphics/dehydratedPoint".split(" "),function(b,a,c,d,f,n){const k=a.create();b.projectPointToVectorWithEngine=async function(g,q,e,m,l){m??(m=0);const w=g.spatialReference;c.canProjectWithoutEngine(w,e)||null==w||null==e||f.equals(w,e)?(k[0]=g.x,k[1]=g.y,
k[2]=g.z??m,d.projectBuffer(k,g.spatialReference,0,q,e,0,1)):(g=n.makeDehydratedPoint(g.x,g.y,g.z??m,w),e=await c.projectWithZConversion(g,e,l),q[0]=e.x,q[1]=e.y,q[2]=e.z??0)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/dehydratedPoint":function(){define(["exports"],function(b){b.makeDehydratedPoint=function(a,c,d,f){return{x:a,y:c,z:d,hasZ:null!=d,hasM:!1,spatialReference:f,type:"point"}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/projectVectorToPoint":function(){define(["exports",
"../../chunks/vec3f64","../Point","./projectBuffer"],function(b,a,c,d){const f=a.create();b.projectVectorToPoint=function(n,k,g){if(null==k||null==g)return null;const q=new c({spatialReference:g});return d.projectBuffer(n,k,0,f,g,0,1)?(q.x=f[0],q.y=f[1],q.z=f[2],q):null};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/projectVectorToPointWithEngine":function(){define(["exports","../Point","../projection","./projectVectorToPoint"],function(b,a,c,d){b.projectVectorToPointWithEngine=
async function(f,n,k,g){const q=d.projectVectorToPoint(f,n,k);if(null!=q)return q;f=new a({x:f[0],y:f[1],z:f[2],spatialReference:n,hasZ:!0});return c.projectWithZConversion(f,k,g)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/intersectionUtils":function(){define("exports ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/ellipsoidUtils ../../../geometry/support/aaBoundingRect ../webgl-engine/lib/Intersector".split(" "),function(b,a,c,d,f,n){function k(v,
x){return v.elevationProvider?v.elevationProvider.getElevation(x[0],x[1],x[2],v.renderCoordsHelper.spatialReference,"ground")??0:0}function g(v,x,p){if(!v.state.isGlobal||!v.stateManager.constraintsManager)return!1;const h=k(v,x);({far:v}=v.stateManager.constraintsManager.nearFarHeuristic.compute(x,p,v.renderDataExtent,h,w));v*=v;return a.squaredDistance(x,p)>v}const q={},e=c.create(),m=c.create(),l=c.create(),w={near:0,far:0};b.cameraOnContentAlongViewDirection=function(v,x,p,h){const t=v.state.camera.clone();
x&&p&&h&&(t.eye=x,t.center=p,t.up=h);x=t.ray;p=q[v.viewingMode];p||(p=n.newIntersector(v.state.viewingMode),p.options.backfacesTerrain=!v.state.isGlobal,p.options.invisibleTerrain=!0,q[v.viewingMode]=p);({isGlobal:h}=v.state);v.sceneIntersectionHelper.intersectRay(x,p,m)&&!g(v,x.origin,m)?x=!0:!v.renderCoordsHelper.intersectManifold(x,0,m)||g(v,x.origin,m)?h?(p=d.getReferenceEllipsoid(v.spatialReference).radius,p=a.dot(x.origin,x.origin)-p*p,a.scale(m,x.direction,(0<p?Math.sqrt(p)/3:1)/a.length(x.direction)),
a.add(m,m,x.origin),x=!0):x=!1:x=!0;x||a.copy(m,t.center);p=v.state.constraints;h=p.minimumPoiDistance;a.squaredDistance(t.eye,m)<h&&(x=p.collision.enabled,a.copy(l,t.viewForward),a.scale(l,l,h),x?t.eye=a.subtract(e,m,l):a.add(m,t.eye,l),v=v.renderCoordsHelper,h=v.getAltitude(t.eye),p=p.collision.elevationMargin,x&&h<p&&(a.subtract(l,m,t.eye),t.eye=v.setAltitude(e,p,t.eye),a.add(m,t.eye,l)));t.center=m;return t};b.eyeWithinExtent=function(v,x,p,h){return null!=v.renderCoordsHelper.fromRenderCoords(x.eye,
e,h)&&f.containsPoint(p,e)};b.surfaceElevationBelowRenderLocation=k;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Intersector":function(){define("exports ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/support/ray ../../../ViewingMode ./IntersectorInterfaces ./IntersectorTarget ./intersectorUtils ./verticalOffsetUtils".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w){class v{constructor(u){this.options=new e.IntersectorOptions;this._results=new x;this.transform=new w.IntersectorTransform;this.tolerance=1E-5;this.verticalOffset=null;this._ray=g.create();this._rayEnd=f.create();this._rayBeginTransformed=f.create();this._rayEndTransformed=f.create();this.viewingMode=null==u?q.ViewingMode.Global:u}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(u,
y,z){this.resetWithRay(g.fromPoints(u,y,this._ray),z)}resetWithRay(u,y){this.camera=y;u!==this._ray&&g.copy(u,this._ray);0!==this.options.verticalOffset?this.viewingMode===q.ViewingMode.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null;d.add(this._rayEnd,this._ray.origin,this._ray.direction);this._results.init(this._ray)}intersect(u=null,y,z,A,C){this.point=y;this.filterPredicate=A;this.tolerance=null==z?1E-5:z;y=w.getVerticalOffsetObject3D(this.verticalOffset);
if(u&&0<u.length){const E=C?B=>{C(B)&&this.intersectObject(B)}:B=>{this.intersectObject(B)};for(const B of u)u=B.getSpatialQueryAccelerator?.(),null!=u?(null!=y?u.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,E,y):u.forEachAlongRay(this._ray.origin,this._ray.direction,E),this.options.selectionMode&&this.options.hud&&u.forEachDegenerateObject(E)):B.objects.forAll(D=>E(D))}this.sortResults()}intersectObject(u){const y=u.geometries;if(y){var z=u.effectiveTransformation,A=w.getVerticalOffsetObject3D(this.verticalOffset);
for(const C of y){if(!C.visible)continue;const {material:E,id:B}=C;this.transform.setAndInvalidateLazyTransforms(z,C.transformation);d.transformMat4(this._rayBeginTransformed,this.rayBegin,this.transform.inverse);d.transformMat4(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const D=this.transform.transform;null!=A&&(A.objectTransform=this.transform);E.intersect(C,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(F,K,L,G,O,P)=>{if(0<=F&&(null==this.filterPredicate||
this.filterPredicate(this._ray.origin,this._rayEnd,F))){var J=G?this._results.hud:this._results,R=G?X=>{const U=new m.HudTarget(u,B,L,P);X.set(e.IntersectorType.HUD,U,F,K,c.IDENTITY,O)}:X=>X.set(e.IntersectorType.OBJECT,{object:u,geometryId:B,triangleNr:L},F,K,D,O);(null==J.min.drapedLayerOrder||O>=J.min.drapedLayerOrder)&&(null==J.min.dist||F<J.min.dist)&&R(J.min);this.options.store!==e.StoreResults.MIN&&(null==J.max.drapedLayerOrder||O<J.max.drapedLayerOrder)&&(null==J.max.dist||F>J.max.dist)&&
R(J.max);this.options.store===e.StoreResults.ALL&&(G?(G=new h(this._ray),R(G),this._results.hud.all.push(G)):(G=new p(this._ray),R(G),this._results.all.push(G)))}})}}}sortResults(u=this._results.all){u.sort((y,z)=>y.dist!==z.dist?(y.dist??0)-(z.dist??0):y.drapedLayerOrder!==z.drapedLayerOrder?(y.drapedLayerOrder??Number.MAX_VALUE)-(z.drapedLayerOrder??Number.MAX_VALUE):(z.drapedLayerGraphicOrder??Number.MIN_VALUE)-(y.drapedLayerGraphicOrder??Number.MIN_VALUE))}}class x{constructor(){this.min=new p(g.create());
this.max=new p(g.create());this.hud={min:new h(g.create()),max:new h(g.create()),all:[]};this.ground=new p(g.create());this.all=[]}init(u){this.min.init(u);this.max.init(u);this.ground.init(u);this.all.length=0;this.hud.min.init(u);this.hud.max.init(u);this.hud.all.length=0}}class p{get ray(){return this._ray}get distanceInRenderSpace(){return null!=this.dist?(d.scale(t,this.ray.direction,this.dist),d.length(t)):null}getIntersectionPoint(u){if(!l.isValidIntersectorResult(this))return!1;d.scale(t,
this.ray.direction,this.dist);d.add(u,this.ray.origin,t);return!0}getTransformedNormal(u){d.copy(r,this.normal);r[3]=0;n.transformMat4(r,r,this.transformation);d.copy(u,r);return d.normalize(u,u)}constructor(u){this.intersector=e.IntersectorType.OBJECT;this.normal=f.create();this.transformation=c.create();this._ray=g.create();this.init(u)}init(u){this.drapedLayerGraphicOrder=this.drapedLayerOrder=this.target=this.dist=null;this.intersector=e.IntersectorType.OBJECT;g.copy(u,this._ray)}set(u,y,z,A,
C,E,B){this.intersector=u;this.dist=z;d.copy(this.normal,A??f.UNIT_Z);a.copy(this.transformation,C??c.IDENTITY);this.target=y;this.drapedLayerOrder=E;this.drapedLayerGraphicOrder=B}copy(u){g.copy(u.ray,this._ray);this.intersector=u.intersector;this.dist=u.dist;this.target=u.target;this.drapedLayerOrder=u.drapedLayerOrder;this.drapedLayerGraphicOrder=u.drapedLayerGraphicOrder;d.copy(this.normal,u.normal);a.copy(this.transformation,u.transformation)}}class h extends p{constructor(){super(...arguments);
this.intersector=e.IntersectorType.HUD}}const t=f.create(),r=k.create();b.defaultTolerance=1E-5;b.newIntersector=function(u){return new v(u)};b.newIntersectorResult=function(u){return new p(u)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/IntersectorInterfaces":function(){define(["exports"],function(b){b.IntersectorType=void 0;(function(c){c[c.OBJECT=0]="OBJECT";c[c.HUD=1]="HUD";c[c.TERRAIN=2]="TERRAIN";c[c.OVERLAY=3]="OVERLAY";c[c.I3S=4]="I3S";c[c.PCL=
5]="PCL";c[c.LOD=6]="LOD";c[c.VOXEL=7]="VOXEL"})(b.IntersectorType||(b.IntersectorType={}));class a{constructor(){this.verticalOffset=0;this.selectionMode=!1;this.selectOpaqueTerrainOnly=this.hud=!0;this.invisibleTerrain=!1;this.backfacesTerrain=!0;this.isFiltered=!1;this.filteredLayerUids=[];this.store=b.StoreResults.ALL}}b.StoreResults=void 0;(function(c){c[c.MIN=0]="MIN";c[c.MINMAX=1]="MINMAX";c[c.ALL=2]="ALL"})(b.StoreResults||(b.StoreResults={}));b.IntersectorOptions=a;Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/IntersectorTarget":function(){define(["exports","../../../../chunks/vec3f64"],function(b,a){class c{constructor(g,q,e){this.object=g;this.geometryId=q;this.triangleNr=e}}class d extends c{constructor(g,q,e,m){super(g,q,e);this.center=null!=m?a.clone(m):null}}class f extends d{}class n{constructor(g){this.layerUid=g}}class k extends n{constructor(g,q){super(g);this.graphicUid=q}}b.Graphic3DTarget=k;b.HudTarget=d;b.LayerTarget=
n;b.ObjectTarget=c;b.ValidHudTarget=f;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/intersectorUtils":function(){define(["exports","../../../../chunks/vec3","../../../../chunks/vec3f64","../../../../chunks/boundedPlane","./IntersectorInterfaces"],function(b,a,c,d,f){function n(g){return null!=g?.dist}const k=c.create();b.isHudIntersectorResult=function(g){return n(g)&&g.intersector===f.IntersectorType.HUD&&!!g.target&&"center"in g.target&&null!=g.target.center};
b.isObjectIntersectorResult=function(g){return n(g)&&g.intersector===f.IntersectorType.OBJECT&&!!g.target};b.isValidIntersectorResult=n;b.sliceFilterPredicate=function(g){return(q,e,m)=>{a.lerp(k,q,e,m);return!d.extrusionContainsPoint(g,k)}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/verticalOffsetUtils":function(){define("exports ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/sphere ../../../ViewingMode ../../support/orientedBoundingBox".split(" "),
function(b,a,c,d,f,n,k,g,q,e){class m{constructor(){this._transform=f.create();this._transformInverse=new l({value:this._transform},d.invert,f.create);this._transformInverseTranspose=new l(this._transformInverse,d.transpose,f.create);this._transformTranspose=new l({value:this._transform},d.transpose,f.create);this._transformInverseRotation=new l({value:this._transform},a.normalFromMat4Legacy,c.create)}_invalidateLazyTransforms(){this._transformInverse.invalidate();this._transformInverseTranspose.invalidate();
this._transformTranspose.invalidate();this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(B){d.copy(this._transform,B)}multiplyTransform(B){d.multiply(this._transform,this._transform,B)}set(B){d.copy(this._transform,
B);this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(B,D){this.setTransformMatrix(B);this.multiplyTransform(D);this._invalidateLazyTransforms()}}class l{constructor(B,D,F){this._original=B;this._update=D;this._dirty=!0;this._transform=F()}invalidate(){this._dirty=!0}get value(){this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1);return this._transform}}class w{constructor(B=0){this.offset=B;this.tmpVertex=k.create()}applyToVertex(B,D,F){B=n.set(r,B,D,F);
D=n.add(u,B,this.localOrigin);F=this.offset/n.length(D);n.scaleAndAdd(this.tmpVertex,B,D,F);return this.tmpVertex}applyToAabb(B){var D=y;const F=z,K=A;for(var L=0;3>L;++L)D[L]=B[0+L]+this.localOrigin[L],F[L]=B[3+L]+this.localOrigin[L],K[L]=D[L];L=this.applyToVertex(D[0],D[1],D[2]);for(var G=0;3>G;++G)B[G]=L[G],B[G+3]=L[G];L=P=>{P=this.applyToVertex(P[0],P[1],P[2]);for(let J=0;3>J;++J)B[J]=Math.min(B[J],P[J]),B[J+3]=Math.max(B[J+3],P[J])};for(G=1;8>G;++G){for(var O=0;3>O;++O)K[O]=0===(G&1<<O)?D[O]:
F[O];L(K)}G=0;for(O=0;3>O;++O)0>D[O]*F[O]&&(G|=1<<O);if(0!==G&&7!==G)for(O=0;8>O;++O)if(0===(G&O)){for(let P=0;3>P;++P)K[P]=0!==(G&1<<P)?0:0!==(O&1<<P)?D[P]:F[P];L(K)}for(D=0;3>D;++D)B[D]-=this.localOrigin[D],B[D+3]-=this.localOrigin[D];return B}}class v{constructor(B=0){this.componentLocalOriginLength=0;this._tmpVertex=k.create();this._mbs=g.create();this._obb=e.create();this._offset=this._totalOffset=0;this._resetOffset(B)}_resetOffset(B){this._totalOffset=this._offset=B}set offset(B){this._resetOffset(B)}get offset(){return this._offset}set componentOffset(B){this._totalOffset=
this._offset+B}set localOrigin(B){this.componentLocalOriginLength=n.length(B)}applyToVertex(B,D,F){const K=n.set(r,B,D,F);B=n.set(u,B,D,F+this.componentLocalOriginLength);D=this._totalOffset/n.length(B);n.scaleAndAdd(this._tmpVertex,K,B,D);return this._tmpVertex}applyToAabb(B){const D=n.set(r,B[0],B[1],B[2]+this.componentLocalOriginLength),F=n.set(u,B[3],B[4],B[5]+this.componentLocalOriginLength);var K=n.sign(y,D);const L=n.sign(z,F);var G=n.abs(A,D),O=n.abs(C,F);const P=n.min(E,G,O);P[0]=0>K[0]*
L[0]?0:P[0];P[1]=0>K[1]*L[1]?0:P[1];P[2]=0>K[2]*L[2]?0:P[2];K=n.length(P);if(K<this._totalOffset)return B[0]-=0>D[0]?this._totalOffset:0,B[1]-=0>D[1]?this._totalOffset:0,B[2]-=0>D[2]?this._totalOffset:0,B[3]+=0<F[0]?this._totalOffset:0,B[4]+=0<F[1]?this._totalOffset:0,B[5]+=0<F[2]?this._totalOffset:0,B;G=n.max(E,G,O);G=n.length(G);G=this._totalOffset/G;O=this._totalOffset/K;B[0]+=D[0]*(0<D[0]?G:O);B[1]+=D[1]*(0<D[1]?G:O);B[2]+=D[2]*(0<D[2]?G:O);B[3]+=F[0]*(0>F[0]?G:O);B[4]+=F[1]*(0>F[1]?G:O);B[5]+=
F[2]*(0>F[2]?G:O);return B}applyToMbs(B){const D=n.length(B);n.scaleAndAdd(this._mbs,B,B,this._totalOffset/D);this._mbs[3]=B[3]+B[3]*this._totalOffset/D;return this._mbs}applyToObb(B){e.computeOffsetObb(B,this._totalOffset,this._totalOffset,q.ViewingMode.Global,this._obb);return this._obb}}class x{constructor(B=0){this.offset=B;this.sphere=g.create();this.tmpVertex=k.create()}applyToVertex(B,D,F){var K=this.objectTransform.transform;B=n.set(r,B,D,F);K=n.transformMat4(B,B,K);B=this.offset/n.length(K);
n.scaleAndAdd(K,K,K,B);n.transformMat4(this.tmpVertex,K,this.objectTransform.inverse);return this.tmpVertex}applyToMinMax(B,D){const F=this.offset/n.length(B);n.scaleAndAdd(B,B,B,F);B=this.offset/n.length(D);n.scaleAndAdd(D,D,D,B)}applyToAabb(B){var D=this.offset/Math.sqrt(B[0]*B[0]+B[1]*B[1]+B[2]*B[2]);B[0]+=B[0]*D;B[1]+=B[1]*D;B[2]+=B[2]*D;D=this.offset/Math.sqrt(B[3]*B[3]+B[4]*B[4]+B[5]*B[5]);B[3]+=B[3]*D;B[4]+=B[4]*D;B[5]+=B[5]*D;return B}applyToBoundingSphere(B){const D=n.length(B);n.scaleAndAdd(this.sphere,
B,B,this.offset/D);this.sphere[3]=B[3]+B[3]*this.offset/D;return this.sphere}}const p=new x,h=new v,t=new w,r=k.create(),u=k.create(),y=k.create(),z=k.create(),A=k.create(),C=k.create(),E=k.create();b.I3SVerticalOffsetGlobalViewingMode=v;b.IntersectorTransform=m;b.Object3DVerticalOffsetGlobalViewingMode=x;b.TerrainVerticalOffsetGlobalViewingMode=w;b.getVerticalOffsetI3S=function(B){return null!=B?(h.offset=B,h):null};b.getVerticalOffsetObject3D=function(B){return null!=B?(p.offset=B,p):null};b.getVerticalOffsetTerrain=
function(B){return null!=B?(t.offset=B,t):null};b.terrainId="terrain";Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/mat3":function(){define(["exports","./common"],function(b,a){function c(J,R){J[0]=R[0];J[1]=R[1];J[2]=R[2];J[3]=R[4];J[4]=R[5];J[5]=R[6];J[6]=R[8];J[7]=R[9];J[8]=R[10];return J}function d(J,R){J[0]=R[0];J[1]=R[1];J[2]=R[2];J[3]=R[3];J[4]=R[4];J[5]=R[5];J[6]=R[6];J[7]=R[7];J[8]=R[8];return J}function f(J,R,X,U,M,V,Y,W,H,S){J[0]=R;J[1]=X;J[2]=U;J[3]=M;J[4]=
V;J[5]=Y;J[6]=W;J[7]=H;J[8]=S;return J}function n(J){J[0]=1;J[1]=0;J[2]=0;J[3]=0;J[4]=1;J[5]=0;J[6]=0;J[7]=0;J[8]=1;return J}function k(J,R){if(J===R){const X=R[1],U=R[2],M=R[5];J[1]=R[3];J[2]=R[6];J[3]=X;J[5]=R[7];J[6]=U;J[7]=M}else J[0]=R[0],J[1]=R[3],J[2]=R[6],J[3]=R[1],J[4]=R[4],J[5]=R[7],J[6]=R[2],J[7]=R[5],J[8]=R[8];return J}function g(J,R){const X=R[0],U=R[1],M=R[2],V=R[3],Y=R[4],W=R[5],H=R[6],S=R[7];R=R[8];const I=R*Y-W*S,Q=-R*V+W*H,N=S*V-Y*H;let T=X*I+U*Q+M*N;if(!T)return null;T=1/T;J[0]=
I*T;J[1]=(-R*U+M*S)*T;J[2]=(W*U-M*Y)*T;J[3]=Q*T;J[4]=(R*X-M*H)*T;J[5]=(-W*X+M*V)*T;J[6]=N*T;J[7]=(-S*X+U*H)*T;J[8]=(Y*X-U*V)*T;return J}function q(J,R){const X=R[0],U=R[1],M=R[2],V=R[3],Y=R[4],W=R[5],H=R[6],S=R[7];R=R[8];J[0]=Y*R-W*S;J[1]=M*S-U*R;J[2]=U*W-M*Y;J[3]=W*H-V*R;J[4]=X*R-M*H;J[5]=M*V-X*W;J[6]=V*S-Y*H;J[7]=U*H-X*S;J[8]=X*Y-U*V;return J}function e(J){const R=J[3],X=J[4],U=J[5],M=J[6],V=J[7],Y=J[8];return J[0]*(Y*X-U*V)+J[1]*(-Y*R+U*M)+J[2]*(V*R-X*M)}function m(J,R,X){const U=R[0],M=R[1],V=
R[2],Y=R[3],W=R[4],H=R[5],S=R[6],I=R[7];R=R[8];const Q=X[0],N=X[1],T=X[2],aa=X[3],Z=X[4],da=X[5],fa=X[6],ka=X[7];X=X[8];J[0]=Q*U+N*Y+T*S;J[1]=Q*M+N*W+T*I;J[2]=Q*V+N*H+T*R;J[3]=aa*U+Z*Y+da*S;J[4]=aa*M+Z*W+da*I;J[5]=aa*V+Z*H+da*R;J[6]=fa*U+ka*Y+X*S;J[7]=fa*M+ka*W+X*I;J[8]=fa*V+ka*H+X*R;return J}function l(J,R,X){const U=R[0],M=R[1],V=R[2],Y=R[3],W=R[4],H=R[5],S=R[6],I=R[7];R=R[8];const Q=X[0];X=X[1];J[0]=U;J[1]=M;J[2]=V;J[3]=Y;J[4]=W;J[5]=H;J[6]=Q*U+X*Y+S;J[7]=Q*M+X*W+I;J[8]=Q*V+X*H+R;return J}function w(J,
R,X){const U=R[0],M=R[1],V=R[2],Y=R[3],W=R[4],H=R[5],S=R[6],I=R[7];R=R[8];const Q=Math.sin(X);X=Math.cos(X);J[0]=X*U+Q*Y;J[1]=X*M+Q*W;J[2]=X*V+Q*H;J[3]=X*Y-Q*U;J[4]=X*W-Q*M;J[5]=X*H-Q*V;J[6]=S;J[7]=I;J[8]=R;return J}function v(J,R,X){const U=X[0],M=X[1];X=X[2];J[0]=U*R[0];J[1]=U*R[1];J[2]=U*R[2];J[3]=M*R[3];J[4]=M*R[4];J[5]=M*R[5];J[6]=X*R[6];J[7]=X*R[7];J[8]=X*R[8];return J}function x(J,R,X){const U=X[0];X=X[1];J[0]=U*R[0];J[1]=U*R[1];J[2]=U*R[2];J[3]=X*R[3];J[4]=X*R[4];J[5]=X*R[5];return J}function p(J,
R){J[0]=1;J[1]=0;J[2]=0;J[3]=0;J[4]=1;J[5]=0;J[6]=R[0];J[7]=R[1];J[8]=1;return J}function h(J,R){const X=Math.sin(R);R=Math.cos(R);J[0]=R;J[1]=X;J[2]=0;J[3]=-X;J[4]=R;J[5]=0;J[6]=0;J[7]=0;J[8]=1;return J}function t(J,R){J[0]=R[0];J[1]=0;J[2]=0;J[3]=0;J[4]=R[1];J[5]=0;J[6]=0;J[7]=0;J[8]=1;return J}function r(J,R){J[0]=R[0];J[1]=R[1];J[2]=0;J[3]=R[2];J[4]=R[3];J[5]=0;J[6]=R[4];J[7]=R[5];J[8]=1;return J}function u(J,R){var X=R[0],U=R[1],M=R[2];R=R[3];var V=X+X,Y=U+U;const W=M+M;X*=V;const H=U*V;U*=Y;
const S=M*V,I=M*Y;M*=W;V*=R;Y*=R;R*=W;J[0]=1-U-M;J[3]=H-R;J[6]=S+Y;J[1]=H+R;J[4]=1-X-M;J[7]=I-V;J[2]=S-Y;J[5]=I+V;J[8]=1-X-U;return J}function y(J,R){const X=R[0],U=R[1],M=R[2],V=R[4],Y=R[5],W=R[6],H=R[8],S=R[9];R=R[10];const I=R*Y-W*S,Q=-R*V+W*H,N=S*V-Y*H;var T=X*I+U*Q+M*N;if(!T)return null;T=1/T;J[0]=I*T;J[1]=(-R*U+M*S)*T;J[2]=(W*U-M*Y)*T;J[3]=Q*T;J[4]=(R*X-M*H)*T;J[5]=(-W*X+M*V)*T;J[6]=N*T;J[7]=(-S*X+U*H)*T;J[8]=(Y*X-U*V)*T;return J}function z(J,R){const X=R[0],U=R[1],M=R[2],V=R[3],Y=R[4],W=R[5],
H=R[6],S=R[7];var I=R[8],Q=R[9],N=R[10],T=R[11];const aa=R[12],Z=R[13],da=R[14];R=R[15];const fa=X*W-U*Y,ka=X*H-M*Y,ha=X*S-V*Y,ba=U*H-M*W,ea=U*S-V*W,ca=M*S-V*H,ia=I*Z-Q*aa,la=I*da-N*aa;I=I*R-T*aa;const oa=Q*da-N*Z;Q=Q*R-T*Z;N=N*R-T*da;T=fa*N-ka*Q+ha*oa+ba*I-ea*la+ca*ia;if(!T)return null;T=1/T;J[0]=(W*N-H*Q+S*oa)*T;J[1]=(H*I-Y*N-S*la)*T;J[2]=(Y*Q-W*I+S*ia)*T;J[3]=(M*Q-U*N-V*oa)*T;J[4]=(X*N-M*I+V*la)*T;J[5]=(U*I-X*Q-V*ia)*T;J[6]=(Z*ca-da*ea+R*ba)*T;J[7]=(da*ha-aa*ca-R*ka)*T;J[8]=(aa*ea-Z*ha+R*fa)*T;
return J}function A(J,R,X){J[0]=2/R;J[1]=0;J[2]=0;J[3]=0;J[4]=-2/X;J[5]=0;J[6]=-1;J[7]=1;J[8]=1;return J}function C(J){return"mat3("+J[0]+", "+J[1]+", "+J[2]+", "+J[3]+", "+J[4]+", "+J[5]+", "+J[6]+", "+J[7]+", "+J[8]+")"}function E(J){return Math.sqrt(J[0]**2+J[1]**2+J[2]**2+J[3]**2+J[4]**2+J[5]**2+J[6]**2+J[7]**2+J[8]**2)}function B(J,R,X){J[0]=R[0]+X[0];J[1]=R[1]+X[1];J[2]=R[2]+X[2];J[3]=R[3]+X[3];J[4]=R[4]+X[4];J[5]=R[5]+X[5];J[6]=R[6]+X[6];J[7]=R[7]+X[7];J[8]=R[8]+X[8];return J}function D(J,
R,X){J[0]=R[0]-X[0];J[1]=R[1]-X[1];J[2]=R[2]-X[2];J[3]=R[3]-X[3];J[4]=R[4]-X[4];J[5]=R[5]-X[5];J[6]=R[6]-X[6];J[7]=R[7]-X[7];J[8]=R[8]-X[8];return J}function F(J,R,X){J[0]=R[0]*X;J[1]=R[1]*X;J[2]=R[2]*X;J[3]=R[3]*X;J[4]=R[4]*X;J[5]=R[5]*X;J[6]=R[6]*X;J[7]=R[7]*X;J[8]=R[8]*X;return J}function K(J,R,X,U){J[0]=R[0]+X[0]*U;J[1]=R[1]+X[1]*U;J[2]=R[2]+X[2]*U;J[3]=R[3]+X[3]*U;J[4]=R[4]+X[4]*U;J[5]=R[5]+X[5]*U;J[6]=R[6]+X[6]*U;J[7]=R[7]+X[7]*U;J[8]=R[8]+X[8]*U;return J}function L(J,R){return J[0]===R[0]&&
J[1]===R[1]&&J[2]===R[2]&&J[3]===R[3]&&J[4]===R[4]&&J[5]===R[5]&&J[6]===R[6]&&J[7]===R[7]&&J[8]===R[8]}function G(J,R){const X=J[0],U=J[1],M=J[2],V=J[3],Y=J[4],W=J[5],H=J[6],S=J[7];J=J[8];const I=R[0],Q=R[1],N=R[2],T=R[3],aa=R[4],Z=R[5],da=R[6],fa=R[7];R=R[8];const ka=a.getEpsilon();return Math.abs(X-I)<=ka*Math.max(1,Math.abs(X),Math.abs(I))&&Math.abs(U-Q)<=ka*Math.max(1,Math.abs(U),Math.abs(Q))&&Math.abs(M-N)<=ka*Math.max(1,Math.abs(M),Math.abs(N))&&Math.abs(V-T)<=ka*Math.max(1,Math.abs(V),Math.abs(T))&&
Math.abs(Y-aa)<=ka*Math.max(1,Math.abs(Y),Math.abs(aa))&&Math.abs(W-Z)<=ka*Math.max(1,Math.abs(W),Math.abs(Z))&&Math.abs(H-da)<=ka*Math.max(1,Math.abs(H),Math.abs(da))&&Math.abs(S-fa)<=ka*Math.max(1,Math.abs(S),Math.abs(fa))&&Math.abs(J-R)<=ka*Math.max(1,Math.abs(J),Math.abs(R))}function O(J){const R=a.getEpsilon(),X=J[0],U=J[1],M=J[2],V=J[3],Y=J[4],W=J[5],H=J[6],S=J[7];J=J[8];return Math.abs(1-(X*X+V*V+H*H))<=R&&Math.abs(1-(U*U+Y*Y+S*S))<=R&&Math.abs(1-(M*M+W*W+J*J))<=R}const P=Object.freeze(Object.defineProperty({__proto__:null,
add:B,adjoint:q,copy:d,determinant:e,equals:G,exactEquals:L,frob:E,fromMat2d:r,fromMat4:c,fromQuat:u,fromRotation:h,fromScaling:t,fromTranslation:p,identity:n,invert:g,isOrthoNormal:O,mul:m,multiply:m,multiplyScalar:F,multiplyScalarAndAdd:K,normalFromMat4:z,normalFromMat4Legacy:y,projection:A,rotate:w,scale:v,scaleByVec2:x,set:f,str:C,sub:D,subtract:D,translate:l,transpose:k},Symbol.toStringTag,{value:"Module"}));b.add=B;b.adjoint=q;b.copy=d;b.determinant=e;b.equals=G;b.exactEquals=L;b.frob=E;b.fromMat2d=
r;b.fromMat4=c;b.fromQuat=u;b.fromRotation=h;b.fromScaling=t;b.fromTranslation=p;b.identity=n;b.invert=g;b.isOrthoNormal=O;b.mat3=P;b.mul=m;b.multiply=m;b.multiplyScalar=F;b.multiplyScalarAndAdd=K;b.normalFromMat4=z;b.normalFromMat4Legacy=y;b.projection=A;b.rotate=w;b.scale=v;b.scaleByVec2=x;b.set=f;b.str=C;b.sub=D;b.subtract=D;b.translate=l;b.transpose=k})},"esri/views/3d/support/orientedBoundingBox":function(){define("exports ../../../chunks/mat3 ../../../chunks/mat3f64 ../../../chunks/quat ../../../chunks/quatf64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../chunks/vec4f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/plane ../../ViewingMode ./dito".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w){function v(F=[0,0,0],K=[-1,-1,-1],L=f.create()){return{center:k.clone(F),halfSize:k.clone(K),quaternion:f.clone(L)}}function x(F,K){const L=m.signedDistance(K,F.center);F=p(F,m.normal(K));return L>F?1:L<-F?-1:0}function p(F,K){d.conjugate(h,F.quaternion);n.transformQuat(t,K,h);F=F.halfSize;return Math.abs(t[0]*F[0])+Math.abs(t[1]*F[1])+Math.abs(t[2]*F[2])}const h=f.create(),t=k.create(),r=k.create(),u=q.create(),y=c.create(),z=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,
1.2],A=(()=>{const F=new Int8Array(162);let K=0;const L=G=>{for(let O=0;O<G.length;O++)F[K+O]=G[O];K+=6};L([6,2,3,1,5,4]);L([0,2,3,1,5,4]);L([0,2,3,7,5,4]);L([0,1,3,2,6,4]);L([0,1,3,2,0,0]);L([0,1,5,7,3,2]);L([0,1,3,7,6,4]);L([0,1,3,7,6,2]);L([0,1,5,7,6,2]);L([0,1,5,4,6,2]);L([0,1,5,4,0,0]);L([0,1,3,7,5,4]);L([0,2,6,4,0,0]);L([0,0,0,0,0,0]);L([1,3,7,5,0,0]);L([2,3,7,6,4,0]);L([2,3,7,6,0,0]);L([2,3,1,5,7,6]);L([0,1,5,7,6,2]);L([0,1,5,7,6,4]);L([0,1,3,7,6,4]);L([4,5,7,6,2,0]);L([4,5,7,6,0,0]);L([4,
5,1,3,7,6]);L([0,2,3,7,5,4]);L([6,2,3,7,5,4]);L([6,2,3,1,5,4]);return F})(),C=k.create(),E=k.create(),B=k.create(),D=f.create();b.clone=function(F){return v(F.center,F.halfSize,F.quaternion)};b.compute=function(F,K){K=K||v();w.computeOBB(F,K);return K};b.computeOffsetObb=function(F,K,L,G,O){d.copy(O.quaternion,F.quaternion);if(G===l.ViewingMode.Global){d.conjugate(D,F.quaternion);n.transformQuat(C,F.center,D);n.abs(E,C);n.min(B,E,F.halfSize);n.sub(B,E,B);G=n.length(B);n.add(B,E,F.halfSize);const P=
n.length(B);G<L?(n.copy(O.center,F.center),n.set(C,L,L,L),n.add(O.halfSize,F.halfSize,C)):(K=0<P?1+K/P:1,G=0<G?1+L/G:1,L=(G+K)/2,K=(G-K)/2,n.scale(O.halfSize,E,K),n.scaleAndAdd(O.halfSize,O.halfSize,F.halfSize,L),n.scale(O.center,E,L),n.scaleAndAdd(O.center,O.center,F.halfSize,K),n.sign(C,C),n.multiply(O.center,O.center,C),n.transformQuat(O.center,O.center,O.quaternion))}else G=n.set(C,0,0,1),n.scaleAndAdd(O.center,F.center,G,(L+K)/2),d.conjugate(D,F.quaternion),n.transformQuat(G,G,D),n.abs(G,G),
n.scaleAndAdd(O.halfSize,F.halfSize,G,(L-K)/2);return O};b.corners=function(F,K){for(let L=0;8>L;++L){const G=K[L];G[0]=L&1?-F.halfSize[0]:F.halfSize[0];G[1]=L&2?-F.halfSize[1]:F.halfSize[1];G[2]=L&4?-F.halfSize[2]:F.halfSize[2];n.transformQuat(G,G,F.quaternion);n.add(G,G,F.center)}};b.create=v;b.intersectLine=function(F,K,L,G=0){d.conjugate(h,F.quaternion);n.subtract(t,K,F.center);K=n.transformQuat(t,t,h);L=n.transformQuat(r,L,h);let O=-Infinity,P=Infinity;for(let J=0;3>J;J++)if(1E-6<Math.abs(L[J])){const R=
(G+F.halfSize[J]-K[J])/L[J],X=(-G-F.halfSize[J]-K[J])/L[J];O=Math.max(O,Math.min(R,X));P=Math.min(P,Math.max(R,X))}else if(K[J]>F.halfSize[J]+G||K[J]<-F.halfSize[J]-G)return!1;return O<=P};b.intersectPlane=x;b.intersectSphere=function(F,K){t[0]=F.center[0]-K[0];t[1]=F.center[1]-K[1];t[2]=F.center[2]-K[2];d.conjugate(h,F.quaternion);n.transformQuat(t,t,h);n.abs(t,t);n.min(r,t,F.halfSize);return n.sqrDist(r,t)<K[3]*K[3]};b.isVisible=function(F,K){return 0>=x(F,K[0])&&0>=x(F,K[1])&&0>=x(F,K[2])&&0>=
x(F,K[3])&&0>=x(F,K[4])&&0>=x(F,K[5])};b.maximumDistancePlane=function(F,K){const L=m.signedDistance(K,F.center);F=p(F,m.normal(K));return L+F};b.minimumDistancePlane=function(F,K){const L=m.signedDistance(K,F.center);F=p(F,m.normal(K));return L-F};b.projectedArea=function(F,K,L,G,O){d.conjugate(h,F.quaternion);n.sub(t,K,F.center);n.transformQuat(t,t,h);var P=t[0]<-F.halfSize[0]?-1:t[0]>F.halfSize[0]?1:0,J=t[1]<-F.halfSize[1]?-1:t[1]>F.halfSize[1]?1:0,R=t[2]<-F.halfSize[2]?-1:t[2]>F.halfSize[2]?1:
0;K=Math.abs(P)+Math.abs(J)+Math.abs(R);if(0===K)return Infinity;K=1===K?4:6;P=6*(P+3*J+9*R+13);a.fromQuat(y,F.quaternion);a.scale(y,y,F.halfSize);for(J=0;J<K;J++)R=A[P+J],n.set(t,((R&1)<<1)-1,(R&2)-1,((R&4)>>1)-1),n.transformMat3(t,t,y),n.add(u,F.center,t),u[3]=1,g.transformMat4(u,u,L),R=1/Math.max(1E-6,u[3]),z[2*J]=u[0]*R,z[2*J+1]=u[1]*R;F=2*K-2;L=z[0]*(z[3]-z[F+1])+z[F]*(z[1]-z[F-1]);for(K=2;K<F;K+=2)L+=z[K]*(z[K+3]-z[K-1]);return Math.abs(L)*G*O*.125};b.projectedRadius=p;b.radius=function(F){return n.len(F.halfSize)};
b.set=function(F,K){n.copy(K.center,F.center);n.copy(K.halfSize,F.halfSize);d.copy(K.quaternion,F.quaternion)};b.toAaBoundingBox=function(F,K){K||(K=e.create());var L=a.fromQuat(y,F.quaternion);const G=F.halfSize[0]*Math.abs(L[0])+F.halfSize[1]*Math.abs(L[3])+F.halfSize[2]*Math.abs(L[6]),O=F.halfSize[0]*Math.abs(L[1])+F.halfSize[1]*Math.abs(L[4])+F.halfSize[2]*Math.abs(L[7]);L=F.halfSize[0]*Math.abs(L[2])+F.halfSize[1]*Math.abs(L[5])+F.halfSize[2]*Math.abs(L[8]);K[0]=F.center[0]-G;K[1]=F.center[1]-
O;K[2]=F.center[2]-L;K[3]=F.center[0]+G;K[4]=F.center[1]+O;K[5]=F.center[2]+L;return K};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/quat":function(){define("exports ./mat3f64 ./quatf64 ./vec3f64 ./common ./vec3 ./vec4".split(" "),function(b,a,c,d,f,n,k){function g(H){H[0]=0;H[1]=0;H[2]=0;H[3]=1;return H}function q(H,S,I){I*=.5;const Q=Math.sin(I);H[0]=Q*S[0];H[1]=Q*S[1];H[2]=Q*S[2];H[3]=Math.cos(I);return H}function e(H,S){const I=2*Math.acos(S[3]),Q=Math.sin(I/2);
Q>f.getEpsilon()?(H[0]=S[0]/Q,H[1]=S[1]/Q,H[2]=S[2]/Q):(H[0]=1,H[1]=0,H[2]=0);return I}function m(H,S,I){const Q=S[0],N=S[1],T=S[2];S=S[3];const aa=I[0],Z=I[1],da=I[2];I=I[3];H[0]=Q*I+S*aa+N*da-T*Z;H[1]=N*I+S*Z+T*aa-Q*da;H[2]=T*I+S*da+Q*Z-N*aa;H[3]=S*I-Q*aa-N*Z-T*da;return H}function l(H,S,I){I*=.5;const Q=S[0],N=S[1],T=S[2];S=S[3];const aa=Math.sin(I);I=Math.cos(I);H[0]=Q*I+S*aa;H[1]=N*I+T*aa;H[2]=T*I-N*aa;H[3]=S*I-Q*aa;return H}function w(H,S,I){I*=.5;const Q=S[0],N=S[1],T=S[2];S=S[3];const aa=
Math.sin(I);I=Math.cos(I);H[0]=Q*I-T*aa;H[1]=N*I+S*aa;H[2]=T*I+Q*aa;H[3]=S*I-N*aa;return H}function v(H,S,I){I*=.5;const Q=S[0],N=S[1],T=S[2];S=S[3];const aa=Math.sin(I);I=Math.cos(I);H[0]=Q*I+N*aa;H[1]=N*I-Q*aa;H[2]=T*I+S*aa;H[3]=S*I-T*aa;return H}function x(H,S){const I=S[0],Q=S[1];S=S[2];H[0]=I;H[1]=Q;H[2]=S;H[3]=Math.sqrt(Math.abs(1-I*I-Q*Q-S*S));return H}function p(H,S,I,Q){const N=S[0],T=S[1],aa=S[2];S=S[3];let Z=I[0],da=I[1],fa=I[2];I=I[3];let ka;let ha;var ba=N*Z+T*da+aa*fa+S*I;0>ba&&(ba=
-ba,Z=-Z,da=-da,fa=-fa,I=-I);1-ba>f.getEpsilon()?(ka=Math.acos(ba),ha=Math.sin(ka),ba=Math.sin((1-Q)*ka)/ha,Q=Math.sin(Q*ka)/ha):ba=1-Q;H[0]=ba*N+Q*Z;H[1]=ba*T+Q*da;H[2]=ba*aa+Q*fa;H[3]=ba*S+Q*I;return H}function h(H){var S=f.RANDOM,I=S();const Q=S();S=S();const N=Math.sqrt(1-I);I=Math.sqrt(I);H[0]=N*Math.sin(2*Math.PI*Q);H[1]=N*Math.cos(2*Math.PI*Q);H[2]=I*Math.sin(2*Math.PI*S);H[3]=I*Math.cos(2*Math.PI*S);return H}function t(H,S){const I=S[0],Q=S[1],N=S[2];S=S[3];var T=I*I+Q*Q+N*N+S*S;T=T?1/T:0;
H[0]=-I*T;H[1]=-Q*T;H[2]=-N*T;H[3]=S*T;return H}function r(H,S){H[0]=-S[0];H[1]=-S[1];H[2]=-S[2];H[3]=S[3];return H}function u(H,S){var I=S[0]+S[4]+S[8];if(0<I)I=Math.sqrt(I+1),H[3]=.5*I,I=.5/I,H[0]=(S[5]-S[7])*I,H[1]=(S[6]-S[2])*I,H[2]=(S[1]-S[3])*I;else{let Q=0;S[4]>S[0]&&(Q=1);S[8]>S[3*Q+Q]&&(Q=2);const N=(Q+1)%3,T=(Q+2)%3;I=Math.sqrt(S[3*Q+Q]-S[3*N+N]-S[3*T+T]+1);H[Q]=.5*I;I=.5/I;H[3]=(S[3*N+T]-S[3*T+N])*I;H[N]=(S[3*N+Q]+S[3*Q+N])*I;H[T]=(S[3*T+Q]+S[3*Q+T])*I}return H}function y(H,S,I,Q){var N=
.5*Math.PI/180;S*=N;I*=N;Q*=N;N=Math.sin(S);S=Math.cos(S);const T=Math.sin(I);I=Math.cos(I);const aa=Math.sin(Q);Q=Math.cos(Q);H[0]=N*I*Q-S*T*aa;H[1]=S*T*Q+N*I*aa;H[2]=S*I*aa-N*T*Q;H[3]=S*I*Q+N*T*aa;return H}function z(H){return"quat("+H[0]+", "+H[1]+", "+H[2]+", "+H[3]+")"}function A(H,S,I){const Q=n.dot(S,I);if(-.999999>Q)return n.cross(X,U,S),1E-6>n.len(X)&&n.cross(X,M,S),n.normalize(X,X),q(H,X,Math.PI),H;if(.999999<Q)return H[0]=0,H[1]=0,H[2]=0,H[3]=1,H;n.cross(X,S,I);H[0]=X[0];H[1]=X[1];H[2]=
X[2];H[3]=1+Q;return J(H,H)}function C(H,S,I,Q,N,T){p(V,S,N,T);p(Y,I,Q,T);p(H,V,Y,2*T*(1-T));return H}function E(H,S,I,Q){const N=W;N[0]=I[0];N[3]=I[1];N[6]=I[2];N[1]=Q[0];N[4]=Q[1];N[7]=Q[2];N[2]=-S[0];N[5]=-S[1];N[8]=-S[2];return J(H,u(H,N))}const B=k.copy,D=k.set,F=k.add,K=k.scale,L=k.dot,G=k.lerp,O=k.length,P=k.squaredLength,J=k.normalize,R=k.exactEquals;k=k.equals;const X=d.create(),U=d.fromValues(1,0,0),M=d.fromValues(0,1,0),V=c.create(),Y=c.create(),W=a.create();a=Object.freeze(Object.defineProperty({__proto__:null,
add:F,calculateW:x,conjugate:r,copy:B,dot:L,equals:k,exactEquals:R,fromEuler:y,fromMat3:u,getAxisAngle:e,identity:g,invert:t,len:O,length:O,lerp:G,mul:m,multiply:m,normalize:J,random:h,rotateX:l,rotateY:w,rotateZ:v,rotationTo:A,scale:K,set:D,setAxes:E,setAxisAngle:q,slerp:p,sqlerp:C,sqrLen:P,squaredLength:P,str:z},Symbol.toStringTag,{value:"Module"}));b.add=F;b.calculateW=x;b.conjugate=r;b.copy=B;b.dot=L;b.equals=k;b.exactEquals=R;b.fromEuler=y;b.fromMat3=u;b.getAxisAngle=e;b.identity=g;b.invert=
t;b.len=O;b.length=O;b.lerp=G;b.mul=m;b.multiply=m;b.normalize=J;b.quat=a;b.random=h;b.rotateX=l;b.rotateY=w;b.rotateZ=v;b.rotationTo=A;b.scale=K;b.set=D;b.setAxes=E;b.setAxisAngle=q;b.slerp=p;b.sqlerp=C;b.sqrLen=P;b.squaredLength=P;b.str=z})},"esri/views/3d/support/dito":function(){define(["exports","../webgl-engine/lib/Attribute"],function(b,a){function c(N,T,aa,Z,da,fa){if(!(1E-6>T[0]*T[0]+T[1]*T[1]+T[2]*T[2]))for(w(F,aa,T),w(K,Z,T),w(L,da,T),d(N,T,D),O[1]=D[0],G[1]=D[1],P[1]=G[1]-O[1],aa=[aa,
Z,da],Z=[F,K,L],da=0;3>da;++da){d(N,aa[da],D);O[0]=D[0];G[0]=D[1];d(N,Z[da],D);O[2]=D[0];G[2]=D[1];P[0]=G[0]-O[0];P[2]=G[2]-O[2];const ka=g(P);ka<fa.quality&&(l(fa.b0,aa[da]),l(fa.b1,T),l(fa.b2,Z[da]),fa.quality=ka)}}function d(N,T,aa){const {data:Z,size:da}=N;aa[0]=Number.POSITIVE_INFINITY;aa[1]=Number.NEGATIVE_INFINITY;for(N=0;N<Z.length;N+=da){const fa=Z[N]*T[0]+Z[N+1]*T[1]+Z[N+2]*T[2];aa[0]=Math.min(aa[0],fa);aa[1]=Math.max(aa[1],fa)}}function f(N,T,aa){l(aa.center,N);m(aa.halfSize,T,.5);aa.quaternion[0]=
0;aa.quaternion[1]=0;aa.quaternion[2]=0;aa.quaternion[3]=1}function n(N,T,aa,Z,da,fa){d(N,T,D);da[0]=D[0];fa[0]=D[1];d(N,aa,D);da[1]=D[0];fa[1]=D[1];d(N,Z,D);da[2]=D[0];fa[2]=D[1]}function k(N,T,aa,Z,da,fa,ka){H[0]=N[0];H[1]=N[1];H[2]=N[2];H[3]=T[0];H[4]=T[1];H[5]=T[2];H[6]=aa[0];H[7]=aa[1];H[8]=aa[2];var ha=ka.quaternion,ba=H,ea=ba[0]+ba[4]+ba[8];if(0<ea)ea=Math.sqrt(ea+1),ha[3]=.5*ea,ea=.5/ea,ha[0]=(ba[5]-ba[7])*ea,ha[1]=(ba[6]-ba[2])*ea,ha[2]=(ba[1]-ba[3])*ea;else{ea=0;ba[4]>ba[0]&&(ea=1);ba[8]>
ba[3*ea+ea]&&(ea=2);const ca=(ea+1)%3,ia=(ea+2)%3;let la=Math.sqrt(ba[3*ea+ea]-ba[3*ca+ca]-ba[3*ia+ia]+1);ha[ea]=.5*la;la=.5/la;ha[3]=(ba[3*ca+ia]-ba[3*ia+ca])*la;ha[ca]=(ba[3*ca+ea]+ba[3*ea+ca])*la;ha[ia]=(ba[3*ia+ea]+ba[3*ea+ia])*la}q(S,Z,da);m(S,S,.5);m(ka.center,N,S[0]);m(W,T,S[1]);q(ka.center,ka.center,W);m(W,aa,S[2]);q(ka.center,ka.center,W);m(ka.halfSize,fa,.5)}function g(N){return N[0]*N[1]+N[0]*N[2]+N[1]*N[2]}function q(N,T,aa){N[0]=T[0]+aa[0];N[1]=T[1]+aa[1];N[2]=T[2]+aa[2]}function e(N,
T,aa){N[0]=T[0]-aa[0];N[1]=T[1]-aa[1];N[2]=T[2]-aa[2]}function m(N,T,aa){N[0]=T[0]*aa;N[1]=T[1]*aa;N[2]=T[2]*aa}function l(N,T,aa=0){N[0]=T[aa];N[1]=T[aa+1];N[2]=T[aa+2]}function w(N,T,aa){const Z=T[0],da=T[1];T=T[2];const fa=aa[0],ka=aa[1];aa=aa[2];N[0]=da*aa-T*ka;N[1]=T*fa-Z*aa;N[2]=Z*ka-da*fa}function v(N,T){var aa=T[0]*T[0]+T[1]*T[1]+T[2]*T[2];0<aa&&(aa=1/Math.sqrt(aa),N[0]=T[0]*aa,N[1]=T[1]*aa,N[2]=T[2]*aa)}function x(N,T){const aa=T[0]-N[0],Z=T[1]-N[1];N=T[2]-N[2];return aa*aa+Z*Z+N*N}const p=
[0,0,0],h=[0,0,0],t=[0,0,0],r=[0,0,0],u=[0,0,0],y=[0,0,0],z=[0,0,0],A=[0,0,0],C=[0,0,0],E=[0,0,0],B=[0,0,0],D=[0,0],F=[0,0,0],K=[0,0,0],L=[0,0,0],G=[0,0,0],O=[0,0,0],P=[0,0,0],J=[0,0,0],R=[0,0,0],X=[0,0,0],U=[0,0,0],M=[0,0,0],V=[0,0,0],Y=[0,0,0],W=[0,0,0],H=[1,0,0,0,1,0,0,0,1],S=[0,0,0];class I{constructor(N){this.minVert=Array(7);this.maxVert=Array(7);this.buffer=new ArrayBuffer(448);var T=0;this.minProj=new Float64Array(this.buffer,T,7);T+=56;this.maxProj=new Float64Array(this.buffer,T,7);T+=56;
for(var aa=0;7>aa;++aa)this.minVert[aa]=new Float64Array(this.buffer,T,3),T+=24;for(aa=0;7>aa;++aa)this.maxVert[aa]=new Float64Array(this.buffer,T,3),T+=24;for(T=0;7>T;++T)this.minProj[T]=Number.POSITIVE_INFINITY,this.maxProj[T]=Number.NEGATIVE_INFINITY;T=Array(7);aa=Array(7);const {data:Z,size:da}=N;for(N=0;N<Z.length;N+=da){var fa=Z[N];fa<this.minProj[0]&&(this.minProj[0]=fa,T[0]=N);fa>this.maxProj[0]&&(this.maxProj[0]=fa,aa[0]=N);fa=Z[N+1];fa<this.minProj[1]&&(this.minProj[1]=fa,T[1]=N);fa>this.maxProj[1]&&
(this.maxProj[1]=fa,aa[1]=N);fa=Z[N+2];fa<this.minProj[2]&&(this.minProj[2]=fa,T[2]=N);fa>this.maxProj[2]&&(this.maxProj[2]=fa,aa[2]=N);fa=Z[N]+Z[N+1]+Z[N+2];fa<this.minProj[3]&&(this.minProj[3]=fa,T[3]=N);fa>this.maxProj[3]&&(this.maxProj[3]=fa,aa[3]=N);fa=Z[N]+Z[N+1]-Z[N+2];fa<this.minProj[4]&&(this.minProj[4]=fa,T[4]=N);fa>this.maxProj[4]&&(this.maxProj[4]=fa,aa[4]=N);fa=Z[N]-Z[N+1]+Z[N+2];fa<this.minProj[5]&&(this.minProj[5]=fa,T[5]=N);fa>this.maxProj[5]&&(this.maxProj[5]=fa,aa[5]=N);fa=Z[N]-
Z[N+1]-Z[N+2];fa<this.minProj[6]&&(this.minProj[6]=fa,T[6]=N);fa>this.maxProj[6]&&(this.maxProj[6]=fa,aa[6]=N)}for(N=0;7>N;++N)fa=T[N],l(this.minVert[N],Z,fa),fa=aa[N],l(this.maxVert[N],Z,fa)}}class Q{constructor(){this.b0=[1,0,0];this.b1=[0,1,0];this.b2=[0,0,1];this.quality=0}}b.computeOBB=function(N,T){const {data:aa,size:Z}=N;var da=aa.length/Z;if(!(0>=da)){var fa=new I(N);q(p,fa.minProj,fa.maxProj);m(p,p,.5);e(h,fa.maxProj,fa.minProj);var ka=g(h),ha=new Q;ha.quality=ka;14>da&&(N=new a.Vertices(new Float64Array(fa.buffer,
112,42),3));var ba=[0,0,0],ea=[0,0,0],ca=[0,0,0];da=[0,0,0];var ia=[0,0,0],la=[0,0,0],oa=[0,0,0];var na=N;var ra=x(fa.maxVert[0],fa.minVert[0]),ta=0;for(var ma=1;7>ma;++ma){const qa=x(fa.maxVert[ma],fa.minVert[ma]);qa>ra&&(ra=qa,ta=ma)}l(ba,fa.minVert[ta]);l(ea,fa.maxVert[ta]);if(1E-6>x(ba,ea))na=1;else{e(da,ba,ea);v(da,da);const {data:qa,size:ua}=na;fa=Number.NEGATIVE_INFINITY;ra=0;for(ta=0;ta<qa.length;ta+=ua)B[0]=qa[ta]-ba[0],B[1]=qa[ta+1]-ba[1],B[2]=qa[ta+2]-ba[2],ma=da[0]*B[0]+da[1]*B[1]+da[2]*
B[2],ma=B[0]*B[0]+B[1]*B[1]+B[2]*B[2]-ma*ma/(da[0]*da[0]+da[1]*da[1]+da[2]*da[2]),ma>fa&&(fa=ma,ra=ta);l(ca,qa,ra);1E-6>fa?na=2:(e(ia,ea,ca),v(ia,ia),e(la,ca,ba),v(la,la),w(oa,ia,da),v(oa,oa),c(na,oa,da,ia,la,ha),na=0)}switch(na){case 1:f(p,h,T);return;case 2:ka=N;l(R,da);Math.abs(da[0])>Math.abs(da[1])&&Math.abs(da[0])>Math.abs(da[2])?R[0]=0:Math.abs(da[1])>Math.abs(da[2])?R[1]=0:R[2]=0;1E-6>R[0]*R[0]+R[1]*R[1]+R[2]*R[2]&&(R[0]=R[1]=R[2]=1);w(X,da,R);v(X,X);w(U,da,X);v(U,U);n(ka,da,X,U,M,V);e(Y,
V,M);k(da,X,U,M,V,Y,T);return}na=N;fa=D;const {data:pa,size:ja}=na;l(r,pa);l(t,r);fa[0]=J[0]*oa[0]+J[1]*oa[1]+J[2]*oa[2];fa[1]=fa[0];for(ra=ja;ra<pa.length;ra+=ja)ta=pa[ra]*oa[0]+pa[ra+1]*oa[1]+pa[ra+2]*oa[2],ta<fa[0]&&(fa[0]=ta,l(r,pa,ra)),ta>fa[1]&&(fa[1]=ta,l(t,pa,ra));oa=ba[0]*oa[0]+ba[1]*oa[1]+ba[2]*oa[2];D[1]-1E-6<=oa&&(t[0]=void 0);D[0]+1E-6>=oa&&(r[0]=void 0);void 0!==t[0]&&(e(u,t,ba),v(u,u),e(y,t,ea),v(y,y),e(z,t,ca),v(z,z),w(A,y,da),v(A,A),w(C,z,ia),v(C,C),w(E,u,la),v(E,E),c(na,A,da,y,u,
ha),c(na,C,ia,z,y,ha),c(na,E,la,u,z,ha));void 0!==r[0]&&(e(u,r,ba),v(u,u),e(y,r,ea),v(y,y),e(z,r,ca),v(z,z),w(A,y,da),v(A,A),w(C,z,ia),v(C,C),w(E,u,la),v(E,E),c(na,A,da,y,u,ha),c(na,C,ia,z,y,ha),c(na,E,la,u,z,ha));n(N,ha.b0,ha.b1,ha.b2,M,V);N=[0,0,0];e(N,V,M);ha.quality=g(N);ha.quality<ka?k(ha.b0,ha.b1,ha.b2,M,V,N,T):f(p,h,T)}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Attribute":function(){define(["exports"],function(b){class a{constructor(d,
f,n=f){this.data=d;this.size=f;this.stride=n}}class c extends a{constructor(d,f,n,k=!1,g=n){super(d,n,g);this.indices=f;this.exclusive=k}}b.Attribute=c;b.Vertices=a;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/cameraUtilsPlanar":function(){define("exports ../core/mathUtils ./mat4 ./mat4f64 ./vec3 ./vec3f64 ../geometry/Extent ../geometry/projection/projectPointToVector ../geometry/projection/projectVectorToVector ../views/3d/support/cameraUtilsInternal".split(" "),function(b,
a,c,d,f,n,k,g,q,e){function m(z,A,C,E=e.createDirectionUp()){const {direction:B,up:D}=E;c.fromZRotation(r,-a.deg2rad(A));c.rotateX(r,r,a.deg2rad(C));f.transformMat4(B,t,r);f.scale(B,B,-1);f.transformMat4(D,h,r);return E}function l(z,A,C,E){return e.directionToHeadingTilt(A,C,E,t,h)}function w(z,A,C,E){const B=m(z,C,E),D=n.create();f.scale(D,B.direction,-A);f.add(D,D,z);return{up:B.up,eye:D,heading:C,tilt:E}}function v(z){return a.rad2deg(z)}function x(z){return a.deg2rad(z)}function p(z,A,C,E,B){const D=
z.renderSpatialReference;z=z.map&&z.spatialReference||A.spatialReference;g.projectPointToVector(A,u,D);g.projectPointToVector(A,y,D);u[0]-=C/2;y[0]+=C/2;u[1]-=E/2;y[1]+=E/2;q.projectVectorToVector(u,D,u,z);q.projectVectorToVector(y,D,y,z);B?(B.xmin=u[0],B.ymin=u[1],B.xmax=y[0],B.ymax=y[1],B.spatialReference=z):B=new k(u[0],u[1],y[0],y[1],z);return B}const h=n.fromValues(0,1,0),t=n.fromValues(0,0,1),r=d.create(),u=n.create(),y=n.create();d=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:l,
eyeForCenterWithHeadingTilt:w,eyeTiltToLookAtTilt:x,headingTiltToDirectionUp:m,lookAtTiltToEyeTilt:v,toExtent:p},Symbol.toStringTag,{value:"Module"}));b.cameraUtilsPlanar=d;b.directionToHeadingTilt=l;b.eyeForCenterWithHeadingTilt=w;b.eyeTiltToLookAtTilt=x;b.headingTiltToDirectionUp=m;b.lookAtTiltToEyeTilt=v;b.toExtent=p})},"esri/views/3d/support/cameraUtilsInternal":function(){define(["exports","../../../core/mathUtils","../../../chunks/vec3","../../../chunks/vec3f64"],function(b,a,c,d){const f=d.create(),
n=d.create();b.createDirectionUp=function(){return{direction:d.create(),up:d.create()}};b.directionToHeadingTilt=function(k,g,q,e,m){let l=c.normalize(f,k),w=c.dot(l,e);const v=0<w;w=Math.abs(w);.99<w&&(w=Math.abs(c.dot(g,e)),.99>w?(c.copy(l,g),v&&c.scale(l,l,-1)):l=null);g=0;l&&(c.scale(n,e,c.dot(e,l)),c.subtract(l,l,n),g=c.dot(l,m)/(c.length(l)*c.length(m)),c.cross(n,l,m),g=(0<c.dot(n,e)?1:-1)*a.rad2deg(a.acosClamped(g)));k=a.rad2deg(a.acosClamped(-c.dot(e,k)/c.length(k)));if(!q)return{heading:g,
tilt:k};q.heading=g;q.tilt=k;return q};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/cameraUtilsSpherical":function(){define("exports ../core/Cyclical ../core/mathUtils ./mat4 ./mat4f64 ./vec3 ./vec3f64 ../geometry/ellipsoidUtils ../geometry/Extent ../geometry/SpatialReference ../geometry/support/webMercatorUtils ../views/3d/support/cameraUtilsInternal ../views/3d/support/earthUtils".split(" "),function(b,a,c,d,f,n,k,g,q,e,m,l,w){function v(F,K,L,G=l.createDirectionUp()){n.cross(B,
F,z);0===n.dot(B,B)&&n.cross(B,F,A);d.fromRotation(E,-c.deg2rad(K),F);d.rotate(E,E,-c.deg2rad(L),B);const {up:O,direction:P}=G;n.cross(O,B,F);n.normalize(O,O);n.transformMat4(O,O,E);n.normalize(P,F);n.negate(P,P);n.transformMat4(P,P,E);return G}function x(F,K,L,G){const O=B,P=D;n.normalize(O,F);n.cross(D,O,z);0===n.dot(D,D)&&n.cross(D,O,A);n.cross(P,D,O);return l.directionToHeadingTilt(K,L,G,O,P)}function p(F,K,L,G){const O={eye:k.create(),up:null,tilt:G,heading:L},P=B;P[0]=F[0];P[1]=F[2];P[2]=-F[1];
L=c.deg2rad(L);var J=c.deg2rad(G);G=Math.sin(L);L=Math.cos(L);var R=Math.sin(J),X=Math.cos(J);const U=n.length(P);if(1E-8>Math.abs(J))J=K+U;else{var M=U/R,V=c.asinClamped(K/M);J=M*Math.sin(Math.PI-J-V)}X*=K;M=K*K*R*R;V=L*L*M;const Y=J-X,W=Y*Y;var H=V*(V+W-P[1]*P[1]);if(0>H)return n.scale(O.eye,P,J/U),O.tilt=0,t(O,F);var S=Math.sqrt(H);const I=P[1]*Y;H=V+W;S=0<L?-S+I:S+I;if(1E-8>Math.abs(H))return 1E-8>U?(O.eye[0]=0,O.eye[1]=0,O.eye[2]=K):n.scale(O.eye,P,J/U),O.tilt=0,h(O.eye),t(O,F);O.eye[1]=S/H;
K*=R;S=O.eye[1]*O.eye[1];R=1-S;H=Math.sqrt(R);M=V*S+G*G*M-2*L*K*O.eye[1]*H*Y+R*W;if(1E-8>Math.abs(M))return n.scale(O.eye,P,J/U),O.tilt=0,h(O.eye),t(O,F);O.eye[0]=(R*(J*P[0]-X*P[0])-K*H*(P[0]*O.eye[1]*L+P[2]*G))/M;O.eye[2]=(R*(J*P[2]-X*P[2])-K*H*(P[2]*O.eye[1]*L-P[0]*G))/M;n.scale(O.eye,O.eye,J);h(O.eye);return t(O,F)}function h(F){const K=F[1];F[1]=-F[2];F[2]=K}function t(F,K){K=v(K,F.heading,F.tilt);F.up=K.up;return F}function r(F,K,L){K=n.length(K);L=c.asinClamped(L/(Math.sqrt(L*L+K*K-2*L*K*Math.cos(Math.PI-
F))/Math.sin(F)));return c.rad2deg(F-L)}function u(F,K,L){F=c.deg2rad(F);K=n.length(K);return c.asinClamped(L/(K/Math.sin(F)))+F}function y(F,K,L,G,O){function P(U){const M=Math.PI/2;U=a.cyclical2PI.normalize(U,-M);U>M&&(U=Math.PI-U);return U}var J=K.latitude;var R=g.getReferenceEllipsoid(F.spatialReference).radius;K=K.longitude;var X=w.getLonDeltaForDistance(J,L,R)/2;L=K-X;K+=X;J=c.deg2rad(J);J=(1+Math.sin(J))/(1-Math.sin(J));X=(J+1)*Math.tan(G/R/2);J=1.5*Math.PI-2*Math.atan(.5*(X+Math.sqrt(4*J+
X*X)));G=J+G/R;J=P(J);G=P(G);G<J&&(R=G,G=J,J=R);J=Math.max(c.rad2deg(J),-90);G=Math.min(c.rad2deg(G),90);K=C.monotonic(L,K);180<K-L&&(R=(K-L-180)/2,L+=R,K-=R);R=F.spatialReference&&F.spatialReference.isGeographic?F.spatialReference:e.WGS84;O?(O.xmin=L,O.ymin=J,O.xmax=K,O.ymax=G,O.spatialReference=R):O=new q(L,J,K,G,R);F.spatialReference&&F.spatialReference.isWebMercator&&m.geographicToWebMercator(O,!1,O);return O}const z=k.fromValues(0,0,1),A=n.normalize(k.create(),k.fromValues(1,1,1)),C=new a.Cyclical(-180,
180),E=f.create(),B=k.create(),D=k.create();f=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:x,eyeForCenterWithHeadingTilt:p,eyeTiltToLookAtTilt:u,headingTiltToDirectionUp:v,lookAtTiltToEyeTilt:r,toExtent:y},Symbol.toStringTag,{value:"Module"}));b.cameraUtilsSpherical=f;b.directionToHeadingTilt=x;b.eyeForCenterWithHeadingTilt=p;b.eyeTiltToLookAtTilt=u;b.headingTiltToDirectionUp=v;b.lookAtTiltToEyeTilt=r;b.toExtent=y})},"esri/views/3d/support/earthUtils":function(){define(["exports",
"../../../core/mathUtils","../../../geometry/ellipsoidUtils","../../../geometry/Point"],function(b,a,c,d){function f(g,q,e){if(null==q.longitude||null==q.latitude||null==e.longitude||null==e.latitude)throw Error("Invalid points: no lon/lat");return n(g,q.longitude,q.latitude,e.longitude,e.latitude)}function n(g,q,e,m,l){e=a.deg2rad(e);l=a.deg2rad(l);q=a.deg2rad(q);const w=a.deg2rad(m);m=Math.sin((e-l)/2);q=Math.sin((q-w)/2);e=2*a.asinClamped(Math.sqrt(m*m+Math.cos(e)*Math.cos(l)*q*q));return Math.round(e*
g*1E4)/1E4}function k(g,q){g/=15;q||(g=Math.round(g));return g}b.getGreatCircleDistance=n;b.getGreatCircleDistanceFromPoints=f;b.getGreatCircleSpanAt=function(g,q,e){const m=q.spatialReference,l=c.getReferenceEllipsoid(m),w=new d(q.x,g.y,m),v=new d(e.x,g.y,m);q=new d(g.x,q.y,m);g=new d(g.x,e.y,m);return{lon:f(l.radius,w,v),lat:f(l.radius,q,g)}};b.getLonDeltaForDistance=function(g,q,e){q/=e;g=a.deg2rad(g);q=Math.sin(q/2);g=Math.cos(g);g=2*a.asinClamped(Math.sqrt(q*q/(g*g)));return a.rad2deg(g)};b.longitudeToTimezone=
k;b.positionToTimezoneInfo=function(g,q){g=g?.[0];if(null==g)return null;q||(q={hours:0,minutes:0,seconds:0});q.hours=k(g,!0);g=q.hours%1;q.hours-=g;q.minutes=60*g;g=q.minutes%1;q.minutes-=g;q.seconds=Math.round(60*g);return q};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/ElevationProvider":function(){define(["exports","../../../layers/graphics/dehydratedFeatureUtils"],function(b,a){function c(f){return"array"in f}class d{constructor(f,n=null,k=0){this.array=
f;this.spatialReference=n;this.offset=k}}b.SamplePosition=d;b.getElevationAtPoint=function(f,n,k="ground"){if(a.isDehydratedPoint(n))return f.getElevation(n.x,n.y,n.z||0,n.spatialReference,k);if(c(n)){let g=n.offset;return f.getElevation(n.array[g++],n.array[g++],n.array[g]||0,n.spatialReference??f.spatialReference,k)}return f.getElevation(n[0],n[1],n[2]||0,f.spatialReference,k)};b.isSamplePosition=c;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/dehydratedFeatureUtils":function(){define(["exports"],
function(b){b.isDehydratedPoint=function(a){return"point"===a.type};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/GroundViewElevationSampler":function(){define("../../chunks/tslib.es6 ../../core/Evented ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../geometry/SpatialReference ../../geometry/support/aaBoundingRect ../../geometry/support/contains ../../layers/support/ElevationSampler ../3d/terrain/TerrainConst".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w){a=class extends a.EventedAccessor{constructor(v){super(v);this.demResolution={min:-1,max:-1};this.noDataValue=w.elevationNodataValue}initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get extent(){const v=this.view.basemapTerrain;if(null==v?.extent||null==v.spatialReference)return null;const x=e.toExtent(v.extent,v.spatialReference);x.zmin=v.visibleElevationBounds.min;x.zmax=v.visibleElevationBounds.max;return x}get spatialReference(){return this.view.basemapTerrain?.spatialReference??
q.WGS84}elevationAt(v,x){if(null==this.extent||!m.extentContainsXYZ(this.extent,v,x)){const p=null!=this.extent?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;c.getLogger(this).warn("#elevationAt()",`Point used to sample elevation (${v}, ${x}) is outside of the sampler extent (${p})`);return this.noDataValue}return this.view.elevationProvider?.getElevation(v,x,0,this.spatialReference,"ground")??this.noDataValue}queryElevation(v){return l.updateGeometryElevation(v.clone(),
this)}};b.__decorate([d.property({readOnly:!0})],a.prototype,"demResolution",void 0);b.__decorate([d.property({readOnly:!0})],a.prototype,"extent",null);b.__decorate([d.property({readOnly:!0})],a.prototype,"noDataValue",void 0);b.__decorate([d.property()],a.prototype,"spatialReference",null);b.__decorate([d.property({constructOnly:!0})],a.prototype,"view",void 0);return a=b.__decorate([g.subclass("esri.views.support.GroundViewElevationSampler")],a)})},"esri/layers/support/ElevationSampler":function(){define("exports ../../geometry ../../core/has ../../core/handleUtils ../../core/Logger ../../core/unitUtils ../../geometry/support/aaBoundingRect ../../geometry/support/webMercatorUtils ../../geometry/Point".split(" "),
function(b,a,c,d,f,n,k,g,q){function e(h,t){const r=m(h,t.spatialReference);if(!r)return null;switch(h.type){case "point":h.z=t.elevationAt(r.x,r.y);break;case "polyline":p.spatialReference=r.spatialReference;var u=h.hasM&&!h.hasZ;for(var y=0;y<h.paths.length;y++){var z=h.paths[y],A=r.paths[y];for(let C=0;C<z.length;C++){const E=z[C],B=A[C];p.x=B[0];p.y=B[1];u&&(E[3]=E[2]);E[2]=t.elevationAt(p.x,p.y)}}h.hasZ=!0;break;case "multipoint":p.spatialReference=r.spatialReference;u=h.hasM&&!h.hasZ;for(y=
0;y<h.points.length;y++)z=h.points[y],A=r.points[y],p.x=A[0],p.y=A[1],u&&(z[3]=z[2]),z[2]=t.elevationAt(p.x,p.y);h.hasZ=!0}return h}function m(h,t){if(null==h)return null;const r=h.spatialReference;if(r.equals(t))return h;(h=g.project(h,t))||l.error(`Cannot project geometry spatial reference (wkid:${r.wkid}) to elevation sampler spatial reference (wkid:${t.wkid})`);return h}const l=f.getLogger("esri.layers.support.ElevationSampler");class w{queryElevation(h){return e(h.clone(),this)}on(){return d.makeHandle()}projectIfRequired(h,
t){return m(h,t)}}class v extends w{get spatialReference(){return this.extent.spatialReference}constructor(h,t,r){super();this.tile=h;this.noDataValue=r;r=h.tile.extent;this.extent=k.toExtent(r,t.spatialReference);this.extent.zmin=h.zmin;this.extent.zmax=h.zmax;this._aaExtent=r;r=n.getMetersPerUnitForSR(t.spatialReference);h=t.lodAt(h.tile.level).resolution*r;this.demResolution={min:h,max:h}}contains(h){h=this.projectIfRequired(h,this.spatialReference);return null==h?!1:this.containsAt(h.x,h.y)}containsAt(h,
t){return k.containsXY(this._aaExtent,h,t)}elevationAt(h,t){if(!this.containsAt(h,t)){const r=this.extent;l.warn("#elevationAt()",`Point used to sample elevation (${h}, ${t}) is outside of the sampler extent (${`${r.xmin}, ${r.ymin}, ${r.xmax}, ${r.ymax}`})`);return this.noDataValue}return this.tile.sample(h,t)??this.noDataValue}}class x extends w{get spatialReference(){return this.extent.spatialReference}constructor(h,t,r){super();let u;"number"===typeof t?(this.noDataValue=t,u=null):(u=t,this.noDataValue=
r);this.samplers=u?h.map(y=>new v(y,u,this.noDataValue)):h;if(h=this.samplers[0]){this.extent=h.extent.clone();const {min:y,max:z}=h.demResolution;this.demResolution={min:y,max:z};for(h=1;h<this.samplers.length;h++)t=this.samplers[h],this.extent.union(t.extent),this.demResolution.min=Math.min(this.demResolution.min,t.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,t.demResolution.max)}else this.extent=k.toExtent(k.create(),u.spatialReference),this.demResolution={min:0,max:0}}elevationAt(h,
t){for(const r of this.samplers)if(r.containsAt(h,t))return r.elevationAt(h,t);l.warn("#elevationAt()",`Point used to sample elevation (${h}, ${t}) is outside of the sampler`);return this.noDataValue}}const p=new q;b.ElevationSamplerBase=w;b.MultiTileElevationSampler=x;b.TileElevationSampler=v;b.updateGeometryElevation=e;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TerrainConst":function(){define(["exports","../../../core/mathUtils","../../../geometry/support/aaBoundingRect",
"./TilingScheme"],function(b,a,c,d){a=a.clampFloat32(a.numberMaxFloat32/10);const f=c.create();d.TilingScheme.WebMercatorAuxiliarySphere.getExtent(0,0,0,f);c=c.create([-180,-90,180,90]);let n=3;b.elevationNodataValue=a;b.geographicWorldExtent=c;b.getElevationDesiredResolutionLevel=function(k){return 4>k?3:n};b.maxMemoryLodBias=2.5;b.maxPatchTesselation=512;b.maxRootTiles=64;b.progressiveLoadingModulo=2;b.test={setElevationDesiredMaxUpscalingDistance(k){n=null==k?3:k}};b.tileLoadingDebuglog=!1;b.tooManyRootTilesAfterChangeError=
"Cannot extend surface to encompass all layers because it would result in too many root tiles.";b.tooManyRootTilesForLayerError="Surface extent is too large for tile resolution at level 0.";b.webmercatorWorldExtent=f;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TilingScheme":function(){define("exports ../../../geometry ../../../core/Error ../../../core/mathUtils ../../../core/unitUtils ../../../geometry/Extent ../../../geometry/projection ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingRect ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils ../../../layers/support/LOD ../../../layers/support/TileInfo ../../../geometry/Point".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v){function x(){return new c("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}class p{constructor(t){var r=p.checkUnsupported(t);if(null!=r)throw r;this.spatialReference=t.spatialReference;this._isWebMercator=this.spatialReference.isWebMercator;this._isGCS=k.canProjectToWGS84ComparableLonLat(this.spatialReference)||e.isMars(this.spatialReference)||e.isMoon(this.spatialReference);this.origin=[t.origin.x,t.origin.y];this.pixelSize=t.size[0];
this.dpi=t.dpi;var u=t.lods.reduce((A,C,E)=>{C.level<A.min&&(A.min=C.level,A.minIndex=E);A.max=Math.max(A.max,C.level);return A},{min:Infinity,minIndex:0,max:-Infinity}),y=t.lods[u.minIndex];const z=2**y.level;r=y.resolution*z;y=y.scale*z;this.levels=Array(u.max+1);for(u=0;u<this.levels.length;u++)this.levels[u]={resolution:r,scale:y,tileSize:[r*t.size[0],r*t.size[1]]},r/=2,y/=2}clone(){return new p(this.toTileInfo())}toTileInfo(){return new w({dpi:this.dpi,origin:new v({x:this.origin[0],y:this.origin[1],
spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((t,r)=>new l({level:r,scale:t.scale,resolution:t.resolution}))})}getExtent(t,r,u,y){var z=this.levels[t];t=z.tileSize[0];z=z.tileSize[1];y[0]=this.origin[0]+u*t;y[2]=this.origin[0]+(u+1)*t;y[3]=this.origin[1]-r*z;y[1]=this.origin[1]-(r+1)*z}convertExtentToRadians(t,r){this._isWebMercator?(r[0]=m.x2lon(t[0]),r[1]=m.y2lat(t[1]),r[2]=m.x2lon(t[2]),r[3]=m.y2lat(t[3])):
this._isGCS&&(r[0]=d.deg2rad(t[0]),r[1]=d.deg2rad(t[1]),r[2]=d.deg2rad(t[2]),r[3]=d.deg2rad(t[3]))}getExtentGeometry(t,r,u,y=new n){this.getExtent(t,r,u,h);y.spatialReference=this.spatialReference;y.xmin=h[0];y.ymin=h[1];y.xmax=h[2];y.ymax=h[3];y.zmin=void 0;y.zmax=void 0;return y}ensureMaxLod(t){if(null==t)return!1;for(var r=!1;this.levels.length<=t;){r=this.levels[this.levels.length-1];const u=r.resolution/2;this.levels.push({resolution:u,scale:r.scale/2,tileSize:[u*this.pixelSize,u*this.pixelSize]});
r=!0}return r}capMaxLod(t){this.levels.length>t+1&&(this.levels.length=t+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(t){return this.levels[0].scale/2**t}levelAtScale(t){const r=this.levels[0].scale;return t>=r?0:Math.log(r/t)*Math.LOG2E}resolutionAtLevel(t){return this.levels[0].resolution/2**t}compatibleWith(t){if(!(t instanceof p)){if(p.checkUnsupported(t))return!1;t=new p(t)}if(!t.spatialReference.equals(this.spatialReference)||t.pixelSize!==this.pixelSize)return!1;const r=Math.min(this.levels.length,
t.levels.length)-1,u=this.levels[r].resolution;let y=.5*u;if(!d.floatEqualAbsolute(t.origin[0],this.origin[0],y)||!d.floatEqualAbsolute(t.origin[1],this.origin[1],y))return!1;y=.5*u/2**r/this.pixelSize*12;return d.floatEqualAbsolute(u,t.levels[r].resolution,y)}rootTilesInExtent(t,r=null,u=Infinity){const y=[],z=this.levels[0].tileSize;if(null==t||0===z[0]||0===z[1])return y;p.computeRowColExtent(t,z,this.origin,h);t=h[1];let A=h[3],C=h[0],E=h[2];var B=E-C;const D=A-t;B*D>u&&(u=Math.floor(Math.sqrt(u)),
D>u&&(t=t+Math.floor(.5*D)-Math.floor(.5*u),A=t+u),B>u&&(C=C+Math.floor(.5*B)-Math.floor(.5*u),E=C+u));for(u=t;u<A;u++)for(B=C;B<E;B++)y.push([0,u,B]);null!=r&&(r[0]=this.origin[0]+C*z[0],r[1]=this.origin[1]-A*z[1],r[2]=this.origin[0]+E*z[0],r[3]=this.origin[1]-t*z[1]);return y}static computeRowColExtent(t,r,u,y){const z=.001*(t[2]-t[0]+(t[3]-t[1]));y[0]=Math.max(0,Math.floor((t[0]+z-u[0])/r[0]));y[2]=Math.max(0,Math.ceil((t[2]-z-u[0])/r[0]));y[1]=Math.max(0,Math.floor((u[1]-t[3]+z)/r[1]));y[3]=Math.max(0,
Math.ceil((u[1]-t[1]-z)/r[1]))}static isPowerOfTwo(t){t=t.lods;const r=t[0].resolution*2**t[0].level;return!t.some(u=>!d.floatEqualRelative(u.resolution,r/2**u.level))}static hasGapInLevels(t){t=t.lods.map(r=>r.level);t.sort((r,u)=>r-u);for(let r=1;r<t.length;r++)if(t[r]!==t[0]+r)return!0;return!1}static tileSizeSupported(t){const r=t.size[1];return r===t.size[0]&&0===(r&r-1)&&128<=r&&512>=r}static hasOriginPerLODs(t){const r=t.origin;return t.lods.some(u=>null!=u.origin&&(u.origin[0]!==r.x||u.origin[1]!==
r.y))}static getMissingTileInfoError(){return new c("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(t){return null==t?x():1>t.lods.length?new c("tilingscheme:generic","Tiling scheme must have at least one level"):p.isPowerOfTwo(t)?p.hasGapInLevels(t)?new c("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):p.tileSizeSupported(t)?p.hasOriginPerLODs(t)?new c("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):
null:new c("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new c("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(t,r){const u=t[2]-t[0],y=t[3]-t[1],z=f.getMetersPerUnitForSR(r),A=1.2*Math.max(u,y);t=new p(new w({size:[256,256],origin:new v({x:t[0]-.5*(A-u),y:t[3]+.5*(A-y)}),lods:[new l({level:0,resolution:A/256,scale:1/(256/96*.0254/(A*z))})],spatialReference:r}));t.ensureMaxLod(20);return t}static makeWebMercatorAuxiliarySphere(t){const r=
new p(p.WebMercatorAuxiliarySphereTileInfo);r.ensureMaxLod(t);return r}static makeGCSWithTileSize(t,r=256,u=16){const y=256/r;t=new p(new w({size:[r,r],origin:new v({x:-180,y:90,spatialReference:t}),spatialReference:t,lods:[new l({level:0,resolution:.703125*y,scale:2.95497598570834E8*y})]}));t.ensureMaxLod(u);return t}get test(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}}p.WebMercatorAuxiliarySphereTileInfo=new w({size:[256,256],origin:new v({x:-2.0037508342787E7,y:2.0037508342787E7,
spatialReference:g.WebMercator}),spatialReference:g.WebMercator,lods:[new l({level:0,resolution:156543.03392800014,scale:5.91657527591555E8})]});p.WebMercatorAuxiliarySphere=p.makeWebMercatorAuxiliarySphere(19);const h=q.create();b.TilingScheme=p;b.getMissingTileInfoError=x;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/PopupView":function(){define("require exports ../chunks/tslib.es6 ../core/asyncUtils ../core/deprecate ../core/Error ../core/Logger ../core/promiseUtils ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ./input/InputManager".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x){function p(r){return null!=r&&"open"in r&&"declaredClass"in r}function h(r){return null!=r&&"declaredClass"in r&&"dockOptions"in r}const t=r=>Object.freeze(Object.defineProperty({__proto__:null,default:r},Symbol.toStringTag,{value:"Module"}));a.PopupView=r=>{r=class extends r{constructor(){super(...arguments);this._popupSetupTask=null;this.popup={};this.popupEnabled=!0}initialize(){this.addHandles([q.watch(()=>[this.ui,this.popup],([u,y],z)=>{if(z){const [A,
C]=z;A&&p(C)&&(C.view=null,h(C)&&A.remove(C,"popup"))}u&&p(y)&&(y.view=this,h(y)&&u.add(y,{key:"popup",position:"manual",internal:!0}))},q.initial),this.on("click",u=>{this.popup&&this.popupEnabled&&("mouse"!==u.pointerType||0===u.button)&&(!p(this.popup)&&"autoOpenEnabled"in this.popup&&!1===this.popup.autoOpenEnabled||(p(this.popup)?this.popup.viewModel.handleViewClick(u):u.async(async()=>{await this.setupPopup();p(this.popup)&&!this.destroyed&&this.ready&&this.popupEnabled&&this.popup.viewModel.handleViewClick(u)})))},
x.ViewEventPriorities.WIDGET)]);q.whenOnce(()=>this.ready&&this.popupEnabled&&!this.updating).then(()=>{new Promise((u,y)=>b(["../widgets/Popup"],z=>u(t(z)),y))})}destroy(){this.destroyed||this.closePopup()}async openPopup(u){p(this.popup)&&this.popup.open(u);try{await this.setupPopup(),this.popup?this.popup.open(u):k.getLogger(this).error(new n("view:null-popup","Popup is null and can't be opened"))}catch{}}closePopup(){this._popupSetupTask?.abort();p(this.popup)&&this.popup.close()}async fetchPopupFeatures(u,
y){await this.when();const {location:z,queryArea:A,layerViewsAndGraphics:C,clientOnlyGraphics:E}=await this._prepareFetchPopupFeatures(u,y);u=Promise.resolve(E);y=this._queryLayerPopupFeatures(A,C,y);const B=y.map(D=>D.promise);u=g.eachAlwaysValues([u,...B]).then(D=>Array.from(new Set(D.flat())));return{location:z,clientOnlyGraphics:E,allGraphicsPromise:u,promisesPerLayerView:y}}async setupPopup(){this._popupSetupTask?.abort();if(this.popup&&!p(this.popup))return this._popupSetupTask=d.createTask(async u=>
{const {default:y}=await new Promise((z,A)=>b(["../widgets/Popup"],C=>z(t(C)),A));g.throwIfAborted(u);this.popup&&!p(this.popup)&&(u=this.popup,delete u.open,delete u.close,this.popup=new y(u))}),this._popupSetupTask.promise}_queryLayerPopupFeatures(u,y,z){return y.map(({layerView:A,graphics:C})=>{C=A.fetchPopupFeatures(u,{clientGraphics:C,event:null!=z?z.event:void 0,signal:null!=z?z.signal:void 0,defaultPopupTemplateEnabled:null!=z?!!z.defaultPopupTemplateEnabled:!1});return{layerView:A,promise:C}})}_isValidPopupGraphic(u,
y){return u&&!!u.getEffectivePopupTemplate(null!=y&&y.defaultPopupTemplateEnabled)}async _prepareFetchPopupFeatures(u,y){const {clientGraphics:z,queryArea:A,location:C}=await this._popupHitTestGraphics(u,y);u=this._getFetchPopupLayerViews();const {layerViewsAndGraphics:E,clientOnlyGraphics:B}=this._graphicsPerFetchPopupLayerView(z,u);return{clientOnlyGraphics:B,layerViewsAndGraphics:E,queryArea:A,location:C}}async _popupHitTestGraphics(u,y){var z=await this.popupHitTest(u);u=z.mapPoint;z=z.results.filter(C=>
"graphic"===C.type&&this._isValidPopupGraphic(C.graphic,y));const A=z.length?z[0].mapPoint:null;return{clientGraphics:z.map(C=>C.graphic),queryArea:u,location:u||A}}_getFetchPopupLayerViews(){const u=[];this.allLayerViews.forEach(y=>{this._isValidPopupLayerView(y)&&u.push(y)});null!=this.graphicsView&&this._isValidPopupLayerView(this.graphicsView)&&u.push(this.graphicsView);return u.reverse()}_isValidPopupLayerView(u){return null!=u&&(!("layer"in u)||!u.suspended)&&"fetchPopupFeatures"in u}_graphicsPerFetchPopupLayerView(u,
y){const z=[],A=new Map;y=y.map(C=>{const E=[];"layer"in C?A.set(C.layer,E):A.set(C.graphics,E);return{layerView:C,graphics:E}});for(const C of u)(u=A.get(C.layer)||A.get(C.sourceLayer)||null)?u.push(C):z.push(C);return{layerViewsAndGraphics:y,clientOnlyGraphics:z}}};c.__decorate([e.property({cast(u){if(!u||p(u))return u;"object"===typeof u&&(u.open=y=>{f.deprecated(k.getLogger(this),"view.popup is no longer created by default. view.popup.open() will stop working when the popup isn't created",{replacement:"Use view.openPopup() instead.",
version:"4.27"});return this.openPopup(y)},u.close=()=>{f.deprecated(k.getLogger(this),"view.popup is no longer created by default. view.popup.close() will stop working when the popup isn't created",{replacement:"Use view.closePopup() instead.",version:"4.27"});return this.closePopup()});return u}})],r.prototype,"popup",void 0);c.__decorate([e.property()],r.prototype,"popupEnabled",void 0);return r=c.__decorate([v.subclass("esri.views.PopupView")],r)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/layerViewModuleImportUtils":function(){define(["require","exports","../../core/Error"],function(b,a,c){const d=g=>Object.freeze(Object.defineProperty({__proto__:null,default:g},Symbol.toStringTag,{value:"Module"})),f=()=>new Promise((g,q)=>b(["./layers/TileLayerView3D"],e=>g(d(e)),q)),n=()=>new Promise((g,q)=>b(["./layers/ElevationLayerView3D"],e=>g(d(e)),q)),k={"base-dynamic":()=>new Promise((g,q)=>b(["./layers/BaseDynamicLayerView3D"],e=>g(d(e)),q)),"base-elevation":n,"base-tile":f,
"bing-maps":f,"building-scene":()=>new Promise((g,q)=>b(["./layers/BuildingSceneLayerView3D"],e=>g(d(e)),q)),csv:()=>new Promise((g,q)=>b(["./layers/CSVLayerView3D"],e=>g(d(e)),q)),dimension:()=>new Promise((g,q)=>b(["./layers/DimensionLayerView3D"],e=>g(d(e)),q)),elevation:n,feature:()=>new Promise((g,q)=>b(["./layers/FeatureLayerView3D"],e=>g(d(e)),q)),geojson:()=>new Promise((g,q)=>b(["./layers/GeoJSONLayerView3D"],e=>g(d(e)),q)),graphics:()=>new Promise((g,q)=>b(["./layers/GraphicsLayerView3D"],
e=>g(d(e)),q)),group:()=>new Promise((g,q)=>b(["../layers/GroupLayerView"],e=>g(d(e)),q)),imagery:()=>new Promise((g,q)=>b(["./layers/ImageryLayerView3D"],e=>g(d(e)),q)),"integrated-mesh":()=>new Promise((g,q)=>b(["./layers/IntegratedMeshLayerView3D"],e=>g(d(e)),q)),"line-of-sight":()=>new Promise((g,q)=>b(["./layers/LineOfSightLayerView3D"],e=>g(d(e)),q)),"map-image":()=>new Promise((g,q)=>b(["./layers/MapImageLayerView3D"],e=>g(d(e)),q)),media:()=>new Promise((g,q)=>b(["./layers/MediaLayerView3D"],
e=>g(d(e)),q)),"ogc-feature":()=>new Promise((g,q)=>b(["./layers/OGCFeatureLayerView3D"],e=>g(d(e)),q)),"open-street-map":f,"oriented-imagery":()=>new Promise((g,q)=>b(["./layers/FeatureLayerView3D"],e=>g(d(e)),q)),"point-cloud":()=>new Promise((g,q)=>b(["./layers/PointCloudLayerView3D"],e=>g(d(e)),q)),voxel:()=>new Promise((g,q)=>b(["./layers/VoxelLayerView3D"],e=>g(d(e)),q)),route:()=>new Promise((g,q)=>b(["./layers/RouteLayerView3D"],e=>g(d(e)),q)),scene:g=>null==g.profile||"mesh-pyramids"===g.profile?
new Promise((q,e)=>b(["./layers/SceneLayerView3D"],m=>q(d(m)),e)):new Promise((q,e)=>b(["./layers/SceneLayerGraphicsView3D"],m=>q(d(m)),e)),stream:()=>new Promise((g,q)=>b(["./layers/StreamLayerView3D"],e=>g(d(e)),q)),tile:f,"imagery-tile":()=>new Promise((g,q)=>b(["./layers/ImageryTileLayerView3D"],e=>g(d(e)),q)),"vector-tile":()=>new Promise((g,q)=>b(["./layers/VectorTileLayerView3D"],e=>g(d(e)),q)),wcs:()=>new Promise((g,q)=>b(["./layers/ImageryTileLayerView3D"],e=>g(d(e)),q)),"web-tile":f,wfs:()=>
new Promise((g,q)=>b(["./layers/WFSLayerView3D"],e=>g(d(e)),q)),wms:()=>new Promise((g,q)=>b(["./layers/WMSLayerView3D"],e=>g(d(e)),q)),wmts:()=>new Promise((g,q)=>b(["./layers/WMTSLayerView3D"],e=>g(d(e)),q)),"geo-rss":null,kml:null,"knowledge-graph":null,"link-chart":null,"knowledge-graph-sublayer":null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null,video:null};a.layerView3DImporter={hasLayerViewModule:g=>null!=k[g.type],importLayerView:g=>{var q=k[g.type];if(null==q)throw g=
g.declaredClass?g.declaredClass.slice(g.declaredClass.lastIndexOf(".")+1):"Unknown",q=g.replaceAll(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),new c(`${q}:view-not-supported`,`${g} is not supported in 3D`);return q(g)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/analysis/AnalysisViewManager3D":function(){define("require ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/asyncUtils ../../../core/Collection ../../../core/Error ../../../core/handleUtils ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/scheduling ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/subclass".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w){function v(){const t=e.createResolver();t.promise.catch(()=>{});return t}const x=t=>Object.freeze(Object.defineProperty({__proto__:null,default:t},Symbol.toStringTag,{value:"Module"}));var p;(function(t){t[t.PENDING=0]="PENDING";t[t.CREATED=1]="CREATED"})(p||(p={}));var h;(function(t){t[t.ADDED=0]="ADDED";t[t.REMOVED=1]="REMOVED"})(h||(h={}));c=class extends c{constructor(t){super(t);this._allAnalysisViews=new f;this._creatingViewCount=0;this._items=new Map;this._scheduledUpdateHandle=
null;this._attachedToViewResolver=v();this._analysisModules={"area-measurement":{module:null},dimension:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}}}destroy(){this._disconnectOwners();this._attachedToViewResolver.reject(e.createAbortError("AnalysisViewManager was destroyed"))}attach(){this._connectOwners();this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners();this._attachedToViewResolver.reject(e.createAbortError());this._attachedToViewResolver=
v()}get updating(){return!this.view.ready||0!==this._creatingViewCount||this._allAnalysisViews.some(t=>t.updating)}get testInfo(){return{allAnalysisViews:this._allAnalysisViews}}async whenAnalysisView(t){await this._attachedToViewResolver.promise;const r=this._items.get(t);if(null==r||r.state.list===h.REMOVED)throw new n("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:t});return r.createAnalysisViewTask.promise}_connectOwners(){this.addHandles(this._connectAnalysesCollection(this.view.analyses),
"analyses-owner-handles")}_disconnectOwners(){this.removeHandles("analyses-owner-handles");this._update();this._creatingViewCount=0}_connectAnalysesCollection(t){for(const y of t)this._addAnalysis(y);const r=t.on("after-add",y=>this._addAnalysis(y.item)),u=t.on("after-remove",y=>this._removeAnalysis(y.item));return k.makeHandle(()=>{r.remove();u.remove();for(const y of t)this._removeAnalysis(y)})}_addAnalysis(t){const r=this._items.get(t);if(null==r){const u={state:{view:p.PENDING,list:h.ADDED},analysis:t,
view:null,createAnalysisViewTask:null};this._items.set(t,u);u.createAnalysisViewTask=d.createTask(y=>this._createAnalysisViewPromise(u,y))}else r.state.list=h.ADDED}_removeAnalysis(t){t=this._items.get(t);null==t?g.getLogger(this).error("Trying to remove analysis which was not added"):(t.state.list=h.REMOVED,this._scheduleUpdate())}_scheduleUpdate(){null==this._scheduledUpdateHandle&&(this._scheduledUpdateHandle=m.schedule(()=>this._update()))}_update(){this._scheduledUpdateHandle=q.removeMaybe(this._scheduledUpdateHandle);
this._items.forEach(t=>{if(t.state.list===h.REMOVED)switch(this._items.delete(t.analysis),t.state.view){case p.PENDING:t.createAnalysisViewTask=q.abortMaybe(t.createAnalysisViewTask);break;case p.CREATED:null!=t.view&&(this._allAnalysisViews.remove(t.view),t.view=q.destroyMaybe(t.view),t.createAnalysisViewTask=null)}})}async _createAnalysisViewPromise(t,r){var u=t.analysis;const y=u.type,z=this._analysisModules[y];this._creatingViewCount+=1;if(null==z.module)try{z.module=await this._loadAnalysisModule(y)}catch(A){throw--this._creatingViewCount,
A;}if(e.isAborted(r))throw--this._creatingViewCount,e.createAbortError("AnalysisView creation aborted");u=new z.module.default({analysis:u,view:this.view});try{await u.when()}catch(A){throw--this._creatingViewCount,A;}if(e.isAborted(r))throw--this._creatingViewCount,u.destroy(),e.createAbortError("AnalysisView creation aborted");t.view=u;t.state.view=p.CREATED;this._allAnalysisViews.add(u);--this._creatingViewCount;return u}_loadAnalysisModule(t){switch(t){case "area-measurement":return new Promise((r,
u)=>b(["./AreaMeasurementAnalysisView3D"],y=>r(x(y)),u));case "dimension":return new Promise((r,u)=>b(["./DimensionAnalysisView3D"],y=>r(x(y)),u));case "direct-line-measurement":return new Promise((r,u)=>b(["./DirectLineMeasurementAnalysisView3D"],y=>r(x(y)),u));case "line-of-sight":return new Promise((r,u)=>b(["./LineOfSightAnalysisView3D"],y=>r(x(y)),u));case "slice":return new Promise((r,u)=>b(["./SliceAnalysisView3D"],y=>r(x(y)),u))}}};a.__decorate([l.property()],c.prototype,"updating",null);
a.__decorate([l.property({constructOnly:!0})],c.prototype,"view",void 0);a.__decorate([l.property()],c.prototype,"_allAnalysisViews",void 0);a.__decorate([l.property()],c.prototype,"_creatingViewCount",void 0);return c=a.__decorate([w.subclass("esri.views.3d.analysis.AnalysisViewManager3D")],c)})},"esri/views/3d/constraints/Constraints":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./AltitudeConstraint ./ClipDistanceConstraint ./TiltConstraint".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m){b.Constraints=class extends c{constructor(){super(...arguments);this.tilt=new m.TiltConstraint;this.altitude=new q.AltitudeConstraint;this.clipDistance=new e.ClipDistanceConstraint}};a.__decorate([d.property({type:m.TiltConstraint})],b.Constraints.prototype,"tilt",void 0);a.__decorate([d.property({type:q.AltitudeConstraint})],b.Constraints.prototype,"altitude",void 0);a.__decorate([d.property({type:e.ClipDistanceConstraint})],b.Constraints.prototype,"clipDistance",
void 0);b.Constraints=a.__decorate([g.subclass("esri.views.3d.constraints.Constraints")],b.Constraints);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/constraints/AltitudeConstraint":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../state/Constraints".split(" "),
function(b,a,c,d,f,n,k,g,q){b.AltitudeConstraint=class extends c{constructor(){super(...arguments);this.min=q.earthAltitudeConstraint.min;this.max=q.earthAltitudeConstraint.max}};a.__decorate([d.property({type:Number})],b.AltitudeConstraint.prototype,"min",void 0);a.__decorate([d.property({type:Number})],b.AltitudeConstraint.prototype,"max",void 0);b.AltitudeConstraint=a.__decorate([g.subclass("esri.views.3d.constraints.AltitudeConstraint")],b.AltitudeConstraint);Object.defineProperty(b,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/state/Constraints":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Logger ../../../core/mathUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/Ellipsoid ../../ViewingMode ../support/mathUtils".split(" "),function(b,a,c,d,f,n,k,g,q,e,m,l,w){b.Constraints=class extends c{constructor(h){super(h);
this.collision=new p;this.distance=Infinity;this.minimumPoiDistance=4;this.tilt=null}get altitude(){return this.mode===l.ViewingMode.Local?null:this._get("altitude")||null}set altitude(h){this.mode===l.ViewingMode.Local?d.getLogger(this).warn("Altitude constraint is ignored in local scenes"):this._set("altitude",h)}clampAltitude(h){return this.altitude?f.clamp(h,this.altitude.min,this.altitude.max):h}clampTilt(h,t){if(!this.tilt)return t;h=this.tilt(h);return f.clamp(t,h.min,h.max)}clampDistance(h){return Math.min(h,
this.distance)}createDefaultTilt(){return this.mode===l.ViewingMode.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(h){return(t,r=x)=>{r.min=v.min;r.max=h;return r}}_createDefaultTiltLocal(){const h=this.collision.enabled?w.makePiecewiseLinearFunction([[4E3,v.max],[1E4,f.deg2rad(88)],[6E6,f.deg2rad(88)]]):()=>v.max;return(t,r=x)=>{r.min=v.min;r.max=h(t);return r}}_createDefaultTiltGlobal(){const h=this.collision.enabled?w.makePiecewiseLinearFunction([[4E3,
v.max],[5E4,f.deg2rad(88)],[6E6,f.deg2rad(88)],[2E7,v.min]]):w.makePiecewiseLinearFunction([[3E5,v.max],[3E6,f.deg2rad(88)],[6E6,f.deg2rad(88)],[2E7,v.min]]);return(t,r=x)=>{r.min=v.min;r.max=h(t);return r}}};a.__decorate([n.property()],b.Constraints.prototype,"altitude",null);a.__decorate([n.property({readOnly:!0})],b.Constraints.prototype,"collision",void 0);a.__decorate([n.property()],b.Constraints.prototype,"distance",void 0);a.__decorate([n.property({readOnly:!0})],b.Constraints.prototype,"minimumPoiDistance",
void 0);a.__decorate([n.property()],b.Constraints.prototype,"tilt",void 0);a.__decorate([n.property({constructOnly:!0})],b.Constraints.prototype,"mode",void 0);b.Constraints=a.__decorate([e.subclass("esri.views.3d.state.Constraints")],b.Constraints);k={min:-2E5,max:4*m.earth.radius};const v={min:f.deg2rad(.5),max:f.deg2rad(179.5)},x={min:0,max:0};let p=class extends c{constructor(){super(...arguments);this.enabled=!0;this.elevationMargin=5}};a.__decorate([n.property({type:Boolean})],p.prototype,"enabled",
void 0);a.__decorate([n.property({type:Number})],p.prototype,"elevationMargin",void 0);p=a.__decorate([e.subclass("esri.views.3d.state.Constraints.CollisionConstraint")],p);b.TiltDefault=v;b.earthAltitudeConstraint=k;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/constraints/ClipDistanceConstraint":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/cast ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass".split(" "),
function(b,a,c,d,f,n,k,g){b.ClipDistanceConstraint=class extends c{constructor(){super(...arguments);this.mode="auto"}get near(){return this._get("near")}set near(q){this._set("near",q);q>=this._get("far")&&(this.far=q+1E-9);this.mode="manual"}castNear(q){return Math.max(1E-8,q)}get far(){return this._get("far")}set far(q){this._set("far",q);q<=this._get("near")&&(this.near=q-1E-9);this.mode="manual"}castFar(q){return Math.max(1E-8,q)}autoUpdate(q,e){"auto"===this.mode&&(this._get("near")!==q&&this._set("near",
q),this._get("far")!==e&&this._set("far",e))}};a.__decorate([d.property({type:Number,value:1E-8})],b.ClipDistanceConstraint.prototype,"near",null);a.__decorate([f.cast("near")],b.ClipDistanceConstraint.prototype,"castNear",null);a.__decorate([d.property({type:Number,value:1E-8})],b.ClipDistanceConstraint.prototype,"far",null);a.__decorate([f.cast("far")],b.ClipDistanceConstraint.prototype,"castFar",null);a.__decorate([d.property({type:["auto","manual"]})],b.ClipDistanceConstraint.prototype,"mode",
void 0);b.ClipDistanceConstraint=a.__decorate([g.subclass("esri.views.3d.constraints.ClipDistanceConstraint")],b.ClipDistanceConstraint);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/constraints/TiltConstraint":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/mathUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/cast ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../state/Constraints".split(" "),
function(b,a,c,d,f,n,k,g,q,e){var m=d.rad2deg(e.TiltDefault.min),l=d.rad2deg(e.TiltDefault.max);b.TiltConstraint=class extends c{constructor(){super(...arguments);this.mode="auto"}get max(){return this._get("max")}set max(w){this._set("max",w);this.mode="manual"}castMax(w){return d.clamp(w,m,l)}autoUpdate(w){"auto"===this.mode&&this._get("max")!==w&&this._set("max",w)}};a.__decorate([f.property({type:["auto","manual"]})],b.TiltConstraint.prototype,"mode",void 0);a.__decorate([f.property({type:Number,
value:l})],b.TiltConstraint.prototype,"max",null);a.__decorate([n.cast("max")],b.TiltConstraint.prototype,"castMax",null);b.TiltConstraint=a.__decorate([q.subclass("esri.views.3d.constraints.TiltConstraint")],b.TiltConstraint);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/SceneViewEnvironment":function(){define("../../../chunks/tslib.es6 ../../../core/compilerUtils ../../../core/handleUtils ../../../core/lang ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/cast ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/ensureType ./lightingUtils ./SceneViewAtmosphere ./SunLighting ./VirtualLighting ../../../webscene/Environment ../../../webscene/SunLighting ../../../webscene/VirtualLighting".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x){var p;w=p=class extends w{constructor(h){super(h);this.atmosphere=new e.SceneViewAtmosphere;this.lighting=this.castLighting();this.cachedCameraTrackingEnabled=null}static fromWebsceneEnvironment(h){h=h.cloneConstructProperties();return new p({...h,lighting:h.lighting?"virtual"===h.lighting.type?l.fromWebsceneLighting(h.lighting):m.fromWebsceneLighting(h.lighting):void 0})}castLighting(h){return this._convertLightingWithDestroy(h)}applyLighting(h){this.lighting=
this._convertLightingWithDestroy(h)}_convertLightingWithDestroy(h){const t=this._convertLighting(h);t!==h&&this.addHandles(c.destroyHandle(t));return t}_convertLighting(h){return h?h instanceof m||h instanceof l?h:h instanceof v?this.lighting&&"virtual"!==this.lighting.type?this.lighting.cloneWithWebsceneLighting(h):new m({...h.cloneConstructProperties(),...this.lighting?.cloneNonPersistentConstructProperties()}):h instanceof x?this.lighting&&"virtual"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(h):
new l({...h.cloneConstructProperties(),...this.lighting?.cloneNonPersistentConstructProperties()}):g.ensureOneOfType(q.lightingTypes,h):new m}clone(){return new p({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:d.clone(this.background)})}cloneWithWebsceneEnvironment(h){return new p({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,
starsEnabled:this.starsEnabled,background:d.clone(this.background),...h.cloneConstructProperties(),lighting:this._getLighting(h)})}_getLighting(h){switch(h.lighting.type){case "sun":return this.lighting&&"sun"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(h.lighting):m.fromWebsceneLighting(h.lighting);case "virtual":return this.lighting&&"virtual"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(h.lighting):l.fromWebsceneLighting(h.lighting);default:return a.neverReached(h.lighting),
m.fromWebsceneLighting(h.lighting)}}};b.__decorate([f.property({type:e.SceneViewAtmosphere,json:{read:!1},nonNullable:!0})],w.prototype,"atmosphere",void 0);b.__decorate([f.property({nonNullable:!0})],w.prototype,"lighting",void 0);b.__decorate([n.cast("lighting")],w.prototype,"castLighting",null);return w=p=b.__decorate([k.subclass("esri.views.3d.environment.SceneViewEnvironment")],w)})},"esri/views/3d/environment/lightingUtils":function(){define(["exports","./SunLighting","./VirtualLighting"],function(b,
a,c){b.lightingTypes={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:a,virtual:c}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/SunLighting":function(){define("../../../chunks/tslib.es6 ../../../core/deprecate ../../../core/Evented ../../../core/Logger ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../webscene/SunLighting".split(" "),
function(b,a,c,d,f,n,k,g,q,e){var m;const l=d.getLogger("esri.views.3d.environment.SunLighting");c=m=class extends c.EventedMixin(e){constructor(v){super(v);this.cameraTrackingEnabled=!0;this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};v=(new Date).getFullYear();v=new Date("March 15, "+v+" 12:00:00 UTC");this._set("defaultDate",v);this._set("date",v)}get ambientOcclusionEnabled(){a.deprecatedProperty(l,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",
version:"4.27"});return this._get("ambientOcclusionEnabled")??!1}set ambientOcclusionEnabled(v){a.deprecatedProperty(l,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"});this._set("ambientOcclusionEnabled",v)}get waterReflectionEnabled(){a.deprecatedProperty(l,"waterReflectionEnabled",{replacement:"reflections are automatically shown and this property has no effect",version:"4.27"});return this._get("waterReflectionEnabled")??
!1}set waterReflectionEnabled(v){a.deprecatedProperty(l,"waterReflectionEnabled",{replacement:"reflections are automatically shown and this property has no effect",version:"4.27"});this._set("waterReflectionEnabled",v)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(v){return new m(v.cloneConstructProperties())}set defaultDate(v){const x=this._get("date")===this._get("defaultDate");v=new Date(v.getTime());this._set("defaultDate",v);x&&this._set("date",
v)}set date(v){null!=v&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(v.getTime())))}autoUpdate(v,x){const p=m.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=x.hours;this.positionTimezoneInfo.minutes=x.minutes;this.positionTimezoneInfo.seconds=x.seconds;x=null;null!=v&&(this.positionTimezoneInfo.autoUpdated=!0,isNaN(v.getTime())?(x=this.defaultDate.getTime(),this._set("date",this.defaultDate)):(x=this.date&&this.date.getTime(),this._set("date",
new Date(v.getTime()))));const h=m.calculateTimezoneOffset(this.positionTimezoneInfo);p!==h&&(w.target=this,w.timezoneOffset=h,this.emit("timezone-will-change",w),w.target=null);if(null!=v)return isNaN(v.getTime())||x!==v.getTime()}clone(){const v=this._get("date")===this._get("defaultDate"),x=new m({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled});v&&x._set("date",x._get("defaultDate"));x.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated;
x.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours;x.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes;x.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds;return x}cloneWithWebsceneLighting(v){const x=this.clone();null!=v.date&&(x.date=v.date);x.directShadowsEnabled=v.directShadowsEnabled;x.displayUTCOffset=v.displayUTCOffset;return x}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};b.__decorate([f.property({type:Boolean})],
c.prototype,"cameraTrackingEnabled",void 0);b.__decorate([f.property({type:Boolean})],c.prototype,"ambientOcclusionEnabled",null);b.__decorate([f.property({type:Boolean})],c.prototype,"waterReflectionEnabled",null);b.__decorate([f.property({type:Date})],c.prototype,"defaultDate",null);b.__decorate([f.property({type:Date})],c.prototype,"date",null);c=m=b.__decorate([q.subclass("esri.views.3d.environment.SunLighting")],c);(function(v){v.calculateTimezoneOffset=function({hours:x,minutes:p,seconds:h}){return Math.round(x+
p/60+h/3600)}})(c||(c={}));const w={target:null,timezoneOffset:0};return c})},"esri/views/3d/environment/VirtualLighting":function(){define("../../../chunks/tslib.es6 ../../../core/deprecate ../../../core/Evented ../../../core/Logger ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../webscene/VirtualLighting".split(" "),function(b,a,c,d,f,n,k,g,q,e){var m;const l=
d.getLogger("esri.views.3d.environment.VirtualLighting");c=m=class extends c.EventedMixin(e){constructor(w){super(w);this.cameraTrackingEnabled=!0}get ambientOcclusionEnabled(){a.deprecatedProperty(l,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"});return this._get("ambientOcclusionEnabled")??!1}set ambientOcclusionEnabled(w){a.deprecatedProperty(l,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",
version:"4.27"});this._set("ambientOcclusionEnabled",w)}get waterReflectionEnabled(){a.deprecatedProperty(l,"waterReflectionEnabled",{replacement:"water reflections are automatically shown and this property has no effect",version:"4.27"});return this._get("waterReflectionEnabled")??!1}set waterReflectionEnabled(w){a.deprecatedProperty(l,"waterReflectionEnabled",{replacement:"water reflections are automatically shown and this property has no effect",version:"4.27"});this._set("waterReflectionEnabled",
w)}clone(){return new m({...this.cloneConstructProperties(),cameraTrackingEnabled:this.cameraTrackingEnabled})}static fromWebsceneLighting(w){return new m(w.cloneConstructProperties())}cloneWithWebsceneLighting(w){const v=this.clone();v.directShadowsEnabled=w.directShadowsEnabled;return v}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};b.__decorate([f.property({type:Boolean})],c.prototype,"ambientOcclusionEnabled",null);b.__decorate([f.property({type:Boolean})],
c.prototype,"waterReflectionEnabled",null);b.__decorate([f.property({type:Boolean})],c.prototype,"cameraTrackingEnabled",void 0);return c=m=b.__decorate([q.subclass("esri.views.3d.environment.VirtualLighting")],c)})},"esri/views/3d/environment/SceneViewAtmosphere":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass".split(" "),
function(b,a,c,d,f,n,k,g){var q;b.SceneViewAtmosphere=q=class extends c{set quality(e){["low","high"].includes(e)&&this._set("quality",e)}clone(){return new q({quality:this.quality})}};a.__decorate([d.property({type:["low","high"],value:"low"})],b.SceneViewAtmosphere.prototype,"quality",null);b.SceneViewAtmosphere=q=a.__decorate([g.subclass("esri.views.3d.environment.SceneViewAtmosphere")],b.SceneViewAtmosphere);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/SceneViewEnvironmentManager":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Evented ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projection ../../../geometry/projection/projectPointToWGS84ComparableLonLat ../../../geometry/support/spatialReferenceUtils ../../ViewingMode ./EnvironmentRenderer ../support/earthUtils ../support/sunUtils ../webgl-engine/lib/Update ../webgl-engine/lighting/Lightsources".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z){b.SceneViewEnvironmentManager=class extends c.EventedAccessor{constructor(){super();this._referencePointUpdateDelay=200;this._referencePointUpdateInterval=3E3;this._referencePointUpdateDistThreshold=1E6;this._referencePosMapCoordsRequested=this._referencePosUpdateQuery=null;this._viewHandlesKey="viewHandles";this._referencePosResetPreserveAbsoluteTime=this._trackingEnabled=this._preserveAbsoluteDateTime=!1;this._referencePosMapCoords=this._referencePosUpdateTimer=
null;this._mainLight=new z.MainLight;this._ambientLight=new z.AmbientLight;this._moonLight=new z.FillLight;this._disableWeather=this.disableQueries=!1;this._referencePosWGS84Comparable=this._renderer=null;this._resetReferencePosition()}destroy(){this.disconnectView()}get _view(){return this._renderer?.view}get updating(){return!((this.disableQueries||!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)&&!this._renderer?.updating)}get weatherEnabled(){return this._view?.environment.atmosphereEnabled&&
!this._disableWeather&&this._view?.state?.viewingMode===h.ViewingMode.Global&&p.isEarth(this._view.spatialReference)}get weatherVisible(){return this.weatherEnabled&&this._renderer?.weatherVisible}get referencePositionWGS84Comparable(){return this._referencePosWGS84Comparable}connectView(K){if(!this._renderer){this._renderer=new t.EnvironmentRenderer({view:K});var L=()=>this._updateRenderParameters(),G=()=>this._cameraHandler();this.addHandles([n.watch(()=>K.environment.lighting,O=>this._updateLightingHandler(O),
n.sync),n.watch(()=>"virtual"!==K.environment.lighting.type?K.environment.lighting.date:null,O=>this._lightingDateHandler(O),n.sync),n.watch(()=>K.stationary,()=>this._interactingStationaryHandler()),n.watch(()=>K.environment.lighting.directShadowsEnabled,L,n.sync),n.watch(()=>K.qualitySettings.ambientOcclusion,L,n.sync),n.watch(()=>K.qualitySettings.reflections,L,n.sync),n.watch(()=>K.spatialReference,()=>this._resetReferencePosition(!0),n.sync),n.watch(()=>K.environment.weather.type,()=>this._updateLighting(null,
y.Update.Faded),n.sync),n.watch(()=>this.weatherEnabled,()=>this._updateLighting(null,y.Update.Faded),n.sync),n.watch(()=>K.viewingMode,()=>this._resetReferencePosition(!0),n.syncAndInitial),n.watch(()=>"virtual"!==K.environment.lighting.type?K.environment.lighting.cameraTrackingEnabled:!1,O=>this._updateCameraTracking(O),n.syncAndInitial),n.watch(()=>K.state.camera,G,n.syncAndInitial),n.watch(()=>this.disableQueries,G)],this._viewHandlesKey);this._updateRenderParameters();this._updateLighting();
this._cameraHandler();this.notifyChange("updating")}}disconnectView(){this.removeHandles(this._viewHandlesKey);this._resetReferencePosition();this._renderer=d.destroyMaybe(this._renderer)}_updateLightingHandler(K){this._updateCameraTracking("virtual"!==K.type?K.cameraTrackingEnabled:!1);this._lightingDateHandler("virtual"!==K.type?K.date:null);this._updateRenderParameters()}_updateCameraTracking(K){(this._trackingEnabled=K)?this._cameraHandler():(K=this._view.environment.lighting,"virtual"!==K?.type&&
(K.positionTimezoneInfo.autoUpdated=!1))}_lightingDateHandler(K){const L=this._view.environment.lighting;if("virtual"===L?.type)this._updateLighting();else if(K){if(!L.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;if(!v.canProjectToWGS84ComparableLonLat(this._view.spatialReference)){var G=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(G)){this._requestReferencePositionUpdate(G);return}}this._preupdateTracking(K);null!=this._referencePosWGS84Comparable&&
(G=r.positionToTimezoneInfo(this._referencePosWGS84Comparable,B),null!=G&&(L.autoUpdate(null,G),this._trackingEnabled&&(L.positionTimezoneInfo.autoUpdated=!0)))}this._updateLighting(K)}}_preupdateTracking(K){!this._trackingEnabled&&"virtual"!==this._view.environment.lighting.type&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(K)}_cameraHandler(K=null){var L=this._view;L.ready&&(L=L.stateManager.camera)&&(this._cameraHandlerClientSide(L,K)||this._cameraHandlerServerSide(L))}_cameraHandlerClientSide(K,
L){const G=p.isEarth(this._view.spatialReference);if(G&&!v.canProjectToWGS84ComparableLonLat(this._view.spatialReference))return"virtual"===this._view.environment.lighting.type&&this._updateLighting(),!1;K=K.position;null==this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable=w.create());G?x.projectPointToWGS84ComparableLonLat(K,this._referencePosWGS84Comparable):l.set(this._referencePosWGS84Comparable,K.longitude??0,K.latitude??0,K.z??0);this.notifyChange("referencePositionWGS84Comparable");
this._autoUpdateTimezone(this._referencePosWGS84Comparable,L)||this._updateLighting(L);return!0}_cameraHandlerServerSide(K){K=K.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(K))&&this._requestReferencePositionUpdate(K,!0);this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=(K.z??0)*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())}_interactingStationaryHandler(){this._view.stationary&&
this._executePendingReferencePositionUpdate()}_updateLighting(K,L=y.Update.Immediate){var G=this._view;K=K||("virtual"===G.environment.lighting.type?null:G.environment.lighting.date);var O=this._referencePosWGS84Comparable;const P=null!=O?A:C;var J=this.weatherVisible?G.environment.weather.type:"disabled";null!=O?u.computeColorAndIntensity(K,O,G.state.viewingMode,J,G.state.camera,P):"virtual"===G.environment.lighting.type&&u.computeVirtualLightDirection(G.state.camera,G.state.viewingMode,P.direct.directionToLightSource);
K=this._mainLight;G=P.direct;l.scale(K.intensity,G.color,G.intensity*Math.PI);l.copy(K.direction,G.directionToLightSource);K.specularStrength=P.specularStrength;K.environmentStrength=P.environmentStrength;O=this._ambientLight;l.scale(O.intensity,P.ambient.color,P.ambient.intensity);J=this._moonLight;l.lerp(J.intensity,D,F,P.globalFactor);l.scale(J.intensity,J.intensity,(1-.5*P.globalFactor)*(1-.4*P.noonFactor*(1-P.globalFactor)));l.copy(J.direction,G.directionToLightSource);this._renderer.updateLightSources([K,
O,J],P.noonFactor,P.globalFactor,L);this._updateRenderParameters()}_autoUpdateTimezone(K,L=null){if("virtual"===this._view.environment.lighting.type||!this._view.environment.lighting.cameraTrackingEnabled||null==K)return!1;const G=E;G.setTime((L||this._view.environment.lighting.date).getTime());K=r.positionToTimezoneInfo(K,B);if(null==K)return!1;var O=this._view.environment.lighting.positionTimezoneInfo;if(!O.autoUpdated)O=K;else if(O.hours===K.hours&&O.minutes===K.minutes&&O.seconds===K.seconds)return!1;
const P=G.getUTCHours()-(K.hours-O.hours),J=G.getUTCMinutes()-(K.minutes-O.minutes);O=G.getUTCSeconds()-(K.seconds-O.seconds);G.setUTCHours(P);G.setUTCMinutes(J);G.setUTCSeconds(O);return L?!1:this._view.environment.lighting.autoUpdate(G,K)}_updateRenderParameters(){const K=this._view._stage;if(K){var L=null!=this._referencePosWGS84Comparable?u.computeShadowsEnabled(this._referencePosWGS84Comparable[2],this._view.state.viewingMode):!0;K.renderer.setParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&
L,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible,qualitySettings:this._view.qualitySettings})}}_resetReferencePosition(K=!1){this._cancelReferencePosUpdates();this._referencePosWGS84Comparable=this._referencePosResetPreserveAbsoluteTime=this._referencePosMapCoordsRequested=this._referencePosMapCoords=null;this.notifyChange("updating");K&&this._cameraHandler()}_requestReferencePositionUpdate(K,L=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?
this._referencePosMapCoordsRequested.copy(K):this._referencePosMapCoordsRequested=K.clone(),this._referencePosResetPreserveAbsoluteTime=!!L,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const G=this._referencePosUpdateQuery=f.after(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===G)return this._doReferencePositionUpdateQuery(()=>this._referencePosUpdateQuery!==G)}).catch(P=>{"mapcoordshelper:missing-geometry-service"===P.name&&
(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===G&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),O=this._referencePosUpdateTimer=f.after(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===O&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}}async _doReferencePositionUpdateQuery(K){this._referencePosResetPreserveAbsoluteTime&&
(this._preserveAbsoluteDateTime=!1);this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone();this._referencePosMapCoordsRequested=this._referencePosResetPreserveAbsoluteTime=null;const L=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);K()||isNaN(L[0])||isNaN(L[1])||(K=(this._referencePosMapCoords.z??0)*this._view.mapCoordsHelper.unitInMeters,this._referencePosWGS84Comparable?
(this._referencePosWGS84Comparable[0]=L[0],this._referencePosWGS84Comparable[1]=L[1],this._referencePosWGS84Comparable[2]=K):this._referencePosWGS84Comparable=[L[0],L[1],K],this._referencePosChanged())}_executePendingReferencePositionUpdate(){const K=this._referencePosMapCoordsRequested;K&&this._requestReferencePositionUpdate(K,this._referencePosResetPreserveAbsoluteTime)}_referencePosChanged(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||
this._updateLighting();this.notifyChange("referencePositionWGS84Comparable")}_exceedsReferencePosDistThreshold(K){return this._referencePosMapCoords?(K=this._referencePosMapCoords.distance(K),this._view.mapCoordsHelper&&(K*=this._view.mapCoordsHelper.unitInMeters),K>this._referencePointUpdateDistThreshold):!0}_cancelReferencePosUpdates(){const K=!!this._referencePosUpdateQuery;this._referencePosUpdateTimer=this._referencePosUpdateQuery=null;return K}get test(){const K=this;return{get renderer(){return K._renderer},
set referencePointUpdateInterval(L){K._referencePointUpdateInterval=L},set referencePointUpdateDistThreshold(L){K._referencePointUpdateDistThreshold=L},set referencePosUpdateTimer(L){K._referencePosUpdateTimer=L},set referencePointUpdateDelay(L){K._referencePointUpdateDelay=L},set disableWeather(L){K._disableWeather=L}}}};a.__decorate([k.property({type:Boolean,readOnly:!0})],b.SceneViewEnvironmentManager.prototype,"updating",null);a.__decorate([k.property()],b.SceneViewEnvironmentManager.prototype,
"disableQueries",void 0);a.__decorate([k.property()],b.SceneViewEnvironmentManager.prototype,"_disableWeather",void 0);a.__decorate([k.property()],b.SceneViewEnvironmentManager.prototype,"weatherEnabled",null);a.__decorate([k.property()],b.SceneViewEnvironmentManager.prototype,"weatherVisible",null);a.__decorate([k.property()],b.SceneViewEnvironmentManager.prototype,"referencePositionWGS84Comparable",null);a.__decorate([k.property()],b.SceneViewEnvironmentManager.prototype,"_renderer",void 0);a.__decorate([k.property()],
b.SceneViewEnvironmentManager.prototype,"_referencePosWGS84Comparable",void 0);b.SceneViewEnvironmentManager=a.__decorate([m.subclass("esri.views.3d.environment.SceneViewEnvironmentManager")],b.SceneViewEnvironmentManager);const A=new u.ColorAndIntensity,C=new u.ColorAndIntensity,E=new Date,B={hours:0,minutes:0,seconds:0},D=w.fromValues(.22,.22,.33),F=w.fromValues(.22,.22,.22);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/projectPointToWGS84ComparableLonLat":function(){define(["exports",
"../../chunks/vec3f64","./projectVectorToWGS84ComparableLonLat"],function(b,a,c){const d=a.create();b.projectPointToWGS84ComparableLonLat=function(f,n){d[0]=f.x;d[1]=f.y;const k=f.z;d[2]=void 0!==k?k:0;return c.projectVectorToWGS84ComparableLonLat(d,f.spatialReference,n)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/projectVectorToWGS84ComparableLonLat":function(){define(["exports","../../chunks/vec3f64","./projectors"],function(b,a,c){const d=a.create();
b.projectVectorToWGS84ComparableLonLat=function(f,n,k){if(null==n)return!1;n=c.getWGS84ComparableLonLatProjector(n);if(null==n)return!1;n(f,0,d,0);k!==d&&(k[0]=d[0],k[1]=d[1],2<k.length&&(k[2]=d[2]));return!0};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/EnvironmentRenderer":function(){define("exports ../../../chunks/tslib.es6 ../../../core/has ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/ellipsoidUtils ../../../geometry/support/spatialReferenceUtils ../../ViewingMode ./AtmosphereType ./ChapmanAtmosphere ./CloudsComposition ./CloudsData ./CloudsGenerator ./CloudsParameters ./CloudsPresets ./Fog ./LocalAtmosphere ./MarsAtmosphere ./Precipitation ./Stars ./weather ../webgl-engine/effects/RenderPlugin ../webgl-engine/lib/RenderSlot ../webgl-engine/lib/Update".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A,C,E,B,D,F,K,L,G){var O;b.EnvironmentRenderer=O=class extends K.SyncRenderPlugin{constructor(U){super(U);this.produces=new Map([[L.RenderSlot.ENVIRONMENT_OPAQUE,()=>!(null===this._atmosphere&&null===this._stars)],[L.RenderSlot.ENVIRONMENT_TRANSPARENT,()=>null!==this._atmosphere]]);this._atmosphere=this._context=null;this._oldWeatherParameters=new P;this._newWeatherParameters=new P;this._fadedWeatherParameters=new P;this._weatherParameters=this._newWeatherParameters}initialize(){this.view._stage.addRenderPlugin(this)}destroy(){this.removeHandles();
this.uninitializeRenderContext();null!=this.view?._stage&&this.view._stage.removeRenderPlugin(this);this._set("view",null)}get atmosphere(){return this._atmosphere}get _atmosphereType(){return null!=this.atmosphere?this.atmosphere.type:p.AtmosphereType.None}consumes(){return this._atmosphereType===p.AtmosphereType.Realistic?K.ConsumesDepth:K.ConsumesNone}updateAnimation(U){return null!=this._precipitation?this._precipitation.update(U):!1}get updating(){return null!=this._stars&&this._stars.updating||
null!=this._clouds&&this._clouds.running}get weatherVisible(){return m.length(this.view.state.camera.eye)-w.getReferenceEllipsoid(this.view.spatialReference).radius<=F.weatherHeightLimit}get usedMemory(){return this._clouds?.usedMemory??0}get _stars(){const U=this.view,M=U.environment?.starsEnabled??!1,V=this._get("_stars");return M&&null!=this._context?null!=V?V:new D.Stars({view:U,requestRender:()=>this._setNeedsRender()}):(f.destroyMaybe(V),null)}get _precipitation(){const U=this._get("_precipitation");
if(!this._precipitationEnabled||null==this._context)return f.destroyMaybe(U),null;const M=this.view,V=this._context;if(null!=U&&U.context===V)return U;f.destroyMaybe(U);return new B.Precipitation({context:V,view:M})}get _clouds(){const U=this._get("_clouds");if(!this.weatherEnabled||null==this._context)return f.destroyMaybe(U),null;if(null!=U)return U;const M=this.view,V=this._context;f.destroyMaybe(U);return new u.CloudsGenerator({context:V,view:M,requestRender:()=>this._setNeedsRender()})}get _cloudsComposition(){const U=
this._get("_cloudsComposition");if(!this.weatherEnabled||null==this._context)return f.destroyMaybe(U),null;const M=this.view.state.viewingMode,V=this._context.renderContext.rctx,Y=w.getReferenceEllipsoid(this.view.spatialReference).radius;if(null!=U&&U.viewingMode===M&&U.planetRadius===Y)return U;f.destroyMaybe(U);return new t.CloudsComposition({rctx:V,viewingMode:M,planetRadius:Y,requestRender:()=>this._setNeedsRender()})}get _fog(){const U=this._get("_fog");return this.weatherEnabled&&null!=this._context?
null!=U?U:new A.Fog({context:this._context,view:this.view,rctx:this._context.renderContext.rctx,viewingMode:this.view.state.viewingMode}):(f.destroyMaybe(U),null)}get weatherEnabled(){return!!this.view?.environmentManager?.weatherEnabled}get _precipitationEnabled(){return this.weatherEnabled&&("rainy"===this.view.environment.weather.type||"snowy"===this.view.environment.weather.type)}initializeRenderContext(U=null){this._context=U;U=()=>this._setNeedsRender();this.addHandles([n.watch(()=>({viewingMode:this.view.state.viewingMode,
enabled:this.view.environment.atmosphereEnabled}),M=>this._updateAtmosphere(M),n.syncAndInitial),n.watch(()=>this._stars,U),n.watch(()=>this._precipitation,U),n.watch(()=>this._clouds,()=>this._updateWeather(),n.initial),n.watch(()=>this._fog,()=>this._updateFogHaze(),n.initial),n.watch(()=>this.view.state.mode,()=>{this._setNeedsRender()},n.sync),n.watch(()=>this._weatherUpdateParameters,()=>{this._updateWeather();this._updateFogHaze()},n.syncAndInitial)])}uninitializeRenderContext(){this._context=
null;this._atmosphere=f.destroyMaybe(this._atmosphere);this._set("_stars",f.destroyMaybe(this._stars));this._set("_precipitation",f.destroyMaybe(this._precipitation));this._set("_clouds",f.destroyMaybe(this._clouds));this._set("_cloudsComposition",f.destroyMaybe(this._cloudsComposition));this._set("_fog",f.destroyMaybe(this._fog))}prepareRender(U){U.bindParameters.cloudsFade.data=r.isReadyCloudsData(this._clouds)?this._clouds:null;"local"!==this.view.viewingMode&&null!=U.bindParameters.cloudsFade.data?.cubeMap&&
(this._updateWeatherFading(U.bindParameters,U.time),U.bindParameters.cloudsFade.renderingStage===r.CloudsRenderingStages.FINISHED&&null!=this._clouds&&0===this._clouds.coverage&&!1===this._clouds.running&&(this._clouds.destroyFrameBufferCube(),U.bindParameters.cloudsFade.data=null))}renderNode(U){switch(U.bindParameters.slot){case L.RenderSlot.ENVIRONMENT_OPAQUE:null!=this._stars&&this._stars.render(U);null!=this.atmosphere&&(this.atmosphere.render(U,this.view?._stage?.renderer?.fullResolutionAtmosphere),
null!=this._cloudsComposition&&null!=U.bindParameters.cloudsFade.data&&(this.weatherVisible&&null!=this._clouds&&this._clouds.updateWeatherTile(),this._cloudsComposition.render(U)),U.bindParameters.cloudsFade.isFading&&null!=this._context&&null!=U.bindParameters.cloudsFade.data?.cubeMap&&this._context.requestRender());break;case L.RenderSlot.ENVIRONMENT_TRANSPARENT:if(null!=this.atmosphere&&(this.atmosphere.renderHaze(U,this._weatherParameters.hazeAmount,this.view?._stage?.renderer?.fullResolutionAtmosphere),
0<this._weatherParameters.fog.amount&&null!=this._fog&&this._fog.render(U,this._weatherParameters.fog),null!=this._precipitation)){const M=this.view.environment.weather;"rainy"!==M.type&&"snowy"!==M.type||this._precipitation.render(U,M.precipitation,M.type)}}}updateLightSources(U,M,V,Y){if(null!=this._context){const W=this._context.renderContext;W.bindParameters.oldLighting.copyFrom(W.bindParameters.lighting);W.bindParameters.newLighting.noonFactor=M;W.bindParameters.newLighting.globalFactor=V;W.bindParameters.newLighting.set(U);
Y===G.Update.Faded||W.bindParameters.weatherFading?W.bindParameters.fadeLighting(0):W.bindParameters.fadeLighting(1);this._context.requestRender()}}get _weatherUpdateParameters(){const U=this.weatherEnabled?this.view.environment.weather:null;return null==U?null:"rainy"===U.type||"snowy"===U.type?{type:U.type,weatherAdjustment:U.cloudCover,effect:U.precipitation}:{type:U.type,weatherAdjustment:"foggy"===U.type?U.fogStrength:U.cloudCover}}_updateWeatherFading(U,M){U.cloudsFade.updateFading(U.camera,
this.view.state.mode,M,this.view.qualitySettings.fadeDuration);U.cloudsFade.updateParallax(U.camera);U.weatherFading&&(this._updateLighting(U),this._updateFogAtmoshpere(U))}_updateLighting(U){U.cloudsFade.fadeMode===y.FadeMode.CROSS_FADE||U.cloudsFade.fadeMode===y.FadeMode.FADE_IN?U.fadeLighting(U.cloudsFade.fadeFactor):U.fadeLighting(0)}_updateFogAtmoshpere(U){U.cloudsFade.fadeMode===y.FadeMode.CROSS_FADE||U.cloudsFade.fadeMode===y.FadeMode.FADE_IN?this._fadeWeather(U.cloudsFade.fadeFactor):this._fadeWeather(0)}_fadeWeather(U){const {_newWeatherParameters:M,
_oldWeatherParameters:V}=this;1<=U?this._weatherParameters=M:(this._fadedWeatherParameters.lerp(V,M,U),this._weatherParameters=this._fadedWeatherParameters)}_updateWeather(){const U=this._weatherUpdateParameters;null!=U&&null!=this._clouds&&(this._clouds.applyPreset(z.cloudPresets[U.type],U.weatherAdjustment),this._setNeedsRender())}_setNeedsRender(){null!=this._context&&this._context.requestRender()}_updateFogHaze(){const U=this._weatherUpdateParameters;if(null!=this._fog&&null!=U&&null!=this._context){var M=
this._context.renderContext.bindParameters;this._oldWeatherParameters.copyFrom(this._weatherParameters);switch(U.type){case "foggy":this._newWeatherParameters.fog.strength=d.lerp(3E-5,.005,U.weatherAdjustment**3);m.copy(this._newWeatherParameters.fog.color,R);this._newWeatherParameters.fog.amount=1;this._newWeatherParameters.hazeAmount=1;this._setNeedsRender();break;case "rainy":this._newWeatherParameters.fog.strength=d.lerp(4E-6,2E-4,(U.effect??0)**3);m.copy(this._newWeatherParameters.fog.color,
J);this._newWeatherParameters.fog.amount=1;this._newWeatherParameters.hazeAmount=0;this._setNeedsRender();break;case "snowy":this._newWeatherParameters.fog.strength=d.lerp(4E-6,2E-4,(U.effect??0)**3);m.copy(this._newWeatherParameters.fog.color,R);this._newWeatherParameters.fog.amount=1;this._newWeatherParameters.hazeAmount=1;this._setNeedsRender();break;default:this._newWeatherParameters.fog.strength=0,this._newWeatherParameters.fog.amount=0,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender()}M.weatherFading?
this._fadeWeather(0):this._fadeWeather(1)}}_updateAtmosphere(U){U=this._selectAtmosphereType(U);if(U===p.AtmosphereType.None||!this._context)this._atmosphere=f.destroyMaybe(this._atmosphere);else if(!this._atmosphere||this._atmosphere.type!==U)if(this._atmosphere=f.destroyMaybe(this._atmosphere),U=this._getAtmosphereClass(U))this._atmosphere=new U(this.view,this._context);this._setNeedsRender()}_getAtmosphereClass(U){switch(U){case p.AtmosphereType.Realistic:return h.ChapmanAtmosphere;case p.AtmosphereType.Local:return C.LocalAtmosphere;
case p.AtmosphereType.Mars:return E;default:case p.AtmosphereType.None:return null}}_selectAtmosphereType(U){const {enabled:M,viewingMode:V}=U;return!M||v.isMoon(this.view.spatialReference)?p.AtmosphereType.None:V===x.ViewingMode.Local?p.AtmosphereType.Local:null!=this._context&&h.ChapmanAtmosphere.isSupported(this._context)&&v.isEarth(this.view.spatialReference)?p.AtmosphereType.Realistic:v.isMars(this.view.spatialReference)?p.AtmosphereType.Mars:p.AtmosphereType.None}get test(){return{atmosphere:this._atmosphere,
clouds:this._clouds,selectAtmosphereType:()=>this._selectAtmosphereType({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled}),stubGetAtmosphereClass:U=>{X=O.prototype._getAtmosphereClass;O.prototype._getAtmosphereClass=U},restoreGetAtmosphereClass:()=>{O.prototype._getAtmosphereClass=X}}}};a.__decorate([k.property({constructOnly:!0})],b.EnvironmentRenderer.prototype,"view",void 0);a.__decorate([k.property({readOnly:!0})],b.EnvironmentRenderer.prototype,"atmosphere",
null);a.__decorate([k.property({readOnly:!0})],b.EnvironmentRenderer.prototype,"_atmosphereType",null);a.__decorate([k.property({type:Boolean,readOnly:!0})],b.EnvironmentRenderer.prototype,"updating",null);a.__decorate([k.property({readOnly:!0})],b.EnvironmentRenderer.prototype,"weatherVisible",null);a.__decorate([k.property()],b.EnvironmentRenderer.prototype,"_context",void 0);a.__decorate([k.property()],b.EnvironmentRenderer.prototype,"_atmosphere",void 0);a.__decorate([k.property({readOnly:!0})],
b.EnvironmentRenderer.prototype,"_stars",null);a.__decorate([k.property({readOnly:!0})],b.EnvironmentRenderer.prototype,"_precipitation",null);a.__decorate([k.property({readOnly:!0})],b.EnvironmentRenderer.prototype,"_clouds",null);a.__decorate([k.property({readOnly:!0})],b.EnvironmentRenderer.prototype,"_cloudsComposition",null);a.__decorate([k.property({readOnly:!0})],b.EnvironmentRenderer.prototype,"_fog",null);a.__decorate([k.property({readOnly:!0})],b.EnvironmentRenderer.prototype,"weatherEnabled",
null);a.__decorate([k.property({readOnly:!0})],b.EnvironmentRenderer.prototype,"_precipitationEnabled",null);a.__decorate([k.property({readOnly:!0})],b.EnvironmentRenderer.prototype,"_weatherUpdateParameters",null);b.EnvironmentRenderer=O=a.__decorate([e.subclass("esri.views.3d.environment.EnvironmentRenderer")],b.EnvironmentRenderer);class P{constructor(){this.fog=new A.FogParameters;this.hazeAmount=1}copyFrom(U){this.fog.amount=U.fog.amount;this.hazeAmount=U.hazeAmount;this.fog.strength=U.fog.strength;
m.copy(this.fog.color,U.fog.color)}lerp(U,M,V){this.fog.amount=d.lerp(U.fog.amount,M.fog.amount,V);this.hazeAmount=d.lerp(U.hazeAmount,M.hazeAmount,V);this.fog.strength=d.lerp(U.fog.strength,M.fog.strength,V);m.lerp(this.fog.color,U.fog.color,M.fog.color,V)}}const J=l.fromValues(.5,.5,.5),R=l.fromValues(1.5,1.5,1.5);let X;b.WeatherParameters=P;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/AtmosphereType":function(){define(["exports"],function(b){b.AtmosphereType=
void 0;var a=b.AtmosphereType||(b.AtmosphereType={});a[a.Realistic=0]="Realistic";a[a.Local=1]="Local";a[a.Mars=2]="Mars";a[a.None=3]="None";Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/ChapmanAtmosphere":function(){define("exports ../../../core/colorUtils ../../../core/Handles ../../../core/mathUtils ../../../core/reactiveUtils ../../../chunks/vec2 ../../../chunks/vec3 ../../../chunks/vec4 ../../../chunks/vec4f64 ../../../geometry/support/Ellipsoid ./AtmosphereType ./atmosphereUtils ./ChapmanAtmosphereTechnique ./ChapmanAtmosphereTechniqueConfiguration ../webgl-engine/core/FBOCache ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/textureUtils ../../../chunks/AtmosphereCompositing.glsl ../webgl-engine/shaders/AtmosphereCompositingTechnique ../../webgl/enums ../../../webscene/background/ColorBackground".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z){class A{constructor(C,E){this._view=C;this._context=E;this.type=m.AtmosphereType.Realistic;this._handles=new c;this._atmosphereCompositionParameters=new r.AtmosphereCompositingPassParameters;this._atmosphereConfiguration=new v.ChapmanAtmosphereTechniqueConfiguration;this._passParameters=new w.ChapmanAtmospherePassParameters;this._rootTileElevationMin=NaN;this._lowerBoundEarthRadius=e.earth.radius;this._fadeHaze=0;this._updateRadius(e.earth.radius);
C=this._context.renderContext.rctx;this._updateRootTileElevationBounds();this._handles.add([f.watch(()=>this._view?.basemapTerrain?.rootTileElevationBounds,()=>this._view?.basemapTerrain?this._updateRootTileElevationBounds():null),f.watch(()=>this._view?.basemapTerrain?.visibleElevationBounds,()=>this._view?.basemapTerrain?this._updateVisibleElevationBounds():null),f.watch(()=>this._view?.environment.background,B=>{B=B instanceof z?a.unitRGBAFromColor(B.color):q.ZEROS;k.set(this._passParameters.backgroundColor,
B[0]*B[3],B[1]*B[3],B[2]*B[3])},f.syncAndInitial)]);E=new v.ChapmanAtmosphereTechniqueConfiguration;E.haze=!1;this._atmosphereTechnique=this._context.techniqueRepository.acquire(w.ChapmanAtmosphereTechnique,E);E.haze=!0;this._atmosphereHazeTechnique=this._context.techniqueRepository.acquire(w.ChapmanAtmosphereTechnique,E);E.reduced=!0;E.haze=!1;this._atmosphereReducedTechnique=this._context.techniqueRepository.acquire(w.ChapmanAtmosphereTechnique,E);E.haze=!0;this._atmosphereHazeReducedTechnique=
this._context.techniqueRepository.acquire(w.ChapmanAtmosphereTechnique,E);this._vao=h.createQuadVAO(C,p.Pos2Tex)}destroy(){this._handles.destroy();this._atmosphereTechnique.release();this._atmosphereHazeTechnique.release();this._atmosphereReducedTechnique.release();this._atmosphereHazeReducedTechnique.release();this._vao.dispose()}render(C,E){this._render(C,E?this._atmosphereTechnique:this._atmosphereReducedTechnique,C.offscreenRenderingHelper.depthTexture,E,!1)}renderHaze(C,E,B){this._fadeHaze=E;
this._render(C,B?this._atmosphereHazeTechnique:this._atmosphereHazeReducedTechnique,C.bindParameters.linearDepth?.colorTexture,B,!0)}_render(C,E,B,D,F){if(null!=B){var K=C.offscreenRenderingHelper;this._update(C.bindParameters.camera);this._passParameters.depthTexture=B;var L=C.rctx.bindTechnique(E,this._passParameters,C.bindParameters);if(D)K.renderDepthDetached(()=>this._renderCommon(L,C));else{E=C.rctx.getViewport();D=k.length(C.bindParameters.camera.eye)-e.earth.radius;if(D<l.atmosphereHeight){D=
Math.min(1,Math.max(0,D/l.atmosphereHeight));var G=F?d.lerp(.4,.5,D):d.lerp(.2,.3,D)}else D=Math.min(1,Math.max(0,(D-l.atmosphereHeight)/(15*l.atmosphereHeight))),G=F?d.lerp(.5,1,D):d.lerp(.3,.6,D);D=t.applyTextureResizeModulo(Math.round(G*C.bindParameters.camera.fullViewport[2]));G=t.applyTextureResizeModulo(Math.round(G*C.bindParameters.camera.fullViewport[3]));C.rctx.setViewport(0,0,D,G);D=K.renderToCachedFBO(null,()=>this._renderCommon(L,C),[0,0,0,1],x.ColorFormat.RGBA,null,D,G);C.rctx.setViewport(E.x,
E.y,E.width,E.height);this._atmosphereCompositionParameters.color=D.colorTexture;this._atmosphereCompositionParameters.depth=B;this._atmosphereConfiguration.haze=F;B=this._context.techniqueRepository.acquire(u.AtmosphereCompositingTechnique,this._atmosphereConfiguration);C.rctx.bindTechnique(B,this._atmosphereCompositionParameters,C.bindParameters);K.renderDepthDetached(()=>C.rctx.screen.draw());B.release();D.release()}}}_renderCommon(C,E){null!=this._vao&&(E.rctx.bindVAO(this._vao),C.assertCompatibleVertexAttributeLocations(this._vao),
E.rctx.drawArrays(y.PrimitiveType.TRIANGLE_STRIP,0,4))}_adjustRadiusForTesselation(C){return C*Math.cos(Math.PI/16/16)}_updateRootTileElevationBounds(){const C=this._view.basemapTerrain.rootTileElevationBounds.min;C!==this._rootTileElevationMin&&(this._rootTileElevationMin=C,this._lowerBoundEarthRadius=e.earth.radius,this._updateVisibleElevationBounds())}_updateVisibleElevationBounds(){const C=this._adjustRadiusForTesselation(e.earth.radius+this._view.basemapTerrain.visibleElevationBounds.min);C<
this._lowerBoundEarthRadius&&this._updateRadius(C)}_updateRadius(C){this._lowerBoundEarthRadius=C;n.set(this._passParameters.radii,C,C+l.atmosphereHeight);this._passParameters.innerFadeDistance=2*Math.sqrt((2*C-l.innerAtmosphereDepth)*l.innerAtmosphereDepth)}_update(C){if(C){C=k.squaredLength(C.eye);var E=Math.sqrt(C),B=C-this._passParameters.radii[1]*this._passParameters.radii[1],D=d.clamp((E-this._passParameters.radii[0])/l.atmosphereHeight,0,1);g.set(this._passParameters.heightParameters,E,C,B,
D);this._passParameters.altitudeFade=l.computeInnerAltitudeFade(E-this._lowerBoundEarthRadius);this._passParameters.hazeStrength=d.lerp(d.lerp(.6,1,d.smoothstep(9500,10500,E-e.earth.radius)),1,this._fadeHaze)}}static isSupported(C){return C.renderContext.rctx.capabilities.depthTexture}}b.ChapmanAtmosphere=A;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/core/colorUtils":function(){define(["exports","../Color","../chunks/vec4","../chunks/vec4f64"],function(b,a,c,d){function f(h,
t){const r=[];let u,y;if(h[0].length!==t.length)throw Error("dimensions do not match");const z=h.length,A=h[0].length;let C=0;for(u=0;u<z;u++){for(y=C=0;y<A;y++)C+=h[u][y]*t[y];r.push(C)}return r}function n(h){h=[h.r/255,h.g/255,h.b/255].map(t=>.04045>=t?t/12.92:((t+.055)/1.055)**2.4);h=f(x,h);return{x:100*h[0],y:100*h[1],z:100*h[2]}}function k(h){h=f(p,[h.x/100,h.y/100,h.z/100]).map(t=>Math.min(1,Math.max(.0031308>=t?12.92*t:1.055*t**(1/2.4)-.055,0)));return{r:Math.round(255*h[0]),g:Math.round(255*
h[1]),b:Math.round(255*h[2])}}function g(h){h=[h.x/95.047,h.y/100,h.z/108.883].map(t=>t>(6/29)**3?t**(1/3):1/3*(29/6)**2*t+4/29);return{l:116*h[1]-16,a:500*(h[0]-h[1]),b:200*(h[1]-h[2])}}function q(h){const t=h.l;h=[(t+16)/116+h.a/500,(t+16)/116,(t+16)/116-h.b/200].map(r=>r>6/29?r**3:3*(6/29)**2*(r-4/29));return{x:95.047*h[0],y:100*h[1],z:108.883*h[2]}}function e(h){if("r"in h&&"g"in h&&"b"in h)return h;if("l"in h&&"c"in h&&"h"in h){var t=h.c,r=h.h;return k(q({l:h.l,a:t*Math.cos(r),b:t*Math.sin(r)}))}if("l"in
h&&"a"in h&&"b"in h)return k(q(h));if("x"in h&&"y"in h&&"z"in h)return k(h);if("h"in h&&"s"in h&&"v"in h){r=(h.h+360)%360/60;t=h.v/100*255;h=h.s/100*t;const u=h*(1-Math.abs(r%2-1));switch(Math.floor(r)){case 0:r={r:h,g:u,b:0};break;case 1:r={r:u,g:h,b:0};break;case 2:r={r:0,g:h,b:u};break;case 3:r={r:0,g:u,b:h};break;case 4:r={r:u,g:0,b:h};break;case 5:case 6:r={r:h,g:0,b:u};break;default:r={r:0,g:0,b:0}}r.r=Math.round(r.r+t-h);r.g=Math.round(r.g+t-h);r.b=Math.round(r.b+t-h);return r}return h}function m(h){if("h"in
h&&"s"in h&&"v"in h)return h;var t=e(h);h=t.r;const r=t.g,u=t.b;t=Math.max(h,r,u);const y=t-Math.min(h,r,u);h=0===y?0:t===h?(r-u)/y%6:t===r?(u-h)/y+2:(h-r)/y+4;0>h&&(h+=6);return{h:60*h,s:100*(0===y?0:y/t),v:100/255*t}}function l(h){return"l"in h&&"a"in h&&"b"in h?h:g(n(e(h)))}function w(h){let {r:t,g:r,b:u,a:y}=h;1>y&&(t=Math.round(y*t+255*(1-y)),r=Math.round(y*r+255*(1-y)),u=Math.round(y*u+255*(1-y)));return new a({r:t,g:r,b:u})}function v(h,t){const {r,g:u,b:y}=t?.ignoreAlpha?h:w(h);return.2126*
r+.7152*u+.0722*y}const x=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],p=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];b.BrightnessThreshold=void 0;(function(h){h[h.Low=160]="Low";h[h.High=225]="High"})(b.BrightnessThreshold||(b.BrightnessThreshold={}));b.colorEquals=function(h,t){return h===t||null!=h&&h.equals(t)};b.colorVectorEquals=function(h,t){return h===t||null!=h&&null!=t&&c.equals(h,t)};b.colorVectorToColorAndOpacity=function(h){return d.fromValues(h[0],
h[1],h[2],3<h.length?h[3]:1)};b.darken=function(h,t){var r=l(h);r.l*=1-t;t=e(r);r=h.clone();r.setColor(t);r.a=h.a;return r};b.desaturate=function(h,t){var r=m(h);r.s*=t;t=e(r);r=h.clone();r.setColor(t);r.a=h.a;return r};b.getColorLuminance=v;b.getColorTheme=function(h){return w(h).isBright?"light":"dark"};b.getContrast=function(h,t=b.BrightnessThreshold.High){return v(h,{ignoreAlpha:!0})>t?new a([0,0,0,h.a]):new a([255,255,255,h.a])};b.multiplyOpacity=function(h,t){h=h.clone();h.a*=t;return h};b.multiplyOpacityToUnitRGBA=
function(h,t){h=a.toUnitRGBA(h);h[3]*=t;return h};b.toHSV=m;b.toLAB=l;b.toLCH=function(h){if(!("l"in h&&"c"in h&&"h"in h)){var t=g(n(e(h)));h=t.l;var r=t.a;const u=t.b;t=Math.sqrt(r*r+u*u);r=Math.atan2(u,r);r=0<r?r:r+2*Math.PI;h={l:h,c:t,h:r}}return h};b.toRGB=e;b.unitRGBAFromColor=function(h){return a.toUnitRGBA(h)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/vec2":function(){define(["exports","./common"],function(b,a){function c(M,V){M[0]=V[0];M[1]=V[1];return M}
function d(M,V,Y){M[0]=V;M[1]=Y;return M}function f(M,V,Y){M[0]=V[0]+Y[0];M[1]=V[1]+Y[1];return M}function n(M,V,Y){M[0]=V[0]-Y[0];M[1]=V[1]-Y[1];return M}function k(M,V,Y){M[0]=V[0]*Y[0];M[1]=V[1]*Y[1];return M}function g(M,V,Y){M[0]=V[0]/Y[0];M[1]=V[1]/Y[1];return M}function q(M,V){M[0]=Math.ceil(V[0]);M[1]=Math.ceil(V[1]);return M}function e(M,V){M[0]=Math.floor(V[0]);M[1]=Math.floor(V[1]);return M}function m(M,V,Y){M[0]=Math.min(V[0],Y[0]);M[1]=Math.min(V[1],Y[1]);return M}function l(M,V,Y){M[0]=
Math.max(V[0],Y[0]);M[1]=Math.max(V[1],Y[1]);return M}function w(M,V){M[0]=Math.round(V[0]);M[1]=Math.round(V[1]);return M}function v(M,V,Y){M[0]=V[0]*Y;M[1]=V[1]*Y;return M}function x(M,V,Y,W){M[0]=V[0]+Y[0]*W;M[1]=V[1]+Y[1]*W;return M}function p(M,V){const Y=V[0]-M[0];M=V[1]-M[1];return Math.sqrt(Y*Y+M*M)}function h(M,V){const Y=V[0]-M[0];M=V[1]-M[1];return Y*Y+M*M}function t(M){const V=M[0];M=M[1];return Math.sqrt(V*V+M*M)}function r(M){const V=M[0];M=M[1];return V*V+M*M}function u(M,V){M[0]=-V[0];
M[1]=-V[1];return M}function y(M,V){M[0]=1/V[0];M[1]=1/V[1];return M}function z(M,V){var Y=V[0];const W=V[1];Y=Y*Y+W*W;0<Y&&(Y=1/Math.sqrt(Y),M[0]=V[0]*Y,M[1]=V[1]*Y);return M}function A(M,V){return M[0]*V[0]+M[1]*V[1]}function C(M,V,Y){V=V[0]*Y[1]-V[1]*Y[0];M[0]=M[1]=0;M[2]=V;return M}function E(M,V,Y,W){const H=V[0];V=V[1];M[0]=H+W*(Y[0]-H);M[1]=V+W*(Y[1]-V);return M}function B(M,V){V=V||1;const Y=2*a.RANDOM()*Math.PI;M[0]=Math.cos(Y)*V;M[1]=Math.sin(Y)*V;return M}function D(M,V,Y){const W=V[0];
V=V[1];M[0]=Y[0]*W+Y[2]*V;M[1]=Y[1]*W+Y[3]*V;return M}function F(M,V,Y){const W=V[0];V=V[1];M[0]=Y[0]*W+Y[2]*V+Y[4];M[1]=Y[1]*W+Y[3]*V+Y[5];return M}function K(M,V,Y){const W=V[0];V=V[1];M[0]=Y[0]*W+Y[3]*V+Y[6];M[1]=Y[1]*W+Y[4]*V+Y[7];return M}function L(M,V,Y){const W=V[0];V=V[1];M[0]=Y[0]*W+Y[4]*V+Y[12];M[1]=Y[1]*W+Y[5]*V+Y[13];return M}function G(M,V,Y,W){const H=V[0]-Y[0];V=V[1]-Y[1];const S=Math.sin(W);W=Math.cos(W);M[0]=H*W-V*S+Y[0];M[1]=H*S+V*W+Y[1];return M}function O(M,V){var Y=M[0];M=M[1];
const W=V[0];V=V[1];let H=Y*Y+M*M;0<H&&(H=1/Math.sqrt(H));let S=W*W+V*V;0<S&&(S=1/Math.sqrt(S));Y=(Y*W+M*V)*H*S;return 1<Y?0:-1>Y?Math.PI:Math.acos(Y)}function P(M){return"vec2("+M[0]+", "+M[1]+")"}function J(M,V){return M[0]===V[0]&&M[1]===V[1]}function R(M,V){const Y=M[0];M=M[1];const W=V[0];V=V[1];const H=a.getEpsilon();return Math.abs(Y-W)<=H*Math.max(1,Math.abs(Y),Math.abs(W))&&Math.abs(M-V)<=H*Math.max(1,Math.abs(M),Math.abs(V))}function X(M,V,Y,W,H){let S=V[0]-Y[0];Y=V[1]-Y[1];H=(W[0]*S+W[1]*
Y)*(H-1);S=W[0]*H;Y=W[1]*H;M[0]=V[0]+S;M[1]=V[1]+Y;return M}const U=Object.freeze(Object.defineProperty({__proto__:null,add:f,angle:O,ceil:q,copy:c,cross:C,dist:p,distance:p,div:g,divide:g,dot:A,equals:R,exactEquals:J,floor:e,inverse:y,len:t,length:t,lerp:E,max:l,min:m,mul:k,multiply:k,negate:u,normalize:z,projectAndScale:X,random:B,rotate:G,round:w,scale:v,scaleAndAdd:x,set:d,sqrDist:h,sqrLen:r,squaredDistance:h,squaredLength:r,str:P,sub:n,subtract:n,transformMat2:D,transformMat2d:F,transformMat3:K,
transformMat4:L},Symbol.toStringTag,{value:"Module"}));b.add=f;b.angle=O;b.ceil=q;b.copy=c;b.cross=C;b.dist=p;b.distance=p;b.div=g;b.divide=g;b.dot=A;b.equals=R;b.exactEquals=J;b.floor=e;b.inverse=y;b.len=t;b.length=t;b.lerp=E;b.max=l;b.min=m;b.mul=k;b.multiply=k;b.negate=u;b.normalize=z;b.projectAndScale=X;b.random=B;b.rotate=G;b.round=w;b.scale=v;b.scaleAndAdd=x;b.set=d;b.sqrDist=h;b.sqrLen=r;b.squaredDistance=h;b.squaredLength=r;b.str=P;b.sub=n;b.subtract=n;b.transformMat2=D;b.transformMat2d=F;
b.transformMat3=K;b.transformMat4=L;b.vec2=U})},"esri/views/3d/environment/atmosphereUtils":function(){define(["exports","../../../core/mathUtils"],function(b,a){b.atmosphereHeight=1E5;b.computeInnerAltitudeFade=function(c){return a.clamp((c-1E5)/9E5,0,1)};b.innerAtmosphereDepth=1E4;b.rayLeighScaleHeight=.085;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/ChapmanAtmosphereTechnique":function(){define("require exports ../../../chunks/vec2f64 ../../../chunks/vec3f64 ../../../chunks/vec4f64 ../../../chunks/ChapmanAtmosphere.glsl ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w){class v extends k.NoParameters{constructor(){super(...arguments);this.heightParameters=f.create();this.radii=c.create();this.altitudeFade=this.innerFadeDistance=0;this.hazeStrength=1;this.renderScale=c.create();this.backgroundColor=d.create()}}class x extends q.ShaderTechnique{initializeProgram(p){return new m.Program(p.rctx,x.shader.get().build(this.configuration),e.Default3D)}initializePipeline(){return this.configuration.reduced?w.makePipelineState({blending:w.simpleBlendingParams(l.BlendFactor.ONE,
l.BlendFactor.ZERO),depthTest:{func:l.CompareFunction.ALWAYS},colorWrite:w.defaultColorWriteParams}):this.configuration.haze?w.makePipelineState({blending:w.separateBlendingParams(l.BlendFactor.ONE,l.BlendFactor.ZERO,l.BlendFactor.ONE_MINUS_SRC_COLOR,l.BlendFactor.ONE),colorWrite:w.defaultColorWriteParams}):w.makePipelineState({blending:w.simpleBlendingParams(l.BlendFactor.SRC_ALPHA,l.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:l.CompareFunction.LEQUAL},colorWrite:w.defaultColorWriteParams})}}
x.shader=new g.ReloadableShaderModule(n.ChapmanAtmosphere,()=>new Promise((p,h)=>b(["./ChapmanAtmosphere.glsl"],p,h)));a.ChapmanAtmospherePassParameters=v;a.ChapmanAtmosphereTechnique=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/ChapmanAtmosphere.glsl":function(){define("exports ./mat4 ./mat4f64 ./vec3f64 ../views/3d/environment/atmosphereUtils ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t){function r(C){const E=new p.ShaderBuilder;E.attributes.add(t.VertexAttribute.POSITION,"vec2");E.include(n.TextureCoordinateAttribute,{textureCoordinateType:n.TextureCoordinateAttributeType.Default});E.varyings.add("worldRay","vec3");E.varyings.add("eyeDir","vec3");const {vertex:B,fragment:D}=E;B.uniforms.add(new x.Matrix4PassUniform("inverseProjectionMatrix",(F,K)=>K.camera.inverseProjectionMatrix),new x.Matrix4PassUniform("inverseViewMatrix",(F,K)=>a.invertOrIdentity(A,
K.camera.viewMatrix)));B.code.add(v.glsl`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`);D.uniforms.add(new m.Float3PassUniform("backgroundColor",F=>F.backgroundColor),new e.Float2PassUniform("radii",F=>F.radii),new m.Float3PassUniform("cameraPosition",(F,K)=>K.camera.eye),new l.Float4PassUniform("heightParameters",F=>F.heightParameters),new w.FloatPassUniform("innerFadeDistance",F=>F.innerFadeDistance),new w.FloatPassUniform("altitudeFade",F=>F.altitudeFade),new h.Texture2DPassUniform("depthTexture",F=>F.depthTexture),new w.FloatPassUniform("hazeStrength",F=>F.hazeStrength));D.constants.add("betaRayleigh",
"vec3",u);D.constants.add("betaCombined","vec3",z);D.constants.add("betaMie","float",3.996E-6);D.constants.add("scaleHeight","float",f.rayLeighScaleHeight*f.atmosphereHeight);q.addMainLightDirection(D);E.include(g.Gamma);C.haze&&(D.include(k.ReadLinearDepth),D.uniforms.add(new e.Float2PassUniform("nearFar",(F,K)=>K.camera.nearFar)));D.code.add(v.glsl`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`);D.code.add(v.glsl`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`);D.code.add(v.glsl`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`);D.code.add(v.glsl`
    const int STEPS = 6;

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${C.haze?v.glsl`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${C.haze?"":v.glsl`mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * `} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${C.haze?"":v.glsl`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.0596831 * mumu;

      ${C.haze?v.glsl`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:v.glsl`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.1193662 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    ${C.haze?"":v.glsl`
            vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
              vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
              if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
                return fragColor;
              }

              float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
              vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
              float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
              if (relDist > 1.0) {
                return surfaceColor;
              }

              return mix(fragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
            }

            float getGlow(float dist, float radius, float intensity) {
              return pow(radius / max(dist, 1e-6), intensity);
            }

            vec3 getSun(vec3 cameraPos, vec3 rayDir, vec3 lightDir){

              // Get the amount of atmosphere between camera and the Sun along the view ray
              float scaleFract = (length(cameraPos) - radii[0]) / scaleHeight;
              float sunOpticalDepth = getOpticalDepth(cameraPos, rayDir, max(scaleFract, 0.0));

              // Find the amount of light that remains after travelling through the atmosphere from the Sun along the view ray
              // This will make the colour of the Sun reddish on the horizon and white from space
              vec3 sunTransmittance = exp(-(mix(betaCombined, betaRayleigh, 0.5)) * max(0.0, sunOpticalDepth));

              // Alignment of light direction and view ray
              float mu = clamp(dot(rayDir, lightDir), 0.0, 1.0);
              // Draw the Sun as a bright disc
              float sunDisc = 256.0 * smoothstep(0.0, 128.0, clamp(getGlow(1.0 - mu, 3e-5, 3.0), 0.0, 128.0));

              return normalize(sunTransmittance) * sunDisc;
            }`}

    ${C.haze&&C.reduced?v.glsl`
        float getDepth(vec2 uv){
          return linearDepthFromTexture(depthTexture, uv, nearFar);
        }

        float textureBilinear(vec2 uv) {
          // Information about the high-resolution depth texture
          vec2 depthTextureSize = vec2(textureSize(depthTexture, 0));
          vec2 texelSize = 1.0 / depthTextureSize;

          // The uv inside the upper right pixel - of the tile of 4 pixels -
          // that the atmosphere uv maps to in the depth texture
          vec2 depthUV = (uv * depthTextureSize) - vec2(0.5);

          // Relative distance of the uv coordinates inside the depth texture pixel
          vec2 f = fract(depthUV);

          // Snap to the centre of the depth texture pixel
          vec2 snapUV = (floor(depthUV) + vec2(0.5)) / depthTextureSize;

          // Read the depth texture pixel and its three neighbours
          float d0 = getDepth(snapUV);
          float d1 = getDepth(snapUV + vec2(texelSize.x, 0.0));
          float d2 = getDepth(snapUV + vec2(0.0, texelSize.y));
          float d3 = getDepth(snapUV + texelSize);

          // Return the bilinearly interpolated value of the neighbouring pixels based
          // on the sample position in the depth texture pixel
          return mix(mix(d0, d1, f.x), mix(d2, d3, f.x), f.y);
        }
        `:""}

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${C.haze?v.glsl`
          vec4 depthSample = texture(depthTexture, vuv0).rgba;
          if (depthSample != vec4(0)) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;

              ${C.reduced?v.glsl`cameraSpaceRay *= -textureBilinear(vuv0);`:v.glsl`cameraSpaceRay *= -linearDepthFromTexture(depthTexture, vuv0, nearFar);`}

            terrainDepth = max(0.0, length(cameraSpaceRay));
          }else{
            discard;
          }
          `:v.glsl`${C.reduced?"":v.glsl`
                float depthSample = texture(depthTexture, vuv0).r;
                if (depthSample != 1.0) {
                  fragColor = vec4(0);
                  return;
                }`}`}

      ${C.haze?v.glsl`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != vec4(0)){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            }
            // Alpha is ignored for haze blending
            float alpha = 1.0;
            `:v.glsl`
            vec3 col = linearizeGamma(backgroundColor);
            col += getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            col += getSun(cameraPosition, rayDir, mainLightDirection);
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}

      col = tonemapACES(col);
      fragColor = delinearizeGamma(vec4(col, alpha));
      ${C.haze?"":v.glsl`fragColor = applyUndergroundAtmosphere(rayDir, mainLightDirection, fragColor);`}
    }
  `);return E}const u=d.fromValues(parseFloat(Number(5.802E-6).toFixed(6)),parseFloat(Number(1.3558E-5).toFixed(6)),parseFloat(Number(3.31E-5).toFixed(6))),y=d.fromValues(3*parseFloat(Number(6.5E-7).toFixed(6)),3*parseFloat(Number(1.881E-6).toFixed(6)),3*parseFloat(Number(8.5E-8).toFixed(6))),z=d.fromValues(parseFloat(Number(u[0]+y[0]).toFixed(6)),parseFloat(Number(u[1]+y[1]).toFixed(6)),parseFloat(Number(u[2]+y[2]).toFixed(6))),A=c.create();c=Object.freeze(Object.defineProperty({__proto__:null,betaRayleigh:u,
build:r},Symbol.toStringTag,{value:"Module"}));b.ChapmanAtmosphere=c;b.betaRayleigh=u;b.build=r})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl":function(){define(["exports","../../../../../../core/compilerUtils","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(b,a,c,d){b.TextureCoordinateAttributeType=void 0;(function(f){f[f.None=0]="None";f[f.Default=1]="Default";f[f.Atlas=2]="Atlas";f[f.Compressed=3]="Compressed";f[f.COUNT=4]=
"COUNT"})(b.TextureCoordinateAttributeType||(b.TextureCoordinateAttributeType={}));b.TextureCoordinateAttribute=function(f,n){switch(n.textureCoordinateType){case b.TextureCoordinateAttributeType.Default:f.attributes.add(d.VertexAttribute.UV0,"vec2");f.varyings.add("vuv0","vec2");f.vertex.code.add(c.glsl`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);break;case b.TextureCoordinateAttributeType.Compressed:f.attributes.add(d.VertexAttribute.UV0,"vec2");f.varyings.add("vuv0","vec2");f.vertex.code.add(c.glsl`vec2 getUV0() {
return uv0 / 16384.0;
}
void forwardTextureCoordinates() {
vuv0 = getUV0();
}`);break;case b.TextureCoordinateAttributeType.Atlas:f.attributes.add(d.VertexAttribute.UV0,"vec2");f.varyings.add("vuv0","vec2");f.attributes.add(d.VertexAttribute.UVREGION,"vec4");f.varyings.add("vuvRegion","vec4");f.vertex.code.add(c.glsl`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);break;default:a.neverReached(n.textureCoordinateType);case b.TextureCoordinateAttributeType.None:f.vertex.code.add(c.glsl`void forwardTextureCoordinates() {}`);case b.TextureCoordinateAttributeType.COUNT:}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/interfaces":function(){define(["exports"],function(b){function a(f,...n){let k="";for(let g=0;g<n.length;g++)k+=f[g]+n[g];return k+=f[f.length-1]}class c{}const d=c;(function(f){f.int=
function(n){return Math.round(n).toString()};f.float=function(n){return n.toPrecision(8)}})(a||(a={}));b.NoParameters=d;b.glsl=a;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/VertexAttribute":function(){define(["exports"],function(b){b.VertexAttribute=void 0;(function(a){a.POSITION="position";a.NORMAL="normal";a.NORMALCOMPRESSED="normalCompressed";a.UV0="uv0";a.AUXPOS1="auxpos1";a.AUXPOS2="auxpos2";a.COLOR="color";a.SYMBOLCOLOR="symbolColor";a.SIZE=
"size";a.TANGENT="tangent";a.OFFSET="offset";a.PERSPECTIVEDIVIDE="perspectiveDivide";a.SUBDIVISIONFACTOR="subdivisionFactor";a.COLORFEATUREATTRIBUTE="colorFeatureAttribute";a.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute";a.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute";a.DISTANCETOSTART="distanceToStart";a.UVMAPSPACE="uvMapSpace";a.BOUNDINGRECT="boundingRect";a.UVREGION="uvRegion";a.PROFILERIGHT="profileRight";a.PROFILEUP="profileUp";a.PROFILEVERTEXANDNORMAL="profileVertexAndNormal";a.FEATUREVALUE=
"featureValue";a.INSTANCEMODELORIGINHI="instanceModelOriginHi";a.INSTANCEMODELORIGINLO="instanceModelOriginLo";a.INSTANCEMODEL="instanceModel";a.INSTANCEMODELNORMAL="instanceModelNormal";a.INSTANCECOLOR="instanceColor";a.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute";a.LOCALTRANSFORM="localTransform";a.GLOBALTRANSFORM="globalTransform";a.BOUNDINGSPHERE="boundingSphere";a.MODELORIGIN="modelOrigin";a.MODELSCALEFACTORS="modelScaleFactors";a.FEATUREATTRIBUTE="featureAttribute";a.STATE="state";a.LODLEVEL=
"lodLevel";a.POSITION0="position0";a.POSITION1="position1";a.NORMALA="normalA";a.NORMALB="normalB";a.COMPONENTINDEX="componentIndex";a.VARIANTOFFSET="variantOffset";a.VARIANTSTROKE="variantStroke";a.VARIANTEXTENSION="variantExtension";a.SIDENESS="sideness";a.START="start";a.END="end";a.UP="up";a.EXTRUDE="extrude";a.OBJECTANDLAYERIDCOLOR="objectAndLayerIdColor";a.INSTANCEOBJECTANDLAYERIDCOLOR="instanceObjectAndLayerIdColor"})(b.VertexAttribute||(b.VertexAttribute={}));b.affectsGeometry=function(a){return a===
b.VertexAttribute.POSITION};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl":function(){define(["exports","../util/RgbaFloatEncoding.glsl","../../shaderModules/interfaces"],function(b,a,c){b.ReadLinearDepth=function(d){d.include(a.RgbaFloatEncoding);d.code.add(c.glsl`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromRGBA(vec4 depth, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(depth), nearFar);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthTex, 0)));
return linearDepthFromRGBA(texelFetch(depthTex, iuv, 0), nearFar);
}`)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(b,a){b.RgbaFloatEncoding=function(c){c.code.add(a.glsl`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(b,a){b.Gamma=function(c){c.fragment.code.add(a.glsl`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl":function(){define(["exports","../../shaderModules/Float3PassUniform","../../shaderModules/interfaces"],function(b,a,c){function d(n){n.uniforms.add(new a.Float3PassUniform("mainLightDirection",(k,g)=>g.lighting.mainLight.direction))}function f(n){n.uniforms.add(new a.Float3PassUniform("mainLightIntensity",(k,g)=>g.lighting.mainLight.intensity))}b.MainLighting=
function(n){d(n.fragment);f(n.fragment);n.fragment.code.add(c.glsl`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, mainLightDirection), 0.0, 1.0);
return mainLightIntensity * ((1.0 - shadowing) * dotVal);
}`)};b.addMainLightDirection=d;b.addMainLightIntensity=f;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Float3PassUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(b,a,c){class d extends a.Uniform{constructor(f,n){super(f,"vec3",c.BindType.Pass,(k,g,q)=>k.setUniform3fv(f,n(g,q)))}}b.Float3PassUniform=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Uniform":function(){define(["exports",
"../shaderTechnique/BindType"],function(b,a){class c{constructor(d,f,n,k,g=null){this.name=d;this.type=f;this.arraySize=g;this.bind={[a.BindType.Pass]:null,[a.BindType.Draw]:null};if(k)switch(n){case a.BindType.Pass:this.bind[a.BindType.Pass]=k;break;case a.BindType.Draw:this.bind[a.BindType.Draw]=k}}equals(d){return this.type===d.type&&this.name===d.name&&this.arraySize===d.arraySize}}b.Uniform=c;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderTechnique/BindType":function(){define(["exports"],
function(b){b.BindType=void 0;var a=b.BindType||(b.BindType={});a[a.Pass=0]="Pass";a[a.Draw=1]="Draw";Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Float2PassUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(b,a,c){class d extends a.Uniform{constructor(f,n){super(f,"vec2",c.BindType.Pass,(k,g,q)=>k.setUniform2fv(f,n(g,q)))}}b.Float2PassUniform=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/core/shaderModules/Float4PassUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(b,a,c){class d extends a.Uniform{constructor(f,n){super(f,"vec4",c.BindType.Pass,(k,g,q)=>k.setUniform4fv(f,n(g,q)))}}b.Float4PassUniform=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/FloatPassUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(b,a,
c){class d extends a.Uniform{constructor(f,n){super(f,"float",c.BindType.Pass,(k,g,q)=>k.setUniform1f(f,n(g,q)))}}b.FloatPassUniform=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(b,a,c){class d extends a.Uniform{constructor(f,n){super(f,"mat4",c.BindType.Pass,(k,g,q)=>k.setUniformMatrix4fv(f,n(g,q)))}}b.Matrix4PassUniform=d;Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/ShaderBuilder":function(){define(["exports","../../../../../core/Error","../../../../../core/Logger","../shaderTechnique/BindType","../../lib/Util"],function(b,a,c,d,f){const n=c.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");class k{constructor(){this._includedModules=new Map}include(h,t){if(this._includedModules.has(h)){const r=this._includedModules.get(h);if(r!==t){n.error("Trying to include shader module multiple times with different sets of options.");
t=new Set;for(const u of Object.keys(r))r[u]!==h[u]&&t.add(u);for(const u of Object.keys(h))r[u]!==h[u]&&t.add(u);t.forEach(u=>console.error(`  ${u}: current ${r[u]} new ${h[u]}`))}}else this._includedModules.set(h,t),h(this.builder,t)}}class g extends k{constructor(){super(...arguments);this.vertex=new m;this.fragment=new m;this.attributes=new l;this.varyings=new w;this.extensions=new v;this.constants=new p;this.outputs=new x}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(h){const t=
this.extensions.generateSource(h),r=this.attributes.generateSource(h),u=this.varyings.generateSource(h);var y="vertex"===h?this.vertex:this.fragment;const z=y.uniforms.generateSource(),A=y.code.generateSource(),C="vertex"===h?"precision highp float;\nprecision highp sampler2D;":"#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif";y=this.constants.generateSource().concat(y.constants.generateSource());
h=this.outputs.generateSource(h);return`#version 300 es\n${t.join("\n")}\n\n${C}\n\n${y.join("\n")}\n\n${z.join("\n")}\n\n${r.join("\n")}\n\n${u.join("\n")}\n\n${h.join("\n")}\n\n${A.join("\n")}`}generateBindPass(h){const t=new Map;this.vertex.uniforms.entries.forEach(y=>{const z=y.bind[d.BindType.Pass];z&&t.set(y.name,z)});this.fragment.uniforms.entries.forEach(y=>{const z=y.bind[d.BindType.Pass];z&&t.set(y.name,z)});const r=Array.from(t.values()),u=r.length;return(y,z)=>{for(let A=0;A<u;++A)r[A](h,
y,z)}}generateBindDraw(h){const t=new Map;this.vertex.uniforms.entries.forEach(y=>{const z=y.bind[d.BindType.Draw];z&&t.set(y.name,z)});this.fragment.uniforms.entries.forEach(y=>{const z=y.bind[d.BindType.Draw];z&&t.set(y.name,z)});const r=Array.from(t.values()),u=r.length;return(y,z,A)=>{for(let C=0;C<u;++C)r[C](h,y,z,A)}}}class q{constructor(){this._entries=new Map}add(...h){for(const t of h)this._add(t)}get(h){return this._entries.get(h)}_add(h){if(null==h)n.error(`Trying to add null Uniform from ${Error().stack}.`);
else{if(this._entries.has(h.name)&&!this._entries.get(h.name).equals(h))throw new a(`Duplicate uniform name ${h.name} for different uniform type`);this._entries.set(h.name,h)}}generateSource(){return Array.from(this._entries.values()).map(h=>null!=h.arraySize?`uniform ${h.type} ${h.name}[${h.arraySize}];`:`uniform ${h.type} ${h.name};`)}get entries(){return Array.from(this._entries.values())}}class e{constructor(){this._entries=[]}add(h){this._entries.push(h)}generateSource(){return this._entries}}
class m extends k{constructor(){super(...arguments);this.uniforms=new q;this.code=new e;this.constants=new p}get builder(){return this}}class l{constructor(){this._entries=[]}add(h,t){this._entries.push([h,t])}generateSource(h){return"fragment"===h?[]:this._entries.map(t=>`in ${t[1]} ${t[0]};`)}}class w{constructor(){this._entries=new Map}add(h,t){this._entries.has(h)&&f.assert(this._entries.get(h)===t);this._entries.set(h,t)}generateSource(h){const t=[];this._entries.forEach((r,u)=>t.push("vertex"===
h?`out ${r} ${u};`:`in ${r} ${u};`));return t}}class v{constructor(){this._entries=new Set}add(h){this._entries.add(h)}generateSource(h){const t="vertex"===h?v.ALLOWLIST_VERTEX:v.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(r=>t.includes(r)).map(r=>`#extension ${r} : enable`)}}v.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"];v.ALLOWLIST_VERTEX=[];class x{constructor(){this._entries=new Map}add(h,t,r=0){const u=this._entries.get(r);u?f.assert(u.name===
h&&u.type===t,`Fragment shader output location ${r} occupied`):this._entries.set(r,{name:h,type:t})}generateSource(h){if("vertex"===h)return[];0===this._entries.size&&this._entries.set(0,{name:x.DEFAULT_NAME,type:x.DEFAULT_TYPE});const t=[];this._entries.forEach((r,u)=>t.push(`layout(location = ${u}) out ${r.type} ${r.name};`));return t}}x.DEFAULT_TYPE="vec4";x.DEFAULT_NAME="fragColor";class p{constructor(){this._entries=new Set}add(h,t,r){let u="ERROR_CONSTRUCTOR_STRING";switch(t){case "float":u=
p._numberToFloatStr(r);break;case "int":u=p._numberToIntStr(r);break;case "bool":u=r.toString();break;case "vec2":u=`vec2(${p._numberToFloatStr(r[0])},                            ${p._numberToFloatStr(r[1])})`;break;case "vec3":u=`vec3(${p._numberToFloatStr(r[0])},                            ${p._numberToFloatStr(r[1])},                            ${p._numberToFloatStr(r[2])})`;break;case "vec4":u=`vec4(${p._numberToFloatStr(r[0])},                            ${p._numberToFloatStr(r[1])},                            ${p._numberToFloatStr(r[2])},                            ${p._numberToFloatStr(r[3])})`;
break;case "ivec2":u=`ivec2(${p._numberToIntStr(r[0])},                             ${p._numberToIntStr(r[1])})`;break;case "ivec3":u=`ivec3(${p._numberToIntStr(r[0])},                             ${p._numberToIntStr(r[1])},                             ${p._numberToIntStr(r[2])})`;break;case "ivec4":u=`ivec4(${p._numberToIntStr(r[0])},                             ${p._numberToIntStr(r[1])},                             ${p._numberToIntStr(r[2])},                             ${p._numberToIntStr(r[3])})`;
break;case "mat2":case "mat3":case "mat4":u=`${t}(${Array.prototype.map.call(r,y=>p._numberToFloatStr(y)).join(", ")})`}this._entries.add(`const ${t} ${h} = ${u};`);return this}static _numberToIntStr(h){return h.toFixed(0)}static _numberToFloatStr(h){return Number.isInteger(h)?h.toFixed(1):h.toString()}generateSource(){return Array.from(this._entries)}}b.Code=e;b.Includes=k;b.ShaderBuilder=g;b.Stage=m;b.Uniforms=q;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Util":function(){define(["exports",
"../../../../chunks/vec2f64","../../../../chunks/vec4","../../../../chunks/vec4f64"],function(b,a,c,d){function f(g,q){if(!g)throw q=q||"Assertion",new k(`${q} at ${Error(q).stack}`);}const n=d.create();class k{constructor(g){this.message=g}toString(){return`AssertException: ${this.message}`}}b.assert=f;b.isTranslationMatrix=function(g){return 1===g[0]&&0===g[1]&&0===g[2]&&0===g[3]&&0===g[4]&&1===g[5]&&0===g[6]&&0===g[7]&&0===g[8]&&0===g[9]&&1===g[10]&&0===g[11]&&1===g[15]};b.logWithBase=function(g,
q){return Math.log(g)/Math.log(q)};b.project=function(g,q,e,m,l){n[0]=g[0];n[1]=g[1];n[2]=g[2];n[3]=1;c.transformMat4(n,n,q);2<l.length&&(l[2]=-n[2]);c.transformMat4(n,n,e);f(0!==n[3]);l[0]=n[0]/n[3];l[1]=n[1]/n[3];l[2]=n[2]/n[3];l[0]=(.5*l[0]+.5)*m[2]+m[0];l[1]=(.5*l[1]+.5)*m[3]+m[1]};b.rayBoxTest=function(g,q,e,m){let l,w=(e[0]-g[0])/q[0],v=(m[0]-g[0])/q[0];w>v&&(l=w,w=v,v=l);let x=(e[1]-g[1])/q[1],p=(m[1]-g[1])/q[1];x>p&&(l=x,x=p,p=l);if(w>p||x>v)return!1;x>w&&(w=x);p<v&&(v=p);e=(e[2]-g[2])/q[2];
g=(m[2]-g[2])/q[2];e>g&&(l=e,e=g,g=l);if(w>g||e>v)return!1;g<v&&(v=g);return 0>v?!1:!0};b.rayRay2D=function(g,q,e,m,l,w=a.create()){const v=(m[l]-e[l])*(q[0]-g[0])-(m[0]-e[0])*(q[l]-g[l]);if(0===v)return!1;e=((m[0]-e[0])*(g[l]-e[l])-(m[l]-e[l])*(g[0]-e[0]))/v;w[0]=g[0]+e*(q[0]-g[0]);w[1]=g[l]+e*(q[l]-g[l]);return!0};b.setMatrixTranslation3=function(g,q,e,m){g[12]=q;g[13]=e;g[14]=m};b.verify=function(g,q){g||console.warn("Verify failed: "+(q||"")+"\n"+Error("verify").stack)};Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(b,a,c){class d extends a.Uniform{constructor(f,n){super(f,"sampler2D",c.BindType.Pass,(k,g,q)=>k.bindTexture(f,n(g,q)))}}b.Texture2DPassUniform=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ReloadableShaderModule":function(){define(["exports"],
function(b){class a{constructor(c,d){this._module=c;this._loadModule=d}get(){return this._module}async reload(){return this._module=await this._loadModule()}}b.ReloadableShaderModule=a;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechnique":function(){define(["exports","../../../../../core/maybe","../../../../webgl/enums"],function(b,a,c){class d{constructor(f,n,k){this.release=k;this.initializeConfiguration(f,n);this._configuration=
n.snapshot();this._program=this.initializeProgram(f);this._pipeline=this.initializePipeline(f.rctx.capabilities)}destroy(){this._program=a.disposeMaybe(this._program);this._pipeline=this._configuration=null}reload(f){a.disposeMaybe(this._program);this._program=this.initializeProgram(f);this._pipeline=this.initializePipeline(f.rctx.capabilities)}get program(){return this._program}get compiled(){return this.program.compiled}get key(){return this._configuration.key}get configuration(){return this._configuration}ensureAttributeLocations(f){this.program.assertCompatibleVertexAttributeLocations(f)}get primitiveType(){return c.PrimitiveType.TRIANGLES}getPipeline(f,
n,k){return this._pipeline}initializeConfiguration(f,n){}}b.ShaderTechnique=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/enums":function(){define(["exports"],function(b){b.ClearBufferBit=void 0;(function(a){a[a.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT";a[a.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT";a[a.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"})(b.ClearBufferBit||(b.ClearBufferBit={}));b.PrimitiveType=void 0;(function(a){a[a.POINTS=0]="POINTS";a[a.LINES=1]=
"LINES";a[a.LINE_LOOP=2]="LINE_LOOP";a[a.LINE_STRIP=3]="LINE_STRIP";a[a.TRIANGLES=4]="TRIANGLES";a[a.TRIANGLE_STRIP=5]="TRIANGLE_STRIP";a[a.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(b.PrimitiveType||(b.PrimitiveType={}));b.BlendFactor=void 0;(function(a){a[a.ZERO=0]="ZERO";a[a.ONE=1]="ONE";a[a.SRC_COLOR=768]="SRC_COLOR";a[a.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR";a[a.SRC_ALPHA=770]="SRC_ALPHA";a[a.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA";a[a.DST_ALPHA=772]="DST_ALPHA";a[a.ONE_MINUS_DST_ALPHA=
773]="ONE_MINUS_DST_ALPHA";a[a.DST_COLOR=774]="DST_COLOR";a[a.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR";a[a.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE";a[a.CONSTANT_COLOR=32769]="CONSTANT_COLOR";a[a.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR";a[a.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA";a[a.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"})(b.BlendFactor||(b.BlendFactor={}));b.BlendOperation=void 0;(function(a){a[a.ADD=32774]="ADD";a[a.MIN=32775]="MIN";a[a.MAX=32776]=
"MAX";a[a.SUBTRACT=32778]="SUBTRACT";a[a.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"})(b.BlendOperation||(b.BlendOperation={}));b.BufferType=void 0;(function(a){a[a.ARRAY_BUFFER=34962]="ARRAY_BUFFER";a[a.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER";a[a.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER";a[a.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER";a[a.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER";a[a.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER";a[a.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER"})(b.BufferType||
(b.BufferType={}));b.Face=void 0;(function(a){a[a.FRONT=1028]="FRONT";a[a.BACK=1029]="BACK";a[a.FRONT_AND_BACK=1032]="FRONT_AND_BACK"})(b.Face||(b.Face={}));b.CullMode=void 0;(function(a){a[a.CW=2304]="CW";a[a.CCW=2305]="CCW"})(b.CullMode||(b.CullMode={}));b.DataType=void 0;(function(a){a[a.BYTE=5120]="BYTE";a[a.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE";a[a.SHORT=5122]="SHORT";a[a.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT";a[a.INT=5124]="INT";a[a.UNSIGNED_INT=5125]="UNSIGNED_INT";a[a.FLOAT=5126]="FLOAT"})(b.DataType||
(b.DataType={}));b.CompareFunction=void 0;(function(a){a[a.NEVER=512]="NEVER";a[a.LESS=513]="LESS";a[a.EQUAL=514]="EQUAL";a[a.LEQUAL=515]="LEQUAL";a[a.GREATER=516]="GREATER";a[a.NOTEQUAL=517]="NOTEQUAL";a[a.GEQUAL=518]="GEQUAL";a[a.ALWAYS=519]="ALWAYS"})(b.CompareFunction||(b.CompareFunction={}));b.StencilOperation=void 0;(function(a){a[a.ZERO=0]="ZERO";a[a.KEEP=7680]="KEEP";a[a.REPLACE=7681]="REPLACE";a[a.INCR=7682]="INCR";a[a.DECR=7683]="DECR";a[a.INVERT=5386]="INVERT";a[a.INCR_WRAP=34055]="INCR_WRAP";
a[a.DECR_WRAP=34056]="DECR_WRAP"})(b.StencilOperation||(b.StencilOperation={}));b.TextureSamplingMode=void 0;(function(a){a[a.NEAREST=9728]="NEAREST";a[a.LINEAR=9729]="LINEAR";a[a.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST";a[a.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST";a[a.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR";a[a.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"})(b.TextureSamplingMode||(b.TextureSamplingMode={}));b.TextureWrapMode=void 0;(function(a){a[a.CLAMP_TO_EDGE=
33071]="CLAMP_TO_EDGE";a[a.REPEAT=10497]="REPEAT";a[a.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"})(b.TextureWrapMode||(b.TextureWrapMode={}));b.TextureType=void 0;(function(a){a[a.TEXTURE_2D=3553]="TEXTURE_2D";a[a.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP";a[a.TEXTURE_3D=32879]="TEXTURE_3D";a[a.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X";a[a.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X";a[a.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y";a[a.TEXTURE_CUBE_MAP_NEGATIVE_Y=
34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y";a[a.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z";a[a.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z";a[a.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"})(b.TextureType||(b.TextureType={}));b.PixelFormat=void 0;(function(a){a[a.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT";a[a.DEPTH_STENCIL=34041]="DEPTH_STENCIL";a[a.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8";a[a.ALPHA=6406]="ALPHA";a[a.RGB=6407]="RGB";a[a.RGBA=6408]="RGBA";a[a.LUMINANCE=
6409]="LUMINANCE";a[a.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA";a[a.RED=6403]="RED";a[a.RG=33319]="RG";a[a.RED_INTEGER=36244]="RED_INTEGER";a[a.RG_INTEGER=33320]="RG_INTEGER";a[a.RGB_INTEGER=36248]="RGB_INTEGER";a[a.RGBA_INTEGER=36249]="RGBA_INTEGER"})(b.PixelFormat||(b.PixelFormat={}));b.SizedPixelFormat=void 0;(function(a){a[a.RGBA4=32854]="RGBA4";a[a.R16F=33325]="R16F";a[a.RG16F=33327]="RG16F";a[a.RGB32F=34837]="RGB32F";a[a.RGBA16F=34842]="RGBA16F";a[a.R32F=33326]="R32F";a[a.RG32F=33328]="RG32F";
a[a.RGBA32F=34836]="RGBA32F";a[a.R11F_G11F_B10F=35898]="R11F_G11F_B10F";a[a.RGB8=32849]="RGB8";a[a.RGBA8=32856]="RGBA8";a[a.RGB5_A1=32855]="RGB5_A1";a[a.R8=33321]="R8";a[a.RG8=33323]="RG8";a[a.R8I=33329]="R8I";a[a.R8UI=33330]="R8UI";a[a.R16I=33331]="R16I";a[a.R16UI=33332]="R16UI";a[a.R32I=33333]="R32I";a[a.R32UI=33334]="R32UI";a[a.RG8I=33335]="RG8I";a[a.RG8UI=33336]="RG8UI";a[a.RG16I=33337]="RG16I";a[a.RG16UI=33338]="RG16UI";a[a.RG32I=33339]="RG32I";a[a.RG32UI=33340]="RG32UI";a[a.RGB16F=34843]="RGB16F";
a[a.RGB9_E5=35901]="RGB9_E5";a[a.SRGB8=35905]="SRGB8";a[a.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8";a[a.RGB565=36194]="RGB565";a[a.RGBA32UI=36208]="RGBA32UI";a[a.RGB32UI=36209]="RGB32UI";a[a.RGBA16UI=36214]="RGBA16UI";a[a.RGB16UI=36215]="RGB16UI";a[a.RGBA8UI=36220]="RGBA8UI";a[a.RGB8UI=36221]="RGB8UI";a[a.RGBA32I=36226]="RGBA32I";a[a.RGB32I=36227]="RGB32I";a[a.RGBA16I=36232]="RGBA16I";a[a.RGB16I=36233]="RGB16I";a[a.RGBA8I=36238]="RGBA8I";a[a.RGB8I=36239]="RGB8I";a[a.R8_SNORM=36756]="R8_SNORM";a[a.RG8_SNORM=
36757]="RG8_SNORM";a[a.RGB8_SNORM=36758]="RGB8_SNORM";a[a.RGBA8_SNORM=36759]="RGBA8_SNORM";a[a.RGB10_A2=32857]="RGB10_A2";a[a.RGB10_A2UI=36975]="RGB10_A2UI"})(b.SizedPixelFormat||(b.SizedPixelFormat={}));b.PixelType=void 0;(function(a){a[a.FLOAT=5126]="FLOAT";a[a.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE";a[a.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8";a[a.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4";a[a.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1";a[a.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5";
a[a.BYTE=5120]="BYTE";a[a.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT";a[a.SHORT=5122]="SHORT";a[a.UNSIGNED_INT=5125]="UNSIGNED_INT";a[a.INT=5124]="INT";a[a.HALF_FLOAT=5131]="HALF_FLOAT";a[a.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV";a[a.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV";a[a.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV";a[a.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"})(b.PixelType||(b.PixelType={}));b.RenderbufferFormat=
void 0;(function(a){a[a.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16";a[a.STENCIL_INDEX8=36168]="STENCIL_INDEX8";a[a.DEPTH_STENCIL=34041]="DEPTH_STENCIL";a[a.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24";a[a.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F";a[a.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8";a[a.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"})(b.RenderbufferFormat||(b.RenderbufferFormat={}));b.Usage=void 0;(function(a){a[a.STATIC_DRAW=35044]="STATIC_DRAW";a[a.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW";
a[a.STREAM_DRAW=35040]="STREAM_DRAW";a[a.STATIC_READ=35045]="STATIC_READ";a[a.DYNAMIC_READ=35049]="DYNAMIC_READ";a[a.STREAM_READ=35041]="STREAM_READ";a[a.STATIC_COPY=35046]="STATIC_COPY";a[a.DYNAMIC_COPY=35050]="DYNAMIC_COPY";a[a.STREAM_COPY=35042]="STREAM_COPY"})(b.Usage||(b.Usage={}));b.ShaderType=void 0;(function(a){a[a.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER";a[a.VERTEX_SHADER=35633]="VERTEX_SHADER"})(b.ShaderType||(b.ShaderType={}));b.FramebufferTarget=void 0;(function(a){a[a.FRAMEBUFFER=36160]=
"FRAMEBUFFER";a[a.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER";a[a.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"})(b.FramebufferTarget||(b.FramebufferTarget={}));b.ResourceType=void 0;(function(a){a[a.Texture=0]="Texture";a[a.BufferObject=1]="BufferObject";a[a.VertexArrayObject=2]="VertexArrayObject";a[a.Shader=3]="Shader";a[a.Program=4]="Program";a[a.FramebufferObject=5]="FramebufferObject";a[a.Renderbuffer=6]="Renderbuffer";a[a.Sync=7]="Sync";a[a.UNCOUNTED=8]="UNCOUNTED";a[a.LinesOfCode=8]="LinesOfCode";
a[a.Uniform=9]="Uniform";a[a.COUNT=10]="COUNT"})(b.ResourceType||(b.ResourceType={}));b.ColorAttachment=void 0;(function(a){a[a.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0";a[a.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1";a[a.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2";a[a.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3";a[a.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4";a[a.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5";a[a.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6";a[a.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7";
a[a.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8";a[a.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9";a[a.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10";a[a.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11";a[a.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12";a[a.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13";a[a.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14";a[a.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"})(b.ColorAttachment||(b.ColorAttachment={}));b.SpecialDrawBuffers=void 0;(function(a){a[a.NONE=0]=
"NONE";a[a.BACK=1029]="BACK"})(b.SpecialDrawBuffers||(b.SpecialDrawBuffers={}));b.CompressedTextureFormat=void 0;(function(a){a[a.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT";a[a.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT";a[a.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT";a[a.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT";a[a.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC";a[a.COMPRESSED_SIGNED_R11_EAC=37489]=
"COMPRESSED_SIGNED_R11_EAC";a[a.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC";a[a.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC";a[a.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2";a[a.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2";a[a.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2";a[a.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2";a[a.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC";
a[a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(b.CompressedTextureFormat||(b.CompressedTextureFormat={}));b.UniformType=void 0;(function(a){a[a.FLOAT=5126]="FLOAT";a[a.FLOAT_VEC2=35664]="FLOAT_VEC2";a[a.FLOAT_VEC3=35665]="FLOAT_VEC3";a[a.FLOAT_VEC4=35666]="FLOAT_VEC4";a[a.INT=5124]="INT";a[a.INT_VEC2=35667]="INT_VEC2";a[a.INT_VEC3=35668]="INT_VEC3";a[a.INT_VEC4=35669]="INT_VEC4";a[a.BOOL=35670]="BOOL";a[a.BOOL_VEC2=35671]="BOOL_VEC2";a[a.BOOL_VEC3=35672]="BOOL_VEC3";
a[a.BOOL_VEC4=35673]="BOOL_VEC4";a[a.FLOAT_MAT2=35674]="FLOAT_MAT2";a[a.FLOAT_MAT3=35675]="FLOAT_MAT3";a[a.FLOAT_MAT4=35676]="FLOAT_MAT4";a[a.SAMPLER_2D=35678]="SAMPLER_2D";a[a.SAMPLER_CUBE=35680]="SAMPLER_CUBE";a[a.UNSIGNED_INT=5125]="UNSIGNED_INT";a[a.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2";a[a.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3";a[a.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4";a[a.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3";a[a.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4";a[a.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2";
a[a.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4";a[a.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2";a[a.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3";a[a.SAMPLER_3D=35679]="SAMPLER_3D";a[a.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW";a[a.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY";a[a.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW";a[a.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW";a[a.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D";a[a.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D";a[a.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE";a[a.INT_SAMPLER_2D_ARRAY=
36303]="INT_SAMPLER_2D_ARRAY";a[a.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D";a[a.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D";a[a.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE";a[a.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"})(b.UniformType||(b.UniformType={}));b.SyncParameter=void 0;(function(a){a[a.OBJECT_TYPE=37138]="OBJECT_TYPE";a[a.SYNC_CONDITION=37139]="SYNC_CONDITION";a[a.SYNC_STATUS=37140]="SYNC_STATUS";a[a.SYNC_FLAGS=37141]=
"SYNC_FLAGS"})(b.SyncParameter||(b.SyncParameter={}));b.SyncStatus=void 0;(function(a){a[a.UNSIGNALED=37144]="UNSIGNALED";a[a.SIGNALED=37145]="SIGNALED"})(b.SyncStatus||(b.SyncStatus={}));b.ClientWaitSyncStatus=void 0;(function(a){a[a.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED";a[a.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED";a[a.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED";a[a.WAIT_FAILED=37149]="WAIT_FAILED"})(b.ClientWaitSyncStatus||(b.ClientWaitSyncStatus={}));b.SyncCondition=void 0;(function(a){a[a.SYNC_GPU_COMMANDS_COMPLETE=
37143]="SYNC_GPU_COMMANDS_COMPLETE"})(b.SyncCondition||(b.SyncCondition={}));b.SyncFlag=void 0;(function(a){a[a.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"})(b.SyncFlag||(b.SyncFlag={}));b.DepthStencilAttachment=33306;b.baseTextureUnit=33984;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/DefaultVertexAttributeLocations":function(){define(["exports","./VertexAttribute"],function(b,a){a=new Map([[a.VertexAttribute.POSITION,0],[a.VertexAttribute.NORMAL,
1],[a.VertexAttribute.NORMALCOMPRESSED,1],[a.VertexAttribute.UV0,2],[a.VertexAttribute.COLOR,3],[a.VertexAttribute.COLORFEATUREATTRIBUTE,3],[a.VertexAttribute.SIZE,4],[a.VertexAttribute.TANGENT,4],[a.VertexAttribute.AUXPOS1,5],[a.VertexAttribute.SYMBOLCOLOR,5],[a.VertexAttribute.AUXPOS2,6],[a.VertexAttribute.FEATUREATTRIBUTE,6],[a.VertexAttribute.INSTANCEFEATUREATTRIBUTE,6],[a.VertexAttribute.INSTANCECOLOR,7],[a.VertexAttribute.OBJECTANDLAYERIDCOLOR,7],[a.VertexAttribute.INSTANCEOBJECTANDLAYERIDCOLOR,
7],[a.VertexAttribute.INSTANCEMODEL,8],[a.VertexAttribute.INSTANCEMODELNORMAL,12],[a.VertexAttribute.INSTANCEMODELORIGINHI,11],[a.VertexAttribute.INSTANCEMODELORIGINLO,15]]);b.Default3D=a;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Program":function(){define(["exports","../../../../core/PooledArray","../../../webgl/checkWebGLError"],function(b,a,c){class d{constructor(f,n,k){this._context=f;this._locations=k;this._textures=new Map;this._freeTextureUnits=
new a({deallocator:null});this._glProgram=f.programCache.acquire(n.generate("vertex"),n.generate("fragment"),k);this._glProgram.stop=()=>{throw Error("Wrapped _glProgram used directly");};this.bindPass=n.generateBindPass(this);this.bindDraw=n.generateBindDraw(this);this._fragmentUniforms=c.webglDebugEnabled()?n.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get compiled(){return this._glProgram.compiled}setUniform1b(f,n){this._glProgram.setUniform1i(f,
n?1:0)}setUniform1i(f,n){this._glProgram.setUniform1i(f,n)}setUniform1f(f,n){this._glProgram.setUniform1f(f,n)}setUniform2fv(f,n){this._glProgram.setUniform2fv(f,n)}setUniform3fv(f,n){this._glProgram.setUniform3fv(f,n)}setUniform4fv(f,n){this._glProgram.setUniform4fv(f,n)}setUniformMatrix3fv(f,n){this._glProgram.setUniformMatrix3fv(f,n)}setUniformMatrix4fv(f,n){this._glProgram.setUniformMatrix4fv(f,n)}setUniform1fv(f,n){this._glProgram.setUniform1fv(f,n)}setUniform1iv(f,n){this._glProgram.setUniform1iv(f,
n)}setUniform2iv(f,n){this._glProgram.setUniform3iv(f,n)}setUniform3iv(f,n){this._glProgram.setUniform3iv(f,n)}setUniform4iv(f,n){this._glProgram.setUniform4iv(f,n)}assertCompatibleVertexAttributeLocations(f){f.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear();this._freeTextureUnits.clear()}bindTexture(f,n){if(null==n?.glName){if(n=this._textures.get(f))this._context.bindTexture(null,n.unit),this._freeTextureUnit(n),this._textures.delete(f);
return null}let k=this._textures.get(f);null==k?(k=this._allocTextureUnit(n),this._textures.set(f,k)):k.texture=n;this._context.useProgram(this);this.setUniform1i(f,k.unit);this._context.bindTexture(n,k.unit);return k.unit}rebindTextures(){this._context.useProgram(this);this._textures.forEach((f,n)=>{this._context.bindTexture(f.texture,f.unit);this.setUniform1i(n,f.unit)});null!=this._fragmentUniforms&&this._fragmentUniforms.forEach(f=>{"sampler2D"!==f.type&&"samplerCube"!==f.type||this._textures.has(f.name)||
console.error(`Texture sampler ${f.name} has no bound texture`)})}_allocTextureUnit(f){return{texture:f,unit:0===this._freeTextureUnits.length?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(f){this._freeTextureUnits.push(f.unit)}}b.Program=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/checkWebGLError":function(){define(["exports","../../core/Error","../../core/has","../../core/Logger"],function(b,a,c,d){function f(g,q){switch(q){case g.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";
case g.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case g.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case g.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case g.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case g.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";
default:return"Unknown error"}}const n=d.getLogger("esri.views.webgl.checkWebGLError"),k=!!c("enable-feature:webgl-debug");b.checkWebGLError=function(g){if(k){const q=g.getError();q&&(g=f(g,q),n.error(new a("webgl-error","WebGL error occurred",{message:g,stack:Error().stack})))}};b.hasFeatureFlagWebGLDebug=k;b.webglDebugEnabled=function(){return k};b.webglValidateShadersEnabled=function(){return k};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/renderState":function(){define(["exports",
"../3d/webgl-engine/lib/basicInterfaces","./enums"],function(b,a,c){function d(U){return B.intern(U)}function f(U){return D.intern(U)}function n(U){return F.intern(U)}function k(U){return K.intern(U)}function g(U){return L.intern(U)}function q(U){return G.intern(U)}function e(U){return O.intern(U)}function m(U){return P.intern(U)}function l(U){return J.intern(U)}function w(U){return"["+U.join(",")+"]"}function v(U){return U?w([U.srcRgb,U.srcAlpha,U.dstRgb,U.dstAlpha,U.opRgb,U.opAlpha,U.color.r,U.color.g,
U.color.b,U.color.a]):null}function x(U){return U?w([U.face,U.mode]):null}function p(U){return U?w([U.factor,U.units]):null}function h(U){return U?w([U.func]):null}function t(U){return U?w([U.function.func,U.function.ref,U.function.mask,U.operation.fail,U.operation.zFail,U.operation.zPass]):null}function r(U){return U?w([U.zNear,U.zFar]):null}function u(U){return U?w([U.r,U.g,U.b,U.a]):null}function y(U){return U?w([U.mask]):null}function z(U){return U?w(U.buffers):null}const A={face:c.Face.BACK,
mode:c.CullMode.CCW},C={face:c.Face.FRONT,mode:c.CullMode.CCW};class E{constructor(U,M){this._makeKey=U;this._makeRef=M;this._interns=new Map}intern(U){if(!U)return null;const M=this._makeKey(U),V=this._interns;V.has(M)||V.set(M,this._makeRef(U));return V.get(M)??null}}const B=new E(v,U=>({__tag:"Blending",...U})),D=new E(x,U=>({__tag:"Culling",...U})),F=new E(p,U=>({__tag:"PolygonOffset",...U})),K=new E(h,U=>({__tag:"DepthTest",...U})),L=new E(t,U=>({__tag:"StencilTest",...U})),G=new E(r,U=>({__tag:"DepthWrite",
...U})),O=new E(u,U=>({__tag:"ColorWrite",...U})),P=new E(y,U=>({__tag:"StencilWrite",...U})),J=new E(z,U=>({__tag:"DrawBuffers",...U})),R=new E(function(U){return U?w([v(U.blending),x(U.culling),p(U.polygonOffset),h(U.depthTest),t(U.stencilTest),r(U.depthWrite),u(U.colorWrite),y(U.stencilWrite),z(U.drawBuffers)]):null},U=>({blending:d(U.blending),culling:f(U.culling),polygonOffset:n(U.polygonOffset),depthTest:k(U.depthTest),stencilTest:g(U.stencilTest),depthWrite:q(U.depthWrite),colorWrite:e(U.colorWrite),
stencilWrite:m(U.stencilWrite),drawBuffers:l(U.drawBuffers)}));class X{constructor(U){this._drawBuffersInvalid=this._stencilWriteInvalid=this._colorWriteInvalid=this._depthWriteInvalid=this._stencilTestInvalid=this._depthTestInvalid=this._polygonOffsetInvalid=this._cullingInvalid=this._blendingInvalid=this._pipelineInvalid=!0;this._stateSetters=U}setPipeline(U){if(this._pipelineInvalid||U!==this._pipeline)this._setBlending(U.blending),this._setCulling(U.culling),this._setPolygonOffset(U.polygonOffset),
this._setDepthTest(U.depthTest),this._setStencilTest(U.stencilTest),this._setDepthWrite(U.depthWrite),this._setColorWrite(U.colorWrite),this._setStencilWrite(U.stencilWrite),this._setDrawBuffers(U.drawBuffers),this._pipeline=U;this._pipelineInvalid=!1}invalidateBlending(){this._pipelineInvalid=this._blendingInvalid=!0}invalidateCulling(){this._pipelineInvalid=this._cullingInvalid=!0}invalidatePolygonOffset(){this._pipelineInvalid=this._polygonOffsetInvalid=!0}invalidateDepthTest(){this._pipelineInvalid=
this._depthTestInvalid=!0}invalidateStencilTest(){this._pipelineInvalid=this._stencilTestInvalid=!0}invalidateDepthWrite(){this._pipelineInvalid=this._depthWriteInvalid=!0}invalidateColorWrite(){this._pipelineInvalid=this._colorWriteInvalid=!0}invalidateStencilWrite(){this._pipelineInvalid=this._stencilTestInvalid=!0}invalidateDrawBuffers(){this._pipelineInvalid=this._drawBuffersInvalid=!0}_setBlending(U){this._blending=this._setSubState(U,this._blending,this._blendingInvalid,this._stateSetters.setBlending);
this._blendingInvalid=!1}_setCulling(U){this._culling=this._setSubState(U,this._culling,this._cullingInvalid,this._stateSetters.setCulling);this._cullingInvalid=!1}_setPolygonOffset(U){this._polygonOffset=this._setSubState(U,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset);this._polygonOffsetInvalid=!1}_setDepthTest(U){this._depthTest=this._setSubState(U,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest);this._depthTestInvalid=!1}_setStencilTest(U){this._stencilTest=
this._setSubState(U,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest);this._stencilTestInvalid=!1}_setDepthWrite(U){this._depthWrite=this._setSubState(U,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite);this._depthWriteInvalid=!1}_setColorWrite(U){this._colorWrite=this._setSubState(U,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite);this._colorWriteInvalid=!1}_setStencilWrite(U){this._stencilWrite=this._setSubState(U,this._stencilWrite,
this._stencilWriteInvalid,this._stateSetters.setStencilWrite);this._stencilTestInvalid=!1}_setDrawBuffers(U){this._drawBuffers=this._setSubState(U,this._drawBuffers,this._drawBuffersInvalid,this._stateSetters.setDrawBuffers);this._drawBuffersInvalid=!1}_setSubState(U,M,V,Y){if(V||U!==M)Y(U),this._pipelineInvalid=!0;return U}}b.StateTracker=X;b.backFaceCullingParams=A;b.cullingParams=U=>U===a.CullFaceOptions.Back?A:U===a.CullFaceOptions.Front?C:null;b.defaultColorWriteParams={r:!0,g:!0,b:!0,a:!0};
b.defaultDepthWriteParams={zNear:0,zFar:1};b.frontFaceCullingParams=C;b.makeBlending=d;b.makeColorWrite=e;b.makeCulling=f;b.makeDepthTest=k;b.makeDepthWrite=q;b.makeDrawBuffers=l;b.makePipelineState=function(U){return R.intern(U)};b.makePolygonOffset=n;b.makeStencilTest=g;b.makeStencilWrite=m;b.separateBlendingParams=function(U,M,V,Y,W=c.BlendOperation.ADD,H=c.BlendOperation.ADD,S=[0,0,0,0]){return{srcRgb:U,srcAlpha:M,dstRgb:V,dstAlpha:Y,opRgb:W,opAlpha:H,color:{r:S[0],g:S[1],b:S[2],a:S[3]}}};b.simpleBlendingParams=
function(U,M,V=c.BlendOperation.ADD,Y=[0,0,0,0]){return{srcRgb:U,srcAlpha:U,dstRgb:M,dstAlpha:M,opRgb:V,opAlpha:V,color:{r:Y[0],g:Y[1],b:Y[2],a:Y[3]}}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/basicInterfaces":function(){define(["exports"],function(b){b.CullFaceOptions=void 0;(function(a){a[a.None=0]="None";a[a.Front=1]="Front";a[a.Back=2]="Back";a[a.COUNT=3]="COUNT"})(b.CullFaceOptions||(b.CullFaceOptions={}));b.DepthTestFunction=void 0;(function(a){a[a.Less=
0]="Less";a[a.Lequal=1]="Lequal";a[a.COUNT=2]="COUNT"})(b.DepthTestFunction||(b.DepthTestFunction={}));b.RenderRequestType=void 0;(function(a){a[a.BACKGROUND=0]="BACKGROUND";a[a.UPDATE=1]="UPDATE"})(b.RenderRequestType||(b.RenderRequestType={}));b.ResourceState=void 0;(function(a){a[a.NOT_LOADED=0]="NOT_LOADED";a[a.LOADING=1]="LOADING";a[a.LOADED=2]="LOADED"})(b.ResourceState||(b.ResourceState={}));b.StencilBits=void 0;(function(a){a[a.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded";a[a.OutlineVisualElementMask=
2]="OutlineVisualElementMask"})(b.StencilBits||(b.StencilBits={}));b.Object3DState=void 0;(function(a){a[a.Highlight=0]="Highlight";a[a.MaskOccludee=1]="MaskOccludee";a[a.COUNT=2]="COUNT"})(b.Object3DState||(b.Object3DState={}));b.AlphaDiscardMode=void 0;(function(a){a[a.Blend=0]="Blend";a[a.Opaque=1]="Opaque";a[a.Mask=2]="Mask";a[a.MaskBlend=3]="MaskBlend";a[a.COUNT=4]="COUNT"})(b.AlphaDiscardMode||(b.AlphaDiscardMode={}));b.Decorations=void 0;(function(a){a[a.OFF=0]="OFF";a[a.ON=1]="ON"})(b.Decorations||
(b.Decorations={}));b.TextureEncodingMimeType=void 0;(function(a){a.DDS_ENCODING="image/vnd-ms.dds";a.KTX2_ENCODING="image/ktx2";a.BASIS_ENCODING="image/x.basis"})(b.TextureEncodingMimeType||(b.TextureEncodingMimeType={}));Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/ChapmanAtmosphereTechniqueConfiguration":function(){define(["exports","../../../chunks/tslib.es6","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],function(b,a,c){class d extends c.ShaderTechniqueConfiguration{constructor(){super(...arguments);
this.reduced=this.haze=!1}}a.__decorate([c.parameter()],d.prototype,"haze",void 0);a.__decorate([c.parameter()],d.prototype,"reduced",void 0);b.ChapmanAtmosphereTechniqueConfiguration=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration":function(){define(["exports","../shaderModules/interfaces"],function(b,a){class c extends a.NoParameters{constructor(){super();this._key="";this._keyDirty=!1;this._parameterBits=
this._parameterBits?this._parameterBits.map(()=>0):[];this._parameterNames||(this._parameterNames=[])}get key(){this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits));return this._key}snapshot(){const d=this._parameterNames,f={key:this.key};for(const n of d)f[n]=this[n];return f}}b.ShaderTechniqueConfiguration=c;b.parameter=function(d={}){return(f,n)=>{f._parameterNames=f._parameterNames??[];f._parameterNames.push(n);if(null!=d.constValue)Object.defineProperty(f,
n,{get(){return d.constValue}});else{const k=f._parameterNames.length-1,g=Math.ceil(Math.log2(d.count||2)),q=f._parameterBits??[0];let e=0;for(;16<q[e]+g;)e++,e>=q.length&&q.push(0);f._parameterBits=q;const m=q[e],l=(1<<g)-1<<m;q[e]+=g;Object.defineProperty(f,n,{get(){return this[k]},set(w){if(this[k]!==w&&(this[k]=w,this._keyDirty=!0,this._parameterBits[e]=this._parameterBits[e]&~l|+w<<m&l,"number"!==typeof w&&"boolean"!==typeof w))throw Error("Configuration value for "+n+" must be boolean or number, got "+
typeof w);}})}}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/FBOCache":function(){define("exports ../../../../core/maybe ./FBOPool ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Renderbuffer ../../../webgl/RenderbufferDescriptor ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),function(b,a,c,d,f,n,k,g,q){class e{constructor(C){this.rctx=C;this._acquired=new Set;this._cache=new c.FBOPool(C.newCache,"FBOCache");
this._depthCache=new c.FBOPool(C.newCache,"DepthAttachmentCache");this._colorCache=new c.FBOPool(C.newCache,"ColorAttachmentCache")}destroy(){this._cache.destroy();this._depthCache.destroy();this._colorCache.destroy()}clean(){this._cache.clean();this._colorCache.clean();this._depthCache.clean()}frame(){this._cache.frame();this._colorCache.frame();this._depthCache.frame()}get usedMemory(){return Array.from(this._acquired.values()).reduce((C,E)=>C+("colorTexture"in E?E.colorTexture?.gpuMemoryUsage??
0:E.usedMemory),this._cache.usedMemory+this._colorCache.usedMemory+this._depthCache.usedMemory)}set interactive(C){this._cache.interactive=this._colorCache.interactive=this._depthCache.interactive=C}acquire(C,E,B){const D=`${C}x${E}x${B}`,F=this._cache.pop(D)||new m(D,new f.FramebufferObject(this.rctx,{...z[C],width:E,height:B}),K=>{F.releaseDepth();F.depth=this._acquireDepth(K,F.fbo.width,F.fbo.height);F.fbo.attachDepthStencil(F.depth.attachment);return F},(K,L)=>{K=this._acquireColor(K,E,B);F.colors??
(F.colors=new Map);F.colors.set(L,K);F.fbo.attachColorTexture(K.attachment,L);return F});F.release=()=>{this._acquired.delete(F);F.releaseDepth();this._cache.put(F);F.release=()=>console.log(`Double FBO release in ${Error().stack}`)};this.rctx.unbindTexture(F.fbo.colorTexture);return this._trackHandle(F)}acquireDepth(C,E,B){return this._acquireDepth(C,E,B)}_acquireDepth(C,E,B){const D=`${C}x${E}x${B}`,F=this._depthCache.pop(D);if(F)return this._trackHandle(F);const K=C===b.DepthFormat.DEPTH_STENCIL_TEXTURE?
new w(D,new g.Texture(this.rctx,{...A[C],width:E,height:B}),()=>{this._acquired.delete(K);this._depthCache.put(K)}):new w(D,new n.Renderbuffer(this.rctx,{...A[C],width:E,height:B}),()=>{this._acquired.delete(K);this._depthCache.put(K)});return this._trackHandle(K)}_acquireColor(C,E,B){const D=`${C}x${E}x${B}`,F=this._colorCache.pop(D);if(F)return this._trackHandle(F);const K=new v(D,new g.Texture(this.rctx,{...z[C],width:E,height:B}),()=>{this._acquired.delete(K);this._colorCache.put(K)});return this._trackHandle(K)}_trackHandle(C){this._acquired.add(C);
return C}}class m{constructor(C,E,B,D){this.key=C;this.fbo=E;this.acquireDepth=B;this.acquireColor=D;this.release=()=>{};this.incarnation=0}dispose(){this.fbo.dispose()}releaseDepth(){this.fbo.detachDepthStencilTexture();this.fbo.detachDepthStencilBuffer();this.depth=a.releaseMaybe(this.depth)}detachDepth(){const C=this.depth;this.depth=void 0;this.fbo.detachDepthStencilTexture();this.fbo.detachDepthStencilBuffer();return C}attachDepth(C){this.releaseDepth();C&&(this.fbo.attachDepthStencil(C.attachment),
this.depth=C);return this}releaseColor(C){this.fbo.detachColorTexture(C);const E=this.colors?.get(C);this.colors?.delete(C);a.releaseMaybe(E)}get colorTexture(){return this.fbo?.colorTexture}getColorTexture(C=d.ColorAttachment.COLOR_ATTACHMENT0){return this.fbo?.getColorTexture(C)}get usedMemory(){return this.fbo.gpuMemoryUsage}}class l{constructor(C,E,B){this.key=C;this.attachment=E;this.release=B;this.incarnation=0}dispose(){this.attachment.dispose()}get usedMemory(){return this.attachment.gpuMemoryUsage}}
class w extends l{}class v extends l{constructor(C,E,B){super(C,E,B);this.attachment=E;this.release=B}}b.ColorFormat=void 0;(function(C){C[C.RED=0]="RED";C[C.RG=1]="RG";C[C.RGBA4=2]="RGBA4";C[C.RGBA=3]="RGBA";C[C.RGBA_MIPMAP=4]="RGBA_MIPMAP";C[C.R16F=5]="R16F";C[C.RGBA16F=6]="RGBA16F"})(b.ColorFormat||(b.ColorFormat={}));const x=new q.TextureDescriptor;x.pixelFormat=d.PixelFormat.RED;x.internalFormat=d.SizedPixelFormat.R8;x.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE;const p=new q.TextureDescriptor;
p.pixelFormat=d.PixelFormat.RG;p.internalFormat=d.SizedPixelFormat.RG8;p.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE;const h=new q.TextureDescriptor;h.internalFormat=d.SizedPixelFormat.RGBA4;h.dataType=d.PixelType.UNSIGNED_SHORT_4_4_4_4;h.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE;const t=new q.TextureDescriptor;t.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE;const r=new q.TextureDescriptor;r.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE;r.samplingMode=d.TextureSamplingMode.LINEAR_MIPMAP_LINEAR;r.hasMipmap=!0;r.maxAnisotropy=
8;const u=new q.TextureDescriptor;u.pixelFormat=d.PixelFormat.RED;u.dataType=d.PixelType.HALF_FLOAT;u.internalFormat=d.SizedPixelFormat.R16F;u.samplingMode=d.TextureSamplingMode.NEAREST;const y=new q.TextureDescriptor;y.dataType=d.PixelType.HALF_FLOAT;y.internalFormat=d.SizedPixelFormat.RGBA16F;y.samplingMode=d.TextureSamplingMode.NEAREST;const z={[b.ColorFormat.RED]:x,[b.ColorFormat.RG]:p,[b.ColorFormat.RGBA4]:h,[b.ColorFormat.RGBA]:t,[b.ColorFormat.RGBA_MIPMAP]:r,[b.ColorFormat.R16F]:u,[b.ColorFormat.RGBA16F]:y};
b.DepthFormat=void 0;(function(C){C[C.DEPTH_STENCIL_TEXTURE=0]="DEPTH_STENCIL_TEXTURE";C[C.DEPTH_STENCIL_BUFFER=1]="DEPTH_STENCIL_BUFFER";C[C.DEPTH24_BUFFER=2]="DEPTH24_BUFFER";C[C.DEPTH16_BUFFER=3]="DEPTH16_BUFFER"})(b.DepthFormat||(b.DepthFormat={}));q=new q.TextureDescriptor;q.pixelFormat=d.PixelFormat.DEPTH_STENCIL;q.dataType=d.PixelType.UNSIGNED_INT_24_8;q.samplingMode=d.TextureSamplingMode.NEAREST;q.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE;const A={[b.DepthFormat.DEPTH_STENCIL_TEXTURE]:q,[b.DepthFormat.DEPTH_STENCIL_BUFFER]:new k.RenderbufferDescriptor(d.RenderbufferFormat.DEPTH24_STENCIL8,
4),[b.DepthFormat.DEPTH24_BUFFER]:new k.RenderbufferDescriptor(d.RenderbufferFormat.DEPTH_COMPONENT24,4),[b.DepthFormat.DEPTH16_BUFFER]:new k.RenderbufferDescriptor(d.RenderbufferFormat.DEPTH_COMPONENT16,4)};b.FBOCache=e;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/FBOPool":function(){define(["exports","../../../../core/MemCachePool","../../../../core/PooledArray"],function(b,a,c){class d{constructor(f,n){this._last=new c;this._incarnation=0;this._cache=
new a.MemCachePool(f,n)}destroy(){this._last?.forAll(f=>f.dispose());this._last=null;this._cache.destroy()}set interactive(f){f&&!this._last?this._last=new c:f||(this._last?.forAll(n=>n.dispose()),this._last=null)}clean(){this._last?.filterInPlace(f=>f.incarnation<this._incarnation?(this._cache.put(f.key,f),!1):!0)}frame(){++this._incarnation}pop(f){if(this._last){const n=this._last.find(k=>k.key===f);if(n)return this._last.removeUnordered(n),n}return this._cache.pop(f)}put(f){f.incarnation=this._incarnation;
this._last?this._last.push(f):this._cache.put(f.key,f)}get usedMemory(){return this._last?.reduce((f,n)=>f+n.usedMemory,0)??0}}b.FBOPool=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/core/MemCachePool":function(){define(["exports","./MemCache"],function(b,a){class c{constructor(d,f){this._cache=d(f,(n,k)=>this._remove(n,k))}hitrate(){return this._cache.hitRate}destroy(){this._cache.destroy()}clear(){this._cache.clear()}pop(d){const f=this._cache.peek(d);if(f){var n=f.pop();
if(0<f.length){const k=f.reduce((g,q)=>g+q.usedMemory,0);this._cache.updateSize(d,f,k)}else this._cache.pop(d);return n}}put(d,f,n=a.minPriority){const k=this._cache.peek(d);k?(k.push(f),f=k.reduce((g,q)=>g+q.usedMemory,0),this._cache.updateSize(d,k,f)):this._cache.put(d,[f],f.usedMemory,n)}_remove(d,f){switch(f){case a.RemoveMode.ALL:return d.forEach(n=>n.dispose()),0;case a.RemoveMode.SOME:return d.shift()?.dispose(),d.reduce((n,k)=>n+k.usedMemory,0)}}}b.MemCachePool=c;Object.defineProperty(b,Symbol.toStringTag,
{value:"Module"})})},"esri/views/webgl/FramebufferObject":function(){define("exports ../../core/has ../../core/Logger ../../core/maybe ./BufferObject ./checkWebGLError ./contextUtils ./enums ./GLObjectType ./Renderbuffer ./Texture".split(" "),function(b,a,c,d,f,n,k,g,q,e,m){function l(h){return null!=h&&"type"in h&&h.type===q.GLObjectType.Texture}function w(h,t){const r=Math.max(h.width,h.height);return r>t?(x.warn(`Resizing FBO attachment size ${h.width}x${h.height} to device limit ${t}`),t/=r,h.width=
Math.round(h.width*t),h.height=Math.round(h.height*t),!1):!0}function v(h){return h.descriptor.target===g.TextureType.TEXTURE_CUBE_MAP?g.TextureType.TEXTURE_CUBE_MAP_POSITIVE_X:g.TextureType.TEXTURE_2D}const x=c.getLogger("esri.views.webgl.FramebufferObject");class p{constructor(h,t,r=null){this._context=h;this._glName=null;this._colorAttachments=new Map;this._depthStencilTexture=this._depthStencilBuffer=null;this._initialized=!1;h.instanceCounter.increment(g.ResourceType.FramebufferObject,this);
h=l(t)?t:new m.Texture(this._context,t);this._colorAttachments.set(g.ColorAttachment.COLOR_ATTACHMENT0,h);this._validateTextureDescriptor(h.descriptor);this._validateColorAttachmentPoint(g.ColorAttachment.COLOR_ATTACHMENT0);null!=r&&(l(r)||null!=r&&"pixelFormat"in r?(this._context.capabilities.depthTexture||console.error("Setting the depth/stencil texture as an attachment requires WEBGL_depth_texture or WebGL2"),this._depthStencilTexture=l(r)?r:new m.Texture(this._context,r),this._validateTextureDescriptor(this._depthStencilTexture.descriptor)):
(this._depthStencilBuffer=r=null!=r&&"type"in r&&r.type===q.GLObjectType.RenderBuffer?r:new e.Renderbuffer(this._context,r),this._validateRenderBufferDescriptor(r.descriptor)))}dispose(){if(0!==this._colorAttachments.size||this._glName){var h=this._context.getBoundFramebufferObject();this._colorAttachments.forEach((t,r)=>this.detachColorTexture(r)?.dispose());this.detachDepthStencilBuffer()?.dispose();this.detachDepthStencilTexture()?.dispose();this._glName&&(this._context.gl.deleteFramebuffer(this._glName),
this._glName=null);this._context.bindFramebuffer(h);this._context.instanceCounter.decrement(g.ResourceType.FramebufferObject,this)}}get glName(){return this._glName}get colorTexture(){return this._colorAttachments.get(g.ColorAttachment.COLOR_ATTACHMENT0)}get depthStencil(){return this._depthStencilTexture||this._depthStencilBuffer}get depthStencilTexture(){return this._depthStencilTexture}get width(){return this._colorAttachments.get(g.ColorAttachment.COLOR_ATTACHMENT0)?.descriptor?.width??0}get height(){return this._colorAttachments.get(g.ColorAttachment.COLOR_ATTACHMENT0)?.descriptor?.height??
0}get gpuMemoryUsage(){return[...this._colorAttachments].reduce((h,[,t])=>h+t.gpuMemoryUsage,this.depthStencil?.gpuMemoryUsage??0)}getColorTexture(h){return(h=this._colorAttachments.get(h))&&l(h)?h:null}get colorAttachments(){return[...this._colorAttachments.keys()]}attachColorTexture(h,t=g.ColorAttachment.COLOR_ATTACHMENT0){h&&(this._validateColorAttachmentPoint(t),this._validateTextureDescriptor(h.descriptor),this.detachColorTexture(t)?.dispose(),this._initialized&&(this._context.bindFramebuffer(this),
this._framebufferTexture2D(h.glName,t)),this._colorAttachments.set(t,h))}detachColorTexture(h=g.ColorAttachment.COLOR_ATTACHMENT0){const t=this._colorAttachments.get(h);if(t)return this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,h)),this._colorAttachments.delete(h),t}setColorTextureTarget(h,t=g.ColorAttachment.COLOR_ATTACHMENT0){const r=this._colorAttachments.get(t);r&&this._framebufferTexture2D(r.glName,t,h)}attachDepthStencil(h){if(h)switch(h.type){case q.GLObjectType.Texture:return this._attachDepthStencilTexture(h);
case q.GLObjectType.RenderBuffer:return this._attachDepthStencilBuffer(h)}}_attachDepthStencilTexture(h){if(null!=h){var t=h.descriptor;t.pixelFormat!==g.PixelFormat.DEPTH_STENCIL&&t.pixelFormat!==g.PixelFormat.DEPTH24_STENCIL8&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!");t.dataType!==g.PixelType.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!");this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!");
this._validateTextureDescriptor(t);this._disposeDepthStencilAttachments();this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(h.glName,g.DepthStencilAttachment));this._depthStencilTexture?.dispose();this._depthStencilTexture=h}}detachDepthStencilTexture(){const h=this._depthStencilTexture;h&&this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,g.DepthStencilAttachment));this._depthStencilTexture=null;return h}_attachDepthStencilBuffer(h){if(null!=
h){var t=h.descriptor;this._validateRenderBufferDescriptor(t);this._disposeDepthStencilAttachments();if(this._initialized){this._context.bindFramebuffer(this);const r=this._context.gl;t=this._getGLAttachmentPoint(t);r.framebufferRenderbuffer(g.FramebufferTarget.FRAMEBUFFER,t,r.RENDERBUFFER,h.glName)}this._depthStencilBuffer=h}}detachDepthStencilBuffer(){const h=this._depthStencilBuffer;if(h&&this._initialized){this._context.bindFramebuffer(this);const t=this._context.gl,r=this._getGLAttachmentPoint(h.descriptor);
t.framebufferRenderbuffer(g.FramebufferTarget.FRAMEBUFFER,r,t.RENDERBUFFER,null)}this._depthStencilBuffer=null;return h}copyToTexture(h,t,r,u,y,z,A){(0>h||0>t||0>y||0>z)&&console.error("Offsets cannot be negative!");(0>=r||0>=u)&&console.error("Copy width and height must be greater than zero!");var C=A.descriptor;A.descriptor.target!==g.TextureType.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!");(null==C?.width||null==C?.height||h+r>this.width||t+u>this.height||y+r>C.width||z+u>C.height)&&
console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");C=this._context;A=C.bindTexture(A,m.Texture.TEXTURE_UNIT_FOR_UPDATES);C.setActiveTexture(m.Texture.TEXTURE_UNIT_FOR_UPDATES);C.bindFramebuffer(this);C.gl.copyTexSubImage2D(g.TextureType.TEXTURE_2D,0,y,z,h,t,r,u);C.bindTexture(A,m.Texture.TEXTURE_UNIT_FOR_UPDATES)}readPixels(h,t,r,u,y,z,A){(0>=r||0>=u)&&console.error("Copy width and height must be greater than zero!");A||console.error("Target memory is not initialized!");
this._context.bindFramebuffer(this);this._context.gl.readPixels(h,t,r,u,y,z,A)}async readPixelsAsync(h,t,r,u,y,z,A){if(this._context.type!==k.ContextType.WEBGL2)n.webglDebugEnabled()&&console.warn("Attempting to read pixels using pixel buffer object without WebGL2"),this.readPixels(h,t,r,u,y,z,A);else{var C=this._context.gl,E=f.BufferObject.createPixelPack(this._context,g.Usage.STREAM_READ,A.byteLength);this._context.bindBuffer(E);this._context.bindFramebuffer(this);C.readPixels(h,t,r,u,y,z,0);this._context.unbindBuffer(g.BufferType.PIXEL_PACK_BUFFER);
await E.getSubDataAsync(A);E.dispose()}}resize(h,t){if(this.width!==h||this.height!==t){var r={width:h,height:t};w(r,this._context.parameters.maxTextureSize);this._colorAttachments.forEach(u=>u.resize(r.width,r.height));this._depthStencilTexture?.resize(r.width,r.height);this._initialized&&(w(r,this._context.parameters.maxRenderbufferSize),this._depthStencilBuffer?.resize(r.width,r.height),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1)}}initializeAndBind(h=
g.FramebufferTarget.FRAMEBUFFER){const t=this._context.gl;if(this._initialized)t.bindFramebuffer(h,this.glName);else{this._glName&&t.deleteFramebuffer(this._glName);var r=t.createFramebuffer();t.bindFramebuffer(h,r);this._colorAttachments.forEach((u,y)=>this._framebufferTexture2D(u.glName,y,v(u),h));if(this._depthStencilBuffer){const u=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);t.framebufferRenderbuffer(h,u,t.RENDERBUFFER,this._depthStencilBuffer.glName)}else this._depthStencilTexture&&
this._framebufferTexture2D(this._depthStencilTexture.glName,t.DEPTH_STENCIL_ATTACHMENT,v(this._depthStencilTexture),h);n.webglDebugEnabled()&&t.checkFramebufferStatus(h)!==t.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!");this._glName=r;this._initialized=!0}}_framebufferTexture2D(h,t=g.ColorAttachment.COLOR_ATTACHMENT0,r=g.TextureType.TEXTURE_2D,u=g.FramebufferTarget.FRAMEBUFFER,y=0){this._context.gl.framebufferTexture2D(u,t,r,h,y)}_disposeDepthStencilAttachments(){const h=this._context.gl;
if(this._depthStencilBuffer){if(this._initialized){this._context.bindFramebuffer(this);const t=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);h.framebufferRenderbuffer(g.FramebufferTarget.FRAMEBUFFER,t,h.RENDERBUFFER,null)}this._depthStencilBuffer=d.disposeMaybe(this._depthStencilBuffer)}this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,h.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture=d.disposeMaybe(this._depthStencilTexture))}_validateTextureDescriptor(h){h.target!==
g.TextureType.TEXTURE_2D&&h.target!==g.TextureType.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!");w(h,this._context.parameters.maxTextureSize);this._validateBufferDimensions(h)}_validateRenderBufferDescriptor(h){w(h,this._context.parameters.maxRenderbufferSize);this._validateBufferDimensions(h)}_validateBufferDimensions(h){0>=h.width&&(h.width=this.width);0>=h.height&&(h.height=this.height);0<this.width&&0<this.height&&(this.width!==h.width||this.height!==
h.height)&&console.error("Attachment size must match framebuffer size!")}_getGLAttachmentPoint(h){switch(h.internalFormat){case g.RenderbufferFormat.DEPTH_COMPONENT16:case g.RenderbufferFormat.DEPTH_COMPONENT24:case g.RenderbufferFormat.DEPTH_COMPONENT32F:return this._context.gl.DEPTH_ATTACHMENT;case g.RenderbufferFormat.DEPTH24_STENCIL8:case g.RenderbufferFormat.DEPTH32F_STENCIL8:case g.RenderbufferFormat.DEPTH_STENCIL:return this._context.gl.DEPTH_STENCIL_ATTACHMENT;case g.RenderbufferFormat.STENCIL_INDEX8:return this._context.gl.STENCIL_ATTACHMENT}}_validateColorAttachmentPoint(h){if(-1===
p._MAX_COLOR_ATTACHMENTS){const t=this._context.capabilities.drawBuffers;p._MAX_COLOR_ATTACHMENTS=t?this._context.gl.getParameter(t.MAX_COLOR_ATTACHMENTS):1}h-=g.ColorAttachment.COLOR_ATTACHMENT0;h+1>p._MAX_COLOR_ATTACHMENTS&&c.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${h+1}. Implementation supports up to ${p._MAX_COLOR_ATTACHMENTS} color attachments`)}}p._MAX_COLOR_ATTACHMENTS=-1;b.FramebufferObject=p;b.ensureAttachmentMaxSize=
w;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/BufferObject":function(){define("exports ../../core/arrayUtils ../../core/Logger ../../core/typedArrayUtil ./checkWebGLError ./contextUtils ./enums".split(" "),function(b,a,c,d,f,n,k){const g=c.getLogger("esri.views.webgl.BufferObject");class q{static createIndex(e,m,l){return new q(e,k.BufferType.ELEMENT_ARRAY_BUFFER,m,l)}static createVertex(e,m,l){return new q(e,k.BufferType.ARRAY_BUFFER,m,l)}static createUniform(e,
m,l){if(e.type!==n.ContextType.WEBGL2)throw Error("Uniform buffers are supported in WebGL2 only!");return new q(e,k.BufferType.UNIFORM_BUFFER,m,l)}static createPixelPack(e,m=k.Usage.STREAM_READ,l){if(e.type!==n.ContextType.WEBGL2)throw Error("Pixel pack buffers are supported in WebGL2 only!");e=new q(e,k.BufferType.PIXEL_PACK_BUFFER,m);l&&e.setSize(l);return e}static createPixelUnpack(e,m=k.Usage.STREAM_DRAW,l){if(e.type!==n.ContextType.WEBGL2)throw Error("Pixel unpack buffers are supported in WebGL2 only!");
return new q(e,k.BufferType.PIXEL_UNPACK_BUFFER,m,l)}constructor(e,m,l,w){this._context=e;this.bufferType=m;this.usage=l;this._glName=null;this._size=-1;this._indexType=void 0;e.instanceCounter.increment(k.ResourceType.BufferObject,this);this._glName=this._context.gl.createBuffer();f.checkWebGLError(this._context.gl);w&&this.setData(w)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get byteLength(){return this.bufferType===k.BufferType.ELEMENT_ARRAY_BUFFER?
this._indexType===k.DataType.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===k.BufferType.ELEMENT_ARRAY_BUFFER||this.bufferType===k.BufferType.ARRAY_BUFFER}dispose(){this._context?.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(k.ResourceType.BufferObject,this),this._context=null):this._glName&&g.warn("Leaked WebGL buffer object")}setSize(e,m=null){0>=e&&g.error("Buffer size needs to be positive!");
if(this.bufferType===k.BufferType.ELEMENT_ARRAY_BUFFER&&null!=m)switch(this._indexType=m,m){case k.DataType.UNSIGNED_SHORT:e*=2;break;case k.DataType.UNSIGNED_INT:e*=4}this._setBufferData(e)}setData(e){if(e){var m=e.byteLength;this.bufferType===k.BufferType.ELEMENT_ARRAY_BUFFER&&(d.isUint16Array(e)&&(m/=2,this._indexType=k.DataType.UNSIGNED_SHORT),d.isUint32Array(e)&&(m/=4,this._indexType=k.DataType.UNSIGNED_INT));this._setBufferData(m,e)}}_setBufferData(e,m=null){this._size=e;const l=this._context.getBoundVAO();
this._isVAOAware&&this._context.bindVAO(null);this._context.bindBuffer(this);const w=this._context.gl;null!=m?w.bufferData(this.bufferType,m,this.usage):w.bufferData(this.bufferType,e,this.usage);f.checkWebGLError(w);this._isVAOAware&&this._context.bindVAO(l)}setSubData(e,m,l,w){if(e){(0>m||m*e.BYTES_PER_ELEMENT>=this.byteLength)&&g.error("offset is out of range!");l>=w&&g.error("end must be bigger than start!");(m+(w-l))*e.BYTES_PER_ELEMENT>this.byteLength&&g.error("An attempt to write beyond the end of the buffer!");
var v=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null);this._context.bindBuffer(this);var x=this._context.gl;this._context.type===n.ContextType.WEBGL2?x.bufferSubData(this.bufferType,m*e.BYTES_PER_ELEMENT,e,l,w-l):(l=0===l&&w===e.length?e:e.subarray(l,w),x.bufferSubData(this.bufferType,m*e.BYTES_PER_ELEMENT,l));f.checkWebGLError(x);this._isVAOAware&&this._context.bindVAO(v)}}getSubData(e,m=0,l,w){if(this._context.type!==n.ContextType.WEBGL2)g.error("Get buffer subdata is supported in WebGL2 only!");
else if(0>l||0>w)g.error("Problem getting subdata: offset and length were less than zero!");else{var v=a.isArrayLike(e)?e.BYTES_PER_ELEMENT:1;v*((l??0)+(w??0))>e.byteLength?g.error("Problem getting subdata: offset and length exceeded destination size!"):(m+v*(w??0)>this.byteLength&&g.warn("Potential problem getting subdata: requested data exceeds buffer size!"),v=this._context.gl,this._context.bindBuffer(this,k.BufferType.COPY_READ_BUFFER),v.getBufferSubData(k.BufferType.COPY_READ_BUFFER,m,e,l,w),
this._context.unbindBuffer(k.BufferType.COPY_READ_BUFFER))}}async getSubDataAsync(e,m=0,l,w){this._context.type!==n.ContextType.WEBGL2?g.error("Get buffer subdata is supported in WebGL2 only!"):(await this._context.clientWaitAsync(),this.getSubData(e,m,l,w))}}b.BufferObject=q;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/contextUtils":function(){define(["exports","../../core/has"],function(b,a){function c(f,n,k={}){return(f=f.getContext(n===b.ContextType.WEBGL1?
"webgl":"webgl2",k))?f:null}function d(f){if("3d"===f)return[b.ContextType.WEBGL2];f=a("esri-force-webgl");return f===b.ContextType.WEBGL1||f===b.ContextType.WEBGL2?[f]:a("mac")&&a("chrome")?[b.ContextType.WEBGL1,b.ContextType.WEBGL2]:[b.ContextType.WEBGL2,b.ContextType.WEBGL1]}b.ContextType=void 0;(function(f){f[f.WEBGL1=1]="WEBGL1";f[f.WEBGL2=2]="WEBGL2"})(b.ContextType||(b.ContextType={}));b.createContext=c;b.createContextForView=function(f,n,k={}){f=d(f);for(const g of f)if(f=c(n,g,k))return f;
return null};b.getContextTypes=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/GLObjectType":function(){define(["exports"],function(b){b.GLObjectType=void 0;var a=b.GLObjectType||(b.GLObjectType={});a[a.Texture=0]="Texture";a[a.RenderBuffer=1]="RenderBuffer";Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Renderbuffer":function(){define(["exports","./contextUtils","./enums","./GLObjectType","./RenderbufferDescriptor"],function(b,
a,c,d,f){class n{constructor(k,g){this._context=k;this._descriptor=g;this.type=d.GLObjectType.RenderBuffer;this._context.instanceCounter.increment(c.ResourceType.Renderbuffer,this);k=this._context.gl;this.glName=k.createRenderbuffer();this._context.bindRenderbuffer(this);const {width:q,height:e,internalFormat:m,multisampled:l}=g;if(l){if(this._context.type!==a.ContextType.WEBGL2)throw Error("Multisampled renderbuffers are not supported in WebGL1!");k.renderbufferStorageMultisample(k.RENDERBUFFER,
this.samples,m,q,e)}else k.renderbufferStorage(k.RENDERBUFFER,m,q,e)}get descriptor(){return this._descriptor}get samples(){const k=this._descriptor.samples,g=this._context.parameters.maxSamples;return k?Math.min(k,g):g}get gpuMemoryUsage(){return f.estimateMemory(this._descriptor)}resize(k,g){const q=this._descriptor;if(q.width!==k||q.height!==g)q.width=k,q.height=g,k=this._context.gl,this._context.bindRenderbuffer(this),q.multisampled?k.renderbufferStorageMultisample(k.RENDERBUFFER,this.samples,
q.internalFormat,q.width,q.height):k.renderbufferStorage(k.RENDERBUFFER,q.internalFormat,q.width,q.height)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(c.ResourceType.Renderbuffer,this),this._context=null)}}b.Renderbuffer=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/RenderbufferDescriptor":function(){define(["exports","./Util"],function(b,a){class c{constructor(d,f,n=f){this.internalFormat=
d;this.width=f;this.height=n;this.multisampled=!1;this.samples=1}}b.RenderbufferDescriptor=c;b.estimateMemory=function(d){return 0>=d.width||0>=d.height||null==d.internalFormat?0:d.width*d.height*a.getBytesPerElementFormat(d.internalFormat)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Util":function(){define(["exports","../../core/has","./enums"],function(b,a,c){function d(f){return f[0].stride}b.bindVertexBufferLayout=function(f,n,k,g,q=0){const e=f.gl;f.bindBuffer(k);
for(const l of g)if(k=n.get(l.name),void 0===k&&console.error(`There is no location for vertex attribute '${l.name}' defined.`),g=q*l.stride,4>=l.count)e.vertexAttribPointer(k,l.count,l.type,l.normalized,l.stride,l.offset+g),e.enableVertexAttribArray(k),0<l.divisor&&f.gl2?.vertexAttribDivisor(k,l.divisor);else if(9===l.count)for(var m=0;3>m;m++)e.vertexAttribPointer(k+m,3,l.type,l.normalized,l.stride,l.offset+12*m+g),e.enableVertexAttribArray(k+m),0<l.divisor&&f.gl2?.vertexAttribDivisor(k+m,l.divisor);
else if(16===l.count)for(m=0;4>m;m++)e.vertexAttribPointer(k+m,4,l.type,l.normalized,l.stride,l.offset+16*m+g),e.enableVertexAttribArray(k+m),0<l.divisor&&f.gl2?.vertexAttribDivisor(k+m,l.divisor);else console.error("Unsupported vertex attribute element count: "+l.count)};b.getBytesPerElementFormat=function(f){switch(f){case c.PixelFormat.ALPHA:case c.PixelFormat.LUMINANCE:case c.PixelFormat.RED:case c.PixelFormat.RED_INTEGER:case c.SizedPixelFormat.R8:case c.SizedPixelFormat.R8I:case c.SizedPixelFormat.R8UI:case c.SizedPixelFormat.R8_SNORM:case c.RenderbufferFormat.STENCIL_INDEX8:return 1;
case c.PixelFormat.LUMINANCE_ALPHA:case c.PixelFormat.RG:case c.PixelFormat.RG_INTEGER:case c.SizedPixelFormat.RGBA4:case c.SizedPixelFormat.R16F:case c.SizedPixelFormat.R16I:case c.SizedPixelFormat.R16UI:case c.SizedPixelFormat.RG8:case c.SizedPixelFormat.RG8I:case c.SizedPixelFormat.RG8UI:case c.SizedPixelFormat.RG8_SNORM:case c.SizedPixelFormat.RGB565:case c.SizedPixelFormat.RGB5_A1:case c.RenderbufferFormat.DEPTH_COMPONENT16:return 2;case c.PixelFormat.DEPTH_COMPONENT:case c.PixelFormat.RGB:case c.PixelFormat.RGB_INTEGER:case c.SizedPixelFormat.RGB8:case c.SizedPixelFormat.RGB8I:case c.SizedPixelFormat.RGB8UI:case c.SizedPixelFormat.RGB8_SNORM:case c.SizedPixelFormat.SRGB8:case c.RenderbufferFormat.DEPTH_COMPONENT24:return 3;
case c.PixelFormat.DEPTH_STENCIL:case c.PixelFormat.DEPTH24_STENCIL8:case c.PixelFormat.RGBA:case c.PixelFormat.RGBA_INTEGER:case c.SizedPixelFormat.RGBA8:case c.SizedPixelFormat.R32F:case c.SizedPixelFormat.R11F_G11F_B10F:case c.SizedPixelFormat.RG16F:case c.SizedPixelFormat.R32I:case c.SizedPixelFormat.R32UI:case c.SizedPixelFormat.RG16I:case c.SizedPixelFormat.RG16UI:case c.SizedPixelFormat.RGBA8I:case c.SizedPixelFormat.RGBA8UI:case c.SizedPixelFormat.RGBA8_SNORM:case c.SizedPixelFormat.SRGB8_ALPHA8:case c.SizedPixelFormat.RGB9_E5:case c.SizedPixelFormat.RGB10_A2UI:case c.SizedPixelFormat.RGB10_A2:case c.RenderbufferFormat.DEPTH_STENCIL:case c.RenderbufferFormat.DEPTH_COMPONENT32F:case c.RenderbufferFormat.DEPTH24_STENCIL8:return 4;
case c.RenderbufferFormat.DEPTH32F_STENCIL8:return 5;case c.SizedPixelFormat.RGB16F:case c.SizedPixelFormat.RGB16I:case c.SizedPixelFormat.RGB16UI:return 6;case c.SizedPixelFormat.RG32F:case c.SizedPixelFormat.RG32I:case c.SizedPixelFormat.RG32UI:case c.SizedPixelFormat.RGBA16F:case c.SizedPixelFormat.RGBA16I:case c.SizedPixelFormat.RGBA16UI:return 8;case c.SizedPixelFormat.RGB32F:case c.SizedPixelFormat.RGB32I:case c.SizedPixelFormat.RGB32UI:return 12;case c.SizedPixelFormat.RGBA32F:case c.SizedPixelFormat.RGBA32I:case c.SizedPixelFormat.RGBA32UI:return 16;
case c.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT:case c.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT1_EXT:return.5;case c.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT3_EXT:case c.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case c.CompressedTextureFormat.COMPRESSED_R11_EAC:case c.CompressedTextureFormat.COMPRESSED_SIGNED_R11_EAC:case c.CompressedTextureFormat.COMPRESSED_RGB8_ETC2:case c.CompressedTextureFormat.COMPRESSED_SRGB8_ETC2:case c.CompressedTextureFormat.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case c.CompressedTextureFormat.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return.5;
case c.CompressedTextureFormat.COMPRESSED_RG11_EAC:case c.CompressedTextureFormat.COMPRESSED_SIGNED_RG11_EAC:case c.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC:case c.CompressedTextureFormat.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0};b.getErrorString=function(f){f=f.gl;switch(f.getError()){case f.NO_ERROR:return null;case f.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case f.INVALID_VALUE:return"An unacceptable value has been specified for an argument";
case f.INVALID_OPERATION:return"The specified command is not allowed for the current state";case f.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case f.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case f.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"};b.getStride=d;b.unbindVertexBufferLayout=function(f,n,k,g){const q=f.gl;f.bindBuffer(k);for(const e of g)if(k=n.get(e.name),4>=e.count)q.disableVertexAttribArray(k),
e.divisor&&0<e.divisor&&f.gl2?.vertexAttribDivisor(k,0);else if(9===e.count)for(g=0;3>g;g++)q.disableVertexAttribArray(k+g),e.divisor&&0<e.divisor&&f.gl2?.vertexAttribDivisor(k+g,0);else if(16===e.count)for(g=0;4>g;g++)q.disableVertexAttribArray(k+g),e.divisor&&0<e.divisor&&f.gl2?.vertexAttribDivisor(k+g,0);else console.error("Unsupported vertex attribute element count: "+e.count);f.unbindBuffer(c.BufferType.ARRAY_BUFFER)};b.vertexCount=function(f,n){return f.vertexBuffers[n].byteLength/d(f.layout[n])};
Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Texture":function(){define("exports ../../core/Error ../../core/has ../../core/mathUtils ./checkWebGLError ./contextUtils ./enums ./GLObjectType ./TextureDescriptor ./ValidatedTextureDescriptor".split(" "),function(b,a,c,d,f,n,k,g,q,e){function m(y,z){(null!=z.width&&0>z.width||null!=z.height&&0>z.height||null!=z.depth&&0>z.depth)&&console.error("Negative dimension parameters are not allowed!");(y=y.type===n.ContextType.WEBGL2)||
!z.isImmutable&&!h(z.target)||console.error("Immutable and 3D-like textures are not supported in WebGL1!");y||null!=z.width&&d.isPowerOfTwo(z.width)&&null!=z.height&&d.isPowerOfTwo(z.height)||("number"===typeof z.wrapMode?z.wrapMode!==k.TextureWrapMode.CLAMP_TO_EDGE&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):(z.wrapMode.s!==k.TextureWrapMode.CLAMP_TO_EDGE||z.wrapMode.t!==k.TextureWrapMode.CLAMP_TO_EDGE)&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),
z.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))}function l(y,z){let A=z.samplingMode,C=z.samplingMode;if(A===k.TextureSamplingMode.LINEAR_MIPMAP_NEAREST||A===k.TextureSamplingMode.LINEAR_MIPMAP_LINEAR)A=k.TextureSamplingMode.LINEAR,z.hasMipmap||(C=k.TextureSamplingMode.LINEAR);else if(A===k.TextureSamplingMode.NEAREST_MIPMAP_NEAREST||A===k.TextureSamplingMode.NEAREST_MIPMAP_LINEAR)A=k.TextureSamplingMode.NEAREST,z.hasMipmap||(C=k.TextureSamplingMode.NEAREST);y.texParameteri(z.target,
y.TEXTURE_MAG_FILTER,A);y.texParameteri(z.target,y.TEXTURE_MIN_FILTER,C)}function w(y,z){"number"===typeof z.wrapMode?(y.texParameteri(z.target,y.TEXTURE_WRAP_S,z.wrapMode),y.texParameteri(z.target,y.TEXTURE_WRAP_T,z.wrapMode)):(y.texParameteri(z.target,y.TEXTURE_WRAP_S,z.wrapMode.s),y.texParameteri(z.target,y.TEXTURE_WRAP_T,z.wrapMode.t))}function v(y,z){const A=y.capabilities.textureFilterAnisotropic;A&&y.gl.texParameterf(z.target,A.TEXTURE_MAX_ANISOTROPY,z.maxAnisotropy??1)}function x(y){return null!=
y&&"type"in y&&"compressed"===y.type}function p(y){return null!=y&&!x(y)&&!(null!=y&&"byteLength"in y)}function h(y){return y===k.TextureType.TEXTURE_3D||y===k.TextureType.TEXTURE_2D_ARRAY}function t(y,z,A,C=1){z=Math.max(z,A);y===k.TextureType.TEXTURE_3D&&(z=Math.max(z,C));return Math.round(Math.log(z)/Math.LN2)+1}let r=class{constructor(y,z=null,A=null){this.type=g.GLObjectType.Texture;this._glName=null;this._wasImmutablyAllocated=this._wrapModeDirty=this._samplingModeDirty=!1;if("context"in y)this._descriptor=
y,A=z;else{y=e.ValidatedTextureDescriptor.validate(y,z);if(!y)throw new a("Texture descriptor invalid");this._descriptor=y}if(this._descriptor.context.type!==n.ContextType.WEBGL2&&(this._descriptor.isImmutable&&(this._descriptor.isImmutable=!1),h(this._descriptor.target)))throw new a("3D and array textures are not supported in WebGL1");this._descriptor.target===k.TextureType.TEXTURE_CUBE_MAP?this._setDataCubeMap(A):this.setData(A)}get glName(){return this._glName}get descriptor(){return this._descriptor}get gpuMemoryUsage(){u.delete(this);
return q.estimateMemory(this._descriptor)}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._glName&&this._descriptor.context.instanceCounter.decrement(k.ResourceType.Texture,this);this._descriptor.context.gl&&this._glName&&(this._descriptor.context.unbindTexture(this),this._descriptor.context.gl.deleteTexture(this._glName),this._glName=null)}release(){this.dispose()}resize(y,z){const A=this._descriptor;if(A.width!==y||A.height!==z){if(this._wasImmutablyAllocated)throw new a("Immutable textures can't be resized!");
A.width=y;A.height=z;this._descriptor.target===k.TextureType.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(y=null){for(let z=k.TextureType.TEXTURE_CUBE_MAP_POSITIVE_X;z<=k.TextureType.TEXTURE_CUBE_MAP_NEGATIVE_Z;z++)this._setData(y,z)}setData(y){this._setData(y)}_setData(y,z){if(this._descriptor.context?.gl){var A=this._descriptor.context.gl;f.checkWebGLError(A);this._glName||(this._glName=A.createTexture())&&this._descriptor.context.instanceCounter.increment(k.ResourceType.Texture,
this);void 0===y&&(y=null);var C=this._descriptor,E=z??C.target,B=h(E);null===y&&(C.width=C.width||4,C.height=C.height||4,B&&(C.depth=C.depth??1));z=this._descriptor.context.bindTexture(this,r.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(r.TEXTURE_UNIT_FOR_UPDATES);m(this._descriptor.context,C);this._configurePixelStorage();f.checkWebGLError(A);var D=this._deriveInternalFormat();if(p(y)){let F="width"in y?y.width:y.codedWidth,K="height"in y?y.height:y.codedHeight;y instanceof
HTMLVideoElement&&(F=y.videoWidth,K=y.videoHeight);C.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(E,D,C.hasMipmap,F,K,1);this._texImage(E,0,D,F,K,1,y);f.checkWebGLError(A);C.hasMipmap&&this.generateMipmap();C.width||(C.width=F);C.height||(C.height=K);B&&!C.depth&&(C.depth=1)}else{const {width:F,height:K,depth:L}=C;if(null==F||null==K)throw new a("Width and height must be specified!");if(B&&null==L)throw new a("Depth must be specified!");C.isImmutable&&!this._wasImmutablyAllocated&&
this._texStorage(E,D,C.hasMipmap,F,K,L);if(x(y)){const G=y.levels;y=t(E,F,K,L);B=Math.min(y-1,G.length-1);null!=this._descriptor.context.gl2?A.texParameteri(C.target,this._descriptor.context.gl2.TEXTURE_MAX_LEVEL,B):C.hasMipmap=C.hasMipmap&&y===G.length;if(!(D in k.CompressedTextureFormat))throw new a("Attempting to use compressed data with an uncompressed format!");this._forEachMipmapLevel((O,P,J,R)=>{this._compressedTexImage(E,O,D,P,J,R,G[Math.min(O,G.length-1)])},B)}else this._texImage(E,0,D,F,
K,L,y),f.checkWebGLError(A),C.hasMipmap&&this.generateMipmap()}l(A,this._descriptor);w(A,this._descriptor);v(this._descriptor.context,this._descriptor);f.checkWebGLError(A);this._descriptor.context.bindTexture(z,r.TEXTURE_UNIT_FOR_UPDATES)}}updateData(y,z,A,C,E,B,D=0){B||console.error("An attempt to use uninitialized data!");this._glName||console.error("An attempt to update uninitialized texture!");const F=this._descriptor.context.gl,K=this._descriptor.context.gl2,L=this._descriptor,G=this._deriveInternalFormat(),
{pixelFormat:O,dataType:P,target:J,isImmutable:R}=L;if(R&&!this._wasImmutablyAllocated)throw new a("Cannot update immutable texture before allocation!");const X=this._descriptor.context.bindTexture(this,r.TEXTURE_UNIT_FOR_UPDATES,!0);(0>z||0>A||C>L.width||E>L.height||z+C>L.width||A+E>L.height)&&console.error("An attempt to update out of bounds of the texture!");this._configurePixelStorage();if(D){if(!K){console.error("Webgl2 must be enabled to use dataRowOffset!");return}F.pixelStorei(K.UNPACK_SKIP_ROWS,
D)}p(B)?K?K.texSubImage2D(J,y,z,A,C,E,O,P,B):F.texSubImage2D(J,y,z,A,O,P,B):x(B)?F.compressedTexSubImage2D(J,y,z,A,C,E,G,B.levels[y]):F.texSubImage2D(J,y,z,A,C,E,O,P,B);if(D){if(!K){console.error("Webgl2 must be enabled to use dataRowOffset!");return}F.pixelStorei(K.UNPACK_SKIP_ROWS,0)}this._descriptor.context.bindTexture(X,r.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(y,z,A,C,E,B,D,F){F||console.error("An attempt to use uninitialized data!");this._glName||console.error("An attempt to update uninitialized texture!");
const K=this._descriptor.context.gl2;if(null==K)throw new a("3D textures are not supported in WebGL1");const L=this._descriptor,G=this._deriveInternalFormat(),{pixelFormat:O,dataType:P,isImmutable:J,target:R}=L;if(J&&!this._wasImmutablyAllocated)throw new a("Cannot update immutable texture before allocation!");h(R)||console.warn("Attempting to set 3D texture data on a non-3D texture");const X=this._descriptor.context.bindTexture(this,r.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(r.TEXTURE_UNIT_FOR_UPDATES);
(0>z||0>A||0>C||E>L.width||B>L.height||D>L.depth||z+E>L.width||A+B>L.height||C+D>L.depth)&&console.error("An attempt to update out of bounds of the texture!");this._configurePixelStorage();x(F)?(F=F.levels[y],K.compressedTexSubImage3D(R,y,z,A,C,E,B,D,G,F)):K.texSubImage3D(R,y,z,A,C,E,B,D,O,P,F);this._descriptor.context.bindTexture(X,r.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const y=this._descriptor;if(!y.hasMipmap){if(this._wasImmutablyAllocated)throw new a("Cannot add mipmaps to immutable texture after allocation");
this._samplingModeDirty=y.hasMipmap=!0;m(this._descriptor.context,y)}y.samplingMode===k.TextureSamplingMode.LINEAR?(this._samplingModeDirty=!0,y.samplingMode=k.TextureSamplingMode.LINEAR_MIPMAP_NEAREST):y.samplingMode===k.TextureSamplingMode.NEAREST&&(this._samplingModeDirty=!0,y.samplingMode=k.TextureSamplingMode.NEAREST_MIPMAP_NEAREST);const z=this._descriptor.context.bindTexture(this,r.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(r.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.gl.generateMipmap(y.target);
this._descriptor.context.bindTexture(z,r.TEXTURE_UNIT_FOR_UPDATES)}setSamplingMode(y){y!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=y,this._samplingModeDirty=!0)}setWrapMode(y){y!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=y,m(this._descriptor.context,this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const y=this._descriptor.context.gl,z=this._descriptor;this._samplingModeDirty&&(l(y,z),this._samplingModeDirty=!1);this._wrapModeDirty&&(w(y,z),this._wrapModeDirty=
!1)}_deriveInternalFormat(){if(this._descriptor.context.type===n.ContextType.WEBGL1)return this._descriptor.internalFormat=this._descriptor.pixelFormat;if(null!=this._descriptor.internalFormat)return this._descriptor.internalFormat===k.PixelFormat.DEPTH_STENCIL&&(this._descriptor.internalFormat=k.PixelFormat.DEPTH24_STENCIL8),this._descriptor.internalFormat;switch(this._descriptor.dataType){case k.PixelType.FLOAT:switch(this._descriptor.pixelFormat){case k.PixelFormat.RGBA:return this._descriptor.internalFormat=
k.SizedPixelFormat.RGBA32F;case k.PixelFormat.RGB:return this._descriptor.internalFormat=k.SizedPixelFormat.RGB32F;default:throw new a("Unable to derive format");}case k.PixelType.UNSIGNED_BYTE:switch(this._descriptor.pixelFormat){case k.PixelFormat.RGBA:return this._descriptor.internalFormat=k.SizedPixelFormat.RGBA8;case k.PixelFormat.RGB:return this._descriptor.internalFormat=k.SizedPixelFormat.RGB8}}return this._descriptor.internalFormat=this._descriptor.pixelFormat===k.PixelFormat.DEPTH_STENCIL?
k.PixelFormat.DEPTH24_STENCIL8:this._descriptor.pixelFormat}_configurePixelStorage(){const y=this._descriptor.context.gl,{unpackAlignment:z,flipped:A,preMultiplyAlpha:C}=this._descriptor;y.pixelStorei(y.UNPACK_ALIGNMENT,z);y.pixelStorei(y.UNPACK_FLIP_Y_WEBGL,A?1:0);y.pixelStorei(y.UNPACK_PREMULTIPLY_ALPHA_WEBGL,C?1:0)}_texStorage(y,z,A,C,E,B){const D=this._descriptor.context.gl2;if(null==D)throw new a("Immutable textures are not supported in WebGL1");if(!(z in k.SizedPixelFormat))throw new a("Immutable textures must have a sized internal format");
if(this._descriptor.isImmutable){A=A?t(y,C,E,B):1;if(h(y)){if(null==B)throw new a("Missing depth dimension for 3D texture upload");D.texStorage3D(y,A,z,C,E,B)}else D.texStorage2D(y,A,z,C,E);this._wasImmutablyAllocated=!0}}_texImage(y,z,A,C,E,B,D){const F=this._descriptor.context.gl,K=h(y),{isImmutable:L,pixelFormat:G,dataType:O}=this._descriptor,P=this._descriptor.context.type===n.ContextType.WEBGL2,J=P?F:null;if(!P&&p(D))F.texImage2D(y,0,A,G,O,D);else if(L){if(null!=D)if(K){if(null==B)throw new a("Missing depth dimension for 3D texture upload");
J.texSubImage3D(y,z,0,0,0,C,E,B,G,O,D)}else F.texSubImage2D(y,z,0,0,C,E,G,O,D)}else if(K){if(null==B)throw new a("Missing depth dimension for 3D texture upload");J.texImage3D(y,z,A,C,E,B,0,G,O,D)}else F.texImage2D(y,z,A,C,E,0,G,O,D)}_compressedTexImage(y,z,A,C,E,B,D){const F=this._descriptor.context.gl;let K=null;const L=h(y),G=this._descriptor.isImmutable;if(L){if(this._descriptor.context.type!==n.ContextType.WEBGL2)throw new a("3D textures are not supported in WebGL1");K=F}if(G){if(null!=D)if(L){if(null==
B)throw new a("Missing depth dimension for 3D texture upload");K.compressedTexSubImage3D(y,z,0,0,0,C,E,B,A,D)}else F.compressedTexSubImage2D(y,z,0,0,C,E,A,D)}else if(L){if(null==B)throw new a("Missing depth dimension for 3D texture upload");K.compressedTexImage3D(y,z,A,C,E,B,0,D)}else F.compressedTexImage2D(y,z,A,C,E,0,D)}_forEachMipmapLevel(y,z=Infinity){let {width:A,height:C,depth:E,hasMipmap:B,target:D}=this._descriptor;const F=D===k.TextureType.TEXTURE_3D;if(null==A||null==C||F&&null==E)throw new a("Missing texture dimensions for mipmap calculation");
for(let K=0;;++K){y(K,A,C,E);if(!B||1===A&&1===C&&(!F||1===E)||K>=z)break;A=Math.max(1,A>>1);C=Math.max(1,C>>1);F&&(E=Math.max(1,E>>1))}}};r.TEXTURE_UNIT_FOR_UPDATES=0;const u=new Map;b.Texture=r;b.clearUnestimatedTextures=function(){if(0!==u.size){var y=[];u.forEach((z,A)=>y.push([A.gpuMemoryUsage,z]));u.clear();y.sort((z,A)=>A[0]-z[0]);return y.reduce((z,A)=>`${z}\n\n${Math.round(A[0]/1024)}KB: ${A[1]}`,`Total unestimated texture memory: ${Math.round(y.reduce((z,A)=>z+A[0],0)/1024)}KB`)}};Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/TextureDescriptor":function(){define(["exports","./enums","./Util"],function(b,a,c){class d{constructor(f=0,n=f){this.width=f;this.height=n;this.target=a.TextureType.TEXTURE_2D;this.pixelFormat=a.PixelFormat.RGBA;this.dataType=a.PixelType.UNSIGNED_BYTE;this.samplingMode=a.TextureSamplingMode.LINEAR;this.wrapMode=a.TextureWrapMode.REPEAT;this.maxAnisotropy=1;this.isOpaque=this.hasMipmap=this.flipped=!1;this.unpackAlignment=4;this.preMultiplyAlpha=
!1;this.depth=1;this.isImmutable=!1}}b.TextureDescriptor=d;b.estimateMemory=function(f){return 0>=f.width||0>=f.height?0:f.width*f.height*(f.hasMipmap?4/3:1)*(null==f.internalFormat?4:c.getBytesPerElementFormat(f.internalFormat))};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/ValidatedTextureDescriptor":function(){define(["exports","./enums","./TextureDescriptor"],function(b,a,c){class d extends c.TextureDescriptor{constructor(f,n){super();this.context=f;Object.assign(this,
n);switch(this.internalFormat){case a.SizedPixelFormat.R16F:case a.SizedPixelFormat.R16I:case a.SizedPixelFormat.R16UI:case a.SizedPixelFormat.R32F:case a.SizedPixelFormat.R32I:case a.SizedPixelFormat.R32UI:case a.SizedPixelFormat.R8_SNORM:case a.SizedPixelFormat.R8:case a.SizedPixelFormat.R8I:case a.SizedPixelFormat.R8UI:this.pixelFormat=a.PixelFormat.RED}}static validate(f,n){return new d(f,n)}}b.ValidatedTextureDescriptor=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/DefaultVertexBufferLayouts":function(){define(["exports",
"./VertexAttribute","../../../webgl/enums","../../../webgl/VertexElementDescriptor"],function(b,a,c,d){const f=[new d.VertexElementDescriptor(a.VertexAttribute.POSITION,3,c.DataType.FLOAT,0,12)],n=[new d.VertexElementDescriptor(a.VertexAttribute.POSITION,3,c.DataType.FLOAT,0,20),new d.VertexElementDescriptor(a.VertexAttribute.UV0,2,c.DataType.FLOAT,12,20)],k=[new d.VertexElementDescriptor(a.VertexAttribute.POSITION,3,c.DataType.FLOAT,0,32),new d.VertexElementDescriptor(a.VertexAttribute.NORMAL,3,
c.DataType.FLOAT,12,32),new d.VertexElementDescriptor(a.VertexAttribute.UV0,2,c.DataType.FLOAT,24,32)],g=[new d.VertexElementDescriptor(a.VertexAttribute.POSITION,3,c.DataType.FLOAT,0,16),new d.VertexElementDescriptor(a.VertexAttribute.COLOR,4,c.DataType.UNSIGNED_BYTE,12,16)],q=[new d.VertexElementDescriptor(a.VertexAttribute.POSITION,2,c.DataType.FLOAT,0,8)];a=[new d.VertexElementDescriptor(a.VertexAttribute.POSITION,2,c.DataType.FLOAT,0,16),new d.VertexElementDescriptor(a.VertexAttribute.UV0,2,
c.DataType.FLOAT,8,16)];b.Pos2=q;b.Pos2Tex=a;b.Pos3=f;b.Pos3Col=g;b.Pos3NormalTex=k;b.Pos3Tex=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/VertexElementDescriptor":function(){define(["exports"],function(b){class a{constructor(c,d,f,n,k,g=!1,q=0){this.name=c;this.count=d;this.type=f;this.offset=n;this.stride=k;this.normalized=g;this.divisor=q}}b.VertexElementDescriptor=a;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/glUtil3D":function(){define("exports ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ./VertexArrayObject ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),
function(b,a,c,d,f,n,k,g){b.createEmptyDepthTexture=function(q){const e=new g.TextureDescriptor(1);e.samplingMode=n.TextureSamplingMode.NEAREST;return new k.Texture(q,e,new Uint8Array([255,255,255,255]))};b.createEmptyTexture=function(q){const e=new g.TextureDescriptor(4);e.samplingMode=n.TextureSamplingMode.NEAREST;return new k.Texture(q,e)};b.createQuadVAO=function(q,e=c.Pos2,m=a.Default3D,l=-1,w=1){let v=null;switch(e){case c.Pos2Tex:v=new Float32Array([l,l,0,0,w,l,1,0,l,w,0,1,w,w,1,1]);break;
default:v=new Float32Array([l,l,w,l,l,w,w,w])}return new d.VertexArrayObject(q,m,{geometry:e},{geometry:f.BufferObject.createVertex(q,n.Usage.STATIC_DRAW,v)})};b.createScreenSizeTriangleVAO=function(q,e=c.Pos2,m=a.Default3D){const l=new Float32Array([-1,-1,3,-1,-1,3]);return new d.VertexArrayObject(q,m,{geometry:e},{geometry:f.BufferObject.createVertex(q,n.Usage.STATIC_DRAW,l)})};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/VertexArrayObject":function(){define(["exports",
"../../../webgl/VertexArrayObject"],function(b,a){class c extends a.VertexArrayObject{}b.VertexArrayObject=c;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/VertexArrayObject":function(){define("exports ../../core/Logger ../../core/maybe ../../core/typedArrayUtil ./enums ./Util".split(" "),function(b,a,c,d,f,n){const k=a.getLogger("esri.views.webgl.VertexArrayObject");b.VertexArrayObject=class{constructor(g,q,e,m,l=null){this._context=g;this._locations=q;this._layout=
e;this._buffers=m;this._indexBuffer=l;this._glName=null;this._initialized=!1}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get byteSize(){return Object.keys(this._buffers).reduce((g,q)=>g+this._buffers[q].byteLength,null!=this._indexBuffer?this._indexBuffer.byteLength:0)}get layout(){return this._layout}get locations(){return this._locations}get usedMemory(){return this.byteSize+(Object.keys(this._buffers).length+
(this._indexBuffer?1:0))*d.typedArrayStaticSize}dispose(){if(this._context){this._context.getBoundVAO()===this&&this._context.bindVAO(null);for(const g in this._buffers)this._buffers[g]?.dispose(),delete this._buffers[g];this._indexBuffer=c.disposeMaybe(this._indexBuffer);this.disposeVAOOnly()}else(this._glName||0<Object.getOwnPropertyNames(this._buffers).length)&&k.warn("Leaked WebGL VAO")}disposeVAOOnly(){this._glName&&((this._context?.capabilities?.vao).deleteVertexArray(this._glName),this._glName=
null,this._context.instanceCounter.decrement(f.ResourceType.VertexArrayObject,this));this._context=null}initialize(){if(!this._initialized){var g=this._context.capabilities.vao;if(g){const q=g.createVertexArray();g.bindVertexArray(q);this._bindLayout();g.bindVertexArray(null);this._glName=q;this._context.instanceCounter.increment(f.ResourceType.VertexArrayObject,this)}this._initialized=!0}}bind(){this.initialize();const g=this._context.capabilities.vao;g?g.bindVertexArray(this.glName):(this._context.bindVAO(null),
this._bindLayout())}_bindLayout(){const {_buffers:g,_layout:q,_indexBuffer:e}=this;g||k.error("Vertex buffer dictionary is empty!");const m=this._context.gl;for(const l in g){const w=g[l];w||k.error("Vertex buffer is uninitialized!");const v=q[l];v||k.error("Vertex element descriptor is empty!");n.bindVertexBufferLayout(this._context,this._locations,w,v)}null!=e&&(this._context.capabilities.vao?m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,e.glName):this._context.bindBuffer(e))}unbind(){this.initialize();const g=
this._context.capabilities.vao;g?g.bindVertexArray(null):this._unbindLayout()}_unbindLayout(){const {_buffers:g,_layout:q}=this;g||k.error("Vertex buffer dictionary is empty!");for(const e in g){const m=g[e];m||k.error("Vertex buffer is uninitialized!");n.unbindVertexBufferLayout(this._context,this._locations,m,q[e])}null!=this._indexBuffer&&this._context.unbindBuffer(this._indexBuffer.bufferType)}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/textureUtils":function(){define(["exports",
"../../../../core/Error"],function(b,a){function c(f,n,k){if(f instanceof ImageData)return c(d(f),n,k);const g=document.createElement("canvas");g.width=n;g.height=k;g.getContext("2d").drawImage(f,0,0,g.width,g.height);return g}function d(f){const n=document.createElement("canvas");n.width=f.width;n.height=f.height;const k=n.getContext("2d");if(null==k)throw new a("Failed to create 2d context from HTMLCanvasElement");k.putImageData(f,0,0);return n}b.applyTextureResizeModulo=function(f){return 16*Math.ceil(f/
16)};b.downsampleImage=function(f,n){let k=f.width*f.height;if(4096>k)return f instanceof ImageData?d(f):f;let g=f.width,q=f.height;do g=Math.ceil(g/2),q=Math.ceil(q/2),k=g*q;while(1048576<k||null!=n&&(g>n||q>n));return c(f,g,q)};b.ensureImageMaxSize=function(f,n){const k=Math.max(f.width,f.height);if(k<=n)return f;n/=k;return c(f,Math.round(f.width*n),Math.round(f.height*n))};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/AtmosphereCompositing.glsl":function(){define(["exports",
"../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder","../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform"],function(b,a,c,d,f){function n(q){const e=new d.ShaderBuilder;e.include(a.ScreenSpacePass);e.fragment.uniforms.add(new f.Texture2DPassUniform("colorTexture",m=>m.color),new f.Texture2DPassUniform("depthTexture",m=>m.depth));q=q.haze;e.fragment.code.add(c.glsl`
    void main() {
      ${q?c.glsl`vec4`:c.glsl`float`} depthSample = texture(depthTexture, uv) ${q?"":c.glsl`.r`};
      if (depthSample ${q?c.glsl`== vec4(0)`:c.glsl`!= 1.0`} ) {
          fragColor = vec4(0);
          return;
      }
      fragColor = texture(colorTexture, uv);
    }
    `);return e}class k extends c.NoParameters{}const g=Object.freeze(Object.defineProperty({__proto__:null,AtmosphereCompositingPassParameters:k,build:n},Symbol.toStringTag,{value:"Module"}));b.AtmosphereCompositing=g;b.AtmosphereCompositingPassParameters=k;b.build=n})},"esri/views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl":function(){define(["exports","../shaderModules/interfaces","../../lib/VertexAttribute"],function(b,a,c){b.ScreenSpacePass=function(d,f=!0){d.attributes.add(c.VertexAttribute.POSITION,
"vec2");f&&d.varyings.add("uv","vec2");d.vertex.code.add(a.glsl`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${f?a.glsl`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/AtmosphereCompositingTechnique":function(){define("require exports ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/AtmosphereCompositing.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),function(b,a,c,d,f,n,k,g,q){class e extends d.ShaderTechnique{initializeProgram(m){return new n.Program(m.rctx,
e.shader.get().build(this.configuration),f.Default3D)}initializePipeline(){return this.configuration.haze?q.makePipelineState({blending:q.separateBlendingParams(g.BlendFactor.ONE,g.BlendFactor.ZERO,g.BlendFactor.ONE_MINUS_SRC_COLOR,g.BlendFactor.ONE),depthTest:{func:g.CompareFunction.ALWAYS},colorWrite:q.defaultColorWriteParams}):q.makePipelineState({blending:q.simpleBlendingParams(g.BlendFactor.SRC_ALPHA,g.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:g.CompareFunction.ALWAYS},colorWrite:q.defaultColorWriteParams})}}
e.shader=new c.ReloadableShaderModule(k.AtmosphereCompositing,()=>new Promise((m,l)=>b(["./AtmosphereCompositing.glsl"],m,l)));a.AtmosphereCompositingTechnique=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudsComposition":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./CloudsCompositionTechnique ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/lib/glUtil3D ../../webgl/enums".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w){b.CloudsComposition=class extends c{constructor(x){super(x);this._technique=new e.CloudsCompositionTechnique(x);this._vao=l.createQuadVAO(x.rctx)}destroy(){this._technique=d.releaseMaybe(this._technique);this._vao=d.disposeMaybe(this._vao)}render(x){if(this._technique.compiled){var p=x.bindParameters.cloudsFade;null!=this._vao&&null!=p.data&&(p=x.rctx.bindTechnique(this._technique,v,x.bindParameters),x.rctx.bindVAO(this._vao),p.assertCompatibleVertexAttributeLocations(this._vao),
x.rctx.drawArrays(w.PrimitiveType.TRIANGLE_STRIP,0,4))}else this.requestRender()}};a.__decorate([f.property({constructOnly:!0})],b.CloudsComposition.prototype,"rctx",void 0);a.__decorate([f.property({constructOnly:!0})],b.CloudsComposition.prototype,"viewingMode",void 0);a.__decorate([f.property({constructOnly:!0})],b.CloudsComposition.prototype,"planetRadius",void 0);a.__decorate([f.property({constructOnly:!0})],b.CloudsComposition.prototype,"requestRender",void 0);b.CloudsComposition=a.__decorate([q.subclass("esri.views.3d.environment.CloudsComposition")],
b.CloudsComposition);const v=new m.NoParameters;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudsCompositionTechnique":function(){define("require exports ../../../chunks/CloudsComposition.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(b,a,c,d,f,n,k,g,q,e){class m extends f.ShaderTechnique{constructor(l){super(l,new n.ShaderTechniqueConfiguration,()=>this.destroy())}initializeProgram(l){return new g.Program(l.rctx,m.shader.get().build(),k.Default3D)}initializePipeline(){return e.makePipelineState({blending:e.separateBlendingParams(q.BlendFactor.ONE,q.BlendFactor.ZERO,q.BlendFactor.SRC_ALPHA,q.BlendFactor.ONE),depthTest:{func:q.CompareFunction.LEQUAL},colorWrite:e.defaultColorWriteParams})}}m.shader=new d.ReloadableShaderModule(c.CloudsCompositionShader,
()=>new Promise((l,w)=>b(["./CloudsComposition.glsl"],l,w)));a.CloudsCompositionTechnique=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/CloudsComposition.glsl":function(){define("exports ./mat4 ./mat4f64 ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CloudsParallaxShading.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p){function h(){const r=new x.ShaderBuilder,{attributes:u,varyings:y,vertex:z,fragment:A}=r;u.add(p.VertexAttribute.POSITION,"vec2");y.add("worldRay","vec3");z.uniforms.add(new v.Matrix4PassUniform("inverseProjectionMatrix",(C,E)=>E.camera.inverseProjectionMatrix),new v.Matrix4PassUniform("inverseViewMatrix",(C,E)=>a.invertOrIdentity(t,E.camera.viewMatrix)));z.code.add(w.glsl`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`);A.include(e.ColorConversion);A.include(m.RgbaFloatEncoding);r.include(d.EvaluateAmbientLighting,{pbrMode:k.PBRMode.Disabled,lightingSphericalHarmonicsOrder:2});r.include(g.PiUtils);r.include(f.Gamma);r.include(n.MainLighting);r.include(q.CloudsParallaxShading);A.uniforms.add(new l.Float3PassUniform("cameraPosition",(C,E)=>E.camera.eye));A.code.add(w.glsl`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
fragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`);return r}const t=c.create();c=Object.freeze(Object.defineProperty({__proto__:null,build:h},Symbol.toStringTag,{value:"Module"}));b.CloudsCompositionShader=c;b.build=h})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientLighting.glsl":function(){define("exports ../../../../../../chunks/vec3 ../../../../../../chunks/vec3f64 ../../../../../../chunks/vec4 ../../../../../../chunks/vec4f64 ./PhysicallyBasedRenderingParameters.glsl ../../shaderModules/Float3PassUniform ../../shaderModules/Float4PassUniform ../../shaderModules/interfaces".split(" "),
function(b,a,c,d,f,n,k,g,q){const e=c.create(),m=f.create();b.EvaluateAmbientLighting=function(l,w){l=l.fragment;const v=void 0!==w.lightingSphericalHarmonicsOrder?w.lightingSphericalHarmonicsOrder:2;0===v?(l.uniforms.add(new k.Float3PassUniform("lightingAmbientSH0",(x,p)=>a.set(e,p.lighting.sh.r[0],p.lighting.sh.g[0],p.lighting.sh.b[0]))),l.code.add(q.glsl`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):1===v?(l.uniforms.add(new g.Float4PassUniform("lightingAmbientSH_R",(x,p)=>d.set(m,p.lighting.sh.r[0],p.lighting.sh.r[1],p.lighting.sh.r[2],p.lighting.sh.r[3])),new g.Float4PassUniform("lightingAmbientSH_G",(x,p)=>d.set(m,p.lighting.sh.g[0],p.lighting.sh.g[1],p.lighting.sh.g[2],p.lighting.sh.g[3])),new g.Float4PassUniform("lightingAmbientSH_B",(x,p)=>d.set(m,p.lighting.sh.b[0],p.lighting.sh.b[1],p.lighting.sh.b[2],p.lighting.sh.b[3]))),l.code.add(q.glsl`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):2===v&&(l.uniforms.add(new k.Float3PassUniform("lightingAmbientSH0",(x,p)=>a.set(e,p.lighting.sh.r[0],p.lighting.sh.g[0],p.lighting.sh.b[0])),new g.Float4PassUniform("lightingAmbientSH_R1",(x,p)=>d.set(m,p.lighting.sh.r[1],p.lighting.sh.r[2],p.lighting.sh.r[3],p.lighting.sh.r[4])),new g.Float4PassUniform("lightingAmbientSH_G1",(x,p)=>d.set(m,p.lighting.sh.g[1],p.lighting.sh.g[2],p.lighting.sh.g[3],p.lighting.sh.g[4])),new g.Float4PassUniform("lightingAmbientSH_B1",(x,p)=>d.set(m,p.lighting.sh.b[1],
p.lighting.sh.b[2],p.lighting.sh.b[3],p.lighting.sh.b[4])),new g.Float4PassUniform("lightingAmbientSH_R2",(x,p)=>d.set(m,p.lighting.sh.r[5],p.lighting.sh.r[6],p.lighting.sh.r[7],p.lighting.sh.r[8])),new g.Float4PassUniform("lightingAmbientSH_G2",(x,p)=>d.set(m,p.lighting.sh.g[5],p.lighting.sh.g[6],p.lighting.sh.g[7],p.lighting.sh.g[8])),new g.Float4PassUniform("lightingAmbientSH_B2",(x,p)=>d.set(m,p.lighting.sh.b[5],p.lighting.sh.b[6],p.lighting.sh.b[7],p.lighting.sh.b[8]))),l.code.add(q.glsl`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),w.pbrMode!==n.PBRMode.Normal&&w.pbrMode!==n.PBRMode.Schematic||l.code.add(q.glsl`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl":function(){define("exports ../attributes/VertexTextureCoordinates.glsl ../../shaderModules/Float3DrawUniform ../../shaderModules/Float3PassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DDrawUniform ../../shaderModules/Texture2DPassUniform ../../shaderTechnique/BindType ../../../lib/GLTextureMaterial".split(" "),function(b,
a,c,d,f,n,k,g,q){b.PBRMode=void 0;(function(m){m[m.Disabled=0]="Disabled";m[m.Normal=1]="Normal";m[m.Schematic=2]="Schematic";m[m.Water=3]="Water";m[m.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh";m[m.Terrain=5]="Terrain";m[m.TerrainWithWater=6]="TerrainWithWater";m[m.COUNT=7]="COUNT"})(b.PBRMode||(b.PBRMode={}));class e extends q.GLTextureMaterialBindParameters{}b.PBRBindParameters=e;b.PhysicallyBasedRenderingParameters=function(m,l){const w=m.fragment,v=l.hasMetallicRoughnessTexture||l.hasEmissionTexture||
l.hasOcclusionTexture;l.pbrMode===b.PBRMode.Normal&&v&&m.include(a.VertexTextureCoordinates,l);l.pbrMode===b.PBRMode.Schematic?w.code.add(f.glsl`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`):l.pbrMode===b.PBRMode.Disabled?w.code.add(f.glsl`float getBakedOcclusion() { return 1.0; }`):l.pbrMode===b.PBRMode.Normal&&(w.code.add(f.glsl`vec3 mrr;
vec3 emission;
float occlusion;`),m=l.pbrTextureBindType,l.hasMetallicRoughnessTexture&&(w.uniforms.add(m===g.BindType.Pass?new k.Texture2DPassUniform("texMetallicRoughness",x=>x.textureMetallicRoughness):new n.Texture2DDrawUniform("texMetallicRoughness",x=>x.textureMetallicRoughness)),w.code.add(f.glsl`void applyMetallnessAndRoughness(vec2 uv) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, uv).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),l.hasEmissionTexture&&(w.uniforms.add(m===g.BindType.Pass?new k.Texture2DPassUniform("texEmission",x=>x.textureEmissive):new n.Texture2DDrawUniform("texEmission",x=>x.textureEmissive)),w.code.add(f.glsl`void applyEmission(vec2 uv) {
emission *= textureLookup(texEmission, uv).rgb;
}`)),l.hasOcclusionTexture?(w.uniforms.add(m===g.BindType.Pass?new k.Texture2DPassUniform("texOcclusion",x=>x.textureOcclusion):new n.Texture2DDrawUniform("texOcclusion",x=>x.textureOcclusion)),w.code.add(f.glsl`void applyOcclusion(vec2 uv) {
occlusion *= textureLookup(texOcclusion, uv).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):w.code.add(f.glsl`float getBakedOcclusion() { return 1.0; }`),m===g.BindType.Pass?w.uniforms.add(new d.Float3PassUniform("emissionFactor",x=>x.emissiveFactor),new d.Float3PassUniform("mrrFactors",x=>x.mrrFactors)):w.uniforms.add(new c.Float3DrawUniform("emissionFactor",x=>x.emissiveFactor),new c.Float3DrawUniform("mrrFactors",x=>x.mrrFactors)),w.code.add(f.glsl`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;

      ${l.hasMetallicRoughnessTexture?f.glsl`applyMetallnessAndRoughness(${l.hasMetallicRoughnessTextureTransform?f.glsl`metallicRoughnessUV`:"vuv0"});`:""}

      ${l.hasEmissionTexture?f.glsl`applyEmission(${l.hasEmissiveTextureTransform?f.glsl`emissiveUV`:"vuv0"});`:""}

      ${l.hasOcclusionTexture?f.glsl`applyOcclusion(${l.hasOcclusionTextureTransform?f.glsl`occlusionUV`:"vuv0"});`:""}
    }
  `))};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTextureCoordinates.glsl":function(){define(["exports","../../../../../../core/compilerUtils","./TextureCoordinateAttribute.glsl","../util/TextureAtlasLookup.glsl","../../shaderModules/interfaces"],function(b,a,c,d,f){b.VertexTextureCoordinates=function(n,k){n.include(c.TextureCoordinateAttribute,k);switch(k.textureCoordinateType){case c.TextureCoordinateAttributeType.Default:case c.TextureCoordinateAttributeType.Compressed:n.fragment.code.add(f.glsl`vec4 textureLookup(sampler2D tex, vec2 uv) {
return texture(tex, uv);
}`);break;case c.TextureCoordinateAttributeType.Atlas:n.include(d.TextureAtlasLookup);n.fragment.code.add(f.glsl`vec4 textureLookup(sampler2D tex, vec2 uv) {
return textureAtlasLookup(tex, uv, vuvRegion);
}`);break;default:a.neverReached(k.textureCoordinateType);case c.TextureCoordinateAttributeType.None:case c.TextureCoordinateAttributeType.COUNT:}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/TextureAtlasLookup.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(b,a){b.TextureAtlasLookup=function(c){c.fragment.code.add(a.glsl`vec4 textureAtlasLookup(sampler2D tex, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
return textureGrad(tex, uvAtlas, dUVdx, dUVdy);
}`)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Float3DrawUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(b,a,c){class d extends a.Uniform{constructor(f,n){super(f,"vec3",c.BindType.Draw,(k,g,q,e)=>k.setUniform3fv(f,n(g,q,e)))}}b.Float3DrawUniform=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Texture2DDrawUniform":function(){define(["exports",
"./Uniform","../shaderTechnique/BindType"],function(b,a,c){class d extends a.Uniform{constructor(f,n){super(f,"sampler2D",c.BindType.Draw,(k,g,q)=>k.bindTexture(f,n(g,q)))}}b.Texture2DDrawUniform=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/GLTextureMaterial":function(){define("exports ../../../../core/maybe ../../../../core/promiseUtils ../core/shaderModules/interfaces ./basicInterfaces ./GLMaterial".split(" "),function(b,a,c,d,f,n){class k extends n{constructor(q){super(q);
this._numLoading=0;this._disposed=!1;this._textureRepository=q.textureRepository;this._textureId=q.textureId;this._acquire(q.textureId,e=>this._texture=e);this._acquire(q.normalTextureId,e=>this._textureNormal=e);this._acquire(q.emissiveTextureId,e=>this._textureEmissive=e);this._acquire(q.occlusionTextureId,e=>this._textureOcclusion=e);this._acquire(q.metallicRoughnessTextureId,e=>this._textureMetallicRoughness=e)}dispose(){this._texture=a.releaseMaybe(this._texture);this._textureNormal=a.releaseMaybe(this._textureNormal);
this._textureEmissive=a.releaseMaybe(this._textureEmissive);this._textureOcclusion=a.releaseMaybe(this._textureOcclusion);this._textureMetallicRoughness=a.releaseMaybe(this._textureMetallicRoughness);this._disposed=!0}ensureResources(q){return 0===this._numLoading?f.ResourceState.LOADED:f.ResourceState.LOADING}get textureBindParameters(){return new g(null!=this._texture?this._texture.glTexture:null,null!=this._textureNormal?this._textureNormal.glTexture:null,null!=this._textureEmissive?this._textureEmissive.glTexture:
null,null!=this._textureOcclusion?this._textureOcclusion.glTexture:null,null!=this._textureMetallicRoughness?this._textureMetallicRoughness.glTexture:null)}updateTexture(q){if(null==this._texture||q!==this._texture.id)this._texture=a.releaseMaybe(this._texture),this._textureId=q,this._acquire(this._textureId,e=>this._texture=e)}_acquire(q,e){null==q?e(null):(q=this._textureRepository.acquire(q),c.isPromiseLike(q)?(++this._numLoading,q.then(m=>{this._disposed?(a.releaseMaybe(m),e(null)):e(m)}).finally(()=>
--this._numLoading)):e(q))}}class g extends d.NoParameters{constructor(q=null,e=null,m=null,l=null,w=null){super();this.texture=q;this.textureNormal=e;this.textureEmissive=m;this.textureOcclusion=l;this.textureMetallicRoughness=w}}b.GLTextureMaterial=k;b.GLTextureMaterialBindParameters=g;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/GLMaterial":function(){define(["./basicInterfaces"],function(b){class a{constructor(c){this._material=c.material;this._techniqueRepository=
c.techniqueRep;this._output=c.output}dispose(){this._techniqueRepository.release(this._technique)}get technique(){return this._technique}get _stippleTextureRepository(){return this._techniqueRepository.constructionContext.stippleTextureRepository}get _markerTextureRepository(){return this._techniqueRepository.constructionContext.markerTextureRepository}ensureTechnique(c,d){return this._technique=this._techniqueRepository.releaseAndAcquire(c,this._material.getConfiguration(this._output,d),this._technique)}ensureResources(c){return b.ResourceState.LOADED}}
return a})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(b,a){b.PiUtils=function(c){c.vertex.code.add(a.glsl`const float PI = 3.141592653589793;`);c.fragment.code.add(a.glsl`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/CloudsParallaxShading.glsl":function(){define("exports ../../../../../../core/mathUtils ../../../../../../geometry/support/Ellipsoid ../../../../environment/CloudsData ../../../../environment/CloudsParameters ../../../../environment/weather ../shading/MainLighting.glsl ../../shaderModules/BooleanPassUniform ../../shaderModules/Float3PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix4PassUniform ../../shaderModules/TextureCubePassUniform".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w){b.CloudsParallaxShading=function(v){v=v.fragment;v.uniforms.add(new l.Matrix4PassUniform("rotationMatrixClouds",(x,p)=>p.cloudsFade.parallax.transform),new l.Matrix4PassUniform("rotationMatrixCloudsCrossFade",(x,p)=>p.cloudsFade.parallaxNew.transform),new q.Float3PassUniform("anchorPosition",(x,p)=>p.cloudsFade.parallax.anchorPointClouds),new q.Float3PassUniform("anchorPositionCrossFade",(x,p)=>p.cloudsFade.parallaxNew.anchorPointClouds),new e.FloatPassUniform("cloudsHeight",
()=>n.cloudsHeight),new e.FloatPassUniform("radiusCurvatureCorrectionFactor",(x,p)=>p.cloudsFade.parallax.radiusCurvatureCorrectionFactor),new e.FloatPassUniform("totalFadeInOut",(x,p)=>1-p.cloudsFade.opacity),new e.FloatPassUniform("crossFadeAnchorFactor",(x,p)=>a.clamp(p.cloudsFade.fadeFactor,0,1)),new w.TextureCubePassUniform("cubeMap",(x,p)=>p.cloudsFade.data?.cubeMap?.colorTexture??null),new g.BooleanPassUniform("crossFade",(x,p)=>p.cloudsFade.fadeMode===f.FadeMode.CROSS_FADE),new g.BooleanPassUniform("readChannelsRG",
(x,p)=>p.cloudsFade.readChannels===d.CloudsTextureChannels.RG),new g.BooleanPassUniform("fadeTextureChannels",(x,p)=>p.cloudsFade.renderingStage===d.CloudsRenderingStages.FADING));v.constants.add("planetRadius","float",c.earth.radius);v.code.add(m.glsl`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`);v.code.add(m.glsl`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`);v.code.add(m.glsl`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`);k.addMainLightDirection(v);k.addMainLightIntensity(v);v.code.add(m.glsl`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(mainLightDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(mainLightDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, RIM_SCATTERING_FACTOR)) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`);v.code.add(m.glsl`vec4 getCloudData(vec3 rayDir, bool readOtherChannel)
{
vec4 cloudData = texture(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
bool readChannels = readChannelsRG ^^ readOtherChannel;
if (readChannels) {
cloudData = vec4(vec3(cloudData.r), cloudData.g);
} else {
cloudData = vec4(vec3(cloudData.b), cloudData.a);
}
if (length(cloudData) == 0.0) {
return vec4(cloudData.rgb, 1.0);
}
return cloudData;
}`);v.code.add(m.glsl`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`);v.code.add(m.glsl`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected, fadeTextureChannels);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`);v.code.add(m.glsl`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudsData":function(){define(["exports"],function(b){b.CloudsRenderingStages=void 0;(function(a){a[a.RENDERING=0]="RENDERING";a[a.FADING=1]="FADING";a[a.FINISHED=2]="FINISHED"})(b.CloudsRenderingStages||(b.CloudsRenderingStages={}));b.CloudsTextureChannels=void 0;(function(a){a[a.RG=0]="RG";a[a.BA=1]="BA"})(b.CloudsTextureChannels||(b.CloudsTextureChannels={}));b.ensureClouds=function(a){return null!=
a&&!a.running};b.isReadyCloudsData=function(a){return null!=a?.cubeMap};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudsParameters":function(){define("exports ../../../core/mathUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/support/axisAngleDegrees ../../../geometry/support/Ellipsoid ./CloudsData ./weather ../../support/RenderState".split(" "),function(b,a,c,d,f,n,k,g,q,e,m){class l{constructor(){this.readChannels=
q.CloudsTextureChannels.RG;this.renderingStage=q.CloudsRenderingStages.FINISHED;this.startTimeHeightFade=this.startTime=0;this.cameraPositionLastFrame=n.create();this.parallax=new w;this.parallaxNew=new w;this.pointOnGround=n.create();this.fadeMode=b.FadeMode.HIDE;this.opacity=this.fadeFactor=0}updateParallax(h){var t=this.parallax;h=f.length(h.eye);t.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(h*h-g.earth.radius*g.earth.radius,0))/h;k.fromPoints(v,t.anchorPointClouds,x);c.rotate(t.transform,
d.IDENTITY,x[3],k.axis(x));this.fadeMode===b.FadeMode.CROSS_FADE&&(t=this.parallaxNew,k.fromPoints(v,t.anchorPointClouds,x),c.rotate(t.transform,d.IDENTITY,x[3],k.axis(x)))}updateFading(h,t,r,u){this.isFading&&this._advanceFading(r,u);this._evaluateFading(h,t,r)}_evaluateFading(h,t,r){const u=h.relativeElevation;h=this._calculateDistanceToAnchorPoint(h);(u>1.7*e.weatherHeightLimit||u<-e.weatherHeightLimit||2E5<h)&&0<this.opacity?this._setFade(b.FadeMode.HIDE,r):this.isFading||((u>e.weatherHeightLimit||
u<-.35*e.weatherHeightLimit||64E3<h)&&0<this.opacity?this._setFade(b.FadeMode.FADE_OUT,r):u<=e.weatherHeightLimit&&u>=-.35*e.weatherHeightLimit&&t===m.RenderState.IDLE&&q.ensureClouds(this.data)&&(0===this.opacity?this._setFade(b.FadeMode.FADE_IN,r):(34E3<h||this.renderingStage===q.CloudsRenderingStages.FADING)&&this._setFade(b.FadeMode.CROSS_FADE,r)))}_advanceFading(h,t){this._switchReadChannels();this._updateAnchorPoint();this._advanceFadingFactorAndOpacity(h,t)}_advanceFadingFactorAndOpacity(h,
t){1>this.fadeFactor?(this.fadeFactor=t?a.clamp((h-this.startTime)/(1.25*t),0,1):1,this.fadeMode===b.FadeMode.FADE_OUT&&(this.opacity=1-this.fadeFactor),this.fadeMode===b.FadeMode.FADE_IN&&(this.opacity=this.fadeFactor),this.fadeMode===b.FadeMode.CROSS_FADE&&(this.opacity=1)):(this.fadeFactor=0,this.fadeMode===b.FadeMode.FADE_OUT&&(this.opacity=0),this.fadeMode===b.FadeMode.FADE_IN&&(this.opacity=1),this.fadeMode===b.FadeMode.CROSS_FADE&&(this.opacity=1),this.fadeMode=b.FadeMode.NONE)}_switchReadChannels(){const h=
this.fadeMode===b.FadeMode.CROSS_FADE&&1===this.fadeFactor,t=this.fadeMode===b.FadeMode.FADE_IN&&0===this.fadeFactor;this.renderingStage===q.CloudsRenderingStages.FADING&&(h||t)&&(this.readChannels=1-this.readChannels,this.renderingStage=q.CloudsRenderingStages.FINISHED)}_calculateDistanceToAnchorPoint(h){f.normalize(this.pointOnGround,h.eye);f.scale(this.pointOnGround,this.pointOnGround,g.earth.radius);return f.length(f.subtract(p,this.parallax.anchorPointClouds,this.pointOnGround))}_updateAnchorPoint(){this.fadeMode===
b.FadeMode.CROSS_FADE&&(0===this.fadeFactor&&f.copy(this.parallaxNew.anchorPointClouds,this.pointOnGround),1===this.fadeFactor&&f.copy(this.parallax.anchorPointClouds,this.parallaxNew.anchorPointClouds));this.fadeMode===b.FadeMode.FADE_IN&&0===this.fadeFactor&&f.copy(this.parallax.anchorPointClouds,this.pointOnGround)}_setFade(h,t){switch(h){case b.FadeMode.HIDE:this.opacity=0;break;case b.FadeMode.FADE_OUT:this.opacity=1;break;case b.FadeMode.FADE_IN:this.opacity=0;break;case b.FadeMode.CROSS_FADE:this.opacity=
1}this.fadeMode=h;this.fadeFactor=0;this.startTime=t}get isFading(){return this.fadeMode===b.FadeMode.FADE_OUT||this.fadeMode===b.FadeMode.FADE_IN||this.fadeMode===b.FadeMode.CROSS_FADE}}b.FadeMode=void 0;(function(h){h[h.NONE=0]="NONE";h[h.HIDE=1]="HIDE";h[h.FADE_OUT=2]="FADE_OUT";h[h.FADE_IN=3]="FADE_IN";h[h.CROSS_FADE=4]="CROSS_FADE"})(b.FadeMode||(b.FadeMode={}));class w{constructor(){this.anchorPointClouds=n.create();this.radiusCurvatureCorrectionFactor=0;this.transform=d.create()}}const v=n.fromValues(0,
0,1),x=k.create(),p=n.create();b.CloudsParameters=l;b.crossFadeDistanceThreshold=34E3;b.fadeOutDistanceThreshold=64E3;b.hideDistanceThreshold=2E5;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/axisAngleDegrees":function(){define("exports ../../core/mathUtils ../../chunks/quat ../../chunks/quatf64 ../../chunks/vec3 ../../chunks/vec3f64".split(" "),function(b,a,c,d,f,n){function k(u=w){return[u[0],u[1],u[2],u[3]]}function g(u,y,z,A,C=k()){C[0]=u;C[1]=y;C[2]=z;
C[3]=A;return C}function q(u,y,z=k()){f.copy(z,u);z[3]=y;return z}function e(u,y,z=k()){c.setAxisAngle(v,u,m(u));c.setAxisAngle(x,y,m(y));c.multiply(v,x,v);return l(z,a.rad2deg(c.getAxisAngle(z,v)))}function m(u){return a.deg2rad(u[3])}function l(u,y){u[3]=y;return u}const w=[0,0,1,0],v=d.create(),x=d.create(),p=k(),h=k(),t=k(),r=k();b.angle=function(u){return u[3]};b.angleRad=m;b.axis=function(u){return u};b.compose=e;b.composeAxes=function(u,y,z,A=k()){q(n.UNIT_X,u,h);q(n.UNIT_Y,y,t);q(n.UNIT_Z,
z,r);e(h,t,h);e(h,r,A);return A};b.copy=function(u,y=k()){return g(u[0],u[1],u[2],u[3],y)};b.create=k;b.fromAxisAndAngle=q;b.fromPoints=function(u,y,z=k()){f.cross(z,u,y);f.normalize(z,z);z[3]=-f.angle(u,y);return z};b.fromValues=g;b.setAngle=l;b.up=w;b.wrap=function(u,y,z,A){return g(u,y,z,A,p)};b.wrapAxisAngle=function(u,y){return g(u[0],u[1],u[2],y,p)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/BooleanPassUniform":function(){define(["exports",
"./Uniform","../shaderTechnique/BindType"],function(b,a,c){class d extends a.Uniform{constructor(f,n){super(f,"bool",c.BindType.Pass,(k,g,q)=>k.setUniform1b(f,n(g,q)))}}b.BooleanPassUniform=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/TextureCubePassUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(b,a,c){class d extends a.Uniform{constructor(f,n){super(f,"samplerCube",c.BindType.Pass,(k,g,
q)=>k.bindTexture(f,n(g,q)))}}b.TextureCubePassUniform=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(b,a){b.ColorConversion=function(c){c.code.add(a.glsl`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudsGenerator":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat3 ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec2 ../../../chunks/vec2f64 ../../../chunks/vec3f32 ../../../geometry/ellipsoidUtils ../../../chunks/Clouds.glsl ./CloudsData ./CloudsParameters ./CloudsPresets ./CloudsTechnique ./CloudsTechniqueConfiguration ./NoiseTextureAtlas ../webgl-engine/lib/BindParameters ../webgl-engine/lib/glUtil3D ../../support/Scheduler ../../webgl/enums ../../webgl/FramebufferObject ../../webgl/TextureDescriptor".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A,C,E,B,D,F,K,L,G){b.CloudsGenerator=class extends c{constructor(R){super(R);this._techniques=[];this._techniqueConfiguration=new C.CloudsTechniqueConfiguration;this._bindParameters=new B.BindParameters(null,null);this._passParameters=new r.CloudsPassParameters;this._drawParameters=new r.CloudsDrawParameters;this._weatherTile=p.create();this._weatherTileCount=128;this._tileIndex=this._faceIndex=0;this.coverage=d.lerp(z.cloudPresets.default.coverage[0],
z.cloudPresets.default.coverage[1],.5);this.density=d.lerp(z.cloudPresets.default.density[0],z.cloudPresets.default.density[1],.5);this.absorption=d.lerp(z.cloudPresets.default.absorption[0],z.cloudPresets.default.absorption[1],.5);this.cloudSize=d.lerp(z.cloudPresets.default.cloudSize[0],z.cloudPresets.default.cloudSize[1],.5);this.detailSize=d.lerp(z.cloudPresets.default.detailSize[0],z.cloudPresets.default.detailSize[1],.5);this.smoothness=d.lerp(z.cloudPresets.default.smoothness[0],z.cloudPresets.default.smoothness[1],
.5);this.cloudHeight=d.lerp(z.cloudPresets.default.cloudHeight[0],z.cloudPresets.default.cloudHeight[1],.5);this.raymarchingSteps=z.cloudPresets.default.raymarchingSteps;this._viewMatrix=v.create();this.running=this._dirty=!1;this._vao=D.createQuadVAO(R.context.renderContext.rctx)}_getTechnique(R){const X=1-this.context.renderContext.bindParameters.cloudsFade.readChannels,U=X===u.CloudsTextureChannels.RG?2*R:2*R+1,M=this._techniques[U];if(M)return M;this._techniqueConfiguration.writeTextureChannels=
X;this._techniqueConfiguration.steps=R;this._techniques[U]=new A.CloudsTechnique({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration);return this._techniques[U]}updateWeatherTile(){var R=this.view.camera.position.latitude,X=this.view.camera.position.longitude;null!=R&&null!=X&&(x.set(this._weatherTile,(R+90)/180,(X+180)/360),R=Math.floor(this._weatherTileCount*Math.abs(2*this._weatherTile[0]-1)),this._weatherTile[0]=Math.floor(2*this._weatherTileCount*
this._weatherTile[0]),this._weatherTile[1]=Math.floor(4*(this._weatherTileCount-R)*this._weatherTile[1]),X=R=0,null!=this.view.environment&&"virtual"!==this.view.environment.lighting.type&&null!=this.view.environment.lighting.date&&(X=new Date(this.view.environment.lighting.date),X.setUTCHours(this.view.environment.lighting.date.getUTCHours()+(this.view.environment.lighting.displayUTCOffset??0)),R=31*X.getUTCMonth()+X.getUTCDate(),X=X.getUTCFullYear()),this._weatherTile[0]=(this._weatherTile[0]+R)%
(2*this._weatherTileCount),this._weatherTile[1]=(this._weatherTile[1]+X%100)%(4*this._weatherTileCount),x.equals(this._passParameters.weatherTile,this._weatherTile)||this.setDirty())}initialize(){const R=t.getReferenceEllipsoid(this.view.spatialReference);this._passParameters.cloudRadius=.5*R.radius;this.setDirty();this.updateWeatherTile();this.addHandles([this.view.resourceController.scheduler.registerTask(F.TaskPriority.CLOUDS_GENERATOR,this),n.watch(()=>[this.coverage,this.density,this.absorption,
this.cloudSize,this.detailSize,this.smoothness,this.cloudHeight,this.raymarchingSteps],()=>this.setDirty(),n.initial)])}destroy(){this._techniques.forEach(R=>f.releaseMaybe(R));this._frameBufferCube=f.disposeMaybe(this._frameBufferCube);this._techniques.length=0;this._vao.dispose();this._passParameters.noiseTexture=f.destroyMaybe(this._passParameters.noiseTexture)}get _tilesPerFace(){switch(this._techniqueConfiguration.steps){case C.RayMarchingSteps.SIXTEEN:return 1;case C.RayMarchingSteps.HUNDRED:return 4;
case C.RayMarchingSteps.COUNT:case C.RayMarchingSteps.TWOHUNDRED:return 8}}get usedMemory(){return(this._frameBufferCube?.gpuMemoryUsage??0)+(this._passParameters.noiseTexture?.textureAtlas?.gpuMemoryUsage??0)}_ensureNoiseTexture(){null==this._passParameters.noiseTexture&&(this._passParameters.noiseTexture=new E.NoiseTextureAtlas({context:this.context}));this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile);return null!=this._passParameters.noiseTexture.textureAtlas}_ensureFrameBufferCube(R){null==
this._frameBufferCube&&(R=new G.TextureDescriptor(R),R.target=K.TextureType.TEXTURE_CUBE_MAP,R.wrapMode=K.TextureWrapMode.CLAMP_TO_EDGE,this._frameBufferCube=new L.FramebufferObject(this.context.renderContext.rctx,R));return this._frameBufferCube}get cubeMap(){return this._frameBufferCube}destroyFrameBufferCube(){this._frameBufferCube=f.disposeMaybe(this._frameBufferCube)}applyPreset(R,X){const U=R.median,M=V=>{const Y=d.lerp(V[0],V[1],U);return.5>X?d.lerp(V[0],Y,2*X):d.lerp(Y,V[1],2*(X-.5))};this.coverage=
M(R.coverage);this.density=M(R.density);this.absorption=M(R.absorption);this.cloudSize=M(R.cloudSize);this.detailSize=M(R.detailSize);this.smoothness=M(R.smoothness);this.cloudHeight=M(R.cloudHeight);this.raymarchingSteps=R.raymarchingSteps}setDirty(){this._dirty=this.running=!0}runTask(R){0===this._faceIndex&&0===this._tileIndex&&(this._passParameters.raymarchingSteps=this.raymarchingSteps,this.updateWeatherTile(),x.copy(this._passParameters.weatherTile,this._weatherTile));var X=this._getTechnique(this._passParameters.raymarchingSteps);
if(!X.compiled||this.context.renderContext.bindParameters.cloudsFade.fadeMode===y.FadeMode.CROSS_FADE||!this._ensureNoiseTexture())return F.Task.YIELD;0===this._faceIndex&&0===this._tileIndex&&(this.context.renderContext.bindParameters.cloudsFade.renderingStage=u.CloudsRenderingStages.RENDERING,this._passParameters.absorption=this.absorption,this._passParameters.density=this.density,this._passParameters.cloudSize=this.cloudSize,this._passParameters.detailSize=this.detailSize,this._passParameters.smoothness=
this.smoothness,this._passParameters.cloudHeight=this.cloudHeight,this._passParameters.coverage=this.coverage,this._dirty=!1);const U=this.context.renderContext.rctx,M=U.bindTechnique(X,this._passParameters,this._bindParameters);U.bindVAO(this._vao);M.assertCompatibleVertexAttributeLocations(this._vao);const V=U.getViewport();X=X.configuration.cubeMapSize;const Y=X/this._tilesPerFace;U.setViewport(0,this._tileIndex*Y,X,Y);X=this._ensureFrameBufferCube(X);U.bindFramebuffer(X);w.targetTo(this._viewMatrix,
J,O[this._faceIndex],P[this._faceIndex]);l.fromMat4(this._drawParameters.viewMatrix,this._viewMatrix);X.setColorTextureTarget(K.TextureType.TEXTURE_CUBE_MAP_POSITIVE_X+this._faceIndex);M.bindDraw(this._drawParameters,this._bindParameters,this._passParameters);U.gl.drawArrays(U.gl.TRIANGLE_STRIP,0,4);U.gl.flush();U.setViewport(V.x,V.y,V.width,V.height);this.requestRender();++this._tileIndex;4===this._faceIndex&&this._tileIndex===this._tilesPerFace?(this.running=this._dirty,this._tileIndex=this._faceIndex=
0,this.running||(this.context.renderContext.bindParameters.cloudsFade.renderingStage=u.CloudsRenderingStages.FADING)):this._tileIndex===this._tilesPerFace&&(++this._faceIndex,this._tileIndex=0);R.madeProgress();return F.Task.YIELD}};a.__decorate([k.property({constructOnly:!0})],b.CloudsGenerator.prototype,"context",void 0);a.__decorate([k.property({constructOnly:!0})],b.CloudsGenerator.prototype,"view",void 0);a.__decorate([k.property({constructOnly:!0})],b.CloudsGenerator.prototype,"requestRender",
void 0);a.__decorate([k.property()],b.CloudsGenerator.prototype,"coverage",void 0);a.__decorate([k.property()],b.CloudsGenerator.prototype,"density",void 0);a.__decorate([k.property()],b.CloudsGenerator.prototype,"absorption",void 0);a.__decorate([k.property()],b.CloudsGenerator.prototype,"cloudSize",void 0);a.__decorate([k.property()],b.CloudsGenerator.prototype,"detailSize",void 0);a.__decorate([k.property()],b.CloudsGenerator.prototype,"smoothness",void 0);a.__decorate([k.property()],b.CloudsGenerator.prototype,
"cloudHeight",void 0);a.__decorate([k.property()],b.CloudsGenerator.prototype,"raymarchingSteps",void 0);a.__decorate([k.property()],b.CloudsGenerator.prototype,"running",void 0);b.CloudsGenerator=a.__decorate([m.subclass("esri.views.3d.environment.CloudsGenerator")],b.CloudsGenerator);const O=[h.fromValues(1,0,0),h.fromValues(-1,0,0),h.fromValues(0,1,0),h.fromValues(0,-1,0),h.fromValues(0,0,1)],P=[h.fromValues(0,1,0),h.fromValues(0,1,0),h.fromValues(0,0,-1),h.fromValues(0,0,1),h.fromValues(0,1,0)],
J=h.zeros();Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/vec3f32":function(){define(["exports"],function(b){function a(){return new Float32Array(3)}function c(h){const t=new Float32Array(3);t[0]=h[0];t[1]=h[1];t[2]=h[2];return t}function d(h,t,r){const u=new Float32Array(3);u[0]=h;u[1]=t;u[2]=r;return u}function f(h,t){return new Float32Array(h,t,3)}function n(){return a()}function k(){return d(1,1,1)}function g(){return d(1,0,0)}function q(){return d(0,1,0)}function e(){return d(0,
0,1)}const m=a(),l=k(),w=g(),v=q(),x=e(),p=Object.freeze(Object.defineProperty({__proto__:null,ONES:l,UNIT_X:w,UNIT_Y:v,UNIT_Z:x,ZEROS:m,clone:c,create:a,createView:f,fromValues:d,ones:k,unitX:g,unitY:q,unitZ:e,zeros:n},Symbol.toStringTag,{value:"Module"}));b.ONES=l;b.UNIT_X=w;b.UNIT_Y=v;b.UNIT_Z=x;b.ZEROS=m;b.clone=c;b.create=a;b.createView=f;b.fromValues=d;b.ones=k;b.unitX=g;b.unitY=q;b.unitZ=e;b.vec3f32=p;b.zeros=n})},"esri/chunks/Clouds.glsl":function(){define("exports ../core/mathUtils ./mat3f64 ./vec2 ./vec2f64 ../views/3d/environment/CloudsPresets ../views/3d/environment/CloudsTechniqueConfiguration ../views/3d/environment/NoiseTextureAtlasDimensions ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix3DrawUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x){function p(y){const z=new v.ShaderBuilder;z.include(q.ScreenSpacePass,!1);const A=z.fragment;A.uniforms.add(new m.FloatPassUniform("cloudRadius",C=>C.cloudRadius),new m.FloatPassUniform("power",C=>a.lerp(35,120,C.absorption)),new m.FloatPassUniform("sigmaE",C=>1+C.absorption),new m.FloatPassUniform("density",C=>a.lerp(0,.3,C.density)),new m.FloatPassUniform("cloudSize",C=>a.lerp(0,.02,Math.max(.01,1-C.cloudSize))),new m.FloatPassUniform("detailSize",C=>a.lerp(0,
.2,Math.max(.01,1-C.detailSize))),new m.FloatPassUniform("smoothness",C=>a.lerp(0,.5,1-C.smoothness)),new m.FloatPassUniform("cloudHeight",C=>a.lerp(0,1500,C.cloudHeight)),new m.FloatPassUniform("coverage",C=>C.coverage),new w.Matrix3DrawUniform("view",C=>C.viewMatrix),new x.Texture2DPassUniform("cloudShapeTexture",C=>null!=C.noiseTexture?C.noiseTexture.textureAtlas:null),new e.Float2PassUniform("cloudVariables",C=>d.set(r,C.coverage,C.absorption)));A.constants.add("halfCubeMapSize","float",.5*y.cubeMapSize);
A.code.add(l.glsl`
    const int STEPS = ${y.steps===k.RayMarchingSteps.SIXTEEN?l.glsl`16`:y.steps===k.RayMarchingSteps.HUNDRED?l.glsl`100`:l.glsl`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`);A.code.add(l.glsl`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${l.glsl.float(g.atlasSize)};
      const float dataWidth = ${l.glsl.float(g.atlasSize)};
      const float tileRows = ${l.glsl.float(g.tileRows)};
      const vec3 atlasDimensions = vec3(${l.glsl.float(g.tileSize)}, ${l.glsl.float(g.tileSize)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${l.glsl.float(g.textureScale)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = (${l.glsl.float(g.weatherMapScale)} * p) / ${l.glsl.float(g.atlasSize)} + 0.5;

      return texture(cloudShapeTexture, uv).a;
    }
    `);A.code.add(l.glsl`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`);A.code.add(l.glsl`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`);A.code.add("\n    float multipleOctaves(float extinction, float mu, float stepL) {\n      float attenuation \x3d 1.0;\n      float contribution \x3d 1.0;\n      float phaseAttenuation \x3d 1.0;\n      float luminance \x3d 0.0;\n\n      for (int i \x3d 0; i \x3c 4; i++) {\n        float phase \x3d mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);\n        luminance +\x3d contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);\n        attenuation *\x3d 0.2;\n        contribution *\x3d 0.6;\n        phaseAttenuation *\x3d 0.5;\n      }\n\n      return luminance;\n    }");
A.code.add(l.glsl`float lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
float beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`);A.code.add(l.glsl`float mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return 0.0;
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
float shading = 0.0;
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
float luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
shading += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return shading;
}`);A.code.add(l.glsl`void main() {
if (coverage ==  0.0) {
fragColor = vec4(0.0, 1.0, 0.0, 1.0);
return;
}
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
float hazeFactor = smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(dot(rayDir, vec3(0, 0, 1))));
float totalTransmittance = 1.0;
float shading = 0.0;
if (hitsPlanet) {
shading = clamp(1.0 - cloudVariables.y, 0.6, 1.0) * (1.0 - hazeFactor);
totalTransmittance = hazeFactor;
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
vec3 sunDirection = normalize(vec3(0, 0, 1));
shading = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance);
shading = mix(clamp(1.0 - cloudVariables.y, 0.6, 1.0), shading, hazeFactor);
totalTransmittance = mix(0.0, totalTransmittance, hazeFactor);
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
}`);return z}class h extends l.NoParameters{constructor(){super(...arguments);this.coverage=this.cloudHeight=this.smoothness=this.density=this.absorption=this.detailSize=this.cloudSize=this.cloudRadius=0;this.raymarchingSteps=n.cloudPresets.default.raymarchingSteps;this.weatherTile=f.create()}}class t extends l.NoParameters{constructor(){super(...arguments);this.viewMatrix=c.create()}}const r=f.create(),u=Object.freeze(Object.defineProperty({__proto__:null,CloudsDrawParameters:t,CloudsPassParameters:h,
build:p},Symbol.toStringTag,{value:"Module"}));b.Clouds=u;b.CloudsDrawParameters=t;b.CloudsPassParameters=h;b.build=p})},"esri/views/3d/environment/CloudsPresets":function(){define(["exports","./CloudsTechniqueConfiguration"],function(b,a){class c{constructor(f,n,k,g,q,e,m,l,w=.5){this.coverage=f;this.density=n;this.absorption=k;this.cloudSize=g;this.detailSize=q;this.smoothness=e;this.cloudHeight=m;this.raymarchingSteps=l;this.median=w}}const d=new c([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],
[.05,.05],a.RayMarchingSteps.SIXTEEN);a={sunny:d,cloudy:new c([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],a.RayMarchingSteps.TWOHUNDRED,.6),rainy:new c([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],a.RayMarchingSteps.TWOHUNDRED,.4),snowy:new c([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],a.RayMarchingSteps.HUNDRED,.65),foggy:new c([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],a.RayMarchingSteps.SIXTEEN),default:d};b.CloudPresets=c;b.cloudPresets=a;
Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudsTechniqueConfiguration":function(){define(["exports","../../../chunks/tslib.es6","../../../core/has","./CloudsData","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],function(b,a,c,d,f){b.RayMarchingSteps=void 0;(function(k){k[k.SIXTEEN=0]="SIXTEEN";k[k.HUNDRED=1]="HUNDRED";k[k.TWOHUNDRED=2]="TWOHUNDRED";k[k.COUNT=3]="COUNT"})(b.RayMarchingSteps||(b.RayMarchingSteps={}));class n extends f.ShaderTechniqueConfiguration{constructor(){super(...arguments);
this.steps=b.RayMarchingSteps.SIXTEEN;this.writeTextureChannels=d.CloudsTextureChannels.RG}}a.__decorate([f.parameter({count:b.RayMarchingSteps.COUNT})],n.prototype,"steps",void 0);a.__decorate([f.parameter({constValue:c("esri-mobile")?1024:2048})],n.prototype,"cubeMapSize",void 0);a.__decorate([f.parameter()],n.prototype,"writeTextureChannels",void 0);b.CloudsTechniqueConfiguration=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/NoiseTextureAtlasDimensions":function(){define(["exports",
"../../../core/has"],function(b,a){a=a("esri-mobile")?64:128;const c=Math.ceil(Math.sqrt(a)),d=(a+2)*c;b.atlasSize=d;b.textureScale=a/128;b.tileRows=c;b.tileSize=a;b.weatherMapScale=d/1560;b.weatherMapSize=1E5;b.weatherTileSize=128;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix3DrawUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(b,a,c){class d extends a.Uniform{constructor(f,n){super(f,
"mat3",c.BindType.Draw,(k,g,q)=>k.setUniformMatrix3fv(f,n(g,q)))}}b.Matrix3DrawUniform=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudsTechnique":function(){define("require exports ../../../chunks/Clouds.glsl ./CloudsData ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(b,a,c,d,f,n,k,g,q,e){class m extends n.ShaderTechnique{constructor(l,w){super(l,w,()=>this.destroy())}initializeProgram(l){return new g.Program(l.rctx,m.shader.get().build(this.configuration),k.Default3D)}initializePipeline(){return e.makePipelineState({blending:e.simpleBlendingParams(q.BlendFactor.CONSTANT_COLOR,q.BlendFactor.ONE_MINUS_CONSTANT_COLOR,q.BlendOperation.ADD,this.configuration.writeTextureChannels===d.CloudsTextureChannels.RG?[1,1,0,0]:[0,0,1,1]),depthTest:{func:q.CompareFunction.LEQUAL},
colorWrite:e.defaultColorWriteParams})}}m.shader=new f.ReloadableShaderModule(c.Clouds,()=>new Promise((l,w)=>b(["./Clouds.glsl"],l,w)));a.CloudsTechnique=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/NoiseTextureAtlas":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec2 ../../../chunks/NoiseTextureAtlas.glsl ./NoiseTextureAtlasConfiguration ./NoiseTextureAtlasDimensions ./NoiseTextureAtlasTechnique ../webgl-engine/lib/glUtil3D ../../webgl/FramebufferObject ../../webgl/TextureDescriptor".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h){b.NoiseTextureAtlas=class extends c{constructor(t){super(t);this._needsRender=!0;this._passParameters=new m.NoiseTextureAtlasPassParameters;this._frameBuffer=new p.FramebufferObject(t.context.renderContext.rctx,new h.TextureDescriptor(w.atlasSize));this._vao=x.createQuadVAO(t.context.renderContext.rctx)}get _techniqueRepository(){return this.context.techniqueRepository}get textureAtlas(){null!=this._texture?null!=this._weatherMapTechnique&&this._weatherMapTechnique.compiled&&
this._needsRender&&(this._texture=this._render(l.NoiseTextureRenderMode.WeatherMap)):null!=this._fullTechnique&&this._fullTechnique.compiled&&(this._texture=this._render(l.NoiseTextureRenderMode.Full));return this._texture}_setDirty(){this._needsRender=!0}updateWeatherMap(t){if(this._passParameters.weatherTile[0]!==t[0]||this._passParameters.weatherTile[1]!==t[1])e.copy(this._passParameters.weatherTile,t),this._setDirty()}destroy(){this._fullTechniqueCached=d.releaseMaybe(this._fullTechniqueCached);
this._weatherMapTechniqueCached=d.releaseMaybe(this._weatherMapTechniqueCached);this._frameBuffer=d.disposeMaybe(this._frameBuffer);this._vao=d.disposeMaybe(this._vao)}get _fullTechnique(){if(null==this._fullTechniqueCached){const t=new l.NoiseTextureAtlasTechniqueConfiguration;t.mode=l.NoiseTextureRenderMode.Full;this._fullTechniqueCached=this._techniqueRepository.acquire(v.NoiseTextureAtlasTechnique,t)}return this._fullTechniqueCached}get _weatherMapTechnique(){if(null==this._weatherMapTechniqueCached){const t=
new l.NoiseTextureAtlasTechniqueConfiguration;t.mode=l.NoiseTextureRenderMode.WeatherMap;this._weatherMapTechniqueCached=this._techniqueRepository.acquire(v.NoiseTextureAtlasTechnique,t)}return this._weatherMapTechniqueCached}_render(t){if(null==this._vao||null==this._frameBuffer)return null;var r=t===l.NoiseTextureRenderMode.Full?this._fullTechnique:this._weatherMapTechnique;t=this.context.renderContext.rctx;const u=t.getViewport();t.setViewport(0,0,w.atlasSize,w.atlasSize);t.bindFramebuffer(this._frameBuffer);
r=t.bindTechnique(r,this._passParameters,null);t.bindVAO(this._vao);r.assertCompatibleVertexAttributeLocations(this._vao);t.gl.drawArrays(t.gl.TRIANGLE_STRIP,0,4);t.setViewport(u.x,u.y,u.width,u.height);this._needsRender=!1;return this._frameBuffer.colorTexture}};a.__decorate([f.property({constructOnly:!0})],b.NoiseTextureAtlas.prototype,"context",void 0);a.__decorate([f.property({readOnly:!0})],b.NoiseTextureAtlas.prototype,"_techniqueRepository",null);b.NoiseTextureAtlas=a.__decorate([q.subclass("esri.views.3d.environment.NoiseTextureAtlas")],
b.NoiseTextureAtlas);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/NoiseTextureAtlas.glsl":function(){define("exports ./vec2f64 ../views/3d/environment/NoiseTextureAtlasConfiguration ../views/3d/environment/NoiseTextureAtlasDimensions ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(b,a,c,d,f,n,k,g){function q(l){const w=new g.ShaderBuilder;w.include(f.ScreenSpacePass,!1);w.fragment.code.add(k.glsl`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`);l.mode===c.NoiseTextureRenderMode.Full&&w.fragment.code.add(k.glsl`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${k.glsl.float(d.tileRows)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${k.glsl.float(8)});

      float worley0 = worley(p, ${k.glsl.float(2)} * 2.0);
      float worley1 = worley(p, ${k.glsl.float(2)} * 8.0);
      float worley2 = worley(p, ${k.glsl.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${k.glsl.float(2)});
      float worley1 = worley(p, ${k.glsl.float(2)} * 2.0);
      float worley2 = worley(p, ${k.glsl.float(2)} * 4.0);
      float worley3 = worley(p, ${k.glsl.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `);w.fragment.uniforms.add(new n.Float2PassUniform("weatherTile",v=>v.weatherTile));w.fragment.code.add(k.glsl`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${k.glsl.float(d.weatherTileSize)});

      // Get global coordinates of p
      p += weatherTile * ${k.glsl.float(d.weatherTileSize)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${k.glsl.float(d.weatherMapSize)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `);w.fragment.code.add(k.glsl`void main() {`);l.mode===c.NoiseTextureRenderMode.Full&&w.fragment.code.add(k.glsl`
        float padWidth = 1.0;
        float paddedSize = ${k.glsl.float(d.tileSize)} + 2.0 * padWidth;
        float tileCount = ${k.glsl.float(d.tileRows)} * ${k.glsl.float(d.tileRows)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${k.glsl.float(d.tileSize)};
          }

          if (startPadY) {
            pixel.y += ${k.glsl.float(d.tileSize)};
          }

          if (endPadX) {
            pixel.x -= ${k.glsl.float(d.tileSize)};
          }

          if (endPadY) {
            pixel.y -= ${k.glsl.float(d.tileSize)};
          }

          uv = vec2(pixel.xy / ${k.glsl.float(d.tileSize)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${k.glsl.float(d.tileSize)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${k.glsl.float(d.tileRows)} * ${k.glsl.float(d.tileRows)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        fragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${k.glsl.float(d.tileRows)} * ${k.glsl.float(d.tileRows)});
        p = p_;
        p.z /= (${k.glsl.float(d.tileRows)} * ${k.glsl.float(d.tileRows)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        fragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `);w.fragment.code.add(k.glsl`
      vec2 mapUV = ${k.glsl.float(d.weatherTileSize)} * (gl_FragCoord.xy / ${k.glsl.float(d.atlasSize)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${l.mode===c.NoiseTextureRenderMode.Full?k.glsl`fragColor.ba = vec2(0.0, map);`:k.glsl`fragColor = vec4(map);`};
    }
  `);return w}class e extends k.NoParameters{constructor(){super(...arguments);this.weatherTile=a.fromValues(0,0)}}const m=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:e,build:q},Symbol.toStringTag,{value:"Module"}));b.NoiseTextureAtlas=m;b.NoiseTextureAtlasPassParameters=e;b.build=q})},"esri/views/3d/environment/NoiseTextureAtlasConfiguration":function(){define(["exports","../../../chunks/tslib.es6","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],
function(b,a,c){b.NoiseTextureRenderMode=void 0;(function(f){f[f.Full=0]="Full";f[f.WeatherMap=1]="WeatherMap";f[f.COUNT=2]="COUNT"})(b.NoiseTextureRenderMode||(b.NoiseTextureRenderMode={}));class d extends c.ShaderTechniqueConfiguration{constructor(){super(...arguments);this.mode=b.NoiseTextureRenderMode.Full}}a.__decorate([c.parameter({count:b.NoiseTextureRenderMode.COUNT})],d.prototype,"mode",void 0);b.NoiseTextureAtlasTechniqueConfiguration=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/environment/NoiseTextureAtlasTechnique":function(){define("require exports ../../../chunks/NoiseTextureAtlas.glsl ./NoiseTextureAtlasConfiguration ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),function(b,a,c,d,f,n,k,g,q,e){class m extends n.ShaderTechnique{initializeProgram(l){return new g.Program(l.rctx,
m.shader.get().build(this.configuration),k.Default3D)}initializePipeline(){return e.makePipelineState({blending:this.configuration.mode===d.NoiseTextureRenderMode.Full?e.simpleBlendingParams(q.BlendFactor.ONE,q.BlendFactor.ZERO):e.separateBlendingParams(q.BlendFactor.ZERO,q.BlendFactor.ONE,q.BlendFactor.ONE,q.BlendFactor.ZERO),depthTest:{func:q.CompareFunction.ALWAYS},colorWrite:e.defaultColorWriteParams})}}m.shader=new f.ReloadableShaderModule(c.NoiseTextureAtlas,()=>new Promise((l,w)=>b(["./NoiseTextureAtlas.glsl"],
l,w)));a.NoiseTextureAtlasTechnique=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/BindParameters":function(){define("exports ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../environment/CloudsParameters ../core/shaderLibrary/hud/HUDRenderStyle ../core/shaderLibrary/shading/MultipassGeometryTest.glsl ../core/shaderLibrary/shading/MultipassTerrainTest.glsl ./basicInterfaces ./Camera ./RenderSlot ./TransparencyPassType ../lighting/SceneLighting".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l){class w{constructor(x,p){this.shadowMap=x;this.slicePlane=p;this.slot=e.RenderSlot.OPAQUE_MATERIAL;this.hasOccludees=!1;this.enableFillLights=!0;this.transparencyPassType=m.TransparencyPassType.NONE;this.alignPixelEnabled=!1;this.decorations=g.Decorations.ON;this.overlayStretch=1;this._camera=new q.Camera;this._inverseViewport=c.create();this.oldLighting=new l.SceneLighting;this.newLighting=new l.SceneLighting;this._fadedLighting=new l.SceneLighting;this._lighting=
this.newLighting;this.ssr=new v;this.multipassEnabled=!1;this.multipassTerrain=new k.MultipassTerrainUniforms;this.multipassGeometry=new n.MultipassGeometryUniforms;this.hudRenderStyle=f.HUDRenderStyle.Occluded;this.cloudsFade=new d.CloudsParameters}get camera(){return this._camera}set camera(x){this._camera=x;this._inverseViewport[0]=1/x.fullViewport[2];this._inverseViewport[1]=1/x.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}get weatherFading(){return this._lighting===
this._fadedLighting}fadeLighting(x){const {oldLighting:p,newLighting:h}=this;1<=x?this._lighting=h:(this._fadedLighting.lerpLighting(p,h,x),this._lighting=this._fadedLighting)}}class v{constructor(){this.fadeFactor=1;this.reprojectionMatrix=a.create()}}b.BindParameters=w;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUDRenderStyle":function(){define(["exports"],function(b){b.HUDRenderStyle=void 0;var a=b.HUDRenderStyle||(b.HUDRenderStyle=
{});a[a.Occluded=0]="Occluded";a[a.NotOccluded=1]="NotOccluded";a[a.Both=2]="Both";a[a.COUNT=3]="COUNT";Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/MultipassGeometryTest.glsl":function(){define(["exports","../output/ReadLinearDepth.glsl","../../shaderModules/Float2PassUniform","../../shaderModules/interfaces","../../shaderModules/Texture2DPassUniform"],function(b,a,c,d,f){class n{}b.MultipassGeometryUniforms=n;b.multipassGeometryTest=
function(k){k.include(a.ReadLinearDepth);k.uniforms.add(new f.Texture2DPassUniform("geometryDepthTexture",(g,q)=>q.multipassGeometry.linearDepth?.colorTexture),new c.Float2PassUniform("nearFar",(g,q)=>q.camera.nearFar));k.code.add(d.glsl`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl":function(){define(["exports","../output/ReadLinearDepth.glsl","../../shaderModules/Float2PassUniform","../../shaderModules/interfaces","../../shaderModules/Texture2DPassUniform"],function(b,a,c,d,f){class n{constructor(){this.cullAboveGround=!1}}b.MultipassTerrainUniforms=n;b.multipassTerrainTest=function(k,g){if(g.multipassEnabled){k.fragment.include(a.ReadLinearDepth);
k.fragment.uniforms.add(new f.Texture2DPassUniform("terrainDepthTexture",(e,m)=>m.multipassTerrain.linearDepth?.colorTexture));k.fragment.uniforms.add(new c.Float2PassUniform("nearFar",(e,m)=>m.camera.nearFar));var q=g.occlusionPass;k.fragment.code.add(d.glsl`
   ${q?"bool":"void"} terrainDepthTest(float fragmentDepth) {
      vec4 data = texelFetch(terrainDepthTexture, ivec2(gl_FragCoord.xy), 0);
      float linearDepth = linearDepthFromRGBA(data, nearFar);
      ${q?d.glsl`return fragmentDepth < linearDepth && data != vec4(0.0, 0.0, 0.0, 1.0);`:d.glsl`
          if(fragmentDepth ${g.cullAboveGround?"\x3e":"\x3c\x3d"} linearDepth){
            discard;
          }`}
    }`)}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Camera":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Logger ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/support/frustum ../../../../geometry/support/ray ../../../../geometry/support/vector ../../../ViewingMode ./fov".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A,C){var E;b.Camera=E=class extends c{constructor(G={}){super(G);this._center=h.create();this._up=h.create();this._viewUp=h.create();this._viewForward=h.create();this._viewRight=h.create();this._ray=y.create();this._viewport=r.fromValues(0,0,1,1);this._padding=r.fromValues(0,0,0,0);this._fov=55/180*Math.PI;this._nearFar=x.fromValues(1,1E3);this._viewDirty=!0;this._viewMatrix=w.create();this._viewProjectionDirty=!0;this._viewProjectionMatrix=w.create();
this._viewInverseTransposeMatrixDirty=!0;this._viewInverseTransposeMatrix=w.create();this._frustumDirty=!0;this._frustum=u.create();this._fullViewport=r.create();this._pixelRatio=1;this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(G){this._pixelRatio=0<G?G:1}get eye(){return this._ray.origin}set eye(G){this._compareAndSetView(G,this._ray.origin)}get center(){return this._center}set center(G){this._compareAndSetView(G,this._center,"_center")}get ray(){p.subtract(this._ray.direction,
this.center,this.eye);return this._ray}get up(){return this._up}set up(G){this._compareAndSetView(G,this._up,"_up")}get viewMatrix(){this._ensureViewClean();return this._viewMatrix}set viewMatrix(G){l.copy(this._viewMatrix,G);this._viewDirty=!1;this._frustumDirty=this._viewProjectionDirty=this._viewInverseTransposeMatrixDirty=!0}get viewForward(){this._ensureViewClean();return this._viewForward}get viewUp(){this._ensureViewClean();return this._viewUp}get viewRight(){this._ensureViewClean();return this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(G){this._nearFar[0]!==
G&&(this._nearFar[0]=G,this._frustumDirty=this._viewProjectionDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(G){this._nearFar[1]!==G&&(this._nearFar[1]=G,this._frustumDirty=this._viewProjectionDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(G){this.x=G[0];this.y=G[1];this.width=G[2];this.height=G[3]}get screenViewport(){if(1===this.pixelRatio)return this._viewport;const G=t.scale(r.create(),this._viewport,1/this.pixelRatio),
O=this._get("screenViewport");return O&&t.equals(G,O)?O:G}get screenPadding(){if(1===this.pixelRatio)return this._padding;const G=t.scale(r.create(),this._padding,1/this.pixelRatio),O=this._get("screenPadding");return O&&t.equals(G,O)?O:G}get x(){return this._viewport[0]}set x(G){G+=this._padding[b.PaddingSide.LEFT];this._viewport[0]!==G&&(this._viewport[0]=G,this._frustumDirty=this._viewProjectionDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(G){G+=this._padding[b.PaddingSide.BOTTOM];
this._viewport[1]!==G&&(this._viewport[1]=G,this._frustumDirty=this._viewProjectionDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(G){this._viewport[2]!==G&&(this._viewport[2]=G,this._frustumDirty=this._viewProjectionDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(G){this._viewport[3]!==G&&(this._viewport[3]=G,this._frustumDirty=this._viewProjectionDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+
this._padding[b.PaddingSide.RIGHT]+this._padding[b.PaddingSide.LEFT]}set fullWidth(G){this.width=G-(this._padding[b.PaddingSide.RIGHT]+this._padding[b.PaddingSide.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[b.PaddingSide.TOP]+this._padding[b.PaddingSide.BOTTOM]}set fullHeight(G){this.height=G-(this._padding[b.PaddingSide.TOP]+this._padding[b.PaddingSide.BOTTOM])}get fullViewport(){this._fullViewport[0]=this._viewport[0]-this._padding[b.PaddingSide.LEFT];this._fullViewport[1]=this._viewport[1]-
this._padding[b.PaddingSide.BOTTOM];this._fullViewport[2]=this.fullWidth;this._fullViewport[3]=this.fullHeight;return this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(G){t.exactEquals(this._padding,G)||(this._viewport[0]+=G[b.PaddingSide.LEFT]-this._padding[b.PaddingSide.LEFT],this._viewport[1]+=G[b.PaddingSide.BOTTOM]-this._padding[b.PaddingSide.BOTTOM],this._viewport[2]-=G[b.PaddingSide.RIGHT]+G[b.PaddingSide.LEFT]-(this._padding[b.PaddingSide.RIGHT]+
this._padding[b.PaddingSide.LEFT]),this._viewport[3]-=G[b.PaddingSide.TOP]+G[b.PaddingSide.BOTTOM]-(this._padding[b.PaddingSide.TOP]+this._padding[b.PaddingSide.BOTTOM]),t.copy(this._padding,G),this._frustumDirty=this._viewProjectionDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){this._viewProjectionDirty&&(l.multiply(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1);return this._viewProjectionMatrix}get projectionMatrix(){var G=
this.width,O=this.height;const P=this.near*Math.tan(this.fovY/2),J=P*this._aspect;G=l.frustum(w.create(),-J*(1+2*this._padding[b.PaddingSide.LEFT]/G),J*(1+2*this._padding[b.PaddingSide.RIGHT]/G),-P*(1+2*this._padding[b.PaddingSide.BOTTOM]/O),P*(1+2*this._padding[b.PaddingSide.TOP]/O),this.near,this.far);return(O=this._get("projectionMatrix"))&&l.equals(O,G)?O:G}get inverseProjectionMatrix(){return l.invert(w.create(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||w.create()}get fov(){return this._fov}set fov(G){this._fov=
G;this._frustumDirty=this._viewProjectionDirty=!0}get fovX(){return C.fovd2fovx(this._fov,this.width,this.height)}set fovX(G){this._fov=C.fovx2fovd(G,this.width,this.height);this._frustumDirty=this._viewProjectionDirty=!0}get fovY(){return C.fovd2fovy(this._fov,this.width,this.height)}set fovY(G){this._fov=C.fovy2fovd(G,this.width,this.height);this._frustumDirty=this._viewProjectionDirty=!0}get distance(){return p.distance(this.center,this.eye)}get frustum(){this._recomputeFrustum();return this._frustum}get viewInverseTransposeMatrix(){if(this._viewInverseTransposeMatrixDirty||
this._viewDirty)l.invert(this._viewInverseTransposeMatrix,this.viewMatrix),l.transpose(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1;return this._viewInverseTransposeMatrix}depthNDCToWorld(G){return 2*this.near*this.far/(this.far+this.near-(2*G-1)*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return null!=
this.relativeElevation&&0<=this.relativeElevation}copyFrom(G){p.copy(this._ray.origin,G.eye);this.center=G.center;this.up=G.up;t.copy(this._viewport,G.viewport);this.notifyChange("_viewport");t.copy(this._padding,G.padding);this.notifyChange("_padding");v.copy(this._nearFar,G.nearFar);this.notifyChange("_nearFar");this._fov=G.fov;this.relativeElevation=G.relativeElevation;this._viewDirty=G._viewDirty;this._viewDirty||(l.copy(this._viewMatrix,G.viewMatrix),p.copy(this._viewRight,G.viewRight),p.copy(this._viewUp,
G.viewUp),p.copy(this._viewForward,G.viewForward));this._viewProjectionDirty=!0;this._frustumDirty=G._frustumDirty;this._frustumDirty||(u.copy(this._frustum,G.frustum),this._frustumDirty=!1);G._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(l.copy(this._viewInverseTransposeMatrix,G.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1);t.copy(this._fullViewport,G.fullViewport);this.pixelRatio=G.pixelRatio;return this}copyViewFrom(G){this.eye=G.eye;this.center=
G.center;this.up=G.up}clone(){return(new E).copyFrom(this)}equals(G){return p.exactEquals(this.eye,G.eye)&&p.exactEquals(this.center,G.center)&&p.exactEquals(this.up,G.up)&&t.exactEquals(this._viewport,G.viewport)&&t.exactEquals(this._padding,G.padding)&&v.exactEquals(this.nearFar,G.nearFar)&&this._fov===G.fov&&this.pixelRatio===G.pixelRatio&&this.relativeElevation===G.relativeElevation}almostEquals(G){var O=Math.max(1,1/this.pixelRatio,1/G.pixelRatio);if(.001<=Math.abs(G.fov-this._fov)||t.squaredDistance(G.screenPadding,
this.screenPadding)>=O||t.squaredDistance(this.screenViewport,G.screenViewport)>=O)return!1;p.sub(F,G.eye,G.center);p.sub(K,this.eye,this.center);O=p.dot(F,K);const P=p.sqrLen(F),J=p.sqrLen(K);return O*O>=(1-1E-10)*P*J&&p.sqrDist(G.eye,this.eye)<2.5E-7*Math.max(P,J)}computeRenderPixelSizeAt(G){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(G))}computeRenderPixelSizeAtDist(G){return G*this.perRenderPixelRatio}computeScreenPixelSizeAt(G){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(G))}_viewDirectionDistance(G){return Math.abs(z.projectPointSignedLength(this.viewForward,
p.subtract(F,G,this.eye)))}computeScreenPixelSizeAtDist(G){return G*this.perScreenPixelRatio}computeDistanceFromRadius(G,O){return G/Math.tan(Math.min(this.fovX,this.fovY)/(2*(O||1)))}getScreenCenter(G=n.createScreenPointArray()){G[0]=(this.padding[b.PaddingSide.LEFT]+this.width/2)/this.pixelRatio;G[1]=(this.padding[b.PaddingSide.TOP]+this.height/2)/this.pixelRatio;return G}getRenderCenter(G,O=.5,P=.5){G[0]=this.padding[b.PaddingSide.LEFT]+this.width*O;G[1]=this.padding[b.PaddingSide.BOTTOM]+this.height*
P;G[2]=.5;return G}setGLViewport(G){const O=this.viewport,P=this.padding;G.setViewport(O[0]-P[3],O[1]-P[2],O[2]+P[1]+P[3],O[3]+P[0]+P[2])}applyProjection(G,O){G!==B&&p.copy(B,G);B[3]=1;t.transformMat4(B,B,this.projectionMatrix);G=Math.abs(B[3]);p.scale(B,B,1/G);const P=this.fullViewport;O[0]=f.lerp(0,P[0]+P[2],.5+.5*B[0]);O[1]=f.lerp(0,P[1]+P[3],.5+.5*B[1]);O[2]=.5*(B[2]+1);O[3]=G}unapplyProjection(G,O){const P=this.fullViewport;B[0]=(G[0]/(P[0]+P[2])*2-1)*G[3];B[1]=(G[1]/(P[1]+P[3])*2-1)*G[3];B[2]=
(2*G[2]-1)*G[3];B[3]=G[3];null!=this.inverseProjectionMatrix&&(t.transformMat4(B,B,this.inverseProjectionMatrix),O[0]=B[0],O[1]=B[1],O[2]=B[2])}projectToScreen(G,O){this.projectToRenderScreen(G,L);this.renderToScreen(L,O);return O}projectToRenderScreen(G,O){B[0]=G[0];B[1]=G[1];B[2]=G[2];B[3]=1;t.transformMat4(B,B,this.viewProjectionMatrix);if(0===B[3])return null;p.scale(B,B,1/Math.abs(B[3]));G=this.fullViewport;"x"in O?(O.x=f.lerp(0,G[0]+G[2],.5+.5*B[0]),O.y=f.lerp(0,G[1]+G[3],.5+.5*B[1])):(O[0]=
f.lerp(0,G[0]+G[2],.5+.5*B[0]),O[1]=f.lerp(0,G[1]+G[3],.5+.5*B[1]),2<O.length&&(O[2]=.5*(B[2]+1)));return O}unprojectFromScreen(G,O){return this.unprojectFromRenderScreen(this.screenToRender(G,L),O)}unprojectFromRenderScreen(G,O){l.multiply(D,this.projectionMatrix,this.viewMatrix);if(!l.invert(D,D))return null;const P=this.fullViewport;B[0]=2*(G[0]-P[0])/P[2]-1;B[1]=2*(G[1]-P[1])/P[3]-1;B[2]=2*G[2]-1;B[3]=1;t.transformMat4(B,B,D);if(0===B[3])return null;O[0]=B[0]/B[3];O[1]=B[1]/B[3];O[2]=B[2]/B[3];
return O}constrainWindowSize(G,O,P,J){G*=this.pixelRatio;O*=this.pixelRatio;return[Math.round(Math.max(G-P/2,0)),Math.round(Math.max(this.fullHeight-O-J/2,0)),Math.round(P- -Math.min(G-P/2,0)- -Math.min(this.fullWidth-G-P/2,0)),Math.round(J- -Math.min(this.fullHeight-O-J/2,0)- -Math.min(O-J/2,0))]}computeUp(G){G===A.ViewingMode.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(G,O){const P=this.fullHeight-G[1]*this.pixelRatio;O[0]=G[0]*this.pixelRatio;O[1]=P;return O}renderToScreen(G,
O){const P=(this.fullHeight-G[1])/this.pixelRatio;O[0]=G[0]/this.pixelRatio;O[1]=P}_computeUpGlobal(){p.subtract(F,this.center,this.eye);const G=p.length(this.center);1>G?(p.set(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs(p.dot(F,this.center))>.9999*p.length(F)*G||(p.cross(this._up,F,this.center),p.cross(this._up,this._up,F),p.normalize(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){p.direction(F,this.eye,this.center);.9999>=Math.abs(F[2])&&
(p.scale(F,F,F[2]),p.set(this._up,-F[0],-F[1],1-F[2]),p.normalize(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(G,O,P=""){"number"===typeof G[0]&&isFinite(G[0])&&"number"===typeof G[1]&&isFinite(G[1])&&"number"===typeof G[2]&&isFinite(G[2])?p.exactEquals(G,O)||(p.copy(O,G),this._markViewDirty(),P.length&&this.notifyChange(P)):d.getLogger("esri.views.3d.webgl-engine.lib.Camera").warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewProjectionDirty=
this._frustumDirty=this._viewDirty=!0}_recomputeFrustum(){this._frustumDirty&&(u.fromMatrix(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(l.lookAt(this._viewMatrix,this.eye,this.center,this.up),p.set(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),p.set(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),p.set(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),
this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};a.__decorate([k.property()],b.Camera.prototype,"_center",void 0);a.__decorate([k.property()],b.Camera.prototype,"_up",void 0);a.__decorate([k.property()],b.Camera.prototype,"_viewport",void 0);a.__decorate([k.property()],b.Camera.prototype,"_padding",void 0);a.__decorate([k.property()],b.Camera.prototype,"_fov",void 0);a.__decorate([k.property()],b.Camera.prototype,"_nearFar",void 0);a.__decorate([k.property()],b.Camera.prototype,"_pixelRatio",
void 0);a.__decorate([k.property()],b.Camera.prototype,"pixelRatio",null);a.__decorate([k.property()],b.Camera.prototype,"eye",null);a.__decorate([k.property()],b.Camera.prototype,"center",null);a.__decorate([k.property()],b.Camera.prototype,"up",null);a.__decorate([k.property({readOnly:!0})],b.Camera.prototype,"nearFar",null);a.__decorate([k.property()],b.Camera.prototype,"near",null);a.__decorate([k.property()],b.Camera.prototype,"far",null);a.__decorate([k.property()],b.Camera.prototype,"viewport",
null);a.__decorate([k.property({readOnly:!0})],b.Camera.prototype,"screenViewport",null);a.__decorate([k.property({readOnly:!0})],b.Camera.prototype,"screenPadding",null);a.__decorate([k.property()],b.Camera.prototype,"x",null);a.__decorate([k.property()],b.Camera.prototype,"y",null);a.__decorate([k.property()],b.Camera.prototype,"width",null);a.__decorate([k.property()],b.Camera.prototype,"height",null);a.__decorate([k.property()],b.Camera.prototype,"fullWidth",null);a.__decorate([k.property()],
b.Camera.prototype,"fullHeight",null);a.__decorate([k.property({readOnly:!0})],b.Camera.prototype,"_aspect",null);a.__decorate([k.property()],b.Camera.prototype,"padding",null);a.__decorate([k.property({readOnly:!0})],b.Camera.prototype,"projectionMatrix",null);a.__decorate([k.property({readOnly:!0})],b.Camera.prototype,"inverseProjectionMatrix",null);a.__decorate([k.property()],b.Camera.prototype,"fov",null);a.__decorate([k.property()],b.Camera.prototype,"fovX",null);a.__decorate([k.property()],
b.Camera.prototype,"fovY",null);b.Camera=E=a.__decorate([m.subclass("esri.views.3d.webgl-engine.lib.Camera")],b.Camera);const B=r.create(),D=w.create(),F=h.create(),K=h.create(),L=n.createRenderScreenPointArray3();b.PaddingSide=void 0;(function(G){G[G.TOP=0]="TOP";G[G.RIGHT=1]="RIGHT";G[G.BOTTOM=2]="BOTTOM";G[G.LEFT=3]="LEFT"})(b.PaddingSide||(b.PaddingSide={}));Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/frustum":function(){define("exports ../../core/ObjectStack ../../chunks/mat4 ../../chunks/vec3 ../../chunks/vec3f64 ../../chunks/vec4 ../../chunks/vec4f64 ./clipRay ./plane ./vectorStacks".split(" "),
function(b,a,c,d,f,n,k,g,q,e){function m(){return[f.create(),f.create(),f.create(),f.create(),f.create(),f.create(),f.create(),f.create()]}function l(t,r){q.fromPoints(r[b.PointIndex.FAR_BOTTOM_LEFT],r[b.PointIndex.NEAR_BOTTOM_LEFT],r[b.PointIndex.NEAR_TOP_LEFT],t[b.PlaneIndex.LEFT]);q.fromPoints(r[b.PointIndex.NEAR_BOTTOM_RIGHT],r[b.PointIndex.FAR_BOTTOM_RIGHT],r[b.PointIndex.FAR_TOP_RIGHT],t[b.PlaneIndex.RIGHT]);q.fromPoints(r[b.PointIndex.FAR_BOTTOM_LEFT],r[b.PointIndex.FAR_BOTTOM_RIGHT],r[b.PointIndex.NEAR_BOTTOM_RIGHT],
t[b.PlaneIndex.BOTTOM]);q.fromPoints(r[b.PointIndex.NEAR_TOP_LEFT],r[b.PointIndex.NEAR_TOP_RIGHT],r[b.PointIndex.FAR_TOP_RIGHT],t[b.PlaneIndex.TOP]);q.fromPoints(r[b.PointIndex.NEAR_BOTTOM_LEFT],r[b.PointIndex.NEAR_BOTTOM_RIGHT],r[b.PointIndex.NEAR_TOP_RIGHT],t[b.PlaneIndex.NEAR]);q.fromPoints(r[b.PointIndex.FAR_BOTTOM_RIGHT],r[b.PointIndex.FAR_BOTTOM_LEFT],r[b.PointIndex.FAR_TOP_LEFT],t[b.PlaneIndex.FAR])}function w(t,r){for(let u=0;6>u;u++)if(!q.clip(t[u],r))return!1;return!0}b.PlaneIndex=void 0;
(function(t){t[t.LEFT=0]="LEFT";t[t.RIGHT=1]="RIGHT";t[t.BOTTOM=2]="BOTTOM";t[t.TOP=3]="TOP";t[t.NEAR=4]="NEAR";t[t.FAR=5]="FAR"})(b.PlaneIndex||(b.PlaneIndex={}));b.PointIndex=void 0;(function(t){t[t.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT";t[t.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT";t[t.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT";t[t.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT";t[t.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT";t[t.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT";t[t.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT";t[t.FAR_TOP_LEFT=7]=
"FAR_TOP_LEFT"})(b.PointIndex||(b.PointIndex={}));const v={bottom:[b.PointIndex.FAR_BOTTOM_RIGHT,b.PointIndex.NEAR_BOTTOM_RIGHT,b.PointIndex.NEAR_BOTTOM_LEFT,b.PointIndex.FAR_BOTTOM_LEFT],near:[b.PointIndex.NEAR_BOTTOM_LEFT,b.PointIndex.NEAR_BOTTOM_RIGHT,b.PointIndex.NEAR_TOP_RIGHT,b.PointIndex.NEAR_TOP_LEFT],far:[b.PointIndex.FAR_BOTTOM_RIGHT,b.PointIndex.FAR_BOTTOM_LEFT,b.PointIndex.FAR_TOP_LEFT,b.PointIndex.FAR_TOP_RIGHT],right:[b.PointIndex.NEAR_BOTTOM_RIGHT,b.PointIndex.FAR_BOTTOM_RIGHT,b.PointIndex.FAR_TOP_RIGHT,
b.PointIndex.NEAR_TOP_RIGHT],left:[b.PointIndex.FAR_BOTTOM_LEFT,b.PointIndex.NEAR_BOTTOM_LEFT,b.PointIndex.NEAR_TOP_LEFT,b.PointIndex.FAR_TOP_LEFT],top:[b.PointIndex.FAR_TOP_LEFT,b.PointIndex.NEAR_TOP_LEFT,b.PointIndex.NEAR_TOP_RIGHT,b.PointIndex.FAR_TOP_RIGHT]},x=[k.fromValues(-1,-1,-1,1),k.fromValues(1,-1,-1,1),k.fromValues(1,1,-1,1),k.fromValues(-1,1,-1,1),k.fromValues(-1,-1,1,1),k.fromValues(1,-1,1,1),k.fromValues(1,1,1,1),k.fromValues(-1,1,1,1)],p=new a.ObjectStack(g.create),h=m();b.NumPlanes=
6;b.NumPoints=8;b.computePlanes=l;b.copy=function(t,r){for(let u=0;6>u;u++)q.copy(t[u],r[u]);return t};b.create=function(t){return t?[q.create(t[0]),q.create(t[1]),q.create(t[2]),q.create(t[3]),q.create(t[4]),q.create(t[5])]:[q.create(),q.create(),q.create(),q.create(),q.create(),q.create()]};b.createPoints=m;b.fromMatrix=function(t,r,u,y=h){t=c.multiply(e.sm4d.get(),r,t);c.invert(t,t);for(r=0;8>r;++r){const z=n.transformMat4(e.sv4d.get(),x[r],t);d.set(y[r],z[0]/z[3],z[1]/z[3],z[2]/z[3])}l(u,y)};
b.intersectClipRay=function(t,r){for(let u=0;6>u;u++)if(!q.clipInfinite(t[u],r))return!1;return!0};b.intersectsLineSegment=function(t,r,u){return w(t,g.fromLineSegmentAndDirection(r,u,p.get()))};b.intersectsPoint=function(t,r){for(let u=0;6>u;u++)if(0<q.signedDistance(t[u],r))return!1;return!0};b.intersectsRay=function(t,r){return w(t,g.fromRay(r,p.get()))};b.intersectsSphere=function(t,r){for(let u=0;6>u;u++){const y=t[u];if(y[0]*r[0]+y[1]*r[1]+y[2]*r[2]+y[3]>=r[3])return!1}return!0};b.planePointIndices=
v;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/clipRay":function(){define(["exports","../../core/ObjectStack","../../chunks/vec3","./ray"],function(b,a,c,d){function f(q){return q?{ray:d.create(q.ray),c0:q.c0,c1:q.c1}:{ray:d.create(),c0:0,c1:Number.MAX_VALUE}}function n(q,e,m,l=f()){d.copy(q,l.ray);l.c0=e;l.c1=m;return l}function k(q,e,m){return c.add(m,q.ray.origin,c.scale(m,q.ray.direction,e))}const g=new a.ObjectStack(()=>f());b.copy=function(q,e=f()){return n(q.ray,
q.c0,q.c1,e)};b.create=f;b.fromLineSegmentAndDirection=function(q,e,m=f()){const l=c.length(q.vector);d.fromValues(q.origin,e,m.ray);m.c0=0;m.c1=l;return m};b.fromRay=function(q,e=f()){d.copy(q,e.ray);e.c0=0;e.c1=Number.MAX_VALUE;return e};b.fromValues=n;b.getAt=k;b.getEnd=function(q,e){return k(q,q.c1,e)};b.getStart=function(q,e){return k(q,q.c0,e)};b.wrap=function(q,e,m){const l=g.get();l.ray=q;l.c0=e;l.c1=m;return l};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/fov":function(){define(["exports"],
function(b){b.fovd2fovx=function(a,c,d){return 2*Math.atan(c*Math.tan(.5*a)/Math.sqrt(c*c+d*d))};b.fovd2fovy=function(a,c,d){return 2*Math.atan(d*Math.tan(.5*a)/Math.sqrt(c*c+d*d))};b.fovx2fovd=function(a,c,d){return 2*Math.atan(Math.sqrt(c*c+d*d)*Math.tan(.5*a)/c)};b.fovy2fovd=function(a,c,d){return 2*Math.atan(Math.sqrt(c*c+d*d)*Math.tan(.5*a)/d)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/RenderSlot":function(){define(["exports"],function(b){b.RenderSlot=
void 0;var a=b.RenderSlot||(b.RenderSlot={});a[a.INTEGRATED_MESH=0]="INTEGRATED_MESH";a[a.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN";a[a.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL";a[a.TRANSPARENT_MATERIAL=3]="TRANSPARENT_MATERIAL";a[a.TRANSPARENT_TERRAIN=4]="TRANSPARENT_TERRAIN";a[a.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=5]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL";a[a.OCCLUDED_TERRAIN=6]="OCCLUDED_TERRAIN";a[a.OCCLUDER_MATERIAL=7]="OCCLUDER_MATERIAL";a[a.TRANSPARENT_OCCLUDER_MATERIAL=8]="TRANSPARENT_OCCLUDER_MATERIAL";
a[a.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS";a[a.ANTIALIASING=10]="ANTIALIASING";a[a.COMPOSITE=11]="COMPOSITE";a[a.BLIT=12]="BLIT";a[a.SSAO=13]="SSAO";a[a.HIGHLIGHT=14]="HIGHLIGHT";a[a.SHADOW_HIGHLIGHT=15]="SHADOW_HIGHLIGHT";a[a.ENVIRONMENT_OPAQUE=16]="ENVIRONMENT_OPAQUE";a[a.ENVIRONMENT_TRANSPARENT=17]="ENVIRONMENT_TRANSPARENT";a[a.LASERLINES=18]="LASERLINES";a[a.LASERLINES_CONTRAST_CONTROL=19]="LASERLINES_CONTRAST_CONTROL";a[a.HUD_MATERIAL=20]="HUD_MATERIAL";a[a.LABEL_MATERIAL=21]="LABEL_MATERIAL";
a[a.LINE_CALLOUTS=22]="LINE_CALLOUTS";a[a.LINE_CALLOUTS_HUD_DEPTH=23]="LINE_CALLOUTS_HUD_DEPTH";a[a.DRAPED_MATERIAL=24]="DRAPED_MATERIAL";a[a.DRAPED_WATER=25]="DRAPED_WATER";a[a.VOXEL=26]="VOXEL";a[a.MAX_SLOTS=27]="MAX_SLOTS";Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TransparencyPassType":function(){define(["exports"],function(b){b.TransparencyPassType=void 0;var a=b.TransparencyPassType||(b.TransparencyPassType={});a[a.Color=0]="Color";a[a.Alpha=
1]="Alpha";a[a.FrontFace=2]="FrontFace";a[a.NONE=3]="NONE";a[a.COUNT=4]="COUNT";Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lighting/SceneLighting":function(){define("exports ../../../../core/mathUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ./Lightsources ./SphericalHarmonics".split(" "),function(b,a,c,d,f,n){class k{constructor(){this.color=d.create();this.intensity=1}}class g{constructor(){this.direction=d.create();this.ambient=new k;this.diffuse=
new k}}class q{constructor(){this._shOrder=2;this._legacy=new g;this.noonFactor=this.globalFactor=.5;this._sphericalHarmonics=new f.SphericalHarmonicsAmbientLight;this._mainLight=new f.MainLight(d.create(),d.fromValues(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(m){n.combineLights(m,this._shOrder,this._mainLight,this._sphericalHarmonics);c.copy(this._legacy.direction,this._mainLight.direction);m=1/Math.PI;this._legacy.ambient.color[0]=
.282095*this._sphericalHarmonics.r[0]*m;this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*m;this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*m;c.scale(this._legacy.diffuse.color,this._mainLight.intensity,m);c.copy(e,this._legacy.diffuse.color);c.scale(e,e,.4*this.globalFactor);c.add(this._legacy.ambient.color,this._legacy.ambient.color,e)}copyFrom(m){this._sphericalHarmonics.r=Array.from(m.sh.r);this._sphericalHarmonics.g=Array.from(m.sh.g);this._sphericalHarmonics.b=
Array.from(m.sh.b);c.copy(this._mainLight.direction,m.mainLight.direction);c.copy(this._mainLight.intensity,m.mainLight.intensity);this._mainLight.castShadows=m.mainLight.castShadows;this._mainLight.specularStrength=m.mainLight.specularStrength;this._mainLight.environmentStrength=m.mainLight.environmentStrength;this.globalFactor=m.globalFactor;this.noonFactor=m.noonFactor}lerpLighting(m,l,w){c.lerp(this._mainLight.intensity,m.mainLight.intensity,l.mainLight.intensity,w);this._mainLight.environmentStrength=
a.lerp(m.mainLight.environmentStrength,l.mainLight.environmentStrength,w);this._mainLight.specularStrength=a.lerp(m.mainLight.specularStrength,l.mainLight.specularStrength,w);c.copy(this._mainLight.direction,l.mainLight.direction);this._mainLight.castShadows=l.mainLight.castShadows;this.globalFactor=a.lerp(m.globalFactor,l.globalFactor,w);this.noonFactor=a.lerp(m.noonFactor,l.noonFactor,w);if(m.sh.r.length===l.sh.r.length)for(let v=0;v<l.sh.r.length;v++)this._sphericalHarmonics.r[v]=a.lerp(m.sh.r[v],
l.sh.r[v],w),this._sphericalHarmonics.g[v]=a.lerp(m.sh.g[v],l.sh.g[v],w),this._sphericalHarmonics.b[v]=a.lerp(m.sh.b[v],l.sh.b[v],w);else for(m=0;m<l.sh.r.length;m++)this._sphericalHarmonics.r[m]=l.sh.r[m],this._sphericalHarmonics.g[m]=l.sh.g[m],this._sphericalHarmonics.b[m]=l.sh.b[m]}}const e=d.create();b.SceneLighting=q;b.ambientBoost=.4;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lighting/Lightsources":function(){define(["exports","../../../../chunks/vec3f64"],
function(b,a){class c{constructor(k=a.create()){this.intensity=k}}class d{constructor(k=a.create(),g=a.fromValues(.57735,.57735,.57735)){this.intensity=k;this.direction=g}}class f{constructor(k=a.create(),g=a.fromValues(.57735,.57735,.57735),q=!0,e=1,m=1){this.intensity=k;this.direction=g;this.castShadows=q;this.specularStrength=e;this.environmentStrength=m}}class n{constructor(){this.r=[0];this.g=[0];this.b=[0]}}b.AmbientLight=c;b.FillLight=d;b.MainLight=f;b.SphericalHarmonicsAmbientLight=n;Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lighting/SphericalHarmonics":function(){define("exports ../../../../core/mathUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../lib/LongVectorMath ./Lightsources".split(" "),function(b,a,c,d,f,n){function k(u){return(u+1)*(u+1)}function g(u){return a.clamp(Math.floor(Math.sqrt(u)-1),0,2)}function q(u,y,z){const A=u[0],C=u[1];u=u[2];z=z||[];z.length=k(y);0<=y&&(z[0]=.28209479177);1<=y&&(z[1]=.4886025119*A,z[2]=.4886025119*
u,z[3]=.4886025119*C);2<=y&&(z[4]=1.09254843059*A*C,z[5]=1.09254843059*C*u,z[6]=.31539156525*(3*u*u-1),z[7]=1.09254843059*A*u,z[8]=.54627421529*(A*A-C*C));return z}function e(u,y){u=k(u);y=y||{r:[],g:[],b:[]};y.r.length=y.g.length=y.b.length=u;for(let z=0;z<u;z++)y.r[z]=y.g[z]=y.b[z]=0;return y}function m(u,y){const z=g(y.r.length);for(const A of u)c.negate(t,A.direction),q(t,z,p),f.elementwiseProduct(p,r),f.scalarProduct(p,A.intensity[0],h),f.add(y.r,h),f.scalarProduct(p,A.intensity[1],h),f.add(y.g,
h),f.scalarProduct(p,A.intensity[2],h),f.add(y.b,h);return y}function l(u,y){q(t,0,p);for(const z of u)y.r[0]+=p[0]*r[0]*z.intensity[0]*4*Math.PI,y.g[0]+=p[0]*r[0]*z.intensity[1]*4*Math.PI,y.b[0]+=p[0]*r[0]*z.intensity[2]*4*Math.PI;return y}const w=[],v=[],x=[],p=[0],h=[0],t=d.create(),r=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];b.combineLights=function(u,y,z,A){e(y,A);c.set(z.intensity,0,0,0);y=!1;w.length=0;v.length=0;x.length=0;for(const C of u)C instanceof n.MainLight&&
!y?(c.copy(z.direction,C.direction),c.copy(z.intensity,C.intensity),z.specularStrength=C.specularStrength,z.environmentStrength=C.environmentStrength,z.castShadows=C.castShadows,y=!0):C instanceof n.MainLight||C instanceof n.FillLight?w.push(C):C instanceof n.AmbientLight?v.push(C):C instanceof n.SphericalHarmonicsAmbientLight&&x.push(C);m(w,A);l(v,A);for(const C of x)f.add(A.r,C.r),f.add(A.g,C.g),f.add(A.b,C.b)};b.computeCoefficients=q;b.initSHCoefficients=e;b.numberOfCoefficients=k;b.orderFromNumberOfCoefficients=
g;b.projectAmbientLights=l;b.projectFillLights=m;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/LongVectorMath":function(){define(["exports"],function(b){b.add=function(a,c,d){d=d||a;d.length=a.length;for(let f=0;f<a.length;f++)d[f]=a[f]+c[f];return d};b.dotProduct=function(a,c){let d=0;for(let f=0;f<a.length;f++)d+=a[f]*c[f];return d};b.elementwiseProduct=function(a,c,d){d=d||a;d.length=a.length;for(let f=0;f<a.length;f++)d[f]=a[f]*c[f];return d};
b.scalarProduct=function(a,c,d){d=d||a;d.length=a.length;for(let f=0;f<a.length;f++)d[f]=a[f]*c;return d};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/Fog":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/mathUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/ellipsoidUtils ./atmosphereUtils ../../../chunks/Fog.glsl ./FogTechnique ./weather ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../../webgl/enums".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r){b.Fog=class extends c{constructor(A){super(A);this._passParameters=new v.FogPassParameters;this._vao=t.createQuadVAO(A.context.renderContext.rctx,h.Pos2Tex);this._technique=new x.FogTechnique(A);A=l.getReferenceEllipsoid(A.view.spatialReference);this._planetRadius=A.radius;this._atmosphereRadius=A.radius+w.atmosphereHeight}destroy(){this._technique.release();this._vao.dispose()}set strength(A){this._passParameters.fogStrength=A}get strength(){return this._passParameters.fogStrength}render(A,
C){this._update(A,C);if(!(0>=this._passParameters.fogAmount)){var E=this._technique;if(E.compiled){var B=A.offscreenRenderingHelper;B.renderDepthDetached(()=>{this._passParameters.depthTexture=B.depthTexture;const D=A.rctx.bindTechnique(E,this._passParameters,A.bindParameters);this._renderFog(D,A)})}else this.context.requestRender()}}_renderFog(A,C){C=C.rctx;C.bindVAO(this._vao);A.assertCompatibleVertexAttributeLocations(this._vao);C.drawArrays(r.PrimitiveType.TRIANGLE_STRIP,0,4)}_update(A,C){var E=
A.bindParameters.camera;e.normalize(y,E.eye);A=Math.max(0,e.dot(y,A.bindParameters.lighting.mainLight.direction));const B=C.color;e.scale(z,B,.1);e.lerp(this._passParameters.fogColor,z,B,A);E=e.length(E.eye);this._passParameters.atmosphereC=E*E-this._atmosphereRadius*this._atmosphereRadius;this._passParameters.fogAmount=(1-d.smoothstep(.95*p.weatherHeightLimit,1*p.weatherHeightLimit,Math.abs(E-this._planetRadius)))*C.amount;this._passParameters.fogStrength=C.strength}static isSupported(A){return A.capabilities.depthTexture}};
a.__decorate([f.property({constructOnly:!0})],b.Fog.prototype,"context",void 0);a.__decorate([f.property({constructOnly:!0})],b.Fog.prototype,"view",void 0);a.__decorate([f.property({constructOnly:!0})],b.Fog.prototype,"rctx",void 0);a.__decorate([f.property({constructOnly:!0})],b.Fog.prototype,"viewingMode",void 0);b.Fog=a.__decorate([q.subclass("esri.views.3d.environment.Fog")],b.Fog);class u{constructor(){this.color=m.create();this.amount=this.strength=0}}const y=m.create(),z=m.create();b.FogParameters=
u;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Fog.glsl":function(){define("exports ./mat4 ./mat4f64 ./vec3f64 ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x){function p(){const r=new w.ShaderBuilder;r.attributes.add(x.VertexAttribute.POSITION,"vec2");r.include(f.TextureCoordinateAttribute,{textureCoordinateType:f.TextureCoordinateAttributeType.Default});r.varyings.add("worldRay","vec3");r.varyings.add("eyeDir","vec3");const {vertex:u,fragment:y}=r;u.uniforms.add(new l.Matrix4PassUniform("inverseProjectionMatrix",(z,A)=>A.camera.inverseProjectionMatrix),new l.Matrix4PassUniform("inverseViewMatrix",(z,A)=>a.invertOrIdentity(t,
A.camera.viewMatrix)));u.code.add(m.glsl`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`);y.uniforms.add(new e.FloatPassUniform("atmosphereC",z=>z.atmosphereC),new q.Float3PassUniform("cameraPosition",(z,A)=>A.camera.eye),new g.Float2PassUniform("nearFar",(z,A)=>A.camera.nearFar),new v.Texture2DPassUniform("depthTexture",z=>z.depthTexture),new e.FloatPassUniform("fogStrength",z=>z.fogStrength),new e.FloatPassUniform("fogAmount",z=>z.fogAmount),new q.Float3PassUniform("fogColor",z=>z.fogColor));r.include(k.Gamma);y.include(n.ReadLinearDepth);y.code.add(m.glsl`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`);y.code.add(m.glsl`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`);y.code.add(m.glsl`vec3 tonemapACES(vec3 x) {
return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
}
void main() {
vec3 rayDir = normalize(worldRay);
float terrainDepth = -1.0;
float depthSample = texture(depthTexture, vuv0).r;
float zNorm = 2.0 * depthSample - 1.0;
float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
if(depthSample < 1.0 && depthSample > 0.0){
vec3 cameraSpaceRay = normalize(eyeDir);
cameraSpaceRay /= cameraSpaceRay.z;
cameraSpaceRay *= linDepth;
terrainDepth = max(0.0, length(cameraSpaceRay));
}
vec4 fog = applyFog(terrainDepth, rayDir);
fragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
}`);return r}class h extends m.NoParameters{constructor(){super(...arguments);this.fogColor=d.create();this.fogStrength=4E-6;this.atmosphereC=1;this.fogAmount=0}}const t=c.create();c=Object.freeze(Object.defineProperty({__proto__:null,FogPassParameters:h,build:p},Symbol.toStringTag,{value:"Module"}));b.Fog=c;b.FogPassParameters=h;b.build=p})},"esri/views/3d/environment/FogTechnique":function(){define("require exports ../../../chunks/Fog.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(b,a,c,d,f,n,k,g,q,e){class m extends f.ShaderTechnique{constructor(l){super(l,new n.ShaderTechniqueConfiguration,()=>this.destroy())}initializeProgram(l){return new g.Program(l.rctx,m.shader.get().build(),k.Default3D)}initializePipeline(){return e.makePipelineState({blending:e.separateBlendingParams(q.BlendFactor.SRC_ALPHA,q.BlendFactor.ZERO,q.BlendFactor.ONE_MINUS_SRC_ALPHA,q.BlendFactor.ONE),colorWrite:e.defaultColorWriteParams})}}m.shader=new d.ReloadableShaderModule(c.Fog,()=>new Promise((l,
w)=>b(["./Fog.glsl"],l,w)));a.FogTechnique=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/LocalAtmosphere":function(){define("exports ../../../core/maybe ../../../chunks/mat4 ../../../chunks/mat4f64 ./AtmosphereType ../../../chunks/SimpleAtmosphere.glsl ./SimpleAtmosphereTechnique ./SimpleAtmosphereTechniqueConfiguration ./resources/SimpleAtmosphereTexture ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/GeometryUtil ../webgl-engine/lib/VertexArrayObject ../webgl-engine/lib/VertexAttribute ../../webgl/BufferObject ../../webgl/enums ../../webgl/Texture ../../webgl/TextureDescriptor ../../webgl/Util".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u){class y{constructor(C,E){this.type=f.AtmosphereType.Local;this._configuration=new g.SimpleAtmosphereTechniqueConfiguration;this._passParameters=new n.SimpleAtmospherePassParameters;this._configuration.geometry=g.SimpleAtmosphereGeometry.Cylinder;this._technique=E.techniqueRepository.acquire(k.SimpleAtmosphereTechnique,this._configuration);C=E.renderContext.rctx;this._vao=this._createVertexArrayObject(C);this._vaoCount=u.vertexCount(this._vao,"geometry");
E=new r.TextureDescriptor;E.wrapMode=h.TextureWrapMode.CLAMP_TO_EDGE;E.flipped=!0;E.width=1;E.height=512;this._passParameters.texture=new t.Texture(C,E,q.earthAtmosphereTextureSimple)}destroy(){this._passParameters.texture=a.disposeMaybe(this._passParameters.texture);this._vao.dispose();this._technique.release()}render(C){const E=C.rctx,B=E.bindTechnique(this._technique,this._passParameters,C.bindParameters);var D=z;c.copy(D,C.bindParameters.camera.viewMatrix);D[12]=0;D[13]=0;D[14]=0;D[15]=1;B.setUniformMatrix4fv("view",
z);E.bindVAO(this._vao);B.assertCompatibleVertexAttributeLocations(this._vao);E.drawArrays(h.PrimitiveType.TRIANGLES,0,this._vaoCount)}renderHaze(){return!1}_createVertexArrayObject(C){var E=w.createPolySphereData(1,2,!1);const {data:B,indices:D}=E[0][1];E=A.createBuffer(D.length);const F=E.position;for(let K=0;K<D.length;++K){const L=3*D[0===K%3?K+2:2===K%3?K-2:K];F.set(K,0,B[L]);F.set(K,1,B[L+1]);F.set(K,2,B[L+2])}return new v.VertexArrayObject(C,l.Default3D,{geometry:e.glLayout(A)},{geometry:p.BufferObject.createVertex(C,
h.Usage.STATIC_DRAW,E.buffer)})}}const z=d.create(),A=m.newLayout().vec3f(x.VertexAttribute.POSITION);b.LocalAtmosphere=y;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/SimpleAtmosphere.glsl":function(){define("exports ./vec2f64 ./vec3f64 ../views/3d/environment/SimpleAtmosphereTechniqueConfiguration ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v){function x(r){const u=new l.ShaderBuilder,{vertex:y,fragment:z}=u;n.addMainLightDirection(y);r.geometry===d.SimpleAtmosphereGeometry.Underground?(u.attributes.add(v.VertexAttribute.POSITION,"vec2"),u.varyings.add("color","vec4"),y.uniforms.add(new g.Float3PassUniform("cameraPosition",(A,C)=>C.camera.eye),new q.FloatPassUniform("undergroundFadeAlpha",A=>A.undergroundFadeAlpha)),y.code.add(e.glsl`void main(void) {
float ndotl = dot(normalize(cameraPosition), mainLightDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),z.code.add(e.glsl`void main() {
fragColor = color;
}`)):(u.include(f.Transform,r),u.attributes.add(v.VertexAttribute.POSITION,"vec3"),u.varyings.add("vtc","vec2"),u.varyings.add("falloff","float"),r=r.geometry===d.SimpleAtmosphereGeometry.Cylinder,y.uniforms.add(new m.Matrix4PassUniform("proj",(A,C)=>C.camera.projectionMatrix),new m.Matrix4PassUniform("view",(A,C)=>C.camera.viewMatrix)),r||(u.varyings.add("innerFactor","float"),y.uniforms.add(new g.Float3PassUniform("silCircleCenter",A=>A.silhouette.center)),y.uniforms.add(new g.Float3PassUniform("silCircleV1",
A=>A.silhouette.v1)),y.uniforms.add(new g.Float3PassUniform("silCircleV2",A=>A.silhouette.v2)),y.uniforms.add(new k.Float2PassUniform("texV",A=>A.texV)),y.uniforms.add(new q.FloatPassUniform("innerScale",A=>A.innerScale))),y.code.add(e.glsl`
		void main(void) {
      ${r?e.glsl`
      vec3 pos = position;
      float ndotl = mainLightDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:e.glsl`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${e.glsl.float(.04908738515625)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), mainLightDirection);
      vtc.x = position.x  * ${e.glsl.float(.0078125)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),z.uniforms.add(new w.Texture2DPassUniform("tex",A=>A.texture)),r||z.uniforms.add(new q.FloatPassUniform("altitudeFade",A=>A.altitudeFade)),z.code.add(e.glsl`
		void main() {
			vec4 atmosphereColor = texture(tex, vtc) * falloff;
      ${r?e.glsl`fragColor = atmosphereColor;`:e.glsl`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			fragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`));return u}class p extends e.NoParameters{constructor(){super(...arguments);this.texV=a.create();this.undergroundFadeAlpha=this.innerScale=this.altitudeFade=0;this.silhouette=new h}}class h{constructor(){this.center=c.create();this.v1=c.create();this.v2=c.create()}}const t=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:h,SimpleAtmospherePassParameters:p,build:x},Symbol.toStringTag,{value:"Module"}));b.SilhouetteCircle=h;b.SimpleAtmosphere=t;b.SimpleAtmospherePassParameters=
p;b.build=x})},"esri/views/3d/environment/SimpleAtmosphereTechniqueConfiguration":function(){define(["exports","../../../chunks/tslib.es6","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration","../webgl-engine/materials/DefaultTechniqueConfiguration"],function(b,a,c,d){b.SimpleAtmosphereGeometry=void 0;(function(n){n[n.Cone=0]="Cone";n[n.Cylinder=1]="Cylinder";n[n.Underground=2]="Underground";n[n.COUNT=3]="COUNT"})(b.SimpleAtmosphereGeometry||(b.SimpleAtmosphereGeometry={}));class f extends d.DefaultTechniqueConfiguration{constructor(){super(...arguments);
this.geometry=b.SimpleAtmosphereGeometry.Cone}}a.__decorate([c.parameter({count:b.SimpleAtmosphereGeometry.COUNT})],f.prototype,"geometry",void 0);b.SimpleAtmosphereTechniqueConfiguration=f;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/DefaultTechniqueConfiguration":function(){define(["exports","../../../../chunks/tslib.es6","../core/shaderLibrary/attributes/InstancedDoublePrecision.glsl","../core/shaderTechnique/BindType","../core/shaderTechnique/ShaderTechniqueConfiguration"],
function(b,a,c,d,f){class n extends c.InstancedDoubleConfiguration{}a.__decorate([f.parameter({constValue:!0})],n.prototype,"hasSliceHighlight",void 0);a.__decorate([f.parameter({constValue:!1})],n.prototype,"hasSliceInVertexProgram",void 0);a.__decorate([f.parameter({constValue:d.BindType.Pass})],n.prototype,"pbrTextureBindType",void 0);b.DefaultTechniqueConfiguration=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl":function(){define("exports ../../../../../../chunks/tslib.es6 ../../../../../../chunks/mat3 ../../../../../../chunks/mat3f64 ../../../../../../chunks/mat4f64 ../../../../../../chunks/vec3 ../../../../../../chunks/vec3f64 ../ShaderOutput ../util/DoublePrecision.glsl ../util/View.glsl ../../shaderModules/Float3DrawUniform ../../shaderModules/interfaces ../../shaderModules/Matrix3PassUniform ../../shaderModules/Matrix4PassUniform ../../shaderTechnique/ShaderTechniqueConfiguration ../../../lib/VertexAttribute ../../../../../webgl/doublePrecisionUtils".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h){class t extends x.ShaderTechniqueConfiguration{constructor(){super(...arguments);this.hasModelTransformation=this.instancedDoublePrecision=!1}}a.__decorate([x.parameter()],t.prototype,"instancedDoublePrecision",void 0);a.__decorate([x.parameter()],t.prototype,"hasModelTransformation",void 0);class r extends l.NoParameters{constructor(){super(...arguments);this.modelTransformation=null}}const u=d.create(),y=k.create();b.InstancedDoubleConfiguration=t;b.InstancedDoublePassParameters=
r;b.InstancedDoublePrecision=function(z,A){const C=A.hasModelTransformation,E=A.instancedDoublePrecision;C&&(z.vertex.uniforms.add(new v.Matrix4PassUniform("model",B=>B.modelTransformation??f.IDENTITY)),z.vertex.uniforms.add(new w.Matrix3PassUniform("normalLocalOriginFromModel",B=>{c.normalFromMat4(u,B.modelTransformation??f.IDENTITY);return u})));A.instanced&&E&&(z.attributes.add(p.VertexAttribute.INSTANCEMODELORIGINHI,"vec3"),z.attributes.add(p.VertexAttribute.INSTANCEMODELORIGINLO,"vec3"),z.attributes.add(p.VertexAttribute.INSTANCEMODEL,
"mat3"),z.attributes.add(p.VertexAttribute.INSTANCEMODELNORMAL,"mat3"));z=z.vertex;E&&(z.include(q.DoublePrecision,A),z.uniforms.add(new m.Float3DrawUniform("viewOriginHi",(B,D)=>h.encodeDoubleHi(n.set(y,D.camera.viewInverseTransposeMatrix[3],D.camera.viewInverseTransposeMatrix[7],D.camera.viewInverseTransposeMatrix[11]),y)),new m.Float3DrawUniform("viewOriginLo",(B,D)=>h.encodeDoubleLo(n.set(y,D.camera.viewInverseTransposeMatrix[3],D.camera.viewInverseTransposeMatrix[7],D.camera.viewInverseTransposeMatrix[11]),
y))));z.code.add(l.glsl`
    vec3 getVertexInLocalOriginSpace() {
      return ${C?E?"(model * vec4(instanceModel * localPosition().xyz, 1.0)).xyz":"(model * localPosition()).xyz":E?"instanceModel * localPosition().xyz":"localPosition().xyz"};
    }

    vec3 subtractOrigin(vec3 _pos) {
      ${E?l.glsl`
          // Negated inputs are intentionally the first two arguments. The other way around the obfuscation in dpAdd() stopped
          // working for macOS 14+ and iOS 17+.
          // Issue: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/56280
          vec3 originDelta = dpAdd(-instanceModelOriginHi, -instanceModelOriginLo, viewOriginHi, viewOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `);z.code.add(l.glsl`
    vec3 dpNormal(vec4 _normal) {
      return normalize(${C?E?"normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz)":"normalLocalOriginFromModel * _normal.xyz":E?"instanceModelNormal * _normal.xyz":"_normal.xyz"});
    }
    `);A.output===g.ShaderOutput.Normal&&(e.addViewNormal(z),z.code.add(l.glsl`
    vec3 dpNormalView(vec4 _normal) {
      return normalize((viewNormal * ${C?E?"vec4(normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz), 1.0)":"vec4(normalLocalOriginFromModel * _normal.xyz, 1.0)":E?"vec4(instanceModelNormal * _normal.xyz, 1.0)":"_normal"}).xyz);
    }
    `));A.hasVertexTangents&&z.code.add(l.glsl`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${C?E?"return vec4(normalLocalOriginFromModel * (instanceModelNormal * _tangent.xyz), _tangent.w);":"return vec4(normalLocalOriginFromModel * _tangent.xyz, _tangent.w);":E?"return vec4(instanceModelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}
    }`)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/ShaderOutput":function(){define(["exports"],function(b){b.ShaderOutput=void 0;var a=b.ShaderOutput||(b.ShaderOutput={});a[a.Color=0]="Color";a[a.Depth=1]="Depth";a[a.Normal=2]="Normal";a[a.Shadow=3]="Shadow";a[a.ShadowHighlight=4]="ShadowHighlight";a[a.ShadowExcludeHighlight=5]="ShadowExcludeHighlight";a[a.Highlight=6]="Highlight";a[a.Alpha=7]="Alpha";a[a.ObjectAndLayerIdColor=8]=
"ObjectAndLayerIdColor";a[a.CompositeColor=9]="CompositeColor";a[a.COUNT=10]="COUNT";Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/DoublePrecision.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(b,a){b.DoublePrecision=function({code:c},d){d.doublePrecisionRequiresObfuscation?c.add(a.glsl`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):c.add(a.glsl`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/View.glsl":function(){define("exports ../../../../../../chunks/mat4 ../../../../../../chunks/mat4f64 ../../../../../../chunks/vec3 ../../../../../../chunks/vec3f64 ../../shaderModules/Float3DrawUniform ../../shaderModules/Float3PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/Matrix4DrawUniform ../../shaderModules/Matrix4PassUniform".split(" "),function(b,a,
c,d,f,n,k,g,q,e){const m=c.create(),l=f.create();b.addCameraPosition=function(w,v){v.instancedDoublePrecision?w.constants.add("cameraPosition","vec3",f.ZEROS):w.uniforms.add(new n.Float3DrawUniform("cameraPosition",(x,p)=>d.set(l,p.camera.viewInverseTransposeMatrix[3]-x.origin[0],p.camera.viewInverseTransposeMatrix[7]-x.origin[1],p.camera.viewInverseTransposeMatrix[11]-x.origin[2])))};b.addPixelRatio=function(w){w.uniforms.add(new g.FloatPassUniform("pixelRatio",(v,x)=>x.camera.pixelRatio/x.overlayStretch))};
b.addProjViewLocalOrigin=function(w,v){v.instancedDoublePrecision?w.uniforms.add(new e.Matrix4PassUniform("proj",(x,p)=>p.camera.projectionMatrix),new e.Matrix4PassUniform("view",(x,p)=>a.translate(m,p.camera.viewMatrix,d.set(l,p.camera.viewInverseTransposeMatrix[3],p.camera.viewInverseTransposeMatrix[7],p.camera.viewInverseTransposeMatrix[11]))),new k.Float3PassUniform("localOrigin",(x,p)=>d.set(l,p.camera.viewInverseTransposeMatrix[3],p.camera.viewInverseTransposeMatrix[7],p.camera.viewInverseTransposeMatrix[11]))):
w.uniforms.add(new e.Matrix4PassUniform("proj",(x,p)=>p.camera.projectionMatrix),new q.Matrix4DrawUniform("view",(x,p)=>a.translate(m,p.camera.viewMatrix,x.origin)),new n.Float3DrawUniform("localOrigin",x=>x.origin))};b.addViewNormal=function(w){w.uniforms.add(new e.Matrix4PassUniform("viewNormal",(v,x)=>x.camera.viewInverseTransposeMatrix))};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix4DrawUniform":function(){define(["exports",
"./Uniform","../shaderTechnique/BindType"],function(b,a,c){class d extends a.Uniform{constructor(f,n){super(f,"mat4",c.BindType.Draw,(k,g,q)=>k.setUniformMatrix4fv(f,n(g,q)))}}b.Matrix4DrawUniform=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix3PassUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(b,a,c){class d extends a.Uniform{constructor(f,n){super(f,"mat3",c.BindType.Pass,(k,g,q)=>
k.setUniformMatrix3fv(f,n(g,q)))}}b.Matrix3PassUniform=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/doublePrecisionUtils":function(){define(["exports"],function(b){const a=new Float32Array(2);b.decodeDoubleArray=function(c,d,f){for(let n=0;n<f;++n)d[n]=c[2*n]+c[2*n+1]};b.encodeDoubleArray=function(c,d,f){for(let n=0;n<f;++n)d[2*n]=c[n],d[2*n+1]=c[n]-d[2*n]};b.encodeDoubleHi=function(c,d){const f=c.length;for(let n=0;n<f;++n)a[0]=c[n],d[n]=a[0];return d};b.encodeDoubleLo=
function(c,d){const f=c.length;for(let n=0;n<f;++n)a[0]=c[n],a[1]=c[n]-a[0],d[n]=a[1];return d};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/Transform.glsl":function(){define(["exports","./ForwardLinearDepth.glsl","../shaderModules/interfaces"],function(b,a,c){b.Transform=function(d){a.addCalculateLinearDepth(d);d.vertex.code.add(c.glsl`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`);d.vertex.code.add(c.glsl`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl":function(){define(["exports","./ShaderOutput","./attributes/VertexPosition.glsl","../shaderModules/Float2PassUniform","../shaderModules/interfaces"],function(b,a,c,d,f){function n(q){q.varyings.add("linearDepth","float")}function k(q){q.vertex.uniforms.add(new d.Float2PassUniform("nearFar",(e,m)=>m.camera.nearFar))}function g(q){q.vertex.code.add(f.glsl`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}b.ForwardLinearDepth=function(q,e){const {vertex:m}=q;switch(e.output){case a.ShaderOutput.Color:if(e.receiveShadows){n(q);m.code.add(f.glsl`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);return}break;case a.ShaderOutput.Depth:case a.ShaderOutput.Shadow:case a.ShaderOutput.ShadowHighlight:case a.ShaderOutput.ShadowExcludeHighlight:q.include(c.VertexPosition,e);n(q);k(q);g(q);m.code.add(f.glsl`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`);return}m.code.add(f.glsl`void forwardLinearDepth() {}`)};b.addCalculateLinearDepth=g;b.addLinearDepth=n;b.addNearFar=k;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexPosition.glsl":function(){define("exports ../../../../../../chunks/mat3f64 ../../../../../../chunks/mat4f64 ../../../../../../chunks/vec3f64 ./PositionAttribute.glsl ../util/DoublePrecision.glsl ../../shaderModules/Float3DrawUniform ../../shaderModules/Float3PassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix3DrawUniform ../../shaderModules/Matrix3PassUniform ../../shaderModules/Matrix4PassUniform".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l){class w extends q.NoParameters{constructor(){super(...arguments);this.transformWorldFromViewTH=d.create();this.transformWorldFromViewTL=d.create();this.transformViewFromCameraRelativeRS=a.create();this.transformProjFromView=c.create()}}class v extends q.NoParameters{constructor(){super(...arguments);this.transformWorldFromModelRS=a.create();this.transformWorldFromModelTH=d.create();this.transformWorldFromModelTL=d.create()}}b.VertexPosition=function(x,p){x.include(f.PositionAttribute);
const h=x.vertex;h.include(n.DoublePrecision,p);x.varyings.add("vPositionWorldCameraRelative","vec3");x.varyings.add("vPosition_view","vec3");h.uniforms.add(new g.Float3PassUniform("transformWorldFromViewTH",t=>t.transformWorldFromViewTH),new g.Float3PassUniform("transformWorldFromViewTL",t=>t.transformWorldFromViewTL),new m.Matrix3PassUniform("transformViewFromCameraRelativeRS",t=>t.transformViewFromCameraRelativeRS),new l.Matrix4PassUniform("transformProjFromView",t=>t.transformProjFromView),new e.Matrix3DrawUniform("transformWorldFromModelRS",
t=>t.transformWorldFromModelRS),new k.Float3DrawUniform("transformWorldFromModelTH",t=>t.transformWorldFromModelTH),new k.Float3DrawUniform("transformWorldFromModelTL",t=>t.transformWorldFromModelTL));h.code.add(q.glsl`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`);h.code.add(q.glsl`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${p.spherical?q.glsl`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:q.glsl`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `);x.fragment.uniforms.add(new g.Float3PassUniform("transformWorldFromViewTL",t=>t.transformWorldFromViewTL));h.code.add(q.glsl`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`);x.fragment.code.add(q.glsl`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)};b.VertexPositionDrawParameters=v;b.VertexPositionPassParameters=w;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl":function(){define(["exports","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(b,a,c){b.PositionAttribute=function(d){d.attributes.add(c.VertexAttribute.POSITION,"vec3");d.vertex.code.add(a.glsl`vec3 positionModel() { return position; }`)};Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/SimpleAtmosphereTechnique":function(){define("require exports ../../../chunks/SimpleAtmosphere.glsl ./SimpleAtmosphereTechniqueConfiguration ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),function(b,a,c,d,f,n,k,g,q,e){class m extends n.ShaderTechnique{initializeProgram(l){return new g.Program(l.rctx,
m.shader.get().build(this.configuration),k.Default3D)}initializePipeline(){return this.configuration.geometry===d.SimpleAtmosphereGeometry.Cylinder?e.makePipelineState({blending:e.separateBlendingParams(q.BlendFactor.SRC_ALPHA,q.BlendFactor.ONE,q.BlendFactor.ONE_MINUS_SRC_ALPHA,q.BlendFactor.ONE_MINUS_SRC_ALPHA),culling:e.backFaceCullingParams,depthTest:{func:q.CompareFunction.LEQUAL},colorWrite:e.defaultColorWriteParams}):e.makePipelineState({blending:e.separateBlendingParams(q.BlendFactor.SRC_ALPHA,
q.BlendFactor.ONE,q.BlendFactor.ONE_MINUS_SRC_ALPHA,q.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:q.CompareFunction.LEQUAL},colorWrite:e.defaultColorWriteParams})}}m.shader=new f.ReloadableShaderModule(c.SimpleAtmosphere,()=>new Promise((l,w)=>b(["./SimpleAtmosphere.glsl"],l,w)));a.SimpleAtmosphereTechnique=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/resources/SimpleAtmosphereTexture":function(){define(["exports"],function(b){const a=new Uint8ClampedArray([0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,
12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,16,0,0,16,16,0,0,16,16,0,0,16,16,0,0,16,15,0,0,17,15,0,0,17,15,0,0,17,15,0,0,17,14,0,0,18,14,0,0,18,14,0,0,18,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,20,13,0,0,20,13,0,0,20,13,0,0,20,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,22,12,0,0,22,12,0,0,22,12,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,
0,0,25,10,0,0,26,10,0,0,26,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,27,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,29,18,0,0,29,18,0,0,29,17,0,0,30,17,0,0,30,17,0,0,30,17,0,0,30,16,0,0,31,16,0,0,31,16,0,0,31,16,0,0,32,16,0,0,32,16,0,0,32,15,0,0,33,15,0,0,33,15,0,0,33,15,0,0,34,15,8,0,34,15,8,0,34,15,8,0,34,15,7,0,35,15,7,0,35,15,7,0,35,21,7,0,36,21,7,0,36,21,7,0,36,21,7,0,37,21,7,0,37,21,7,0,37,20,7,0,38,20,7,0,38,20,7,0,38,20,7,0,39,20,7,0,39,20,7,0,39,20,7,0,39,19,6,0,40,19,6,0,40,19,6,0,
40,19,6,0,41,19,6,0,41,19,6,0,41,18,6,0,42,18,6,0,42,18,6,0,42,24,6,0,43,24,6,0,43,24,6,0,43,23,6,0,44,23,6,0,44,23,6,0,44,23,6,0,45,23,6,0,45,23,6,0,45,22,6,0,46,22,6,0,46,22,6,0,46,22,5,0,47,22,5,0,47,22,5,0,47,21,5,0,48,21,5,0,48,21,5,0,48,21,5,0,49,21,5,0,49,26,5,0,49,25,5,0,50,25,5,0,50,25,5,0,50,25,5,0,51,25,5,0,51,25,5,0,51,25,5,0,52,25,5,0,52,25,5,0,52,24,5,0,53,24,5,0,53,24,5,0,53,24,9,0,54,28,9,0,54,28,9,0,54,28,9,0,55,28,9,0,55,27,9,0,56,27,9,0,56,27,9,0,56,27,9,4,57,27,9,4,57,27,9,4,57,
26,9,4,58,26,9,4,58,26,9,4,58,26,9,4,59,26,9,4,59,26,9,4,59,26,8,4,60,30,8,4,60,30,8,4,60,29,8,4,61,29,8,4,61,29,8,4,62,29,8,4,62,29,8,4,62,28,8,4,63,28,8,4,63,28,8,4,63,28,12,4,64,28,12,4,64,28,12,4,64,27,12,4,65,27,12,8,65,27,12,8,65,31,12,8,66,31,12,8,66,30,11,8,67,30,11,8,67,30,11,8,67,30,11,8,68,30,11,8,68,30,11,8,68,30,15,7,69,30,15,7,69,30,15,7,69,33,15,11,70,33,15,11,70,32,14,11,71,32,14,11,71,32,14,11,71,32,18,14,72,32,18,14,72,32,18,14,72,31,17,14,73,35,17,14,73,34,17,17,74,34,21,17,74,
34,21,17,74,34,20,17,75,34,20,20,75,34,20,20,75,34,23,20,76,34,23,20,76,36,23,23,77,36,23,23,77,36,23,23,77,36,23,23,78,36,26,26,78,36,26,26,78,36,26,26,79,36,26,29,79,38,26,29,80,38,29,29,80,38,29,29,80,38,28,31,81,38,28,31,81,38,31,31,81,37,31,34,82,37,31,34,82,37,31,37,83,40,34,37,83,40,34,37,83,39,33,39,84,39,33,39,84,39,36,42,84,39,36,42,85,39,36,42,85,39,36,42,85,39,39,44,86,39,39,44,86,41,38,47,87,41,41,47,87,41,41,50,87,41,41,49,88,41,41,52,88,40,43,52,89,43,43,52,89,43,43,54,89,42,45,54,
90,42,45,57,90,42,45,57,90,42,45,59,91,42,48,59,91,44,47,61,92,44,47,61,92,44,50,61,92,44,49,63,93,44,49,63,93,44,52,66,93,43,52,65,94,46,54,68,94,46,54,70,95,46,54,70,95,46,54,70,95,45,56,72,96,45,56,72,96,45,58,74,97,47,58,76,97,47,58,76,97,47,60,78,98,47,60,78,98,47,60,81,98,49,62,80,99,49,62,82,99,48,61,84,100,48,64,84,100,48,64,84,100,50,63,86,101,50,66,86,101,50,66,88,101,50,65,90,102,52,67,89,103,51,69,91,104,51,68,92,105,52,69,93,107,52,71,94,108,54,70,96,109,53,71,96,111,52,73,98,112,54,
72,98,114,53,73,100,115,54,72,100,117,54,73,102,118,55,74,104,120,55,76,105,121,56,77,106,123,56,76,107,124,57,79,107,126,58,78,110,128,57,79,111,129,56,80,113,131,58,79,112,132,57,82,114,134,58,81,116,136,60,82,117,137,59,83,117,139,60,83,119,141,59,84,120,142,60,85,122,144,59,86,122,146,60,86,126,148,62,87,127,149,61,88,127,151,62,88,128,153,63,89,130,155,62,90,131,156,63,90,132,158,64,91,134,160,65,91,135,162,64,92,136,163,63,93,138,165,66,95,139,167,65,95,140,169,66,95,142,171,67,96,142,172,66,
97,144,174,67,99,145,176,67,97,148,178,67,99,147,180,68,100,149,181,68,100,150,183,69,101,152,185,70,102,153,187,71,103,155,188,70,103,156,190,70,104,157,192,71,105,158,194,71,106,160,195,72,106,161,197,72,108,161,199,73,108,163,200,73,109,164,202,74,109,165,204,74,110,167,206,75,111,168,207,74,112,170,209,75,112,170,210,76,113,171,212,76,114,173,214,77,115,174,215,78,115,175,217,78,116,175,218,78,117,177,220,78,118,178,221,79,118,180,223,80,120,180,224,81,120,181,226,81,120,182,227,82,121,184,229,
82,122,185,230,84,123,186,232,83,123,187,233,84,124,189,234,84,125,188,235,85,126,189,237,86,126,190,238,86,127,191,239,87,127,192,240,87,129,193,242,88,129,194,243,89,130,195,244,90,131,196,245,90,132,197,246,91,132,197,247,92,133,198,248,92,134,199,249,93,135,200,250,94,136,201,251,95,137,202,252,96,138,203,253,97,140,204,254,98,141,205,254,99,142,206,255,101,143,207,255,102,144,208,255,103,146,209,255,104,147,209,255,106,148,210,255,107,149,211,255,108,151,212,255,110,152,213,255,111,153,213,255,
112,154,214,255,114,156,215,255,115,157,215,255,117,158,216,255,118,160,217,255,120,161,217,255,121,162,218,255,123,164,218,255,124,165,219,255,125,166,219,255,127,167,220,255,129,169,220,255,130,170,221,255,132,171,221,255,133,173,222,255,134,174,222,255,136,175,223,255,139,178,224,255,142,180,224,255,144,182,225,255,147,185,226,255,150,187,226,255,153,189,227,255,155,191,228,255,158,194,228,255,160,196,229,255,163,198,229,255,165,200,230,255,168,202,231,255,170,203,231,255,172,205,232,255,174,207,
232,255,176,209,233,255,178,210,234,255,180,212,234,255,182,214,235,255,184,215,236,255,186,217,237,255,188,219,238,255,190,220,238,255,192,221,239,255,193,222,240,255,194,224,240,255,196,225,241,255,197,226,241,255,198,226,242,255,199,227,242,255,200,228,242,255,201,228,243,255,202,229,243,255,203,230,243,255,204,230,244,255,205,231,244,255,207,232,244,255,208,233,245,255,209,233,245,255,211,234,246,255,213,235,246,255,217,238,247,255,222,240,248,255,226,242,249,255,231,245,250,255,236,247,251,255,
241,249,252,255,245,251,253,255,249,252,254,255,255,255,255,255]);b.earthAtmosphereTextureSimple=a;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/buffer/glUtil":function(){define(["exports","../../../webgl/enums","../../../webgl/VertexElementDescriptor"],function(b,a,c){const d={u8:a.DataType.UNSIGNED_BYTE,u16:a.DataType.UNSIGNED_SHORT,u32:a.DataType.UNSIGNED_INT,i8:a.DataType.BYTE,i16:a.DataType.SHORT,i32:a.DataType.INT,f32:a.DataType.FLOAT};b.glLayout=function(f,
n=0){const k=f.stride;return Array.from(f.fields.keys()).map(g=>{const q=f.fields.get(g),e=q.constructor.ElementCount;var m=d[q.constructor.ElementType];if(!m)throw Error("BufferType not supported in WebGL");return new c.VertexElementDescriptor(g,e,m,q.offset,k,!(!q.optional||!q.optional.glNormalized),n)})};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/buffer/InterleavedLayout":function(){define(["exports","../../../../geometry/support/buffer/BufferView","../../../../geometry/support/buffer/types",
"../../webgl-engine/lib/Util"],function(b,a,c,d){class f{constructor(e,m){this.layout=e;this.buffer="number"===typeof m?new ArrayBuffer(m*e.stride):m;for(const l of e.fields.keys())m=e.fields.get(l),this[l]=new m.constructor(this.buffer,m.offset,this.stride)}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(e,m){return(e=this[e])&&e.elementCount===m.ElementCount&&e.elementType===m.ElementType?e:null}slice(e,
m){return new f(this.layout,this.buffer.slice(e*this.stride,m*this.stride))}copyFrom(e,m=0,l=0,w=e.count){const v=this.stride;0===v%4?(e=new Uint32Array(e.buffer,m*v,w*v/4),(new Uint32Array(this.buffer,l*v,w*v/4)).set(e)):(e=new Uint8Array(e.buffer,m*v,w*v),(new Uint8Array(this.buffer,l*v,w*v)).set(e));return this}get usedMemory(){return this.byteLength}dispose(){}}class n{constructor(e=null){this._lastAligned=this._stride=0;this._fields=new Map;e&&(this._stride=e.stride,e.fields.forEach(m=>this._fields.set(m[0],
{...m[1],constructor:q.get(m[1].constructor)})))}vec2f(e,m){this._appendField(e,a.BufferViewVec2f,m);return this}vec2f64(e,m){this._appendField(e,a.BufferViewVec2f64,m);return this}vec3f(e,m){this._appendField(e,a.BufferViewVec3f,m);return this}vec3f64(e,m){this._appendField(e,a.BufferViewVec3f64,m);return this}vec4f(e,m){this._appendField(e,a.BufferViewVec4f,m);return this}vec4f64(e,m){this._appendField(e,a.BufferViewVec4f64,m);return this}mat3f(e,m){this._appendField(e,a.BufferViewMat3f,m);return this}mat3f64(e,
m){this._appendField(e,a.BufferViewMat3f64,m);return this}mat4f(e,m){this._appendField(e,a.BufferViewMat4f,m);return this}mat4f64(e,m){this._appendField(e,a.BufferViewMat4f64,m);return this}vec4u8(e,m){this._appendField(e,a.BufferViewVec4u8,m);return this}f32(e,m){this._appendField(e,a.BufferViewFloat,m);return this}f64(e,m){this._appendField(e,a.BufferViewFloat64,m);return this}u8(e,m){this._appendField(e,a.BufferViewUint8,m);return this}u16(e,m){this._appendField(e,a.BufferViewUint16,m);return this}i8(e,
m){this._appendField(e,a.BufferViewInt8,m);return this}vec2i8(e,m){this._appendField(e,a.BufferViewVec2i8,m);return this}vec2i16(e,m){this._appendField(e,a.BufferViewVec2i16,m);return this}vec2u8(e,m){this._appendField(e,a.BufferViewVec2u8,m);return this}vec4u16(e,m){this._appendField(e,a.BufferViewVec4u16,m);return this}u32(e,m){this._appendField(e,a.BufferViewUint32,m);return this}_appendField(e,m,l){if(this._fields.has(e))d.assert(!1,`${e} already added to vertex buffer layout`);else{var w=m.ElementCount*
c.elementTypeSize(m.ElementType),v=this._stride;this._stride+=w;this._fields.set(e,{size:w,constructor:m,offset:v,optional:l})}}createBuffer(e){return new f(this,e)}createView(e){return new f(this,e)}clone(){const e=new n;e._stride=this._stride;e._fields=new Map;this._fields.forEach((m,l)=>e._fields.set(l,m));e.BufferType=this.BufferType;return e}get stride(){if(this._lastAligned!==this._fields.size){let e=1;this._fields.forEach(m=>e=Math.max(e,c.elementTypeSize(m.constructor.ElementType)));this._stride=
Math.floor((this._stride+e-1)/e)*e;this._lastAligned=this._fields.size}return this._stride}get fields(){return this._fields}}class k{constructor(e){this.fields=[];e.fields.forEach((m,l)=>{var w=m.constructor;this.fields.push([l,{...m,constructor:`${w.ElementType}_${w.ElementCount}`}])});this.stride=e.stride}}const g=[a.BufferViewFloat,a.BufferViewVec2f,a.BufferViewVec3f,a.BufferViewVec4f,a.BufferViewMat3f,a.BufferViewMat4f,a.BufferViewFloat64,a.BufferViewVec2f64,a.BufferViewVec3f64,a.BufferViewVec4f64,
a.BufferViewMat3f64,a.BufferViewMat4f64,a.BufferViewUint8,a.BufferViewVec2u8,a.BufferViewVec3u8,a.BufferViewVec4u8,a.BufferViewUint16,a.BufferViewVec2u16,a.BufferViewVec3u16,a.BufferViewVec4u16,a.BufferViewUint32,a.BufferViewVec2u32,a.BufferViewVec3u32,a.BufferViewVec4u32,a.BufferViewInt8,a.BufferViewVec2i8,a.BufferViewVec3i8,a.BufferViewVec4i8,a.BufferViewInt16,a.BufferViewVec2i16,a.BufferViewVec3i16,a.BufferViewVec4i16,a.BufferViewInt32,a.BufferViewVec2i32,a.BufferViewVec3i32,a.BufferViewVec4i32],
q=new Map;g.forEach(e=>q.set(`${e.ElementType}_${e.ElementCount}`,e));b.InterleavedBuffer=f;b.InterleavedLayout=n;b.PackedLayout=k;b.newLayout=function(){return new n};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/BufferView":function(){define("exports ./internals/Mat3 ./internals/Mat4 ./internals/Scalar ./internals/Vec2 ./internals/Vec3 ./internals/Vec4".split(" "),function(b,a,c,d,f,n,k){class g extends d.BufferViewScalarImpl{constructor(I,Q=0,N,T){super(Float32Array,
I,Q,N,T);this.elementType="f32"}static fromTypedArray(I,Q){return new g(I.buffer,I.byteOffset,Q,I.byteOffset+I.byteLength)}}g.ElementType="f32";class q extends f.BufferViewVec2Impl{constructor(I,Q=0,N,T){super(Float32Array,I,Q,N,T);this.elementType="f32"}slice(I,Q){return this.sliceBuffer(q,I,Q)}static fromTypedArray(I,Q){return new q(I.buffer,I.byteOffset,Q,I.byteOffset+I.byteLength)}}q.ElementType="f32";class e extends n.BufferViewVec3Impl{constructor(I,Q=0,N,T){super(Float32Array,I,Q,N,T);this.elementType=
"f32"}slice(I,Q){return this.sliceBuffer(e,I,Q)}static fromTypedArray(I,Q){return new e(I.buffer,I.byteOffset,Q,I.byteOffset+I.byteLength)}}e.ElementType="f32";class m extends k.BufferViewVec4Impl{constructor(I,Q=0,N,T){super(Float32Array,I,Q,N,T);this.elementType="f32"}slice(I,Q){return this.sliceBuffer(m,I,Q)}static fromTypedArray(I,Q){return new m(I.buffer,I.byteOffset,Q,I.byteOffset+I.byteLength)}}m.ElementType="f32";class l extends a.BufferViewMat3Impl{constructor(I,Q=0,N,T){super(Float32Array,
I,Q,N,T);this.elementType="f32"}slice(I,Q){return this.sliceBuffer(l,I,Q)}static fromTypedArray(I,Q){return new l(I.buffer,I.byteOffset,Q,I.byteOffset+I.byteLength)}}l.ElementType="f32";class w extends a.BufferViewMat3Impl{constructor(I,Q=0,N,T){super(Float64Array,I,Q,N,T);this.elementType="f64"}slice(I,Q){return this.sliceBuffer(w,I,Q)}static fromTypedArray(I,Q){return new w(I.buffer,I.byteOffset,Q,I.byteOffset+I.byteLength)}}w.ElementType="f64";class v extends c.BufferViewMat4Impl{constructor(I,
Q=0,N,T){super(Float32Array,I,Q,N,T);this.elementType="f32"}slice(I,Q){return this.sliceBuffer(v,I,Q)}static fromTypedArray(I,Q){return new v(I.buffer,I.byteOffset,Q,I.byteOffset+I.byteLength)}}v.ElementType="f32";class x extends c.BufferViewMat4Impl{constructor(I,Q=0,N,T){super(Float64Array,I,Q,N,T);this.elementType="f64"}slice(I,Q){return this.sliceBuffer(x,I,Q)}static fromTypedArray(I,Q){return new x(I.buffer,I.byteOffset,Q,I.byteOffset+I.byteLength)}}x.ElementType="f64";class p extends d.BufferViewScalarImpl{constructor(I,
Q=0,N,T){super(Float64Array,I,Q,N,T);this.elementType="f64"}slice(I,Q){return this.sliceBuffer(p,I,Q)}static fromTypedArray(I,Q){return new p(I.buffer,I.byteOffset,Q,I.byteOffset+I.byteLength)}}p.ElementType="f64";class h extends f.BufferViewVec2Impl{constructor(I,Q=0,N,T){super(Float64Array,I,Q,N,T);this.elementType="f64"}slice(I,Q){return this.sliceBuffer(h,I,Q)}static fromTypedArray(I,Q){return new h(I.buffer,I.byteOffset,Q,I.byteOffset+I.byteLength)}}h.ElementType="f64";class t extends n.BufferViewVec3Impl{constructor(I,
Q=0,N,T){super(Float64Array,I,Q,N,T);this.elementType="f64"}slice(I,Q){return this.sliceBuffer(t,I,Q)}static fromTypedArray(I,Q){return new t(I.buffer,I.byteOffset,Q,I.byteOffset+I.byteLength)}}t.ElementType="f64";class r extends k.BufferViewVec4Impl{constructor(I,Q=0,N,T){super(Float64Array,I,Q,N,T);this.elementType="f64"}slice(I,Q){return this.sliceBuffer(r,I,Q)}static fromTypedArray(I,Q){return new r(I.buffer,I.byteOffset,Q,I.byteOffset+I.byteLength)}}r.ElementType="f64";class u extends d.BufferViewScalarImpl{constructor(I,
Q=0,N,T){super(Uint8Array,I,Q,N,T);this.elementType="u8"}slice(I,Q){return this.sliceBuffer(u,I,Q)}static fromTypedArray(I,Q){return new u(I.buffer,I.byteOffset,Q,I.byteOffset+I.byteLength)}}u.ElementType="u8";class y extends f.BufferViewVec2Impl{constructor(I,Q=0,N,T){super(Uint8Array,I,Q,N,T);this.elementType="u8"}slice(I,Q){return this.sliceBuffer(y,I,Q)}static fromTypedArray(I,Q){return new y(I.buffer,I.byteOffset,Q,I.byteOffset+I.byteLength)}}y.ElementType="u8";class z extends n.BufferViewVec3Impl{constructor(I,
Q=0,N,T){super(Uint8Array,I,Q,N,T);this.elementType="u8"}slice(I,Q){return this.sliceBuffer(z,I,Q)}static fromTypedArray(I,Q){return new z(I.buffer,I.byteOffset,Q,I.byteOffset+I.byteLength)}}z.ElementType="u8";class A extends k.BufferViewVec4Impl{constructor(I,Q=0,N,T){super(Uint8Array,I,Q,N,T);this.elementType="u8"}slice(I,Q){return this.sliceBuffer(A,I,Q)}static fromTypedArray(I,Q){return new A(I.buffer,I.byteOffset,Q,I.byteOffset+I.byteLength)}}A.ElementType="u8";class C extends d.BufferViewScalarImpl{constructor(I,
Q=0,N,T){super(Uint16Array,I,Q,N,T);this.elementType="u16"}slice(I,Q){return this.sliceBuffer(C,I,Q)}static fromTypedArray(I,Q){return new C(I.buffer,I.byteOffset,Q,I.byteOffset+I.byteLength)}}C.ElementType="u16";class E extends f.BufferViewVec2Impl{constructor(I,Q=0,N,T){super(Uint16Array,I,Q,N,T);this.elementType="u16"}slice(I,Q){return this.sliceBuffer(E,I,Q)}static fromTypedArray(I,Q){return new E(I.buffer,I.byteOffset,Q,I.byteOffset+I.byteLength)}}E.ElementType="u16";class B extends n.BufferViewVec3Impl{constructor(I,
Q=0,N,T){super(Uint16Array,I,Q,N,T);this.elementType="u16"}slice(I,Q){return this.sliceBuffer(B,I,Q)}static fromTypedArray(I,Q){return new B(I.buffer,I.byteOffset,Q,I.byteOffset+I.byteLength)}}B.ElementType="u16";class D extends k.BufferViewVec4Impl{constructor(I,Q=0,N,T){super(Uint16Array,I,Q,N,T);this.elementType="u16"}slice(I,Q){return this.sliceBuffer(D,I,Q)}static fromTypedArray(I,Q){return new D(I.buffer,I.byteOffset,Q,I.byteOffset+I.byteLength)}}D.ElementType="u16";class F extends d.BufferViewScalarImpl{constructor(I,
Q=0,N,T){super(Uint32Array,I,Q,N,T);this.elementType="u32"}slice(I,Q){return this.sliceBuffer(F,I,Q)}static fromTypedArray(I,Q){return new F(I.buffer,I.byteOffset,Q,I.byteOffset+I.byteLength)}}F.ElementType="u32";class K extends f.BufferViewVec2Impl{constructor(I,Q=0,N,T){super(Uint32Array,I,Q,N,T);this.elementType="u32"}slice(I,Q){return this.sliceBuffer(K,I,Q)}static fromTypedArray(I,Q){return new K(I.buffer,I.byteOffset,Q,I.byteOffset+I.byteLength)}}K.ElementType="u32";class L extends n.BufferViewVec3Impl{constructor(I,
Q=0,N,T){super(Uint32Array,I,Q,N,T);this.elementType="u32"}slice(I,Q){return this.sliceBuffer(L,I,Q)}static fromTypedArray(I,Q){return new L(I.buffer,I.byteOffset,Q,I.byteOffset+I.byteLength)}}L.ElementType="u32";class G extends k.BufferViewVec4Impl{constructor(I,Q=0,N,T){super(Uint32Array,I,Q,N,T);this.elementType="u32"}slice(I,Q){return this.sliceBuffer(G,I,Q)}static fromTypedArray(I,Q){return new G(I.buffer,I.byteOffset,Q,I.byteOffset+I.byteLength)}}G.ElementType="u32";class O extends d.BufferViewScalarImpl{constructor(I,
Q=0,N,T){super(Int8Array,I,Q,N,T);this.elementType="i8"}slice(I,Q){return this.sliceBuffer(O,I,Q)}static fromTypedArray(I,Q){return new O(I.buffer,I.byteOffset,Q,I.byteOffset+I.byteLength)}}O.ElementType="i8";class P extends f.BufferViewVec2Impl{constructor(I,Q=0,N,T){super(Int8Array,I,Q,N,T);this.elementType="i8"}slice(I,Q){return this.sliceBuffer(P,I,Q)}static fromTypedArray(I,Q){return new P(I.buffer,I.byteOffset,Q,I.byteOffset+I.byteLength)}}P.ElementType="i8";class J extends n.BufferViewVec3Impl{constructor(I,
Q=0,N,T){super(Int8Array,I,Q,N,T);this.elementType="i8"}slice(I,Q){return this.sliceBuffer(J,I,Q)}static fromTypedArray(I,Q){return new J(I.buffer,I.byteOffset,Q,I.byteOffset+I.byteLength)}}J.ElementType="i8";class R extends k.BufferViewVec4Impl{constructor(I,Q=0,N,T){super(Int8Array,I,Q,N,T);this.elementType="i8"}slice(I,Q){return this.sliceBuffer(R,I,Q)}static fromTypedArray(I,Q){return new R(I.buffer,I.byteOffset,Q,I.byteOffset+I.byteLength)}}R.ElementType="i8";class X extends d.BufferViewScalarImpl{constructor(I,
Q=0,N,T){super(Int16Array,I,Q,N,T);this.elementType="i16"}slice(I,Q){return this.sliceBuffer(X,I,Q)}static fromTypedArray(I,Q){return new X(I.buffer,I.byteOffset,Q,I.byteOffset+I.byteLength)}}X.ElementType="i16";class U extends f.BufferViewVec2Impl{constructor(I,Q=0,N,T){super(Int16Array,I,Q,N,T);this.elementType="i16"}slice(I,Q){return this.sliceBuffer(U,I,Q)}static fromTypedArray(I,Q){return new U(I.buffer,I.byteOffset,Q,I.byteOffset+I.byteLength)}}U.ElementType="i16";class M extends n.BufferViewVec3Impl{constructor(I,
Q=0,N,T){super(Int16Array,I,Q,N,T);this.elementType="i16"}slice(I,Q){return this.sliceBuffer(M,I,Q)}static fromTypedArray(I,Q){return new M(I.buffer,I.byteOffset,Q,I.byteOffset+I.byteLength)}}M.ElementType="i16";class V extends k.BufferViewVec4Impl{constructor(I,Q=0,N,T){super(Int16Array,I,Q,N,T);this.elementType="i16"}slice(I,Q){return this.sliceBuffer(V,I,Q)}static fromTypedArray(I,Q){return new V(I.buffer,I.byteOffset,Q,I.byteOffset+I.byteLength)}}V.ElementType="i16";class Y extends d.BufferViewScalarImpl{constructor(I,
Q=0,N,T){super(Int32Array,I,Q,N,T);this.elementType="i32"}slice(I,Q){return this.sliceBuffer(Y,I,Q)}static fromTypedArray(I,Q){return new Y(I.buffer,I.byteOffset,Q,I.byteOffset+I.byteLength)}}Y.ElementType="i32";class W extends f.BufferViewVec2Impl{constructor(I,Q=0,N,T){super(Int32Array,I,Q,N,T);this.elementType="i32"}slice(I,Q){return this.sliceBuffer(W,I,Q)}static fromTypedArray(I,Q){return new W(I.buffer,I.byteOffset,Q,I.byteOffset+I.byteLength)}}W.ElementType="i32";class H extends n.BufferViewVec3Impl{constructor(I,
Q=0,N,T){super(Int32Array,I,Q,N,T);this.elementType="i32"}slice(I,Q){return this.sliceBuffer(H,I,Q)}static fromTypedArray(I,Q){return new H(I.buffer,I.byteOffset,Q,I.byteOffset+I.byteLength)}}H.ElementType="i32";class S extends k.BufferViewVec4Impl{constructor(I,Q=0,N,T){super(Int32Array,I,Q,N,T);this.elementType="i32"}slice(I,Q){return this.sliceBuffer(S,I,Q)}static fromTypedArray(I,Q){return new S(I.buffer,I.byteOffset,Q,I.byteOffset+I.byteLength)}}S.ElementType="i32";b.BufferViewFloat=g;b.BufferViewFloat64=
p;b.BufferViewInt16=X;b.BufferViewInt32=Y;b.BufferViewInt8=O;b.BufferViewMat3f=l;b.BufferViewMat3f64=w;b.BufferViewMat4f=v;b.BufferViewMat4f64=x;b.BufferViewUint16=C;b.BufferViewUint32=F;b.BufferViewUint8=u;b.BufferViewVec2f=q;b.BufferViewVec2f64=h;b.BufferViewVec2i16=U;b.BufferViewVec2i32=W;b.BufferViewVec2i8=P;b.BufferViewVec2u16=E;b.BufferViewVec2u32=K;b.BufferViewVec2u8=y;b.BufferViewVec3f=e;b.BufferViewVec3f64=t;b.BufferViewVec3i16=M;b.BufferViewVec3i32=H;b.BufferViewVec3i8=J;b.BufferViewVec3u16=
B;b.BufferViewVec3u32=L;b.BufferViewVec3u8=z;b.BufferViewVec4f=m;b.BufferViewVec4f64=r;b.BufferViewVec4i16=V;b.BufferViewVec4i32=S;b.BufferViewVec4i8=R;b.BufferViewVec4u16=D;b.BufferViewVec4u32=G;b.BufferViewVec4u8=A;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/internals/Mat3":function(){define(["exports"],function(b){class a{constructor(c,d,f=0,n,k){this.TypedArrayConstructor=c;this.elementCount=9;c=this.TypedArrayConstructor;void 0===n&&(n=9*c.BYTES_PER_ELEMENT);
const g=0===d.byteLength?0:f;this.typedBuffer=null==k?new c(d,g):new c(d,g,(k-f)/c.BYTES_PER_ELEMENT);this.typedBufferStride=n/c.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(c,d,f=this.count-d){d=this.typedBuffer.byteOffset+d*this.stride;return new c(this.buffer,d,this.stride,d+f*this.stride)}getMat(c,d){c*=this.typedBufferStride;for(let f=0;9>f;f++)d[f]=this.typedBuffer[c++];
return d}setMat(c,d){c*=this.typedBufferStride;for(let f=0;9>f;f++)this.typedBuffer[c++]=d[f]}get(c,d){return this.typedBuffer[c*this.typedBufferStride+d]}set(c,d,f){this.typedBuffer[c*this.typedBufferStride+d]=f}copyFrom(c,d,f){const n=this.typedBuffer,k=d.typedBuffer;c*=this.typedBufferStride;d=f*d.typedBufferStride;for(f=0;9>f;++f)n[c++]=k[d++]}get buffer(){return this.typedBuffer.buffer}}a.ElementCount=9;b.BufferViewMat3Impl=a;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/internals/Mat4":function(){define(["exports"],
function(b){class a{constructor(c,d,f=0,n,k){this.TypedArrayConstructor=c;this.elementCount=16;c=this.TypedArrayConstructor;void 0===n&&(n=16*c.BYTES_PER_ELEMENT);const g=0===d.byteLength?0:f;this.typedBuffer=null==k?new c(d,g):new c(d,g,(k-f)/c.BYTES_PER_ELEMENT);this.typedBufferStride=n/c.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(c,d,f=this.count-d){d=this.typedBuffer.byteOffset+
d*this.stride;return new c(this.buffer,d,this.stride,d+f*this.stride)}getMat(c,d){c*=this.typedBufferStride;for(let f=0;16>f;f++)d[f]=this.typedBuffer[c++];return d}setMat(c,d){c*=this.typedBufferStride;for(let f=0;16>f;f++)this.typedBuffer[c++]=d[f]}get(c,d){return this.typedBuffer[c*this.typedBufferStride+d]}set(c,d,f){this.typedBuffer[c*this.typedBufferStride+d]=f}copyFrom(c,d,f){const n=this.typedBuffer,k=d.typedBuffer;c*=this.typedBufferStride;d=f*d.typedBufferStride;for(f=0;16>f;++f)n[c++]=
k[d++]}get buffer(){return this.typedBuffer.buffer}}a.ElementCount=16;b.BufferViewMat4Impl=a;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/internals/Scalar":function(){define(["exports"],function(b){class a{constructor(c,d,f=0,n,k){this.TypedArrayConstructor=c;this.elementCount=1;c=this.TypedArrayConstructor;void 0===n&&(n=c.BYTES_PER_ELEMENT);const g=0===d.byteLength?0:f;this.typedBuffer=null==k?new c(d,g):new c(d,g,(k-f)/c.BYTES_PER_ELEMENT);this.stride=
n;this.typedBufferStride=n/c.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride)}sliceBuffer(c,d,f=this.count-d){d=this.typedBuffer.byteOffset+d*this.stride;return new c(this.buffer,d,this.stride,d+f*this.stride)}get(c){return this.typedBuffer[c*this.typedBufferStride]}set(c,d){this.typedBuffer[c*this.typedBufferStride]=d}get buffer(){return this.typedBuffer.buffer}}a.ElementCount=1;b.BufferViewScalarImpl=a;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/geometry/support/buffer/internals/Vec2":function(){define(["exports","../../../../chunks/vec2"],function(b,a){class c{constructor(d,f,n=0,k,g){this.TypedArrayConstructor=d;this.elementCount=2;d=this.TypedArrayConstructor;void 0===k&&(k=2*d.BYTES_PER_ELEMENT);const q=0===f.byteLength?0:n;this.typedBuffer=null==g?new d(f,q):new d(f,q,(g-n)/d.BYTES_PER_ELEMENT);this.typedBufferStride=k/d.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*
this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(d,f,n=this.count-f){f=this.typedBuffer.byteOffset+f*this.stride;return new d(this.buffer,f,this.stride,f+n*this.stride)}getVec(d,f){d*=this.typedBufferStride;return a.set(f,this.typedBuffer[d],this.typedBuffer[d+1])}setVec(d,f){d*=this.typedBufferStride;this.typedBuffer[d++]=f[0];this.typedBuffer[d]=f[1]}get(d,f){return this.typedBuffer[d*this.typedBufferStride+f]}set(d,f,n){this.typedBuffer[d*this.typedBufferStride+f]=n}setValues(d,f,n){d*=
this.typedBufferStride;this.typedBuffer[d++]=f;this.typedBuffer[d]=n}copyFrom(d,f,n){const k=this.typedBuffer,g=f.typedBuffer;d*=this.typedBufferStride;f=n*f.typedBufferStride;k[d++]=g[f++];k[d]=g[f]}get buffer(){return this.typedBuffer.buffer}}c.ElementCount=2;b.BufferViewVec2Impl=c;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/internals/Vec3":function(){define(["exports","../../../../chunks/vec3"],function(b,a){class c{constructor(d,f,n=0,k,g){this.TypedArrayConstructor=
d;this.elementCount=3;d=this.TypedArrayConstructor;void 0===k&&(k=3*d.BYTES_PER_ELEMENT);const q=0===f.byteLength?0:n;this.typedBuffer=null==g?new d(f,q):new d(f,q,(g-n)/d.BYTES_PER_ELEMENT);this.typedBufferStride=k/d.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(d,f,n=this.count-f){f=this.typedBuffer.byteOffset+f*this.stride;return new d(this.buffer,f,this.stride,f+
n*this.stride)}getVec(d,f){d*=this.typedBufferStride;return a.set(f,this.typedBuffer[d],this.typedBuffer[d+1],this.typedBuffer[d+2])}setVec(d,f){d*=this.typedBufferStride;this.typedBuffer[d++]=f[0];this.typedBuffer[d++]=f[1];this.typedBuffer[d]=f[2]}get(d,f){return this.typedBuffer[d*this.typedBufferStride+f]}set(d,f,n){this.typedBuffer[d*this.typedBufferStride+f]=n}setValues(d,f,n,k){d*=this.typedBufferStride;this.typedBuffer[d++]=f;this.typedBuffer[d++]=n;this.typedBuffer[d]=k}copyFrom(d,f,n){const k=
this.typedBuffer,g=f.typedBuffer;d*=this.typedBufferStride;f=n*f.typedBufferStride;k[d++]=g[f++];k[d++]=g[f++];k[d]=g[f]}get buffer(){return this.typedBuffer.buffer}}c.ElementCount=3;b.BufferViewVec3Impl=c;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/internals/Vec4":function(){define(["exports","../../../../chunks/vec4"],function(b,a){class c{constructor(d,f,n=0,k,g){this.TypedArrayConstructor=d;this.start=n;this.elementCount=4;d=this.TypedArrayConstructor;
void 0===k&&(k=4*d.BYTES_PER_ELEMENT);const q=0===f.byteLength?0:n;this.typedBuffer=null==g?new d(f,q):new d(f,q,(g-n)/d.BYTES_PER_ELEMENT);this.typedBufferStride=k/d.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(d,f,n=this.count-f){f=this.typedBuffer.byteOffset+f*this.stride;return new d(this.buffer,f,this.stride,f+n*this.stride)}getVec(d,f){d*=this.typedBufferStride;
return a.set(f,this.typedBuffer[d++],this.typedBuffer[d++],this.typedBuffer[d++],this.typedBuffer[d])}setVec(d,f){d*=this.typedBufferStride;this.typedBuffer[d++]=f[0];this.typedBuffer[d++]=f[1];this.typedBuffer[d++]=f[2];this.typedBuffer[d]=f[3]}get(d,f){return this.typedBuffer[d*this.typedBufferStride+f]}set(d,f,n){this.typedBuffer[d*this.typedBufferStride+f]=n}setValues(d,f,n,k,g){d*=this.typedBufferStride;this.typedBuffer[d++]=f;this.typedBuffer[d++]=n;this.typedBuffer[d++]=k;this.typedBuffer[d]=
g}copyFrom(d,f,n){const k=this.typedBuffer,g=f.typedBuffer;d*=this.typedBufferStride;f=n*f.typedBufferStride;k[d++]=g[f++];k[d++]=g[f++];k[d++]=g[f++];k[d]=g[f]}get buffer(){return this.typedBuffer.buffer}}c.ElementCount=4;b.BufferViewVec4Impl=c;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/types":function(){define(["exports"],function(b){b.elementTypeSize=function(a){switch(a){case "u8":return 1;case "u16":return 2;case "u32":return 4;case "i8":return 1;
case "i16":return 2;case "i32":return 4;case "f32":return 4;case "f64":return 8}};b.isInteger=function(a){switch(a){case "u8":case "u16":case "u32":case "i8":case "i16":case "i32":return!0;case "f32":case "f64":return!1}};b.isSigned=function(a){switch(a){case "u8":case "u16":case "u32":return!1;case "i8":case "i16":case "i32":case "f32":case "f64":return!0}};b.maximumValue=function(a){switch(a){case "u8":return 255;case "u16":return 65535;case "u32":return 4294967295;case "i8":return 127;case "i16":return 32767;
case "i32":return 2147483647;case "f32":return 3.402823E38;case "f64":return 1.79769E308}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/GeometryUtil":function(){define("exports ../../../../chunks/vec3 ../../../../chunks/vec3f32 ../../../../chunks/vec3f64 ../../../../geometry/support/DoubleArray ../../../../geometry/support/FloatArray ../../../../geometry/support/Indices ../../../../geometry/support/plane ../../../../geometry/support/ray ./Attribute ./BufferVectorMath ./ContentObjectType ./Geometry ./Util ./VertexAttribute".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x){function p(Q,N,T){function aa(ka,ha){ka>ha&&([ka,ha]=[ha,ka]);const ba=ka.toString()+"."+ha.toString();if(fa[ba])return fa[ba];let ea=Z.length;Z.length+=3;u.add(Z,3*ka,Z,3*ha,Z,ea);u.scale(Z,ea,Q/u.length(Z,ea));ea/=3;return fa[ba]=ea}let Z;T?(Z=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],T=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]):(T=Q*(1+Math.sqrt(5))/2,Z=[-Q,T,0,Q,T,0,-Q,-T,0,Q,-T,0,0,-Q,T,0,Q,T,0,-Q,-T,0,Q,-T,T,0,-Q,T,0,Q,-T,0,-Q,-T,0,Q],T=[0,11,5,
0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]);for(var da=0;da<Z.length;da+=3)u.scale(Z,da,Q/u.length(Z,da));let fa={};for(da=0;da<N;da++){const ka=T.length,ha=Array(4*ka);for(let ba=0;ba<ka;ba+=3){const ea=T[ba],ca=T[ba+1],ia=T[ba+2],la=aa(ea,ca),oa=aa(ca,ia),na=aa(ia,ea),ra=4*ba;ha[ra]=ea;ha[ra+1]=la;ha[ra+2]=na;ha[ra+3]=ca;ha[ra+4]=oa;ha[ra+5]=la;ha[ra+6]=ia;ha[ra+7]=na;ha[ra+8]=oa;ha[ra+9]=la;ha[ra+10]=oa;ha[ra+11]=
na}T=ha;fa={}}N=n.floatArrayFrom(Z);for(da=0;da<N.length;da+=3)u.normalize(N,da);return[[x.VertexAttribute.POSITION,new e.Attribute(n.floatArrayFrom(Z),T,3,!0)],[x.VertexAttribute.NORMAL,new e.Attribute(N,T,3,!0)]]}function h(Q,N,T,aa,Z,da,fa=c.fromValues(0,0,0)){var ka=N.length;const ha=n.newFloatArray(T.length*ka*3+(6*aa.length||0)),ba=n.newFloatArray(T.length*ka*3+(aa?6:0)),ea=[],ca=[];let ia=0;var la=0;const oa=c.create(),na=c.create(),ra=c.create(),ta=c.create(),ma=c.create(),pa=c.create(),ja=
c.create(),qa=d.create(),ua=c.create(),wa=c.create(),za=c.create(),Aa=c.create(),Fa=c.create(),Da=g.create();a.set(ua,0,1,0);a.subtract(na,T[1],T[0]);a.normalize(na,na);da?(a.add(qa,T[0],fa),a.normalize(ra,qa)):a.set(ra,0,0,1);r(na,ra,ua,ua,ma,ra,.99619469809);a.copy(ta,ra);a.copy(Aa,ma);for(var Ha=0;Ha<aa.length;Ha++)a.scale(pa,ma,aa[Ha][0]),a.scale(qa,ra,aa[Ha][2]),a.add(pa,pa,qa),a.add(pa,pa,T[0]),ha[ia++]=pa[0],ha[ia++]=pa[1],ha[ia++]=pa[2];ba[la++]=-na[0];ba[la++]=-na[1];ba[la++]=-na[2];for(Ha=
0;Ha<Z.length;Ha++)ea.push(0<Z[Ha][0]?Z[Ha][0]:-Z[Ha][0]-1+aa.length),ea.push(0<Z[Ha][1]?Z[Ha][1]:-Z[Ha][1]-1+aa.length),ea.push(0<Z[Ha][2]?Z[Ha][2]:-Z[Ha][2]-1+aa.length),ca.push(0),ca.push(0),ca.push(0);Ha=aa.length;const Ka=aa.length-1;for(let Na=0;Na<T.length;Na++){let Ra=!1;0<Na&&(a.copy(oa,na),Na<T.length-1?(a.subtract(na,T[Na+1],T[Na]),a.normalize(na,na)):Ra=!0,a.add(wa,oa,na),a.normalize(wa,wa),a.add(za,T[Na-1],ta),g.fromPositionAndNormal(T[Na],wa,Da),g.intersectRay(Da,q.wrap(za,oa),qa)?(a.subtract(qa,
qa,T[Na]),a.normalize(ra,qa),a.cross(ma,wa,ra),a.normalize(ma,ma)):r(wa,ta,Aa,ua,ma,ra,.99619469809),a.copy(ta,ra),a.copy(Aa,ma));da&&(a.add(qa,T[Na],fa),a.normalize(Fa,qa));for(let Sa=0;Sa<ka;Sa++)if(a.scale(pa,ma,N[Sa][0]),a.scale(qa,ra,N[Sa][1]),a.add(pa,pa,qa),a.normalize(ja,pa),ba[la++]=ja[0],ba[la++]=ja[1],ba[la++]=ja[2],a.add(pa,pa,T[Na]),ha[ia++]=pa[0],ha[ia++]=pa[1],ha[ia++]=pa[2],!Ra){var La=(Sa+1)%ka;ea.push(Ha+Sa);ea.push(Ha+ka+Sa);ea.push(Ha+La);ea.push(Ha+La);ea.push(Ha+ka+Sa);ea.push(Ha+
ka+La);for(La=0;6>La;La++)ca.push(ea[ea.length-6+La]-Ka)}Ha+=ka}N=T[T.length-1];for(T=0;T<aa.length;T++)a.scale(pa,ma,aa[T][0]),a.scale(qa,ra,aa[T][1]),a.add(pa,pa,qa),a.add(pa,pa,N),ha[ia++]=pa[0],ha[ia++]=pa[1],ha[ia++]=pa[2];aa=la/3;ba[la++]=na[0];ba[la++]=na[1];ba[la++]=na[2];ka=Ha-ka;for(la=0;la<Z.length;la++)ea.push(0<=Z[la][0]?Ha+Z[la][0]:-Z[la][0]-1+ka),ea.push(0<=Z[la][2]?Ha+Z[la][2]:-Z[la][2]-1+ka),ea.push(0<=Z[la][1]?Ha+Z[la][1]:-Z[la][1]-1+ka),ca.push(aa),ca.push(aa),ca.push(aa);Z=[[x.VertexAttribute.POSITION,
new e.Attribute(ha,ea,3,!0)],[x.VertexAttribute.NORMAL,new e.Attribute(ba,ca,3,!0)]];return new w.Geometry(Q,Z)}function t(Q,N,T,aa,Z){if(Math.abs(a.dot(N,Q))>Z)return!1;a.cross(T,Q,N);a.normalize(T,T);a.cross(aa,T,Q);a.normalize(aa,aa);return!0}function r(Q,N,T,aa,Z,da,fa){return t(Q,N,Z,da,fa)||t(Q,T,Z,da,fa)||t(Q,aa,Z,da,fa)}const u=m.Vec3Compact,y=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],z=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],A=
[0,0,1,0,1,1,0,1],C=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],E=Array(36);for(m=0;6>m;m++)for(var B=0;6>B;B++)E[6*m+B]=m;const D=Array(36);for(m=0;6>m;m++)D[6*m]=0,D[6*m+1]=1,D[6*m+2]=2,D[6*m+3]=2,D[6*m+4]=3,D[6*m+5]=0;const F=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],K=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],L=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],G=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];m=c.fromValues(-.5,
0,-.5);B=c.fromValues(.5,0,-.5);const O=c.fromValues(0,0,.5),P=c.fromValues(0,.5,0),J=c.create(),R=c.create(),X=c.create(),U=c.create(),M=c.create();a.subtract(J,m,P);a.subtract(R,m,B);a.cross(X,J,R);a.normalize(X,X);a.subtract(J,B,P);a.subtract(R,B,O);a.cross(U,J,R);a.normalize(U,U);a.subtract(J,O,P);a.subtract(R,O,m);a.cross(M,J,R);a.normalize(M,M);const V=[m,B,O,P],Y=[0,-1,0,X[0],X[1],X[2],U[0],U[1],U[2],M[0],M[1],M[2]],W=[0,1,2,3,1,0,3,2,1,3,0,2],H=[0,0,0,1,1,1,2,2,2,3,3,3],S=[[-1,-1,0],[1,-1,
0],[1,1,0],[-1,1,0]],I=c.create();b.cgToGIS=function(Q,N=Q){var T=Q.attributes;Q=T.get(x.VertexAttribute.POSITION).data;if(T=T.get(x.VertexAttribute.NORMAL).data){var aa=N.getMutableAttribute(x.VertexAttribute.NORMAL).data;for(let Z=0;Z<T.length;Z+=3){const da=T[Z+1];aa[Z+1]=-T[Z+2];aa[Z+2]=da}}if(Q)for(N=N.getMutableAttribute(x.VertexAttribute.POSITION).data,T=0;T<Q.length;T+=3)aa=Q[T+1],N[T+1]=-Q[T+2],N[T+2]=aa};b.createBoxGeometry=function(Q,N){Array.isArray(N)||(N=[N,N,N]);const T=Array(24);for(let aa=
0;8>aa;aa++)T[3*aa]=y[aa][0]*N[0],T[3*aa+1]=y[aa][1]*N[1],T[3*aa+2]=y[aa][2]*N[2];return new w.Geometry(Q,[[x.VertexAttribute.POSITION,new e.Attribute(T,C,3,!0)],[x.VertexAttribute.NORMAL,new e.Attribute(z,E,3)],[x.VertexAttribute.UV0,new e.Attribute(A,D,2)]])};b.createConeGeometry=function(Q,N,T,aa,Z,da=!0,fa=!0){let ka=0;var ha=c.fromValues(0,ka,0),ba=c.fromValues(0,ka+N,0),ea=c.fromValues(0,-1,0),ca=c.fromValues(0,1,0);Z&&(ka=N,ba=c.fromValues(0,0,0),ha=c.fromValues(0,ka,0),ea=c.fromValues(0,1,
0),ca=c.fromValues(0,-1,0));ha=[ba,ha];ea=[ea,ca];ca=aa+2;ba=Math.sqrt(N*N+T*T);if(Z)for(Z=aa-1;0<=Z;Z--){var ia=2*Math.PI/aa*Z,la=c.fromValues(Math.cos(ia)*T,ka,Math.sin(ia)*T);ha.push(la);ia=c.fromValues(N*Math.cos(ia)/ba,-T/ba,N*Math.sin(ia)/ba);ea.push(ia)}else for(Z=0;Z<aa;Z++)ia=2*Math.PI/aa*Z,la=c.fromValues(Math.cos(ia)*T,ka,Math.sin(ia)*T),ha.push(la),ia=c.fromValues(N*Math.cos(ia)/ba,T/ba,N*Math.sin(ia)/ba),ea.push(ia);N=[];T=[];if(da){for(da=3;da<ha.length;da++)N.push(1),N.push(da-1),N.push(da),
T.push(0),T.push(0),T.push(0);N.push(ha.length-1);N.push(2);N.push(1);T.push(0);T.push(0);T.push(0)}if(fa){for(fa=3;fa<ha.length;fa++)N.push(fa),N.push(fa-1),N.push(0),T.push(fa),T.push(fa-1),T.push(1);N.push(0);N.push(2);N.push(ha.length-1);T.push(1);T.push(2);T.push(ea.length-1)}fa=n.newFloatArray(3*ca);for(da=0;da<ca;da++)fa[3*da]=ha[da][0],fa[3*da+1]=ha[da][1],fa[3*da+2]=ha[da][2];ha=n.newFloatArray(3*ca);for(da=0;da<ca;da++)ha[3*da]=ea[da][0],ha[3*da+1]=ea[da][1],ha[3*da+2]=ea[da][2];ha=[[x.VertexAttribute.POSITION,
new e.Attribute(fa,N,3,!0)],[x.VertexAttribute.NORMAL,new e.Attribute(ha,T,3,!0)]];return new w.Geometry(Q,ha)};b.createCylinderGeometry=function(Q,N,T,aa,Z,da,fa){Z=Z?c.clone(Z):c.fromValues(1,0,0);da=da?c.clone(da):c.fromValues(0,0,0);fa??(fa=!0);var ka=c.create();a.normalize(ka,Z);var ha=c.create();a.scale(ha,ka,Math.abs(N));var ba=c.create();a.scale(ba,ha,-.5);a.add(ba,ba,da);const ea=c.fromValues(0,1,0);.2>Math.abs(1-a.dot(ka,ea))&&a.set(ea,0,0,1);const ca=c.create();a.cross(ca,ka,ea);a.normalize(ca,
ca);a.cross(ea,ca,ka);N=2*aa+(fa?2:0);da=aa+(fa?2:0);Z=n.newFloatArray(3*N);const ia=n.newFloatArray(3*da),la=n.newFloatArray(2*N),oa=Array(3*aa*(fa?4:2)),na=Array(3*aa*(fa?4:2));fa&&(Z[3*(N-2)]=ba[0],Z[3*(N-2)+1]=ba[1],Z[3*(N-2)+2]=ba[2],la[2*(N-2)]=0,la[2*(N-2)+1]=0,Z[3*(N-1)]=Z[3*(N-2)]+ha[0],Z[3*(N-1)+1]=Z[3*(N-2)+1]+ha[1],Z[3*(N-1)+2]=Z[3*(N-2)+2]+ha[2],la[2*(N-1)]=1,la[2*(N-1)+1]=1,ia[3*(da-2)]=-ka[0],ia[3*(da-2)+1]=-ka[1],ia[3*(da-2)+2]=-ka[2],ia[3*(da-1)]=ka[0],ia[3*(da-1)+1]=ka[1],ia[3*(da-
1)+2]=ka[2]);ka=0;const ra=c.create(),ta=c.create();for(let qa=0;qa<aa;qa++){var ma=2*Math.PI/aa*qa;a.scale(ra,ea,Math.sin(ma));a.scale(ta,ca,Math.cos(ma));a.add(ra,ra,ta);ia[3*qa]=ra[0];ia[3*qa+1]=ra[1];ia[3*qa+2]=ra[2];a.scale(ra,ra,T);a.add(ra,ra,ba);Z[3*qa]=ra[0];Z[3*qa+1]=ra[1];Z[3*qa+2]=ra[2];la[2*qa]=qa/aa;la[2*qa+1]=0;Z[3*(qa+aa)]=Z[3*qa]+ha[0];Z[3*(qa+aa)+1]=Z[3*qa+1]+ha[1];Z[3*(qa+aa)+2]=Z[3*qa+2]+ha[2];la[2*(qa+aa)]=qa/aa;la[2*qa+1]=1;ma=(qa+1)%aa;var pa=ka++,ja=qa;oa[pa]=qa;na[pa]=ja;
pa=ka++;ja=qa;oa[pa]=qa+aa;na[pa]=ja;pa=ka++;ja=ma;oa[pa]=ma;na[pa]=ja;pa=ka++;ja=ma;oa[pa]=ma;na[pa]=ja;pa=ka++;ja=qa;oa[pa]=qa+aa;na[pa]=ja;pa=ka++;ja=ma;oa[pa]=ma+aa;na[pa]=ja}if(fa){for(T=0;T<aa;T++)fa=(T+1)%aa,ha=ka++,ba=da-2,oa[ha]=N-2,na[ha]=ba,ha=ka++,ba=da-2,oa[ha]=T,na[ha]=ba,ha=ka++,ba=da-2,oa[ha]=fa,na[ha]=ba;for(T=0;T<aa;T++)fa=(T+1)%aa,ha=ka++,ba=da-1,oa[ha]=T+aa,na[ha]=ba,ha=ka++,ba=da-1,oa[ha]=N-1,na[ha]=ba,ha=ka++,ba=da-1,oa[ha]=fa+aa,na[ha]=ba}aa=[[x.VertexAttribute.POSITION,new e.Attribute(Z,
oa,3,!0)],[x.VertexAttribute.NORMAL,new e.Attribute(ia,na,3,!0)],[x.VertexAttribute.UV0,new e.Attribute(la,oa,2,!0)]];return new w.Geometry(Q,aa)};b.createDiamondGeometry=function(Q,N){Array.isArray(N)||(N=[N,N,N]);const T=Array(18);for(let aa=0;6>aa;aa++)T[3*aa]=F[aa][0]*N[0],T[3*aa+1]=F[aa][1]*N[1],T[3*aa+2]=F[aa][2]*N[2];return new w.Geometry(Q,[[x.VertexAttribute.POSITION,new e.Attribute(T,L,3,!0)],[x.VertexAttribute.NORMAL,new e.Attribute(K,G,3)]])};b.createExtrudedTriangle=function(Q,N,T,aa,
Z,da=0){const fa=Array(18);N=[[-T,da,Z/2],[aa,da,Z/2],[0,N+da,Z/2],[-T,da,-Z/2],[aa,da,-Z/2],[0,N+da,-Z/2]];for(T=0;6>T;T++)fa[3*T]=N[T][0],fa[3*T+1]=N[T][1],fa[3*T+2]=N[T][2];return new w.Geometry(Q,[[x.VertexAttribute.POSITION,new e.Attribute(fa,[0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5],3,!0)]])};b.createPathExtrusionGeometry=h;b.createPointGeometry=function(Q,N,T,aa,Z,da,fa,ka,ha=null){T=T?[T[0],T[1],T[2]]:[0,0,0];N=N?[N[0],N[1],N[2]]:[0,0,1];fa=fa||[0,0];aa=aa?[255*aa[0],255*aa[1],255*
aa[2],3<aa.length?255*aa[3]:255]:[255,255,255,255];const ba=null!=Z&&2===Z.length?Z:[1,1];Z=k.getZeroIndexArray(1);fa=[[x.VertexAttribute.POSITION,new e.Attribute(T,Z,3,!0)],[x.VertexAttribute.NORMAL,new e.Attribute(N,Z,3,!0)],[x.VertexAttribute.UV0,new e.Attribute(fa,Z,fa.length)],[x.VertexAttribute.COLOR,new e.Attribute(aa,Z,4,!0)],[x.VertexAttribute.SIZE,new e.Attribute(ba,Z,2)]];null!=da&&fa.push([x.VertexAttribute.AUXPOS1,new e.Attribute([da[0],da[1],da[2],da[3]],Z,4)]);null!=ka&&fa.push([x.VertexAttribute.FEATUREATTRIBUTE,
new e.Attribute([ka[0],ka[1],ka[2],ka[3]],Z,4)]);return new w.Geometry(Q,fa,null,l.ContentObjectType.Point,ha)};b.createPolySphereData=p;b.createPolySphereGeometry=function(Q,N,T,aa){N=p(N,T,aa);return new w.Geometry(Q,N)};b.createPolylineGeometry=function(Q,N,T,aa){v.assert(1<N.length,"createPolylineGeometry(): polyline needs at least 2 points");v.assert(3===N[0].length,"createPolylineGeometry(): malformed vertex");v.assert(null==T||T.length===N.length,"createPolylineGeometry: need same number of points and normals");
v.assert(null==T||3===T[0].length,"createPolylineGeometry(): malformed normal");var Z=f.newDoubleArray(3*N.length);const da=Array(2*(N.length-1));var fa=0,ka=0;for(var ha=0;ha<N.length;ha++){for(var ba=0;3>ba;ba++)Z[fa++]=N[ha][ba];0<ha&&(da[ka++]=ha-1,da[ka++]=ha)}Z=[[x.VertexAttribute.POSITION,new e.Attribute(Z,da,3,!0)]];if(T){fa=n.newFloatArray(3*T.length);ka=0;for(ha=0;ha<N.length;ha++)for(ba=0;3>ba;ba++)fa[ka++]=T[ha][ba];Z.push([x.VertexAttribute.NORMAL,new e.Attribute(fa,da,3,!0)])}aa&&Z.push([x.VertexAttribute.COLOR,
new e.Attribute(aa,k.getContinuousIndexArray(aa.length/4),4)]);return new w.Geometry(Q,Z,null,l.ContentObjectType.Line)};b.createSphereGeometry=function(Q,N,T,aa,Z={uv:!0}){var da=-Math.PI,fa=2*Math.PI,ka=-Math.PI/2,ha=Math.PI;T=Math.max(3,Math.floor(T));aa=Math.max(2,Math.floor(aa));var ba=(T+1)*(aa+1);const ea=n.newFloatArray(3*ba),ca=n.newFloatArray(3*ba);ba=n.newFloatArray(2*ba);const ia=[];var la=0;for(var oa=0;oa<=aa;oa++){const ra=[],ta=oa/aa,ma=ka+ta*ha,pa=Math.cos(ma);for(let ja=0;ja<=T;ja++){const qa=
ja/T;var na=da+qa*fa;const ua=Math.cos(na)*pa,wa=Math.sin(ma);na=-Math.sin(na)*pa;ea[3*la]=ua*N;ea[3*la+1]=wa*N;ea[3*la+2]=na*N;ca[3*la]=ua;ca[3*la+1]=wa;ca[3*la+2]=na;ba[2*la]=qa;ba[2*la+1]=ta;ra.push(la);++la}ia.push(ra)}N=[];for(da=0;da<aa;da++)for(fa=0;fa<T;fa++)ka=ia[da][fa],ha=ia[da][fa+1],la=ia[da+1][fa+1],oa=ia[da+1][fa],0===da?(N.push(ka),N.push(la),N.push(oa)):da===aa-1?(N.push(ka),N.push(ha),N.push(la)):(N.push(ka),N.push(ha),N.push(la),N.push(la),N.push(oa),N.push(ka));T=[[x.VertexAttribute.POSITION,
new e.Attribute(ea,N,3,!0)],[x.VertexAttribute.NORMAL,new e.Attribute(ca,N,3,!0)]];Z.uv&&T.push([x.VertexAttribute.UV0,new e.Attribute(ba,N,2,!0)]);Z.offset&&(T[0][0]=x.VertexAttribute.OFFSET,T.push([x.VertexAttribute.POSITION,new e.Attribute(Float64Array.from(Z.offset),k.getZeroIndexArray(N.length),3,!0)]));return new w.Geometry(Q,T)};b.createSquareGeometry=function(Q,N=S){var T=Array(12);for(var aa=0;4>aa;aa++)for(let Z=0;3>Z;Z++)T[3*aa+Z]=N[aa][Z];N=[0,1,2,2,3,0];aa=[0,0,0,0,0,0];T=[[x.VertexAttribute.POSITION,
new e.Attribute(T,N,3,!0)],[x.VertexAttribute.NORMAL,new e.Attribute([0,0,1],aa,3,!0)],[x.VertexAttribute.UV0,new e.Attribute([0,0,1,0,1,1,0,1],N,2,!0)],[x.VertexAttribute.COLOR,new e.Attribute([255,255,255,255],aa,4,!0)]];return new w.Geometry(Q,T)};b.createTetrahedronGeometry=function(Q,N){Array.isArray(N)||(N=[N,N,N]);const T=Array(12);for(let aa=0;4>aa;aa++)T[3*aa]=V[aa][0]*N[0],T[3*aa+1]=V[aa][1]*N[1],T[3*aa+2]=V[aa][2]*N[2];return new w.Geometry(Q,[[x.VertexAttribute.POSITION,new e.Attribute(T,
W,3,!0)],[x.VertexAttribute.NORMAL,new e.Attribute(Y,H,3)]])};b.createTubeGeometry=function(Q,N,T,aa,Z,da){aa=aa||10;Z=null!=Z?Z:!0;v.assert(1<N.length);const fa=[],ka=[];for(let ha=0;ha<aa;ha++){fa.push([0,-ha-1,-((ha+1)%aa)-1]);const ba=ha/aa*2*Math.PI;ka.push([Math.cos(ba)*T,Math.sin(ba)*T])}return h(Q,ka,N,[[0,0,0]],fa,Z,da)};b.makeOrthoBasisDirUpFallback=r;b.transformInPlace=function(Q,N){Q=Q.getMutableAttribute(x.VertexAttribute.POSITION).data;for(let T=0;T<Q.length;T+=3)a.set(I,Q[T],Q[T+1],
Q[T+2]),a.transformMat4(I,I,N),Q[T]=I[0],Q[T+1]=I[1],Q[T+2]=I[2]};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/DoubleArray":function(){define(["exports","../../core/typedArrayUtil"],function(b,a){b.copyInto=function(c,d){for(let f=0;f<d.length;++f)c[f]=d[f];return c};b.doubleArrayFrom=function(c){return(a.isArray(c)?c.length:c.byteLength/8)<=a.nativeArrayMaxSize?Array.from(c):new Float64Array(c)};b.doubleSubArray=function(c,d,f){return Array.isArray(c)?c.slice(d,
d+f):c.subarray(d,d+f)};b.newDoubleArray=function(c,d=!1){return c<=a.nativeArrayMaxSize?d?Array(c).fill(0):Array(c):new Float64Array(c)};b.toFloat64Array=function(c){return Array.isArray(c)?new Float64Array(c):c};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/FloatArray":function(){define(["exports","../../core/typedArrayUtil"],function(b,a){b.compactFloatArray=function(c){return a.isArray(c)?c.length<a.nativeArrayMaxSize?c:new Float32Array(c):c.length<a.nativeArrayMaxSize?
Array.from(c):c};b.floatArrayFrom=function(c){return(a.isArray(c)?c.length:c.byteLength/8)<=a.nativeArrayMaxSize?Array.from(c):new Float32Array(c)};b.floatSubArray=function(c,d,f){return Array.isArray(c)?c.slice(d,d+f):c.subarray(d,d+f)};b.newFloatArray=function(c,d=!1){return c<=a.nativeArrayMaxSize?d?Array(c).fill(0):Array(c):new Float32Array(c)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/Indices":function(){define(["exports","../../core/typedArrayUtil"],
function(b,a){function c(e){let m=!0;for(const l of e){if(65536<=l)return a.isArray(e)?new Uint32Array(e):e;256<=l&&(m=!1)}return m?new Uint8Array(e):new Uint16Array(e)}function d(e){if(1===e)return k;if(e<a.nativeArrayMaxSize)return Array.from(new Uint16Array(g.buffer,0,e));if(e<g.length)return new Uint16Array(g.buffer,0,e);if(e>n.length){n=new Uint32Array(Math.max(2*n.length,e));for(let m=0;m<n.length;m++)n[m]=m}return new Uint32Array(n.buffer,0,e)}function f(e){if(1===e)return k;if(e<a.nativeArrayMaxSize)return Array(e).fill(0);
e>q.length&&(q=new Uint8Array(Math.max(2*q.length,e)));return new Uint8Array(q.buffer,0,e)}let n=(()=>{const e=new Uint32Array(131072);for(let m=0;m<e.length;++m)e[m]=m;return e})();const k=[0],g=(()=>{const e=new Uint16Array(65536);for(let m=0;m<e.length;++m)e[m]=m;return e})();let q=new Uint8Array(65536);b.compactIndices=function(e){if(a.isArray(e)){if(e.length<a.nativeArrayMaxSize)return e}else if(e.length<a.nativeArrayMaxSize)return Array.from(e);let m=!0,l=!0;e.some((w,v)=>{m=m&&0===w;l=l&&w===
v;return!m&&!l});return m?f(e.length):l?d(e.length):a.isArray(e)||e.BYTES_PER_ELEMENT!==Uint16Array.BYTES_PER_ELEMENT?c(e):e};b.getContinuousIndexArray=d;b.getZeroIndexArray=f;b.newIndexArray=function(e){return e<=a.nativeArrayMaxSize?Array(e):65536>=e?new Uint16Array(e):new Uint32Array(e)};b.newIntArray=function(e){return e<=a.nativeArrayMaxSize?Array(e):new Uint32Array(e)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/BufferVectorMath":function(){define(["exports"],
function(b){b.Vec3Compact=void 0;(function(a){a.length=function(c,d){const f=c[d],n=c[d+1];c=c[d+2];return Math.sqrt(f*f+n*n+c*c)};a.normalize=function(c,d){var f=c[d];const n=c[d+1],k=c[d+2];f=1/Math.sqrt(f*f+n*n+k*k);c[d]*=f;c[d+1]*=f;c[d+2]*=f};a.scale=function(c,d,f){c[d]*=f;c[d+1]*=f;c[d+2]*=f};a.add=function(c,d,f,n,k,g=d){k=k||c;k[g]=c[d]+f[n];k[g+1]=c[d+1]+f[n+1];k[g+2]=c[d+2]+f[n+2]};a.subtract=function(c,d,f,n,k,g=d){k=k||c;k[g]=c[d]-f[n];k[g+1]=c[d+1]-f[n+1];k[g+2]=c[d+2]-f[n+2]}})(b.Vec3Compact||
(b.Vec3Compact={}));Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ContentObjectType":function(){define(["exports"],function(b){b.ContentObjectType=void 0;var a=b.ContentObjectType||(b.ContentObjectType={});a[a.Layer=0]="Layer";a[a.Object=1]="Object";a[a.Mesh=2]="Mesh";a[a.Line=3]="Line";a[a.Point=4]="Point";a[a.Material=5]="Material";a[a.Texture=6]="Texture";a[a.COUNT=7]="COUNT";Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Geometry":function(){define("exports ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../geometry/support/Indices ./AttributeArray ./basicInterfaces ./BoundingInfo ./ContentObject ./ContentObjectType ./geometryDataUtils ./Object3DStateID ./Util ./VertexAttribute ../materials/renderers/utils".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v){class x extends g.ContentObject{constructor(p,h,t=null,r=q.ContentObjectType.Mesh,u=null,y=-1){super();this.material=p;this.mapPositions=t;this.type=r;this.objectAndLayerIdColor=u;this.edgeIndicesLength=y;this.visible=!0;this._attributes=new Map;this._boundingInfo=null;for(const [z,A]of h)this._attributes.set(z,{...A,indices:d.compactIndices(A.indices)}),z===w.VertexAttribute.POSITION&&(this.edgeIndicesLength=0>this.edgeIndicesLength?this._attributes.get(z).indices.length:
this.edgeIndicesLength)}instantiate(p={}){const h=new x(p.material||this.material,[],this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);this._attributes.forEach((t,r)=>{t.exclusive=!1;h._attributes.set(r,t)});h._boundingInfo=this._boundingInfo;h.transformation=p.transformation||this.transformation;return h}get attributes(){return this._attributes}getMutableAttribute(p){let h=this._attributes.get(p);h&&!h.exclusive&&(h={...h,exclusive:!0,data:f.cloneAttributeData(h.data)},
this._attributes.set(p,h));return h}setAttributeData(p,h){const t=this._attributes.get(p);t&&this._attributes.set(p,{...t,exclusive:!0,data:h})}get indexCount(){return this._attributes.values().next().value.indices?.length??0}get faceCount(){return this.indexCount/3}get boundingInfo(){null==this._boundingInfo&&(this._boundingInfo=this._calculateBoundingInfo());return this._boundingInfo}computeAttachmentOrigin(p){return(this.type===q.ContentObjectType.Mesh?this._computeAttachmentOriginTriangles(p):
this.type===q.ContentObjectType.Line?this._computeAttachmentOriginLines(p):this._computeAttachmentOriginPoints(p))?(null!=this._transformation&&c.transformMat4(p,p,this._transformation),!0):!1}_computeAttachmentOriginTriangles(p){const h=this.attributes.get(w.VertexAttribute.POSITION);return e.computeAttachmentOriginTriangles(h,p)}_computeAttachmentOriginLines(p){const h=this.attributes.get(w.VertexAttribute.POSITION);var t=e.computeAttachmentOriginLines;var r=this.material.parameters;r="isClosed"in
r&&r.isClosed?2<h.indices.length:!1;return t.call(e,h,r,p)}_computeAttachmentOriginPoints(p){const h=this.attributes.get(w.VertexAttribute.POSITION);return e.computeAttachmentOriginPoints(h,p)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const p=this.attributes.get(w.VertexAttribute.POSITION);if(!p||0===p.indices.length)return null;const h=this.type===q.ContentObjectType.Mesh?3:1;l.assert(0===p.indices.length%h,"Indexing error: "+p.indices.length+" not divisible by "+
h);const t=d.getContinuousIndexArray(p.indices.length/h);return new k.BoundingInfo(t,h,p)}get transformation(){return this._transformation??a.IDENTITY}set transformation(p){this._transformation=p&&p!==a.IDENTITY?a.clone(p):null}addHighlight(){const p=new m.Object3DStateID(n.Object3DState.Highlight);this.highlights=v.addObject3DStateID(this.highlights,p);return p}removeHighlight(p){this.highlights=v.removeObject3DStateID(this.highlights,p)}}b.Geometry=x;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/lib/AttributeArray":function(){define(["exports","../../../../core/typedArrayUtil"],function(b,a){b.cloneAttributeData=function(c){if(c.length<a.nativeArrayMaxSize)return Array.from(c);if(a.isArray(c))return Float64Array.from(c);if(!("BYTES_PER_ELEMENT"in c))return Array.from(c);switch(c.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(c);case 2:return a.isUint16Array(c)?Uint16Array.from(c):Int16Array.from(c);case 4:return Float32Array.from(c);default:case 8:return Float64Array.from(c)}};
Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/BoundingInfo":function(){define(["exports","../../../../core/PooledArray","../../../../chunks/vec3","../../../../chunks/vec3f64","./Util"],function(b,a,c,d,f){class n{constructor(g,q,e){this.primitiveIndices=g;this._numIndexPerPrimitive=q;this.position=e;this._children=void 0;f.assert(1<=g.length);f.assert(3===e.size||4===e.size);const {data:m,size:l,indices:w}=e;f.assert(0===w.length%this._numIndexPerPrimitive);
f.assert(w.length>=g.length*this._numIndexPerPrimitive);var v=g.length;q=l*w[this._numIndexPerPrimitive*g[0]];k.clear();k.push(q);e=d.fromValues(m[q],m[q+1],m[q+2]);var x=d.clone(e);for(var p=0;p<v;++p){var h=this._numIndexPerPrimitive*g[p];for(var t=0;t<this._numIndexPerPrimitive;++t){q=l*w[h+t];k.push(q);let r=m[q];e[0]=Math.min(r,e[0]);x[0]=Math.max(r,x[0]);r=m[q+1];e[1]=Math.min(r,e[1]);x[1]=Math.max(r,x[1]);r=m[q+2];e[2]=Math.min(r,e[2]);x[2]=Math.max(r,x[2])}}this.bbMin=e;this.bbMax=x;g=c.lerp(d.create(),
this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(x[0]-e[0],x[1]-e[1]),x[2]-e[2]);e=this.radius*this.radius;for(x=0;x<k.length;++x)q=k.at(x),v=m[q]-g[0],p=m[q+1]-g[1],q=m[q+2]-g[2],h=v*v+p*p+q*q,h<=e||(h=Math.sqrt(h),t=.5*(h-this.radius),this.radius+=t,e=this.radius*this.radius,h=t/h,g[0]+=v*h,g[1]+=p*h,g[2]+=q*h);this.center=g;k.clear()}getChildren(){if(this._children||1>=c.squaredDistance(this.bbMin,this.bbMax))return this._children;var g=c.lerp(d.create(),this.bbMin,this.bbMax,.5),q=this.primitiveIndices.length;
const e=new Uint8Array(q),m=Array(8);for(var l=0;8>l;++l)m[l]=0;const {data:w,size:v,indices:x}=this.position;for(l=0;l<q;++l){var p=0;const t=this._numIndexPerPrimitive*this.primitiveIndices[l];var h=v*x[t];let r=w[h],u=w[h+1],y=w[h+2];for(let z=1;z<this._numIndexPerPrimitive;++z){h=v*x[t+z];const A=w[h],C=w[h+1];h=w[h+2];A<r&&(r=A);C<u&&(u=C);h<y&&(y=h)}r<g[0]&&(p|=1);u<g[1]&&(p|=2);y<g[2]&&(p|=4);e[l]=p;++m[p]}g=0;for(l=0;8>l;++l)0<m[l]&&++g;if(!(2>g)){g=Array(8);for(l=0;8>l;++l)g[l]=0<m[l]?new Uint32Array(m[l]):
void 0;for(l=0;8>l;++l)m[l]=0;for(l=0;l<q;++l)p=e[l],g[p][m[p]++]=this.primitiveIndices[l];this._children=[];for(q=0;8>q;++q)void 0!==g[q]&&this._children.push(new n(g[q],this._numIndexPerPrimitive,this.position));return this._children}}static prune(){k.prune()}}const k=new a({deallocator:null});b.BoundingInfo=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ContentObject":function(){define(["exports","../../../../core/uid"],function(b,a){class c{constructor(){this.id=
a.generateUID()}}b.ContentObject=c;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/geometryDataUtils":function(){define(["exports","../../../../chunks/vec3","../../../../chunks/vec3f64","../../../../geometry/support/triangle"],function(b,a,c,d){const f=c.create(),n=c.create(),k=c.create(),g=c.create();b.computeAttachmentOriginLines=function(q,e,m){if(!q)return!1;a.set(m,0,0,0);a.set(g,0,0,0);let l=0,w=0;const {size:v,data:x,indices:p}=q;q=p.length-1;
e=q+(e?2:0);for(let t=0;t<e;t+=2){var h=p[t<q?t:q]*v;const r=p[t<q?t+1:0]*v;f[0]=x[h];f[1]=x[h+1];f[2]=x[h+2];n[0]=x[r];n[1]=x[r+1];n[2]=x[r+2];a.scale(f,a.add(f,f,n),.5);h=a.dist(f,n);0<h?(a.add(m,m,a.scale(f,f,h)),l+=h):0===l&&(a.add(g,g,f),w++)}return 0!==l?(a.scale(m,m,1/l),!0):0!==w?(a.scale(m,g,1/w),!0):!1};b.computeAttachmentOriginPoints=function(q,e){if(!q)return!1;const {size:m,data:l,indices:w}=q;a.set(e,0,0,0);q=-1;let v=0;for(let x=0;x<w.length;x++){const p=w[x]*m;q!==p&&(e[0]+=l[p],e[1]+=
l[p+1],e[2]+=l[p+2],v++);q=p}1<v&&a.scale(e,e,1/v);return 0<v};b.computeAttachmentOriginTriangles=function(q,e){if(!q)return!1;const {size:m,data:l,indices:w}=q;a.set(e,0,0,0);a.set(g,0,0,0);let v=q=0;for(let p=0;p<w.length-2;p+=3){var x=w[p]*m;const h=w[p+1]*m,t=w[p+2]*m;a.set(f,l[x],l[x+1],l[x+2]);a.set(n,l[h],l[h+1],l[h+2]);a.set(k,l[t],l[t+1],l[t+2]);(x=d.areaPoints3d(f,n,k))?(a.add(f,f,n),a.add(f,f,k),a.scale(f,f,1/3*x),a.add(e,e,f),q+=x):(a.add(g,g,f),a.add(g,g,n),a.add(g,g,k),v+=3)}return 0===
v&&0===q?!1:0!==q?(a.scale(e,e,1/q),!0):0!==v?(a.scale(e,g,1/v),!0):!1};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/triangle":function(){define("exports ../../core/ObjectStack ../../chunks/vec3 ../../chunks/vec3f64 ./lineSegment ./vectorStacks".split(" "),function(b,a,c,d,f,n){function k(v){return v?{p0:d.clone(v.p0),p1:d.clone(v.p1),p2:d.clone(v.p2)}:{p0:d.create(),p1:d.create(),p2:d.create()}}function g(v,x,p,h=k()){c.copy(h.p0,v);c.copy(h.p1,x);c.copy(h.p2,
p);return h}function q(v,x,p){return.5*Math.abs((x[0]-v[0])*(p[1]-v[1])-(x[1]-v[1])*(p[0]-v[0]))}const e=new a.ObjectStack(f.create),m=new a.ObjectStack(()=>k()),l=d.create(),w=d.create();b.area2d=function(v){return q(v.p0,v.p1,v.p2)};b.areaPoints2d=q;b.areaPoints3d=function(v,x,p){c.subtract(l,x,v);c.subtract(w,p,v);return c.length(c.cross(l,l,w))/2};b.copy=function(v,x=k()){return g(v.p0,v.p1,v.p2,x)};b.create=k;b.distance2=function(v,x){var p=v.p0,h=v.p1;v=v.p2;const t=c.subtract(n.sv3d.get(),
h,p),r=c.subtract(n.sv3d.get(),v,h),u=c.subtract(n.sv3d.get(),p,v),y=c.subtract(n.sv3d.get(),x,p);var z=c.subtract(n.sv3d.get(),x,h),A=c.subtract(n.sv3d.get(),x,v);const C=c.cross(t,t,u),E=c.dot(c.cross(n.sv3d.get(),t,C),y);z=c.dot(c.cross(n.sv3d.get(),r,C),z);A=c.dot(c.cross(n.sv3d.get(),u,C),A);if(0<E&&0<z&&0<A)return x=c.dot(C,y),x*x/c.dot(C,C);p=f.distance2(f.fromValues(p,t,e.get()),x);h=f.distance2(f.fromValues(h,r,e.get()),x);x=f.distance2(f.fromValues(v,u,e.get()),x);return Math.min(p,h,x)};
b.fromValues=g;b.intersectRay=function(v,x,p){const {direction:h,origin:t}=x,{p0:r,p1:u,p2:y}=v;var z=u[0]-r[0],A=u[1]-r[1],C=u[2]-r[2];v=y[0]-r[0];x=y[1]-r[1];const E=y[2]-r[2];var B=h[1]*E-x*h[2],D=h[2]*v-E*h[0];const F=h[0]*x-v*h[1];var K=z*B+A*D+C*F;if(-1E-5<K&&1E-5>K)return!1;K=1/K;const L=t[0]-r[0],G=t[1]-r[1],O=t[2]-r[2];B=K*(L*B+G*D+O*F);if(0>B||1<B)return!1;D=G*C-A*O;C=O*z-C*L;z=L*A-z*G;A=K*(h[0]*D+h[1]*C+h[2]*z);if(0>A||1<B+A)return!1;p&&(c.scale(p,h,K*(v*D+x*C+E*z)),c.add(p,t,p));return!0};
b.wrap=function(v,x,p){const h=m.get();h.p0=v;h.p1=x;h.p2=p;return h};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Object3DStateID":function(){define(["exports","../../../../core/uid"],function(b,a){class c{constructor(d){this.channel=d;this.id=a.generateUID()}}b.Object3DStateID=c;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/utils":function(){define(["exports","../../../../../chunks/vec3f64",
"../../../../webgl/doublePrecisionUtils"],function(b,a,c){const d=a.create(),f=new Float32Array(6);b.addObject3DStateID=function(n,k){null==n&&(n=[]);n.push(k);return n};b.encodeDoubleVec3=function(n,k,g,q,e){d[0]=n.get(k,0);d[1]=n.get(k,1);d[2]=n.get(k,2);c.encodeDoubleArray(d,f,3);g.set(e,0,f[0]);q.set(e,0,f[1]);g.set(e,1,f[2]);q.set(e,1,f[3]);g.set(e,2,f[4]);q.set(e,2,f[5])};b.removeObject3DStateID=function(n,k){if(null==n)return null;n=n.filter(g=>g!==k);return 0===n.length?null:n};Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/MarsAtmosphere":function(){define("../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec2 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/ellipsoidUtils ../../../geometry/support/FloatArray ./AtmosphereType ./atmosphereUtils ../../../chunks/SimpleAtmosphere.glsl ./SimpleAtmosphereTechnique ./SimpleAtmosphereTechniqueConfiguration ./resources/MarsAtmosphereTexture ../support/mathUtils ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/Util ../webgl-engine/lib/VertexArrayObject ../webgl-engine/lib/VertexAttribute ../../webgl/BufferObject ../../webgl/enums ../../webgl/Texture ../../webgl/TextureDescriptor ../../webgl/Util".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A,C,E,B,D,F,K){function L(M,V,Y,W,H){const S=k.length(M),I=W*Math.sqrt(S*S-W*W)/S,Q=H.v1,N=H.v2;k.scale(H.center,M,Math.sqrt(W*W-I*I)/S);k.cross(Q,M,V);1>k.squaredLength(Q)&&k.cross(Q,M,Y);k.scale(Q,Q,I/k.length(Q));k.cross(N,Q,M);k.scale(N,N,I/k.length(N));return I}const G=-l.innerAtmosphereDepth,O=h.makePiecewiseLinearFunction([[50,.1015625],[500,.21875],[5E3,.51171875],[5E4,.4140625]]);class P{constructor(M,V){this.view=M;this.type=m.AtmosphereType.Mars;
this._passParameters=new w.SimpleAtmospherePassParameters;this._vaoCount=0;this._texV1=1;M=q.getReferenceEllipsoid(M.spatialReference);this._planetRadius=M.radius;this._outerRimWidth=M.outerAtmosphereRimWidth;this._innerRimFactor=(this._planetRadius+G)/this._planetRadius;this._middleRimFactor=(this._planetRadius+0)/this._planetRadius;this._outerRimFactor=(this._planetRadius+this._outerRimWidth)/this._planetRadius;this._texV0=0/this._outerRimWidth;this._texVScale=this._texV1-this._texV0;this._techniqueRepository=
V.techniqueRepository;M=V.renderContext.rctx;this._cameraChangeHandle=c.watch(()=>this.view.state?.camera,()=>V.requestRender(),c.syncAndInitial);this._vao=this._createRibbon(M);this._vaoCount=K.vertexCount(this._vao,"geometry");this._fadeVao=y.createQuadVAO(M);this._fadeVaoCount=K.vertexCount(this._fadeVao,"geometry");const Y=new F.TextureDescriptor;Y.wrapMode=B.TextureWrapMode.CLAMP_TO_EDGE;Y.flipped=!0;Y.width=1;Y.height=512;this._passParameters.texture=new D.Texture(M,Y,p.marsAtmosphereTextureSimple);
M=new x.SimpleAtmosphereTechniqueConfiguration;M.geometry=x.SimpleAtmosphereGeometry.Cone;this._coneTechnique=this._techniqueRepository.acquire(v.SimpleAtmosphereTechnique,M);M.geometry=x.SimpleAtmosphereGeometry.Underground;this._undergroundTechnique=this._techniqueRepository.acquire(v.SimpleAtmosphereTechnique,M)}destroy(){this._coneTechnique.release();this._undergroundTechnique.release();this._cameraChangeHandle.remove();this._passParameters.texture=a.disposeMaybe(this._passParameters.texture);
this._fadeVao.dispose();this._vao.dispose()}render(M){this._update(M.bindParameters.camera);const V=M.rctx;1>this._passParameters.undergroundFadeAlpha&&(V.bindTechnique(this._coneTechnique,this._passParameters,M.bindParameters),V.bindVAO(this._vao),V.drawArrays(B.PrimitiveType.TRIANGLES,0,this._vaoCount));0<this._passParameters.undergroundFadeAlpha&&(V.bindTechnique(this._undergroundTechnique,this._passParameters,M.bindParameters),V.bindVAO(this._fadeVao),V.drawArrays(B.PrimitiveType.TRIANGLE_STRIP,
0,this._fadeVaoCount))}renderHaze(){}_update(M){var V=g.create();const Y=this._planetRadius;var W=k.length(M.eye);const H=W-Y;this._passParameters.undergroundFadeAlpha=0>H?Math.min(-H/5E3,1):0;var S=Y+G,I=Y+Math.max(50,H);this._passParameters.innerScale=I*I/(Math.sqrt(I*I-Y*Y)*Math.sqrt(I*I-S*S)+Y*S)-1;this._passParameters.altitudeFade=l.computeInnerAltitudeFade(H);k.scale(V,M.eye,(Y+50)/W);L(V,M.center,M.up,Y,this._passParameters.silhouette);V=this._computeScreenRimWidth(M,V,M.up,this._passParameters.silhouette);
W=O(H);S=this._texV0+.001953125*this._texVScale;I=this._texV0+V*W*this._texVScale;50<H&&(L(M.eye,M.center,M.up,Y,this._passParameters.silhouette),M=this._computeScreenRimWidth(M,M.eye,M.up,this._passParameters.silhouette),M=b.clamp((M-1.5)/(V-1.5),0,1),S=this._texV0+.001953125*M*this._texVScale,I=this._texV0+b.lerp(this._texV1,V*W,M)*this._texVScale);n.set(this._passParameters.texV,S,I)}_createRibbon(M){const V=e.newFloatArray(1155),Y=new Uint32Array(1920);V[0]=0;V[1]=0;V[2]=-1;for(var W=0;128>W;W++){var H=
9*W+3;V[H]=W;V[H+1]=this._innerRimFactor;V[H+2]=-1;V[H+3]=W;V[H+4]=this._middleRimFactor;V[H+5]=0;V[H+6]=W;V[H+7]=this._outerRimFactor;V[H+8]=1;H=3*W+1;var S=127===W?1:H+3,I=15*W;Y[I]=H;Y[I+1]=H+1;Y[I+2]=S+1;Y[I+3]=S+1;Y[I+4]=S;Y[I+5]=H;Y[I+6]=H+1;Y[I+7]=H+2;Y[I+8]=S+2;Y[I+9]=S+2;Y[I+10]=S+1;Y[I+11]=H+1;Y[I+12]=H;Y[I+13]=S;Y[I+14]=0}W=U.createBuffer(Y.length);H=W.position;for(S=0;S<Y.length;++S)I=3*Y[S],H.set(S,0,V[I]),H.set(S,1,V[I+1]),H.set(S,2,V[I+2]);return new A.VertexArrayObject(M,u.Default3D,
{geometry:t.glLayout(U)},{geometry:E.BufferObject.createVertex(M,B.Usage.STATIC_DRAW,W.buffer)})}_computeScreenRimWidth(M,V,Y,W){k.add(R,W.center,W.v2);k.scale(X,R,this._outerRimFactor);d.lookAt(J,V,R,Y);z.project(R,J,M.projectionMatrix,M.viewport,R);z.project(X,J,M.projectionMatrix,M.viewport,X);return k.distance(R,X)/M.height}}const J=f.create(),R=g.create(),X=g.create(),U=r.newLayout().vec3f(C.VertexAttribute.POSITION);return P})},"esri/views/3d/environment/resources/MarsAtmosphereTexture":function(){define(["exports"],
function(b){const a=new Uint8ClampedArray([0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,16,0,0,0,16,0,0,0,16,0,0,0,17,0,0,0,17,0,0,
0,18,0,0,0,18,0,0,0,19,0,0,0,19,0,0,0,19,0,0,0,20,0,0,0,20,0,0,0,21,0,0,0,21,0,0,0,22,0,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,28,9,0,0,28,9,0,0,29,9,0,0,29,8,0,0,30,8,0,0,30,8,0,0,31,8,0,0,31,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,33,8,0,0,33,8,0,0,34,7,0,0,35,7,0,0,35,7,0,0,36,7,0,0,36,7,7,0,37,7,7,0,37,7,7,0,38,7,7,0,38,13,7,0,39,13,7,0,39,13,6,0,40,13,6,0,40,12,6,0,41,12,6,0,41,12,6,0,41,12,
6,0,42,12,6,0,42,12,6,0,43,12,6,0,43,12,6,0,44,12,6,0,44,11,6,0,45,11,6,6,45,11,6,6,46,11,5,5,47,11,5,5,47,11,5,5,48,11,5,5,48,10,5,5,49,10,5,5,49,10,5,5,50,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,52,15,5,5,52,14,5,5,53,14,5,5,54,14,5,5,54,14,5,5,55,14,5,5,55,14,5,5,56,13,4,4,57,13,4,4,57,13,4,4,58,13,4,4,58,13,4,4,59,13,4,4,59,17,4,4,60,17,4,4,60,17,4,4,60,17,4,4,61,17,4,4,61,16,4,4,62,16,4,4,63,16,4,4,63,16,8,4,64,16,8,4,64,16,8,4,65,15,8,4,66,15,8,4,66,15,8,4,67,19,8,4,68,19,8,4,68,18,7,
4,69,18,7,4,69,18,7,4,69,18,7,4,70,18,7,4,70,18,7,4,71,18,7,4,71,18,7,4,72,17,7,3,73,17,7,3,73,21,7,3,74,21,7,3,74,20,7,3,75,20,7,3,76,20,7,3,76,20,7,3,77,20,7,3,77,20,7,3,78,20,7,3,78,20,7,7,78,19,6,6,79,19,10,6,80,19,10,6,80,22,9,6,81,22,9,6,81,22,9,6,82,22,9,6,83,22,9,6,83,21,9,6,84,21,9,6,84,21,9,6,85,21,9,6,86,21,9,6,86,23,9,6,87,23,9,6,87,23,9,6,87,23,9,6,88,23,9,6,88,23,9,6,89,23,8,6,90,23,8,6,90,22,8,6,91,22,8,6,91,25,8,6,92,25,8,5,93,25,8,5,93,24,8,5,94,24,8,5,94,24,11,5,95,24,11,5,96,24,
11,5,96,26,11,5,97,26,11,5,97,26,11,5,97,26,10,5,98,26,10,5,98,26,10,5,99,25,10,5,100,25,10,5,100,25,10,5,101,25,10,5,101,25,10,5,102,27,10,5,103,27,10,5,103,27,10,5,104,27,10,5,104,27,12,5,105,26,12,5,106,26,12,5,106,29,12,5,106,29,12,5,106,29,12,7,107,28,12,7,108,28,12,7,108,28,12,7,109,28,12,7,109,30,12,7,110,30,11,7,111,30,11,7,111,30,11,7,112,30,11,7,112,29,11,7,113,29,11,7,114,29,11,7,114,31,11,7,115,31,11,7,115,31,11,7,115,31,11,7,116,31,11,7,116,33,13,7,117,33,13,9,117,32,13,9,118,32,13,9,
118,32,13,9,119,34,15,8,120,34,15,8,120,34,15,8,121,36,15,8,121,36,15,8,122,36,15,8,122,35,15,8,123,37,14,8,124,37,14,8,124,37,14,8,124,37,14,8,124,39,14,8,125,39,16,8,125,38,16,8,126,38,16,8,127,38,16,8,127,40,16,10,128,40,16,10,128,40,16,10,129,42,18,10,129,41,18,10,130,41,18,10,130,43,18,10,131,43,18,10,131,42,17,10,132,42,17,12,132,42,17,12,133,44,17,12,133,44,17,12,133,46,17,11,134,46,17,11,134,45,19,11,135,45,19,11,135,47,19,11,136,47,19,11,136,47,19,11,137,47,19,11,137,48,20,11,138,48,20,11,
138,50,20,13,139,50,20,13,139,49,20,13,140,49,22,13,140,51,22,13,141,51,22,13,141,50,22,13,142,52,22,13,142,52,21,12,143,53,21,12,143,53,21,12,143,53,21,12,143,53,21,14,144,53,23,14,144,55,23,14,145,55,23,14,145,56,23,14,146,56,23,14,146,57,24,14,147,57,24,14,147,59,24,16,148,59,24,16,148,58,24,15,149,58,26,15,149,58,26,15,149,60,26,15,150,60,26,15,150,61,25,15,151,61,25,15,151,62,25,17,152,62,25,17,152,64,25,17,152,64,27,17,152,63,27,17,153,63,27,17,153,65,27,17,153,66,28,17,154,66,28,17,154,67,
28,16,155,67,28,16,155,67,30,16,155,69,29,18,156,69,29,18,156,68,29,18,157,70,29,18,157,70,29,18,157,71,31,18,158,71,31,18,158,72,30,19,159,72,30,19,159,74,30,19,159,73,30,19,160,73,32,19,160,74,32,19,161,74,32,21,161,76,32,21,161,78,33,21,161,78,33,21,161,79,35,20,162,78,34,20,163,79,34,22,164,81,36,22,164,82,36,22,165,81,35,22,166,82,37,21,167,84,37,21,167,85,36,21,168,86,38,23,169,88,38,23,169,88,38,23,170,88,39,23,170,89,39,24,171,91,40,24,171,92,40,24,172,93,40,24,173,94,41,25,173,95,41,25,174,
96,42,25,175,98,42,25,175,99,43,26,176,99,43,26,177,101,45,26,177,102,44,26,178,103,46,27,179,104,46,27,179,105,46,27,179,106,45,28,180,108,47,28,180,108,46,28,181,109,48,28,182,111,48,29,182,111,49,29,183,114,49,29,184,114,50,30,184,114,50,30,185,116,51,30,185,117,51,30,186,119,52,31,187,119,53,31,187,121,53,31,188,122,54,33,188,123,54,32,189,124,55,32,189,125,55,32,189,126,56,34,190,128,56,34,190,128,57,33,191,130,57,33,191,131,58,35,192,131,58,35,192,133,59,34,193,134,60,35,194,135,60,35,194,136,
61,37,195,139,61,37,195,139,62,36,196,141,62,36,196,141,63,38,197,142,63,38,197,143,64,39,198,144,64,39,198,146,66,39,198,146,67,39,198,147,67,38,199,147,68,40,199,149,68,40,200,150,69,40,200,152,70,41,201,154,71,41,201,154,71,42,202,155,72,42,202,156,73,41,203,157,73,43,203,158,74,42,204,160,75,44,204,161,76,44,204,162,77,44,205,164,77,45,205,165,78,45,206,166,79,45,206,168,80,46,207,169,81,46,207,170,83,47,207,171,83,47,207,172,83,47,207,174,85,48,208,175,85,48,208,177,85,48,209,178,87,49,209,180,
87,49,210,181,87,49,210,182,89,50,210,182,89,50,211,185,91,50,211,186,91,51,212,186,93,51,212,189,94,52,212,190,95,51,213,192,96,51,213,193,96,53,213,194,97,52,214,195,98,54,214,197,98,55,215,198,100,55,215,199,101,55,215,200,102,55,216,202,103,55,216,203,104,55,216,204,105,57,216,205,106,57,216,207,107,58,216,208,108,58,217,209,109,59,217,210,110,60,217,211,111,60,218,212,112,61,218,213,113,61,218,214,114,62,219,217,115,63,219,217,116,64,219,218,118,64,220,219,119,65,220,220,121,66,220,222,121,67,
221,222,122,67,221,222,123,68,221,223,124,69,222,224,125,70,222,225,127,71,222,226,128,72,223,228,129,73,223,228,130,74,223,229,132,75,223,230,135,79,224,231,138,81,224,233,141,84,224,233,144,87,225,235,147,91,225,236,150,94,225,237,154,97,225,238,158,102,225,239,161,107,225,239,165,110,225,240,168,114,226,241,172,118,226,241,176,122,226,241,181,126,226,242,183,130,227,243,186,135,227,243,190,139,227,244,194,143,227,244,197,147,228,244,200,150,228,245,204,154,228,245,207,157,228,245,210,161,229,246,
212,164,229,246,215,167,229,246,217,169,229,246,220,172,230,247,221,174,230]);b.marsAtmosphereTextureSimple=a;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/Precipitation":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/mathUtils ../../../core/maybe ../../../core/time ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../core/support/UpdatingHandles ../../../geometry/ellipsoidUtils ./PrecipitationTechnique ./PrecipitationTechniqueConfiguration ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/AnimationTimer ../webgl-engine/lib/VertexArrayObject ../webgl-engine/lib/VertexAttribute ../../webgl/BufferObject ../../webgl/enums ../../webgl/Util".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A){b.Precipitation=class extends c{constructor(B){super(B);this._numParticles=25E4;this._rainSpeed=.1;this._snowSpeed=.01;this._passParameters=new v.PrecipitationPassParameters;this._animation=new t.AnimationTimer;this._updatingTracking=new l.UpdatingHandles;this._passParameters.time=0;this._passParameters.radius=w.getReferenceEllipsoid(B.view.spatialReference).radius;this._techniqueRepository=B.context.techniqueRepository}destroy(){this._updatingTracking.destroy();
this._numParticles=0;this._snowTechniqueCached=f.releaseMaybe(this._snowTechniqueCached);this._rainTechniqueCached=f.releaseMaybe(this._rainTechniqueCached);this._vao=f.disposeMaybe(this._vao);this._instanceIdBuffer=f.disposeMaybe(this._instanceIdBuffer)}get updating(){return this._updatingTracking.updating}get _rainTechnique(){if(null==this._rainTechniqueCached){const B=new x.PrecipitationTechniqueConfiguration;B.type=x.PrecipitationType.Rain;this._rainTechniqueCached=this._techniqueRepository.acquire(v.PrecipitationTechnique,
B)}return this._rainTechniqueCached}get _snowTechnique(){if(null==this._snowTechniqueCached){const B=new x.PrecipitationTechniqueConfiguration;B.type=x.PrecipitationType.Snow;this._snowTechniqueCached=this._techniqueRepository.acquire(v.PrecipitationTechnique,B)}return this._snowTechniqueCached}update(B){return this._animation.advance(B)}render(B,D,F){const K="rainy"===F?this._rainTechnique:this._snowTechnique;if(K.compiled){var L=B.rctx;this._ensureResources(L);null!=K&&null!=this._vao&&null!=this._instanceIdBuffer&&
(null!=B.bindParameters.cloudsFade.data&&(this._passParameters.opacity=B.bindParameters.cloudsFade.opacity),0>=this._passParameters.opacity||(D=.5>D?d.lerp(0,.35,2*D):d.lerp(.35,1,2*(D-.5)),this._passParameters.time=("rainy"===F?this._rainSpeed:this._snowSpeed)*n.secondsFromMilliseconds(this._animation.time)%1E5,B=L.bindTechnique(K,this._passParameters,B.bindParameters),L.bindVAO(this._vao),B.assertCompatibleVertexAttributeLocations(this._vao),A.bindVertexBufferLayout(L,v.attributeLocations,this._instanceIdBuffer,
E,0),L.drawArraysInstanced(z.PrimitiveType.TRIANGLES,0,3,this._numParticles*D),A.unbindVertexBufferLayout(L,v.attributeLocations,this._instanceIdBuffer,E)))}else this.context.requestRender()}_ensureResources(B){null==this._vao&&(this._vao=this._createVertexArrayObject(B));null==this._instanceIdBuffer&&(this._instanceIdBuffer=this._createInstanceIndices(B))}_createInstanceIndices(B){const D=[];for(let F=0;F<this._numParticles;F++)D.push(F);return y.BufferObject.createVertex(B,z.Usage.STATIC_DRAW,new Float32Array(D))}_createVertexArrayObject(B){const D=
new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new r.VertexArrayObject(B,v.attributeLocations,{geometry:p.glLayout(C)},{geometry:y.BufferObject.createVertex(B,z.Usage.STATIC_DRAW,D)})}};a.__decorate([k.property({constructOnly:!0})],b.Precipitation.prototype,"context",void 0);a.__decorate([k.property({constructOnly:!0})],b.Precipitation.prototype,"view",void 0);a.__decorate([k.property({readOnly:!0})],b.Precipitation.prototype,"updating",null);a.__decorate([k.property()],b.Precipitation.prototype,
"_updatingTracking",void 0);b.Precipitation=a.__decorate([m.subclass("esri.views.3d.environment.Precipitation")],b.Precipitation);const C=h.newLayout().vec3f(u.VertexAttribute.POSITION),E=p.glLayout(h.newLayout().f32(u.VertexAttribute.INSTANCEFEATUREATTRIBUTE),1);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/PrecipitationTechnique":function(){define("require exports ../../../chunks/Precipitation.glsl ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/Program ../webgl-engine/lib/VertexAttribute ../../webgl/enums ../../webgl/renderState".split(" "),
function(b,a,c,d,f,n,k,g,q,e){class m extends d.NoParameters{constructor(){super(...arguments);this.time=0;this.radius=1;this.width=500;this.opacity=1}}class l extends n.ShaderTechnique{initializeProgram(v){return new k.Program(v.rctx,l.shader.get().build(this.configuration),w)}initializePipeline(){return e.makePipelineState({blending:e.separateBlendingParams(q.BlendFactor.ONE,q.BlendFactor.ONE,q.BlendFactor.ONE_MINUS_SRC_ALPHA,q.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:q.CompareFunction.LEQUAL},
colorWrite:e.defaultColorWriteParams})}}l.shader=new f.ReloadableShaderModule(c.Precipitation,()=>new Promise((v,x)=>b(["./Precipitation.glsl"],v,x)));const w=new Map([[g.VertexAttribute.POSITION,0],[g.VertexAttribute.INSTANCEFEATUREATTRIBUTE,1]]);a.PrecipitationPassParameters=m;a.PrecipitationTechnique=l;a.attributeLocations=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Precipitation.glsl":function(){define("exports ./vec3 ./vec3f64 ../views/3d/environment/PrecipitationTechniqueConfiguration ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(b,a,c,d,f,n,k,g,q,e){function m(p){const h=new q.ShaderBuilder;h.attributes.add(e.VertexAttribute.POSITION,"vec3");h.attributes.add(e.VertexAttribute.INSTANCEFEATUREATTRIBUTE,"float");h.vertex.uniforms.add(new f.Float3PassUniform("cameraPosition",(t,r)=>r.camera.eye));h.vertex.uniforms.add(new f.Float3PassUniform("offset",(t,r)=>{r=r.camera.eye;var u=.5*t.width;const y=1/t.width;u=a.floor(l,a.set(l,(r[0]+u)*y,(r[1]+u)*y,(r[2]+u)*y));return a.sub(u,r,a.scale(u,u,t.width))}));h.vertex.uniforms.add(new n.FloatPassUniform("width",
t=>t.width));h.vertex.uniforms.add(new g.Matrix4PassUniform("proj",(t,r)=>r.camera.projectionMatrix));h.vertex.uniforms.add(new g.Matrix4PassUniform("view",(t,r)=>r.camera.viewMatrix));h.vertex.uniforms.add(new n.FloatPassUniform("time",t=>t.time));h.varyings.add("vUv","vec2");h.vertex.code.add(k.glsl`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${p.type===d.PrecipitationType.Rain?k.glsl`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:k.glsl`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `);h.fragment.uniforms.add(new n.FloatPassUniform("opacity",t=>t.opacity),new f.Float3PassUniform("particleColor",(t,r)=>{t=p.type===d.PrecipitationType.Rain?x:v;const u=a.scale(l,t,.7);a.normalize(w,r.camera.eye);r=Math.max(0,a.dot(w,r.lighting.mainLight.direction));return a.lerp(u,u,t,r)}));h.fragment.code.add(k.glsl`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${p.type===d.PrecipitationType.Rain?k.glsl`d = 0.35 * smoothstep(0.5, 0.0, d);`:k.glsl`d = smoothstep(0.5, 0.1, d);`}
      fragColor = opacity * vec4(particleColor * d, d);
    }
  `);return h}const l=c.create(),w=c.create(),v=c.fromValues(1,1,1),x=c.fromValues(.85,.85,.85);c=Object.freeze(Object.defineProperty({__proto__:null,build:m},Symbol.toStringTag,{value:"Module"}));b.Precipitation=c;b.build=m})},"esri/views/3d/environment/PrecipitationTechniqueConfiguration":function(){define(["exports","../../../chunks/tslib.es6","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],function(b,a,c){b.PrecipitationType=void 0;(function(f){f[f.Rain=0]="Rain";f[f.Snow=
1]="Snow";f[f.COUNT=2]="COUNT"})(b.PrecipitationType||(b.PrecipitationType={}));class d extends c.ShaderTechniqueConfiguration{constructor(){super(...arguments);this.type=b.PrecipitationType.Rain}}a.__decorate([c.parameter({count:b.PrecipitationType.COUNT})],d.prototype,"type",void 0);b.PrecipitationTechniqueConfiguration=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/AnimationTimer":function(){define(["exports","../../../../core/time"],function(b,
a){class c{constructor(){this.enabled=!0;this._time=a.Milliseconds(0)}get time(){return this._time}advance({deltaTime:f,fixedTime:n}){if(null!=n){if(this._time===n)return!1;this._time=n;return!0}this._time=a.Milliseconds(this._time+f);return 0!==f}}class d{constructor(f,n){this.deltaTime=f;this.fixedTime=n}}b.AnimationTimer=c;b.Parameters=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/Stars":function(){define("exports ../../../chunks/tslib.es6 ../../../assets ../../../core/Accessor ../../../core/asyncUtils ../../../core/Error ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../core/support/UpdatingHandles ./StarsTechnique ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/VertexArrayObject ../webgl-engine/lib/VertexAttribute ../../webgl/BufferObject ../../webgl/enums".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A,C,E,B){b.Stars=class extends d{get updating(){return this._updatingTracking.updating||this.loading}get loading(){return null!=this._loadDataTask&&!this._loadDataTask.finished}constructor(O){super(O);this._loadDataTask=null;this._numPoints=0;this._renderParameter=new r.StarPassParameters;this._updatingTracking=new t.UpdatingHandles}initialize(){this._loadDataTask=this._createLoadDataTask()}destroy(){this._loadDataTask=g.abortMaybe(this._loadDataTask);
this._updatingTracking.destroy();this._numPoints=0;this._technique=g.releaseMaybe(this._technique);this._vao=g.disposeMaybe(this._vao);G=null}render(O){const {rctx:P}=O;this._ensureResources(P);null!=this._technique&&null!=this._vao&&(this._technique.compiled?(O=P.bindTechnique(this._technique,this._renderParameter,O.bindParameters),P.bindVAO(this._vao),O.assertCompatibleVertexAttributeLocations(this._vao),P.drawArrays(B.PrimitiveType.POINTS,0,this._numPoints)):this.requestRender())}_ensureResources(O){if(null==
this._technique&&null!=G){this._technique=new r.StarsTechnique({rctx:O,viewingMode:this.view.state.viewingMode});this._numPoints=G.byteLength/9;var P=new Float32Array(G,0,2*this._numPoints),J=new Uint8Array(G,8*this._numPoints,this._numPoints);this._vao=this._createVertexArrayObject(O,P,J,this._numPoints);this._updatingTracking.add(()=>"virtual"!==this.view.environment.lighting.type?this.view.environment.lighting.date:null,R=>this._update(R),e.initial)}}_computeDayDuration(O){const P=new Date(O.getFullYear(),
0,1,11,58,56),J=new Date(O.getFullYear()+1,0,1,11,58,55);return(+O-+P)/(+J-+P)}_update(O){if(O){var P=O.getHours()/12,J=O.getMinutes()/60*(2/24),R=O.getSeconds()/60*(2/1440);P=(P+J+R-.9972222)%2;O=2*this._computeDayDuration(O);J=p.copy(this._renderParameter.modelMatrix,K);p.rotateZ(J,J,-O*Math.PI);p.multiply(J,F,J);p.rotateZ(J,J,-P*Math.PI);this.requestRender()}}_hexToRGB(O){return[parseInt(O.substring(0,2),16),parseInt(O.substring(2,4),16),parseInt(O.substring(4,6),16)]}_unpackUint8Attributes(O){return 192<=
O?[2.9,O-192]:160<=O?[2.5,O-160]:128<=O?[2,O-128]:96<=O?[1.5,O-96]:64<=O?[1,O-64]:32<=O?[.7,O-32]:[.4,O]}_createVertexArrayObject(O,P,J,R){const X=L.createBuffer(R),U=X.position,M=X.color,V=X.size;for(let H=0;H<R;H++){var Y=P[2*H],W=P[2*H+1];U.set(H,0,-Math.cos(Y)*Math.sin(W));U.set(H,1,-Math.sin(Y)*Math.sin(W));U.set(H,2,-Math.cos(W));Y=this._unpackUint8Attributes(J[H]);W=this._hexToRGB(D[Y[1]]);M.set(H,0,255*W[0]);M.set(H,1,255*W[1]);M.set(H,2,255*W[2]);M.set(H,3,255);V.set(H,Y[0])}return new A.VertexArrayObject(O,
z.Default3D,{geometry:u.glLayout(L)},{geometry:E.BufferObject.createVertex(O,B.Usage.STATIC_DRAW,X.buffer)})}_createLoadDataTask(){if(null!=G)return null;const O=f.createTask(async P=>{({data:P}=await c.fetchAsset("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:P}));this._verifyStarData(P);G=P});O.promise.catch(P=>{q.isAbortError(P)||k.getLogger(this).error(P)}).then(()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))});return O}_verifyStarData(O){if(!O)throw new n("stars:no-data-received",
"Failed to create stars because star catalogue is missing");O=O.byteLength/9;if(0!==O%1||5E4<O||5E3>O)throw new n("stars:invalid-data","Failed to create stars because star catalogue data is invalid");}};a.__decorate([m.property({constructOnly:!0})],b.Stars.prototype,"view",void 0);a.__decorate([m.property({constructOnly:!0})],b.Stars.prototype,"requestRender",void 0);a.__decorate([m.property({readOnly:!0})],b.Stars.prototype,"updating",null);a.__decorate([m.property()],b.Stars.prototype,"_loadDataTask",
void 0);a.__decorate([m.property()],b.Stars.prototype,"_updatingTracking",void 0);b.Stars=a.__decorate([x.subclass("esri.views.3d.environment.Stars")],b.Stars);const D="9bb2ff;9eb5ff;aabfff;bbccff;ccd8ff ;dae2ff;e4e9ff;eeefff;f8f6ff;fff9fb;fff5ef;fff1e5;ffeddb;ffe9d2;ffe6ca;ffe3c3;ffe0bb;ffddb4;ffdaad;ffd6a5;ffd29c;ffcc8f;ffc178;ffa94b;ff7b00".split(";"),F=h.fromValues(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),K=h.fromValues(1,0,0,0,0,.9174771405229186,
-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),L=y.newLayout().vec3f(C.VertexAttribute.POSITION).vec4u8(C.VertexAttribute.COLOR).f32(C.VertexAttribute.SIZE);let G=null;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/StarsTechnique":function(){define("require exports ../../../chunks/mat4f64 ../../../chunks/Stars.glsl ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l){class w extends f.NoParameters{constructor(){super(...arguments);this.modelMatrix=c.create()}}class v extends k.ShaderTechnique{constructor(x){super(x,new g.ShaderTechniqueConfiguration,()=>this.destroy())}initializeProgram(x){return new e.Program(x.rctx,v.shader.get().build(),q.Default3D)}initializePipeline(){return l.makePipelineState({blending:l.separateBlendingParams(m.BlendFactor.SRC_ALPHA,m.BlendFactor.ONE,m.BlendFactor.ONE_MINUS_SRC_ALPHA,m.BlendFactor.ONE_MINUS_SRC_ALPHA),
depthTest:{func:m.CompareFunction.LEQUAL},colorWrite:l.defaultColorWriteParams})}}v.shader=new n.ReloadableShaderModule(d.Stars,()=>new Promise((x,p)=>b(["./Stars.glsl"],x,p)));a.StarPassParameters=w;a.StarsTechnique=v;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Stars.glsl":function(){define("exports ./mat4 ./mat4f64 ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(b,a,c,d,f,n,k,g,q){function e(){const l=new g.ShaderBuilder;l.attributes.add(q.VertexAttribute.POSITION,"vec3");l.attributes.add(q.VertexAttribute.COLOR,"vec4");l.attributes.add(q.VertexAttribute.SIZE,"float");l.varyings.add("vcolor","vec4");l.varyings.add("vsize","float");l.vertex.uniforms.add(new k.Matrix4PassUniform("transform",(w,v)=>{a.copy(m,v.camera.projectionMatrix);m[10]=2.4E-7-1;m[11]=-1;m[14]=(2.4E-7-2)*v.camera.near;a.multiply(m,m,v.camera.viewMatrix);return a.multiply(m,m,w.modelMatrix)}),
new d.Float4PassUniform("viewport",(w,v)=>v.camera.fullViewport),new f.FloatPassUniform("pixelRatio",(w,v)=>v.camera.pixelRatio));l.vertex.code.add(n.glsl`void main(void) {
gl_Position = transform * vec4(position, 0);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`);l.fragment.code.add(n.glsl`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
fragColor = vec4(vcolor.xyz, intensity);
}`);return l}const m=c.create();c=Object.freeze(Object.defineProperty({__proto__:null,build:e},Symbol.toStringTag,{value:"Module"}));b.Stars=c;b.build=e})},"esri/views/3d/webgl-engine/effects/RenderPlugin":function(){define(["exports","../../../../core/Accessor","../core/shaderLibrary/ShaderOutput"],function(b,a,c){const d={required:[]},f={required:[c.ShaderOutput.Depth]},n={required:[c.ShaderOutput.CompositeColor]},k={required:[c.ShaderOutput.Highlight]};c={required:[c.ShaderOutput.Depth,c.ShaderOutput.Normal]};
class g extends a{consumes(){return d}get usedMemory(){return 0}get isDecoration(){return!1}get running(){return!1}}class q extends g{}class e extends g{}class m extends g{}class l extends g{}class w extends g{}b.ASyncPreparesRenderPlugin=w;b.AsyncRenderPlugin=l;b.ConsumesCompositeColor=n;b.ConsumesDepth=f;b.ConsumesDepthNormal=c;b.ConsumesHighlight=k;b.ConsumesNone=d;b.SyncPrepareRenderPlugin=e;b.SyncPreparesRenderPlugin=m;b.SyncRenderPlugin=q;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/lib/Update":function(){define(["exports"],function(b){b.Update=void 0;var a=b.Update||(b.Update={});a[a.Immediate=0]="Immediate";a[a.Faded=1]="Faded";Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/sunUtils":function(){define("exports ../../../core/mathUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec2 ../../../chunks/vec2f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../ViewingMode ../../../chunks/SunCalc ./mathUtils".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m){function l(V,Y,W){Y===q.ViewingMode.Global?k.normalize(X,V.eye):k.set(X,0,0,1);k.scale(U,V.viewForward,-1);Y=m.angle(U,X);const H=Math.max(Y-.5,0);c.fromRotation(R,-Math.max(.25,Y-.25-.85*H/(H+1)),V.viewRight);k.transformMat4(W,U,R);k.add(W,W,k.scale(M,V.viewRight,.2));k.normalize(W,W)}function w(V,Y,W,H){const S=y,I=c.identity(u);if(W===q.ViewingMode.Global)e.SunCalc.getPosition(V,0,0,S),k.set(H,0,0,-1),c.rotateX(I,I,-S.azimuth),c.rotateY(I,I,-S.altitude);else{var Q=
p.planarDirection;W=Q.globalAngles;Q=(Math.abs(Y[2])-Q.localAltitude)/(Q.globalAltitude-Q.localAltitude);Q=a.clamp(Q,0,1);1>Q?(e.SunCalc.getPosition(V,Y[1],Y[0],S),S.azimuth=(1-Q)*S.azimuth+Q*W.azimuth,S.altitude=(1-Q)*S.altitude+Q*W.altitude):(S.azimuth=W.azimuth,S.altitude=W.altitude);k.set(H,0,-1,0);c.rotateZ(I,I,-S.azimuth);c.rotateX(I,I,-S.altitude)}k.transformMat4(H,H,I)}function v(V){switch(V){case "disabled":case "sunny":return new h(1,1);case "cloudy":return new h(1,1);case "rainy":return new h(.4,
1.2);case "snowy":return new h(.5,1.3);case "foggy":return new h(.2,1.6)}}function x(V,Y){const W=(V[0]+V[1]+V[2])/3;V[0]+=(W-V[0])*Y;V[1]+=(W-V[1])*Y;V[2]+=(W-V[2])*Y}const p={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8E5,ambient:.015,direct:.75},planarDirection:{localAltitude:1E4,globalAltitude:1E6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};class h{constructor(V,Y){this.direct=V;this.ambient=
Y}}const t=g.fromValues(.5773502691896258,-.5773502691896258,.5773502691896258);class r{constructor(){this.ambient={color:g.fromValues(1,1,1),intensity:.55};this.direct={color:g.fromValues(1,1,1),intensity:.55,directionToLightSource:g.clone(t)};this.noonFactor=.5;this.globalFactor=0;this.environmentStrength=this.specularStrength=1}}const u=d.create(),y={azimuth:0,altitude:0},z=g.fromValues(.01,.01,.01),A=g.fromValues(1,.6,.5),C=g.fromValues(1,.98,.98),E=g.fromValues(1,1,1),B=g.fromValues(.8,.8,1),
D=g.fromValues(.8,.8,1),F=g.fromValues(.98,.98,1),K=g.fromValues(1,1,1),L=n.fromValues(.01,p.local.ambientAtNight),G=n.fromValues(p.local.directAtTwilight,p.local.ambientAtTwilight),O=n.fromValues(.9*p.local.directAtNoon,p.local.ambientAtNoon),P=n.fromValues(p.local.directAtNoon,p.local.ambientAtNoon),J=new Date(0),R=d.create(),X=g.create(),U=g.create(),M=g.create();b.ColorAndIntensity=r;b.computeColorAndIntensity=function(V,Y,W,H,S,I){k.set(I.ambient.color,1,1,1);I.ambient.intensity=p.global.ambient;
k.set(I.direct.color,1,1,1);I.direct.intensity=p.global.direct;var Q=a.clamp((Math.abs(Y[2])-p.local.altitude)/(p.global.altitude-p.local.altitude),0,1);I.globalFactor=Q;var N;null!=V&&(N=e.SunCalc.getTimes(V,Y[1],Y[0]));if(1>Q){if(null!=V){var T=N;var aa=V.valueOf();if(T.polarException===e.SunCalc.PolarException.MIDNIGHT_SUN){var Z=aa-36E5*(V.getHours()+48)-6E4*V.getMinutes();T=Z+432E6}else T.polarException===e.SunCalc.PolarException.POLAR_NIGHT?(Z=aa-2,T=aa-1):(Z=T.sunrise.valueOf(),T=T.sunset.valueOf());
var da=T-Z;var fa=Z+da/2,ka=da/4;const ha=fa-ka;ka=fa+ka;da*=.06;const ba=Z-da/2,ea=Z+da/2,ca=T-da/2,ia=T+da/2;Z=n.create();da=g.create();T=g.create();aa<ba||aa>ia?(f.copy(Z,L),k.copy(da,z),k.copy(T,B)):aa<ea?(aa=(aa-ba)/(ea-ba),f.lerp(Z,L,G,aa),k.lerp(da,z,A,aa),k.lerp(T,B,D,aa)):aa<ha?(aa=(aa-ea)/(ha-ea),f.lerp(Z,G,O,aa),k.lerp(da,A,C,aa),k.lerp(T,D,F,aa)):aa<fa?(aa=(aa-ha)/(fa-ha),f.lerp(Z,O,P,aa),k.lerp(da,C,E,aa),k.lerp(T,F,K,aa)):aa<ka?(aa=(aa-fa)/(ka-fa),f.lerp(Z,P,O,aa),k.lerp(da,E,C,aa),
k.lerp(T,K,F,aa)):aa<ca?(aa=(aa-ka)/(ca-ka),f.lerp(Z,O,G,aa),k.lerp(da,C,A,aa),k.lerp(T,F,D,aa)):aa<ia&&(aa=(aa-ca)/(ia-ca),f.lerp(Z,G,L,aa),k.lerp(da,A,z,aa),k.lerp(T,D,B,aa));aa=0;switch(H){case "rainy":case "foggy":aa=.8;break;case "snowy":aa=.5}0<aa&&(x(da,aa),x(T,aa));fa=v(H);aa=Z[0]*fa.direct;Z=Z[1]*fa.ambient}else T=v(H),aa=p.local.directAtNoon*T.direct,da=g.fromValues(1,1,1),Z=p.local.ambientAtNoon*T.ambient,T=g.fromValues(1,1,1);k.lerp(I.ambient.color,T,I.ambient.color,Q);I.ambient.intensity=
a.lerp(Z,I.ambient.intensity,Q);k.lerp(I.direct.color,da,I.direct.color,Q);I.direct.intensity=a.lerp(aa,I.direct.intensity,Q);I.specularStrength="rainy"===H||"snowy"===H||"foggy"===H?0:1;I.environmentStrength="rainy"===H?.7:"snowy"===H||"foggy"===H?.75:1}null!=V?(H=V.valueOf(),N.polarException===e.SunCalc.PolarException.MIDNIGHT_SUN?(Q=H-36E5*(V.getHours()+48)-6E4*V.getMinutes(),N=Q+432E6):N.polarException===e.SunCalc.PolarException.POLAR_NIGHT?(Q=H-2,N=H-1):(Q=N.sunrise.valueOf(),N=N.sunset.valueOf()),
H=1-a.clamp(Math.abs(H-(Q+(N-Q)/2))/432E5,0,1)):H=1;I.noonFactor=H;null!=V?w(V,Y,W,I.direct.directionToLightSource):l(S,W,I.direct.directionToLightSource)};b.computeDirectionsOverTime=function(V,Y,W,H,S){V=V.getTime();Y=Y.getTime()-V;Y=Math.floor(Y/W)+1;const I=Array(Y);for(let Q=0;Q<Y;++Q)J.setTime(V+W*Q),I[Q]=g.create(),w(J,H,S,I[Q]);return I};b.computeShadowsEnabled=function(V,Y){return Y===q.ViewingMode.Global?!0:Math.abs(V)<p.planarDirection.localAltitude};b.computeVirtualLightDirection=l;Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/chunks/SunCalc":function(){define(["exports","./_commonjsHelpers"],function(b,a){var c={exports:{}};c.exports;(function(d){(function(f){f=f();void 0!==f&&(d.exports=f)})(function(){function f(B){return new Date(864E5*(B+.5-2440588))}function n(B,D){return r(x(B)*p(A)-h(D)*x(A),p(B))}function k(B,D){return t(x(D)*p(A)+p(D)*x(A)*x(B))}function g(B,D,F){return r(x(B),p(B)*x(D)-h(F)*p(D))}function q(B,D,F){return t(x(D)*x(F)+p(D)*p(F)*p(B))}function e(B){return y*
(1.9148*x(B)+.02*x(2*B)+3E-4*x(3*B))}function m(B,D){B=y*(357.5291+.98560028*B);var F=e(B);B=B+F+102.9372*y+v;D||(D={dec:0,ra:0});D.dec=k(B,0);D.ra=n(B,0);return D}function l(B,D,F){return 2451545+B+.0053*x(D)-.0069*x(2*F)}function w(B){var D=y*(134.963+13.064993*B),F=y*(93.272+13.22935*B);B=y*(218.316+13.176396*B)+6.289*y*x(D);F=5.128*y*x(F);D=385001-20905*p(D);return{ra:n(B,F),dec:k(B,F),dist:D}}var v=Math.PI,x=Math.sin,p=Math.cos,h=Math.tan,t=Math.asin,r=Math.atan2,u=Math.acos,y=v/180,z={dec:0,
ra:0},A=23.4397*y,C={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(B,D,F,K){F=y*-F;D*=y;var L=B.valueOf()/864E5-.5+2440588-2451545;B=m(L,z);F=y*(280.16+360.9856235*L)-F-B.ra;K||(K={azimuth:0,altitude:0});K.azimuth=g(F,D,B.dec);K.altitude=q(F,D,B.dec);return K}},E=[[-.83,"sunrise","sunset"]];C.addTime=function(B,D,F){E.push([B,D,F])};C.getTimes=function(B,D,F){function K(Y){var W=G,H=R;Y=u((x(Y)-x(W)*x(H))/(p(W)*p(H)));return l(9E-4+(Y+L)/(2*v)+O,P,J)}var L=y*-F,G=y*D,
O=Math.round(B.valueOf()/864E5-.5+2440588-2451545-9E-4-L/(2*v));B=9E-4+(0+L)/(2*v)+O;var P=y*(357.5291+.98560028*B);D=e(P);var J=P+D+102.9372*y+v,R=k(J,0);B=l(B,P,J);D={solarNoon:f(B),nadir:f(B-.5),polarException:C.PolarException.NORMAL};var X;F=0;for(X=E.length;F<X;F+=1){var U=E[F];var M=K(U[0]*y);var V=B-(M-B);D[U[1]]=f(V);D[U[2]]=f(M)}D.polarException=function(Y){Y=(x(Y)-x(G)*x(R))/(p(G)*p(R));return-1>Y?C.PolarException.MIDNIGHT_SUN:1<Y?C.PolarException.POLAR_NIGHT:C.PolarException.NORMAL}(E[0][0]*
y);return D};C.getMoonPosition=function(B,D,F){F=y*-F;D*=y;var K=B.valueOf()/864E5-.5+2440588-2451545;B=w(K);F=y*(280.16+360.9856235*K)-F-B.ra;K=q(F,D,B.dec);K+=.017*y/h(K+10.26*y/(K+5.1*y));return{azimuth:g(F,D,B.dec),altitude:K,distance:B.dist}};C.getMoonFraction=function(B){var D=B.valueOf()/864E5-.5+2440588-2451545;B=m(D);D=w(D);B=u(x(B.dec)*x(D.dec)+p(B.dec)*p(D.dec)*p(B.ra-D.ra));B=r(149598E3*x(B),D.dist-149598E3*p(B));return(1+p(B))/2};return C})})(c);a=a.getDefaultExportFromCjs(c.exports);
b.SunCalc=a})},"esri/views/3d/input/SceneInputManager":function(){define("../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./handlers/DoubleClickZoom ./handlers/DragRotate ./handlers/DragZoom ./handlers/GamepadNavigation ./handlers/KeyboardNavigation ./handlers/MouseWheelZoom ./handlers/PinchAndPanNavigation ./handlers/PointerDownCancelAnimation ./handlers/SingleKeyResetHeading ./handlers/SingleKeyResetTilt ./handlers/TwoFingerTilt ../../input/BrowserEventSource ../../input/InputManager ../../input/handlers/PreventContextMenu ../../input/recognizers/Drag ../../input/recognizers/ImmediateDoubleClick ../../input/recognizers/PointerClickHoldAndDrag ../../input/recognizers/SingleAndDoubleClick ../../input/recognizers/VerticalTwoFingerDrag ../state/controllers/RotateController".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A,C,E,B,D,F,K){a=class extends a{destroy(){this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(G){"pan"!==G&&"rotate"!==G||G===this._get("primaryDragAction")||(this._set("primaryDragAction",G),this._updateMode())}get mode(){return this._get("mode")}set mode(G){"default"!==G&&"pro"!==G||G===this._get("mode")||(this._set("mode",G),this._updateMode())}get updating(){return!!this._inputManager?.updating}get latestPointerType(){return this._inputManager?.latestPointerType}get latestPointerLocation(){return this._inputManager?.latestPointerLocation}get multiTouchActive(){return this._inputManager?.multiTouchActive??
!1}disconnect(){this.view.viewEvents.disconnect();this._inputManager=c.destroyMaybe(this._inputManager)}connect(){const G=this.view;this._source=new y.BrowserEventSource(this.view.surface,G.input);var O=[new E.ImmediateDoubleClick,new B.PointerClickHoldAndDrag,new D.SingleAndDoubleClick,new C.Drag(this.view.navigation),new F.VerticalTwoFingerDrag];this._inputManager=O=new z.InputManager({eventSource:this._source,recognizers:O});O.installHandlers("prevent-context-menu",[new A.PreventContextMenu],z.ViewEventPriorities.INTERNAL);
this._modeDragPan=new p.PinchAndPanNavigation(G,"primary");this._modeDragRotate=new m.DragRotate(G,"secondary",K.PivotPoint.CENTER);this._modeDragZoom=new l.DragZoom(G,"tertiary");O.installHandlers("navigation",[new h.PointerDownCancelAnimation(G),new e.DoubleClickZoom(G),new w.GamepadNavigation(G),new v.KeyboardNavigation(G,{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"}),
new x.MouseWheelZoom(G),new r.SingleKeyResetTilt(G,"p"),new t.SingleKeyResetHeading(G,"n"),new m.DragRotate(G,"primary",K.PivotPoint.EYE,["b"]),new m.DragRotate(G,"secondary",K.PivotPoint.CENTER,["b"]),new p.PinchAndPanNavigation(G,"tertiary",["b"]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new u.TwoFingerTilt(G)],z.ViewEventPriorities.INTERNAL);this.view.viewEvents.connect(O);this._updateMode();this.addHandles(d.watch(()=>this.view.navigation?.browserTouchPanEnabled,P=>{this._source.browserTouchPanningEnabled=
!P},d.initial))}_updateMode(){var G=this.primaryDragAction;if(G=L.get(this.mode)?.get(G))this._modeDragPan&&(this._modeDragPan.pointerAction=G.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=G.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=G.zoom)}get test(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}};b.__decorate([f.property()],a.prototype,"view",void 0);b.__decorate([f.property({value:"pan"})],
a.prototype,"primaryDragAction",null);b.__decorate([f.property({value:"default"})],a.prototype,"mode",null);b.__decorate([f.property({readOnly:!0})],a.prototype,"updating",null);b.__decorate([f.property()],a.prototype,"latestPointerType",null);b.__decorate([f.property()],a.prototype,"latestPointerLocation",null);b.__decorate([f.property()],a.prototype,"multiTouchActive",null);b.__decorate([f.property()],a.prototype,"_inputManager",void 0);a=b.__decorate([q.subclass("esri.views.3d.input.SceneInputManager")],
a);const L=new Map;b=new Map;f=new Map;b.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"});b.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"});f.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"});f.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"});L.set("default",b);L.set("pro",f);return a})},"esri/views/3d/input/handlers/DoubleClickZoom":function(){define("exports ../../../../core/screenUtils ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController ../../../input/InputHandler ../../../input/handlers/support".split(" "),
function(b,a,c,d,f,n){class k extends f.InputHandler{constructor(g,q){super(!0);this._view=g;this.registerIncoming("double-click",q,e=>this._handleDoubleClick(e))}_handleDoubleClick(g){const q=g.data;if(n.eventMatchesPointerAction(q,"primary")){const e=this._view.state.isGlobal?new c.ZoomStepController({view:this._view,mode:"animation"}):new d.ZoomStepController({view:this._view,mode:"animation"});this._view.state.switchCameraController(e);e.zoomStep(Math.log(.5)/Math.log(.6),a.createScreenPointArray(q.x,
q.y));g.stopPropagation()}}}b.DoubleClickZoom=k;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/global/ZoomStepController":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/time ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/ellipsoidUtils ../../../../../chunks/sphere ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../camera/constraintUtils/surfaceCollision ../../../camera/constraintUtils/TiltMode ../PointToPointAnimationController ../../utils/navigationUtils ../../../support/geometryUtils/ray ../../../support/geometryUtils/sphere ../../../webgl-engine/lib/Camera ../../../webgl-engine/lib/Intersector ../../../../animation/easing".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A,C,E,B){b.ZoomStepController=class extends u.PointToPointAnimationController{constructor(){super(...arguments);this._zoomLocation=l.create();this._tmpCamera=new C.Camera;this._tmpViewDir=l.create();this._tmpRayDir={origin:l.create(),direction:l.create()};this._targetOnSphere=l.create();this._tmpCenter=l.create();this._constraintOptions={selection:p.ConstraintTypes.ALL_EXCEPT_COLLISION,interactionType:h.InteractionType.ZOOM,interactionFactor:null,
interactionStartCamera:new C.Camera,interactionDirection:null,tiltMode:r.TiltMode.TUMBLE};this._sphere=v.create()}initialize(){this._intersector=E.newIntersector(this.view.state.viewingMode)}zoomStep(K,L){if(this.active){var G=this.view.state,{interactionStartCamera:O}=this._constraintOptions;O&&(this.animation.finished?O.copyFrom(G.camera):this.animation.cameraAt(1,O));var P=O=!1;this.intersectionHelper.intersectScreen(L,this._zoomLocation,0===this.view.map.ground.opacity?y.contentIntersectorOptions:
{})&&(O=0<K,P=!0);this._tmpCamera.copyFrom(G.camera);O?this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter):this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:m.copy(this._zoomLocation,this._tmpCamera.center);this._updateCamera(this._tmpCamera,K,this._zoomLocation,L,P);this.begin(this._tmpCamera)}}animationSettings(){return{duration:d.Milliseconds(600),
easing:B.outExpo}}_updateCamera(K,L,G,O,P){var J=w.getReferenceEllipsoid(this.view.spatialReference);J=y.decideNavigationMode(K,O,J);var R=Math.abs(this.view.camera.position.z);m.normalize(F,K.eye);m.scale(F,F,-1);z.fromScreenAtEye(K,O,this._tmpRayDir);m.normalize(this._tmpRayDir.direction,this._tmpRayDir.direction);const X=c.clamp(Math.min(y.zoomDistanceModifier,1/Math.abs(m.dot(F,this._tmpRayDir.direction)))*R,y.zoomMinDistanceModifier,y.zoomMaxDistanceModifier);if(J===y.NavigationMode.Horizontal){L=
.6**L;this._sphere[3]=m.length(G);m.subtract(this._tmpViewDir,K.center,K.eye);P=Math.min(m.length(this._tmpViewDir),X);J=P*L;1>=L&&4>J&&(J=4,L=J/P);if(1E-6>Math.abs(P-J))return;P=m.length(K.center);this._sphere[3]!==P&&(K.center=m.scale(D,K.center,(this._sphere[3]+L*(P-this._sphere[3]))/P));m.scale(this._tmpViewDir,this._tmpViewDir,-L);K.eye=m.add(D,K.center,this._tmpViewDir);x.applyAll(this.view,K,this._constraintOptions);1E-12<m.squaredDistance(G,K.center)&&A.intersectScreen(this._sphere,K,O,this._targetOnSphere)&&
y.panToPosition(this._sphere,K,G,this._targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{J=.6**Math.abs(L);R=0<L?1:-1;m.subtract(this._tmpViewDir,G,K.eye);const U=m.length(this._tmpViewDir);O=this.view._stage.renderView.getMinimalDepthForArea(null,O[0],O[1],this.view.state.camera,60);O=null!=O?O:X;O=P&&0<L?Math.min(O,U):O;m.scale(this._tmpRayDir.direction,this._tmpRayDir.direction,O);m.add(G,this._tmpRayDir.origin,this._tmpRayDir.direction);G=O*J;P=Math.max(4,1.01*K.nearFar[0]);
0<L&&G<P&&(G=P,J=G/O);if(1E-6>Math.abs(O-G))return;m.scale(this._tmpRayDir.direction,this._tmpRayDir.direction,R*(1-J));K.eye=m.add(D,K.eye,this._tmpRayDir.direction);K.center=m.add(D,K.center,this._tmpRayDir.direction)}t.applySurfaceCollisionConstraint(this.view,K)}};b.ZoomStepController=a.__decorate([e.subclass("esri.views.3d.state.controllers.global.ZoomStepController")],b.ZoomStepController);const D=l.create(),F=l.create();Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils":function(){define("exports ./constraintUtils/altitude ./constraintUtils/common ./constraintUtils/ConstraintTypes ./constraintUtils/distance ./constraintUtils/InteractionType ./constraintUtils/surfaceCollision ./constraintUtils/tilt ./constraintUtils/TiltMode ../../animation/easing".split(" "),
function(b,a,c,d,f,n,k,g,q,e){const m=[{type:d.ConstraintTypes.TILT,error:function(w,v,x){return g.getTiltConstraintError(w,v,x)*v.distance},apply:g.applyTiltConstraint},{type:d.ConstraintTypes.ALTITUDE,error:a.getAltitudeConstraintError,apply:a.applyAltitudeConstraint},{type:d.ConstraintTypes.DISTANCE,error:f.getDistanceConstraintError,apply:f.applyDistanceConstraint}],l={selection:d.ConstraintTypes.ALL,interactionType:n.InteractionType.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,
tiltMode:q.TiltMode.TUMBLE};b.applyAll=function(w,v,x=l,p=v){p!==v&&p.copyFrom(v);p.computeUp(w.state.viewingMode);v=!1;for(let t=0;5>t;t++){let r=0;for(var h of m)if(c.hasConstraintType(x.selection,h.type)){const u=Math.abs(h.error(w,p,x));h.apply(w,p,x)&&(v=!0,r+=u)}if(0===r)break}h=c.hasConstraintType(x.selection,d.ConstraintTypes.COLLISION);a:switch(x.interactionType){case n.InteractionType.PAN:x=k.Mode.EYE_AND_CENTER;break a;case n.InteractionType.ASCEND:x=w.state.isGlobal?k.Mode.EYE_AND_CENTER_SCALE:
k.Mode.EYE_AND_CENTER;break a;default:x=k.Mode.EYE}h&&k.applySurfaceCollisionConstraint(w,p,x)&&(v=!0);v&&p.computeUp(w.state.viewingMode);return v};b.pixelDistanceToInteractionFactor=function(w){return e.inOutCubic(Math.min(1,w/150))};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils/altitude":function(){define("exports ../../../../core/mathUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/ray ./common ./ConstraintTypes ./InteractionType ../../support/intersectionUtils".split(" "),
function(b,a,c,d,f,n,k,g,q){function e(p,h,t=n.defaultConstraintOptions){var r=p.state.constraints.altitude;r=p.state.isGlobal&&r?t.interactionType===g.InteractionType.TUMBLE&&n.hasConstraintType(t.selection,k.ConstraintTypes.TILT)?!1:!0:!1;if(!r||!p.state.constraints.altitude)return 0;var u=p.state.constraints.altitude;r=m;r.min=u.min;r.max=u.max;u=t.interactionType;if(u!==g.InteractionType.NONE){var {min:y,max:z}=r,{interactionStartCamera:A,interactionFactor:C}=t;if(A){t=u===g.InteractionType.TUMBLE||
u===g.InteractionType.ZOOM;u=e(p,A);var E=0===u?0:p.renderCoordsHelper.getAltitude(A.eye);r.min=y;r.max=z;n.adjustRangeForInteraction(u,E,t,C,.05*E,r)}}p=p.renderCoordsHelper.getAltitude(h.eye);p=a.clamp(p,r.min,r.max)-p;return 1E-6>=Math.abs(p)?0:p}const m={min:0,max:0},l=d.create(),w=d.create(),v=d.create(),x=d.create();b.applyAltitudeConstraint=function(p,h,t=n.defaultConstraintOptions){var r=e(p,h,t);if(0===r)return!1;const u=p.renderCoordsHelper,y=u.getAltitude(h.eye)+r;var z=n.interactionDirectionTowardsConstraintMinimization;
t=t.interactionDirection;r=Math.sign(r);p.renderCoordsHelper.worldUpAtPosition(h.eye,w);c.scale(w,w,r);z=z.call(n,h,t,w,l);p=c.copy(v,h.viewForward);z=u.intersectInfiniteManifold(f.wrap(h.eye,z),y,x);h.eye=null!=z?z:u.setAltitude(x,y,h.eye);h.center=q.closestPointOnRay(x,h.eye,p,h.center);return!0};b.getAltitudeConstraintError=e;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils/common":function(){define(["exports","../../../../chunks/vec3","./ConstraintTypes",
"./InteractionType","./TiltMode"],function(b,a,c,d,f){c={selection:c.ConstraintTypes.NONE,interactionType:d.InteractionType.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:f.TiltMode.TUMBLE};b.adjustRangeForInteraction=function(n,k,g,q,e,m){0!==n&&(g?(m.min=Math.min(m.min,k),m.max=Math.max(m.max,k)):null!=q?(m.min-=Math.max(0,(k-m.min)*(1-q)),m.max+=Math.max(0,(k-m.max)*(1-q))):e&&(m.min-=Math.max(0,k-m.min-e),m.max+=Math.max(0,k-m.max-e)))};b.defaultConstraintOptions=
c;b.hasConstraintType=function(n,k){return 0!==(n&k)};b.interactionDirectionTowardsConstraintMinimization=function(n,k,g,q){k=k||n.viewForward;a.copy(q,k);a.scale(q,q,Math.sign(a.dot(k,g)));return q};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils/ConstraintTypes":function(){define(["exports"],function(b){b.ConstraintTypes=void 0;var a=b.ConstraintTypes||(b.ConstraintTypes={});a[a.NONE=0]="NONE";a[a.TILT=1]="TILT";a[a.ALTITUDE=2]="ALTITUDE";a[a.DISTANCE=
4]="DISTANCE";a[a.COLLISION=8]="COLLISION";a[a.ALL=15]="ALL";a[a.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION";Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils/InteractionType":function(){define(["exports"],function(b){b.InteractionType=void 0;var a=b.InteractionType||(b.InteractionType={});a[a.NONE=0]="NONE";a[a.ZOOM=1]="ZOOM";a[a.TUMBLE=2]="TUMBLE";a[a.LOOK_AROUND=3]="LOOK_AROUND";a[a.PAN=4]="PAN";a[a.ASCEND=5]="ASCEND";Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils/TiltMode":function(){define(["exports"],function(b){b.TiltMode=void 0;var a=b.TiltMode||(b.TiltMode={});a[a.TUMBLE=0]="TUMBLE";a[a.LOOK_AROUND=1]="LOOK_AROUND";Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/intersectionUtils":function(){define(["exports","../../../chunks/vec2f64","../../../chunks/vec3","../../../chunks/vec3f64","../../../geometry/support/plane"],function(b,a,c,d,f){function n(q,
e,m,l){const w=g;q?(m&&l&&(w.len=c.distance(e,m)),c.copy(w.dir,q)):l?(w.len=c.distance(e,m),c.subtract(w.dir,m,e),c.scale(w.dir,w.dir,1/w.len)):(c.subtract(w.dir,m,e),c.normalize(w.dir,w.dir));return w}function k(q,e,m,l){l.clip[0]=0;l.clip[1]=m?l.len:Number.MAX_VALUE;for(m=0;m<q.length;m++){{var w=q[m],v=e;var x=l;const p=c.dot(f.normal(w),x.dir);w=-f.signedDistance(w,v);0>w&&0<=p?x=!1:-1E-6<p&&1E-6>p?x=0<w:!(0>w||0>p)||0>w&&0>p?(w/=p,0<p?w<x.clip[1]&&(x.clip[1]=w):w>x.clip[0]&&(x.clip[0]=w),x=x.clip[0]<=
x.clip[1]):x=!0}if(!x)return!1}return!0}const g={dir:d.create(),len:0,clip:a.create()};b.closestPointOnRay=function(q,e,m,l){l=c.dot(m,c.subtract(q,l,e));return c.add(q,e,c.scale(q,m,l))};b.frustumLineSegment=function(q,e,m,l){l=n(l,e,m,!0);return k(q,e,m,l)};b.frustumPoint=function(q,e){for(let m=0;6>m;m++)if(0<f.signedDistance(q[m],e))return!1;return!0};b.frustumRay=function(q,e,m,l){m=n(l,e,m,!1);return k(q,e,null,m)};b.frustumSphere=function(q,e,m){const l=e[0],w=e[1];e=e[2];return q[0][0]*l+
q[0][1]*w+q[0][2]*e+q[0][3]>m||q[1][0]*l+q[1][1]*w+q[1][2]*e+q[1][3]>m||q[2][0]*l+q[2][1]*w+q[2][2]*e+q[2][3]>m||q[3][0]*l+q[3][1]*w+q[3][2]*e+q[3][3]>m||q[4][0]*l+q[4][1]*w+q[4][2]*e+q[4][3]>m||q[5][0]*l+q[5][1]*w+q[5][2]*e+q[5][3]>m?!1:!0};b.planeSphere=function(q,e,m){return q[0]*e[0]+q[1]*e[1]+q[2]*e[2]+q[3]<m};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils/distance":function(){define("exports ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/ray ../../../../chunks/sphere ./common ./InteractionType".split(" "),
function(b,a,c,d,f,n,k){function g(p,h,t=n.defaultConstraintOptions){if(!p.state.isLocal)return 0;var r=p.state.constraints.distance;if(!p.pointsOfInterest.surfaceOrigin.renderLocation||Infinity===r)return 0;e.min=0;e.max=r;r=e;var u=t.interactionType;if(u!==k.InteractionType.NONE){var {min:y,max:z}=r,{interactionStartCamera:A,interactionFactor:C}=t;if(A){t=u===k.InteractionType.ZOOM||u===k.InteractionType.PAN;u=g(p,A);var E=0===u?0:q(p,A);r.min=y;r.max=z;n.adjustRangeForInteraction(u,E,t,C,.05*E,
r)}}p=q(p,h);p=e.max-p;return-1E-6<=p?0:p}function q(p,h){p=p.pointsOfInterest.surfaceOrigin;return p.renderLocation?a.distance(h.eye,p.renderLocation):0}const e={min:0,max:0},m=c.create(),l=c.create(),w=c.create(),v=c.create(),x=c.create();b.applyDistanceConstraint=function(p,h,t=n.defaultConstraintOptions){var r=g(p,h,t);if(0===r)return!1;var u=p.pointsOfInterest.surfaceOrigin;if(!u.renderLocation)return!1;r=q(p,h)+r;const y=a.copy(m,h.eye);t=n.interactionDirectionTowardsConstraintMinimization(h,
t.interactionDirection,a.direction(v,h.eye,u.renderLocation),w);if(!f.intersectRay(f.fromCenterAndRadius(u.renderLocation,r),d.wrap(h.eye,t),x))return!1;h.eye=x;u=a.subtract(l,h.eye,y);h.center=a.add(x,h.center,u);u=p.renderCoordsHelper.getAltitude(h.center);p=p.renderCoordsHelper.intersectInfiniteManifold(h.ray,u,x);null!=p&&(h.center=p);return!0};b.getDistanceConstraintError=g;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils/surfaceCollision":function(){define(["exports",
"../../../../chunks/vec3","../../../../chunks/vec3f64","../intersectionUtils"],function(b,a,c,d){b.Mode=void 0;(function(k){k[k.EYE=0]="EYE";k[k.EYE_AND_CENTER=1]="EYE_AND_CENTER";k[k.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(b.Mode||(b.Mode={}));const f=c.create(),n=c.create();b.applySurfaceCollisionConstraint=function(k,g,q=b.Mode.EYE){var e=k.state.constraints;if(!e.collision.enabled)return!1;var m=d.surfaceElevationBelowRenderLocation(k,g.eye);const l=k.renderCoordsHelper.getAltitude(g.eye);
e=m+e.collision.elevationMargin;if(l>=e)return!1;m=a.length(g.eye);a.subtract(f,g.center,g.eye);g.eye=k.renderCoordsHelper.setAltitude(n,e,g.eye);q===b.Mode.EYE_AND_CENTER?g.center=a.add(f,g.eye,f):q===b.Mode.EYE_AND_CENTER_SCALE&&(g.center=a.scale(f,g.center,(m-l+e)/m));return!0};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils/tilt":function(){define("exports ../../../../core/compilerUtils ../../../../core/mathUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/ellipsoidUtils ../../../../chunks/sphere ./common ./ConstraintTypes ./InteractionType ./TiltMode ../../state/utils/viewUtils".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v){function x(B,D,F=e.defaultConstraintOptions,K=!0){E.eyeCenterDistance=0;E.requiresTwoSteps=!1;const L=p(B,D,F,void 0,E);if(0===L)return!1;d.fromRotation(u,-L,D.viewRight);switch(F.tiltMode){case w.TiltMode.LOOK_AROUND:n.transformMat4(r,D.viewForward,u);n.scale(r,r,E.eyeCenterDistance);D.center=n.add(y,D.eye,r);break;case w.TiltMode.TUMBLE:n.subtract(r,D.center,D.eye);n.transformMat4(r,r,u);D.eye=n.subtract(y,D.center,r);break;default:a.neverReached(F.tiltMode)}D.up=
n.transformMat4(y,D.up,u);return E.requiresTwoSteps&&K?x(B,D,F,!1):!0}function p(B,D,F=e.defaultConstraintOptions,K=e.defaultConstraintOptions,L){if(!B.state.constraints.tilt)return 0;var G=B.state.constraints.tilt(D.distance,A);if(F.interactionType!==l.InteractionType.NONE){var {interactionStartCamera:O,interactionFactor:P}=F;if(O){var {min:J,max:R}=G,X=p(B,O,e.defaultConstraintOptions,F),U=0===X?0:v.viewAngle(B.renderCoordsHelper,O.center,O.eye);G.min=J;G.max=R;F.interactionType===l.InteractionType.TUMBLE?
(e.hasConstraintType(F.selection,m.ConstraintTypes.ALTITUDE)&&t(B,O,G),e.adjustRangeForInteraction(X,U,!0,P,z,G)):e.adjustRangeForInteraction(X,U,!1,P,z,G)}}K.interactionType===l.InteractionType.TUMBLE&&e.hasConstraintType(K.selection,m.ConstraintTypes.ALTITUDE)&&t(B,K.interactionStartCamera,G);if(F.tiltMode===w.TiltMode.LOOK_AROUND||K.tiltMode===w.TiltMode.LOOK_AROUND){a:{L&&(L.requiresTwoSteps=!1);switch(B.viewingMode){case "global":F=C;X=B.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;
K=X+g.getReferenceEllipsoid(B.spatialReference).radius;X=B.renderCoordsHelper.intersectManifold(D.ray,X,y);F.eyeCenterDistance=D.distance;F.centerIsOnSurface=!1;null!=X?(F.eyeCenterDistance=n.distance(D.eye,X),F.tiltAtCenter=v.viewAngle(B.renderCoordsHelper,X,D.eye),F.centerIsOnSurface=!0):B.state.isLocal?F.tiltAtCenter=v.viewAngle(B.renderCoordsHelper,D.center,D.eye):(q.closestPointOnSilhouette(q.fromRadius(q.tmpSphere,K),D.ray,y),F.eyeCenterDistance=n.distance(D.eye,y),F.tiltAtCenter=c.acosClamped(-n.dot(D.viewForward,
n.normalize(y,y))));F.radius=K;F.eyeRadius=n.length(D.eye);F.constraints=B.state.constraints;D=c.clamp(F.tiltAtCenter,G.min,G.max);if(1E-9<Math.abs(F.tiltAtCenter-D)){if(F.centerIsOnSurface){{const {constraints:M,eyeCenterDistance:V,tiltAtCenter:Y}=F;D=Y;B=M.clampTilt(V,Y);G=h(F,B);if(M.clampTilt(G,Y)!==B)for(G=0;10>G&&1E-9<Math.abs(B-D);)K=(D+B)/2,X=h(F,K),X=M.clampTilt(X,K),1E-9<Math.abs(X-K)?D=K:B=K,G++;D=B}G=D;B=c.asinClamped(F.radius/F.eyeRadius*Math.sin(F.tiltAtCenter));G=c.asinClamped(F.radius/
F.eyeRadius*Math.sin(G));B=F.eyeRadius>F.radius?B-G:G-B}else D=F.constraints.clampTilt(F.eyeCenterDistance,F.tiltAtCenter),L&&D<Math.PI/2&&(L.requiresTwoSteps=!0,D=Math.PI/2-1E-5),B=F.tiltAtCenter-Math.PI/2-(D-Math.PI/2);L&&(L.eyeCenterDistance=h(F,D));L=B}else L=0;break a;case "local":K=v.viewAngle(B.renderCoordsHelper,D.center,D.eye);F=c.clamp(K,G.min,G.max);G=K-F;1E-9<Math.abs(G)?(L&&(K=B.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,B=B.renderCoordsHelper.getAltitude(D.eye)-
K,F=Math.cos(F),L.eyeCenterDistance=1E-4<Math.abs(F)?B/F:D.distance),L=G):L=0;break a}L=void 0}return L}L=v.viewAngle(B.renderCoordsHelper,D.center,D.eye);F=c.clamp(L,G.min,G.max);L-=F;L=1E-9<Math.abs(L)?L:0;return L}function h(B,D){if(!B.centerIsOnSurface)return B.eyeCenterDistance;D=Math.PI-c.clamp(D,0,Math.PI);const F=c.asinClamped(B.radius/B.eyeRadius*Math.sin(D)),K=Math.sin(Math.PI-D-F)/Math.sin(D);return B.eyeRadius<B.radius&&1<K?Math.sin(Math.PI-D-(Math.PI-F))/Math.sin(D)*B.eyeRadius:K*B.eyeRadius}
function t(B,D,F){var K=B.state.constraints;if(!B.state.isLocal&&K.altitude&&D){var L=n.squaredLength(D.center),G=Math.sqrt(L);D=D.distance;var O=g.getReferenceEllipsoid(B.spatialReference).radius;B=K.altitude.min+O;K=K.altitude.max+O;B=(B*B-D*D-L)/(-2*G*D);F.min=Math.max(F.min,Math.min(Math.PI-c.acosClamped((K*K-D*D-L)/(-2*G*D)),F.max));F.max=Math.min(F.max,Math.PI-c.acosClamped(B))}}const r=k.create(),u=f.create(),y=k.create(),z=c.deg2rad(5),A={min:0,max:0},C={constraints:null,radius:0,eyeRadius:0,
centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},E={eyeCenterDistance:0,requiresTwoSteps:!1};b.applyTiltConstraint=x;b.getTiltConstraintError=p;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/utils/viewUtils":function(){define(["exports","../../../../core/mathUtils","../../../../chunks/vec3","../../../../chunks/vec3f64"],function(b,a,c,d){const f=d.create(),n=d.create();b.viewAngle=function(k,g,q){k.worldUpAtPosition(g,f);c.subtract(n,q,g);k=c.length(n);
return 0===k?0:a.acosClamped(c.dot(n,f)/k)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/animation/easing":function(){define(["exports"],function(b){function a(M){const V=2*(M-Math.sqrt((M-1)*M)),Y=V/2/M;return W=>W<Y?M*W*W:V*W-V+1}function c(M,V){return(Y,W)=>Y<V?V*M(Y/V,W):1-M((1-Y)/(1-V),W)*(1-V)}const d=M=>M,f=M=>M*M,n=M=>1-f(1-M),k=M=>.5>M?f(2*M)/2:(1-f(1-2*(M-.5))+1)/2,g=M=>M*M*M,q=M=>1-g(1-M),e=M=>.5>M?g(2*M)/2:(1-g(1-2*(M-.5))+1)/2,m=M=>M*M*M*M,l=M=>1-m(1-M),
w=M=>.5>M?m(2*M)/2:(1-m(1-2*(M-.5))+1)/2,v=M=>M*M*M*M*M,x=M=>1-v(1-M),p=M=>.5>M?v(2*M)/2:(1-v(1-2*(M-.5))+1)/2,h=M=>-Math.cos(M*Math.PI/2)+1,t=M=>1-h(1-M),r=M=>.5>M?h(2*M)/2:(1-h(1-2*(M-.5))+1)/2,u=M=>2**(10*(M-1)),y=M=>1-2**(10*(1-M-1)),z=M=>.5>M?2**(10*(2*M-1))/2:(1-2**(10*(1-2*(M-.5)-1))+1)/2,A=M=>-(Math.sqrt(1-M*M)-1),C=M=>1-A(1-M),E=M=>.5>M?A(2*M)/2:(1-A(1-2*(M-.5))+1)/2,B=c(a(1),1),D=c(a(1),0),F=c(a(1),.5),K=c(a(2),1),L=c(a(2),0),G=c(a(2),.5),O=c(a(3),1),P=c(a(3),0),J=c(a(3),.5),R=c(a(4),1),
X=c(a(4),0),U=c(a(4),.5);b.EasingFunctions={linear:d,"in-quad":f,"out-quad":n,"in-out-quad":k,"in-coast-quad":B,"out-coast-quad":D,"in-out-coast-quad":F,"in-cubic":g,"out-cubic":q,"in-out-cubic":e,"in-coast-cubic":K,"out-coast-cubic":L,"in-out-coast-cubic":G,"in-quart":m,"out-quart":l,"in-out-quart":w,"in-coast-quart":O,"out-coast-quart":P,"in-out-coast-quart":J,"in-quint":v,"out-quint":x,"in-out-quint":p,"in-coast-quint":R,"out-coast-quint":X,"in-out-coast-quint":U,"in-sine":h,"out-sine":t,"in-out-sine":r,
"in-expo":u,"out-expo":y,"in-out-expo":z,"in-circ":A,"out-circ":C,"in-out-circ":E};b.inCirc=A;b.inCoastCubic=K;b.inCoastQuad=B;b.inCoastQuart=O;b.inCoastQuint=R;b.inCubic=g;b.inExpo=u;b.inOutCirc=E;b.inOutCoastCubic=G;b.inOutCoastQuad=F;b.inOutCoastQuart=J;b.inOutCoastQuint=U;b.inOutCubic=e;b.inOutExpo=z;b.inOutQuad=k;b.inOutQuart=w;b.inOutQuint=p;b.inOutSine=r;b.inQuad=f;b.inQuart=m;b.inQuint=v;b.inSine=h;b.linear=d;b.outCirc=C;b.outCoastCubic=L;b.outCoastQuad=D;b.outCoastQuart=P;b.outCoastQuint=
X;b.outCubic=q;b.outExpo=y;b.outQuad=n;b.outQuart=l;b.outQuint=x;b.outSine=t;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/PointToPointAnimationController":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3f64 ../../../ViewAnimation ../../animation/pointToPoint/Animation ./AnimationController ../../webgl-engine/lib/Camera ../../webgl-engine/lib/Intersector ../../../animation/easing".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v){b.PointToPointAnimationController=class extends m.AnimationController{get intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(h){super(h);this.mode="interaction";this._hasTarget=!1}initialize(){this.animation=new e.Animation(this.view.state.viewingMode);this.viewAnimation="interaction"===this.mode?null:new q}get isInteractive(){return"interaction"===this.mode}begin(h,t){this._hasTarget=!0;t=this.animationSettings(t);x.copyFrom(this.view.state.camera);
const r=w.newIntersector(this.view.state.viewingMode);this.intersectionHelper.intersectRay(x.ray,r,p)&&(x.center=p);this.animation.update(x,h,t);this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time;super.finish()}get steppingFinished(){return this._hasTarget&&this.animation.finished}stepController(h,t){this._hasTarget&&this.animation.step(h,t)}onControllerEnd(h){this._hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,h),this.animation.currentTime=
this.animation.time);super.onControllerEnd(h)}animationSettings(h={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(Infinity)/6,ascensionFactor:void 0,descensionFactor:void 0},...h,easing:"string"===typeof h.easing?v.EasingFunctions[h.easing]:h.easing}}};a.__decorate([c.property({constructOnly:!0})],b.PointToPointAnimationController.prototype,"mode",void 0);a.__decorate([c.property({readOnly:!0})],b.PointToPointAnimationController.prototype,"isInteractive",null);b.PointToPointAnimationController=
a.__decorate([k.subclass("esri.views.3d.state.controllers.PointToPointAnimationController")],b.PointToPointAnimationController);const x=new l.Camera,p=g.create();Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/animation/pointToPoint/Animation":function(){define("exports ../../../../core/time ../../../../chunks/vec3 ../../../../chunks/vec3f64 ./Camera ../../webgl-engine/lib/Camera ../../../animation/pointToPoint/Animation".split(" "),function(b,a,c,d,f,n,k){const g=d.create();
class q{get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}constructor(e){this.currentTime=a.Milliseconds(0);this._animation=new k.Animation(()=>new f(e));this._current=new f(e)}update(e,m,l){const w=this._animation.definition.source,v=this._animation.definition.target,x=c.subtract(g,m.center,e.center),p=c.length(x);1E-5<=p?(x[0]/=p,x[1]/=p,x[2]/=p):(x[0]=0,x[1]=1,x[0]=0);c.copy(w.lookAtDirection,x);c.copy(v.lookAtDirection,x);w.copyFromRenderCamera(e);
v.copyFromRenderCamera(m);this._current.copyFrom(w);this._animation.update(w,v,l);this.currentTime=a.Milliseconds(0);e.almostEquals(m)&&(this.currentTime=this._animation.time)}cameraAt(e,m){this._animation.cameraAt(e,this._current);m=m||new n.Camera;this._current.copyToRenderCamera(m);return m}step(e,m){this.finished||(this.currentTime=a.Milliseconds(this.currentTime+a.millisecondsFromSeconds(e)),this.currentTime>=this.time&&(this.currentTime=this.time));return this.cameraAt(this.currentTime/this.time,
m)}}b.Animation=q;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/animation/pointToPoint/Camera":function(){define("../../../../core/mathUtils ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../ViewingMode ../../support/mathUtils".split(" "),function(b,a,c,d,f,n,k){const g=f.create(),q=f.create(),e=f.create(),m=f.create(),l=f.create(),w=f.create();var v=f.fromValues(0,0,1),x=f.fromValues(0,1,0),p=f.fromValues(1,
0,0);const h=c.create();class t{constructor(r=n.ViewingMode.Global){this.viewingMode=r;this.center=f.create();this.distance=this.yaw=this.pitch=0;this.lookAtDirection=f.clone(x)}pixelsPerPanAtZoom(r){return this.size/2/(this._zoomToPanScale*r)}zoomAtPixelsPerPan(r){return this.size/2/(this._zoomToPanScale*r)}pixelsPerRotateAtZoom(){return this.size/2/Math.max(Math.cos(Math.abs(this.pitch)),.5)}compareTo(r,u){u||(u={pan:0,rotate:0,sourceZoom:0,targetZoom:0});if(this.viewingMode===n.ViewingMode.Global){var y=
d.length(this.center);const z=d.length(r.center);y=(y+z)/2;u.pan=k.angle(this.center,r.center)*y}else u.pan=d.distance(this.center,r.center);y=Math.abs(r.yaw-this.yaw);y>=Math.PI&&(y=2*Math.PI-y);u.rotate=Math.max(y,Math.abs(r.pitch-this.pitch));u.sourceZoom=this.distance;u.targetZoom=r.distance;return u}interpolate(r,u,y){this.viewingMode===n.ViewingMode.Global?k.slerp(r.center,u.center,y.pan,this.center):d.lerp(this.center,r.center,u.center,y.pan);this.distance=isFinite(u.distance)?b.lerp(r.distance,
u.distance,y.zoom):r.distance;this.pitch=b.lerp(r.pitch,u.pitch,y.rotate);r=r.yaw;u=u.yaw;Math.abs(u-r)>=Math.PI&&(r+=2*(r<u?1:-1)*Math.PI);this.yaw=b.lerp(r,u,y.rotate)}copyFrom(r){d.copy(this.center,r.center);this.pitch=r.pitch;this.yaw=r.yaw;this.distance=r.distance;d.copy(this.lookAtDirection,r.lookAtDirection);this.size=r.size;this.copyFromCommon(r);this.viewingMode=r.viewingMode}copyFromRenderCamera(r){const u=this._lookAtOrientation(r.center,h);d.copy(this.center,r.center);d.subtract(m,r.center,
r.eye);d.transformMat3(m,m,u);d.transformMat3(l,r.up,u);this.distance=d.length(m);0!==this.distance&&(m[0]/=this.distance,m[1]/=this.distance,m[2]/=this.distance);this.pitch=this._eyeUpToPitch(m);this.yaw=this._eyeUpToYaw(m,l);this.size=Math.sqrt(r.width*r.width+r.height*r.height);this.copyFromCommon(r)}copyFromCommon(r){this.fov=r.fov;this._zoomToPanScale=Math.atan(.5*this.fov)}copyToRenderCamera(r){const u=this._lookAtOrientation(this.center,h);a.transpose(u,u);this._axisAngleVec3(p,this.pitch-
Math.PI/2,x,m);this._axisAngleVec3(v,this.yaw,m);this._axisAngleVec3(p,this.pitch-Math.PI/2,v,l);this._axisAngleVec3(v,this.yaw,l);d.scale(m,m,this.distance);d.transformMat3(m,m,u);d.transformMat3(l,l,u);r.center=this.center;r.eye=d.subtract(m,this.center,m);r.up=l}_axisAngleVec3(r,u,y,z=y){const A=Math.cos(u);u=Math.sin(u);d.scale(g,y,A);d.cross(q,r,y);d.scale(q,q,u);d.scale(e,r,(1-A)*d.dot(r,y));return d.add(z,d.add(z,g,q),e)}_lookAtOrientation(r,u=c.create()){this._upAtLookAt(r,e);d.cross(g,this.lookAtDirection,
e);d.normalize(g,g);0===g[0]&&0===g[1]&&0===g[2]&&d.copy(g,p);d.cross(q,e,g);d.normalize(q,q);u[0]=g[0];u[1]=q[0];u[2]=e[0];u[3]=g[1];u[4]=q[1];u[5]=e[1];u[6]=g[2];u[7]=q[2];u[8]=e[2];return u}_upAtLookAt(r,u){return this.viewingMode===n.ViewingMode.Local?d.copy(u,v):d.normalize(u,r)}_eyeUpToPitch(r){return Math.PI-k.angle(v,r)}_eyeUpToYaw(r,u){.5>Math.abs(u[2])?(d.copy(w,u),0<r[2]&&d.scale(w,w,-1)):d.copy(w,r);d.cross(q,w,v);d.normalize(q,q);return k.angle(p,q,v)}}return t})},"esri/views/animation/pointToPoint/Animation":function(){define("exports ../../../core/time ../easing ./Definition ./Settings ./apex/Path".split(" "),
function(b,a,c,d,f,n){const k={zoom:0,pan:0,rotate:0};b.Animation=class{get time(){return this._time}constructor(g){this._createCamera=g;this._time=a.Milliseconds(0);this.definition=new d.Definition(g);this.path=new n.Path}update(g,q,e){this.definition.update(g,q,e);this.path.update(this.definition,e);this._time=this._applyTimeSettings(a.millisecondsFromSeconds(isFinite(this.path.time)?this.path.time:a.Seconds(0)),e);this._easing=e.easing??(1E3<=this._time?c.inOutCoastQuad:c.outExpo)}cameraAt(g,q){q=
q||this._createCamera();g=Math.min(Math.max(0,g),1);g=this._normalizedEasing(g);g=this.path.interpolateComponentsAt(g,k);q.interpolate(this.definition.source,this.definition.target,g);return q}_normalizedEasing(g){const q=this._easing(0,this._time),e=this._easing(1,this._time);return(this._easing(g,this._time)-q)/(e-q)}_applyTimeSettings(g,q){const e=null!=q.speedFactor?q.speedFactor:1;null!=q.duration?g=q.duration:null!=q.speedFactor&&(g=a.Milliseconds(g/e));return a.Milliseconds(Math.min(Math.max(null!=
q.minDuration?q.minDuration:f.defaultSettings.minDuration/e,g),null!=q.maxDuration?q.maxDuration:f.defaultSettings.maxDuration/e))}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/animation/pointToPoint/Definition":function(){define(["exports","./Settings"],function(b,a){class c{constructor(d){this._createCamera=d;this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0};this.settings={desiredScreenFlow:a.defaultSettings.desiredScreenFlow};this.source=d();this.target=d()}clone(){const d=
new c(this._createCamera);d.copyFrom(this);return d}copyFrom(d){this.update(d.source,d.target,d.settings)}update(d,f,n){this.source!==d&&this.source.copyFrom(d);this.target!==f&&this.target.copyFrom(f);this.compared=this.source.compareTo(this.target,this.compared);this.settings.desiredScreenFlow=null!=n.desiredScreenFlow?n.desiredScreenFlow:a.defaultSettings.desiredScreenFlow;this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size;this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(d){d=
this.target.pixelsPerPanAtZoom(d);return this.halfWindowSize/d}get hasZoom(){return 1E-5<Math.abs(this.compared.sourceZoom-this.compared.targetZoom)}get hasPan(){return 1E-9<this.compared.pan}get hasRotate(){return 1E-9<this.compared.rotate}}b.Definition=c;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/animation/pointToPoint/Settings":function(){define(["exports","../../../core/time"],function(b,a){a={desiredScreenFlow:2,minDuration:a.Milliseconds(500),maxDuration:a.Milliseconds(8E3)};
b.defaultSettings=a;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/animation/pointToPoint/apex/Path":function(){define(["exports","../../easing","../Path","../Segment","./planning"],function(b,a,c,d,f){class n extends c.Path{constructor(k,g){super();this._preallocSegments=[new d.Segment,new d.Segment,new d.Segment];this._descensionSegment=this._ascensionSegment=null;this.update(k,g)}update(k,g){if(k){this.definition?this.definition.copyFrom(k):this.definition=k.clone();
var q=null;g?.apex&&(q=f.optimalDistance(k,g.apex));this.segments.length=0;this._descensionSegment=this._ascensionSegment=null;null==q?this._updateWithoutApex():this._updateWithApex(q,g?.apex)}}segmentInterpolateComponentsAt(k,g,q){q=k.interpolateComponentsAt(g,q);k===this._ascensionSegment?q.zoom=a.outQuad(q.zoom):k===this._descensionSegment&&(q.zoom=a.inQuad(q.zoom));return q}_updateWithApex(k,g){const [q,e,m]=this._preallocSegments,l=g?.ascensionFactor??.5;g=Math.min(1-l,null!=g?.ascensionFactor&&
null!=g.descensionFactor?g.descensionFactor:.5);const w=1-l-g;q.definition?q.definition.copyFrom(this.definition):q.definition=this.definition.clone();q.definition.compared.targetZoom=k;q.definition.compared.pan=this.definition.compared.pan*l;q.definition.compared.rotate=this.definition.compared.rotate*l;q.update();this._ascensionSegment=q;this.segments.push(q);0<w&&(e.definition?e.definition.copyFrom(this.definition):e.definition=this.definition.clone(),e.definition.copyFrom(this.definition),e.definition.compared.sourceZoom=
k,e.definition.compared.targetZoom=k,e.definition.compared.pan=this.definition.compared.pan*w,e.definition.compared.rotate=this.definition.compared.rotate*w,e.update(),this.segments.push(e));m.definition?m.definition.copyFrom(this.definition):m.definition=this.definition.clone();m.definition.compared.sourceZoom=k;m.definition.compared.pan=this.definition.compared.pan*g;m.definition.compared.rotate=this.definition.compared.rotate*g;m.update();this._descensionSegment=m;this.segments.push(m)}_updateWithoutApex(){const [k]=
this._preallocSegments;k.update(this.definition);this.segments.push(k)}}b.Path=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/animation/pointToPoint/Path":function(){define(["exports","../../../core/time"],function(b,a){b.Path=class{constructor(){this.segments=[]}get time(){return this.segments.reduce((c,d)=>a.Seconds(c+d.time),a.Seconds(0))}interpolateComponentsAt(c,d){c=Math.min(Math.max(c,0),1);c*=this.time;let f=0,n=0;const k=this.definition;for(let g=0;g<this.segments.length;g++){const q=
this.segments[g],e=q.definition;if(c<=q.time||g===this.segments.length-1)return d=this.segmentInterpolateComponentsAt(q,0===q.time?0:c/q.time,d),k.hasPan&&!isNaN(d.pan)&&isFinite(k.compared.pan)?d.pan=(f+e.compared.pan*d.pan)/k.compared.pan:d.pan=1,k.hasRotate&&!isNaN(d.rotate)&&isFinite(k.compared.rotate)?d.rotate=(n+e.compared.rotate*d.rotate)/k.compared.rotate:d.rotate=1,k.hasZoom&&!isNaN(d.zoom)&&isFinite(e.compared.targetZoom)?(c=this.segments[0].definition.compared.sourceZoom,d.zoom=(d.zoom*
(e.compared.targetZoom-e.compared.sourceZoom)+e.compared.sourceZoom-c)/(this.segments[this.segments.length-1].definition.compared.targetZoom-c)):d.zoom=1,d;c-=q.time;f+=e.compared.pan;n+=e.compared.rotate}}segmentInterpolateComponentsAt(c,d,f){return c.interpolateComponentsAt(d,f)}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/animation/pointToPoint/Segment":function(){define(["exports","../../../core/time"],function(b,a){class c{get time(){return this._time}constructor(d){d&&
this.update(d)}update(d){d&&(this.definition?this.definition.copyFrom(d):this.definition=d.clone());this._updatePrecomputedVariables();this._updatePixelFlow()}_updatePrecomputedVariables(){var d=this.definition;const f=d.compared,n=f.sourceZoom,k=f.targetZoom;this._zoomSign=n>k?1:-1;this._panPixelsAtSource=f.pan*d.source.pixelsPerPanAtZoom(n);d=(d.source.pixelsPerRotateAtZoom(n)+d.target.pixelsPerRotateAtZoom(k))/2;this._rotatePixels=f.rotate*d}_updatePixelFlow(){var d=this.definition.compared.sourceZoom,
f=this.definition.compared.targetZoom;const {hasZoom:n,hasPan:k,hasRotate:g}=this.definition;var q=0,e=0;n&&(k&&(q=(f/d-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),g&&(e=Math.log(d/f)/Math.LN2*this._zoomSign*this.definition.halfWindowSize/this._rotatePixels));this._rotatePixelFlow=this._panPixelFlow=this._zoomPixelFlow=0;d=this.definition.desiredPixelFlow;n&&k&&g?(f=q+e+q*e,this._zoomPixelFlow=q*e/f*d,this._panPixelFlow=e/f*d,this._rotatePixelFlow=q/f*
d):n&&k?(e=1+q,this._zoomPixelFlow=q/e*d,this._panPixelFlow=1/e*d):n&&g?(q=1+e,this._zoomPixelFlow=e/q*d,this._rotatePixelFlow=1/q*d):k&&g?(q=this._panPixelsAtSource/this._rotatePixels,e=1+q,this._panPixelFlow=q/e*d,this._rotatePixelFlow=1/e*d):k?this._panPixelFlow=d:n?this._zoomPixelFlow=d:g&&(this._rotatePixelFlow=d);this._time=g?this.rotateTime:n?this.zoomTime:k?this.panTime:a.Seconds(0)}get rotateTime(){return this.definition.hasRotate?a.Seconds(this._rotatePixels/this._rotatePixelFlow):a.Seconds(0)}get zoomTime(){return this.definition.hasZoom?
a.Seconds(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2*this._zoomSign*this.definition.halfWindowSize/this._zoomPixelFlow):a.Seconds(0)}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){const d=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2;return a.Seconds(Math.log(this._zoomPixelFlow/this._panPixelFlow*this._panPixelsAtSource*d+1)/(d*this._zoomPixelFlow))}return a.Seconds(this._panPixelsAtSource/this._panPixelFlow)}return a.Seconds(0)}_interpolateComponentsZoom(d){if(0===
d||1===d)return d;if(this.definition.hasZoom){const f=this.definition.compared.sourceZoom,n=this.definition.compared.targetZoom;return(f*(f/n)**-d-f)/(n-f)}return d}_interpolateComponentsPan(d){if(0===d||1===d)return d;if(this.definition.hasPan&&this.definition.hasZoom){const f=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*this._panPixelFlow*(2**(f*d*this._time)-1)/(f*Math.LN2)}return d}_interpolateComponentsRotate(d){return d}interpolateComponentsAt(d,
f){d=Math.min(Math.max(d,0),1);const n=this._interpolateComponentsZoom(d),k=this._interpolateComponentsPan(d);d=this._interpolateComponentsRotate(d);f?(f.zoom=n,f.pan=k,f.rotate=d):f={zoom:n,pan:k,rotate:d};return f}}b.Segment=c;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/animation/pointToPoint/apex/planning":function(){define(["exports","./functions"],function(b,a){function c(d,f){const n=Math.max(d.compared.sourceZoom,d.compared.targetZoom);d=d.source.zoomAtPixelsPerPan(d.desiredPixelFlow/
d.compared.pan)/2;return d<n?null!=f.maximumDistance?n+(f.maximumDistance-n)/2:1.5*n:f.maximumDistance?Math.min(f.maximumDistance,d):d}b.optimalDistance=function(d,f){let n=c(d,f);const k={ascensionFactor:null!=f.ascensionFactor?f.ascensionFactor:.5,descensionFactor:null!=f.descensionFactor?f.descensionFactor:.5};var g=0===k.ascensionFactor,q=0===k.descensionFactor;const e=g?a.tAscensionZoomOnly:a.tAscensionZoomPan,m=g?a.dtAscensionZoomOnly:a.dtAscensionZoomPan,l=g?a.ddtAscensionZoomOnly:a.ddtAscensionZoomPan,
w=q?a.tDescensionZoomOnly:a.tDescensionZoomPan,v=q?a.dtDescensionZoomOnly:a.dtDescensionZoomPan,x=q?a.ddtDescensionZoomOnly:a.ddtDescensionZoomPan;g=z=>e(d,z,k)+a.tPanion(d,z,k)+w(d,z,k);q=z=>m(d,z,k)+a.dtPanion(d,z,k)+v(d,z,k);const p=z=>l(d,z,k)+a.ddtPanion(d,z,k)+x(d,z,k);let h=g(n);const t=a.tBaseLine(d),r=f.maximumIterations||20,u=null!=f.maximumDistance?f.maximumDistance:Infinity;for(f=0;f<r;f++){var y=(q(n)+1E-6)/p(n);if(isNaN(y)||n>=u&&0>y){if(!isFinite(u))return null;n=u;h=g(n);break}n-=
y;if(n<d.compared.sourceZoom||n<d.compared.targetZoom)return null;y=g(n);if(.005>=Math.abs(y-h)/h)break;h=y}return h>.7*t||n<d.compared.sourceZoom||n<d.compared.targetZoom?null:n};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/animation/pointToPoint/apex/functions":function(){define(["exports"],function(b){b.ddtAscensionZoomOnly=function(a,c){return-a.halfWindowSize/(c*c*a.desiredPixelFlow*Math.LN2)};b.ddtAscensionZoomPan=function(a,c,d){const f=c-a.compared.sourceZoom,
n=1/f,k=1/c,g=Math.log(a.compared.sourceZoom*k);d=(d.ascensionFactor*Math.LN2*a.compared.pan+a.halfWindowPanAtZoom(f))/a.halfWindowPanAtZoom(1);return a.halfWindowSize*n*(-2*n*k*d+2*n*g+2*k-2*g*d/(f*f)-d/(c*c))/(a.desiredPixelFlow*Math.LN2)};b.ddtDescensionZoomOnly=function(a,c){return-a.halfWindowSize/(c*c*a.desiredPixelFlow*Math.LN2)};b.ddtDescensionZoomPan=function(a,c,d){const f=c-a.compared.targetZoom,n=1/f,k=1/c,g=Math.log(c/a.compared.targetZoom);d=(a.halfWindowPanAtZoom(c)+d.descensionFactor*
Math.LN2*a.compared.pan-a.halfWindowPanAtZoom(a.compared.targetZoom))/a.halfWindowPanAtZoom(1);return a.halfWindowSize*n*(-2*n*k*d-2*n*g+2*k+2*g*d/(f*f)-d/(c*c))/(a.desiredPixelFlow*Math.LN2)};b.ddtPanion=function(a,c,d){return-2*a.compared.pan*a.halfWindowSize*(d.ascensionFactor+d.descensionFactor-1)/(a.desiredPixelFlow*a.halfWindowPanAtZoom(c*c*c))};b.dtAscensionZoomOnly=function(a,c){return a.halfWindowSize/(c*a.desiredPixelFlow*Math.LN2)};b.dtAscensionZoomPan=function(a,c,d){const f=1/c,n=Math.log(a.compared.sourceZoom*
f),k=1/a.desiredPixelFlow,g=1/Math.LN2;c-=a.compared.sourceZoom;const q=1/c;d=(d.ascensionFactor*Math.LN2*a.compared.pan+a.halfWindowPanAtZoom(c))/a.halfWindowPanAtZoom(1);return a.halfWindowSize*f*k*g*q*d-a.halfWindowSize*n*k*g*q+a.halfWindowSize*n*k*g*d/(c*c)};b.dtDescensionZoomOnly=function(a,c){return a.halfWindowSize/(c*a.desiredPixelFlow*Math.LN2)};b.dtDescensionZoomPan=function(a,c,d){const f=Math.log(c/a.compared.targetZoom),n=1/a.desiredPixelFlow,k=1/Math.LN2,g=-c+a.compared.targetZoom,q=
1/g;d=(-a.halfWindowPanAtZoom(c)-d.descensionFactor*Math.LN2*a.compared.pan+a.halfWindowPanAtZoom(a.compared.targetZoom))/a.halfWindowPanAtZoom(1);return-a.halfWindowSize*f*n*k*q+a.halfWindowSize*f*n*k*d/(g*g)+a.halfWindowSize*n*k*q*d/c};b.dtPanion=function(a,c,d){return a.compared.pan*a.halfWindowSize*(d.ascensionFactor+d.descensionFactor-1)/(a.desiredPixelFlow*a.halfWindowPanAtZoom(c*c))};b.tAscensionZoomOnly=function(a,c){return-a.halfWindowSize*Math.log(a.compared.sourceZoom/c)/(a.desiredPixelFlow*
Math.LN2)};b.tAscensionZoomPan=function(a,c,d){const f=a.halfWindowPanAtZoom(c-a.compared.sourceZoom);return-a.halfWindowSize*(d.ascensionFactor*Math.LN2*a.compared.pan+f)*Math.log(a.compared.sourceZoom/c)/(a.desiredPixelFlow*Math.LN2*f)};b.tBaseLine=function(a){const c=Math.LN2*a.compared.pan,d=a.halfWindowPanAtZoom(a.compared.sourceZoom-a.compared.targetZoom),f=a.halfWindowSize*Math.log(a.compared.sourceZoom/a.compared.targetZoom)/(a.desiredPixelFlow*Math.LN2*d);return a.compared.sourceZoom<=a.compared.targetZoom?
f*(c-d):f*(c+d)};b.tDescensionZoomOnly=function(a,c){return a.halfWindowSize*Math.log(c/a.compared.targetZoom)/(a.desiredPixelFlow*Math.LN2)};b.tDescensionZoomPan=function(a,c,d){return a.halfWindowSize*(-a.halfWindowPanAtZoom(c)-d.descensionFactor*Math.LN2*a.compared.pan+a.halfWindowPanAtZoom(a.compared.targetZoom))*Math.log(c/a.compared.targetZoom)/(a.desiredPixelFlow*Math.LN2*a.halfWindowPanAtZoom(-c+a.compared.targetZoom))};b.tPanion=function(a,c,d){return-a.compared.pan*a.halfWindowSize*(d.ascensionFactor+
d.descensionFactor-1)/(a.desiredPixelFlow*a.halfWindowPanAtZoom(c))};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/AnimationController":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/Error ../../../../core/accessorSupport/decorators/subclass ../../../ViewAnimation ./CameraController".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l){b.AnimationController=class extends l.CameraController{constructor(){super(...arguments);this._asyncResult=null}get canStop(){return!0}set asyncResult(w){this._asyncResult&&(this._asyncResult.reject(d.createAbortError()),this._asyncResult=null);this.state===l.State.Finished||this.state===l.State.Stopped?(c.assertIsSome(w),this.state===l.State.Finished?w.resolve():w.reject(d.createAbortError())):this._asyncResult=w}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=
l.State.Running;null!=this.viewAnimation&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){null==this.viewAnimation||this.state!==l.State.Ready&&this.state!==l.State.Running||(this.viewAnimation.state===m.State.FINISHED?this.finish():this.viewAnimation.state===m.State.STOPPED&&(this.state=l.State.Stopped))}onControllerEnd(){null==this.viewAnimation||this.viewAnimation.done||(this.state===l.State.Finished?this.viewAnimation.finish():
this.state===l.State.Stopped&&this.viewAnimation.stop());this._asyncResult&&(this.state===l.State.Finished?this._asyncResult.resolve():this._asyncResult.reject(d.createAbortError()))}finish(){this.finishController()}};b.AnimationController=a.__decorate([e.subclass("esri.views.3d.state.controllers.AnimationController")],b.AnimationController);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/CameraController":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass".split(" "),
function(b,a,c,d,f,n,k,g){b.State=void 0;(function(q){q.Ready="ready";q.Rejected="rejected";q.Running="running";q.Stopped="stopped";q.Finished="finished"})(b.State||(b.State={}));b.CameraController=class extends c{constructor(q){super(q);this.state=b.State.Ready}get active(){return this.state===b.State.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return this.canStop?(this.state=b.State.Stopped,!0):!1}finishController(){this.state=b.State.Finished}get steppingFinished(){return!1}};
a.__decorate([d.property({constructOnly:!0})],b.CameraController.prototype,"view",void 0);a.__decorate([d.property({readOnly:!0})],b.CameraController.prototype,"active",null);a.__decorate([d.property()],b.CameraController.prototype,"state",void 0);a.__decorate([d.property({readOnly:!0})],b.CameraController.prototype,"isInteractive",null);b.CameraController=a.__decorate([g.subclass("esri.views.3d.state.controllers.CameraController")],b.CameraController);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/state/utils/navigationUtils":function(){define("exports ../../../../core/Cyclical ../../../../core/mathUtils ../../../../core/screenUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/axisAngle ../../../../geometry/support/coordinateSystem ../../../../geometry/support/plane ../../../../chunks/sphere ../../../../geometry/support/vector ../../../../geometry/support/vectorStacks ../../support/geometryUtils/ray ../../support/geometryUtils/sphere ../../webgl-engine/lib/Camera ../../webgl-engine/lib/verticalOffsetUtils".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u){function y(ma,pa,ja){ja=f.fromRotation(p.sm4d.get(),ja[3],m.axis(ja));null==ja||f.exactEquals(ja,n.IDENTITY)||(q.subtract(ca,ma.eye,pa),q.transformMat4(ca,ca,ja),ma.eye=q.add(ca,ca,pa),q.subtract(ca,ma.center,pa),q.transformMat4(ca,ca,ja),ma.center=q.add(ca,ca,pa),ma.up=q.transformMat4(ca,ma.up,ja))}function z(ma,pa,ja,qa){return Math.sin(ma/q.length(pa))*(ja+qa.radius)}function A(ma,pa,ja,qa){ja=h.fromScreenAtEye(pa,ja,ra);if(null==ja)return!1;v.closestPointOnSilhouette(ma,
ja,M);return v.intersectRay(ma,ja,qa)?q.squaredDistance(M,ja.origin)<q.squaredDistance(qa,ja.origin)?(q.copy(qa,M),!1):!0:(q.subtract(V,pa.eye,pa.center),q.normalize(V,V),w.fromNormalAndOffset(V,-q.dot(q.normalize(V,V),M),Y),w.intersectRay(Y,ja,qa),!1)}function C(ma,pa,ja,qa,ua,wa){var za=0;q.cross(oa,ma,pa);q.subtract(ia,ma,pa);q.length(ma)<=ua||!qa.aboveGround?(q.cross(ja,ia,qa.eye),za=q.dot(ma,pa)/(q.length(ma)*q.length(pa)),.9999>za?za=c.acosClamped(za):(ma=q.length(q.cross(e.create(),ma,pa))/
(q.length(ma)*q.length(pa)),za=c.asinClamped(ma)),wa=Math.cos(c.clamp(a.cyclicalPI.normalize(c.deg2rad(wa)),0,X)),za=-za-Math.max(0,q.length(pa)-ua)/(wa*ua)):(q.subtract(W,qa.eye,qa.center),q.cross(ja,ia,W),za=-q.length(ia)/ua);q.normalize(ja,ja);q.scale(ja,ja,q.length(oa));return za}function E(ma,pa,ja,qa){qa=Math.cos(c.clamp(a.cyclicalPI.normalize(c.deg2rad(qa)),0,X));pa=pa>ja?-(pa-ja)/(qa*ja):pa<-ja?Math.PI-(pa+ja)/(qa*ja):c.acosClamped(pa/ja);return((ma>ja?-(ma-ja)/(qa*ja):ma<-ja?Math.PI-(ma+
ja)/(qa*ja):c.acosClamped(ma/ja))-pa)*ja}function B(ma,pa,ja,qa,ua,wa,za,Aa,Fa,Da){Aa=E(ma[2],pa[2],wa[3],Aa);pa=Fa?E(ma[0],pa[0],wa[3],180):pa[0]-ma[0];ma=Math.sin(za)*pa-Math.cos(za)*Aa;za=Math.cos(za)*pa+Math.sin(za)*Aa;q.normalize(ca,ua);ua=Fa?ma/Math.sqrt(Math.abs(wa[3]**2-q.dot(ja,ca)**2)):ma/wa[3];ja=za/Math.sqrt(Math.abs(wa[3]**2-q.dot(ja,qa)**2));k.set(Da,ua,ja)}function D(ma,pa,ja,qa,ua,wa,za,Aa,Fa,Da){q.cross(oa,ma,pa);l.coordinateSystemFromOneAxisAndNormalVector(wa.up,wa.eye,Q,N,T);l.coordinateSystemFromOneAxisAndNormalVector([0,
0,1],wa.eye,H,S,I);q.copy(ja,S);q.copy(qa,H);q.normalize(ja,ja);q.scale(ja,ja,q.length(oa));l.vectorCoordinates(ma,q.normalize(N,N),q.normalize(T,T),q.normalize(Q,Q),aa);l.vectorCoordinates(pa,N,T,Q,Z);B(aa,Z,ma,H,S,za,Aa,Fa,Da,ua)}function F(ma,pa,ja,qa,ua,wa,za){f.fromRotation(ka,ua,qa);f.fromRotation(ha,za,wa);f.multiply(ba,ka,ha);q.subtract(pa,ma,ja);q.transformMat4(pa,pa,ba);q.add(pa,pa,ja)}function K(ma,pa,ja,qa,ua,wa){f.fromRotation(ka,qa,ja);f.fromRotation(ha,wa,ua);f.multiply(ba,ka,ha);q.subtract(ca,
ma.eye,pa);q.transformMat4(ca,ca,ba);ma.eye=q.add(ca,ca,pa);q.subtract(ca,ma.center,pa);q.transformMat4(ca,ca,ba);ma.center=q.add(ca,ca,pa);q.subtract(ca,ma.up,pa);q.transformMat4(ca,ca,ba);ma.up=q.add(ca,ca,pa)}function L(ma,pa,ja,qa,ua,wa){return(Math.abs(qa)>Math.PI-R.Angle||Math.abs(qa)<R.Angle)&&(Math.abs(ma[2])<ja*R.Pole||Math.abs(pa)>ja)&&wa.aboveGround&&ua<R.Tilt}function G(ma,pa,ja,qa,ua,wa){wa?(m.fromPoints(ja,qa,fa),y(pa,ma,fa)):(ja=C(ja,qa,na,pa,ma[3],ua),y(pa,ma,m.wrapAxisAngle(na,ja)))}
function O(ma,pa,ja,qa,ua,wa,za){const Aa=za?20:1;q.copy(ea,qa);la.copyFrom(pa);let Fa;for(let Da=0;Da<Aa&&1E-12<q.squaredDistance(ja,ea);Da++)if(qa=q.squaredDistance(ja,ea),D(ja,ea,S,H,da,la,ma,ua,wa,za),K(la,ma,H,da[1],S,da[0]),F(ea,ea,ma,H,da[1],S,da[0]),Fa=q.squaredDistance(ja,ea),Fa<qa||0===Da)pa.copyFrom(la);else break}b.SpherePickPointFallback=void 0;(function(ma){ma[ma.Ellipsoid=0]="Ellipsoid";ma[ma.Silhouette=1]="Silhouette"})(b.SpherePickPointFallback||(b.SpherePickPointFallback={}));u=
{exclude:new Set([u.terrainId])};const P=d.createScreenPointArray();b.NavigationMode=void 0;(function(ma){ma[ma.Vertical=0]="Vertical";ma[ma.Horizontal=1]="Horizontal"})(b.NavigationMode||(b.NavigationMode={}));const J={Elevation:3E4,Angle:c.deg2rad(16)},R={Pole:.95,Angle:c.deg2rad(18),Tilt:45},X=c.deg2rad(80),U=e.create(),M=e.create(),V=e.create(),Y=w.create(),W=e.create(),H=e.create(),S=e.create(),I=e.create(),Q=e.create(),N=e.create(),T=e.create(),aa=e.create(),Z=e.create(),da=g.create(),fa=m.create(),
ka=n.create(),ha=n.create(),ba=n.create(),ea=e.create(),ca=e.create(),ia=e.create(),la=new r.Camera,oa=e.create(),na=e.create(),ra={origin:e.create(),direction:e.create()},ta={origin:e.create(),direction:e.create()};b.PreservingHeadingThreshold=R;b.TiltThresholdPanningSpeed=X;b.VerticalPanTresholds=J;b.applyPanPlanar=function(ma,pa,ja){q.subtract(U,ja,pa);ma.eye=q.subtract(ca,ma.eye,U);ma.center=q.subtract(ca,ma.center,U)};b.applyPanSphericalDirectRotation=G;b.applyPanSphericalPreserveHeading=O;b.applyRotation=
y;b.applyRotationWithTwoAxes=K;b.applyZoomOnSphere=function(ma,pa,ja){pa.getScreenCenter(P);t.intersectScreen(ma,pa,P,ca)&&(pa.center=ca);ma=pa.distance;ja*=ma;1E-6>Math.abs(ma-ja)||(ja=q.scale(p.sv3d.get(),pa.viewForward,ja),pa.eye=q.subtract(ca,pa.center,ja))};b.applyZoomToPoint=function(ma,pa,ja,qa){const ua=p.sv3d.get();ja=1-ja;q.subtract(ua,pa,ma.eye);const wa=q.length(ua);let za=wa*(1-ja);0<=ja&&za<qa&&(za=qa,ja=-(za-wa)/wa);1E-6>Math.abs(wa-za)||(q.scale(ua,ua,ja),ma.eye=q.add(ca,ma.eye,ua),
ma.center=q.lerp(ca,ma.center,pa,ja))};b.centroid=function(ma,pa){q.set(pa,0,0,0);for(const ja of ma)q.add(pa,pa,ja);q.scale(pa,pa,1/ma.length)};b.contentIntersectorOptions=u;b.decideNavigationMode=function(ma,pa,ja){if(q.length(ma.eye)-ja.radius>J.Elevation)return b.NavigationMode.Horizontal;h.fromScreenAtEye(ma,pa,ta);return-Math.sign(ma.relativeElevation)*(.5*Math.PI+x.angle(ma.eye,ta.direction))<J.Angle?b.NavigationMode.Vertical:b.NavigationMode.Horizontal};b.distanceClampValues=[1,3E8];b.intersectPlaneFromScreenPoint=
function(ma,pa,ja,qa){return w.intersectRay(ma,h.fromScreen(pa,ja,ra),qa)};b.intersectPlaneFromScreenPointAtEye=function(ma,pa,ja,qa){return w.intersectRay(ma,h.fromScreenAtEye(pa,ja,ra),qa)};b.lengthFromPoints=E;b.minHeightLimit=50;b.normalizeCoordinate=function(ma,pa,ja){ja[0]=pa[0]/(ma.fullWidth/ma.pixelRatio);ja[1]=pa[1]/(ma.fullHeight/ma.pixelRatio);return ja};b.normalizeRotationDelta=function(ma){for(;ma>Math.PI;)ma-=2*Math.PI;for(;ma<-Math.PI;)ma+=2*Math.PI;return ma};b.offSurfaceTiltToEyeTiltGlobal=
function(ma,pa,ja,qa){return z(Math.PI/2,pa,ja,qa)+(ma-Math.PI/2)};b.onSurfaceTiltToEyeTiltGlobal=z;b.panDistanceModifier=5;b.panMotionToRotationMatrix=function(ma,pa,ja,qa,ua,wa,za,Aa,Fa){if(L(ma.center,q.dot(ma.up,ma.center),q.length(ma.center),-a.cyclicalPI.normalize(c.deg2rad(wa)),za,pa))switch(ma=-a.cyclicalPI.normalize(c.deg2rad(ua)),{eye:ua}=pa,l.coordinateSystemFromOneAxisAndNormalVector([0,0,1],ua,H,S,I),ua=ja.translation[0]*qa.pan,wa="zoom"===Fa.mode?0:ja.translation[1]*qa.pan,pa=Math.max(Math.sqrt(Math.abs(1-
q.dot(pa.center,H)**2/q.length(pa.center)**2)),.5),za=-Math.cos(ma)*wa+Math.sin(ma)*ua,f.rotate(Aa.pan.matrix,Aa.pan.matrix,(Math.sin(ma)*wa+Math.cos(ma)*ua)/pa,H),Aa.pan.enabled=!0,Fa.mode){case "pan":f.rotate(Aa.pan.matrix,Aa.pan.matrix,za,S);Aa.pan.enabled=!0;break;case "zoom":Aa.zoom=-ja.translation[1]*qa.zoom}else{const {eye:Da,viewRight:Ha}=pa;pa=q.cross(p.sv3d.get(),Ha,Da);ma=ja.translation[0]*qa.pan;0!==ma&&(f.rotate(Aa.pan.matrix,Aa.pan.matrix,-ma,pa),Aa.pan.enabled=!0);switch(Fa.mode){case "pan":ja=
ja.translation[1]*qa.pan;0!==ja&&(f.rotate(Aa.pan.matrix,Aa.pan.matrix,ja,Ha),Aa.pan.enabled=!0);break;case "zoom":Aa.zoom=-ja.translation[1]*qa.zoom}}};b.panToPosition=function(ma,pa,ja,qa,ua,wa,za){L(ja,q.dot(pa.up,ja),ma[3],-a.cyclicalPI.normalize(c.deg2rad(ua)),wa,pa)?O(ma,pa,ja,qa,-a.cyclicalPI.normalize(c.deg2rad(ua)),wa,za):G(ma,pa,ja,qa,wa,za)};b.pickPointAndInitSphere=function(ma,pa,ja,qa,ua,wa){const za=e.create(),Aa=v.create();let Fa=!0,Da=!0;ma.intersectScreen(ja,za,wa)?Aa[3]=q.length(za):
(Da=!1,Aa[3]=pa.aboveGround&&ua!==b.SpherePickPointFallback.Ellipsoid?Math.max(q.length(pa.center),.9*qa.radius):q.length(pa.eye)-pa.relativeElevation,ua===b.SpherePickPointFallback.Silhouette?A(Aa,pa,ja,za):Fa=t.intersectScreen(Aa,pa,ja,za));return{sphere:Aa,scenePickPoint:Fa?za:null,hasGeometryIntersection:Da}};b.pivotDistanceModifier=30;b.preserveHeadingThreshold=L;b.rotatePivotDistanceModifier=5;b.rotatePivotMinDistanceModifier=10;b.rotatePointAroundTwoAxes=F;b.rotateScreenPixelArea=90;b.rotationAngleAndAxisDirectRotation=
C;b.rotationAnglesAndAxesHeadingPreserving=D;b.rotationAnglesHeadingPreserving=B;b.screenPixelArea=80;b.sphereOrPlanePointFromScreenPoint=A;b.zoomDistanceModifier=8;b.zoomMaxDistanceModifier=1508E5;b.zoomMinDistanceModifier=200;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/axisAngle":function(){define("exports ../../chunks/quat ../../chunks/quatf64 ../../chunks/vec3 ./vector ./vectorStacks".split(" "),function(b,a,c,d,f,n){function k(w=e){return[w[0],w[1],
w[2],w[3]]}function g(w,v,x,p,h=k()){h[0]=w;h[1]=v;h[2]=x;h[3]=p;return h}function q(w,v){w[3]=v;return w}const e=[0,0,1,0],m=c.create(),l=c.create();b.angle=function(w){return w[3]};b.axis=function(w){return w};b.compose=function(w,v,x){a.setAxisAngle(m,w,w[3]);a.setAxisAngle(l,v,v[3]);a.multiply(m,l,m);return q(x,a.getAxisAngle(x,m))};b.copy=function(w,v=k()){return g(w[0],w[1],w[2],w[3],v)};b.create=k;b.fromAxisAndAngle=function(w,v){const x=k();d.copy(x,w);x[3]=v;return x};b.fromPoints=function(w,
v,x){d.cross(x,w,v);d.normalize(x,x);x[3]=f.angle(w,v);return x};b.fromValues=g;b.setAngle=q;b.up=e;b.wrap=function(w,v,x,p){return g(w,v,x,p,n.sv4d.get())};b.wrapAxisAngle=function(w,v){return g(w[0],w[1],w[2],v,n.sv4d.get())};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/geometryUtils/ray":function(){define("exports ../../../../core/screenUtils ../../../../chunks/vec2 ../../../../chunks/vec3 ../../../../geometry/support/ray ../../../../geometry/support/vectorStacks".split(" "),
function(b,a,c,d,f,n){function k(e,m,l){return g(e,e.screenToRender(m,a.castRenderScreenPointArray3(n.sv3d.get())),l)}function g(e,m,l){const w=a.castRenderScreenPointArray3(c.copy(n.sv3d.get(),m));w[2]=0;if(!e.unprojectFromRenderScreen(w,l.origin))return null;m=a.castRenderScreenPointArray3(c.copy(n.sv3d.get(),m));m[2]=1;e=e.unprojectFromRenderScreen(m,n.sv3d.get());if(null==e)return null;d.subtract(l.direction,e,l.origin);return l}function q(e,m,l){d.copy(l.origin,e.eye);m=d.set(n.sv3d.get(),m[0],
m[1],1);e=e.unprojectFromRenderScreen(m,n.sv3d.get());if(null==e)return null;d.subtract(l.direction,e,l.origin);return l}b.fromRender=g;b.fromRenderAtEye=q;b.fromScreen=k;b.fromScreenAtEye=function(e,m,l){return q(e,e.screenToRender(m,a.castRenderScreenPointArray3(n.sv3d.get())),l)};b.fromScreenNormalized=function(e,m,l=f.create()){k(e,a.screenPointObjectToArray(m),l);d.normalize(l.direction,l.direction);return l};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/geometryUtils/sphere":function(){define(["exports",
"../../../../geometry/support/ray","../../../../chunks/sphere","./ray"],function(b,a,c,d){const f=a.create();b.intersectScreen=function(n,k,g,q){k=d.fromScreenAtEye(k,g,f);return c.intersectRay(n,k,q)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/local/ZoomStepController":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/time ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../camera/constraintUtils/TiltMode ../../../layers/VoxelWasm ../PointToPointAnimationController ../../utils/navigationUtils ../../../webgl-engine/lib/Camera ../../../webgl-engine/lib/Intersector ../../../../animation/easing".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z){b.ZoomStepController=class extends t.PointToPointAnimationController{constructor(){super(...arguments);this._zoomLocation=l.create();this._tmpCamera=new u.Camera;this._tmpRayDir=l.create();this._tmpCenter=l.create();this._constraintOptions={selection:v.ConstraintTypes.ALL,interactionType:x.InteractionType.ZOOM,interactionFactor:null,interactionStartCamera:new u.Camera,interactionDirection:null,tiltMode:p.TiltMode.TUMBLE}}zoomStep(B,D){if(this.active){var F=
this.view.state,{interactionStartCamera:K}=this._constraintOptions;K&&(this.animation.finished?K.copyFrom(F.camera):this.animation.cameraAt(1,K));this._tmpCamera.copyFrom(F.camera);K=y.newIntersector(this.view.state.viewingMode);F=!1;0<B?(F=this.intersectionHelper.intersectScreenFreePointFallback(D,this._zoomLocation,0===this.view.map.ground.opacity?r.contentIntersectorOptions:{}),this.intersectionHelper.intersectRay(this._tmpCamera.ray,K,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter)):
this.intersectionHelper.intersectRay(this._tmpCamera.ray,K,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:m.copy(this._zoomLocation,this._tmpCamera.center);B=.6**B;D=this.view._stage.renderView.getMinimalDepthForArea(h.getVoxelWasm(this.view),D[0],D[1],this.view.state.camera,60);m.subtract(E,this._tmpCamera.eye,this._zoomLocation);m.normalize(E,E);K=c.clamp(Math.min(r.zoomDistanceModifier,1/Math.abs(m.dot(C,E)))*Math.abs(this.view.camera.position.z),r.zoomMinDistanceModifier,r.zoomMaxDistanceModifier);
if(D=null!=D?D:K)if(K=l.create(),m.subtract(K,this._zoomLocation,this._tmpCamera.eye),D<m.length(K)||!F)m.normalize(K,K),m.add(this._zoomLocation,this._tmpCamera.eye,m.scale(K,K,D));this._updateCamera(this._tmpCamera,B,this._zoomLocation);this.begin(this._tmpCamera)}}animationSettings(){return{duration:d.Milliseconds(600),easing:z.outExpo}}_updateCamera(B,D,F){m.subtract(this._tmpRayDir,F,B.eye);const K=m.length(this._tmpRayDir);let L=K*D;const G=Math.max(4,1.01*B.nearFar[0]);0!==L&&(1>=D&&L<G&&(L=
G,D=L/K),1E-6>Math.abs(K-L)||(m.scale(this._tmpRayDir,this._tmpRayDir,D),B.eye=m.subtract(A,F,this._tmpRayDir),B.center=m.lerp(A,B.center,F,1-D),w.applyAll(this.view,B,this._constraintOptions)))}};b.ZoomStepController=a.__decorate([e.subclass("esri.views.3d.state.controllers.local.ZoomStepController")],b.ZoomStepController);const A=l.create(),C=l.fromValues(0,0,1),E=l.create();Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/VoxelWasm":function(){define(["require",
"exports"],function(b,a){let c;const d=new Map;a.addLayerViewToWasm=async function(f){null==c&&(c=new Promise((g,q)=>b(["../../../layers/VoxelWasmPerSceneView"],e=>g(Object.freeze(Object.defineProperty({__proto__:null,default:e},Symbol.toStringTag,{value:"Module"}))),q)));const n=f.view,k=d.get(n);return k?k.addVoxelLayer(f):(await c.then(g=>{g=new g.default({view:n});d.set(n,g);return g})).addVoxelLayer(f)};a.getVoxelWasm=function(f){return d.get(f)};a.removeLayerViewFromWasm=function(f){const n=
f.view,k=d.get(n);k&&1>k.removeVoxelLayer(f)&&(d.delete(n),0===d.size&&(c=null))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/handlers/support":function(){define(["exports"],function(b){b.eventMatchesMousePointerAction=function(a,c){if("touch"===a.pointerType)return!1;switch(c){case "primary":return 0===a.button;case "secondary":return 2===a.button;case "tertiary":return 1===a.button}};b.eventMatchesPointerAction=function(a,c){switch(c){case "primary":return"touch"===
a.pointerType||0===a.button;case "secondary":return"touch"!==a.pointerType&&2===a.button;case "tertiary":return"touch"!==a.pointerType&&1===a.button}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/DragRotate":function(){define(["exports","../../../../core/screenUtils","../../state/controllers/RotateController","../../../input/InputHandler","../../../input/handlers/support"],function(b,a,c,d,f){class n extends d.InputHandler{constructor(k,g,q,e){super(!0);
this._view=k;this.pointerAction=g;this._pivot=q;this.registerIncoming("drag",e,m=>this._handleDrag(m))}_handleDrag(k){const g=k.data;if(!(1<g.pointers.size)&&f.eventMatchesMousePointerAction(k.data,this.pointerAction)){var q=a.createScreenPointArray(g.center.x,g.center.y);switch(g.action){case "start":this._cameraController&&(this._cameraController.end(),this._cameraController=null);this._cameraController=new c.RotateController({view:this._view,pivot:this._pivot});this._view.state.switchCameraController(this._cameraController);
this._cameraController.begin(q);break;case "update":this._cameraController&&this._cameraController.update(q);break;case "end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}k.stopPropagation()}}}Object.defineProperty(b,"PivotPoint",{enumerable:!0,get:()=>c.PivotPoint});b.DragRotate=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/RotateController":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/ellipsoidUtils ../../camera/constraintUtils ../../camera/constraintUtils/ConstraintTypes ../../camera/constraintUtils/InteractionType ../../camera/constraintUtils/TiltMode ../../layers/VoxelWasm ../Constraints ./InteractiveController ../utils/navigationUtils".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A,C){b.PivotPoint=void 0;(function(D){D[D.CENTER=0]="CENTER";D[D.EYE=1]="EYE"})(b.PivotPoint||(b.PivotPoint={}));b.RotateController=class extends A.InteractiveController{get _intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(D){super(D);this.pivot=b.PivotPoint.CENTER;this._rotScale=0;this._lastPoint=w.create();this._tmpWorldUp=x.create();this._tmpViewDir=x.create();this._tmpRotCurPoint=w.create();this._tmpTransf=m.create();
this._tmpAxis=x.create();this._tmpPivotPoint=x.create();this._pivotPos=x.create();this._constraintOptions={selection:t.ConstraintTypes.ALL,interactionType:r.InteractionType.TUMBLE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:u.TiltMode.TUMBLE}}initialize(){this._rotScale=this.pivot===b.PivotPoint.CENTER?3:1.5}begin(D){if(this.active){switch(this.pivot){case b.PivotPoint.EYE:v.copy(this._pivotPos,this.startCamera.eye);this._constraintOptions.interactionType=r.InteractionType.LOOK_AROUND;
this._constraintOptions.tiltMode=u.TiltMode.LOOK_AROUND;this._constraintOptions.selection=t.ConstraintTypes.NONE;break;case b.PivotPoint.CENTER:const F=this._intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this._pivotPos,0===this.view.map.ground.opacity?C.contentIntersectorOptions:{});F||v.copy(this._pivotPos,this.startCamera.center);this._constrainPivotPoint(D,F);this.startCamera.center=this._pivotPos;this._constraintOptions.interactionType=r.InteractionType.TUMBLE;this._constraintOptions.tiltMode=
u.TiltMode.TUMBLE;this._constraintOptions.selection=t.ConstraintTypes.ALL&~t.ConstraintTypes.DISTANCE}this._constraintOptions.interactionStartCamera=this.startCamera;C.normalizeCoordinate(this.startCamera,D,this._lastPoint)}}_constrainPivotPoint(D,F){const K=this.startCamera,L=x.create();v.subtract(L,this._pivotPos,K.eye);const G=v.length(L);var O=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(K.eye,B);O=Math.max(Math.min(C.rotatePivotDistanceModifier,1/Math.abs(v.dot(B,
K.viewForward)))*O,C.rotatePivotMinDistanceModifier);F&&(O=Math.min(G,O));var P=p.getReferenceEllipsoid(this.view.spatialReference),J=d.createScreenPointArray(K.width/K.pixelRatio*.5,K.height/K.pixelRatio*.5);P=C.decideNavigationMode(this.startCamera,J,P);J=this.view._stage.renderView.getMinimalDepthForArea(y.getVoxelWasm(this.view),K.fullWidth/K.pixelRatio*.5,K.fullHeight/K.pixelRatio*.5,K,2.5*C.rotateScreenPixelArea,C.rotateScreenPixelArea);D=this.view._stage.renderView.getMinimalDepthForArea(y.getVoxelWasm(this.view),
D[0],D[1],K,C.rotateScreenPixelArea);if(null!=J||null!=D)J=J??D??0,D=null==D||P===C.NavigationMode.Horizontal?J:D,O=J>D?D:J,O=F?Math.min(O,G):O;v.normalize(L,L);v.copy(this._pivotPos,v.add(this._tmpPivotPoint,K.eye,v.scale(this._tmpPivotPoint,L,O)))}update(D){if(this.active){switch(this.pivot){case b.PivotPoint.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,D,this.currentCamera.center,this._pivotPos);break;case b.PivotPoint.CENTER:this.currentCamera.center=this._pivotPos,this.currentCamera.eye=
this._applyRotation(this.currentCamera,D,this.currentCamera.eye,this._pivotPos)}h.applyAll(this.view,this.currentCamera,this._constraintOptions);this.commitCamera()}}end(){this.active&&this.finishController()}_applyRotation(D,F,K,L){this.view.renderCoordsHelper.worldUpAtPosition(L,this._tmpWorldUp);C.normalizeCoordinate(D,F,this._tmpRotCurPoint);F=(this._lastPoint[1]-this._tmpRotCurPoint[1])*this._rotScale;let G=(this._tmpRotCurPoint[0]-this._lastPoint[0])*this._rotScale;v.subtract(this._tmpViewDir,
K,L);K=v.length(this._tmpViewDir);K=c.acosClamped(v.dot(this._tmpViewDir,this._tmpWorldUp)/K);if(this.pivot===b.PivotPoint.EYE){const O=.5*Math.PI-K,P=.495*Math.PI;F=O-Math.max(-P,Math.min(P,O+-.5*F))}F=c.clamp(F+K,z.TiltDefault.min,z.TiltDefault.max)-K;v.cross(this._tmpAxis,D.up,this._tmpViewDir);this.pivot===b.PivotPoint.CENTER&&(G=-G);e.fromRotation(this._tmpTransf,G,this._tmpWorldUp);e.rotate(this._tmpTransf,this._tmpTransf,F,this._tmpAxis);v.transformMat4(this._tmpViewDir,this._tmpViewDir,this._tmpTransf);
D.up=v.transformMat4(E,D.up,this._tmpTransf);v.add(E,L,this._tmpViewDir);l.copy(this._lastPoint,this._tmpRotCurPoint);return E}};a.__decorate([f.property()],b.RotateController.prototype,"pivot",void 0);b.RotateController=a.__decorate([q.subclass("esri.views.3d.state.controllers.RotateController")],b.RotateController);const E=x.create(),B=x.create();Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/InteractiveController":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../ViewStateManager ./CameraController ../../webgl-engine/lib/Camera".split(" "),
function(b,a,c,d,f,n,k,g,q,e){b.InteractiveController=class extends q.CameraController{constructor(){super(...arguments);this.startCamera=new e.Camera;this.currentCamera=new e.Camera;this._lastInteraction=0}get isInteractive(){return performance.now()-this._lastInteraction<g.interactingTimeout}stepController(m,l){l.copyViewFrom(this.currentCamera);this.currentCamera.copyFrom(l)}onControllerStart(m){this.state=q.State.Running;this.startCamera.copyFrom(m);this.currentCamera.copyFrom(m)}onControllerEnd(m){m.copyViewFrom(this.currentCamera)}commitCamera(){this._lastInteraction=
performance.now();setTimeout(()=>this.notifyChange("isInteractive"),g.interactingTimeout);this.view.state.updateCamera(m=>this.stepController(0,m));this.steppingFinished&&this.finishController()}};a.__decorate([c.property({readOnly:!0})],b.InteractiveController.prototype,"isInteractive",null);a.__decorate([c.property()],b.InteractiveController.prototype,"_lastInteraction",void 0);b.InteractiveController=a.__decorate([k.subclass("esri.views.3d.state.controllers.InteractiveController")],b.InteractiveController);
Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/ViewStateManager":function(){define("exports ../../../chunks/tslib.es6 ../../../Camera ../../../Viewpoint ../../../core/Accessor ../../../core/Logger ../../../core/maybe ../../../core/reactiveUtils ../../../core/scheduling ../../../core/screenUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../chunks/vec4f64 ../../../geometry/Extent ../../../geometry/Point ../../../geometry/support/webMercatorUtils ../../ViewingMode ../camera/constraintUtils ../camera/intersectionUtils ./ConstraintsManager ./Frustum ./GoToOperation ./controllers/SurfaceCollisionCorrectionController ../support/cameraUtils ../support/PropertiesPool ../support/viewpointUtils ../webgl-engine/lib/Camera ../webgl-engine/lib/RenderFeature ../../support/RenderState ../../webgl/FramebufferObject".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A,C,E,B,D,F,K,L,G,O,P,J,R,X){b.ViewStateManager=class extends f{get camera(){const I=this._get("camera");if(!this.ready)return I;const Q=L.internalToExternal(this.view,this.view.state.camera,W);return Q&&I&&Q.equals(I)?I:Q.clone()}set camera(I){this._updatePropertyBeforeReady("camera",I)||(this.view.elevationProvider?.enableElevationCache(!0),this.setStateCamera(L.externalToInternal(this.view,I),{applyConstraints:!1})||n.getLogger(this).error("#camera\x3d",
"Invalid camera",I),this.view.elevationProvider?.enableElevationCache(!1))}get contentCamera(){const I=this._get("contentCamera");if(!this.ready)return I;const Q=L.internalToExternal(this.view,this.view.state.contentCamera,W);return Q&&I&&Q.equals(I)?I:Q.clone()}set contentCamera(I){this._updatePropertyBeforeReady("contentCamera",I)||(I=L.externalToInternal(this.view,I),null==I?this.view.state.contentCamera=null:(this._updateElevation(I),this.view.state.contentCamera=I))}installContentCameraReset(I){this.removeHandles("content-camera-reset");
this.test.contentCameraResetState.clear();if(!this.view.state.fixedContentCamera)return!1;const Q=this.zoom,N=this.view.state.camera.distance**2,T=h.fromArray(this.view.state.camera.center),aa=I.sticky?this.contentCamera.clone():null;this.addHandles([g.watch(()=>this.contentCamera,()=>{I.sticky||(this.removeHandles("content-camera-reset"),this.test.contentCameraResetState.clear())}),g.watch(()=>this.zoom,Z=>{void 0!==Z&&void 0!==Q&&(this.test.contentCameraResetState.set("view.zoom",Math.abs(Z-Q)/
2),2<Math.abs(Z-Q)?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=aa))}),g.watch(()=>this.view.state.camera,Z=>{Z=p.squaredDistance(T,Z.center);this.test.contentCameraResetState.set("camera.center",Z/N);Z>N?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=aa)})],"content-camera-reset");return!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(I){this._updatePropertyBeforeReady("center",
I)||(I?this.isCompatible(I)?this.setStateCamera(this._centerToCamera(I),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():n.getLogger(this).error("#center\x3d","Invalid center",I):n.getLogger(this).error("#center\x3d","Center has an incompatible spatial reference (center: "+(I.spatialReference?I.spatialReference.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",I):n.getLogger(this).error("#center\x3d","Center may not be null or undefined"))}get extent(){if(!this.ready)return this._get("extent");
var I=this.view;I=L.toExtent(I,I.state.camera,I.pointsOfInterest.centerOnContent.renderLocation);return null!=I?I:this._get("extent")}set extent(I){this._updatePropertyBeforeReady("extent",I)||(I?this.isCompatible(I)?this.setStateCamera(this._extentToCamera(I),{applyConstraints:!0})||n.getLogger(this).error("#extent\x3d","Invalid extent",I):n.getLogger(this).error("#extent\x3d","Extent has an incompatible spatial reference (extent: "+(I.spatialReference?I.spatialReference.wkid:"none")+", view: "+
this.view.spatialReference?.wkid+")",I):n.getLogger(this).error("#extent\x3d","Extent may not be null or undefined"))}get frustum(){const I=this._propertiesPool.get("frustum");I.renderCoordsHelper=this.view.renderCoordsHelper;I.update(this.view.state.camera);return I}get _initialViewpoint(){const I=this.view.map;return I&&"initialViewProperties"in I?I.initialViewProperties?.viewpoint:void 0}get hasInitialView(){return!!this._initialViewpoint}get scale(){if(this.ready){const I=this.view.pointsOfInterest.centerOnContent;
return L.distanceToScale(this.view,I.distance,I.location.latitude)}return this._get("scale")}set scale(I){this._updatePropertyBeforeReady("scale",I)||this.setStateCamera(this._scaleToCamera(I),{applyConstraints:!0})||n.getLogger(this).error("#scale\x3d","Invalid scale",I)}get padding(){if(!this.ready)return this._get("padding");var I=this.view.state.camera,Q=I.padding;const N=I.pixelRatio;I=this._get("padding");const T=Math.round(Q[P.PaddingSide.TOP]/N),aa=Math.round(Q[P.PaddingSide.RIGHT]/N),Z=Math.round(Q[P.PaddingSide.BOTTOM]/
N);Q=Math.round(Q[P.PaddingSide.LEFT]/N);return null!=I&&I.top===T&&I.right===aa&&I.bottom===Z&&I.left===Q?I:{top:T,right:aa,bottom:Z,left:Q}}set padding(I){this._updatePropertyBeforeReady("padding",I)||(this._paddingToArray(I,this.view.state.camera.pixelRatio,S),this.view.state.updateCamera(Q=>Q.padding=S))}_paddingToArray(I,Q,N){I?t.set(N,I.top||0,I.right||0,I.bottom||0,I.left||0):t.set(N,0,0,0,0);for(I=0;4>I;I++)N[I]=Math.round(N[I]*Q)}get screenCenter(){const I=this.padding;return e.createScreenPoint((this.view.width-
(I.left+I.right))/2+I.left,(this.view.height-(I.top+I.bottom))/2+I.top)}get viewpoint(){return this.ready?O.fromCamera(this.view,this.camera):this._get("viewpoint")}set viewpoint(I){if(!this._updatePropertyBeforeReady("viewpoint",I))if(I)if(this.isCompatible(I))this.setStateCamera(this._viewpointToCamera(I),{applyConstraints:!I.camera})||n.getLogger(this).error("#viewpoint\x3d","Invalid viewpoint",I);else{var Q=null!=I.camera?I.camera.position:I.targetGeometry;Q=null!=Q&&Q.spatialReference;n.getLogger(this).error("#viewpoint\x3d",
"Viewpoint has an incompatible spatial reference (viewpoint: "+(Q?Q.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",I)}else n.getLogger(this).error("#viewpoint\x3d","Viewpoint may not be null or undefined")}get zoom(){return this.ready?L.scaleToZoom(this.view,this.scale):this._get("zoom")}set zoom(I){this._updatePropertyBeforeReady("zoom",I)||void 0===I||this.setStateCamera(this._zoomToCamera(I),{applyConstraints:!0})||n.getLogger(this).error("#zoom\x3d","Invalid zoom",I)}_computeCanvasSize(){if(this._devicePixelRatioOverride)return this.view.state.contentPixelRatio=
this._devicePixelRatioOverride,this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*this._devicePixelRatioOverride),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*this._devicePixelRatioOverride),this._tmpCanvasSize.pixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize;var I=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio);I=(this._usePhysicalPixelRendering?this._windowDevicePixelRatio:I)*this.view.resolutionScale;this._tmpCanvasSize.width=
Math.round(this.view.surface.clientWidth*I);this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*I);X.ensureAttachmentMaxSize(this._tmpCanvasSize,this.view._stage.renderView.renderingContext.parameters.maxTextureSize);this._tmpCanvasSize.pixelRatio=0<this._tmpCanvasSize.width?this._tmpCanvasSize.width/this.view.surface.clientWidth*.5+this._tmpCanvasSize.height/this.view.surface.clientHeight*.5:I;this.view.state&&(this.view.state.contentPixelRatio=Math.min(this._windowDevicePixelRatio,
this.view.qualitySettings.maximumPixelRatio));return this._tmpCanvasSize}get _rasterPixelRatio(){return null!=this._devicePixelRatioOverride?this._devicePixelRatioOverride:this._usePhysicalPixelRenderingAny?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)}get _usePhysicalPixelRendering(){return this.view?._stage?.renderer.isFeatureEnabled(J.RenderFeature.PhysicalPixelRendering)??!1}get _usePhysicalPixelRenderingAny(){const I=this.view?._stage?.renderer;
return I&&(I.isFeatureEnabled(J.RenderFeature.PhysicalPixelRendering,R.RenderState.IDLE)||I.isFeatureEnabled(J.RenderFeature.PhysicalPixelRendering,R.RenderState.INTERACTING)||I.isFeatureEnabled(J.RenderFeature.PhysicalPixelRendering,R.RenderState.ANIMATING))}constructor(I){super(I);this.constraintsManager=null;this.ready=!1;this._windowDevicePixelRatio=1;this._devicePixelRatioOverride=null;this._idleTimeout=300;this.test={viewStateManager:this,contentCameraResetState:new Map,setDevicePixelRatio:Q=>
this._devicePixelRatioOverride=Q,renderState:null,get maximumPixelRatio(){return this.viewStateManager.view.qualitySettings.maximumPixelRatio},get updatingIgnoreRenderState(){return null!=this.renderState},get idleTimeoutEnabled(){return 0<this.viewStateManager._idleTimeout},set idleTimeoutEnabled(Q){this.viewStateManager._idleTimeout=Q?300:0}};this._propertiesPool=new G.PropertiesPool({frustum:D.Frustum},this);this._cameraSetByUser=!1;this._gotoOperation=null;this._cameraChangeTime=0;this._tmpCanvasSize=
new U}initialize(){this._cameraChangeTime=performance.now();this.addHandles([g.on(()=>this.view.state.events,"before-camera-change",I=>I&&this._updateElevation(I)),g.watch(()=>this.view.state?.camera,(I,Q)=>this._cameraChangedHandler(I,Q),g.sync)]);g.when(()=>this.view.state?.camera,I=>this._updateElevation(I),{once:!0,sync:!0});this.addHandles([q.addFrameTask({prepare:()=>this._prepareFrame()}),g.watch(()=>this.view.state.cameraController,()=>{this._cameraSetByUser=!0;this.removeHandles("pending-initial-view")}),
g.on(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale"))])}destroy(){this.exit();this._propertiesPool=k.destroyMaybe(this._propertiesPool)}init(){this.constraintsManager=new B.ConstraintsManager({view:this.view});this._prepareFrame();var I=this._getInitialProperties();this._cameraSetByUser=!1;this._set("ready",!0);for(const Q of I)this.set(Q.name,Q.value);this._cameraSetByUser||((I=this._initialViewpoint||this.view.initialExtent)&&this.isCompatible(I)?this._setInitialView(I):
this.view.state.viewingMode===A.ViewingMode.Local&&this.addHandles(g.when(()=>this.view.basemapTerrain.ready,()=>{this.removeHandles("pending-initial-view");this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),"pending-initial-view"))}exit(){this._cancelGoToOperation();this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this._cameraSetByUser=!1,this.removeHandles("pending-initial-view"),this.constraintsManager=k.destroyMaybe(this.constraintsManager))}async goTo(I,
Q){Q={animate:!0,...Q};null!=this._gotoOperation&&this._gotoOperation.abort(Q.animate);this._gotoOperation=new F.GoToOperation(I,Q,this.view);this.view.resourceController.scheduler.stopFrame();return this._gotoOperation.promise}debugSetCameraOnContent(){this.setStateCamera(E.cameraOnContentAlongViewDirection(this.view),{applyConstraints:!1})}step(I){const Q=this.view.state,N=Q?.cameraController;N&&(Q.updateCamera(T=>N.stepController(I,T)),N.steppingFinished&&N.finishController())}_cancelGoToOperation(){null!=
this._gotoOperation&&(this._gotoOperation.abort(),this._gotoOperation=null)}_getInitialProperties(){const I=new Set,Q=[];for(const {propertyName:N,overrides:T}of V){const aa=I.has(N),Z=this._isOverridden(N);!aa&&Z&&Q.push({name:N,value:this._get(N)});this._clearOverride(N);(aa||Z)&&T.forEach(da=>I.add(da))}return Q}_setInitialView(I){if(null!=I&&!this._cameraSetByUser)if(I instanceof c)this.setStateCamera(L.externalToInternal(this.view,I),{applyConstraints:!1});else if(I instanceof d)if(I.targetGeometry instanceof
u){var Q=L.fromExtentSync(this.view,I.targetGeometry,0,.5,L.OrientationMode.LOCKED);null!=Q&&this.setStateCamera(L.externalToInternal(this.view,Q),{applyConstraints:!0})}else Q={applyConstraints:!I.camera},I=this._viewpointToCamera(I),this.setStateCamera(I,Q);else Q=L.fromExtentSync(this.view,I,0,.5,L.OrientationMode.LOCKED),null!=Q&&this.setStateCamera(L.externalToInternal(this.view,Q),{applyConstraints:!0})}_updatePropertyBeforeReady(I,Q){if(this.ready)return!1;this._override(I,Q);Q&&M.has(I)&&
this._override("hasInitialView",!0);return!0}isCompatible(I){return null==I?!1:I instanceof d?I.camera?this.isCompatible(I.camera):this.isCompatible(I.targetGeometry):I instanceof c?this.isCompatible(I.position):I.spatialReference&&z.canProject(I.spatialReference,this.view.spatialReference)}_getPreservingHeadingTilt(I=Y){this._cameraSetByUser?(I.heading=this.camera.heading,I.tilt=this.camera.tilt):(I.heading=0,I.tilt=.5);return I}_centerPointAtDistanceToCamera(I,Q,N=H){const {heading:T,tilt:aa}=this._getPreservingHeadingTilt();
I=L.getObserverForPointAtDistanceSync(this.view,T,aa,I,Q,L.OrientationMode.ADJUST);if(null==I)return null;N.copyFrom(this.view.state.camera);N.eye=I.eye;N.center=I.center;N.up=I.up;return N}_centerToCamera(I){const Q=this.view.pointsOfInterest.centerOnContent;Q.runTask();return this._centerPointAtDistanceToCamera(I,Q.distance)}_extentToCamera(I){const {heading:Q,tilt:N}=this._getPreservingHeadingTilt();return(I=L.fromExtentSync(this.view,I,Q,N,L.OrientationMode.ADJUST,W))?L.externalToInternal(this.view,
I):null}_scaleToCamera(I){if(null==I)return null;var Q=this.view.pointsOfInterest.centerOnContent;Q.runTask();const N=Q.renderLocation;Q=Q.location.latitude;if(null==Q)return null;I=L.scaleToDistance(this.view,I,Q);return this._centerPointAtDistanceToCamera(N,I)}_zoomToCamera(I){return this._scaleToCamera(L.zoomToScale(this.view,I))}_viewpointToCamera(I){return L.externalToInternal(this.view,O.toCameraSync(this.view,I))}setStateCamera(I,Q){if(null==I||!this.view.state.stopActiveCameraController())return!1;
this._cameraSetByUser=!0;Q.doNotCancelGoToOperation||this._cancelGoToOperation();this.view.state.updateCamera(N=>{Q.positionAndOrientationOnly?(N.eye=I.eye,N.center=I.center,N.up=I.up):N.copyFrom(I);Q.applyConstraints&&C.applyAll(this.view,N)});Q.applyConstraints||(this.view.state.cameraController=new K.SurfaceCollisionCorrectionController({view:this.view,desiredCamera:I}));return!0}_prepareFrame(){const {surface:I,canvas:Q}=this.view;if(I&&Q){this._windowDevicePixelRatio=window.devicePixelRatio;
var N=this._computeCanvasSize();if(0!==N.width&&0!==N.height){if(Q.width!==N.width||Q.height!==N.height)Q.width=N.width,Q.height=N.height;if(this.view.state){const T=this.view.state.camera;if(T.fullWidth!==N.width||T.fullHeight!==N.height||T.pixelRatio!==N.pixelRatio)H.copyFrom(T),H.pixelRatio!==N.pixelRatio&&(this._paddingToArray(this.padding,N.pixelRatio,S),H.padding=S),H.fullWidth=N.width,H.fullHeight=N.height,H.pixelRatio=N.pixelRatio,this.view.state.camera=H;this._updateViewState()}}}}_updateElevation(I){var Q=
this.view.basemapTerrain?.spatialReference;const N=this.view.renderCoordsHelper?.getAltitude(I.eye)??0;Q=Q?E.surfaceElevationBelowRenderLocation(this.view,I.eye):0;I.relativeElevation=N-Q}_updateViewState(){null!=this.test.renderState?this.view.state.mode=this.test.renderState:this.view.animation?this.view.state.mode=R.RenderState.ANIMATING:this.view.interacting?this.view.state.mode=R.RenderState.INTERACTING:(this.view.state.mode===R.RenderState.ANIMATING&&(this._cameraChangeTime=0),performance.now()-
this._cameraChangeTime<this._idleTimeout?this.view.state.mode=R.RenderState.INTERACTING:this.view.state.mode=R.RenderState.IDLE);this.view.state.rasterPixelRatio=this._rasterPixelRatio}_cameraChangedHandler(I,Q){I&&Q&&I.almostEquals(Q)||(this._cameraChangeTime=performance.now(),this._updateViewState())}};a.__decorate([m.property({type:c,dependsOn:["view.state.camera","ready"]})],b.ViewStateManager.prototype,"camera",null);a.__decorate([m.property({type:c,dependsOn:["view.state.contentCamera","ready"]})],
b.ViewStateManager.prototype,"contentCamera",null);a.__decorate([m.property({type:y})],b.ViewStateManager.prototype,"center",null);a.__decorate([m.property({type:u})],b.ViewStateManager.prototype,"extent",null);a.__decorate([m.property({readOnly:!0})],b.ViewStateManager.prototype,"frustum",null);a.__decorate([m.property()],b.ViewStateManager.prototype,"_initialViewpoint",null);a.__decorate([m.property({readOnly:!0})],b.ViewStateManager.prototype,"hasInitialView",null);a.__decorate([m.property({readOnly:!0,
type:Boolean})],b.ViewStateManager.prototype,"ready",void 0);a.__decorate([m.property({type:Number})],b.ViewStateManager.prototype,"scale",null);a.__decorate([m.property()],b.ViewStateManager.prototype,"padding",null);a.__decorate([m.property({readOnly:!0})],b.ViewStateManager.prototype,"screenCenter",null);a.__decorate([m.property({constructOnly:!0})],b.ViewStateManager.prototype,"view",void 0);a.__decorate([m.property({type:d})],b.ViewStateManager.prototype,"viewpoint",null);a.__decorate([m.property({type:Number})],
b.ViewStateManager.prototype,"zoom",null);a.__decorate([m.property({readOnly:!0})],b.ViewStateManager.prototype,"_rasterPixelRatio",null);a.__decorate([m.property({readOnly:!0})],b.ViewStateManager.prototype,"_usePhysicalPixelRendering",null);a.__decorate([m.property({readOnly:!0})],b.ViewStateManager.prototype,"_usePhysicalPixelRenderingAny",null);a.__decorate([m.property()],b.ViewStateManager.prototype,"_windowDevicePixelRatio",void 0);a.__decorate([m.property()],b.ViewStateManager.prototype,"_devicePixelRatioOverride",
void 0);b.ViewStateManager=a.__decorate([x.subclass("esri.views.3d.state.ViewStateManager")],b.ViewStateManager);class U{constructor(){this.height=this.width=0;this.pixelRatio=1}}const M=new Set("camera viewpoint extent scale center zoom".split(" ")),V=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",
overrides:[]},{propertyName:"padding",overrides:[]}],Y={heading:0,tilt:0},W=new c,H=new P.Camera,S=r.create();b.interactingTimeout=100;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/ConstraintsManager":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/mathUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../ViewingMode ../camera/constraintUtils ../camera/intersectionUtils ../camera/constraintUtils/ConstraintTypes ../camera/constraintUtils/InteractionType ../camera/constraintUtils/TiltMode ./NearFarHeuristic ./SurfaceCollisionConstraint".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t){b.ConstraintsManager=class extends c{constructor(r){super(r);this.nearFarHeuristic=h.createNearFarHeuristic(r.view.state.viewingMode,r.view.basemapTerrain,r.view.renderCoordsHelper.spatialReference)}initialize(){this.addHandles([f.watch(()=>[this.view.constraints?.clipDistance?.near,this.view.constraints?.clipDistance?.far],()=>this._clipDistanceNearFarChanged()),f.watch(()=>this.view.constraints?.clipDistance?.mode,()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",
r=>this._updateCameraNearFar(r)),f.watch(()=>this.view.renderDataExtent,()=>this._updateNearFar(),f.sync),f.watch(()=>[this.view.constraints?.altitude?.min,this.view.constraints?.altitude?.max],()=>this._updateAltitude(),f.sync),f.watch(()=>this.view.constraints?.tilt?.max,()=>this._updateTiltMax(),f.sync),f.watch(()=>this.view.constraints?.tilt?.mode,()=>this._updateTilt(),f.sync),f.watch(()=>this.view.state?.camera,()=>this._updateTiltAutoMax(),f.sync),f.watch(()=>[this.view.map?.ground?.navigationConstraint?.type,
this.view.state?.constraints?.collision?.enabled],()=>this._updateCollision(),f.sync)]);this.view.state.isLocal&&this.addHandles(f.watch(()=>this.view.renderDataExtent,r=>this._updateLocalSurfaceDistance(r),f.initial));this._updateNearFar();this.view.state.viewingMode!==m.ViewingMode.Local&&this._updateAltitude();this._updateTilt();this._updateCollision();this._set("surfaceCollisionConstraint",new t.SurfaceCollisionConstraint({view:this.view}))}destroy(){this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),
this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){const r=this.view.constraints?.clipDistance;r&&"auto"!==r.mode&&this.view.state.updateCamera(u=>this._updateCameraNearFarManual(u,r))}_updateNearFar(){this.view.state.updateCamera(r=>this._updateCameraNearFar(r))}_updateCameraNearFar(r){const u=this.view.constraints&&this.view.constraints.clipDistance;"manual"===(u?u.mode:"auto")?this._updateCameraNearFarManual(r,u):this._updateCameraNearFarAuto(r,u)}_updateCameraNearFarAuto(r,
u){this.nearFarHeuristic.compute(r.eye,r.center,this.view.renderDataExtent,w.surfaceElevationBelowRenderLocation(this.view,r.eye),r);u&&u.autoUpdate(r.near,r.far)}_updateCameraNearFarManual(r,u){u&&(r.near=u.near,r.far=u.far)}_updateCollision(){var r=this.view.map?.ground?.navigationConstraint?.type;r=r?"stay-above"===r:!0;const u=this.view.state.constraints.collision;r!==u.enabled&&((u.enabled=r)&&this._reapplyConstraints(v.ConstraintTypes.COLLISION),(r=this.view.constraints&&this.view.constraints.tilt)&&
"auto"!==r.mode||this._updateTiltAuto())}_updateAltitude(){const r=this.view.constraints&&this.view.constraints.altitude;this.view.state.constraints.altitude=r&&this.view.state.viewingMode!==m.ViewingMode.Local?{min:r.min,max:r.max}:null;this._reapplyConstraints()}_updateTiltMax(){const r=this.view.constraints&&this.view.constraints.tilt;r&&"auto"!==r.mode&&(this._updateTiltManual(r),this._reapplyConstraints())}_updateTilt(){const r=this.view.constraints&&this.view.constraints.tilt;"manual"===(r?
r.mode:"auto")?this._updateTiltManual(r):this._updateTiltAuto();this._reapplyConstraints()}_updateTiltManual(r){const u=this.view.state.constraints;u.tilt=u.createConstantMaxTilt(d.deg2rad(r.max))}_updateTiltAuto(){const r=this.view.state.constraints;r.tilt=r.createDefaultTilt();this._updateTiltAutoMax()}_updateTiltAutoMax(){const r=this.view.constraints&&this.view.constraints.tilt;if(r&&"auto"===r.mode){var u=this.view.state.constraints;u.tilt&&(u=u.tilt(this.view.state.camera.distance).max,r.autoUpdate(d.rad2deg(u)))}}_updateLocalSurfaceDistance(r){if(null!=
r){var u=Math.max(r.width,r.height);0>=u||(null!=r.zmax&&null!=r.zmin&&(u=Math.max(u,r.zmax-r.zmin)),r=this.view.state,u=3*u/Math.atan(r.camera.fov/2),u!==r.constraints.distance&&(r.constraints.distance=u))}}_reapplyConstraints(r=v.ConstraintTypes.ALL){this.view.state.updateCamera(u=>l.applyAll(this.view,u,{selection:r,interactionType:x.InteractionType.NONE,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:p.TiltMode.TUMBLE}))}};a.__decorate([n.property({constructOnly:!0})],
b.ConstraintsManager.prototype,"view",void 0);a.__decorate([n.property({readOnly:!0})],b.ConstraintsManager.prototype,"surfaceCollisionConstraint",void 0);b.ConstraintsManager=a.__decorate([e.subclass("esri.views.3d.state.ConstraintsManager")],b.ConstraintsManager);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/NearFarHeuristic":function(){define("exports ../../../core/mathUtils ../../../core/unitUtils ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/ellipsoidUtils ../../../geometry/Extent ../../ViewingMode ../environment/atmosphereUtils".split(" "),
function(b,a,c,d,f,n,k,g,q){function e(x,p,h,t){h=2/h;x/p>h?(t.far=x,t.near=t.far/p):(t.near=h,t.far=t.near*p);return t}class m{constructor(x,p){this._elevationProvider=x;this._referenceEllipsoid=n.getReferenceEllipsoid(p);this._unitInMeters=c.getMetersPerUnitForSR(p,this._referenceEllipsoid.metersPerDegree)}compute(x,p,h,t,r){r||(r={near:0,far:0});var u=x[2]*this._unitInMeters,y=u;t=u-t;var z=this._elevationProvider?.visibleElevationBounds;z&&(u=0<=t?y-this._unitInMeters*z.min:this._unitInMeters*
z.max-y);h=null!=h?h:new k({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0});y=Math.max(h.xmax-h.xmin,h.ymax-h.ymin,4*Math.max(h.xmax-h.xmin,h.ymax-h.ymin));d.subtract(v,p,x);w[0]=0<v[0]?h.xmax:h.xmin;w[1]=0<v[1]?h.ymax:h.ymin;w[2]=0<v[2]?y/2:-y/2;d.subtract(w,w,x);d.normalize(v,v);x=1.1*d.dot(w,v)*this._unitInMeters;p=Math.sqrt(u*(u+2*this._referenceEllipsoid.radius));h=Math.max(h.xmax-h.xmin,h.ymax-h.ymin);z=1E-4*h*this._unitInMeters;u=a.clamp((u-z)/(.001*h*this._unitInMeters-z),0,1);u=Math.min(a.lerp(p,
x,u**3),p)*Math.max(Math.log(Math.abs(t)),1);return e(Math.min(u,Math.max(34064E4,y))/this._unitInMeters,2E4,this._unitInMeters,r)}}class l{constructor(x){this._referenceEllipsoid=n.getReferenceEllipsoid(x)}compute(x,p,h,t,r){r||(r={near:0,far:0});x=d.length(x);p=x-this._referenceEllipsoid.radius;p=Math.max(Math.abs(p-t),Math.abs(p));t=1.2*a.lerp(Math.sqrt(p*(p+2*(this._referenceEllipsoid.radius+Math.min(0,t)))),x+this._referenceEllipsoid.radius,q.computeInnerAltitudeFade(p));x=a.clamp(2E4-(Math.log(p)-
7.983)/9.011*19E3,1E3,2E4);return e(t,x,1,r)}}const w=f.create(),v=f.create();b.createNearFarHeuristic=function(x,p,h){return x===g.ViewingMode.Global?new l(h):new m(p,h)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/SurfaceCollisionConstraint":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../camera/intersectionUtils ../camera/constraintUtils/surfaceCollision".split(" "),
function(b,a,c,d,f,n,k,g,q,e){b.SurfaceCollisionConstraint=class extends c{constructor(m){super(m)}initialize(){this.addHandles(this.view.basemapTerrain.on("elevation-change",m=>this._handleElevationChangeEvent(m)))}_handleElevationChangeEvent(m){if(!this.view.state.cameraController){var l=this.view.state.camera;null!=m.spatialReference&&q.eyeWithinExtent(this.view,l,m.extent,m.spatialReference)&&this._applyToCurrentCamera()}}_applyToCurrentCamera(){this.view.state.updateCamera(m=>e.applySurfaceCollisionConstraint(this.view,
m,e.Mode.EYE_AND_CENTER))}};a.__decorate([d.property({constructOnly:!0})],b.SurfaceCollisionConstraint.prototype,"view",void 0);b.SurfaceCollisionConstraint=a.__decorate([g.subclass("esri.views.3d.state.ElevationCollisionConstraint")],b.SurfaceCollisionConstraint);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/Frustum":function(){define(["exports","../../../chunks/vec3","../../../chunks/vec3f64","../../../geometry/support/frustum"],function(b,a,c,d){function f(k,
g,q){k.origin=g;k.endpoint=q;a.direction(k.direction,g,q)}class n{get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}constructor(k){this.renderCoordsHelper=k;this.frustum=d.create();this._points=d.createPoints();this.lines=Array(12);this._origin=c.create();this._direction=c.create();this._altitude=null;for(k=0;12>k;k++)this.lines[k]={origin:null,direction:c.create(),endpoint:null}}update(k){d.fromMatrix(k.viewMatrix,
k.projectionMatrix,this.frustum,this._points);a.copy(this._origin,k.eye);a.copy(this._direction,k.viewForward);this._altitude=this.renderCoordsHelper.getAltitude(this._origin);this._updateLines()}updatePoints(k){for(let g=0;g<this._points.length;g++)a.copy(this._points[g],k[g]);d.computePlanes(this.frustum,this._points);this._updateLines()}get altitude(){return this._altitude}intersectsSphere(k){return d.intersectsSphere(this.frustum,k)}intersectsRay(k){return d.intersectsRay(this.frustum,k)}intersectsLineSegment(k,
g){return d.intersectsLineSegment(this.frustum,k,g)}intersectsPoint(k){return d.intersectsPoint(this.frustum,k)}_updateLines(){const k=this._points;for(let g=0;4>g;g++){const q=g+4;f(this.lines[g],k[g],k[q]);f(this.lines[g+4],k[g],3===g?k[0]:k[g+1]);f(this.lines[g+8],k[q],3===g?k[4]:k[q+1])}}}n.planePointIndices=d.planePointIndices;n.nearFarLineIndices=[[d.PointIndex.NEAR_BOTTOM_LEFT,d.PointIndex.FAR_BOTTOM_LEFT],[d.PointIndex.NEAR_BOTTOM_RIGHT,d.PointIndex.FAR_BOTTOM_RIGHT],[d.PointIndex.NEAR_TOP_RIGHT,
d.PointIndex.FAR_TOP_RIGHT],[d.PointIndex.NEAR_TOP_LEFT,d.PointIndex.FAR_TOP_LEFT]];b.Frustum=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/GoToOperation":function(){define("exports ../../../Camera ../../../Viewpoint ../../../core/Error ../../../core/promiseUtils ../../../core/reactiveUtils ../camera/constraintUtils ../camera/constraintUtils/surfaceCollision ./controllers/CameraController ./controllers/PointToPointAnimationController ./controllers/SurfaceCollisionCorrectionController ../support/cameraUtils ../support/viewpointUtils".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w){class v{constructor(x,p,h){this.target=x;this.options=p;this.view=h;this.state="pending";this._animationController=null;this.promise=new Promise((t,r)=>{this._resolveCallback=t;this._rejectCallback=r;t=new AbortController;if(null!=this.options.signal)f.onAbort(this.options.signal,()=>{this.abort()});this._abortController=t;this.waitForReady()})}resolve(x){if("finished"!==this.state)return this.state="finished",this._resolveCallback(x)}reject(x){if("finished"!==
this.state)return this.state="finished",this._rejectCallback(x)}abort(x=!1){this._abortController.abort();switch(this.state){case "wait-for-animation-finish":!x&&null!=this._animationController&&this.view.state.cameraController===this._animationController&&this._animationController.active&&this._animationController.stopController()}this.reject(f.createAbortError())}async waitForReady(){this.state="wait-for-ready";if(!this.view.ready)try{await n.whenOnce(()=>this.view.ready,this._abortController.signal)}catch(x){return this.reject(x)}this.createViewPoint()}async createViewPoint(){if("finished"!==
this.state){this.state="wait-for-viewpoint";this._animationController=this.options.animate?this._getAnimationController():null;try{const p=await w.create(this.view,this.target,this._abortController.signal);if("finished"!==this.state){var x=p?this._getCameraFromViewpoint(p):null;null!=x&&(this.options.animate?null!=this._animationController&&this.startAnimation(x,this._animationController):(this.view.stateManager.setStateCamera(x.camera,{applyConstraints:!x.isFullySpecified,positionAndOrientationOnly:!0,
doNotCancelGoToOperation:!0}),this.resolve()))}}catch(p){this.reject(p)}}}_getCameraFromViewpoint(x){const p=!!(this.target instanceof c&&this.target.camera||this.target instanceof a);var h=x.camera;if(null==h)return null;if(!this.view.stateManager.isCompatible(h))return x=(x=h.position)&&x.spatialReference,this.reject(new d("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${x?x.wkid:"none"}, view: ${this.view.spatialReference?.wkid})`,
{camera:h})),null;h=l.externalToInternal(this.view,h);return null==h?(this.reject(new d("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:x,camera:h,isFullySpecified:p}}startAnimation(x,p){this.state="wait-for-animation-finish";const h=p.viewAnimation;if(null==h)this.reject(new d("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));else{h.update(x.viewpoint,"running");if(!p.active||null==p.viewAnimation||p.viewAnimation.target!==x.viewpoint||this.view.state.cameraController!==
p)return this.abort();if(x.isFullySpecified){var t=new m.SurfaceCollisionCorrectionController({view:this.view,desiredCamera:x.camera});g.applySurfaceCollisionConstraint(this.view,x.camera,g.Mode.EYE_AND_CENTER)}else k.applyAll(this.view,x.camera);p.begin(x.camera,this.options);var r=u=>{if(null!=this.view.state)switch(p.state){case q.State.Finished:switch(this.state){case "pending":case "wait-for-ready":case "wait-for-viewpoint":case "wait-for-animation-finish":this.resolve()}break;case q.State.Ready:case q.State.Rejected:case q.State.Running:case q.State.Stopped:switch(this.state){case "pending":case "wait-for-ready":case "wait-for-viewpoint":case "wait-for-animation-finish":this.reject(u)}}};
h.when(()=>{const u=this.view.state.cameraController;t&&(u&&u.active?u instanceof e.PointToPointAnimationController&&null!=u.viewAnimation&&u.viewAnimation.target===x.viewpoint&&(this.view.state.cameraController=t):null!=p.viewAnimation&&p.viewAnimation.target===x.viewpoint&&"finished"===p.state&&(this.view.state.cameraController=t))},u=>r(u));p.asyncResult={resolve:()=>r(),reject:u=>r(u)}}}_getAnimationController(){let x=null;var p=null;p=this.view.state.cameraController;p instanceof e.PointToPointAnimationController&&
(p.updateStateFromViewAnimation(),p.active&&(x=p,p=x.viewAnimation));return null!=x||(x=new e.PointToPointAnimationController({view:this.view,mode:"animation"}),p=x.viewAnimation,this.view.state.switchCameraController(x))?x:(null!=p&&p.stop(),this.reject(new d("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)}}b.GoToOperation=v;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/SurfaceCollisionCorrectionController":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../camera/intersectionUtils ../../camera/constraintUtils/surfaceCollision ./CameraController".split(" "),
function(b,a,c,d,f,n,k,g,q,e){b.SurfaceCollisionCorrectionController=class extends e.CameraController{set desiredCamera(m){this._set("desiredCamera",m.clone())}constructor(m){super(m)}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=e.State.Running;this.addHandles(this.view.basemapTerrain.on("elevation-change",m=>this._handleElevationChangeEvent(m)));this._applyCorrection()}onControllerEnd(){this.removeAllHandles()}stepController(){}_handleElevationChangeEvent(m){(null==
m.spatialReference||g.eyeWithinExtent(this.view,this.desiredCamera,m.extent,m.spatialReference))&&this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(m=>{m.copyViewFrom(this.desiredCamera);q.applySurfaceCollisionConstraint(this.view,m,q.Mode.EYE_AND_CENTER)||this.constraintEnabled||(this.state=e.State.Stopped)})}};a.__decorate([c.property({constructOnly:!0})],b.SurfaceCollisionCorrectionController.prototype,"desiredCamera",null);b.SurfaceCollisionCorrectionController=a.__decorate([k.subclass("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],
b.SurfaceCollisionCorrectionController);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/viewpointUtils":function(){define("exports ../../../Camera ../../../geometry ../../../Graphic ../../../Viewpoint ../../../core/asyncUtils ../../../core/has ../../../core/Cyclical ../../../core/Error ../../../core/promiseUtils ../../../chunks/mat3 ../../../chunks/mat3f64 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projection ../../../geometry/projection/computeTranslationToOriginAndRotation ../../../geometry/projection/projectPointToVectorWithEngine ../../../geometry/projection/projectVectorToPoint ../../../geometry/projection/projectVectorToVector ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/frustum ../../../geometry/support/scaleUtils ../camera/intersectionUtils ./cameraUtils ./ElevationProvider ../../../geometry/Point ../../../geometry/Extent ../../../geometry/SpatialReference ../../../geometry/Geometry ../../../geometry/Multipoint".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A,C,E,B,D,F,K,L,G,O){async function P(ma,pa,ja,qa){var ua=pa.camera;if(null!=ua)return J(ua,B.getViewSR(ma),qa);({targetGeometry:ua}=pa);if(null==ua)throw Error("Viewpoint has no targetGeometry!");const {camera:wa,mode:za}=R(ma,pa.rotation,ja);if("point"===ua.type)return X(ma,pa,ua,wa,za,qa);pa=ua.extent;if(null==pa)throw Error("Target geometry has no extent!");return B.fromExtentAsync(ma,pa,wa.heading,wa.tilt,za,qa)}async function J(ma,pa,ja){pa=
await p.projectWithZConversion(ma.position,pa,{signal:ja});e.throwIfAborted(ja);ma=ma.clone();ma.position=pa.clone();return ma}function R(ma,pa,ja){ma=B.internalToExternal(ma,ma.state.camera);let qa=B.OrientationMode.ADJUST;null!=pa&&(ma.heading=360-g.cyclicalDegrees.normalize(pa),qa=B.OrientationMode.LOCKED);null!=ja&&(ma.tilt=ja);return{camera:ma,mode:qa}}async function X(ma,pa,ja,qa,ua,wa){const za=ma.spatialReference;ja=await p.projectWithZConversion(ja.clone(),za,{signal:wa});e.throwIfAborted(wa);
pa=null!=pa.scale?B.scaleToDistance(ma,pa.scale,ja.latitude):ma.state.camera.distance;return B.fromCenterDistanceAsync(ma,ja,pa,qa,ua,wa)}function U(ma,pa){return null==pa.scale&&null!=pa.zoom?B.zoomToScale(ma,pa.zoom):pa.scale}function M(ma,pa){let ja=!1;null!=pa.heading?(ma.heading=pa.heading,ja=!0):null!=pa.rotation&&(ma.heading=360-g.cyclicalDegrees.normalize(pa.rotation),ja=!0);null!=pa.tilt&&(ma.tilt=pa.tilt,ja=!0);null!=pa.fov&&(ma.fov=pa.fov);return ja}function V(ma,pa,ja,qa){const ua=ma.spatialReference||
L.WGS84;pa=null!=pa?pa:B.externalToInternal(ma,ja);if(null==pa)return qa;qa.targetGeometry=r.projectVectorToPoint(pa.center,ma.renderSpatialReference,ua);qa.scale=B.computeScale(ma,pa);qa.rotation=g.cyclicalDegrees.normalize(360-ja.heading);qa.camera=ja;return qa}async function Y(ma,pa,ja,qa){const ua=()=>new q("viewpointutils:invalid-geometry","The target is missing a valid geometry");if(!pa)throw ua();"mesh"===pa.type&&(pa=pa.extent);const wa=pa.spatialReference,za=ma.spatialReference,Aa=ma.basemapTerrain.spatialReference;
if(!pa.hasZ&&ma.basemapTerrain){let Da;switch(pa.type){case "point":Da=pa;break;case "multipoint":case "polyline":Da=pa.extent?.center;break;case "extent":Da=pa.center;break;case "polygon":Da=pa.centroid}null!=Da&&null!=Aa&&null!=ma.elevationProvider?(Da=await p.projectWithZConversion(Da,Aa,{signal:qa}),ka[2]=D.getElevationAtPoint(ma.elevationProvider,Da)??0):ka[2]=0}const Fa=[];(0,ta[pa.type])(pa,pa.hasZ?Da=>{Fa.push([Da[0],Da[1],Da[2]])}:Da=>{Fa.push([Da[0],Da[1]])},ka);if(0===Fa.length)throw ua();
ma=await p.projectWithZConversion(new O({spatialReference:wa,hasZ:pa.hasZ,hasM:!1,points:Fa}),za,{signal:qa});pa.hasZ&&(ja.hasZ=!0);if(pa.hasZ)for(const [Da,Ha,Ka]of ma.points)ka[0]=Da,ka[1]=Ha,ka[2]=Ka,y.expandWithVec3(ja.boundingBox,ka);else for(const [Da,Ha]of ma.points)ka[0]=Da,ka[1]=Ha,y.expandWithVec3(ja.boundingBox,ka)}async function W(ma,pa,ja,qa,ua){const wa=await n.result(ma.whenViewForGraphic(pa));if(!1!==wa.ok&&null!=wa.value&&"whenGraphicBounds"in wa.value)if(ja=await n.result(wa.value.whenGraphicBounds(pa,
{minDemResolution:ja})),!1!==ja.ok&&ja.value){var {screenSpaceObjects:za,boundingBox:Aa}=ja.value;y.expandWithAABB(qa.boundingBox,Aa);za&&za.forEach(Fa=>{qa.screenSpaceObjects.push(Fa)});isFinite(Aa[2])&&(qa.hasZ=!0)}else await Y(ma,pa.geometry,qa,ua);else await Y(ma,pa.geometry,qa,ua)}async function H(ma,pa,ja,qa,ua){if(Array.isArray(pa)&&2===pa.length){const wa=pa[0],za=pa[1];if("number"===typeof wa&&"number"===typeof za){ra.x=wa;ra.y=za;ra.z=void 0;ra.spatialReference=ma.spatialReference?.isGeographic?
ma.spatialReference:L.WGS84;await Y(ma,ra,qa,ua);return}}pa&&"map"in pa&&"function"===typeof pa.map?await Promise.allSettled(pa.map(wa=>H(ma,wa,ja,qa,ua))):pa instanceof G?await Y(ma,pa,qa,ua):pa instanceof d&&await W(ma,pa,ja,qa,ua)}async function S(ma,pa,ja,qa,ua){if(null!=pa.camera)return I(ma,pa.camera,qa,ua);ua.scale=pa.scale;ua.rotation=pa.rotation;ua.targetGeometry=null!=pa.targetGeometry?pa.targetGeometry.clone():null;ua.camera=null;null!=ja.heading?ua.rotation=g.cyclicalDegrees.normalize(360-
ja.heading):null!=ja.rotation&&(ua.rotation=ja.rotation);pa=U(ma,ja);null!=pa&&(ua.scale=pa);ua.camera=await P(ma,ua,ja.tilt,qa);return ua}async function I(ma,pa,ja,qa){ja=await p.projectWithZConversion(pa.position,ma.spatialReference,{signal:ja});pa=pa.clone();pa.fov=ma.camera.fov;pa.position=ja;return V(ma,null,pa,qa)}async function Q(ma,pa,ja,qa,ua,wa,za){const Aa=ma.renderSpatialReference;await t.projectPointToVectorWithEngine(pa,oa,Aa,0,{signal:za});await t.projectPointToVectorWithEngine(ja,
la,Aa,0,{signal:za});wa.targetGeometry=new F(pa);ua.position=new F(ja);v.subtract(ia,oa,la);B.directionToHeadingTilt(ma,la,ia,qa.up,ua);wa.scale=B.distanceToScale(ma,v.distance(la,oa),wa.targetGeometry.latitude);wa.rotation=g.cyclicalDegrees.normalize(360-ua.heading);wa.camera=ua;return wa}async function N(ma,pa,ja,qa,ua,wa){if(null==ja)throw new q("createfromcenter","invalid point");wa.targetGeometry=ja.clone();const za=E.cameraOnContentAlongViewDirection(ma);if(pa.position)return Q(ma,wa.targetGeometry,
pa.position,za,qa,wa,ua);if(pa.zoomFactor){var Aa=za.distance/pa.zoomFactor;const Fa=v.scale(ka,za.viewForward,-Aa);za.eye=v.add(ka,za.center,Fa);wa.scale=B.distanceToScale(ma,Aa,ja.latitude)}B.internalToExternal(ma,za,qa);Aa=M(qa,pa)?B.OrientationMode.LOCKED:B.OrientationMode.ADJUST;pa.zoomFactor||(pa=U(ma,pa),null==pa?({renderSpatialReference:pa}=ma,await t.projectPointToVectorWithEngine(ja,ka,pa,0,{signal:ua}),A.intersectsPoint(za.frustum,ka)?wa.scale=B.distanceToScale(ma,v.distance(za.eye,ka),
ja.latitude):wa.scale=B.computeScale(ma,za)):wa.scale=pa,wa.camera=await B.fromCenterScale(ma,wa.targetGeometry,wa.scale,qa,Aa,ua));return wa}async function T(ma,pa,ja,qa,ua){var wa=E.cameraOnContentAlongViewDirection(ma);v.copy(ia,wa.viewForward);B.directionToHeadingTilt(ma,wa.eye,ia,wa.up,na);wa=ma.spatialReference;const {position:za}=pa;za?(ua=await p.projectWithZConversion(za,wa,{signal:ua}),ja.position=ua):ja.position=new F;ja.heading=null!=pa.heading?pa.heading:na.heading;ja.tilt=null!=pa.tilt?
pa.tilt:na.tilt;return V(ma,null,ja,qa)}async function aa(ma,pa,ja,qa,ua){var wa=E.cameraOnContentAlongViewDirection(ma);const {spatialReference:za,renderSpatialReference:Aa}=ma;wa=r.projectVectorToPoint(wa.center,Aa,za);return N(ma,pa,wa,ja,qa,ua)}async function Z(ma,pa,ja,qa,ua,wa){wa.targetGeometry=ja.clone();const za=E.cameraOnContentAlongViewDirection(ma);B.internalToExternal(ma,za,qa);pa=M(qa,pa)?B.OrientationMode.LOCKED:B.OrientationMode.ADJUST;wa.camera=await B.fromExtentAsync(ma,ja,qa.heading,
qa.tilt,pa,ua);return wa}async function da(ma,pa,ja,qa,ua,wa,za,Aa){Aa.targetGeometry=ja.clone();const Fa=E.cameraOnContentAlongViewDirection(ma);var Da=0;null!=ja.z?Da=ja.z:ma.basemapTerrain&&ma.elevationProvider&&(Da=D.getElevationAtPoint(ma.elevationProvider,ja));v.set(ka,ja.x,ja.y,Da);h.computeTranslationToOriginAndRotation(ma.spatialReference,ka,ha,ma.renderSpatialReference);m.fromMat4(ba,ha);m.transpose(ba,ba);y.empty(ea);ja=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];
for(var Ha=0;Ha<ja.length;Ha++){const Ka=ja[Ha];let La=qa[Ka[2]];isFinite(La)||(La=Da);v.set(ka,qa[Ka[0]],qa[Ka[1]],La);u.projectVectorToVector(ka,ma.spatialReference,ka,ma.renderSpatialReference);y.expandWithVec3(ea,v.transformMat3(ka,ka,ba))}qa=y.width(ea);Da=y.height(ea);ja=y.depth(ea);Ha=1/Math.tan(Fa.fovY/2);ua=Math.max(.5*Math.sqrt(qa*qa+ja*ja)*Math.max(Ha,1/Math.tan(Fa.fovX/2))+.5*Da,.5*Da*Ha+.5*Math.max(qa,ja))/ua;B.internalToExternal(ma,Fa,wa);pa=M(wa,pa)?B.OrientationMode.LOCKED:B.OrientationMode.ADJUST;
Aa.scale=B.distanceToScale(ma,ua,Aa.targetGeometry.latitude);Aa.camera=await B.fromCenterScale(ma,Aa.targetGeometry,Aa.scale,wa,pa,za);return Aa}function fa(ma){null!=ma?.camera&&(ma.rotation=g.cyclicalDegrees.normalize(360-ma.camera.heading));return ma}const ka=x.create(),ha=w.create(),ba=l.create(),ea=y.create(),ca=z.create(),ia=x.create(),la=x.create(),oa=x.create(),na={heading:0,tilt:0},ra=new F,ta={point(ma,pa,ja){ja[0]=ma.x;ja[1]=ma.y;null!=ma.z&&(ja[2]=ma.z);pa(ja)},polygon(ma,pa,ja){const qa=
ma.hasZ;for(let ua=0;ua<ma.rings.length;ua++){const wa=ma.rings[ua];for(let za=0;za<wa.length;za++)ja[0]=wa[za][0],ja[1]=wa[za][1],qa&&(ja[2]=wa[za][2]),pa(ja)}},polyline(ma,pa,ja){const qa=ma.hasZ;for(let ua=0;ua<ma.paths.length;ua++){const wa=ma.paths[ua];for(let za=0;za<wa.length;za++)ja[0]=wa[za][0],ja[1]=wa[za][1],qa&&(ja[2]=wa[za][2]),pa(ja)}},multipoint(ma,pa,ja){const qa=ma.points;ma=ma.hasZ;for(let ua=0;ua<qa.length;ua++)ja[0]=qa[ua][0],ja[1]=qa[ua][1],ma&&(ja[2]=qa[ua][2]),pa(ja)},extent(ma,
pa,ja){null!=ma.zmin&&null!=ma.zmax?(pa(v.set(ja,ma.xmin,ma.ymin,ma.zmin)),pa(v.set(ja,ma.xmax,ma.ymin,ma.zmin)),pa(v.set(ja,ma.xmin,ma.ymax,ma.zmin)),pa(v.set(ja,ma.xmax,ma.ymax,ma.zmin)),pa(v.set(ja,ma.xmin,ma.ymin,ma.zmax)),pa(v.set(ja,ma.xmax,ma.ymin,ma.zmax)),pa(v.set(ja,ma.xmin,ma.ymax,ma.zmax)),pa(v.set(ja,ma.xmax,ma.ymax,ma.zmax))):(pa(v.set(ja,ma.xmin,ma.ymin,ja[2])),pa(v.set(ja,ma.xmax,ma.ymin,ja[2])),pa(v.set(ja,ma.xmin,ma.ymax,ja[2])),pa(v.set(ja,ma.xmax,ma.ymax,ja[2])))}};b.create=async function(ma,
pa,ja){if(pa&&ma.spatialReference){var qa={target:void 0};"declaredClass"in pa||Array.isArray(pa)?qa.target=pa:(Object.assign(qa,pa),pa.center&&!qa.target&&(qa.target=pa.center));pa=qa}else pa=null;if(!pa)throw new q("viewpointutils-create:no-target","Missing target for creating viewpoint");qa=new a({fov:ma.camera.fov});const ua=new f({camera:qa});if(pa.target instanceof f)return ma=await S(ma,pa.target,pa,ja,ua),fa(ma);if(pa.target instanceof a)return fa(await I(ma,pa.target,ja,ua));var wa=null!=
pa.scale||null!=pa.zoom;if(pa.target instanceof K){var za=pa.target.xmin===pa.target.xmax||pa.target.ymin===pa.target.ymax;return wa||za?fa(await N(ma,pa,pa.target.center,qa,ja,ua)):fa(await Z(ma,pa,pa.target,qa,ja,ua))}za={boundingBox:y.empty(),hasZ:!1,screenSpaceObjects:[]};var Aa=wa?(Aa=U(ma,pa))?C.getResolutionInMetersForScale(Aa):void 0:void 0;await H(ma,pa.target,Aa,za,ja);if(isFinite(za.boundingBox[0])){y.center(za.boundingBox,ka);ra.x=ka[0];ra.y=ka[1];ra.z=ka[2];ra.spatialReference=ma.spatialReference;
isFinite(ra.z)&&za.hasZ?Aa=y.isPoint(za.boundingBox):(ra.z=void 0,Aa=z.isPoint(y.toRect(za.boundingBox,ca)));if(wa||Aa)return fa(await N(ma,pa,ra,qa,ja,ua));wa=za.screenSpaceObjects;if(wa.length){Aa=Number.NEGATIVE_INFINITY;for(let Fa=0;Fa<wa.length;Fa++){const Da=wa[Fa].screenSpaceBoundingRect;Aa=Math.max(Aa,Math.abs(Da[0]),Math.abs(Da[1]),Math.abs(Da[2]),Math.abs(Da[3]))}wa=.66-Aa/Math.min(ma.width,ma.height)*2}else wa=.66;return fa(await da(ma,pa,ra,za.boundingBox,wa,qa,ja,ua))}return pa.position?
fa(await T(ma,pa,qa,ua,ja)):fa(await aa(ma,pa,qa,ja,ua))};b.fromCamera=function(ma,pa,ja=null){null==ja&&(ja=new f);return V(ma,null,pa.clone(),ja)};b.toCameraAsync=P;b.toCameraSync=function(ma,pa,ja){var qa=pa.camera;if(null!=qa){a:{ma=B.getViewSR(ma);var ua=qa.position;try{var wa=p.project(ua,ma)}catch(Fa){ma=null;break a}ma=qa.clone();ma.position=wa.clone()}return ma}({targetGeometry:wa}=pa);if(null==wa)return null;const {camera:za,mode:Aa}=R(ma,pa.rotation,ja);if("point"===wa.type){a:{qa=ma.spatialReference;
try{ua=p.project(wa.clone(),qa)}catch(Fa){ma=null;break a}wa=null!=pa.scale?B.scaleToDistance(ma,pa.scale,ua.latitude):ma.state.camera.distance;ma=B.fromCenterDistanceSync(ma,ua,wa,za,Aa)}return ma}wa=wa.extent;return null==wa?null:B.fromExtentSync(ma,wa,za.heading,za.tilt,Aa)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/computeTranslationToOriginAndRotation":function(){define("exports ../../core/mathUtils ../../chunks/mat4 ../../chunks/vec3f64 ./localRotationUtils ./projectors ../support/spatialReferenceUtils".split(" "),
function(b,a,c,d,f,n,k){function g(l){return l===n.ProjectionID.SPHERICAL_ECEF||l===n.ProjectionID.SPHERICAL_MARS_PCPF||l===n.ProjectionID.SPHERICAL_MOON_PCPF}const q=a.deg2rad(1),e=d.create(),m=d.create();b.computeTranslationToOriginAndRotation=function(l,w,v,x){if(null==l||null==x)return!1;var p=n.classifySpatialReference(l,n.sourceClassificationCache),h=n.classifySpatialReference(x,n.destClassificationCache);if(p===h&&!g(h)&&(p!==n.ProjectionID.UNKNOWN||k.equals(l,x)))return c.fromTranslation(v,
w),!0;if(g(h)){p=n.projectionTable[p][n.ProjectionID.LON_LAT];h=n.projectionTable[n.ProjectionID.LON_LAT][h];if(null==p||null==h)return!1;p(w,0,e,0);h(e,0,m,0);f.computeENUToSphericalPCPFLocalRotation(q*e[0],q*e[1],v);v[12]=m[0];v[13]=m[1];v[14]=m[2];return!0}if((h===n.ProjectionID.WEB_MERCATOR||h===n.ProjectionID.PLATE_CARREE)&&(p===n.ProjectionID.WGS84||p===n.ProjectionID.CGCS2000&&h===n.ProjectionID.PLATE_CARREE||p===n.ProjectionID.SPHERICAL_ECEF||p===n.ProjectionID.WEB_MERCATOR)){l=n.projectionTable[p][n.ProjectionID.LON_LAT];
h=n.projectionTable[n.ProjectionID.LON_LAT][h];if(null==l||null==h)return!1;l(w,0,e,0);h(e,0,m,0);p===n.ProjectionID.SPHERICAL_ECEF?f.computeSphericalPCPFToENULocalRotation(q*e[0],q*e[1],v):c.identity(v);v[12]=m[0];v[13]=m[1];v[14]=m[2];return!0}return!1};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/localRotationUtils":function(){define(["exports","../../chunks/mat4"],function(b,a){function c(d,f,n){const k=Math.sin(d);d=Math.cos(d);const g=Math.sin(f);
f=Math.cos(f);n[0]=-k;n[4]=-g*d;n[8]=f*d;n[12]=0;n[1]=d;n[5]=-g*k;n[9]=f*k;n[13]=0;n[2]=0;n[6]=f;n[10]=g;n[14]=0;n[3]=0;n[7]=0;n[11]=0;n[15]=1;return n}b.computeENUToSphericalPCPFLocalRotation=c;b.computeSphericalPCPFToENULocalRotation=function(d,f,n){c(d,f,n);a.transpose(n,n);return n};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/RenderFeature":function(){define(["exports","../../../../core/has","../../../../core/NestedMap","../../../support/RenderState"],
function(b,a,c,d){b.RenderFeature=void 0;(function(f){f[f.Antialiasing=0]="Antialiasing";f[f.HighQualityTransparency=1]="HighQualityTransparency";f[f.HighResolutionVoxel=2]="HighResolutionVoxel";f[f.HighResolutionAtmosphere=3]="HighResolutionAtmosphere";f[f.SSAO=4]="SSAO";f[f.WaterReflection=5]="WaterReflection";f[f.HighResolutionShadows=6]="HighResolutionShadows";f[f.PhysicalPixelRendering=7]="PhysicalPixelRendering"})(b.RenderFeature||(b.RenderFeature={}));b.setupFeatureDefaults=function(f=!a("disable-feature:high-quality-idle"),
n=null){const k=new c.NestedMap;f?(k.set(d.RenderState.IDLE,b.RenderFeature.Antialiasing,"low"!==n),k.set(d.RenderState.IDLE,b.RenderFeature.HighResolutionAtmosphere,"low"!==n),k.set(d.RenderState.IDLE,b.RenderFeature.HighQualityTransparency,!0),k.set(d.RenderState.IDLE,b.RenderFeature.SSAO,!0),k.set(d.RenderState.IDLE,b.RenderFeature.WaterReflection,!0),k.set(d.RenderState.IDLE,b.RenderFeature.PhysicalPixelRendering,!0)):(k.set(d.RenderState.ANIMATING,b.RenderFeature.HighResolutionShadows,!0),k.set(d.RenderState.INTERACTING,
b.RenderFeature.HighResolutionShadows,!0));k.set(d.RenderState.IDLE,b.RenderFeature.HighResolutionShadows,!0);k.set(d.RenderState.IDLE,b.RenderFeature.HighResolutionVoxel,!0);return k};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/core/NestedMap":function(){define(["exports"],function(b){class a{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return 0===this._outer.size}get(c,d){return this._outer.get(c)?.get(d)}set(c,d,f){const n=this._outer.get(c);
n?n.set(d,f):this._outer.set(c,new Map([[d,f]]))}delete(c,d){const f=this._outer.get(c);f&&(f.delete(d),0===f.size&&this._outer.delete(c))}forEach(c){this._outer.forEach((d,f)=>c(d,f))}}b.NestedMap=a;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/DragZoom":function(){define("exports ../../../../core/screenUtils ../../state/controllers/global/ZoomController ../../state/controllers/local/ZoomController ../../../input/InputHandler ../../../input/handlers/support".split(" "),
function(b,a,c,d,f,n){class k extends f.InputHandler{constructor(g,q,e){super(!0);this._view=g;this.pointerAction=q;this.registerIncoming("drag",e,m=>this._handleDrag(m))}_handleDrag(g){const q=g.data;if(!(1<q.pointers.size)&&n.eventMatchesMousePointerAction(g.data,this.pointerAction)){var e=a.createScreenPointArray(q.center.x,q.center.y);switch(q.action){case "start":this._cameraController&&(this._cameraController.end(),this._cameraController=null);this._cameraController=this._view.state.isGlobal?
new c.ZoomController({view:this._view}):new d.ZoomController({view:this._view});this._view.state.switchCameraController(this._cameraController);this._cameraController.begin(e);break;case "update":this._cameraController&&this._cameraController.update(e);break;case "end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}g.stopPropagation()}}}b.DragZoom=k;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/global/ZoomController":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec2 ../../../../../chunks/vec2f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/ellipsoidUtils ../../../../../geometry/support/axisAngle ../../../../../chunks/sphere ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../camera/constraintUtils/surfaceCollision ../../../camera/constraintUtils/TiltMode ../InteractiveController ../../utils/navigationUtils ../../../support/geometryUtils/ray".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A,C,E){b.ZoomController=class extends A.InteractiveController{constructor(){super(...arguments);this._pickPoint=v.create();this._tmpP0=l.create();this._panAxisAngle=p.create();this._tmpRayDir=v.create();this._tmpRayDirPick=v.create();this._targetOnSphere=v.create();this._navMode=C.NavigationMode.Horizontal;this._tmpRay={origin:v.create(),direction:v.create()};this.dragBeginPoint=d.createScreenPointArray();this._normalizedAnchorPoint=l.create();
this._constraintOptions={selection:r.ConstraintTypes.ALL_EXCEPT_COLLISION,interactionType:u.InteractionType.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:z.TiltMode.TUMBLE};this._sphere=h.create();this._hasPickPoint=!1}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(F){if(this.active){m.copy(this.dragBeginPoint,F);C.normalizeCoordinate(this.startCamera,F,this._normalizedAnchorPoint);var K=x.getReferenceEllipsoid(this.view.spatialReference),
L=C.pickPointAndInitSphere(this._intersectionHelper,this.startCamera,F,K,C.SpherePickPointFallback.Ellipsoid,0===this.view.map.ground.opacity?C.contentIntersectorOptions:{});this._navMode=C.decideNavigationMode(this.startCamera,F,K);if(this._navMode===C.NavigationMode.Horizontal)this._hasPickPoint=!!L.scenePickPoint,this._pickPoint=L.scenePickPoint??this._pickPoint,this._sphere=L.sphere;else{E.fromScreenAtEye(this.startCamera,F,this._tmpRay);w.normalize(this._tmpRay.direction,this._tmpRay.direction);
let G;null!=L.scenePickPoint&&(w.subtract(this._tmpRayDirPick,this.startCamera.eye,L.scenePickPoint),G=w.length(this._tmpRayDirPick));K=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(this.startCamera.eye,D);K=c.clamp(Math.min(C.pivotDistanceModifier,1/Math.abs(w.dot(D,this._tmpRay.direction)))*K,C.distanceClampValues[0],C.distanceClampValues[1]);F=this.view._stage.renderView.getMinimalDepthForArea(null,F[0],F[1],this.view.state.camera,C.screenPixelArea);K=null!=
F?F:K;K=null!=G?Math.min(K,G):K;this._hasPickPoint=!0;w.scale(this._tmpRay.direction,this._tmpRay.direction,K);w.add(this._pickPoint,this._tmpRay.origin,this._tmpRay.direction)}this._constraintOptions.interactionStartCamera=this.startCamera}}update(F){if(this.active){this.currentCamera.eye=this.startCamera.eye;this.currentCamera.center=this.startCamera.center;this.currentCamera.up=this.startCamera.up;if(this._navMode===C.NavigationMode.Horizontal){w.subtract(this._tmpRayDir,this.currentCamera.center,
this.currentCamera.eye);var K=w.length(this._tmpRayDir);C.normalizeCoordinate(this.currentCamera,F,this._tmpP0);var L=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]),G=K*2**L;const O=this.view.state.constraints.minimumPoiDistance;0>L&&G<O&&(G=O);if(1E-6>Math.abs(K-G))return;this._hasPickPoint&&G<K&&(L=1-(1-G/K)*(1-this._sphere[3]/w.length(this.currentCamera.center)),this.currentCamera.center=w.scale(B,this.currentCamera.center,L));w.scale(this._tmpRayDir,this._tmpRayDir,-G/K);this.currentCamera.eye=
w.add(B,this.currentCamera.center,this._tmpRayDir);this._constraintOptions.interactionFactor=t.pixelDistanceToInteractionFactor(m.distance(this.dragBeginPoint,F));t.applyAll(this.view,this.currentCamera,this._constraintOptions);this._hasPickPoint&&(C.sphereOrPlanePointFromScreenPoint(this._sphere,this.currentCamera,this.dragBeginPoint,this._targetOnSphere),p.fromPoints(this._pickPoint,this._targetOnSphere,this._panAxisAngle),C.applyRotation(this.currentCamera,this._sphere,this._panAxisAngle))}else{K=
w.length(this._tmpRay.direction);C.normalizeCoordinate(this.currentCamera,F,this._tmpP0);F=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);G=K*2**F;L=this.view.state.constraints.minimumPoiDistance;0>F&&G<L&&(G=L);if(1E-6>Math.abs(K-G))return;w.scale(this._tmpRayDir,this._tmpRay.direction,1-G/K);this.currentCamera.eye=w.add(B,this.currentCamera.eye,this._tmpRayDir);this.currentCamera.center=w.add(B,this.currentCamera.center,this._tmpRayDir)}y.applySurfaceCollisionConstraint(this.view,this.currentCamera);
this.commitCamera()}}end(){this.active&&this.finishController()}};b.ZoomController=a.__decorate([e.subclass("esri.views.3d.state.controllers.global.ZoomController")],b.ZoomController);const B=v.create(),D=v.create();Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/local/ZoomController":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec2 ../../../../../chunks/vec2f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/plane ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../camera/constraintUtils/TiltMode ../../../layers/VoxelWasm ../InteractiveController ../../utils/navigationUtils".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z){b.ZoomController=class extends y.InteractiveController{constructor(){super(...arguments);this._tmpP=v.create();this._tmpDir=v.create();this._tmpN=v.create();this._tmpP0=l.create();this._tmpPoi=v.create();this._tmpRayDir=v.create();this.dragBeginPoint=d.createScreenPointArray();this._normalizedAnchorPoint=l.create();this._constraintOptions={selection:h.ConstraintTypes.ALL,interactionType:t.InteractionType.ZOOM,interactionFactor:0,interactionStartCamera:null,
interactionDirection:v.create(),tiltMode:r.TiltMode.TUMBLE};this._plane=x.create()}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(E){if(this.active){m.copy(this.dragBeginPoint,E);z.normalizeCoordinate(this.startCamera,E,this._normalizedAnchorPoint);var B=this._intersectionHelper.intersectScreenFreePointFallback(E,this._tmpP,0===this.view.map.ground.opacity?z.contentIntersectorOptions:{});w.subtract(this._tmpDir,this._tmpP,this.startCamera.eye);var D=w.length(this._tmpDir);
w.normalize(this._tmpDir,this._tmpDir);var F=Math.abs(this.view.camera.position.z);F=c.clamp(Math.min(z.pivotDistanceModifier,1/Math.abs(w.dot(C,this._tmpDir)))*F,z.distanceClampValues[0],z.distanceClampValues[1]);E=this.view._stage.renderView.getMinimalDepthForArea(u.getVoxelWasm(this.view),E[0],E[1],this.view.state.camera,z.screenPixelArea);F=null!=E?E:F;F=B?Math.min(F,D):F;w.scale(this._tmpDir,this._tmpDir,F);w.add(this._tmpP,this.startCamera.eye,this._tmpDir);w.subtract(this._tmpN,this.startCamera.eye,
this.startCamera.center);w.normalize(this._tmpN,this._tmpN);0>this._tmpN[1]&&w.negate(this._tmpN,this._tmpN);x.fromPositionAndNormal(this._tmpP,this._tmpN,this._plane);this._constraintOptions.interactionStartCamera=this.startCamera}}update(E){if(this.active){z.intersectPlaneFromScreenPoint(this._plane,this.currentCamera,this.dragBeginPoint,this._tmpPoi)||w.copy(this._tmpPoi,this.currentCamera.center);z.normalizeCoordinate(this.currentCamera,E,this._tmpP0);var B=4*(this._tmpP0[1]-this._normalizedAnchorPoint[1]);
m.copy(this._normalizedAnchorPoint,this._tmpP0);w.subtract(this._tmpRayDir,this._tmpPoi,this.currentCamera.eye);var D=w.length(this._tmpRayDir),F=D*(1-B);this._constraintOptions.interactionDirection&&(w.copy(this._constraintOptions.interactionDirection,this._tmpRayDir),w.scale(this._constraintOptions.interactionDirection,this._constraintOptions.interactionDirection,Math.sign(B)/D));var K=this.view.state.constraints.minimumPoiDistance;0<=B&&F<K&&(F=K,B=-(F-D)/D);1E-6>Math.abs(D-F)||(w.scale(this._tmpRayDir,
this._tmpRayDir,B),this.currentCamera.eye=w.add(A,this.currentCamera.eye,this._tmpRayDir),w.lerp(A,this.currentCamera.center,this._tmpPoi,B),A[2]=this._tmpPoi[2]>this.startCamera.center[2]?Math.max(this.startCamera.center[2],A[2]):Math.min(this.startCamera.center[2],A[2]),this.currentCamera.center=A,this._constraintOptions.interactionFactor=p.pixelDistanceToInteractionFactor(m.distance(this.dragBeginPoint,E)),p.applyAll(this.view,this.currentCamera,this._constraintOptions),this.commitCamera())}}end(){this.active&&
this.finishController()}};b.ZoomController=a.__decorate([e.subclass("esri.views.3d.state.controllers.local.ZoomController")],b.ZoomController);const A=v.create(),C=v.fromValues(0,0,1);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/GamepadNavigation":function(){define(["exports","../../../../core/Handles","../../../../core/reactiveUtils","../../state/controllers/GamepadKeyboardController","../../../input/InputHandler"],function(b,a,c,d,f){class n extends f.InputHandler{constructor(k){super(!0);
this._view=k;this._watchHandles=new a;this._handle=this.registerIncoming("gamepad",g=>this._handleEventGamepad(g));this._handle.pause()}onInstall(k){super.onInstall(k);this._watchHandles.add([c.watch(()=>this._view.navigation.gamepad.enabled,g=>{g?this._handle.resume():(this._handle.pause(),this._cameraControllerGamepad&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null))},c.initial),c.watch(()=>this._view.navigation.gamepad.device,g=>{this._cameraControllerGamepad&&
g&&this._cameraControllerGamepad.gamepadDevice!==g&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null)})])}onUninstall(){this._watchHandles.removeAll();super.onUninstall()}_handleEventGamepad(k){var g=this._view.navigation.gamepad.device;if(!g||k.data.device===g)if((g=this._cameraControllerGamepad&&this._cameraControllerGamepad.active)||d.GamepadKeyboardController.activatesFor(this._view,k.data))g||(g=new d.GamepadKeyboardController({view:this._view,gamepadDevice:k.data.device}),
this._view.state.switchCameraController(g)&&(this._cameraControllerGamepad=g)),this._cameraControllerGamepad&&this._cameraControllerGamepad.active&&this._cameraControllerGamepad.gamepadDevice===k.data.device&&this._cameraControllerGamepad.handleEventGamepad(k.data)}}b.GamepadNavigation=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/GamepadKeyboardController":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/compilerUtils ../../../../core/mathUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/ellipsoidUtils ../../../../geometry/support/ray ../../../../chunks/sphere ../../../../geometry/support/vector ../../../../geometry/support/vectorStacks ../../camera/constraintUtils ../../camera/constraintUtils/ConstraintTypes ../../camera/constraintUtils/InteractionType ../../camera/constraintUtils/TiltMode ../Constraints ./InteractiveController ../utils/navigationUtils ../utils/viewUtils ../../support/cameraUtils ../../support/cameraUtilsInternal ../../webgl-engine/lib/Camera ../../../navigation/gamepadAndKeyboardUtils".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A,C,E,B,D,F,K){b.GamepadKeyboardController=class extends A.InteractiveController{constructor(M){super(M);this._filteredSurfaceElevation=0;this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0};this._keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0];this._tmpCamera=new F.Camera;this._headingStart=0;this._constraintOptions={selection:r.ConstraintTypes.ALL,interactionType:u.InteractionType.NONE,interactionStartCamera:new F.Camera,interactionFactor:0,
interactionDirection:null,tiltMode:y.TiltMode.LOOK_AROUND}}handleEventGamepad(M){const V=K.extractTransformation(M,this.view.navigation.gamepad,this._transformation);("end"===M.action||K.isZeroTransformation(V))&&this.finishController()}activateDirection(M){this._keysButtonState[M]=1;K.extractTransformationKeyboard(this._keysButtonState,this._transformation)}deactivateDirection(M){this._keysButtonState[M]=0;M=K.extractTransformationKeyboard(this._keysButtonState,this._transformation);K.isZeroTransformation(M)&&
this.finishController()}onControllerStart(M){this._filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z;this._headingStart=this.view.camera.heading;super.onControllerStart(M)}_updateFilteredSurfaceElevation(M){this._filteredSurfaceElevation+=(this.view.pointsOfInterest.cameraOnSurface.location.z-this._filteredSurfaceElevation)*M}stepController(M,V){this._updateStartHeading();this._updateFilteredSurfaceElevation(M);this.currentCamera.copyViewFrom(V);this._updateCameraCenter();
this._constraintOptions.interactionStartCamera?.copyFrom(this.currentCamera);this._calculateControlTransformation(M,this.currentCamera,J);this._applyDisabledMovementTypes(J);this._applyPan(J.pan);this._applyRotate(J.rotate);this._applyZoom(J.zoom);this._applyAscend(J.ascend);this._constraintOptions.interactionType=u.InteractionType.NONE;this._constraintOptions.selection=r.ConstraintTypes.COLLISION;t.applyAll(this.view,this.currentCamera,this._constraintOptions);super.stepController(M,V)}_updateStartHeading(){0!==
this._transformation.heading&&(this._headingStart=this.view.camera.heading)}_applyRotate(M){if(M.enabled){var V=this.currentCamera;m.subtract(R,V.center,V.eye);m.transformMat4(R,R,M.matrix);V.center=m.add(R,R,V.eye);V.up=m.transformMat4(R,V.up,M.matrix);this._constraintOptions.interactionType=u.InteractionType.LOOK_AROUND;this._constraintOptions.selection=r.ConstraintTypes.ALL_EXCEPT_COLLISION;t.applyAll(this.view,V,this._constraintOptions)}}_applyPan(M,V=this.currentCamera){M.enabled&&(V.eye=m.transformMat4(R,
V.eye,M.matrix),V.center=m.transformMat4(R,V.center,M.matrix),this.view.state.isGlobal&&(V.up=m.transformMat4(R,V.up,M.matrix)),this._constraintOptions.interactionType=u.InteractionType.PAN,this._constraintOptions.selection=r.ConstraintTypes.ALL,t.applyAll(this.view,V,this._constraintOptions))}_applyZoom(M){if(M){var V=this.currentCamera.viewForward;this.currentCamera.eye=m.add(R,this.currentCamera.eye,m.scale(h.sv3d.get(),V,M));m.copy(X,V);m.negate(X,X);this._constraintOptions.interactionDirection=
X;this._constraintOptions.interactionType=u.InteractionType.ZOOM;this._constraintOptions.selection=r.ConstraintTypes.ALL_EXCEPT_COLLISION;t.applyAll(this.view,this.currentCamera,this._constraintOptions);this._constraintOptions.interactionDirection=null}}_applyAscend(M){if(M){var V=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,h.sv3d.get());this._constraintOptions.interactionDirection=m.copy(X,V);this.view.state.isGlobal?(V=m.length(this.currentCamera.eye),M=(V+M)/V,this.currentCamera.eye=
m.scale(R,this.currentCamera.eye,M),this.currentCamera.center=m.scale(R,this.currentCamera.center,M)):(M=m.scale(h.sv3d.get(),V,M),this.currentCamera.eye=m.add(R,this.currentCamera.eye,M),this.currentCamera.center=m.add(R,this.currentCamera.center,M));this._updateCameraCenter();this._constraintOptions.interactionType=u.InteractionType.ASCEND;this._constraintOptions.selection=r.ConstraintTypes.COLLISION;t.applyAll(this.view,this.currentCamera,this._constraintOptions)&&this._updateCameraCenter();this._constraintOptions.selection=
r.ConstraintTypes.ALL_EXCEPT_COLLISION;t.applyAll(this.view,this.currentCamera,this._constraintOptions);this._constraintOptions.interactionDirection=null}}_calculateControlTransformation(M,V,Y){Y.zoom=0;Y.ascend=0;Y.pan.enabled=!1;q.identity(Y.pan.matrix);Y.rotate.enabled=!1;q.identity(Y.rotate.matrix);M=this._computeVelocities(M);this.view.state.isLocal?this._calculateControlTransformationLocal(M,V,Y):this._calculateControlTransformationGlobal(M,V,Y)}_updateCameraCenter(){this.currentCamera.center=
this.view.renderCoordsHelper.intersectManifoldClosestSilhouette(this.currentCamera.ray,this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,R)}_calculateControlTransformationLocal(M,V,Y){const {viewRight:W,viewForward:H}=V,S=this._transformation;var I=this.view.navigation.gamepad,Q=m.set(h.sv3d.get(),H[0],H[1],0);m.normalize(Q,Q);var N=S.translation[0]*M.pan;0!==N&&(N=m.scale(h.sv3d.get(),W,N),q.translate(Y.pan.matrix,Y.pan.matrix,N),Y.pan.enabled=!0);switch(I.mode){case "pan":I=
-S.translation[1]*M.pan;0!==I&&(Q=m.scale(h.sv3d.get(),Q,I),q.translate(Y.pan.matrix,Y.pan.matrix,Q),Y.pan.enabled=!0);Y.zoom=S.zoom*M.zoom;break;case "zoom":Y.zoom=(-S.translation[1]+S.zoom)*M.zoom;break;default:c.neverReached(I.mode)}Y.ascend=S.translation[2]*M.ascend;Q=-S.heading*M.rotate;0!==Q&&(q.rotate(Y.rotate.matrix,Y.rotate.matrix,Q,this.view.renderCoordsHelper.worldUpAtPosition(V.eye,h.sv3d.get())),Y.rotate.enabled=!0);M=S.tilt*M.rotate;V=E.viewAngle(this.view.renderCoordsHelper,V.center,
V.eye);if(V=d.clamp(V+M,z.TiltDefault.min,z.TiltDefault.max)-V)q.rotate(Y.rotate.matrix,Y.rotate.matrix,V,W),Y.rotate.enabled=!0}_calculateControlTransformationGlobal(M,V,Y){const {eye:W,viewRight:H}=V,S=this._transformation;var I=this.view.navigation.gamepad,Q=m.cross(h.sv3d.get(),H,W);m.normalize(Q,Q);m.negate(Q,Q);C.panMotionToRotationMatrix(this.startCamera,V,S,M,this.view.camera.heading,this._headingStart,this.view.camera.tilt,Y,I);this._tmpCamera.copyFrom(this.currentCamera);this._applyPan(J.pan,
this._tmpCamera);I=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;Y.ascend=S.translation[2]*M.ascend;Q=-S.heading*M.rotate;0!==Q&&(q.rotate(Y.rotate.matrix,Y.rotate.matrix,Q,this._tmpCamera.eye),Y.rotate.enabled=!0);V=this._clampTiltDeltaGlobalToValidRange(S.tilt*M.rotate,V.ray,I);0!==V&&(q.rotate(Y.rotate.matrix,Y.rotate.matrix,V,this._tmpCamera.viewRight),Y.rotate.enabled=!0);Y.zoom+=S.zoom*M.zoom}_clampTiltDeltaGlobalToValidRange(M,V,Y){const W=w.getReferenceEllipsoid(this.view.spatialReference),
H=C.onSurfaceTiltToEyeTiltGlobal(z.TiltDefault.min,V.origin,Y,W);var S=0;let I=0;S=h.sv3d.get();this.view.renderCoordsHelper.intersectManifold(V,Y,S)?(S=E.viewAngle(this.view.renderCoordsHelper,S,V.origin),S=C.onSurfaceTiltToEyeTiltGlobal(S,V.origin,Y,W),I=C.onSurfaceTiltToEyeTiltGlobal(z.TiltDefault.max,V.origin,Y,W)):(x.closestPointOnSilhouette(x.fromRadius(x.tmpSphere,Y+W.radius),V,S),S=Math.PI+p.angle(V.direction,S),S=C.offSurfaceTiltToEyeTiltGlobal(S,V.origin,Y,W),I=C.offSurfaceTiltToEyeTiltGlobal(z.TiltDefault.max,
V.origin,Y,W));return d.clamp(S+M,H,I)-S}_getPointAbsoluteSurfaceElevation(M,V,Y){const {renderCoordsHelper:W}=this.view,H=W.getAltitude(M);V+=Math.abs(H-V);W.setAltitude(Y,V,M);return V}_clampedDistanceToSurface(M,V){const {renderCoordsHelper:Y}=this.view,{camera:W}=this.view.state;var {direction:H}=B.headingTiltToDirectionUp(this.view,V,0,80,U);H=Y.intersectManifoldClosestSilhouette(v.wrap(V,H),M,h.sv3d.get());H=m.distance(V,H);M=Y.intersectManifoldClosestSilhouette(v.wrap(V,m.direction(h.sv3d.get(),
V,W.center)),M,h.sv3d.get());V=m.distance(V,M);return Math.min(H,V)}_computeHeadingRotateRadius(M){const {renderCoordsHelper:V,state:Y}=this.view,{camera:W,isGlobal:H}=Y;var S=V.intersectManifoldClosestSilhouette(W.ray,this._filteredSurfaceElevation,h.sv3d.get());if(H){const I=m.subtract(h.sv3d.get(),M,S);S=m.length(I);m.scale(I,I,1/S);M=m.normalize(h.sv3d.get(),M);M=d.acosClamped(m.dot(M,I));return S*Math.sin(Math.min(G,M))}M=m.copy(h.sv3d.get(),M);V.setAltitude(M,this._filteredSurfaceElevation);
return m.distance(S,M)}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:5}_computeVelocities(M){var V=this._filteredSurfaceElevation,Y=V+w.getReferenceEllipsoid(this.view.spatialReference).radius;const {camera:W,isGlobal:H}=this.view.state;var S=h.sv3d.get();const I=this._getPointAbsoluteSurfaceElevation(W.eye,V,S);var Q=this._clampedDistanceToSurface(V,S);const N=W.width/2,T=.75*W.width,aa=.75*W.width;var Z=Q*Math.tan(.5*W.fovX)/N;Y=Z/Y;S=Z/this._computeHeadingRotateRadius(S);
Z=(H?Y:Z)*T*M;V=I-V;V=Math.max(this._minimumAscendVelocity()*M,2**(T*M/N)*V-V);Q=2**(T*M/N)*Q-Q;M*=d.clamp(S*aa,O,P);return{pan:Z,ascend:V,zoom:Q,rotate:M}}_applyDisabledMovementTypes(M){null==this.disableMovements||void 0!==this.disableMovements.mode&&this.view.state.viewingMode!==this.disableMovements.mode||(M.zoom=this.disableMovements.zoom?0:M.zoom,M.ascend=this.disableMovements.ascend?0:M.ascend,M.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&q.identity(M.pan.matrix),M.rotate.enabled=
!this.disableMovements.rotate,this.disableMovements.rotate&&q.identity(M.rotate.matrix))}static activatesFor(M,V){M=K.extractTransformation(V,M.navigation.gamepad,L);return!("end"===V.action||K.isZeroTransformation(M))}};a.__decorate([f.property({constructOnly:!0})],b.GamepadKeyboardController.prototype,"gamepadDevice",void 0);a.__decorate([f.property({constructOnly:!0})],b.GamepadKeyboardController.prototype,"disableMovements",void 0);b.GamepadKeyboardController=a.__decorate([g.subclass("esri.views.3d.state.controllers.GamepadKeyboardController")],
b.GamepadKeyboardController);const L={translation:[0,0,0],heading:0,tilt:0,zoom:0},G=d.deg2rad(80),O=d.deg2rad(30),P=d.deg2rad(80),J={zoom:0,ascend:0,pan:{enabled:!1,matrix:e.create()},rotate:{enabled:!1,matrix:e.create()}},R=l.create(),X=l.create(),U=D.createDirectionUp();Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/gamepadAndKeyboardUtils":function(){define(["exports","../../chunks/vec3"],function(b,a){function c(d){let f=d*d;0>d&&(f*=-1);return f}b.extractTransformation=
function(d,f,n){const k=d.state;d=d.device;f="forward-down"===f.tiltDirection?1:-1;"standard"===d.deviceType?(n.translation[0]=c(k.axes[0]),n.translation[1]=c(k.axes[1]),n.translation[2]=c(k.buttons[7])-c(k.buttons[6]),n.heading=c(k.axes[2]),n.tilt=c(k.axes[3])):"spacemouse"===d.deviceType&&(n.translation[0]=1.2*c(k.axes[0]),n.translation[1]=1.2*c(k.axes[1]),n.translation[2]=2*-c(k.axes[2]),n.heading=1.2*c(k.axes[5]),n.tilt=1.2*c(k.axes[3]));n.tilt*=f;a.scale(n.translation,n.translation,1);return n};
b.extractTransformationKeyboard=function(d,f){f.translation[0]=d[1]-d[0];f.translation[1]=d[3]-d[2];f.translation[2]=d[4]-d[5];f.heading=d[7]-d[6];f.tilt=d[8]-d[9];f.zoom=d[10]-d[11];return f};b.isZeroTransformation=function(d){return 0===d.translation[0]&&0===d.translation[1]&&0===d.translation[2]&&0===d.heading&&0===d.tilt&&0===d.zoom};b.resetTransformation=function(d){d.translation[0]=0;d.translation[1]=0;d.translation[2]=0;d.heading=0;d.tilt=0;return d};Object.defineProperty(b,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/input/handlers/KeyboardNavigation":function(){define(["exports","../../../ViewingMode","../../state/controllers/GamepadKeyboardController","../../../input/InputHandler","../../../input/VisibilityChange"],function(b,a,c,d,f){var n;(function(g){g[g.LEFT=0]="LEFT";g[g.RIGHT=1]="RIGHT";g[g.FORWARD=2]="FORWARD";g[g.BACKWARD=3]="BACKWARD";g[g.UP=4]="UP";g[g.DOWN=5]="DOWN";g[g.HEADINGLEFT=6]="HEADINGLEFT";g[g.HEADINGRIGHT=7]="HEADINGRIGHT";g[g.TILTUP=8]="TILTUP";g[g.TILTDOWN=
9]="TILTDOWN";g[g.ZOOMIN=10]="ZOOMIN";g[g.ZOOMOUT=11]="ZOOMOUT"})(n||(n={}));class k extends d.InputHandler{constructor(g,q){super(!0);this._view=g;this._disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:a.ViewingMode.Local};this._keyToNumber={[q.left]:n.LEFT,[q.right]:n.RIGHT,[q.forward]:n.FORWARD,[q.backward]:n.BACKWARD,[q.up]:n.UP,[q.down]:n.DOWN,[q.headingLeft]:n.HEADINGLEFT,[q.headingRight]:n.HEADINGRIGHT,[q.tiltUp]:n.TILTUP,[q.tiltDown]:n.TILTDOWN,[q.zoomIn]:n.ZOOMIN,[q.zoomOut]:n.ZOOMOUT};
this.registerIncoming("key-down",null,e=>this._handleKeyDown(e));this.registerIncoming("key-up",null,e=>this._handleKeyUp(e));this.registerIncoming("blur",null,()=>this._handleStop());this._visibilityHandle=f.onVisibilityChange(e=>e?null:this._handleStop())}onUninstall(){this._visibilityHandle?.remove();this._handleStop()}_handleKeyDown(g){if(!g.data.native.ctrlKey&&!g.data.native.metaKey){var q=this._keyToNumber[g.data.key];null!=q&&(this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active||
(this._cameraControllerKeyboard=new c.GamepadKeyboardController({view:this._view,disableMovements:this._disableMovements}),this._view.state.switchCameraController(this._cameraControllerKeyboard)),this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.activateDirection(q),g.stopPropagation()))}}_handleStop(){this._cameraControllerKeyboard?.active&&(this._cameraControllerKeyboard.finishController(),this._cameraControllerKeyboard=null)}_handleKeyUp(g){if(!g.data.native.ctrlKey&&!g.data.native.metaKey){var q=
this._keyToNumber[g.data.key];null!=q&&this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.deactivateDirection(q),g.stopPropagation())}}}b.KeyboardNavigation=k;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/VisibilityChange":function(){define(["exports"],function(b){b.onVisibilityChange=function(a){const c=()=>a("visible"===document.visibilityState);document.addEventListener("visibilitychange",c);return{remove:()=>
document.addEventListener("visibilitychange",c)}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/MouseWheelZoom":function(){define(["exports","../../../../core/screenUtils","../../state/controllers/global/ZoomStepController","../../state/controllers/local/ZoomStepController","../../../input/InputHandler"],function(b,a,c,d,f){class n extends f.InputHandler{constructor(k,g){super(!0);this._view=k;this.registerIncoming("mouse-wheel",g,q=>this._handleMouseWheel(q))}_handleMouseWheel(k){if(this._view.navigation.mouseWheelZoomEnabled){var g=
k.data;this._cameraController&&this._cameraController.active||(this._cameraController=this._view.state.isGlobal?new c.ZoomStepController({view:this._view,mode:"interaction"}):new d.ZoomStepController({view:this._view,mode:"interaction"}),this._view.state.switchCameraController(this._cameraController));this._cameraController.zoomStep(-1/60*g.deltaY,a.createScreenPointArray(g.x,g.y));k.preventDefault();k.stopPropagation()}}}b.MouseWheelZoom=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/input/handlers/PinchAndPanNavigation":function(){define(["exports","../../state/controllers/global/PinchAndPanController","../../state/controllers/local/PinchAndPanController","../../../input/InputHandler","../../../input/handlers/support"],function(b,a,c,d,f){class n extends d.InputHandler{constructor(k,g,q){super(!0);this._view=k;this.pointerAction=g;this._lastTimestamp=this._lastEndTimestamp=0;this.registerIncoming("drag",q,e=>this._handleDrag(e))}_handleDrag(k){if("mouse"!==k.data.pointerType||
f.eventMatchesMousePointerAction(k.data,this.pointerAction)){var g=k.timestamp-this._lastEndTimestamp;g=this._momentum&&this._momentum.active&&40>g;switch(k.data.action){case "start":case "update":if(g)break;this._controller&&this._controller.active?2<k.data.timestamp-this._lastTimestamp&&(this._controller.update(k.data),this._lastTimestamp=k.timestamp):this._startController(k);break;case "end":case "removed":this._endController(k,!0);break;case "added":this._endController(k,!1),this._startController(k)}k.stopPropagation()}}_endController(k,
g){this._controller&&this._controller.active&&(this._lastEndTimestamp=k.timestamp,k=this._controller.end(k.data),g&&k&&(this._momentum=k,this._view.state.switchCameraController(this._momentum)));this._controller=null}_startController(k){this._controller=this._createController();this._view.state.switchCameraController(this._controller);this._controller.begin(k.data);this._lastTimestamp=k.timestamp}_createController(){return this._view.state.isGlobal?new a.PinchAndPanController({view:this._view}):new c.PinchAndPanController({view:this._view})}}
b.PinchAndPanNavigation=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/global/PinchAndPanController":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/Cyclical ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec2 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/ellipsoidUtils ../../../../../geometry/support/axisAngle ../../../../../geometry/support/plane ../../../../../chunks/sphere ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../camera/constraintUtils/TiltMode ../../../input/util ../InteractiveController ../momentum/PanPlanarMomentumController ../momentum/PanSphericalMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../momentum/ZoomSphericalMomentumController ../../utils/navigationUtils ../../../webgl-engine/lib/Camera ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/PanSphericalMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A,C,E,B,D,F,K,L,G,O,P,J,R){b.PinchAndPanController=class extends C.InteractiveController{constructor(){super(...arguments);this._smoothRotation=new A.ExponentialFalloff(.05);this._rotationAxis=v.create();this._beginHeading=this._beginAngle=0;this._panningPlane=h.create();this._beginRadius=0;this._smoothScaling=new A.ExponentialFalloff(.05);this._zoomCenterScreen=f.createScreenPointArray();this._zoomMomentumEstimator=new R.ZoomMomentumEstimator;
this._rotationMomentumEstimator=new J.RotationMomentumEstimator;this._panSphericalMomentumEstimator=new P.PanSphericalMomentumEstimator;this._panPlanarMomentumEstimator=new O.PanPlanarMomentumEstimator;this._adjustedSphere=t.create();this._tmp3d=v.create();this._tmpScreenPointArray=f.createScreenPointArray();this._beginScreenPoint=f.createScreenPointArray();this._beginScenePoint=v.create();this._screenPickPoint=f.createScreenPointArray();this._scenePickPoint=v.create();this._mode=L.NavigationMode.Horizontal;
this._sphere=t.create();this._pointerCount=0;this._tmpInteractionDirection=v.create();this._constraintOptions={selection:u.ConstraintTypes.ALL,interactionType:y.InteractionType.NONE,interactionFactor:0,interactionStartCamera:new G.Camera,interactionDirection:null,tiltMode:z.TiltMode.TUMBLE}}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(X){if(this.active){var U=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=U;this._rotationMomentumEstimator.enabled=
U;this._panPlanarMomentumEstimator.enabled=U;this._panSphericalMomentumEstimator.enabled=U;this._beginHeading=-c.cyclicalPI.normalize(d.deg2rad(this.view.camera.heading));this._beginRadius=X.radius;this._pointerCount=X.pointers.size;this._beginAngle=X.angle;this._smoothRotation.reset();f.screenPointObjectToArray(X.center,this._screenPickPoint);l.copy(this._beginScreenPoint,this._screenPickPoint);U=x.getReferenceEllipsoid(this.view.spatialReference);var M=L.pickPointAndInitSphere(this._intersectionHelper,
this.startCamera,this._screenPickPoint,U,L.SpherePickPointFallback.Silhouette,0===this.view.map.ground.opacity?L.contentIntersectorOptions:{});null!=M.scenePickPoint&&(this._scenePickPoint=M.scenePickPoint,this._sphere=M.sphere,w.copy(this._beginScenePoint,this._scenePickPoint),this._mode=L.decideNavigationMode(this.startCamera,this._screenPickPoint,U),this._mode===L.NavigationMode.Vertical&&this._preparePlanarPanMode(X,M.hasGeometryIntersection),this._constraintOptions.interactionStartCamera?.copyFrom(this.startCamera))}}update(X){if(this.active){this.currentCamera.copyFrom(this.startCamera);
var U=1<X.pointers.size;this._mode===L.NavigationMode.Horizontal?(U&&this._zoomSpherical(X),this._panningSpherical(X),U&&this._rotateSpherical(X)):(U&&this._zoomPlanar(X),this._panningPlanar(X),U&&this._rotatePlanar(X));this.commitCamera()}}end(X){X.pointers.size===this._pointerCount&&this.update(X);this.finishController();if(X=this._zoomMomentumEstimator.evaluateMomentum())return this._mode===L.NavigationMode.Horizontal?new K.ZoomSphericalMomentumController({view:this.view,momentum:X,screenCenter:this._zoomCenterScreen,
sceneCenter:this._beginScenePoint,radius:this._sphere[3]}):new F.ZoomPlanarMomentumController({view:this.view,momentum:X,zoomCenter:this._beginScenePoint});if(X=this._rotationMomentumEstimator.evaluateMomentum())return new D.RotationMomentumController({view:this.view,momentum:X,center:this._sphere,axis:this._rotationAxis});if(this._mode===L.NavigationMode.Horizontal){if(X=this._panSphericalMomentumEstimator.evaluateMomentum())return new B.PanSphericalMomentumController({view:this.view,momentum:X})}else if(X=
this._panPlanarMomentumEstimator.evaluateMomentum())return new E.PanPlanarMomentumController({view:this.view,momentum:X});return null}_preparePlanarPanMode(X,U){var M=w.negate(this._tmp3d,this.startCamera.viewForward);h.fromPositionAndNormal(this._scenePickPoint,M,this._panningPlane);var V=f.createScreenPointArray(this._screenPickPoint[0],0);M=v.create();var Y=w.length(this.startCamera.eye);this._adjustedSphere[3]=Y<this._sphere[3]?Y-100:this._sphere[3];L.sphereOrPlanePointFromScreenPoint(this._adjustedSphere,
this.startCamera,V,M);V=f.createRenderScreenPointArray3();this.startCamera.projectToRenderScreen(M,V);M=v.create();V=v.create();Y=v.create();w.subtract(M,this._scenePickPoint,this.currentCamera.eye);const W=w.length(M);w.normalize(M,M);var H=L.panDistanceModifier*Math.max(Math.abs(this.view.camera.position.z),L.minHeightLimit);const S=this.view._stage.renderView.getMinimalDepthForArea(null,this._screenPickPoint[0],this._screenPickPoint[1],this.view.state.camera,L.screenPixelArea);H=null!=S?S:H;H=
U?Math.min(H,W):H;w.copy(Y,w.add(V,this.currentCamera.eye,w.scale(V,M,H)));this._panningPlane[3]=-w.dot(h.normal(this._panningPlane),Y);this.startCamera.center=w.add(V,this.startCamera.eye,w.scale(V,this.startCamera.viewForward,H));X=f.screenPointObjectToArray(X.center,this._tmpScreenPointArray);L.intersectPlaneFromScreenPointAtEye(this._panningPlane,this.startCamera,X,this._beginScenePoint)}_zoomSpherical(X){const U=this._beginRadius/X.radius;this._smoothScaling.gain=.001875*Math.min(Math.max(X.radius,
40),120);this._smoothScaling.update(U);L.applyZoomOnSphere(this._sphere,this.currentCamera,this._smoothScaling.value);f.screenPointObjectToArray(X.center,this._zoomCenterScreen);this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*X.timestamp);this._constraintOptions.interactionType=y.InteractionType.ZOOM;this._constraintOptions.interactionFactor=r.pixelDistanceToInteractionFactor(X.radius-this._beginRadius);r.applyAll(this.view,this.currentCamera,this._constraintOptions)}_panningSpherical(X){const U=
f.screenPointObjectToArray(X.center,this._tmpScreenPointArray);L.sphereOrPlanePointFromScreenPoint(this._sphere,this.currentCamera,U,this._tmp3d);L.preserveHeadingThreshold(this._beginScenePoint,w.dot(this.currentCamera.up,this._beginScenePoint),this._sphere[3],this._beginHeading,this.view.camera.tilt,this.startCamera)?(L.applyPanSphericalPreserveHeading(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this._beginHeading,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumPreserveHeading(U,
this._tmp3d,.001*X.timestamp,this.startCamera,this._sphere,this._beginHeading,this.view.camera.tilt)):(L.applyPanSphericalDirectRotation(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumDirectRotation(U,this._tmp3d,.001*X.timestamp,this.startCamera,this._sphere[3],this.view.camera.tilt));this._constraintOptions.interactionType=y.InteractionType.PAN;this._constraintOptions.interactionFactor=r.pixelDistanceToInteractionFactor(l.distance(this._screenPickPoint,
U));r.applyAll(this.view,this.currentCamera,this._constraintOptions)}_rotateSpherical(X){w.normalize(this._rotationAxis,this._scenePickPoint);this.currentCamera.aboveGround||w.negate(this._rotationAxis,this._rotationAxis);var U=this._smoothRotation.value,M=L.normalizeRotationDelta(X.angle-U);U+=M;this._smoothRotation.gain=.00125*Math.min(Math.max(X.radius,40),120);this._smoothRotation.update(U);M=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(M,.001*X.timestamp);L.applyRotation(this.currentCamera,
this._sphere,p.wrapAxisAngle(this._rotationAxis,M));this._constraintOptions.interactionType=y.InteractionType.TUMBLE;this._constraintOptions.interactionFactor=r.pixelDistanceToInteractionFactor(X.radius*U);r.applyAll(this.view,this.currentCamera,this._constraintOptions)}_panningPlanar(X){const U=f.screenPointObjectToArray(X.center,this._tmpScreenPointArray);L.intersectPlaneFromScreenPointAtEye(this._panningPlane,this.currentCamera,U,this._tmp3d)&&(L.applyPanPlanar(this.currentCamera,this._beginScenePoint,
this._tmp3d),this._panPlanarMomentumEstimator.add(U,this._tmp3d,.001*X.timestamp),this._constraintOptions.interactionType=y.InteractionType.PAN,this._constraintOptions.interactionFactor=r.pixelDistanceToInteractionFactor(l.distance(this._beginScreenPoint,U)),this._constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this._tmpInteractionDirection),r.applyAll(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=
null)}_zoomPlanar(X){const U=this._beginRadius/X.radius;this._smoothScaling.gain=.001875*Math.min(Math.max(X.radius,40),120);this._smoothScaling.update(U);this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*X.timestamp);L.applyZoomToPoint(this.currentCamera,this._beginScenePoint,this._smoothScaling.value,this.view.state.constraints.minimumPoiDistance);this._constraintOptions.interactionType=y.InteractionType.ZOOM;this._constraintOptions.interactionFactor=r.pixelDistanceToInteractionFactor(X.radius-
this._beginRadius);r.applyAll(this.view,this.currentCamera,this._constraintOptions)}_rotatePlanar(X){w.copy(this._rotationAxis,this._beginScenePoint);this.currentCamera.aboveGround||w.negate(this._rotationAxis,this._rotationAxis);var U=this._smoothRotation.value;let M=X.angle-U;M=L.normalizeRotationDelta(M);this._smoothRotation.gain=.00125*Math.min(Math.max(X.radius,40),120);this._smoothRotation.update(U+M);U=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(U,.001*X.timestamp);
L.applyRotation(this.currentCamera,this._sphere,p.wrapAxisAngle(this._rotationAxis,U));this._constraintOptions.interactionType=y.InteractionType.TUMBLE;this._constraintOptions.interactionFactor=r.pixelDistanceToInteractionFactor(X.radius*U);r.applyAll(this.view,this.currentCamera,this._constraintOptions)}};b.PinchAndPanController=a.__decorate([m.subclass("esri.views.3d.state.controllers.global.PinchAndPanController")],b.PinchAndPanController);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/input/util":function(){define(["exports"],function(b){class a{constructor(c){this._gain=c}reset(c){this._value=c}set gain(c){this._gain=c}get value(){return void 0===this._value?0:this._value}update(c){this._value=void 0===this._value?c:this._gain*c+(1-this._gain)*this._value}}b.ExponentialFalloff=a;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/momentum/PanPlanarMomentumController":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../camera/constraintUtils/InteractionType ./MomentumController".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m){b.PanPlanarMomentumController=class extends m.MomentumController{constructor(w){super(w);this.interactionType=e.InteractionType.PAN;this._tmpPan=q.create()}momentumStep(w,v){w=this.momentum.value(w);g.scale(this._tmpPan,this.momentum.direction,w);v.eye=g.subtract(l,v.eye,this._tmpPan);v.center=g.subtract(l,v.center,this._tmpPan);this.constraintOptions.interactionDirection=this._tmpPan}};a.__decorate([c.property({constructOnly:!0})],b.PanPlanarMomentumController.prototype,
"momentum",void 0);b.PanPlanarMomentumController=a.__decorate([k.subclass("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],b.PanPlanarMomentumController);const l=q.create();Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/momentum/MomentumController":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../ViewAnimation ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../camera/constraintUtils/TiltMode ../AnimationController ../../../webgl-engine/lib/Camera".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x){b.MomentumController=class extends v.AnimationController{constructor(){super(...arguments);this._beginCamera=new x.Camera;this._elapsedTimeSec=0;this.constraintOptions={selection:m.ConstraintTypes.ALL,interactionType:l.InteractionType.PAN,interactionFactor:0,interactionStartCamera:new x.Camera,interactionDirection:null,tiltMode:w.TiltMode.TUMBLE}}initialize(){this.constraintOptions.interactionType=this.interactionType;this.viewAnimation=new q}get steppingFinished(){return this.momentum.isFinished(this._elapsedTimeSec)}onControllerStart(p){this._beginCamera.copyFrom(p);
this.constraintOptions.interactionStartCamera=this._beginCamera;super.onControllerStart(p)}stepController(p,h){h.copyViewFrom(this._beginCamera);this._elapsedTimeSec+=p;this.momentumStep(this._elapsedTimeSec,h);e.applyAll(this.view,h,this.constraintOptions)}};b.MomentumController=a.__decorate([g.subclass("esri.views.3d.state.controllers.momentum.MomentumController")],b.MomentumController);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/momentum/PanSphericalMomentumController":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../camera/constraintUtils/InteractionType ./MomentumController ../../utils/navigationUtils".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l){const w=q.create(),v=q.create();b.PanSphericalMomentumController=class extends m.MomentumController{constructor(x){super(x);this.interactionType=e.InteractionType.PAN}momentumStep(x,p){const h=this.momentum.value1(x);x=this.momentum.value2(x);g.copy(v,p.eye);g.normalize(v,v);g.cross(this.momentum.axis2,v,this.momentum.axis1);l.applyRotationWithTwoAxes(p,w,this.momentum.axis1,h,this.momentum.axis2,x)}};a.__decorate([c.property({constructOnly:!0})],b.PanSphericalMomentumController.prototype,
"momentum",void 0);b.PanSphericalMomentumController=a.__decorate([k.subclass("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],b.PanSphericalMomentumController);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/momentum/RotationMomentumController":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3f64 ../../../../../geometry/support/axisAngle ../../../camera/constraintUtils/InteractionType ./MomentumController ../../utils/navigationUtils".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l){b.RotationMomentumController=class extends m.MomentumController{set center(w){this._set("center",g.clone(w))}set axis(w){this._set("axis",g.clone(w))}constructor(w){super(w);this.interactionType=e.InteractionType.TUMBLE}momentumStep(w,v){w=this.momentum.value(w);l.applyRotation(v,this.center,q.wrapAxisAngle(this.axis,w))}};a.__decorate([c.property({constructOnly:!0})],b.RotationMomentumController.prototype,"momentum",void 0);a.__decorate([c.property({constructOnly:!0})],
b.RotationMomentumController.prototype,"center",null);a.__decorate([c.property({constructOnly:!0})],b.RotationMomentumController.prototype,"axis",null);b.RotationMomentumController=a.__decorate([k.subclass("esri.views.3d.state.controllers.momentum.MomentumController")],b.RotationMomentumController);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/momentum/ZoomPlanarMomentumController":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../camera/constraintUtils/InteractionType ./MomentumController ../../utils/navigationUtils".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l){b.ZoomPlanarMomentumController=class extends m.MomentumController{set zoomCenter(w){this._set("zoomCenter",q.clone(w))}constructor(w){super(w);this.interactionType=e.InteractionType.ZOOM;this.constraintOptions.interactionDirection=q.create()}momentumStep(w,v){const {interactionDirection:x}=this.constraintOptions;x&&(g.copy(x,v.eye),w=this.momentum.valueDelta(0,w),l.applyZoomToPoint(v,this.zoomCenter,w,this.view.state.constraints.minimumPoiDistance),g.direction(x,
v.eye,x))}};a.__decorate([c.property({constructOnly:!0})],b.ZoomPlanarMomentumController.prototype,"momentum",void 0);a.__decorate([c.property({constructOnly:!0})],b.ZoomPlanarMomentumController.prototype,"zoomCenter",null);b.ZoomPlanarMomentumController=a.__decorate([k.subclass("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],b.ZoomPlanarMomentumController);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/momentum/ZoomSphericalMomentumController":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/screenUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3f64 ../../../../../geometry/support/axisAngle ../../../../../chunks/sphere ../../../camera/constraintUtils ../../../camera/constraintUtils/InteractionType ./MomentumController ../../utils/navigationUtils".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x){b.ZoomSphericalMomentumController=class extends v.MomentumController{set screenCenter(p){this._set("screenCenter",c.createScreenPointArray(p[0],p[1]))}set sceneCenter(p){this._set("sceneCenter",q.clone(p))}constructor(p){super(p);this.interactionType=w.InteractionType.ZOOM;this.radius=0;this._tmpSceneCenter=q.create();this._tmpZoomAxisAngle=e.create();this._sphere=m.create()}initialize(){this._sphere[3]=this.radius}momentumStep(p,h){p=this.momentum.valueDelta(0,
p);x.applyZoomOnSphere(this._sphere,h,p);this.constraintOptions.interactionType=w.InteractionType.ZOOM;l.applyAll(this.view,h,this.constraintOptions);x.sphereOrPlanePointFromScreenPoint(this._sphere,h,this.screenCenter,this._tmpSceneCenter);e.fromPoints(this.sceneCenter,this._tmpSceneCenter,this._tmpZoomAxisAngle);x.applyRotation(h,this._sphere,this._tmpZoomAxisAngle);this.constraintOptions.interactionType=w.InteractionType.PAN}};a.__decorate([d.property({constructOnly:!0})],b.ZoomSphericalMomentumController.prototype,
"momentum",void 0);a.__decorate([d.property({constructOnly:!0})],b.ZoomSphericalMomentumController.prototype,"screenCenter",null);a.__decorate([d.property({constructOnly:!0})],b.ZoomSphericalMomentumController.prototype,"sceneCenter",null);a.__decorate([d.property({constructOnly:!0})],b.ZoomSphericalMomentumController.prototype,"radius",void 0);b.ZoomSphericalMomentumController=a.__decorate([g.subclass("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],b.ZoomSphericalMomentumController);
Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/PanPlanarMomentumEstimator":function(){define(["exports","../../chunks/vec3","../../chunks/vec3f64","./FilteredFiniteDifference","./Momentum"],function(b,a,c,d,f){class n extends f.Momentum{constructor(g,q,e,m,l){super(g,q,e);this._sceneVelocity=m;this.direction=l}value(g){return super.valueFromInitialVelocity(this._sceneVelocity,g)}}class k{constructor(g=300,q=12,e=.84){this._minimumInitialVelocity=g;this._stopVelocity=
q;this._friction=e;this.enabled=!0;this._time=new d.FilteredFiniteDifference(.6);this._screen=[new d.FilteredFiniteDifference(.4),new d.FilteredFiniteDifference(.4)];this._scene=[new d.FilteredFiniteDifference(.6),new d.FilteredFiniteDifference(.6),new d.FilteredFiniteDifference(.6)];this._tmpDirection=c.create()}add(g,q,e){!this.enabled||this._time.hasLastValue()&&.015>this._time.computeDelta(e)||(this._screen[0].update(g[0]),this._screen[1].update(g[1]),this._scene[0].update(q[0]),this._scene[1].update(q[1]),
this._scene[2].update(q[2]),this._time.update(e))}reset(){this._screen[0].reset();this._screen[1].reset();this._scene[0].reset();this._scene[1].reset();this._scene[2].reset();this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;var g=this._screen[0].filteredDelta,q=this._screen[1].filteredDelta;g=null==g||null==q?0:Math.sqrt(g*g+q*q);q=this._time.filteredDelta;g=null==q||null==g?0:g/q;return Math.abs(g)<this._minimumInitialVelocity?
null:this.createMomentum(g,this._stopVelocity,this._friction)}createMomentum(g,q,e){a.set(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const m=a.length(this._tmpDirection);0<m&&a.scale(this._tmpDirection,this._tmpDirection,1/m);const l=this._time.filteredDelta;return new n(g,q,e,null==l?0:m/l,this._tmpDirection)}}b.PanPlanarMomentum=n;b.PanPlanarMomentumEstimator=k;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/views/navigation/FilteredFiniteDifference":function(){define(["exports"],function(b){class a{constructor(c){this._gain=c;this.filteredDelta=this.lastValue=void 0}update(c){if(this.hasLastValue()){const d=this.computeDelta(c);this._updateDelta(d)}this.lastValue=c}reset(){this.filteredDelta=this.lastValue=void 0}hasLastValue(){return void 0!==this.lastValue}hasFilteredDelta(){return void 0!==this.filteredDelta}computeDelta(c){return void 0===this.lastValue?NaN:c-this.lastValue}_updateDelta(c){this.filteredDelta=
void 0!==this.filteredDelta?(1-this._gain)*this.filteredDelta+this._gain*c:c}}b.FilteredFiniteDifference=a;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/Momentum":function(){define(["exports"],function(b){class a{constructor(c,d,f){this._initialVelocity=c;this._stopVelocity=d;this._friction=f;this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(c){return c>
this.duration}get friction(){return this._friction}value(c){return this.valueFromInitialVelocity(this._initialVelocity,c)}valueDelta(c,d){const f=this.value(c);return this.value(c+d)-f}valueFromInitialVelocity(c,d){d=Math.min(d,this.duration);const f=1-this.friction;return c*(f**d-1)/Math.log(f)}}b.Momentum=a;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/PanSphericalMomentumEstimator":function(){define("exports ../../chunks/vec2f64 ../../chunks/vec3 ../../chunks/vec3f64 ../3d/state/utils/navigationUtils ./FilteredFiniteDifference ./FilteredValue ./Momentum".split(" "),
function(b,a,c,d,f,n,k,g){class q extends g.Momentum{constructor(m,l,w,v,x,p=0,h){super(m,l,w);this._angularVelocity1=v;this.axis1=x;this.angularVelocity2=p;this.axis2=h}value1(m){return super.valueFromInitialVelocity(this._angularVelocity1,m)}value2(m){return super.valueFromInitialVelocity(this.angularVelocity2,m)}}class e{constructor(m=300,l=12,w=.84){this._minimumInitialVelocity=m;this._stopVelocity=l;this._friction=w;this.enabled=!0;this._tmpAxis1=d.create();this._tmpAxis2=d.create();this._tmpAngles=
a.create();this._time=new n.FilteredFiniteDifference(.3);this._screen=[new n.FilteredFiniteDifference(.4),new n.FilteredFiniteDifference(.4)];this._angle1=new k.FilteredValue(.6);this._angle2=new k.FilteredValue(.6);this._axis1=d.create();this._axis2=d.create();this._lastScene=d.create()}addMomentumDirectRotation(m,l,w,v,x,p){if(this.enabled){if(this._time.hasLastValue()){if(.01>this._time.computeDelta(w))return;v=f.rotationAngleAndAxisDirectRotation(this._lastScene,l,this._tmpAxis2,v,x,p);this._angle2.update(0);
1E-5>c.squaredLength(this._tmpAxis2)?v=0:c.normalize(this._axis1,this._tmpAxis2);this._angle1.update(v);c.copy(this._lastScene,l)}this._screen[0].update(m[0]);this._screen[1].update(m[1]);this._time.update(w)}}addMomentumPreserveHeading(m,l,w,v,x,p,h){if(this.enabled){if(this._time.hasLastValue()){if(.01>this._time.computeDelta(w))return;f.rotationAnglesAndAxesHeadingPreserving(this._lastScene,l,this._tmpAxis2,this._tmpAxis1,this._tmpAngles,v,x,p,h,!1);1E-5>c.squaredLength(this._tmpAxis2)?(this._angle1.update(0),
this._angle2.update(0)):(this._angle1.update(this._tmpAngles[1]),this._angle2.update(this._tmpAngles[0]),c.normalize(this._axis1,this._tmpAxis1),c.normalize(this._axis2,this._tmpAxis2));c.copy(this._lastScene,l)}this._screen[0].update(m[0]);this._screen[1].update(m[1]);this._time.update(w)}}reset(){this._screen[0].reset();this._screen[1].reset();this._angle1.reset();this._angle2.reset();this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta())return null;var m=this._screen[0].filteredDelta,
l=this._screen[1].filteredDelta;m=null==m||null==l?null:Math.sqrt(m*m+l*l);l=this._time.filteredDelta;m=null==m||null==l?0:m/l;return Math.abs(m)<this._minimumInitialVelocity?null:this.createMomentum(m,this._stopVelocity,this._friction)}createMomentum(m,l,w){const v=this._time.filteredDelta,x=this._angle1.filteredValue,p=this._angle2.filteredValue;return new q(m,l,w,null==v||null==x?0:x/v,this._axis1,null==v||null==p?0:p/v,this._axis2)}}b.PanSphericalMomentum=q;b.PanSphericalMomentumEstimator=e;Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/FilteredValue":function(){define(["exports"],function(b){class a{constructor(c){this._gain=c}update(c){this.filteredValue=void 0!==this.filteredValue?(1-this._gain)*this.filteredValue+this._gain*c:c}reset(){this.filteredValue=void 0}get hasFilteredValue(){return void 0!==this.filteredValue}}b.FilteredValue=a;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/RotationMomentumEstimator":function(){define(["exports",
"./MomentumEstimator"],function(b,a){class c extends a.MomentumEstimator{constructor(d=3,f=.01,n=.95,k=12){super(d,f,n,k)}add(d,f){const n=this.value.lastValue;if(null!=n){for(d-=n;d>Math.PI;)d-=2*Math.PI;for(;d<-Math.PI;)d+=2*Math.PI;d=n+d}super.add(d,f)}}b.RotationMomentumEstimator=c;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/MomentumEstimator":function(){define(["exports","../../core/mathUtils","./FilteredFiniteDifference","./Momentum"],function(b,a,
c,d){class f{constructor(n=2.5,k=.01,g=.95,q=12){this._minimumInitialVelocity=n;this._stopVelocity=k;this._friction=g;this._maxVelocity=q;this.enabled=!0;this.value=new c.FilteredFiniteDifference(.8);this.time=new c.FilteredFiniteDifference(.3)}add(n,k){if(this.enabled&&null!=k){if(this.time.hasLastValue()){if(.01>this.time.computeDelta(k))return;if(this.value.hasFilteredDelta()){const g=this.value.computeDelta(n);0>this.value.filteredDelta*g&&this.value.reset()}}this.time.update(k);this.value.update(n)}}reset(){this.value.reset();
this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let n=this.value.filteredDelta/this.time.filteredDelta;n=a.clamp(n,-this._maxVelocity,this._maxVelocity);return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(n,k,g){return new d.Momentum(n,k,g)}}b.MomentumEstimator=f;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/ZoomMomentumEstimator":function(){define(["exports",
"./Momentum","./MomentumEstimator"],function(b,a,c){class d extends a.Momentum{constructor(n,k,g){super(n,k,g)}value(n){n=super.value(n);return Math.exp(n)}valueDelta(n,k){const g=super.value(n);n=super.value(n+k);return Math.exp(n-g)}}class f extends c.MomentumEstimator{constructor(n=2.5,k=.01,g=.95,q=12){super(n,k,g,q)}add(n,k){super.add(Math.log(n),k)}createMomentum(n,k,g){return new d(n,k,g)}}b.ZoomMomentum=d;b.ZoomMomentumEstimator=f;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/state/controllers/local/PinchAndPanController":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec2 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/axisAngle ../../../../../geometry/support/plane ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../camera/constraintUtils/TiltMode ../../../input/util ../../../layers/VoxelWasm ../InteractiveController ../momentum/PanPlanarMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../../utils/navigationUtils ../../../webgl-engine/lib/Camera ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A,C,E,B,D,F,K,L){const G=w.fromValues(0,0,1);var O=16/180*Math.PI;b.PinchAndPanController=class extends z.InteractiveController{constructor(){super(...arguments);this._rotationValueSmooth=new u.ExponentialFalloff(.05);this._scalingValueSmooth=new u.ExponentialFalloff(.05);this._planeHorizontal=x.create();this._planeVertical=x.create();this._rotationMomentumEstimator=new K.RotationMomentumEstimator;this._panMomentumEstimator=new F.PanPlanarMomentumEstimator(300,
12,.9);this._zoomMomentumEstimator=new L.ZoomMomentumEstimator;this._beginRadius=0;this._beginCenter=w.create();this._beginAngle=0;this._tmpPoints=[];this._panMode=B.NavigationMode.Horizontal;this._beginCenterScreen=d.createScreenPointArray();this._tmpCentroid3d=w.create();this._tmpCentroid2d=d.createScreenPointArray();this._tmp2d=d.createScreenPointArray();this._pointerCount=0;this._constraintOptions={selection:h.ConstraintTypes.ALL,interactionType:t.InteractionType.NONE,interactionFactor:0,interactionStartCamera:new D.Camera,
interactionDirection:null,tiltMode:r.TiltMode.TUMBLE}}begin(P){if(this.active){var J=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=J;this._rotationMomentumEstimator.enabled=J;this._panMomentumEstimator.enabled=J;this._beginRadius=P.radius;this._pointerCount=P.pointers.size;this._beginAngle=P.angle;this._rotationValueSmooth.reset();this._scalingValueSmooth.reset();d.screenPointObjectToArray(P.center,this._beginCenterScreen);x.fromNormalAndOffset(G,0,this._planeHorizontal);
var R=w.create();J=this._intersectionHelper.intersectScreenFreePointFallback(this._beginCenterScreen,R,0===this.view.map.ground.opacity?B.contentIntersectorOptions:{});var X=w.create();l.negate(X,this.startCamera.viewForward);var U=w.create();l.copy(U,G);var M=l.dot(X,U);this._panMode=c.asinClamped(0>M?-M:M)>=O?B.NavigationMode.Horizontal:B.NavigationMode.Vertical;var V=Math.min(B.panDistanceModifier,1/Math.abs(l.dot(U,this.startCamera.viewForward)))*Math.max(Math.abs(this.view.camera.position.z),
B.minHeightLimit);x.setOffsetFromPoint(this._planeHorizontal,this._planeHorizontal,R);this.startCamera.aboveGround||x.negate(this._planeHorizontal,this._planeHorizontal);var Y=w.create(),W=w.create(),H=w.create();l.subtract(Y,R,this.currentCamera.eye);var S=l.length(Y);l.normalize(Y,Y);this._panMode===B.NavigationMode.Vertical?(l.scale(U,U,M),l.subtract(this._planeVertical,X,U),l.normalize(this._planeVertical,this._planeVertical),x.setOffsetFromPoint(this._planeVertical,this._planeVertical,R),R=this.view._stage.renderView.getMinimalDepthForArea(y.getVoxelWasm(this.view),
this._beginCenterScreen[0],this._beginCenterScreen[1],this.view.state.camera,B.screenPixelArea),V=null!=R?R:V,V=J?Math.min(V,S):V,l.copy(H,l.add(W,this.currentCamera.eye,l.scale(W,Y,V))),this._planeVertical[3]=-l.dot(this._planeVertical,H),this._computePlanePoints(P.pointers,this._planeVertical,this.startCamera,this._tmpPoints)):(l.copy(H,l.add(W,this.currentCamera.eye,l.scale(W,Y,J?S:V))),this._planeHorizontal[3]=-l.dot(x.normal(this._planeHorizontal),H),this._computePlanePoints(P.pointers,this._planeHorizontal,
this.startCamera,this._tmpPoints));B.centroid(this._tmpPoints,this._beginCenter);this._constraintOptions.interactionStartCamera?.copyFrom(this.startCamera)}}update(P){if(this.active){this.currentCamera.copyFrom(this.startCamera);var J=1<P.pointers.size,R=this._panMode===B.NavigationMode.Horizontal?this._planeHorizontal:this._planeVertical,X=this._beginCenter;if(J){var U=this._beginRadius/P.radius;this._scalingValueSmooth.gain=.001875*Math.min(Math.max(P.radius,40),120);this._scalingValueSmooth.update(U);
B.applyZoomToPoint(this.currentCamera,X,this._scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance);this._zoomMomentumEstimator.add(this._scalingValueSmooth.value,.001*P.timestamp);this._constraintOptions.interactionType=t.InteractionType.ZOOM;this._constraintOptions.interactionFactor=p.pixelDistanceToInteractionFactor(Math.abs(P.radius-this._beginRadius));p.applyAll(this.view,this.currentCamera,this._constraintOptions)}this._computePlanePoints(P.pointers,R,this.currentCamera,this._tmpPoints);
B.centroid(this._tmpPoints,this._tmpCentroid3d);d.screenPointObjectToArray(P.center,this._tmpCentroid2d);B.applyPanPlanar(this.currentCamera,X,this._tmpCentroid3d);this._panMomentumEstimator.add(this._tmpCentroid2d,this._tmpCentroid3d,.001*P.timestamp);this._constraintOptions.interactionType=t.InteractionType.PAN;this._constraintOptions.interactionFactor=p.pixelDistanceToInteractionFactor(m.distance(this._beginCenterScreen,this._tmpCentroid2d));p.applyAll(this.view,this.currentCamera,this._constraintOptions);
J&&(J=this._planeHorizontal,R=this._rotationValueSmooth.value,U=B.normalizeRotationDelta(P.angle-R),this._rotationValueSmooth.gain=.00125*Math.min(Math.max(P.radius,40),120),this._rotationValueSmooth.update(R+U),R=this._rotationValueSmooth.value-this._beginAngle,this._rotationMomentumEstimator.add(R,.001*P.timestamp),B.applyRotation(this.currentCamera,X,v.wrapAxisAngle(J,R)),this._constraintOptions.interactionType=t.InteractionType.TUMBLE,this._constraintOptions.interactionFactor=p.pixelDistanceToInteractionFactor(Math.abs(P.radius*
R)),p.applyAll(this.view,this.currentCamera,this._constraintOptions));this.commitCamera()}}end(P){P.pointers.size===this._pointerCount&&this.update(P);this.finishController();return(P=this._zoomMomentumEstimator.evaluateMomentum())?new E.ZoomPlanarMomentumController({view:this.view,momentum:P,zoomCenter:this._beginCenter}):(P=this._rotationMomentumEstimator.evaluateMomentum())?new C.RotationMomentumController({view:this.view,momentum:P,center:this._beginCenter,axis:x.normal(this._planeHorizontal)}):
(P=this._panMomentumEstimator.evaluateMomentum())?new A.PanPlanarMomentumController({view:this.view,momentum:P}):null}_computePlanePoints(P,J,R,X){X.length=P.size;const U=this._tmp2d;let M=0;P.forEach(V=>{U[0]=V.x;U[1]=V.y;void 0===X[M]&&(X[M]=w.create());B.intersectPlaneFromScreenPointAtEye(J,R,U,X[M]);M+=1});return X}get _intersectionHelper(){return this.view.sceneIntersectionHelper}};b.PinchAndPanController=a.__decorate([e.subclass("esri.views.3d.state.controllers.local.PinchAndPanController")],
b.PinchAndPanController);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/PointerDownCancelAnimation":function(){define(["exports","../../../input/InputHandler"],function(b,a){class c extends a.InputHandler{constructor(d,f){super(!0);this.view=d;this.registerIncoming("pointer-down",f,()=>this.view.state.stopActiveCameraController())}}b.PointerDownCancelAnimation=c;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/SingleKeyResetHeading":function(){define(["exports",
"./SingleKey"],function(b,a){class c extends a.SingleKey{constructor(d,f,n){super(f,n);this.view=d}activate(){this.view.goTo({heading:0}).catch(()=>{})}}b.SingleKeyResetHeading=c;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/SingleKey":function(){define(["exports","../../../input/InputHandler"],function(b,a){class c extends a.InputHandler{constructor(d,f){super(!0);this.key=d;this.registerIncoming("key-down",f,n=>this._handleKeyDown(n))}_handleKeyDown(d){d.data.key===
this.key&&(this.activate(),d.stopPropagation())}}b.SingleKey=c;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/SingleKeyResetTilt":function(){define(["exports","./SingleKey"],function(b,a){class c extends a.SingleKey{constructor(d,f,n){super(f,n);this.view=d}activate(){this.view.goTo({tilt:0}).catch(()=>{})}}b.SingleKeyResetTilt=c;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/TwoFingerTilt":function(){define(["exports",
"../../../../core/screenUtils","../../state/controllers/RotateController","../../../input/InputHandler"],function(b,a,c,d){class f extends d.InputHandler{constructor(n,k=!1){super(!0);this._view=n;this._invert=k;this.registerIncoming("vertical-two-finger-drag",g=>this._handleTwoFinger(g))}_handleTwoFinger(n){const k=a.createScreenPointArray(0,n.data.delta*(this._invert?-1:1));switch(n.data.action){case "begin":this._cameraController?.end();this._cameraController=new c.RotateController({view:this._view,
pivot:c.PivotPoint.CENTER});this._view.state.switchCameraController(this._cameraController);this._cameraController.begin(k);break;case "update":this._cameraController?.update(k);break;case "end":this._cameraController?.end(),this._cameraController=null}}}b.TwoFingerTilt=f;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/BrowserEventSource":function(){define("exports ../../core/has ../../core/maybe ./keys ./gamepad/GamepadSource ../support/screenUtils".split(" "),function(b,
a,c,d,f,n){const k=a("edge"),g=a("chrome"),q=a("ff"),e=a("safari");class m{constructor(w,v){this._input=v;this._active={};this._callback=()=>{};this._activePointerCaptures=new Set;this._keyDownState=new Set;this._eventId=1;this._browserTouchPanningEnabled=!1;this._element=w;w.getAttribute("tabindex")||w.setAttribute("tabindex","0");this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,
"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost};this._updateTouchAction();this._element.addEventListener("keydown",this._preventAltKeyDefault);this._gamepadSource=new f.GamepadSource(w,this._input);this._gamepadSource.onEvent=x=>this._callback("gamepad",x)}destroy(){this._callback=()=>{};this.activeEvents=null;this._activePointerCaptures.forEach(w=>
{this._releasePointerCaptureSafe(w)});this._gamepadSource=c.destroyMaybe(this._gamepadSource);this._activePointerCaptures=null;this._removeTouchAction();this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(w){this._browserTouchPanningEnabled=w;this._updateTouchAction();this._updateTouchEventHandling()}set onEventReceived(w){this._callback=w}set activeEvents(w){for(const v in this._active)w&&
w.has(v)||(this._element.removeEventListener(l[v],this._active[v]),delete this._active[v]);w&&w.forEach(v=>{if(!this._active[v]&&l[v]){const x=(this._eventHandlers[v]||this._handleDefault).bind(this,v);this._element.addEventListener(l[v],x);this._active[v]=x}});this._gamepadSource.hasEventListeners=w?.has("gamepad")??!1}setPointerCapture(w,v){v?this._setPointerCatpureSafe(w.pointerId):(this._releasePointerCaptureSafe(w.pointerId),this._activePointerCaptures.delete(w.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?
"esri-view-surface--touch-none":"esri-view-surface--touch-pan");this._element.classList.add(this._browserTouchPanningEnabled?"esri-view-surface--touch-pan":"esri-view-surface--touch-none")}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove("esri-view-surface--touch-none");this._element.classList.remove("esri-view-surface--touch-pan");
this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_setPointerCatpureSafe(w){try{this._element.setPointerCapture(w),this._activePointerCaptures.add(w)}catch{}}_releasePointerCaptureSafe(w){try{this._element.hasPointerCapture&&!this._element.hasPointerCapture(w)||this._element.releasePointerCapture(w)}catch(v){}}_updateNormalizedPointerLikeEvent(w,v){w=n.createScreenPointFromNativeEvent(this._element,w);m.test.disableSubpixelCoordinates&&(w.x=Math.round(w.x),w.y=Math.round(w.y));
v.x=w.x;v.y=w.y;return v}_handleKey(w,v){const x=d.eventKey(v);x&&"key-up"===w&&this._keyDownState.delete(x);v={native:v,key:x,repeat:!!x&&this._keyDownState.has(x)};x&&"key-down"===w&&this._keyDownState.add(v.key);this._callback(w,v)}_handlePointer(w,v){v=this._updateNormalizedPointerLikeEvent(v,{native:v,x:0,y:0,pointerType:v.pointerType,button:v.button,buttons:v.buttons,eventId:this._eventId++});this._callback(w,v)}_handlePointerPreventDefault(w,v){const x=this._updateNormalizedPointerLikeEvent(v,
{native:v,x:0,y:0,pointerType:v.pointerType,button:v.button,buttons:v.buttons,eventId:this._eventId++});v.preventDefault();this._callback(w,x)}_handleMouseWheel(w,v){let x=v.deltaY;switch(v.deltaMode){case 0:k&&(x=x/document.documentElement.clientHeight*600);break;case 1:x*=30;break;case 2:x*=900}k?x*=.7:g||e?x*=.6:q&&(x*=1.375);const p=Math.abs(x);100<p&&(x=x/p*200/(1+Math.exp(-.02*(p-100))));v=this._updateNormalizedPointerLikeEvent(v,{native:v,x:0,y:0,deltaY:x});this._callback(w,v)}_handlePointerCaptureLost(w,
v){this._activePointerCaptures.delete(v.pointerId);this._handleDefault(w,v)}_handleDefault(w,v){const x={native:v};v.preventDefault();this._callback(w,x)}_preventAltKeyDefault(w){"Alt"===w.key&&w.preventDefault()}_preventMultiTouchPanning(w){1<w.touches.length&&w.preventDefault()}}m.test={disableSubpixelCoordinates:!1};const l={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture",
"pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};b.BrowserEventSource=m;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/gamepad/GamepadSource":function(){define(["exports","../../../core/scheduling","./GamepadInputDevice","./GamepadState"],function(b,a,c,d){class f{constructor(n,k){this._element=n;this._input=k;this._hasEventListeners=
!1;this._onConnectGamepad=g=>{this._connectGamepad(g.gamepad)};this._onDisconnectGamepad=g=>{g=g.gamepad;const q=g.index,e=this._inputDevices[q];e&&(this._emitGamepadEvent(g,d.extractState(e),!1),this._inputDevices.splice(q,1),this._latestUpdate.splice(q,1),this._input.gamepad.devices.remove(e),this.ensurePollingState())};this._frameTask=null;this._latestUpdate=[];this._inputDevices=[];this._callback=null;n=window.isSecureContext;if(this.supported="getGamepads"in window.navigator&&n)this._forEachGamepad(g=>
this._connectGamepad(g)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState()}destroy(){this.hasEventListeners=!1;this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(n){this._hasEventListeners!==n&&(this._hasEventListeners=n,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&
0<this._inputDevices.length&&this._hasEventListeners}set onEvent(n){this._callback=n}_connectGamepad(n){const k=new c(n);"unknown"!==k.deviceType&&(this._inputDevices[n.index]=k,this._input.gamepad.devices.add(k));this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){null==this._frameTask&&(this._frameTask=a.addFrameTask({update:()=>this._readGamepadState()}))}_stopPolling(){null!=this._frameTask&&(this._frameTask.remove(),this._frameTask=
null,this._latestUpdate=[])}_readGamepadState(){const n=document.hasFocus(),k=this._element.contains(document.activeElement),g="document"===this._input.gamepad.enabledFocusMode&&!n||"view"===this._input.gamepad.enabledFocusMode&&!k;this._forEachGamepad(q=>{var e=this._inputDevices[q.index];if(e){var m=this._latestUpdate[q.index];e=d.extractState(e);var l=g||d.stateIdle(e);m&&(m.timestamp===q.timestamp||!m.active&&l||d.stateEqual(m.state,e))||this._emitGamepadEvent(q,e,!l)}})}_forEachGamepad(n){const k=
window.navigator.getGamepads();for(let g=0;g<k.length;g++){const q=k[g];this._validate(q)&&n(q)}}_emitGamepadEvent(n,k,g){var q=this._latestUpdate[n.index];if((q=q&&q.active)||g)this._latestUpdate[n.index]={timestamp:n.timestamp,state:k,active:g},this._callback&&this._callback({device:this._inputDevices[n.index],state:k,action:!q&&g?"start":q&&g?"update":"end"})}_validate(n){if(!n||!n.connected)return!1;for(let k=0;k<n.axes.length;k++)if(isNaN(n.axes[k]))return!1;return!0}}b.GamepadSource=f;Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/views/input/gamepad/GamepadState":function(){define(["exports"],function(b){b.extractState=function(a){const c=a.native;return c?{buttons:c.buttons.map(d=>d.pressed?d.value||1:0),axes:c.axes.map(d=>{{var f=a.axisThreshold;const n=Math.abs(d);d=n<f?0:Math.sign(d)*(n-f)/(1-f)}return d})}:{buttons:[],axes:[]}};b.stateEqual=function(a,c){if(a.axes.length!==c.axes.length||a.buttons.length!==c.buttons.length)return!1;for(var d=0;d<a.axes.length;d++)if(a.axes[d]!==
c.axes[d])return!1;for(d=0;d<a.buttons.length;d++)if(a.buttons[d]!==c.buttons[d])return!1;return!0};b.stateIdle=function(a){for(var c=0;c<a.axes.length;c++)if(0!==a.axes[c])return!1;for(c=0;c<a.buttons.length;c++)if(0!==a.buttons[c])return!1;return!0};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/handlers/PreventContextMenu":function(){define(["exports","../InputHandler"],function(b,a){class c extends a.InputHandler{constructor(){super(!0);this.registerIncoming("context-menu",
d=>{d.data.native.preventDefault()})}}b.PreventContextMenu=c;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/recognizers/Drag":function(){define(["exports","../../../core/screenUtils","../../../core/time","../InputHandler","./support"],function(b,a,c,d,f){function n(m){const l=[];m.forEach(w=>{l.push(a.createScreenPoint(w.event.x,w.event.y))});return f.fitCircleLSQ(l)}function k(m){const l=n(m);let w=0;m.forEach(v=>{var x=q(v,l);for(x-=v.lastAngle;x>Math.PI;)x-=2*
Math.PI;for(;x<-Math.PI;)x+=2*Math.PI;x=v.lastAngle+x;v.lastAngle=x;w+=x-v.initialAngle});w/=m.size||1;return{angle:w,radius:l.radius,center:l.center}}function g(m){const l=new Map;m.forEach((w,v)=>l.set(v,w.event));return l}function q(m,l){m=m.event;return Math.atan2(m.y-l.center.y,m.x-l.center.x)}class e extends d.InputHandler{constructor(m){super(!1);this._navigationTouch=m;this._startStateModifiers=new Set;this._activePointerMap=new Map;this._isCurrentDragSuppressed=this._isDragging=!1;this._drag=
this.registerOutgoing("drag");this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this));this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this));this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this));this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(m,l,w,v){return{action:m,pointerType:this._pointerType,button:this._mouseButton,buttons:l.buttons,timestamp:v,pointers:g(this._activePointerMap),
pointer:l,angle:w.angle,radius:w.radius,center:w.center}}_addPointer(m){var l=m.native.pointerId;const w=k(this._activePointerMap).angle;m={event:m,initialAngle:0,lastAngle:0};this._activePointerMap.set(l,m);l=q(m,n(this._activePointerMap));m.initialAngle=l;m.lastAngle=l;this._updatePointerAngles(w)}_updatePointer(m){if(!m||null!=m.x||null!=m.y){var l=this._activePointerMap.get(m.native.pointerId);l?l.event=m:this._addPointer(m)}}_removePointer(m){const l=k(this._activePointerMap).angle;this._activePointerMap.delete(m);
this._updatePointerAngles(l)}_updatePointerAngles(m){const l=k(this._activePointerMap);this._activePointerMap.forEach(w=>{w.initialAngle=q(w,l)-m;w.lastAngle=q(w,l)-m})}_emitEvent(m,l,w){const v=k(this._activePointerMap);this._drag.emit(this._createPayload(m,l,v,w),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(m){const l=m.data.native.pointerId,w=c.Milliseconds(m.timestamp);this._activePointerMap.get(l)&&(1===this._activePointerMap.size?(this._updatePointer(m.data),!this._isCurrentDragSuppressed&&
this._emitEvent("end",m.data,w),this._isCurrentDragSuppressed=this._isDragging=!1,this._removePointer(l)):(this._removePointer(l),this._emitEvent("removed",m.data,c.Milliseconds(m.timestamp))))}_handlePointerDrag(m){const l=m.data,w=l.currentEvent,v=c.Milliseconds(m.timestamp);switch(l.action){case "start":case "update":this._isDragging?this._activePointerMap.has(w.native.pointerId)?(this._updatePointer(w),!this._isCurrentDragSuppressed&&this._emitEvent("update",w,v)):(this._addPointer(w),this._emitEvent("added",
w,v),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(w),this._pointerType=m.data.startEvent.pointerType,this._mouseButton=m.data.startEvent.button,this._startStateModifiers=m.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",w,v))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&"touch"===this._pointerType&&1===this._activePointerMap.size}}b.Button=
void 0;(function(m){m[m.Left=0]="Left";m[m.Middle=1]="Middle";m[m.Right=2]="Right";m[m.Back=3]="Back";m[m.Forward=4]="Forward";m[m.Undefined=-1]="Undefined"})(b.Button||(b.Button={}));b.Drag=e;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/recognizers/support":function(){define(["exports","../../../core/screenUtils"],function(b,a){b.DefaultParameters={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500,maximumDoubleClickDelay:250,
maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};b.euclideanDistance=function(c,d){const f=d.x-c.x;c=d.y-c.y;return Math.sqrt(f*f+c*c)};b.fitCircleLSQ=function(c,d){d?(d.radius=0,d.center.x=0,d.center.y=0):d={radius:0,center:a.createScreenPoint()};if(0===c.length)return d;if(1===c.length)return d.center.x=c[0].x,d.center.y=c[0].y,d;if(2===c.length){const [p,h]=c,[t,r]=[h.x-p.x,h.y-p.y];d.radius=Math.sqrt(t*t+r*r)/2;d.center.x=(p.x+h.x)/2;d.center.y=(p.y+h.y)/
2;return d}let f=0,n=0;for(d=0;d<c.length;d++)f+=c[d].x,n+=c[d].y;f/=c.length;n/=c.length;var k=c.map(p=>p.x-f),g=c.map(p=>p.y-n);let q=d=0;var e=0,m=0,l=0,w=0,v=0;for(var x=0;x<k.length;x++){const p=k[x],h=g[x],t=p*p,r=h*h;d+=t;q+=r;e+=p*h;m+=t*p;l+=r*h;w+=p*r;v+=h*t}k=d;g=e;x=q;m=.5*(m+w);l=.5*(l+v);v=k*x-e*g;w=(m*x-l*g)/v;l=(k*l-e*m)/v;v=a.createScreenPoint(w+f,l+n);return{radius:Math.sqrt(w*w+l*l+(d+q)/c.length),center:v}};b.getPointerId=function(c){({native:c}=c);const {pointerId:d,button:f,
pointerType:n}=c;return"mouse"===n?`${d}:${f}`:`${n}`};b.manhattanDistance=function(c,d){return Math.abs(d.x-c.x)+Math.abs(d.y-c.y)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/recognizers/ImmediateDoubleClick":function(){define(["exports","../../../core/clock","../InputHandler","./support"],function(b,a,c,d){class f extends c.InputHandler{constructor(n=d.DefaultParameters.maximumDoubleClickDelay,k=d.DefaultParameters.maximumDoubleClickDistance,g=d.DefaultParameters.maximumDoubleTouchDelay,
q=d.DefaultParameters.maximumDoubleTouchDistance,e=a.clock){super(!1);this._maximumDoubleClickDelay=n;this._maximumDoubleClickDistance=k;this._maximumDoubleTouchDelay=g;this._maximumDoubleTouchDistance=q;this._clock=e;this._pointerState=new Map;this._immediateDoubleClick=this.registerOutgoing("immediate-double-click");this.registerIncoming("pointer-down",this._handlePointerDown.bind(this));this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach(n=>
{n.immediateDoubleClick&&n.immediateDoubleClick.timeoutHandle.remove()});super.onUninstall()}_handlePointerDown(n){n=n.data;const k=d.getPointerId(n);this._pointerState.has(k)||(this._pointerState.set(k,{downButton:n.native.button,x:n.x,y:n.y,immediateDoubleClick:null}),this.startCapturingPointer(n.native))}_handlePointerUp(n){const k=n.data;var g=d.getPointerId(k);if((g=this._pointerState.get(g))&&g.downButton===k.native.button){const q=g.immediateDoubleClick,e="touch"===n.data.native.pointerType?
this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;q?(q.timeoutHandle.remove(),d.manhattanDistance(q,n.data)>e?this._startImmediateDoubleClick(n,g):(this._immediateDoubleClick.emit(n.data,void 0,q.modifiers),this._removeState(k))):d.manhattanDistance(g,n.data)>e?this._removeState(k):this._startImmediateDoubleClick(n,g)}}_startImmediateDoubleClick(n,k){k.immediateDoubleClick={x:n.data.x,y:n.data.y,modifiers:n.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(n.data),
"touch"===n.data.native.pointerType?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay)}}_removeState(n){const k=d.getPointerId(n);this._pointerState.delete(k);this.stopCapturingPointer(n.native);this.refreshHasPendingInputs()}}b.ImmediateDoubleClick=f;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/recognizers/PointerClickHoldAndDrag":function(){define(["exports","../../../core/clock","../../../core/maybe","../InputHandler","./support"],function(b,a,c,d,
f){class n extends d.InputHandler{constructor(k=f.DefaultParameters.maximumClickDelay,g=f.DefaultParameters.movementUntilMouseDrag,q=f.DefaultParameters.movementUntilPenDrag,e=f.DefaultParameters.movementUntilTouchDrag,m=f.DefaultParameters.holdDelay,l=a.clock){super(!1);this._maximumClickDelay=k;this._movementUntilMouseDrag=g;this._movementUntilPenDrag=q;this._movementUntilTouchDrag=e;this._holdDelay=m;this._clock=l;this._pointerState=new Map;this._pointerDrag=this.registerOutgoing("pointer-drag");
this._immediateClick=this.registerOutgoing("immediate-click");this._pointerHold=this.registerOutgoing("hold");this.registerIncoming("pointer-down",this._handlePointerDown.bind(this));this.registerIncoming("pointer-up",w=>{this._handlePointerLoss(w,"pointer-up")});this.registerIncoming("pointer-capture-lost",w=>{this._handlePointerLoss(w,"pointer-capture-lost")});this.registerIncoming("pointer-cancel",w=>{this._handlePointerLoss(w,"pointer-cancel")});this._moveHandle=this.registerIncoming("pointer-move",
this._handlePointerMove.bind(this));this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(k=>{k.holdTimeout=c.removeMaybe(k.holdTimeout)});super.onUninstall()}_handlePointerDown(k){const g=k.data,q=g.native.pointerId;var e=null;0===this._pointerState.size&&(e=this._clock.setTimeout(()=>{const m=this._pointerState.get(q);m&&(m.isDragging||(this._pointerHold.emit(m.previousEvent,void 0,k.modifiers),m.holdEmitted=!0),m.holdTimeout=null)},this._holdDelay));e={startEvent:g,previousEvent:g,
startTimestamp:k.timestamp,isDragging:!1,downButton:g.native.button,holdTimeout:e,modifiers:new Set};this._pointerState.set(q,e);this.startCapturingPointer(g.native);this._moveHandle.resume();1<this._pointerState.size&&this._startDragging(k)}_createPointerDragData(k,g,q){return{action:k,startEvent:g.startEvent,previousEvent:g.previousEvent,currentEvent:q}}_handlePointerMove(k){const g=k.data,q=this._pointerState.get(g.native.pointerId);if(q){if(q.isDragging)this._pointerDrag.emit(this._createPointerDragData("update",
q,g),void 0,q.modifiers);else{const e=f.euclideanDistance(g,q.startEvent),m=this._getDragThreshold(g.native.pointerType);e>m&&this._startDragging(k)}q.previousEvent=g}}_getDragThreshold(k){switch(k){case "touch":return this._movementUntilTouchDrag;case "pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}_startDragging(k){const g=k.data,q=g.native.pointerId;this._pointerState.forEach(e=>{null!=e.holdTimeout&&(e.holdTimeout.remove(),e.holdTimeout=null);e.isDragging||
(e.modifiers=k.modifiers,e.isDragging=!0,q===e.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",e,g)):this._pointerDrag.emit(this._createPointerDragData("start",e,e.previousEvent),k.timestamp))})}_handlePointerLoss(k,g){const q=k.data,e=q.native.pointerId,m=this._pointerState.get(e);m&&(null!=m.holdTimeout&&(m.holdTimeout.remove(),m.holdTimeout=null),m.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",m,"pointer-up"===g?q:m.previousEvent),void 0,
m.modifiers):"pointer-up"===g&&m.downButton===q.native.button&&k.timestamp-m.startTimestamp<=this._maximumClickDelay&&!m.holdEmitted&&this._immediateClick.emit(q),this._pointerState.delete(e),this.stopCapturingPointer(q.native),0===this._pointerState.size&&this._moveHandle.pause())}}b.PointerClickHoldAndDrag=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/recognizers/SingleAndDoubleClick":function(){define("exports ../../../core/clock ../../../core/MapUtils ../../../core/maybe ../InputHandler ./support".split(" "),
function(b,a,c,d,f,n){class k extends f.InputHandler{constructor(g=n.DefaultParameters.maximumDoubleClickDelay,q=n.DefaultParameters.maximumDoubleClickDistance,e=n.DefaultParameters.maximumDoubleTouchDelay,m=n.DefaultParameters.maximumDoubleTouchDistance,l=a.clock){super(!1);this._maximumDoubleClickDelay=g;this._maximumDoubleClickDistance=q;this._maximumDoubleTouchDelay=e;this._maximumDoubleTouchDistance=m;this._clock=l;this._pointerState=new Map;this._click=this.registerOutgoing("click");this._doubleClick=
this.registerOutgoing("double-click");this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this));this.registerIncoming("pointer-down",this._handlePointerDown.bind(this))}onUninstall(){this._pointerState.forEach(g=>g.doubleClickTimer=d.removeMaybe(g.doubleClickTimer))}get hasPendingInputs(){return c.someMap(this._pointerState,g=>null!=g.doubleClickTimer)}_clearDoubleClickTimer(g,q){const e=this._pointerState.get(g);e&&(e.doubleClickTimer=d.removeMaybe(e.doubleClickTimer),q&&this._click.emit(e.event.data,
void 0,e.event.modifiers),this._pointerState.delete(g),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(g){const q=this._pointerState.get(g);1===q.pointerDownCount&&this._click.emit(q.event.data,void 0,q.event.modifiers);q.doubleClickTimer=null;this._pointerState.delete(g);this.refreshHasPendingInputs()}_getPointerId(g){const {pointerId:q,pointerType:e,button:m}=g.native;return"mouse"===e?`${q}:${m}`:`${e}`}_handleImmediateClick(g){const q=g.data;var {pointerType:e}=q.native;const m=this._getPointerId(q);
if(this._pointerState.has(m)){var l=this._pointerState.get(m),{data:w,modifiers:v}=l.event;e="touch"===e?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;n.manhattanDistance(w,q)>e?(this._clearDoubleClickTimer(m,!0),this._startClick(g)):(this._clearDoubleClickTimer(m,!1),2===l.pointerDownCount&&this._doubleClick.emit(w,void 0,v))}else this._startClick(g)}_handlePointerDown(g){g=n.getPointerId(g.data);if(g=this._pointerState.get(g))g.pointerDownCount+=1}_startClick(g){var {data:q}=
g;const {native:{pointerType:e}}=q,m=n.getPointerId(q);q=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(m),"touch"===e?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay);this._pointerState.set(m,{event:g,doubleClickTimer:q,pointerDownCount:1});this.refreshHasPendingInputs()}}b.SingleAndDoubleClick=k;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/recognizers/VerticalTwoFingerDrag":function(){define(["exports","../DragEventSeparator","../InputHandler"],
function(b,a,c){class d extends c.InputHandler{constructor(f=20,n=40){super(!1);this._threshold=f;this._maxDelta=n;this._state="ready";this._emittedArtificalEnd2=!1;this._vertical=this.registerOutgoing("vertical-two-finger-drag");this._artificalDrag=this.registerOutgoing("drag");this._dragEventSeparator=new a.DragEventSeparator({start:(k,g)=>this._observeStart(k,g),update:(k,g,q)=>this._observeUpdate(k,g,q),end:(k,g)=>this._observeEnd(g)});this.registerIncoming("drag",k=>this._dragEventSeparator.handle(k))}get failed(){return"failed"===
this._state}_observeStart(f,n){1===f&&this._emittedArtificalEnd2&&(this._emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:n.data.button,buttons:n.data.buttons,pointerType:n.data.pointerType,timestamp:n.data.timestamp,pointers:n.data.pointers,pointer:n.data.pointer,angle:n.data.angle,radius:n.data.radius,center:n.data.center}),n.stopPropagation());this._state=2===f?"ready":"failed"}_observeUpdate(f,n,k){"failed"!==this._state&&2===f&&("active"===this._state?(this._vertical.emit({delta:n.data.center.y-
this._thresholdReachedCenter.y,action:"update"}),n.stopPropagation()):this._checkMovementWithinLimits(n.data,k.data)?this._checkVerticalThresholdReached(n.data,k.data)&&(this._state="active",this._emittedArtificalEnd2=!0,this._thresholdReachedCenter=n.data.center,this._artificalDrag.emit({action:"end",button:n.data.button,buttons:n.data.buttons,pointerType:n.data.pointerType,timestamp:n.data.timestamp,pointers:n.data.pointers,pointer:n.data.pointer,angle:n.data.angle,radius:n.data.radius,center:n.data.center}),
this._vertical.emit({delta:n.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),n.stopPropagation()):this._state="failed")}_observeEnd(f){"active"===this._state&&(this._vertical.emit({delta:f.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this._state="ready",f.stopPropagation())}_checkMovementWithinLimits(f,n){let k=-Infinity,g=Infinity,q=-Infinity,e=Infinity;for(const {x,y:p}of n.pointers.values())k=Math.max(k,x),g=Math.min(g,x),q=Math.max(q,p),e=Math.min(e,p);let m=-Infinity,
l=Infinity,w=-Infinity,v=Infinity;for(const {x,y:p}of f.pointers.values())m=Math.max(m,x),l=Math.min(l,x),w=Math.max(w,p),v=Math.min(v,p);return Math.abs(f.center.x-n.center.x)<this._threshold&&Math.abs(m-l-(k-g))<=this._maxDelta&&Math.abs(w-v-(q-e))<=this._maxDelta}_checkVerticalThresholdReached(f,n){let k=Math.abs(f.center.y-n.center.y);f.pointers.forEach((g,q)=>{q=n.pointers.get(q);k=Math.min(k,Math.abs(g.y-q.y))});return k>=this._threshold}}b.VerticalTwoFingerDrag=d;Object.defineProperty(b,Symbol.toStringTag,
{value:"Module"})})},"esri/views/input/DragEventSeparator":function(){define(["exports"],function(b){class a{constructor(c){this._callbacks=c;this._currentCount=0;this._callbacks.condition||(this._callbacks.condition=()=>!0)}handle(c){const d=c.data,f=d.pointers.size;switch(d.action){case "start":this._currentCount=f;this._emitStart(c);break;case "added":this._emitEnd(this._previousEvent);this._currentCount=f;this._emitStart(c);break;case "update":this._emitUpdate(c);break;case "removed":this._startEvent&&
this._emitEnd(this._previousEvent);this._currentCount=f;this._emitStart(c);break;case "end":this._emitEnd(c),this._currentCount=0}this._previousEvent=c}_emitStart(c){this._startEvent=c;this._callbacks.condition?.(this._currentCount,c)&&this._callbacks.start(this._currentCount,c,this._startEvent)}_emitUpdate(c){this._callbacks.condition?.(this._currentCount,c)&&this._callbacks.update(this._currentCount,c,this._startEvent)}_emitEnd(c){this._callbacks.condition?.(this._currentCount,c)&&this._callbacks.end(this._currentCount,
c,this._startEvent);this._startEvent=null}}b.DragEventSeparator=a;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/GraphicsDeconflictor":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/MapUtils ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/Error ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/boundedPlane ./Deconflictor ./enums ./LabelDeconflictor ../../../support/Scheduler".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p){function h(r){r=r.layer;return!(!r?.featureReduction||"selection"!==r.featureReduction.type)}function t(r){(r=r.graphics3DGraphics)&&r.forEach(u=>u.setVisibilityFlag(v.VisibilityGroup.GRAPHIC,v.VisibilityFlag.DECONFLICTION,!0))}b.GraphicsDeconflictor=class extends w.Deconflictor{constructor(){super(...arguments);this._contexts=new Map;this._viewState=new w.DeconflictorViewState;this.visibilityGroup=v.VisibilityGroup.GRAPHIC;this._marginFactor=-.1}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this.addHandles([f.watch(()=>
this.view?.state?.camera,()=>{this._updateViewState();this.setDirty()}),f.watch(()=>this.view?.map?.ground?.opacity,(r,u)=>{1!==r&&1!==u||this.setDirty()}),f.watch(()=>this.view?.slicePlane,()=>{this._updateSlicePlane();this._slicePlaneChanged()},f.initial)]);this._frameTask=this.view.resourceController.scheduler.registerTask(p.TaskPriority.GRAPHICS_DECONFLICTOR,this);this._labels=new x.LabelDeconflictor({view:this.view,parent:this})}destroy(){this._labels=d.destroyMaybe(this._labels);this._frameTask=
d.removeMaybe(this._frameTask)}get marginFactor(){return this._marginFactor}set marginFactor(r){this._marginFactor=r;this.setDirty()}setDirty(){0<this._contexts.size&&(super.setDirty(),this._labels.setDirty())}runTask(r){super.runTask(r);this.running||this._labels.setDirty()}setInitialIconVisibilityFlag(r,u){r=!(this._graphicSupportsDeconfliction(u)&&h(r));u.setVisibilityFlag(v.VisibilityGroup.GRAPHIC,v.VisibilityFlag.DECONFLICTION,r)}_updateViewState(){this.view?.state&&(this._viewState.camera.copyFrom(this.view.state.camera),
this._updateSlicePlane())}_updateSlicePlane(){const r=this.view?this.view.slicePlane:null;null!=r&&l.transform(r,this._viewState.camera.viewMatrix,this._viewState.slicePlane);this._viewState.slicePlaneEnabled=null!=r}_slicePlaneChanged(){c.someMap(this._contexts,(r,u)=>u.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()}addGraphicsOwner(r){const u=this._getGraphicsContext(r);return{addGraphic:y=>this._addGraphic(r,u,y),removeGraphic:y=>this._removeGraphic(u,y),labelingInfoChange:()=>this._labels.enabledChanged(r,
u),featureReductionChange:()=>this.enabledChanged(r,u),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(r,u),clear:()=>u.forEach(y=>this._removeGraphic(u,y.graphics3DGraphic))}}removeGraphicsOwner(r){const u=this._contexts.get(r);u&&(u.forEach(y=>this._removeGraphic(u,y.graphics3DGraphic)),this._contexts.delete(r),this.setDirty())}_addGraphic(r,u,y){const z=y.graphic.uid;y=new w.DeconflictorGraphic(y,r.symbolCreationContext.slicePlaneEnabled);u.set(z,y);h(r)&&this.addToActiveGraphics(y);
r.labelsEnabled&&this._labels.addToActiveGraphics(y)}_removeGraphic(r,u){u=u.graphic.uid;const y=r.get(u);y&&(this.removeFromActiveGraphics(y),this._labels.removeFromActiveGraphics(y),r.delete(u),this.setDirty())}enabledChanged(r,u){const y=h(r);y||t(r);this.modifyGraphics(u,y)}_slicePlaneEnabledChanged(r,u){const y=r.symbolCreationContext.slicePlaneEnabled;u.forEach(z=>z.slicePlaneEnabled=y);this.setDirty()}getGraphicsLayers(r){return r.layers}_graphicSupportsDeconfliction(r){if(r.isDraped)return!1;
r=r.layers;if(!r?.length)return!1;for(const u of r)if(this.layerSupportsDeconfliction(u))return!0;return!1}_getGraphicsContext(r){var u=this._contexts.get(r);if(u)return u;u=new Map;this._contexts.set(r,u);this.setDirty();return u}};b.GraphicsDeconflictor=a.__decorate([m.subclass("esri.views.3d.layers.graphics.GraphicsDeconflictor")],b.GraphicsDeconflictor);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Deconflictor":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/mathUtils ../../../../core/PooledArray ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/ellipsoidUtils ../../../../geometry/support/aaBoundingRect ../../../../chunks/boundedPlane ../../../../geometry/support/ray ../../../../chunks/sphere ./deconflictorDebug ./enums ../../webgl-engine/lib/Camera ../../webgl-engine/lib/screenSizePerspectiveUtils ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/HUDMaterial ../../webgl-engine/materials/ScaleInfo".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A,C,E,B,D,F,K){function*L(Z){if(Map.prototype.entries){Z=Z.entries();for(let da=Z.next();!da.done;da=Z.next())yield da.value[1]}else yield*Z.values()}function*G(Z,da,fa){da.clear();Z.forEach((ha,ba)=>{const ea=da.pushNew();ea.id=ba;ea.visible=ha.graphics3DGraphic.getVisibilityFlag(fa,C.VisibilityFlag.DECONFLICTION);ba=ha.info?.[fa];ea.prio=ha.graphics3DGraphic.deconflictionPriority;ea.distance=ba?ba.distance:Number.MAX_VALUE});yield;const ka=da.iterableSort((ha,
ba)=>ha.prio!==ba.prio?ba.prio-ha.prio:ha.distance!==ba.distance?ha.distance-ba.distance:ha.visible!==ba.visible?ha.visible?-1:1:ha.id-ba.id);for(let ha=ka.next();!ha.done;ha=ka.next())yield;da.forAll(ha=>{const ba=Z.get(ha.id);ba&&(Z.delete(ha.id),Z.set(ha.id,ba))});da.clear()}const O=x.create(),P=h.create(),J=h.create(),R=x.create(),X=l.create(),U=z.create(),M=y.create(),V=x.create(),Y=r.create();class W{constructor(){this.aabr=r.create();this.distance=0;this.visible=this.culled=!1}}class H{constructor(Z,
da){this.graphics3DGraphic=Z;this.slicePlaneEnabled=da;this.info={}}}b.State=void 0;(function(Z){Z[Z.Idle=0]="Idle";Z[Z.Process=1]="Process";Z[Z.Sort=2]="Sort";Z[Z.Deconflict=3]="Deconflict";Z[Z.NumStates=4]="NumStates"})(b.State||(b.State={}));class S{constructor(){this.camera=new E.Camera;this.slicePlane=u.create();this.slicePlaneEnabled=!1}copyFrom(Z){this.camera.copyFrom(Z.camera);u.copy(Z.slicePlane,this.slicePlane);this.slicePlaneEnabled=Z.slicePlaneEnabled}}b.Deconflictor=class extends c{get dirty(){return this._dirty}get state(){return this._state}constructor(Z){super(Z);
this._dirty=!1;this._runningViewState=new S;this._state=b.State.Idle;this._active=new Map;this._visible=new Map;this._iterators=new Q;this._accBinsNumX=15;this._accBinsNumY=20;this._accBinsSizeY=this._accBinsSizeX=0;this._accBins=null;this.accNumTests=0}destroy(){this._active.clear();this._visible.clear();this._iterators=null}setDirty(){!this._dirty&&0<this._active.size&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==b.State.Idle||this._dirty}get updatingProgress(){if(!this.updating)return 1;
const Z=this._state/b.State.NumStates;return this._dirty?.5*Z:Z}get running(){return this.view.ready&&null!=this.view.state&&this.updating}runTask(Z){switch(this._state){case b.State.Idle:this._startUpdate(),Z.madeProgress();case b.State.Process:if(this._state=b.State.Process,!this._processActiveGraphics(Z))break;case b.State.Sort:if(this._state=b.State.Sort,!this._sortVisibleGraphics(Z))break;case b.State.Deconflict:if(this._state=b.State.Deconflict,!this._deconflictVisibleGraphics(Z))break;default:A.drawAccelerationStruct(this,
this._visible),this._state=b.State.Idle,this.notifyChange("updating")}}modifyGraphics(Z,da){da?Z.forEach(fa=>this.addToActiveGraphics(fa)):Z.forEach(fa=>this.removeFromActiveGraphics(fa));this.setDirty()}layerSupportsDeconfliction(Z){if(null==Z||"object3d"!==Z.type)return!1;Z=Z.stageObject;return 1===(Z?.geometries.length??0)&&Z?.geometries[0]?.material instanceof F.HUDMaterial?!0:!1}_startUpdate(){A.prepare(this.view);this._dirty=!1;this._runningViewState.copyFrom(this.viewState);const {fullWidth:Z,
fullHeight:da}=this._runningViewState.camera;this._initBins(Z,da);this._resetIterators()}addToActiveGraphics(Z){Z.info[this.visibilityGroup]=new W;this._active.set(Z.graphics3DGraphic.graphic.uid,Z);this.setDirty()}removeFromActiveGraphics(Z){this._visible.delete(Z.graphics3DGraphic.graphic.uid);const da=Z.graphics3DGraphic;da.destroyed||da.setVisibilityFlag(this.visibilityGroup,C.VisibilityFlag.DECONFLICTION,!0);delete Z.info[this.visibilityGroup];this._active.delete(Z.graphics3DGraphic.graphic.uid);
this.setDirty()}_processActiveGraphics(Z){const da=this._ensureActiveGraphicsIterator(),fa=m.invertOrIdentity(X,this._runningViewState.camera.projectionMatrix),ka="global"===this.view.viewingMode&&1===this.view.map.ground.opacity&&0<this._runningViewState.camera.relativeElevation?U:null;let ha=0;null!=ka&&(v.transformMat4(ka,x.ZEROS,this._runningViewState.camera.viewMatrix),ka[3]=t.getReferenceEllipsoid(this.view.spatialReference).radius,ha=z.distanceToSilhouette(ka,x.ZEROS));for(;!Z.done;){Z.madeProgress();
var ba=da.next();if(!0===ba.done)return this._resetActiveGraphicsIterator(),!0;ba=ba.value;const ea=ba?.info[this.visibilityGroup];ea&&(this._collectGraphics3DGraphics(ba,fa,ka,ha),ea.culled?this._visible.delete(ba.graphics3DGraphic.graphic.uid):this._visible.set(ba.graphics3DGraphic.graphic.uid,ba))}return!1}_sortVisibleGraphics(Z){const da=this._ensureSortGraphicsIterator();for(;!Z.done;){const fa=da.next();Z.madeProgress();if(!0===fa.done)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(Z){const da=
this._ensureVisibleGraphicsIterator(),fa=this.visibilityGroup===C.VisibilityGroup.LABEL;for(;!Z.done;){Z.madeProgress();var ka=da.next();if(!0===ka.done)return this._resetVisibleGraphicsIterator(),!0;ka=ka.value;const ba=ka.info[this.visibilityGroup];if(!ba||ba.culled)this._setGraphicVisibility(ka,!1);else{var ha=ka.graphics3DGraphic;ha=!fa||ha.isVisible();ba.visible=ha&&!this._isConflicted(ka);ba.visible&&this._addToBins(ka);this._setGraphicVisibility(ka,ba.visible);A.drawPoly(ba,ba.visible)}}return!1}_resetIterators(){this._iterators.active=
null;this._iterators.visible=null;this._iterators.sort=null}_ensureActiveGraphicsIterator(){this._iterators.active||(this._iterators.active=L(this._active));return this._iterators.active}_resetActiveGraphicsIterator(){this._iterators.active=null}_ensureVisibleGraphicsIterator(){this._iterators.visible||(this._iterators.visible=L(this._visible));return this._iterators.visible}_resetVisibleGraphicsIterator(){this._iterators.visible=null}_ensureSortGraphicsIterator(){this._iterators.sort||(this._iterators.sort=
G(this._visible,this._iterators.sortArray,this.visibilityGroup));return this._iterators.sort}_resetSortGraphicsIterator(){this._iterators.sort=null}_collectGraphics3DGraphics(Z,da,fa,ka){var ha=Z.graphics3DGraphic;if(!ha.destroyed){var ba=Z.info[this.visibilityGroup];if(ha.isVisible(C.VisibilityGroup.GRAPHIC,C.VisibilityFlag.DECONFLICTION)){var ea=this.getGraphicsLayers(ha);r.empty(ba.aabr);ha=null;for(const ca of ea)if(this.layerSupportsDeconfliction(ca)){ea=ca.stageObject.geometries[0].material;
if(null==ha&&(ha=aa,this._getProjectionInfo(ca,da,ha),ha.isOutsideScreen||this._isCulledBySlice(Z,O)||null!=fa&&this._isCulledByHorizon(ha,fa,ka))){ba.culled=!0;return}this._expandBoundingRect(ba,ca,ea,ha)}null==ha?ba.culled=!0:(ba.distance=ha.distance,ba.culled=!1)}else ba.culled=!0}}_getProjectionInfo(Z,da,fa){const ka=this._runningViewState.camera;Z=Z.stageObject;var ha=Z.geometries[0];const ba=ha.material;var ea=z.getCenter(Z.boundingVolumeWorldSpace.bounds);v.transformMat4(O,ea,ka.viewMatrix);
ea=ha.attributes;ha=ea.get(D.VertexAttribute.NORMAL).data;ea=ea.get(D.VertexAttribute.AUXPOS1).data;ba.applyShaderOffsetsView(O,ha,Z.transformation,ea,ka,fa.scaleInfo,O);p.set(P,O[0],O[1],O[2],1);p.transformMat4(J,P,ka.projectionMatrix);v.scale(fa.positionNDC,J,1/J[3]);ba.applyShaderOffsetsNDC(fa.positionNDC,ea,ka,fa.positionNDC,R);fa.distanceWithoutPolygonOffset=ka.depthNDCToWorld(R[2]);fa.distance=R[2]===fa.positionNDC[2]?fa.distanceWithoutPolygonOffset:ka.depthNDCToWorld(fa.positionNDC[2]);p.set(J,
fa.positionNDC[0],fa.positionNDC[1],fa.positionNDC[2],1);p.transformMat4(P,J,da);p.scale(P,P,1/P[3]);v.set(fa.positionView,O[0],O[1],O[2])}_isCulledByHorizon(Z,da,fa){v.copy(M.direction,Z.positionView);v.set(M.origin,0,0,0);return z.intersectRay(da,M,V)?Z.distanceWithoutPolygonOffset>fa:!1}_isCulledBySlice(Z,da){return Z.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&u.extrusionContainsPoint(this._runningViewState.slicePlane,da)}_expandBoundingRect(Z,da,fa,{positionNDC:ka,scaleInfo:ha}){const ba=
this._runningViewState.camera;da=da.getScreenSize(N);B.applyPrecomputedScaleFactor(da,ha.factor,da);da[0]*=ba.pixelRatio;da[1]*=ba.pixelRatio;fa=r.offset(fa.calculateRelativeScreenBounds(da,ha.factorAlignment.scale,Y),d.lerp(0,ba.fullWidth,.5+.5*ka[0]),d.lerp(0,ba.fullHeight,.5+.5*ka[1]));ka=this.marginFactor;0!==ka&&(ka*=Math.min(r.width(fa),r.height(fa)),fa[0]-=ka,fa[1]-=ka,fa[2]+=ka,fa[3]+=ka);r.expand(Z.aabr,fa,Z.aabr)}_isConflicted(Z){const da=Z.graphics3DGraphic.graphic.uid;Z=Z.info[this.visibilityGroup];
let fa=!0;for(let ka=Math.floor(Z.aabr[0]/this._accBinsSizeX);ka<=Math.floor(Z.aabr[2]/this._accBinsSizeX);ka++)if(!(0>ka||ka>=this._accBinsNumX))for(let ha=Math.floor(Z.aabr[1]/this._accBinsSizeY);ha<=Math.floor(Z.aabr[3]/this._accBinsSizeY);ha++){if(0>ha||ha>=this._accBinsNumY)continue;fa=!1;const ba=this._accBins[ka][ha];for(let ea=0;ea<ba.length;ea++){const ca=ba.data[ea],ia=ca.info[this.visibilityGroup];if(ia&&ia.visible&&ca.graphics3DGraphic.graphic.uid!==da&&(this.accNumTests++,r.intersects(ia.aabr,
Z.aabr)))return!0}}return fa}_initBins(Z,da){if(null==this._accBins){this._accBins=[];for(var fa=0;fa<this._accBinsNumX;fa++){this._accBins.push([]);var ka=this._accBins[this._accBins.length-1];for(let ha=0;ha<this._accBinsNumY;ha++)ka.push(new f)}}else for(fa=0;fa<this._accBinsNumX;fa++)for(ka=0;ka<this._accBinsNumY;ka++)this._accBins[fa][ka].clear();this._accBinsSizeX=Z/this._accBinsNumX;this._accBinsSizeY=da/this._accBinsNumY;this.accNumTests=0}_addToBins(Z){var da=Z.info[this.visibilityGroup],
fa=Math.floor(da.aabr[0]/this._accBinsSizeX);const ka=Math.floor(da.aabr[2]/this._accBinsSizeX),ha=Math.floor(da.aabr[1]/this._accBinsSizeY);for(da=Math.floor(da.aabr[3]/this._accBinsSizeY);fa<=ka;fa++)if(!(0>fa||fa>=this._accBinsNumX))for(let ba=ha;ba<=da;ba++)0>ba||ba>=this._accBinsNumY||this._accBins[fa][ba].push(Z)}_setGraphicVisibility(Z,da){Z=Z.graphics3DGraphic;Z.destroyed||(Z.setVisibilityFlag(this.visibilityGroup,C.VisibilityFlag.DECONFLICTION,da),this.visibilityGroup===C.VisibilityGroup.LABEL&&
this.view.labeler.setLabelGraphicVisibility(Z,da))}};a.__decorate([n.property({constructOnly:!0})],b.Deconflictor.prototype,"view",void 0);a.__decorate([n.property({type:Boolean,readOnly:!0})],b.Deconflictor.prototype,"updating",null);b.Deconflictor=a.__decorate([e.subclass("esri.views.3d.layers.graphics.Deconflictor")],b.Deconflictor);class I{constructor(){this.id=0;this.visible=!1;this.distance=this.prio=0}}class Q{constructor(Z=null,da=null,fa=null){this.active=Z;this.visible=da;this.sort=fa;this.sortArray=
new f({allocator:ka=>ka||new I})}}const N=w.create();class T{constructor(){this.positionView=x.create();this.positionNDC=x.create();this.distanceWithoutPolygonOffset=this.distance=0;this.scaleInfo=new K.ScaleInfo}get isOutsideScreen(){const Z=this.positionNDC;return-1>Z[0]||-1>Z[1]||-1>Z[2]||1<=Z[0]||1<=Z[1]}}const aa=new T;b.DeconflictorGraphic=H;b.DeconflictorViewState=S;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/deconflictorDebug":function(){define(["exports",
"../../support/debugFlags"],function(b,a){function c(m,l,w,v,x){g&&(g(),g=null);const p=q.height,h=e;h.beginPath();h.lineWidth=1;h.strokeStyle=x;h.moveTo(m,p-w);h.lineTo(l,p-w);h.stroke();h.lineTo(l,p-v);h.stroke();h.lineTo(l,p-w);h.stroke();h.lineTo(m,p-w);h.stroke();h.lineTo(m,p-w);h.stroke();h.closePath()}let d=!1,f=!1,n=!1,k=!1,g=null,q,e;b.drawAccelerationStruct=function(m,l){if(f&&e){g&&(g(),g=null);var w=e,v=0;for(let x=0;x<m.accBinsNumX;x++)for(let p=0;p<m.accBinsNumY;p++){const h=m.accBins[x][m.accBinsNumY-
1-p];v+=h.length;const t=x*m.accBinsSizeX,r=(x+1)*m.accBinsSizeX,u=p*m.accBinsSizeY,y=(p+1)*m.accBinsSizeY;w.fillText(h.length.toFixed(),t+5,u+15);c(t,r,u,y,"blue")}w.fillText("total totalShownLabels: "+v,70,40);w.fillText("total visible labels: "+l.size,70,50);w.fillText("total numTests: "+m.accNumTests,70,30)}};b.drawPoly=function(m,l){d&&(l&&n||!l&&k)&&c(m.aabr[0],m.aabr[2],m.aabr[1],m.aabr[3],l?"green":"red")};b.prepare=function(m){n=a.debugFlags.DECONFLICTOR_SHOW_VISIBLE;k=a.debugFlags.DECONFLICTOR_SHOW_INVISIBLE;
d=n||k;f=a.debugFlags.DECONFLICTOR_SHOW_GRID;g=null;d||f?g=()=>{null==q&&(q=document.createElement("canvas"),q.setAttribute("id","debugCanvas2d"),m.surface.parentElement.style.position="relative",m.surface.parentElement.appendChild(q));var {state:l}=m;const {camera:w,pixelRatio:v}=l,{width:x,height:p}=w;l=p*v;q.setAttribute("width",`${x*v}px`);q.setAttribute("height",`${l}px`);q.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${x}px;height:${p}px`);
e=q.getContext("2d");e.clearRect(0,0,x,p);e.font="12px Arial"}:q&&(q.parentElement.removeChild(q),q=null)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/debugFlags":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass".split(" "),function(b,a,c,d,f,n,k,
g){c=class extends c{constructor(){super(...arguments);this.LINE_WIREFRAMES=this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=this.I3S_SHOW_MODIFICATIONS=this.I3S_TREE_SHOW_TILES=this.TERRAIN_TILE_TREE_SHOW_TILES=this.FEATURE_TILE_TREE_SHOW_TILES=this.FEATURE_TILE_FETCH_SHOW_TILES=this.DRAW_MESH_GEOMETRY_NORMALS=this.TESTS_DISABLE_FAST_UPDATES=this.TESTS_DISABLE_OPTIMIZATIONS=this.SHOW_POI=this.OVERLAY_SHOW_CENTER=this.OVERLAY_DRAW_DEBUG_TEXTURE=
this.TEXT_SHOW_BORDER=this.TEXT_SHOW_BASELINE=this.LABELS_SHOW_BORDER=this.DECONFLICTOR_SHOW_GRID=this.DECONFLICTOR_SHOW_INVISIBLE=this.DECONFLICTOR_SHOW_VISIBLE=this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1}};a.__decorate([d.property()],c.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0);a.__decorate([d.property()],c.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0);a.__decorate([d.property()],c.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0);a.__decorate([d.property()],c.prototype,"DECONFLICTOR_SHOW_GRID",
void 0);a.__decorate([d.property()],c.prototype,"LABELS_SHOW_BORDER",void 0);a.__decorate([d.property()],c.prototype,"TEXT_SHOW_BASELINE",void 0);a.__decorate([d.property()],c.prototype,"TEXT_SHOW_BORDER",void 0);a.__decorate([d.property()],c.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0);a.__decorate([d.property()],c.prototype,"OVERLAY_SHOW_CENTER",void 0);a.__decorate([d.property()],c.prototype,"SHOW_POI",void 0);a.__decorate([d.property()],c.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0);a.__decorate([d.property()],
c.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0);a.__decorate([d.property()],c.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0);a.__decorate([d.property()],c.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0);a.__decorate([d.property()],c.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0);a.__decorate([d.property()],c.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0);a.__decorate([d.property()],c.prototype,"I3S_TREE_SHOW_TILES",void 0);a.__decorate([d.property()],c.prototype,"I3S_SHOW_MODIFICATIONS",void 0);
a.__decorate([d.property()],c.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0);a.__decorate([d.property()],c.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0);a.__decorate([d.property()],c.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0);a.__decorate([d.property()],c.prototype,"LINE_WIREFRAMES",void 0);c=a.__decorate([g.subclass("esri.views.3d.support.DebugFlags")],c);a=new c;b.debugFlags=a;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/enums":function(){define(["exports"],
function(b){b.VisibilityFlag=void 0;(function(a){a[a.USER=1]="USER";a[a.SCALE_RANGE=2]="SCALE_RANGE";a[a.FILTER=4]="FILTER";a[a.DECONFLICTION=8]="DECONFLICTION";a[a.ALL_GRAPHIC=15]="ALL_GRAPHIC";a[a.ALL_LABEL=255]="ALL_LABEL"})(b.VisibilityFlag||(b.VisibilityFlag={}));b.VisibilityGroup=void 0;(function(a){a[a.GRAPHIC=1]="GRAPHIC";a[a.LABEL=16]="LABEL"})(b.VisibilityGroup||(b.VisibilityGroup={}));Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/screenSizePerspectiveUtils":function(){define(["exports",
"../../../../core/mathUtils","../../../ViewingMode"],function(b,a,c){function d(e,m,l){l=l.parameters;g.scale=Math.min(l.divisor/(m-l.offset),1);g.factor=Math.abs(e*e*e);return g}function f(e,m){return a.lerp(e*Math.max(m.scale,m.minScaleFactor),e,m.factor)}class n{get minScaleFactor(){return null!=this._fontHeight?Math.min(this._description.minPixelSize/this._fontHeight,1):0}constructor(e,m,l,w={camera:{distance:0,fovY:0},divisor:0,offset:0},v){this._viewingMode=e;this._description=m;this._ellipsoidRadius=
l;this.parameters=w;this._fontHeight=v;this._viewingMode===c.ViewingMode.Local?(this._coverageCompensation=this._surfaceCoverageCompensationLocal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this._coverageCompensation=this._surfaceCoverageCompensationGlobal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}update(e){if(this.parameters&&this.parameters.camera.fovY===e.fovY&&this.parameters.camera.distance===
e.distance)return!1;this._calculateParameters(e,this._ellipsoidRadius,this.parameters);return!0}overrideFontHeight(e){return e!==this._fontHeight?new n(this._viewingMode,this._description,this._ellipsoidRadius,this.parameters,e):this}_calculateParameters(e,m,l){const {scaleStart:w,scaleFallOffRange:v}=this._description,{fovY:x,distance:p}=e;var h=this._calculateCurvatureDependentParameters(e,m);m=this._coverageCompensation(e,m,h);const {tiltAngle:t,scaleFallOffFactor:r}=h,u=Math.sin(t)*p,y=.5*Math.PI-
t-x*(.5-w*m);h=u/Math.cos(y);m=(h-u/Math.cos(y+x*v*m)*r)/(1-r);l.camera.fovY=e.fovY;l.camera.distance=e.distance;l.offset=m;l.divisor=h-m;return l}_calculateCurvatureDependentParametersLocal(e,m,l=q){l.tiltAngle=this._description.curvatureDependent.min.tiltAngle;l.scaleFallOffFactor=this._description.curvatureDependent.min.scaleFallOffFactor;return l}_calculateCurvatureDependentParametersGlobal(e,m,l=q){const w=this._description.curvatureDependent;e=1+e.distance/m;e=Math.sqrt(e*e-1);const [v,x]=[w.min.curvature,
w.max.curvature];e=a.clamp((e-v)/(x-v),0,1);const [p,h]=[w.min,w.max];l.tiltAngle=a.lerp(p.tiltAngle,h.tiltAngle,e);l.scaleFallOffFactor=a.lerp(p.scaleFallOffFactor,h.scaleFallOffFactor,e);return l}_surfaceCoverageCompensationLocal(e,m,l){return(e.fovY-l.tiltAngle)/e.fovY}_surfaceCoverageCompensationGlobal(e,m,l){const w=m*m;l=l.tiltAngle+.5*Math.PI;const {fovY:v,distance:x}=e;e=x*x+w-2*Math.cos(l)*x*m;const p=Math.sqrt(e);return(Math.acos(Math.sqrt(e-w)/p)-Math.asin(m/(p/Math.sin(l)))+.5*v)/v}}const k=
{curvatureDependent:{min:{curvature:a.deg2rad(10),tiltAngle:a.deg2rad(12),scaleFallOffFactor:.5},max:{curvature:a.deg2rad(70),tiltAngle:a.deg2rad(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},g={scale:0,factor:0,minScaleFactor:0},q={tiltAngle:0,scaleFallOffFactor:0};b.applyPrecomputedScaleFactor=function(e,m,l=[0,0]){m=Math.min(Math.max(m.scale,m.minScaleFactor),1);l[0]=e[0]*m;l[1]=e[1]*m;return l};b.applyScaleFactor=f;b.getLabelSettings=function(e,m){const {curvatureDependent:l,
scaleStart:w,scaleFallOffRange:v}=k;return new n(e,{curvatureDependent:{min:{curvature:l.min.curvature,tiltAngle:l.min.tiltAngle,scaleFallOffFactor:.7},max:{curvature:l.max.curvature,tiltAngle:l.max.tiltAngle,scaleFallOffFactor:.95}},scaleStart:w,scaleFallOffRange:v,minPixelSize:14},m)};b.getSettings=function(e,m){return new n(e,k,m)};b.precomputeScaleFactor=function(e,m,l,w){e=d(e,m,l);e.minScaleFactor=0;e=f(1,e);w.scale=e;w.factor=0;w.minScaleFactor=l.minScaleFactor};b.scale=function(e,m,l,w){return f(e,
d(m,l,w))};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/HUDMaterial":function(){define("exports ../../../../core/has ../../../../core/mathUtils ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../core/libs/gl-matrix-2/types/mat4 ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/buffer/BufferView ../../layers/support/FastSymbolUpdates ../../support/debugFlags ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/hud/HUD.glsl ../lib/GLTextureMaterial ../lib/Material ../lib/RenderSlot ../lib/screenSizePerspectiveUtils ../lib/Util ../lib/VertexAttribute ./ScaleInfo ./internal/bufferWriterUtils ./internal/MaterialUtil ../../../../chunks/HUDMaterial.glsl ../shaders/HUDMaterialTechnique ../shaders/HUDMaterialTechniqueConfiguration".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A,C,E,B,D,F,K,L,G,O){function P(ia,la,oa,na=M){g.copy(na,ia.anchorPosition);na[0]*=-la[0];na[1]*=-la[1];na[0]+=ia.screenOffset[0]*oa;na[1]+=ia.screenOffset[1]*oa;return na}function J(ia,la,oa,na,ra,ta,ma,pa){la=la-ra-(0<pa[0]?na[0]*pa[0]:0);let ja=la+na[0]+2*ra;oa=oa-ra-(0<pa[1]?na[1]*pa[1]:0);ra=oa+na[1]+2*ra;pa=ma.distanceFieldBoundingBox;ma.textureIsSignedDistanceField&&null!=pa&&(la+=na[0]*pa[0],oa+=na[1]*pa[1],ja-=na[0]*(1-pa[2]),ra-=na[1]*
(1-pa[3]),la-=ta,ja+=ta,oa-=ta,ra+=ta);return ia[0]>la&&ia[0]<ja&&ia[1]>oa&&ia[1]<ra}class R extends z.Material{constructor(ia){super(ia,new ha);this._configuration=new O.HUDMaterialTechniqueConfiguration}getConfiguration(ia,la){this._configuration.output=ia;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset;this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective;this._configuration.screenCenterOffsetUnitsEnabled=
"screen"===this.parameters.centerOffsetUnits;this._configuration.hasPolygonOffset=this.parameters.polygonOffset;this._configuration.draped=this.parameters.isDraped;this._configuration.occlusionTestEnabled=this.parameters.occlusionTest;this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled;this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField;this._configuration.sampleSignedDistanceFieldTexelCenter=this.parameters.sampleSignedDistanceFieldTexelCenter;
this._configuration.vvSize=!!this.parameters.vvSize;this._configuration.vvColor=!!this.parameters.vvColor;this._configuration.occlusionPass=la.slot===A.RenderSlot.OCCLUSION_PIXELS&&this.parameters.occlusionTest&&(ia===r.ShaderOutput.Color||ia===r.ShaderOutput.Alpha);ia===r.ShaderOutput.Color&&(this._configuration.debugDrawLabelBorder=!!h.debugFlags.LABELS_SHOW_BORDER);this._configuration.depthEnabled=this.parameters.depthEnabled;this._configuration.transparencyPassType=la.transparencyPassType;this._configuration.multipassEnabled=
la.multipassEnabled;this._configuration.cullAboveGround=la.multipassTerrain.cullAboveGround;return this._configuration}intersect(ia,la,oa,na,ra,ta){if(oa.options.selectionMode&&oa.options.hud&&ia.visible&&oa.point){na=this.parameters;ra=oa.point;var ma=oa.camera,{scaleX:pa,scaleY:ja}=this._getScreenScale(ia);pa*=ma.pixelRatio;ja*=ma.pixelRatio;d.fromMat4(I,la);if(ia.attributes.has(B.VertexAttribute.FEATUREATTRIBUTE)){var qa=I,ua=qa[0],wa=qa[1],za=qa[2],Aa=qa[3],Fa=qa[4],Da=qa[5],Ha=qa[6],Ka=qa[7];
const La=qa[8],Na=1/Math.sqrt(ua*ua+wa*wa+za*za),Ra=1/Math.sqrt(Aa*Aa+Fa*Fa+Da*Da),Sa=1/Math.sqrt(Ha*Ha+Ka*Ka+La*La);qa[0]=ua*Na;qa[1]=wa*Na;qa[2]=za*Na;qa[3]=Aa*Ra;qa[4]=Fa*Ra;qa[5]=Da*Ra;qa[6]=Ha*Sa;qa[7]=Ka*Sa;qa[8]=La*Sa}qa=ia.attributes.get(B.VertexAttribute.POSITION);ua=ia.attributes.get(B.VertexAttribute.SIZE);wa=ia.attributes.get(B.VertexAttribute.NORMAL);ia=ia.attributes.get(B.VertexAttribute.AUXPOS1);E.assert(3<=qa.size);za=L.calculateAnchorPosForRendering(na);Aa="screen"===this.parameters.centerOffsetUnits;
for(Fa=0;Fa<qa.data.length/qa.size;Fa++)Da=Fa*qa.size,e.set(V,qa.data[Da],qa.data[Da+1],qa.data[Da+2]),e.transformMat4(V,V,la),Da=Fa*ua.size,fa[0]=ua.data[Da]*pa,fa[1]=ua.data[Da+1]*ja,e.transformMat4(V,V,ma.viewMatrix),Da=Fa*ia.size,e.set(T,ia.data[Da],ia.data[Da+1],ia.data[Da+2]),Aa||(V[0]+=T[0],V[1]+=T[1],0!==T[2]&&(Da=T[2],e.normalize(T,V),e.subtract(V,V,e.scale(T,T,Da)))),Da=Fa*wa.size,e.set(Y,wa.data[Da],wa.data[Da+1],wa.data[Da+2]),this._normalAndViewAngle(Y,I,ma,da),this._applyVerticalOffsetTransformationView(V,
da,ma,U),ma.applyProjection(V,W),-1<W[0]&&(Aa&&(T[0]||T[1])&&(W[0]+=T[0]*ma.pixelRatio,0!==T[1]&&(W[1]+=C.applyScaleFactor(T[1],U.factorAlignment)*ma.pixelRatio),ma.unapplyProjection(W,V)),W[0]+=this.parameters.screenOffset[0]*ma.pixelRatio,W[1]+=this.parameters.screenOffset[1]*ma.pixelRatio,W[0]=Math.floor(W[0]),W[1]=Math.floor(W[1]),C.applyPrecomputedScaleFactor(fa,U.factor,fa),Da=1*ma.pixelRatio,Ha=0,na.textureIsSignedDistanceField&&(Ha=na.outlineSize*ma.pixelRatio/2),J(ra,W[0],W[1],fa,Da,Ha,na,
za)&&(Ha=oa.ray,e.transformMat4(S,V,n.invert(N,ma.viewMatrix)),W[0]=ra[0],W[1]=ra[1],ma.unprojectFromRenderScreen(W,V)&&(Da=m.create(),e.copy(Da,Ha.direction),Ka=1/e.length(Da),e.scale(Da,Da,Ka),Ha=e.distance(Ha.origin,V)*Ka,ta(Ha,Da,-1,!0,1,S))))}}intersectDraped(ia,la,oa,na,ra,ta){la=ia.attributes.get(B.VertexAttribute.POSITION);oa=ia.attributes.get(B.VertexAttribute.SIZE);const ma=this.parameters,pa=L.calculateAnchorPosForRendering(ma);let {scaleX:ja,scaleY:qa}=this._getScreenScale(ia);ja*=ia.screenToWorldRatio;
qa*=ia.screenToWorldRatio;const ua=2*ia.screenToWorldRatio;for(let Aa=0;Aa<la.data.length/la.size;Aa++){var wa=Aa*la.size;const Fa=la.data[wa];wa=la.data[wa+1];var za=Aa*oa.size;fa[0]=oa.data[za]*ja;fa[1]=oa.data[za+1]*qa;za=0;ma.textureIsSignedDistanceField&&(za=ma.outlineSize*ia.screenToWorldRatio/2);J(na,Fa,wa,fa,ua,za,ma,pa)&&ra(ta.dist,ta.normal,-1,!1)}}createBufferWriter(){return new ca(this)}_normalAndViewAngle(ia,la,oa,na){w.isMat4(la)&&(la=d.fromMat4(Q,la));e.transformMat3(na.normal,ia,la);
e.transformMat4(na.normal,na.normal,oa.viewInverseTransposeMatrix);na.cosAngle=e.dot(H,ka);return na}_updateScaleInfo(ia,la,oa){const na=this.parameters;null!=na.screenSizePerspective?C.precomputeScaleFactor(oa,la,na.screenSizePerspective,ia.factor):(ia.factor.scale=1,ia.factor.factor=0,ia.factor.minScaleFactor=0);null!=na.screenSizePerspectiveAlignment?C.precomputeScaleFactor(oa,la,na.screenSizePerspectiveAlignment,ia.factorAlignment):(ia.factorAlignment.factor=ia.factor.factor,ia.factorAlignment.scale=
ia.factor.scale,ia.factorAlignment.minScaleFactor=ia.factor.minScaleFactor)}applyShaderOffsetsView(ia,la,oa,na,ra,ta,ma){la=this._normalAndViewAngle(la,oa,ra,da);this._applyVerticalGroundOffsetView(ia,la,ra,ma);this._applyVerticalOffsetTransformationView(ma,la,ra,ta);this._applyPolygonOffsetView(ma,la,na[3],ra,ma);this._applyCenterOffsetView(ma,na,ma);return ma}applyShaderOffsetsNDC(ia,la,oa,na,ra){this._applyCenterOffsetNDC(ia,la,oa,na);null!=ra&&e.copy(ra,na);this._applyPolygonOffsetNDC(na,la,oa,
na);return na}_applyPolygonOffsetView(ia,la,oa,na,ra){var ta=na.aboveGround?1:-1;oa=Math.sign(oa);0===oa&&(oa=ta);ta*=oa;if(0>=this.parameters.shaderPolygonOffset)return e.copy(ra,ia);la=c.clamp(Math.abs(la.cosAngle),.01,1);na=1-Math.sqrt(1-la*la)/la/na.viewport[2];0<ta?e.scale(ra,ia,na):e.scale(ra,ia,1/na);return ra}_applyVerticalGroundOffsetView(ia,la,oa,na){const ra=e.length(ia),ta=oa.aboveGround?1:-1;oa=oa.computeRenderPixelSizeAtDist(ra)*u.HUDVerticalPixelOffset;la=e.scale(V,la.normal,ta*oa);
e.add(na,ia,la);return na}_applyVerticalOffsetTransformationView(ia,la,oa,na){const ra=this.parameters;if(!ra.verticalOffset?.screenLength){if(ra.screenSizePerspective||ra.screenSizePerspectiveAlignment){var ta=e.length(ia);this._updateScaleInfo(na,ta,la.cosAngle)}else na.factor.scale=1,na.factorAlignment.scale=1;return ia}ta=e.length(ia);oa=K.verticalOffsetAtDistance(oa,ta,ra.verticalOffset,la.cosAngle,ra.screenSizePerspectiveAlignment??ra.screenSizePerspective);this._updateScaleInfo(na,ta,la.cosAngle);
e.scale(la.normal,la.normal,oa);return e.add(ia,ia,la.normal)}_applyCenterOffsetView(ia,la,oa){const na="screen"!==this.parameters.centerOffsetUnits;oa!==ia&&e.copy(oa,ia);na&&(oa[0]+=la[0],oa[1]+=la[1],la[2]&&(e.normalize(Y,oa),e.add(oa,oa,e.scale(Y,Y,la[2]))));return oa}_applyCenterOffsetNDC(ia,la,oa,na){const ra="screen"!==this.parameters.centerOffsetUnits;na!==ia&&e.copy(na,ia);ra||(na[0]+=la[0]/oa.fullWidth*2,na[1]+=la[1]/oa.fullHeight*2);return na}_applyPolygonOffsetNDC(ia,la,oa,na){const ra=
this.parameters.shaderPolygonOffset;ia!==na&&e.copy(na,ia);ra&&(ia=oa.aboveGround?1:-1,na[2]-=(ia*Math.sign(la[3])||ia)*ra);return na}produces(ia,la){if(la===r.ShaderOutput.Color||la===r.ShaderOutput.Alpha||la===r.ShaderOutput.Highlight||la===r.ShaderOutput.ObjectAndLayerIdColor){if(ia===A.RenderSlot.DRAPED_MATERIAL)return!0;const {drawInSecondSlot:oa,occlusionTest:na}=this.parameters;return ia===(oa?A.RenderSlot.LABEL_MATERIAL:A.RenderSlot.HUD_MATERIAL)||na&&ia===A.RenderSlot.OCCLUSION_PIXELS}return!1}createGLMaterial(ia){return new X(ia)}calculateRelativeScreenBounds(ia,
la,oa=v.create()){P(this.parameters,ia,la,oa);oa[2]=oa[0]+ia[0];oa[3]=oa[1]+ia[1];return oa}_getScreenScale(ia){ia=ia.attributes.get(B.VertexAttribute.FEATUREATTRIBUTE);if(null==ia)return{scaleX:1,scaleY:1};ia=l.fromArray(ia.data,Z);const [la,oa]=p.evaluateModelTransformScale(aa,this.parameters,ia);return{scaleX:la,scaleY:oa}}}class X extends y.GLTextureMaterial{constructor(ia){super({...ia,...ia.material.parameters})}selectProgram(ia){return this.ensureTechnique(G.HUDMaterialTechnique,ia)}beginSlot(ia){this.updateTexture(this._material.parameters.textureId);
this._material.setParameters(this.textureBindParameters);return this.selectProgram(ia)}}const U=new D.ScaleInfo,M=q.create(),V=m.create(),Y=m.create(),W=l.create(),H=m.create(),S=m.create(),I=f.create(),Q=f.create(),N=k.create(),T=m.create(),aa=l.create(),Z=l.create(),da={normal:H,cosAngle:0},fa=[0,0],ka=m.fromValues(0,0,1);class ha extends y.GLTextureMaterialBindParameters{constructor(){super(...arguments);this.renderOccluded=z.RenderOccludedFlag.Occlude;this.isDecoration=!1;this.color=l.fromValues(1,
1,1,1);this.texCoordScale=[1,1];this.polygonOffset=!1;this.anchorPosition=q.fromValues(.5,.5);this.screenOffset=[0,0];this.shaderPolygonOffset=1E-5;this.sampleSignedDistanceFieldTexelCenter=this.textureIsSignedDistanceField=!1;this.outlineColor=l.fromValues(1,1,1,1);this.outlineSize=0;this.vvSizeEnabled=!1;this.vvSymbolRotationMatrix=this.vvSymbolAnchor=this.vvOpacity=this.vvColor=this.vvSize=null;this.hasSlicePlane=!1;this.occlusionTest=this.pixelSnappingEnabled=!0;this.centerOffsetUnits="world";
this.drawInSecondSlot=!1;this.depthEnabled=!0;this.isDraped=!1}}const ba=t.newLayout().vec3f(B.VertexAttribute.POSITION).vec3f(B.VertexAttribute.NORMAL).vec2f(B.VertexAttribute.UV0).vec4u8(B.VertexAttribute.COLOR).vec2f(B.VertexAttribute.SIZE).vec4f(B.VertexAttribute.AUXPOS1).vec4f(B.VertexAttribute.FEATUREATTRIBUTE),ea=ba.clone().vec4u8(B.VertexAttribute.OBJECTANDLAYERIDCOLOR);class ca{constructor(ia){this._material=ia;this.vertexBufferLayout=a("enable-feature:objectAndLayerId-rendering")?ea:ba}elementCount(ia){return 6*
ia.attributes.get(B.VertexAttribute.POSITION).indices.length}write(ia,la,oa,na,ra){F.writePosition(oa.attributes.get(B.VertexAttribute.POSITION),ia,na.position,ra,6);F.writeNormal(oa.attributes.get(B.VertexAttribute.NORMAL),la,na.normal,ra,6);ia=oa.attributes.get(B.VertexAttribute.UV0).data;var ta;if(null==ia||4>ia.length){ia=this._material.parameters;var ma=ta=0;var pa=ia.texCoordScale[0];var ja=ia.texCoordScale[1]}else ta=ia[0],ma=ia[1],pa=ia[2],ja=ia[3];pa=Math.min(1.99999,pa+1);ja=Math.min(1.99999,
ja+1);ia=oa.attributes.get(B.VertexAttribute.POSITION).indices.length;la=ra;var qa=na.uv0;for(let za=0;za<ia;++za)qa.set(la,0,ta),qa.set(la,1,ma),la++,qa.set(la,0,pa),qa.set(la,1,ma),la++,qa.set(la,0,pa),qa.set(la,1,ja),la++,qa.set(la,0,pa),qa.set(la,1,ja),la++,qa.set(la,0,ta),qa.set(la,1,ja),la++,qa.set(la,0,ta),qa.set(la,1,ma),la++;F.writeColor(oa.attributes.get(B.VertexAttribute.COLOR),4,na.color,ra,6);const {data:ua,indices:wa}=oa.attributes.get(B.VertexAttribute.SIZE);ia=wa.length;ta=na.size;
la=ra;for(ma=0;ma<ia;++ma)for(pa=ua[2*wa[ma]],ja=ua[2*wa[ma]+1],qa=0;6>qa;++qa)ta.set(la,0,pa),ta.set(la,1,ja),la++;oa.attributes.get(B.VertexAttribute.AUXPOS1)?F.writeBufferVec4(oa.attributes.get(B.VertexAttribute.AUXPOS1),na.auxpos1,ra,6):F.writeBufferVec4Zeros(na.auxpos1,ra,6*ia);oa.attributes.get(B.VertexAttribute.FEATUREATTRIBUTE)?F.writeBufferVec4(oa.attributes.get(B.VertexAttribute.FEATUREATTRIBUTE),na.featureAttribute,ra,6):F.writeBufferVec4Zeros(na.featureAttribute,ra,6*ia);null!=oa.objectAndLayerIdColor&&
(ia=oa.attributes.get(B.VertexAttribute.POSITION)?.indices)&&(ia=ia.length,na=na.getField(B.VertexAttribute.OBJECTANDLAYERIDCOLOR,x.BufferViewVec4u8),F.writeObjectAndLayerIdColor(oa.objectAndLayerIdColor,na,ia,ra,6))}}b.HUDMaterial=R;b.Parameters=ha;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/types/mat4":function(){define(["exports"],function(b){function a(d){return d instanceof Float32Array&&16<=d.length}function c(d){return Array.isArray(d)&&16<=d.length}
b.isMat4=function(d){return a(d)||c(d)};b.isMat4f32=a;b.isMat4f64=c;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FastSymbolUpdates":function(){define("exports ../../../../core/has ../../../../core/mathUtils ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../renderers/support/lengthUtils ../../support/debugFlags ../../webgl-engine/core/shaderModules/interfaces".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l){function w(H){return null!==H&&void 0!==H}function v(H){return"number"===typeof H}function x(H){return"string"===typeof H}function p(H,S){H&&H.push(S)}function h(H,S,I,Q=k.create()){H=H||0;S=S||0;I=I||0;0!==H&&n.rotateZ(Q,Q,-H/180*Math.PI);0!==S&&n.rotateX(Q,Q,S/180*Math.PI);0!==I&&n.rotateY(Q,Q,I/180*Math.PI);return Q}function t(H,S,I,Q,N){const T=H.minSize,aa=H.maxSize;if(H.expression)return p(N,"Could not convert size info: expression not supported"),!1;if(H.useSymbolValue)return H=
Q.symbolSize[I],S.minSize[I]=H,S.maxSize[I]=H,S.offset[I]=S.minSize[I],S.factor[I]=0,S.type[I]=b.FastSizeType.DefinedSize,!0;if(w(H.field)){if(w(H.stops)){if(2===H.stops.length&&v(H.stops[0].size)&&v(H.stops[1].size))return r(H.stops[0].size,H.stops[1].size,H.stops[0].value,H.stops[1].value,S,I),S.type[I]=b.FastSizeType.DefinedSize,!0;p(N,"Could not convert size info: stops only supported with 2 elements");return!1}if(v(T)&&v(aa)&&w(H.minDataValue)&&w(H.maxDataValue))return r(T,aa,H.minDataValue,
H.maxDataValue,S,I),S.type[I]=b.FastSizeType.DefinedSize,!0;if("unknown"===H.valueUnit)return p(N,"Could not convert size info: proportional size not supported"),!1;if(null!=e.meterIn[H.valueUnit])return S.minSize[I]=-Infinity,S.maxSize[I]=Infinity,S.offset[I]=0,S.factor[I]=1/e.meterIn[H.valueUnit],S.type[I]=b.FastSizeType.DefinedSize,!0;p(N,"Could not convert size info: scale-dependent size not supported");return!1}if(!w(H.field)){if(H.stops?.[0]&&v(H.stops[0].size))return S.minSize[I]=H.stops[0].size,
S.maxSize[I]=H.stops[0].size,S.offset[I]=S.minSize[I],S.factor[I]=0,S.type[I]=b.FastSizeType.DefinedSize,!0;if(v(T))return S.minSize[I]=T,S.maxSize[I]=T,S.offset[I]=T,S.factor[I]=0,S.type[I]=b.FastSizeType.DefinedSize,!0}p(N,"Could not convert size info: unsupported variant of sizeInfo");return!1}function r(H,S,I,Q,N,T){Q=0<Math.abs(Q-I)?(S-H)/(Q-I):0;N.minSize[T]=0<Q?H:S;N.maxSize[T]=0<Q?S:H;N.offset[T]=H-I*Q;N.factor[T]=Q}function u(H,S,I,Q){if(H.normalizationField||H.valueRepresentation)return p(Q,
"Could not convert size info: unsupported property"),null;var N=H.field;if(null!=N&&!x(N))return p(Q,"Could not convert size info: field is not a string"),null;if(!S.size)S.size=new G(H.field);else if(H.field)if(!S.size.field)S.size.field=H.field;else if(H.field!==S.size.field)return p(Q,"Could not convert size info: multiple fields in use"),null;switch(H.axis){case "width":return(N=t(H,S.size,0,I,Q))?S:null;case "height":return(N=t(H,S.size,2,I,Q))?S:null;case "depth":return(N=t(H,S.size,1,I,Q))?
S:null;case "width-and-depth":return(N=t(H,S.size,0,I,Q))&&t(H,S.size,1,I,Q),N?S:null;case null:case void 0:case "all":return(N=(N=(N=t(H,S.size,0,I,Q))&&t(H,S.size,1,I,Q))&&t(H,S.size,2,I,Q))?S:null;default:return p(Q,`Could not convert size info: unknown axis "${H.axis}""`),null}}function y(H,S,I){for(let Q=0;3>Q;++Q){let N=S.unitInMeters;H.type[Q]===b.FastSizeType.DefinedSize&&(N*=S.modelSize[Q],H.type[Q]=b.FastSizeType.DefinedScale);H.minSize[Q]/=N;H.maxSize[Q]/=N;H.offset[Q]/=N;H.factor[Q]/=
N}if(H.type[0]!==b.FastSizeType.Undefined)S=0;else if(H.type[1]!==b.FastSizeType.Undefined)S=1;else if(H.type[2]!==b.FastSizeType.Undefined)S=2;else return p(I,"No size axis contains a valid size or scale"),!1;for(I=0;3>I;++I)H.type[I]===b.FastSizeType.Undefined&&(H.minSize[I]=H.minSize[S],H.maxSize[I]=H.maxSize[S],H.offset[I]=H.offset[S],H.factor[I]=H.factor[S],H.type[I]=H.type[S]);return!0}function z(H,S,I){H[4*S]=I.r/255;H[4*S+1]=I.g/255;H[4*S+2]=I.b/255;H[4*S+3]=I.a}function A(H,S,I){if(H.normalizationField)return p(I,
"Could not convert color info: unsupported property"),null;if(x(H.field))if(H.stops){if(8<H.stops.length)return p(I,"Could not convert color info: too many color stops"),null;S.color=new O(H.field);H=H.stops;for(I=0;8>I;++I){const Q=H[Math.min(I,H.length-1)];S.color.values[I]=Q.value;z(S.color.colors,I,Q.color)}}else return p(I,"Could not convert color info: missing stops or colors"),null;else if(H.stops&&0<=H.stops.length)for(H=H.stops&&0<=H.stops.length&&H.stops[0].color,S.color={field:null,values:[0,
0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},I=0;8>I;I++)S.color.values[I]=Infinity,z(S.color.colors,I,H);else return p(I,"Could not convert color info: no field and no colors/stops"),null;return S}function C(H,S,I){if(H.normalizationField)return p(I,"Could not convert opacity info: unsupported property"),null;if(x(H.field))if(H.stops){if(8<H.stops.length)return p(I,"Could not convert opacity info: too many opacity stops"),null;S.opacity=new P(H.field);
H=H.stops;for(I=0;8>I;++I){const Q=H[Math.min(I,H.length-1)];S.opacity.values[I]=Q.value;S.opacity.opacityValues[I]=Q.opacity}}else return p(I,"Could not convert opacity info: missing stops or opacities"),null;else if(H.stops&&0<=H.stops.length)for(H=H.stops&&0<=H.stops.length?H.stops[0].opacity:0,S.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]},I=0;8>I;I++)S.opacity.values[I]=Infinity,S.opacity.opacityValues[I]=H;else return p(I,"Could not convert opacity info: no field and no opacities/stops"),
null;return S}function E(H,S,I){H=2===I&&"arithmetic"===H.rotationType;S.offset[I]=H?90:0;S.factor[I]=H?-1:1;S.type[I]=1}function B(H,S,I){if(!x(H.field))return p(I,"Could not convert rotation info: field is not a string"),null;if(!S.rotation)S.rotation={field:H.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};else if(H.field)if(!S.rotation.field)S.rotation.field=H.field;else if(H.field!==S.rotation.field)return p(I,"Could not convert rotation info: multiple fields in use"),null;switch(H.axis){case "tilt":return E(H,
S.rotation,0),S;case "roll":return E(H,S.rotation,1),S;case null:case void 0:case "heading":return E(H,S.rotation,2),S;default:return p(I,`Could not convert rotation info: unknown axis "${H.axis}""`),null}}function D(H,S,I){if(!H)return null;const Q=H.reduce((N,T)=>{if(!N)return N;if(T.valueExpression)return p(I,"Could not convert visual variables: arcade expressions not supported"),null;switch(T.type){case "size":return S.supports.size?u(T,N,S,I):N;case "color":return S.supports.color?A(T,N,I):N;
case "opacity":return S.supports.opacity?C(T,N,I):null;case "rotation":return S.supports.rotation?B(T,N,I):N;default:return null}},new R);return 0<H.length&&Q&&!Q.size&&!Q.color&&!Q.opacity&&!Q.rotation||Q?.size&&!y(Q.size,S,I)?null:Q}function F(H,S,I){if(!!H!==!!S||H&&H.field!==S?.field)return!1;if(H&&"rotation"===I)for(I=0;3>I;I++)if(H.type[I]!==S.type[I]||H.offset[I]!==S.offset[I]||H.factor[I]!==S.factor[I])return!1;return!0}function K(H,S){H=new M(H);H.vvSize&&(H.vvSymbolAnchor=S.anchor,n.identity(W),
h(S.rotation[2],S.rotation[0],S.rotation[1],W),H.vvSymbolRotationMatrix=H.vvSymbolRotationMatrix||f.create(),d.fromMat4(H.vvSymbolRotationMatrix,W));return H}b.FastSizeType=void 0;(function(H){H[H.Undefined=0]="Undefined";H[H.DefinedSize=1]="DefinedSize";H[H.DefinedScale=2]="DefinedScale"})(b.FastSizeType||(b.FastSizeType={}));b.FastRotationType=void 0;(function(H){H[H.Undefined=0]="Undefined";H[H.DefinedAngle=1]="DefinedAngle"})(b.FastRotationType||(b.FastRotationType={}));class L{constructor(H){this.field=
H}}class G extends L{constructor(H){super(H);this.minSize=[0,0,0];this.maxSize=[0,0,0];this.offset=[0,0,0];this.factor=[0,0,0];this.type=[b.FastSizeType.Undefined,b.FastSizeType.Undefined,b.FastSizeType.Undefined]}}class O extends L{constructor(H){super(H);this.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.values=[0,0,0,0,0,0,0,0]}}class P extends L{constructor(H){super(H);this.values=[0,0,0,0,0,0,0,0];this.opacityValues=[0,0,0,0,0,0,0,0]}}class J extends L{constructor(H){super(H);
this.offset=[0,0,0];this.factor=[1,1,1];this.type=[0,0,0]}}class R{}class X{constructor(H,S=[1,1,1],I=[1,1,1],Q=1,N=[0,0,0],T=[1,1,1],aa=[0,0,0]){this.supports=H;this.modelSize=S;this.symbolSize=I;this.unitInMeters=Q;this.anchor=N;this.scale=T;this.rotation=aa}}class U{constructor(H,S,I){this.visualVariables=H;this.materialParameters=S;this.requiresShaderTransformation=I}}class M extends l.NoParameters{constructor(H){super();this.vvSize=H?.size??null;this.vvColor=H?.color??null;this.vvOpacity=H?.opacity??
null}}const V=k.create(),Y=q.create(),W=k.create();b.ConvertOptions=X;b.FastColorInfo=O;b.FastOpacityInfo=P;b.FastRotationInfo=J;b.FastSizeInfo=G;b.FastSymbolUpdatesState=U;b.FastVisualVariables=R;b.VisualVariablesParameters=M;b.convertVisualVariables=D;b.evaluateModelTransform=function(H,S,I){if(!H.vvSize)return I;n.copy(V,I);I=H.vvSymbolRotationMatrix;n.set(W,I[0],I[1],I[2],0,I[3],I[4],I[5],0,I[6],I[7],I[8],0,0,0,0,1);n.multiply(V,V,W);for(I=0;3>I;++I)Y[I]=c.clamp(H.vvSize.offset[I]+S[0]*H.vvSize.factor[I],
H.vvSize.minSize[I],H.vvSize.maxSize[I]);n.scale(V,V,Y);n.translate(V,V,H.vvSymbolAnchor);return V};b.evaluateModelTransformScale=function(H,S,I){if(!S.vvSize)return g.set(H,1,1,1),H;for(let Q=0;3>Q;++Q)H[Q]=c.clamp(S.vvSize.offset[Q]+I[0]*S.vvSize.factor[Q],S.vvSize.minSize[Q],S.vvSize.maxSize[Q]);return H};b.getAttributeValue=function(H,S){H=null==H?0:S.attributes[H];return"number"===typeof H&&isFinite(H)?H:0};b.getMaterialParameters=K;b.initFastSymbolUpdatesState=function(H,S){return!H||m.debugFlags.TESTS_DISABLE_FAST_UPDATES?
null:(H=D(H.visualVariables,S))?new U(H,K(H,S),!!H.size):null};b.updateFastSymbolUpdatesState=function(H,S,I){if(!S||!H)return!1;const Q=H.visualVariables;S=D(S.visualVariables,I);if(!(S&&F(Q.size,S.size,"size")&&F(Q.color,S.color,"color")&&F(Q.rotation,S.rotation,"rotation")&&F(Q.opacity,S.opacity,"opacity")))return!1;H.visualVariables=S;H.materialParameters=K(S,I);H.requiresShaderTransformation=!!S.size;return!0};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl":function(){define("exports ../attributes/VerticalOffset.glsl ../util/ScreenSizePerspective.glsl ../util/View.glsl ../../shaderModules/Float4PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../../lib/VertexAttribute".split(" "),
function(b,a,c,d,f,n,k,g){b.HUD=function(q,e){q.include(c.ScreenSizePerspective);q.attributes.add(g.VertexAttribute.POSITION,"vec3");q.attributes.add(g.VertexAttribute.NORMAL,"vec3");q.attributes.add(g.VertexAttribute.AUXPOS1,"vec4");q=q.vertex;d.addProjViewLocalOrigin(q,e);d.addCameraPosition(q,e);q.uniforms.add(new f.Float4PassUniform("viewport",(m,l)=>l.camera.fullViewport),new n.FloatPassUniform("polygonOffset",m=>m.shaderPolygonOffset),new n.FloatPassUniform("cameraGroundRelative",(m,l)=>l.camera.aboveGround?
1:-1));e.hasVerticalOffset&&a.addVerticalOffset(q);q.constants.add("smallOffsetAngle","float",.984807753012208);q.code.add(k.glsl`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`);q.code.add(k.glsl`
    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
      float pointGroundSign = ${e.multipassEnabled?k.glsl.float(0):k.glsl`sign(pointGroundDistance)`};
      if (pointGroundSign == 0.0) {
        pointGroundSign = cameraGroundRelative;
      }

      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground
      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise
      float groundRelative = cameraGroundRelative * pointGroundSign;

      // view angle dependent part of polygon offset emulation: we take the absolute value because the sign that is
      // dropped is instead introduced using the ground-relative position of the symbol and the camera
      if (polygonOffset > .0) {
        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
        float factor = (1.0 - tanAlpha / viewport[2]);

        // same side of the terrain
        if (groundRelative > 0.0) {
          posView *= factor;
        }
        // opposite sides of the terrain
        else {
          posView /= factor;
        }
      }

      return groundRelative;
    }
  `);e.draped&&!e.hasVerticalOffset||d.addViewNormal(q);e.draped||(q.uniforms.add(new n.FloatPassUniform("perDistancePixelRatio",(m,l)=>Math.tan(l.camera.fovY/2)/(l.camera.fullViewport[2]/2))),q.code.add(k.glsl`
    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
      float distanceToCamera = length(posView);

      // Compute offset in world units for a half pixel shift
      float pixelOffset = distanceToCamera * perDistancePixelRatio * ${k.glsl.float(.5)};

      // Apply offset along normal in the direction away from the ground surface
      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;

      // Apply the same offset also on the view space position
      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;

      posModel += modelOffset;
      posView += viewOffset;
    }
  `));e.screenCenterOffsetUnitsEnabled&&d.addPixelRatio(q);e.hasScreenSizePerspective&&c.addScreenSizePerspectiveAlignment(q);q.code.add(k.glsl`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offset of labels with respect to objects.
      // It also pulls the label towards the viewer so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${e.draped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${e.hasScreenSizePerspective?e.hasVerticalOffset||e.screenCenterOffsetUnitsEnabled?"vec3 perspectiveFactor \x3d screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":"":""}

      ${e.hasVerticalOffset?e.hasScreenSizePerspective?"float verticalOffsetScreenHeight \x3d applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight \x3d verticalOffset.x;":""}

      ${e.hasVerticalOffset?k.glsl`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${e.screenCenterOffsetUnitsEnabled?"":k.glsl`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${e.screenCenterOffsetUnitsEnabled?e.hasScreenSizePerspective?"float centerOffsetY \x3d applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY \x3d centerOffset.y;":""}

      ${e.screenCenterOffsetUnitsEnabled?"posProj.xy +\x3d vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `)};b.HUDVerticalPixelOffset=.5;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl":function(){define("exports ../../../../../../chunks/vec4 ../../../../../../chunks/vec4f64 ../util/ScreenSizePerspective.glsl ../util/View.glsl ../../shaderModules/Float4PassUniform ../../shaderModules/interfaces".split(" "),function(b,a,c,d,f,n,k){function g(e){e.uniforms.add(new n.Float4PassUniform("verticalOffset",(m,l)=>
{const {minWorldLength:w,maxWorldLength:v,screenLength:x}=m.verticalOffset;return a.set(q,x*(l.camera.pixelRatio||1),Math.tan(.5*l.camera.fovY)/(.5*l.camera.fullViewport[3]),w,v)}))}const q=c.create();b.VerticalOffset=function(e,m){const l=e.vertex;m.hasVerticalOffset?(g(l),m.hasScreenSizePerspective&&(e.include(d.ScreenSizePerspective),d.addScreenSizePerspectiveAlignment(l),f.addCameraPosition(e.vertex,m)),l.code.add(k.glsl`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${m.spherical?k.glsl`vec3 worldNormal = normalize(worldPos + localOrigin);`:k.glsl`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${m.hasScreenSizePerspective?k.glsl`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:k.glsl`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):l.code.add(k.glsl`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)};b.addVerticalOffset=g;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl":function(){define(["exports","../../../../../../chunks/vec3","../../../../../../chunks/vec3f64","../../shaderModules/Float3PassUniform","../../shaderModules/interfaces"],function(b,a,c,d,f){function n(g){return a.set(k,g.parameters.divisor,
g.parameters.offset,g.minScaleFactor)}const k=c.create();b.ScreenSizePerspective=function(g){g.vertex.code.add(f.glsl`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`);g.vertex.code.add(f.glsl`vec3 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec3 params) {
return vec3(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z
);
}`);g.vertex.code.add(f.glsl`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`);g.vertex.code.add(f.glsl`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`);g.vertex.code.add(f.glsl`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`);g.vertex.code.add(f.glsl`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)};b.addScreenSizePerspective=function(g){g.uniforms.add(new d.Float3PassUniform("screenSizePerspective",q=>n(q.screenSizePerspective)))};b.addScreenSizePerspectiveAlignment=function(g){g.uniforms.add(new d.Float3PassUniform("screenSizePerspectiveAlignment",q=>n(q.screenSizePerspectiveAlignment||q.screenSizePerspective)))};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Material":function(){define("exports ../../../../chunks/vec3f64 ../core/shaderModules/interfaces ./AnimationTimer ./basicInterfaces ./ContentObject ./ContentObjectType ./DefaultVertexAttributeLocations ../materials/internal/MaterialUtil".split(" "),
function(b,a,c,d,f,n,k,g,q){class e extends n.ContentObject{constructor(w,v){super();this.type=k.ContentObjectType.Material;this.supportsEdges=!1;this._visible=!0;this._renderPriority=0;this._vertexAttributeLocations=g.Default3D;this._pp0=a.fromValues(0,0,1);this._pp1=a.fromValues(0,0,0);this._parameters=q.copyParameters(w,v);this.validateParameters(this._parameters)}get parameters(){return this._parameters}update(w){return!1}setParameters(w,v=!0){q.updateParameters(this._parameters,w)&&(this.validateParameters(this._parameters),
v&&this.parametersChanged())}validateParameters(w){}get visible(){return this._visible}set visible(w){w!==this._visible&&(this._visible=w,this.parametersChanged())}shouldRender(w){return this.isVisible()&&this.isVisibleForOutput(w.output)&&(!this.parameters.isDecoration||w.bindParameters.decorations===f.Decorations.ON)&&0!==(this.parameters.renderOccluded&w.renderOccludedMask)}isVisibleForOutput(w){return!0}get renderPriority(){return this._renderPriority}set renderPriority(w){w!==this._renderPriority&&
(this._renderPriority=w,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){this.repository?.materialChanged(this)}intersectDraped(w,v,x,p,h,t){this._pp0[0]=this._pp1[0]=p[0];this._pp0[1]=this._pp1[1]=p[1];return this.intersect(w,v,x,this._pp0,this._pp1,h)}}class m extends d.Parameters{constructor(w,v,x){super(v,x);this.camera=w}}b.RenderOccludedFlag=void 0;(function(w){w[w.None=0]="None";w[w.Occlude=1]=
"Occlude";w[w.Transparent=2]="Transparent";w[w.OccludeAndTransparent=4]="OccludeAndTransparent";w[w.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil";w[w.Opaque=16]="Opaque"})(b.RenderOccludedFlag||(b.RenderOccludedFlag={}));class l extends c.NoParameters{constructor(){super(...arguments);this.renderOccluded=b.RenderOccludedFlag.Occlude;this.isDecoration=!1}}b.Material=e;b.MaterialParameters=l;b.UpdateParameters=m;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/internal/MaterialUtil":function(){define("exports ../../../../../core/arrayUtils ../../../../../core/mathUtils ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/aaBoundingBox ../../lib/ContentObjectType ../../lib/screenSizePerspectiveUtils ../../lib/Util ../../lib/VertexAttribute".split(" "),
function(b,a,c,d,f,n,k,g,q,e){function m(C,E,B,D,F,K){if(null!=C){var L=v(E,B,u);n.setMin(r,C.bbMin);n.setMax(r,C.bbMax);null!=F&&F.applyToAabb(r);if(x(r,E,L,D)){const {primitiveIndices:G,position:O}=C;L=G?G.length:O.indices.length/3;if(1E3<L&&(C=C.getChildren(),void 0!==C)){for(const P of C)m(P,E,B,D,F,K);return}l(E,B,0,L,O.indices,O,G,F,K)}}}function l(C,E,B,D,F,K,L,G,O){if(L){const {data:fa,stride:ka}=K;K=C[0];var P=C[1];C=C[2];var J=E[0]-K,R=E[1]-P;for(E=E[2]-C;B<D;++B){var X=L[B],U=3*X,M=ka*
F[U++],V=fa[M++],Y=fa[M++],W=fa[M];M=ka*F[U++];var H=fa[M++],S=fa[M++],I=fa[M];M=ka*F[U];U=fa[M++];var Q=fa[M++];M=fa[M];null!=G&&([V,Y,W]=G.applyToVertex(V,Y,W,B),[H,S,I]=G.applyToVertex(H,S,I,B),[U,Q,M]=G.applyToVertex(U,Q,M,B));H-=V;S-=Y;I-=W;U-=V;Q-=Y;M-=W;var N=R*M-Q*E,T=E*U-M*J;const ha=J*Q-U*R;var aa=H*N+S*T+I*ha;if(!(Math.abs(aa)<=Number.EPSILON)){V=K-V;Y=P-Y;W=C-W;N=V*N+Y*T+W*ha;if(0<aa){if(0>N||N>aa)continue}else if(0<N||N<aa)continue;T=Y*I-S*W;W=W*H-I*V;Y=V*S-H*Y;V=J*T+R*W+E*Y;if(0<aa){if(0>
V||N+V>aa)continue}else if(0<V||N+V<aa)continue;W=(U*T+Q*W+M*Y)/aa;0<=W&&(H=w(H,S,I,U,Q,M,y),O(W,H,X,!1))}}}else{var {data:Z,stride:da}=K;L=C[0];K=C[1];P=C[2];C=E[0]-L;J=E[1]-K;R=E[2]-P;for(let fa=B,ka=3*B;fa<D;++fa)if(U=da*F[ka++],Y=Z[U++],W=Z[U++],I=Z[U],U=da*F[ka++],E=Z[U++],B=Z[U++],X=Z[U],U=da*F[ka++],H=Z[U++],S=Z[U++],U=Z[U],null!=G&&([Y,W,I]=G.applyToVertex(Y,W,I,fa),[E,B,X]=G.applyToVertex(E,B,X,fa),[H,S,U]=G.applyToVertex(H,S,U,fa)),E-=Y,B-=W,X-=I,H-=Y,S-=W,U-=I,M=J*U-S*R,V=R*H-U*C,aa=C*
S-H*J,Q=E*M+B*V+X*aa,!(Math.abs(Q)<=Number.EPSILON)){Y=L-Y;W=K-W;I=P-I;M=Y*M+W*V+I*aa;if(0<Q){if(0>M||M>Q)continue}else if(0<M||M<Q)continue;V=W*X-B*I;I=I*E-X*Y;W=Y*B-E*W;Y=C*V+J*I+R*W;if(0<Q){if(0>Y||M+Y>Q)continue}else if(0<Y||M+Y<Q)continue;I=(H*V+S*I+U*W)/Q;0<=I&&(E=w(E,B,X,H,S,U,y),O(I,E,fa,!1))}}}function w(C,E,B,D,F,K,L){d.set(z,C,E,B);d.set(A,D,F,K);d.cross(L,z,A);d.normalize(L,L);return L}function v(C,E,B){return d.set(B,1/(E[0]-C[0]),1/(E[1]-C[1]),1/(E[2]-C[2]))}function x(C,E,B,D){return p(C,
E,B,D,Infinity)}function p(C,E,B,D,F){var K=(C[0]-D-E[0])*B[0],L=(C[3]+D-E[0])*B[0];let G=Math.min(K,L);K=Math.max(K,L);L=(C[1]-D-E[1])*B[1];const O=(C[4]+D-E[1])*B[1];K=Math.min(K,Math.max(L,O));if(0>K)return!1;G=Math.max(G,Math.min(L,O));if(G>K)return!1;L=(C[2]-D-E[2])*B[2];C=(C[5]+D-E[2])*B[2];K=Math.min(K,Math.max(L,C));if(0>K)return!1;G=Math.max(G,Math.min(L,C));return G>K?!1:G<F}function h(C,E){E=E?h(E):{};for(const B in C){let D=C[B];D?.forEach&&(D=t(D));null==D&&B in E||(E[B]=D)}return E}
function t(C){const E=[];C.forEach(B=>E.push(B));return E}const r=n.create(),u=f.create(),y=f.create(),z=f.create(),A=f.create();b.colorMixModes={multiply:1,ignore:2,replace:3,tint:4};b.computeInvDir=v;b.computeNormal=w;b.copyParameters=h;b.intersectAabbInvDir=x;b.intersectAabbInvDirBefore=p;b.intersectTriangleGeometry=function(C,E,B,D,F,K){C.visible&&(C.boundingInfo?(q.assert(C.type===k.ContentObjectType.Mesh),m(C.boundingInfo,B,D,E.tolerance,F,K)):(C=C.attributes.get(e.VertexAttribute.POSITION),
E=C.indices,l(B,D,0,E.length/3,E,C,void 0,F,K)))};b.intersectTriangles=l;b.updateParameters=function(C,E){let B=!1;for(const D in E){const F=E[D];void 0!==F&&(Array.isArray(F)?null===C[D]?(C[D]=F.slice(),B=!0):a.update(C[D],F)&&(B=!0):C[D]!==F&&(B=!0,C[D]=F))}return B};b.verticalOffsetAtDistance=function(C,E,B,D,F){let K=(B.screenLength||0)*C.pixelRatio;null!=F&&(K=g.scale(K,D,E,F));return c.clamp(K*Math.tan(.5*C.fovY)/(.5*C.fullHeight)*E,B.minWorldLength||0,null!=B.maxWorldLength?B.maxWorldLength:
Infinity)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/ScaleInfo":function(){define(["exports"],function(b){class a{constructor(){this.factor=new c;this.factorAlignment=new c}}class c{constructor(){this.minScaleFactor=this.factor=this.scale=0}}b.ScaleFactor=c;b.ScaleInfo=a;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/internal/bufferWriterUtils":function(){define(["exports","../../../../../chunks/mat4",
"../../../../../geometry/support/buffer/BufferView","../../lib/Util","../../lib/VertexAttribute"],function(b,a,c,d,f){function n(p,h,t){const {data:r,indices:u}=p;p=h.typedBuffer;h=h.typedBufferStride;const y=u.length;t*=h;for(let z=0;z<y;++z){const A=2*u[z];p[t]=r[A];p[t+1]=r[A+1];t+=h}}function k(p,h,t,r){const {data:u,indices:y}=p;p=h.typedBuffer;h=h.typedBufferStride;const z=y.length;t*=h;if(null==r||1===r)for(r=0;r<z;++r){var A=3*y[r];p[t]=u[A];p[t+1]=u[A+1];p[t+2]=u[A+2];t+=h}else for(A=0;A<
z;++A){const C=3*y[A];for(let E=0;E<r;++E)p[t]=u[C],p[t+1]=u[C+1],p[t+2]=u[C+2],t+=h}}function g(p,h,t,r=1){const {data:u,indices:y}=p;p=h.typedBuffer;h=h.typedBufferStride;const z=y.length;t*=h;if(1===r)for(r=0;r<z;++r){var A=4*y[r];p[t]=u[A];p[t+1]=u[A+1];p[t+2]=u[A+2];p[t+3]=u[A+3];t+=h}else for(A=0;A<z;++A){const C=4*y[A];for(let E=0;E<r;++E)p[t]=u[C],p[t+1]=u[C+1],p[t+2]=u[C+2],p[t+3]=u[C+3],t+=h}}function q(p,h,t,r,u=1){if(h){var {data:y,indices:z}=p;p=t.typedBuffer;t=t.typedBufferStride;var A=
z.length,C=h[0],E=h[1],B=h[2],D=h[4],F=h[5],K=h[6],L=h[8],G=h[9],O=h[10],P=h[12],J=h[13],R=h[14];r*=t;var X=0,U=0,M=0;h=a.hasIdentityRotation(h)?V=>{X=y[V]+P;U=y[V+1]+J;M=y[V+2]+R}:V=>{const Y=y[V],W=y[V+1];V=y[V+2];X=C*Y+D*W+L*V+P;U=E*Y+F*W+G*V+J;M=B*Y+K*W+O*V+R};if(1===u)for(u=0;u<A;++u)h(3*z[u]),p[r]=X,p[r+1]=U,p[r+2]=M,r+=t;else for(let V=0;V<A;++V){h(3*z[V]);for(let Y=0;Y<u;++Y)p[r]=X,p[r+1]=U,p[r+2]=M,r+=t}}else k(p,t,r,u)}function e(p,h,t,r,u=1){if(h){var {data:y,indices:z}=p;p=t.typedBuffer;
t=t.typedBufferStride;var A=z.length,C=h[0],E=h[1],B=h[2],D=h[4],F=h[5],K=h[6],L=h[8],G=h[9],O=h[10],P=!a.isOrthoNormal(h);r*=t;var J=0,R=0,X=0;h=a.hasIdentityRotation(h)?M=>{J=y[M];R=y[M+1];X=y[M+2]}:M=>{const V=y[M],Y=y[M+1];M=y[M+2];J=C*V+D*Y+L*M;R=E*V+F*Y+G*M;X=B*V+K*Y+O*M};if(1===u)if(P)for(u=0;u<A;++u)h(3*z[u]),P=J*J+R*R+X*X,.999999>P&&1E-6<P?(P=1/Math.sqrt(P),p[r]=J*P,p[r+1]=R*P,p[r+2]=X*P):(p[r]=J,p[r+1]=R,p[r+2]=X),r+=t;else for(u=0;u<A;++u)h(3*z[u]),p[r]=J,p[r+1]=R,p[r+2]=X,r+=t;else for(let M=
0;M<A;++M){h(3*z[M]);if(P){var U=J*J+R*R+X*X;.999999>U&&1E-6<U&&(U=1/Math.sqrt(U),J*=U,R*=U,X*=U)}for(U=0;U<u;++U)p[r]=J,p[r+1]=R,p[r+2]=X,r+=t}}else k(p,t,r,u)}function m(p,h,t,r,u=1){if(h){var {data:y,indices:z}=p;p=t.typedBuffer;t=t.typedBufferStride;var A=z.length,C=h[0],E=h[1],B=h[2],D=h[4],F=h[5],K=h[6],L=h[8],G=h[9],O=h[10];h=!a.isOrthoNormal(h);r*=t;if(1===u)for(u=0;u<A;++u){var P=4*z[u],J=y[P],R=y[P+1],X=y[P+2];P=y[P+3];var U=C*J+D*R+L*X,M=E*J+F*R+G*X;J=B*J+K*R+O*X;h&&(R=U*U+M*M+J*J,.999999>
R&&1E-6<R&&(R=1/Math.sqrt(R),U*=R,M*=R,J*=R));p[r]=U;p[r+1]=M;p[r+2]=J;p[r+3]=P;r+=t}else for(P=0;P<A;++P){U=4*z[P];R=y[U];X=y[U+1];const V=y[U+2];U=y[U+3];M=C*R+D*X+L*V;J=E*R+F*X+G*V;R=B*R+K*X+O*V;h&&(X=M*M+J*J+R*R,.999999>X&&1E-6<X&&(X=1/Math.sqrt(X),M*=X,J*=X,R*=X));for(X=0;X<u;++X)p[r]=M,p[r+1]=J,p[r+2]=R,p[r+3]=U,r+=t}}else g(p,t,r,u)}function l(p,h,t,r,u=1){const {data:y,indices:z}=p;var A=t.typedBuffer,C=t.typedBufferStride;p=z.length;r*=C;if(h===y.length&&4===h)for(A[r]=y[0],A[r+1]=y[1],A[r+
2]=y[2],A[r+3]=y[3],A=new Uint32Array(t.typedBuffer.buffer,t.start),C/=4,r/=4,h=A[r],r+=C,p*=u,u=1;u<p;++u)A[r]=h,r+=C;else if(1===u)if(4===h)for(u=0;u<p;++u)h=4*z[u],A[r]=y[h],A[r+1]=y[h+1],A[r+2]=y[h+2],A[r+3]=y[h+3],r+=C;else for(u=0;u<p;++u)h=3*z[u],A[r]=y[h],A[r+1]=y[h+1],A[r+2]=y[h+2],A[r+3]=255,r+=C;else if(4===h)for(h=0;h<p;++h){t=4*z[h];for(var E=0;E<u;++E)A[r]=y[t],A[r+1]=y[t+1],A[r+2]=y[t+2],A[r+3]=y[t+3],r+=C}else for(h=0;h<p;++h)for(t=3*z[h],E=0;E<u;++E)A[r]=y[t],A[r+1]=y[t+1],A[r+2]=
y[t+2],A[r+3]=255,r+=C}function w(p,h,t){const {data:r,indices:u}=p;p=h.typedBuffer;h=h.typedBufferStride;const y=u.length,z=r[0];t*=h;for(let A=0;A<y;++A)p[t]=z,t+=h}function v(p,h,t,r,u=1){const y=h.typedBuffer;h=h.typedBufferStride;r*=h;if(1===u)for(u=0;u<t;++u)y[r]=p[0],y[r+1]=p[1],y[r+2]=p[2],y[r+3]=p[3],r+=h;else for(let z=0;z<t;++z)for(let A=0;A<u;++A)y[r]=p[0],y[r+1]=p[1],y[r+2]=p[2],y[r+3]=p[3],r+=h}function x(p,h,t,r,u,y){switch(p){case f.VertexAttribute.POSITION:d.assert(3===h.size);r=
u.getField(p,c.BufferViewVec3f);d.assert(!!r,`No buffer view for ${p}`);r&&q(h,t,r,y);break;case f.VertexAttribute.NORMAL:d.assert(3===h.size);t=u.getField(p,c.BufferViewVec3f);d.assert(!!t,`No buffer view for ${p}`);t&&e(h,r,t,y);break;case f.VertexAttribute.NORMALCOMPRESSED:d.assert(2===h.size);r=u.getField(p,c.BufferViewVec2i16);d.assert(!!r,`No buffer view for ${p}`);r&&n(h,r,y);break;case f.VertexAttribute.UV0:d.assert(2===h.size);r=u.getField(p,c.BufferViewVec2f);d.assert(!!r,`No buffer view for ${p}`);
r&&n(h,r,y);break;case f.VertexAttribute.COLOR:case f.VertexAttribute.SYMBOLCOLOR:r=u.getField(p,c.BufferViewVec4u8);d.assert(!!r,`No buffer view for ${p}`);d.assert(3===h.size||4===h.size);!r||3!==h.size&&4!==h.size||l(h,h.size,r,y);break;case f.VertexAttribute.COLORFEATUREATTRIBUTE:r=u.getField(p,c.BufferViewFloat);d.assert(!!r,`No buffer view for ${p}`);d.assert(1===h.size);r&&1===h.size&&w(h,r,y);break;case f.VertexAttribute.TANGENT:d.assert(4===h.size);t=u.getField(p,c.BufferViewVec4f);d.assert(!!t,
`No buffer view for ${p}`);t&&m(h,r,t,y);break;case f.VertexAttribute.PROFILERIGHT:case f.VertexAttribute.PROFILEUP:case f.VertexAttribute.PROFILEVERTEXANDNORMAL:case f.VertexAttribute.FEATUREVALUE:d.assert(4===h.size),r=u.getField(p,c.BufferViewVec4f),d.assert(!!r,`No buffer view for ${p}`),r&&g(h,r,y)}}b.writeBufferFloat=function(p,h,t,r=1){const {data:u,indices:y}=p;p=h.typedBuffer;h=h.typedBufferStride;const z=y.length;t*=h;if(1===r)for(r=0;r<z;++r)p[t]=u[y[r]],t+=h;else for(let A=0;A<z;++A){const C=
u[y[A]];for(let E=0;E<r;E++)p[t]=C,t+=h}};b.writeBufferMat3f=function(p,h,t){const {data:r,indices:u}=p;p=h.typedBuffer;h=h.typedBufferStride;const y=u.length;t*=h;for(let z=0;z<y;++z){const A=9*u[z];for(let C=0;9>C;++C)p[t+C]=r[A+C];t+=h}};b.writeBufferMat4f=function(p,h,t){const {data:r,indices:u}=p;p=h.typedBuffer;h=h.typedBufferStride;const y=u.length;t*=h;for(let z=0;z<y;++z){const A=16*u[z];for(let C=0;16>C;++C)p[t+C]=r[A+C];t+=h}};b.writeBufferVec2=n;b.writeBufferVec3=k;b.writeBufferVec4=g;
b.writeBufferVec4Zeros=function(p,h,t){const r=p.typedBuffer;p=p.typedBufferStride;h*=p;for(let u=0;u<t;++u)r[h]=0,r[h+1]=0,r[h+2]=0,r[h+3]=0,h+=p};b.writeColor=l;b.writeColorFeatureAttribute=w;b.writeDefaultAttribute=x;b.writeDefaultAttributes=function(p,h,t,r,u,y){for(const A of h.fields.keys()){h=p.attributes.get(A);var z=h?.indices;h&&z?x(A,h,t,r,u,y):A===f.VertexAttribute.OBJECTANDLAYERIDCOLOR&&null!=p.objectAndLayerIdColor&&(h=p.attributes.get(f.VertexAttribute.POSITION)?.indices)&&(h=h.length,
z=u.getField(A,c.BufferViewVec4u8),v(p.objectAndLayerIdColor,z,h,y))}};b.writeNormal=e;b.writeObjectAndLayerIdColor=v;b.writePosition=q;b.writeTangent=m;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/HUDMaterial.glsl":function(){define("exports ./vec2 ./vec2f64 ./vec4f64 ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/ObjectAndLayerIdColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUDOcclusionPass.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUDVisibility.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A,C,E,B){function D(L){const G=new A.ShaderBuilder;var O=L.signedDistanceFieldEnabled;G.include(q.HUD,L);G.include(n.SliceDraw,L);if(L.occlusionPass)return G.include(e.HUDOcclusionPass,L),G;const {vertex:P,fragment:J}=G;G.include(h.ScreenSizePerspective);J.include(p.RgbaFloatEncoding);J.include(x.ColorConversion);G.include(w.VisualVariables,L);G.include(k.ObjectAndLayerIdColor,L);G.include(m.HUDVisibility);G.varyings.add("vcolor","vec4");G.varyings.add("vtc",
"vec2");G.varyings.add("vsize","vec2");G.varyings.add("voccluded","float");P.uniforms.add(new u.Float4PassUniform("viewport",(U,M)=>M.camera.fullViewport),new r.Float2PassUniform("screenOffset",(U,M)=>a.set(K,2*U.screenOffset[0]*M.camera.pixelRatio,2*U.screenOffset[1]*M.camera.pixelRatio)),new r.Float2PassUniform("anchorPosition",U=>F(U)),new u.Float4PassUniform("materialColor",U=>U.color));t.addPixelRatio(P);O&&(P.uniforms.add(new u.Float4PassUniform("outlineColor",U=>U.outlineColor)),J.uniforms.add(new u.Float4PassUniform("outlineColor",
U=>0<U.outlineColor[3]&&0<U.outlineSize?U.outlineColor:d.ZEROS),new y.FloatPassUniform("outlineSize",U=>0<U.outlineColor[3]&&0<U.outlineSize?U.outlineSize:0)));L.pixelSnappingEnabled&&P.include(g.AlignPixel);L.hasScreenSizePerspective&&(h.addScreenSizePerspective(P),h.addScreenSizePerspectiveAlignment(P));L.debugDrawLabelBorder&&G.varyings.add("debugBorderCoords","vec4");G.attributes.add(B.VertexAttribute.UV0,"vec2");G.attributes.add(B.VertexAttribute.COLOR,"vec4");G.attributes.add(B.VertexAttribute.SIZE,
"vec2");G.attributes.add(B.VertexAttribute.FEATUREATTRIBUTE,"vec4");P.code.add(z.glsl`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${L.hasScreenSizePerspective?z.glsl`
            inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
            vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:z.glsl`
            inputSize = size;
            vec2 screenOffsetScaled = screenOffset;`}

      ${L.vvSize?"inputSize *\x3d vvScale(featureAttribute).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);
      bool visible = testHUDVisibility(posProj);
      voccluded = visible ? 0.0 : 1.0;
    `);var R=z.glsl`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`;const X=L.pixelSnappingEnabled?O?z.glsl`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:z.glsl`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:z.glsl`posProj += quadOffset;`;P.code.add(z.glsl`
    ${L.occlusionTestEnabled?"if (visible) {":""}
    ${R}
    ${L.vvColor?"vcolor \x3d interpolateVVColor(featureAttribute.y) * materialColor;":"vcolor \x3d color / 255.0 * materialColor;"}

    ${L.output===f.ShaderOutput.ObjectAndLayerIdColor?z.glsl`vcolor.a = 1.0;`:""}

    bool alphaDiscard = vcolor.a < ${z.glsl.float(v.symbolAlphaCutoff)};
    ${O?`alphaDiscard = alphaDiscard && outlineColor.a < ${z.glsl.float(v.symbolAlphaCutoff)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${X}
      gl_Position = posProj;
    }

    vtc = uv;

    ${L.debugDrawLabelBorder?"debugBorderCoords \x3d vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${L.occlusionTestEnabled?z.glsl`} else { vtc = vec2(0.0);
      ${L.debugDrawLabelBorder?"debugBorderCoords \x3d vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `);J.uniforms.add(new C.Texture2DPassUniform("tex",U=>U.texture));R=L.debugDrawLabelBorder?z.glsl`(isBorder > 0.0 ? 0.0 : ${z.glsl.float(v.defaultMaskAlphaCutoff)})`:z.glsl.float(v.defaultMaskAlphaCutoff);O=z.glsl`
    ${L.debugDrawLabelBorder?z.glsl`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${L.sampleSignedDistanceFieldTexelCenter?z.glsl`
      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      float txSize = float(textureSize(tex, 0).x);
      float texelSize = 1.0 / txSize;

      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;
      `:z.glsl`
      vec2 samplePos = vtc;
      `}

    ${O?z.glsl`
      vec4 fillPixelColor = vcolor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${R} ||
          fillPixelColor.a + outlinePixelColor.a < ${z.glsl.float(v.symbolAlphaCutoff)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        fragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${R}) {
          discard;
        }

        fragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // fragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:z.glsl`
          vec4 texColor = texture(tex, vtc, -0.5);
          if (texColor.a < ${R}) {
            discard;
          }
          fragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${L.debugDrawLabelBorder?z.glsl`fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;switch(L.output){case f.ShaderOutput.Color:J.code.add(z.glsl`
        void main() {
          ${O}
          ${L.transparencyPassType===E.TransparencyPassType.FrontFace?"fragColor.rgb /\x3d fragColor.a;":""}
        }`);break;case f.ShaderOutput.Alpha:J.code.add(z.glsl`
        void main() {
          ${O}
          fragColor = vec4(fragColor.a);
        }`);break;case f.ShaderOutput.ObjectAndLayerIdColor:J.code.add(z.glsl`
        void main() {
          ${O}
          outputObjectAndLayerIdColor();
        }`);break;case f.ShaderOutput.Highlight:J.constants.add("occludedHighlightFlag","vec4",l.occludedHighlightFlag).add("unoccludedHighlightFlag","vec4",l.unoccludedHighlightFlag),J.code.add(z.glsl`
        void main() {
          ${O}
          if (voccluded == 1.0) {
            fragColor = occludedHighlightFlag;
          } else {
            fragColor = unoccludedHighlightFlag;
          }
        }`)}return G}function F(L,G=K){if(L.textureIsSignedDistanceField){var O=L.anchorPosition;L=L.distanceFieldBoundingBox;null!=L?a.set(G,O[0]*(L[2]-L[0])+L[0],O[1]*(L[3]-L[1])+L[1]):a.set(G,0,0)}else a.copy(G,L.anchorPosition);return G}const K=c.create();c=Object.freeze(Object.defineProperty({__proto__:null,build:D,calculateAnchorPosForRendering:F},Symbol.toStringTag,{value:"Module"}));b.HUDMaterial=c;b.build=D;b.calculateAnchorPosForRendering=F})},"esri/views/3d/webgl-engine/core/shaderLibrary/Slice.glsl":function(){define("exports ../../../../../chunks/mat4 ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../shaderModules/Float3DrawUniform ../shaderModules/Float3PassUniform ../shaderModules/interfaces".split(" "),
function(b,a,c,d,f,n,k,g){function q(u,y,...z){if(y.hasSlicePlane){y.hasSliceInVertexProgram&&u.vertex.uniforms.add(...z);u.fragment.uniforms.add(...z);z=g.glsl`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`;var A=g.glsl`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`;A=y.hasSliceHighlight?g.glsl`
        ${A}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:g.glsl`#define highlightSlice(_color_, _pos_) (_color_)`;y.hasSliceInVertexProgram&&u.vertex.code.add(z);u.fragment.code.add(z);u.fragment.code.add(A)}else z=g.glsl`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`,y.hasSliceInVertexProgram&&u.vertex.code.add(z),u.fragment.code.add(z)}function e(u,y,z){return u.instancedDoublePrecision?d.set(p,z.camera.viewInverseTransposeMatrix[3],z.camera.viewInverseTransposeMatrix[7],z.camera.viewInverseTransposeMatrix[11]):y.slicePlaneLocalOrigin}function m(u,y){return null!=u?d.subtract(h,y.origin,u):y.origin}function l(u,y,z){return u.hasSliceTranslatedView?null!=y?a.translate(r,z.camera.viewMatrix,y):z.camera.viewMatrix:
null}function w(u,y,z){if(null==z.slicePlane)return f.ZEROS;const A=e(u,y,z);y=m(A,z.slicePlane);u=l(u,A,z);return null!=u?d.transformMat4(h,y,u):y}function v(u,y,z,A){if(null==A||null==z.slicePlane)return f.ZEROS;const C=e(u,y,z);y=m(C,z.slicePlane);u=l(u,C,z);return null!=u?(d.add(t,A,y),d.transformMat4(h,y,u),d.transformMat4(t,t,u),d.subtract(t,t,h)):A}class x extends g.NoParameters{constructor(u){super();this.slicePlaneLocalOrigin=u}}const p=f.create(),h=f.create(),t=f.create(),r=c.create();b.SliceDraw=
function(u,y){q(u,y,new n.Float3DrawUniform("slicePlaneOrigin",(z,A)=>w(y,z,A)),new n.Float3DrawUniform("slicePlaneBasis1",(z,A)=>v(y,z,A,A.slicePlane?.basis1)),new n.Float3DrawUniform("slicePlaneBasis2",(z,A)=>v(y,z,A,A.slicePlane?.basis2)))};b.SlicePass=function(u,y){q(u,y,new k.Float3PassUniform("slicePlaneOrigin",(z,A)=>w(y,z,A)),new k.Float3PassUniform("slicePlaneBasis1",(z,A)=>v(y,z,A,A.slicePlane?.basis1)),new k.Float3PassUniform("slicePlaneBasis2",(z,A)=>v(y,z,A,A.slicePlane?.basis2)))};b.SlicePlaneParameters=
x;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/ObjectAndLayerIdColor.glsl":function(){define(["exports","../ShaderOutput","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(b,a,c,d){b.ObjectAndLayerIdColor=function(f,n){const k=n.output===a.ShaderOutput.ObjectAndLayerIdColor;n=n.objectAndLayerIdColorInstanced;k&&(f.varyings.add("objectAndLayerIdColorVarying","vec4"),n?f.attributes.add(d.VertexAttribute.INSTANCEOBJECTANDLAYERIDCOLOR,
"vec4"):f.attributes.add(d.VertexAttribute.OBJECTANDLAYERIDCOLOR,"vec4"));f.vertex.code.add(c.glsl`
     void forwardObjectAndLayerIdColor() {
      ${k?n?c.glsl`objectAndLayerIdColorVarying = instanceObjectAndLayerIdColor * 0.003921568627451;`:c.glsl`objectAndLayerIdColorVarying = objectAndLayerIdColor * 0.003921568627451;`:c.glsl``} }`);f.fragment.code.add(c.glsl`
      void outputObjectAndLayerIdColor() {
        ${k?c.glsl`fragColor = objectAndLayerIdColorVarying;`:c.glsl``} }`)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl":function(){define(["exports","../../shaderModules/BooleanPassUniform","../../shaderModules/interfaces"],function(b,a,c){b.AlignPixel=function(d){d.uniforms.add(new a.BooleanPassUniform("alignPixelEnabled",(f,n)=>n.alignPixelEnabled));d.code.add(c.glsl`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`);d.code.add(c.glsl`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUDOcclusionPass.glsl":function(){define(["exports","./AlignPixel.glsl","../shading/MultipassGeometryTest.glsl","../shading/MultipassTerrainTest.glsl","../../shaderModules/interfaces"],function(b,a,c,d,f){b.HUDOcclusionPass=function(n,k){const {vertex:g,fragment:q}=n;g.include(a.AlignPixel);k.multipassEnabled&&(g.include(c.multipassGeometryTest),n.varyings.add("depth","float"));
g.code.add(f.glsl`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${k.multipassEnabled?f.glsl`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${k.multipassEnabled?"depth \x3d projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `);n.include(d.multipassTerrainTest,k);q.code.add(f.glsl`
  void main() {
    fragColor = vec4(1);
    ${k.multipassEnabled?f.glsl`
        if(terrainDepthTest(depth)) {
          fragColor.g = 0.5;
        }`:""}
  }
  `)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUDVisibility.glsl":function(){define("exports ./AlignPixel.glsl ./HUDRenderStyle ../../shaderModules/Float4PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform".split(" "),function(b,a,c,d,f,n,k){b.HUDVisibility=function(g){g.vertex.uniforms.add(new f.FloatPassUniform("renderTransparentlyOccludedHUD",(q,e)=>e.hudRenderStyle===
c.HUDRenderStyle.Occluded?1:e.hudRenderStyle===c.HUDRenderStyle.NotOccluded?0:.75),new d.Float4PassUniform("viewport",(q,e)=>e.camera.fullViewport),new k.Texture2DPassUniform("hudVisibilityTexture",(q,e)=>e.hudVisibility?.colorTexture));g.vertex.include(a.AlignPixel);g.vertex.code.add(n.glsl`bool testHUDVisibility(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl":function(){define(["exports","../../../../../../chunks/vec4f64","../../shaderModules/interfaces","../../shaderModules/Texture2DPassUniform"],function(b,a,c,d){const f=a.fromValues(1,1,0,1),n=a.fromValues(1,0,1,1);b.OutputHighlight=function(k){k.fragment.uniforms.add(new d.Texture2DPassUniform("depthTexture",(g,q)=>q.mainDepth));k.fragment.constants.add("occludedHighlightFlag",
"vec4",f).add("unoccludedHighlightFlag","vec4",n);k.fragment.code.add(c.glsl`void outputHighlight() {
float sceneDepth = float(texelFetch(depthTexture, ivec2(gl_FragCoord.xy), 0).x);
if (gl_FragCoord.z > sceneDepth + 5e-7) {
fragColor = occludedHighlightFlag;
} else {
fragColor = unoccludedHighlightFlag;
}
}`)};b.occludedHighlightFlag=f;b.unoccludedHighlightFlag=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl":function(){define("exports ../../shaderModules/Float3PassUniform ../../shaderModules/Float4sPassUniform ../../shaderModules/FloatsPassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix3PassUniform ../../../lib/VertexAttribute ../../../materials/VisualVariablePassParameters".split(" "),
function(b,a,c,d,f,n,k,g){b.VisualVariables=function(q,e){const {vertex:m,attributes:l}=q;e.hasVvInstancing&&(e.vvSize||e.vvColor)&&l.add(k.VertexAttribute.INSTANCEFEATUREATTRIBUTE,"vec4");e.vvSize?(m.uniforms.add(new a.Float3PassUniform("vvSizeMinSize",w=>w.vvSize.minSize)),m.uniforms.add(new a.Float3PassUniform("vvSizeMaxSize",w=>w.vvSize.maxSize)),m.uniforms.add(new a.Float3PassUniform("vvSizeOffset",w=>w.vvSize.offset)),m.uniforms.add(new a.Float3PassUniform("vvSizeFactor",w=>w.vvSize.factor)),
m.uniforms.add(new n.Matrix3PassUniform("vvSymbolRotationMatrix",w=>w.vvSymbolRotationMatrix)),m.uniforms.add(new a.Float3PassUniform("vvSymbolAnchor",w=>w.vvSymbolAnchor)),m.code.add(f.glsl`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),m.code.add(f.glsl`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${e.hasVvInstancing?f.glsl`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):m.code.add(f.glsl`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`);e.vvColor?(m.constants.add("vvColorNumber","int",g.vvColorNumber),m.uniforms.add(new d.FloatsPassUniform("vvColorValues",w=>w.vvColor.values,g.vvColorNumber),new c.Float4sPassUniform("vvColorColors",w=>w.vvColor.colors,g.vvColorNumber)),m.code.add(f.glsl`
      vec4 interpolateVVColor(float value) {
        if (value <= vvColorValues[0]) {
          return vvColorColors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (vvColorValues[i] >= value) {
            float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
            return mix(vvColorColors[i-1], vvColorColors[i], f);
          }
        }
        return vvColorColors[vvColorNumber - 1];
      }

      vec4 vvGetColor(vec4 featureAttribute) {
        return interpolateVVColor(featureAttribute.y);
      }

      ${e.hasVvInstancing?f.glsl`
            vec4 vvColor() {
              return vvGetColor(instanceFeatureAttribute);
            }`:"vec4 vvColor() { return vec4(1.0); }"}
    `)):m.code.add(f.glsl`vec4 vvColor() { return vec4(1.0); }`)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Float4sPassUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(b,a,c){class d extends a.Uniform{constructor(f,n,k){super(f,"vec4",c.BindType.Pass,(g,q,e)=>g.setUniform4fv(f,n(q,e)),k)}}b.Float4sPassUniform=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/FloatsPassUniform":function(){define(["exports",
"./Uniform","../shaderTechnique/BindType"],function(b,a,c){class d extends a.Uniform{constructor(f,n,k){super(f,"float",c.BindType.Pass,(g,q,e)=>g.setUniform1fv(f,n(q,e)),k)}}b.FloatsPassUniform=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/VisualVariablePassParameters":function(){define(["exports","../../layers/support/FastSymbolUpdates","../lib/Material"],function(b,a,c){class d extends a.VisualVariablesParameters{constructor(){super(...arguments);
this.renderOccluded=c.RenderOccludedFlag.Occlude;this.isDecoration=!1}}b.VisualVariablePassParameters=d;b.vvColorNumber=8;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff":function(){define(["exports"],function(b){b.defaultMaskAlphaCutoff=.1;b.symbolAlphaCutoff=.001;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/HUDMaterialTechnique":function(){define("require exports ../../../ViewingMode ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../lib/TransparencyPassType ../../../../chunks/HUDMaterial.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w){class v extends n.ShaderTechnique{initializeConfiguration(h,t){t.spherical=h.viewingMode===c.ViewingMode.Global}initializeProgram(h){return new q.Program(h.rctx,v.shader.get().build(this.configuration),k.Default3D)}initializePipeline(){const h=this.configuration.transparencyPassType,t=this.configuration,r=h===e.TransparencyPassType.NONE;var u=h===e.TransparencyPassType.FrontFace;const y=this.configuration.hasPolygonOffset?x:null;u=(r||u)&&t.output!==d.ShaderOutput.Highlight?
t.depthEnabled||t.occlusionPass?w.defaultDepthWriteParams:null:null;return w.makePipelineState({blending:t.output===d.ShaderOutput.Color||t.output===d.ShaderOutput.Alpha||t.output===d.ShaderOutput.Highlight?r?p:g.oitBlending(h):null,depthTest:{func:l.CompareFunction.LEQUAL},depthWrite:u,colorWrite:w.defaultColorWriteParams,polygonOffset:y})}get primitiveType(){return this.configuration.occlusionPass?l.PrimitiveType.POINTS:l.PrimitiveType.TRIANGLES}}v.shader=new f.ReloadableShaderModule(m.HUDMaterial,
()=>new Promise((h,t)=>b(["./HUDMaterial.glsl"],h,t)));const x={factor:0,units:-4},p=w.simpleBlendingParams(l.BlendFactor.ONE,l.BlendFactor.ONE_MINUS_SRC_ALPHA);a.HUDMaterialTechnique=v;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/OrderIndependentTransparency":function(){define(["exports","./TransparencyPassType","../../../webgl/enums","../../../webgl/renderState"],function(b,a,c,d){const f=d.separateBlendingParams(c.BlendFactor.SRC_ALPHA,c.BlendFactor.ONE,
c.BlendFactor.ONE_MINUS_SRC_ALPHA,c.BlendFactor.ONE_MINUS_SRC_ALPHA),n=d.simpleBlendingParams(c.BlendFactor.ONE,c.BlendFactor.ONE),k=d.simpleBlendingParams(c.BlendFactor.ZERO,c.BlendFactor.ONE_MINUS_SRC_ALPHA),g={factor:-1,units:-2};b.OITPolygonOffset=g;b.OITPolygonOffsetLimit=5E5;b.blendingAlpha=k;b.blendingColor=n;b.blendingDefault=f;b.getOITPolygonOffset=function(q){return q?g:null};b.oitBlending=function(q){return q===a.TransparencyPassType.FrontFace?null:q===a.TransparencyPassType.Alpha?k:n};
b.oitDepthTest=function(q,e=c.CompareFunction.LESS){return q===a.TransparencyPassType.NONE||q===a.TransparencyPassType.FrontFace?e:c.CompareFunction.LEQUAL};b.oitDepthWrite=function(q){return q===a.TransparencyPassType.FrontFace?d.defaultDepthWriteParams:null};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/HUDMaterialTechniqueConfiguration":function(){define("exports ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/TransparencyPassType ../materials/DefaultTechniqueConfiguration".split(" "),
function(b,a,c,d,f,n){class k extends n.DefaultTechniqueConfiguration{constructor(){super(...arguments);this.output=c.ShaderOutput.Color;this.transparencyPassType=f.TransparencyPassType.NONE;this.spherical=this.screenCenterOffsetUnitsEnabled=!1;this.occlusionTestEnabled=!0;this.hasPolygonOffset=this.hasSlicePlane=this.debugDrawLabelBorder=this.hasScreenSizePerspective=this.hasVerticalOffset=this.vvColor=this.vvSize=this.sampleSignedDistanceFieldTexelCenter=this.signedDistanceFieldEnabled=!1;this.pixelSnappingEnabled=
this.depthEnabled=!0;this.objectAndLayerIdColorInstanced=this.occlusionPass=this.cullAboveGround=this.multipassEnabled=this.draped=!1}}a.__decorate([d.parameter({count:c.ShaderOutput.COUNT})],k.prototype,"output",void 0);a.__decorate([d.parameter({count:f.TransparencyPassType.COUNT})],k.prototype,"transparencyPassType",void 0);a.__decorate([d.parameter()],k.prototype,"screenCenterOffsetUnitsEnabled",void 0);a.__decorate([d.parameter()],k.prototype,"spherical",void 0);a.__decorate([d.parameter()],
k.prototype,"occlusionTestEnabled",void 0);a.__decorate([d.parameter()],k.prototype,"signedDistanceFieldEnabled",void 0);a.__decorate([d.parameter()],k.prototype,"sampleSignedDistanceFieldTexelCenter",void 0);a.__decorate([d.parameter()],k.prototype,"vvSize",void 0);a.__decorate([d.parameter()],k.prototype,"vvColor",void 0);a.__decorate([d.parameter()],k.prototype,"hasVerticalOffset",void 0);a.__decorate([d.parameter()],k.prototype,"hasScreenSizePerspective",void 0);a.__decorate([d.parameter()],k.prototype,
"debugDrawLabelBorder",void 0);a.__decorate([d.parameter()],k.prototype,"hasSlicePlane",void 0);a.__decorate([d.parameter()],k.prototype,"hasPolygonOffset",void 0);a.__decorate([d.parameter()],k.prototype,"depthEnabled",void 0);a.__decorate([d.parameter()],k.prototype,"pixelSnappingEnabled",void 0);a.__decorate([d.parameter()],k.prototype,"draped",void 0);a.__decorate([d.parameter()],k.prototype,"multipassEnabled",void 0);a.__decorate([d.parameter()],k.prototype,"cullAboveGround",void 0);a.__decorate([d.parameter()],
k.prototype,"occlusionPass",void 0);a.__decorate([d.parameter()],k.prototype,"objectAndLayerIdColorInstanced",void 0);a.__decorate([d.parameter({constValue:!0})],k.prototype,"hasSliceInVertexProgram",void 0);a.__decorate([d.parameter({constValue:!1})],k.prototype,"hasVvInstancing",void 0);b.HUDMaterialTechniqueConfiguration=k;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/LabelDeconflictor":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ./Deconflictor ./enums ../../../support/RenderState ../../../support/Scheduler".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m){b.LabelDeconflictor=class extends g.Deconflictor{constructor(l){super(l);this.visibilityGroup=q.VisibilityGroup.LABEL;this.marginFactor=.05;this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(l){if(this.parent.running)return m.Task.YIELD;const w=performance.now();if(l.state!==e.RenderState.IDLE&&2E3>w-this._lastDeconfliction)return m.Task.YIELD;super.runTask(l);this.state===g.State.Idle&&(this._lastDeconfliction=w)}enabledChanged(l,w){this.modifyGraphics(w,
l.labelsEnabled)}getGraphicsLayers(l){return l.labelLayers}};a.__decorate([c.property({constructOnly:!0})],b.LabelDeconflictor.prototype,"parent",void 0);b.LabelDeconflictor=a.__decorate([k.subclass("esri.views.3d.layers.graphics.LabelDeconflictor")],b.LabelDeconflictor);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Labeler":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/asyncUtils ../../../../core/Logger ../../../../core/MapUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec2f64 ../../../../layers/graphics/hydratedFeatures ../../../../layers/support/labelFormatUtils ../../../../symbols/callouts/calloutUtils ./enums ./Graphics3DCalloutSymbolLayerFactory ./Graphics3DLineCalloutSymbolLayer ./graphicSymbolUtils ./LabelParameters ./labelPlacement ./placementUtils ../../webgl-engine/lib/MaterialCollection ../../webgl-engine/lib/TextRenderer ../../webgl-engine/lib/TextRenderParameters ../../webgl-engine/lib/TextTextureAtlas ../../webgl-engine/lib/WebGLLayer ../../../support/Scheduler".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A,C,E,B,D,F,K,L,G){function O(M){return!M||0===M.length}function P(M){return!0===M.labelsVisible&&!!M.labelingInfo?.some(V=>!!V.symbol)}class J{constructor(M,V){this.labelingContext=M;this.graphics3DGraphic=V;this.textInitialized=this.addedToTextureAtlas=this.visible=this.hasGraphics3DResources=!1;this.textRenderers=[];this.textLabelPlacements=[]}}class R{constructor(M,V,Y,W,H){this.labelClass=M;this.graphics3DSymbol=V;this.graphics3DCalloutSymbolLayer=
Y;this.textRenderParameters=W;this.labelFunction=H;this.calloutSymbolLayerIndex=0}}class X{constructor(M,V,Y,W,H,S,I,Q){this.layer=V;this.graphics3DCore=Y;this.scaleVisibility=W;this.emptySymbolLabelSupported=H;this.elevationInfoOverride=S;this.disablePlacement=I;this.active=Q;this.labelClassAbortController=new AbortController;this.labelClassContexts=[];this.graphics=new Map;this.labelsToInitialize=new Map;this.stageLayer=new L.WebGLLayer(M,{pickable:!0,disableOctree:!0},V.uid)}destroy(){this.stageLayer.destroy()}}
b.Labeler=class extends c{constructor(M){super(M);this._dirty=!1;this._labels=new Map;this._labelingContexts=[]}setup(){this.dispose();this.addHandles([q.watch(()=>this.view.state?.camera,()=>this.setDirty()),q.watch(()=>this.view.state?.rasterPixelRatio,()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(G.TaskPriority.LABELER,this)]);this._textTextureAtlas=new K.TextTextureAtlas({view:this.view});this._hudMaterialCollection=new B.MaterialCollection(this.view._stage);
this._calloutMaterialCollection=new B.MaterialCollection(this.view._stage)}dispose(){this.removeAllHandles();this._textTextureAtlas=k.disposeMaybe(this._textTextureAtlas);this._hudMaterialCollection=k.disposeMaybe(this._hudMaterialCollection);this._calloutMaterialCollection=k.disposeMaybe(this._calloutMaterialCollection);this._labelingContexts.length=0;this._labels.clear()}destroy(){this.dispose();U.graphic=null;U.renderingInfo=null;U.layer=null}_activateLabelingContext(M){M.graphics.forEach((V,Y)=>
{const W=new J(M,V);this._labels.set(Y,W);M.labelsToInitialize.set(Y,W);V.setVisibilityFlag(r.VisibilityGroup.LABEL,r.VisibilityFlag.USER,!0)});M.active=!0}_deactivateLabelingContext(M){M.graphics.forEach((V,Y)=>{V.setVisibilityFlag(r.VisibilityGroup.LABEL,r.VisibilityFlag.USER,!1);this.setLabelGraphicVisibility(V,!1);this._labels.delete(Y)});M.active=!1}_addLabelTextureToAtlas(M){for(const V of M.graphics3DGraphic.labelLayers){if(!V._labelClass)continue;const Y=M.textRenderers[V._labelIndex];Y&&
(this._textTextureAtlas.addTextTexture(Y,V.stageObject),M.addedToTextureAtlas=!0)}}_removeLabelTextureFromAtlas(M){for(const V of M.graphics3DGraphic.labelLayers){if(!V._labelClass)continue;const Y=M.textRenderers[V._labelIndex];null!=Y&&(this._textTextureAtlas.removeTextTexture(Y,V.stageObject),M.addedToTextureAtlas=!1)}}get running(){return this.view.ready&&(this._dirty||this.deconflictor.running)}runTask(M){this._updateLabels(M);!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(M);
return G.Task.YIELD}_updateLabels(M){if(this._dirty){this._dirty=!1;for(const V of this._labelingContexts)V.active&&(V.labelClassPromise&&V.labelClassAbortController?this._dirty=!0:O(V.labelClassContexts)?null===V.labelClassContexts?this._deactivateLabelingContext(V):(this._createLabelClassContext(V),this._dirty=!0):n.someMap(V.labelsToInitialize,(Y,W)=>{this._ensureGraphics3DResources(Y)&&(this._labels.set(W,Y),this.deconflictor.setDirty(),M.madeProgress());if(Y.visible&&Y.textInitialized||!Y.visible&&
Y.hasGraphics3DResources)V.labelsToInitialize.delete(W),M.madeProgress();return M.done})&&(this._dirty=!0));this._dirty||this.notifyChange("updating")}}async _createLabelClassContextAsync(M){const V=M.labelClassAbortController?.signal;M.layer.when&&await M.layer.when();g.throwIfAborted(V);M.scaleVisibility&&M.scaleVisibility.updateScaleRangeActive();const Y=M.graphics3DCore,W=Y.layer.labelingInfo?.filter(H=>!!H.symbol);W&&0!==W.length&&(await d.forEach(W,async(H,S)=>{var I=H.symbol;const Q=z.getGraphics3DSymbol(Y.getOrCreateGraphics3DSymbol(I));
if(null==Q)f.getLogger(this).error("Failed to create Graphics3DSymbol for label");else{await Q.load();g.throwIfAborted(V);var N=null;t.hasCalloutSupport(I)&&I.hasVisibleCallout()&&(N=u.make(I,Y.symbolCreationContext),await N.load(),g.throwIfAborted(V));I=await d.result(h.createLabelFunction(H,M.layer.fieldsIndex,this.view.spatialReference));g.throwIfAborted(V);if(!0===I.ok){const T=await this._createTextRenderParameters(Q.symbol);g.throwIfAborted(V);M.labelClassContexts[S]=new R(H,Q,N,T,I.value)}else f.getLogger(this).error(`Label expression failed to evaluate: ${I.error}`)}}),
g.throwIfAborted(V))}async _createLabelClassContext(M){null==M.labelClassPromise&&(M.labelClassPromise=this._createLabelClassContextAsync(M).catch(V=>{if(g.isAbortError(V))throw V;M.labelClassContexts.length=0}).then(()=>{M.labelClassAbortController=null;this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating"));return M.labelClassPromise}async _createTextRenderParameters(M){M=M.symbolLayers.at(0);return"text"!==M?.type?null:F.TextRenderParameters.fromSymbol(M,this.view.state.rasterPixelRatio)}_destroyLabelClassContext(M){for(var V of M.labelClassContexts)--V.graphics3DSymbol.referenced;
V=M.labelClassAbortController;M.labelClassAbortController=new AbortController;k.abortMaybe(V);M.labelClassContexts.length=0;M.labelClassPromise=null;this.notifyChange("updating")}_createTextSymbolGraphic(M,V,Y,W,H,S){M=new A.LabelParameters(Y,E.horizontalPlacementFromAnchor(Y.anchor),E.verticalPlacementFromAnchor(Y.anchor),M.text,x.fromValues(M.displayWidth,M.displayHeight));U.graphic=V;U.renderingInfo=null;U.layer=W;return H.createLabel(U,M,this._hudMaterialCollection,this._textTextureAtlas,()=>
{const I=C.getLabelPlacement(S);return I?I.elevationOffset:null})}_createLineCalloutGraphic(M,V,Y,W,H){U.graphic=M;U.layer=H;U.renderingInfo=new y.LineCalloutSymbolLayerRenderingInfo(null,V,W.translation,W.centerOffset,W.screenOffset[0],W.centerOffsetUnits,W.elevationOffset,this._calloutMaterialCollection);return Y.createGraphics3DGraphic(U)}_ensureGraphics3DResources(M){if(M.hasGraphics3DResources)return!1;const V=M.graphics3DGraphic;if(V.destroyed)return!1;this._ensureTextTextureResources(M);const Y=
M.labelingContext,W=Y.labelClassContexts;if(O(W)||!Y.emptySymbolLabelSupported&&0===V.layers.length)return!1;var H=!1,S=V.graphic;const I=Y.layer;var Q=P(Y.layer);for(let T=0;T<W.length;T++){const aa=M.textRenderers[T],Z=M.textLabelPlacements[T];if(null==aa||null==Z)continue;const da=W[T];var N=da.graphics3DSymbol;const fa=N.symbol&&"label-3d"===N.symbol.type?N.symbol:null;if(N=N.symbolLayers[0]){N.setElevationInfoOverride(Y.elevationInfoOverride);H=new C.LabelInfo(V,fa,da.labelClass);H=this._createTextSymbolGraphic(aa,
S,Z,I,N,H);if(null==H)return!1;H._labelClass=da.labelClass;H._labelIndex=T;V.addLabelGraphic(H,Y.stageLayer);V.deconflictionPriority=da.textRenderParameters?.definition.size??0;V.setVisibilityFlag(r.VisibilityGroup.LABEL,r.VisibilityFlag.USER,Q);V.setVisibilityFlag(r.VisibilityGroup.LABEL,r.VisibilityFlag.SCALE_RANGE,!0);V.setVisibilityFlag(r.VisibilityGroup.LABEL,r.VisibilityFlag.DECONFLICTION,!1);H=!0;(Q=da.graphics3DCalloutSymbolLayer)&&Z.hasLabelVerticalOffset&&(Q.setElevationInfoOverride(Y.elevationInfoOverride),
S=this._createLineCalloutGraphic(S,fa,Q,Z,I),null!=S&&(da.calloutSymbolLayerIndex=V.labelLayers.length,V.addLabelGraphic(S,Y.stageLayer)));break}}Y.scaleVisibility&&H&&Y.scaleVisibility.updateGraphicLabelScaleVisibility(V);return M.hasGraphics3DResources=!0}_destroyGraphics3DResources(M){const V=M.labelingContext.labelClassContexts;for(const Y of M.graphics3DGraphic.labelLayers)if(null!=Y._labelClass)V[Y._labelIndex].graphics3DSymbol.symbolLayers[0]?.onRemoveGraphic(Y);M.graphics3DGraphic.deconflictionPriority=
0;M.graphics3DGraphic.clearLabelGraphics();M.hasGraphics3DResources=!1}_ensureTextTextureResources(M){if(!M.textInitialized){var V=M.labelingContext,Y=V.labelClassContexts;if(!O(Y)){var W=M.graphics3DGraphic.graphic;for(let I=0;I<Y.length;I++){const Q=Y[I];M.textRenderers[I]=null;M.textLabelPlacements[I]=null;if(null==Q?.textRenderParameters)continue;var H=Q.labelFunction;let N;if("arcade"===H.type)try{const T=H.needsHydrationToEvaluate()?p.hydrateGraphic(W,V.layer):W;N=H.evaluate(T)}catch(T){N=null}else N=
H.evaluate(W);if(null!=N&&""!==N&&!/^\s+$/.test(N)&&(H=Q.graphics3DSymbol,H.symbolLayers[0]&&(H=C.getLabelPlacement({graphics3DGraphic:M.graphics3DGraphic,labelSymbol:"label-3d"===H.symbol?.type?H.symbol:null,labelClass:Q.labelClass,disablePlacement:V.disablePlacement}),null!=H))){var S=E.horizontalPlacementFromAnchor(H.anchor);S=E.textRenderAlignmentFromHorizontalPlacement(S);M.textRenderers[I]=new D.TextRenderer(N,S,Q.textRenderParameters,K.TextTextureAtlas.maxSize);M.textLabelPlacements[I]=H}}M.textInitialized=
!0}}}_destroyTextTextureResources(M){M.textInitialized=!1;M.textRenderers.length=0;M.textLabelPlacements.length=0}_addGraphic(M,V){const Y=V.graphic.uid;M.graphics.set(Y,V);M.active&&(V=new J(M,V),this._labels.set(Y,V),M.labelsToInitialize.set(Y,V));this.setDirty();this.deconflictor.setDirty()}_removeGraphic(M,V){V=V.graphic.uid;const Y=this._labels.get(V);M.graphics.delete(V);Y&&(this._destroyGraphic(Y,V),M.labelsToInitialize.delete(V),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(M,
V){this._labels.delete(V);M.addedToTextureAtlas&&this._removeLabelTextureFromAtlas(M);this._destroyTextTextureResources(M);M.hasGraphics3DResources&&this._destroyGraphics3DResources(M)}async _labelingInfoChange(M,V){if(V)for(const Y of V){if(V=M.graphics.get(Y))this._removeGraphic(M,V),this._addGraphic(M,V)}else return this._visibilityInfoChange(M),this._resetLabels(M),this._createLabelClassContext(M)}_globalPropertyChanged(M,V){for(const Y of V.labelClassContexts){const W=new Map;V.graphics.forEach(H=>
W.set(H.graphic.uid,H));Y.graphics3DSymbol.symbolLayers[0].globalPropertyChanged(M,W,H=>H.labelLayers[0]);Y.graphics3DCalloutSymbolLayer&&Y.graphics3DCalloutSymbolLayer.globalPropertyChanged(M,W,H=>H.labelLayers[Y.calloutSymbolLayerIndex])}}_visibilityInfoChange(M){const V=P(M.layer);V&&!M.active&&this._activateLabelingContext(M);!V&&M.active&&this._deactivateLabelingContext(M);this.setDirty()}_resetAllLabels(){for(const M of this._labelingContexts)this._resetLabels(M)}_resetLabels(M){M.graphics.forEach((V,
Y)=>{if(V=this._labels.get(Y))this._destroyGraphic(V,Y),V.visible=!1,M.labelsToInitialize.set(Y,V)});this._destroyLabelClassContext(M);this.setDirty();this.deconflictor.setDirty()}_findLabelingContext(M){for(const V of this._labelingContexts)if(V.graphics3DCore===M)return V;return null}addGraphicsOwner(M,V,Y){const W=Y&&Y.emptySymbolLabelSupported||!1,H=Y?.elevationInfoOverride||null;Y=Y?.disablePlacement||null;if(!this._findLabelingContext(M)){var S=M.layer,I=new X(this.view._stage,S,M,V,W,H,Y,P(S));
this._labelingContexts.push(I);this.setDirty();return{addGraphic:Q=>this._addGraphic(I,Q),removeGraphic:Q=>this._removeGraphic(I,Q),featureReductionChange:()=>{},layerLabelsEnabled:()=>P(I.layer),labelingInfoChange:Q=>this._labelingInfoChange(I,Q),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",I),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",I),visibilityInfoChange:()=>this._visibilityInfoChange(I),reset:()=>this._resetLabels(I),clear:()=>{}}}}removeGraphicsOwner(M){const V=
this._findLabelingContext(M);V&&(M=this._labelingContexts.indexOf(V),this._labelingContexts.splice(M,1),V.graphics.forEach(Y=>this._removeGraphic(V,Y)),V.destroy(),this.setDirty())}setLabelGraphicVisibility(M,V){M=M.graphic.uid;const Y=this._labels.get(M);Y&&Y.visible!==V&&(V&&!Y.addedToTextureAtlas?(this._addLabelTextureToAtlas(Y),Y.textInitialized||Y.labelingContext.labelsToInitialize.set(M,Y)):!V&&Y.addedToTextureAtlas&&this._removeLabelTextureFromAtlas(Y),Y.visible=V,this.setDirty())}setDirty(){!this._dirty&&
0<this._labelingContexts.length&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._dirty||this._textTextureAtlas?.updating||this.deconflictor.updating||this._labelingContexts.some(M=>!!M.labelClassPromise&&!!M.labelClassAbortController)}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const M=0<this._labelingContexts.length?this._labelingContexts.reduce((V,Y)=>V+(Y.labelClassPromise&&Y.labelClassAbortController?0:1),0)/this._labelingContexts.length:
1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*M+.5*this.deconflictor.updatingProgress}get test(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>this._resetAllLabels()}}};a.__decorate([e.property({constructOnly:!0})],b.Labeler.prototype,"view",void 0);a.__decorate([e.property({constructOnly:!0})],b.Labeler.prototype,"deconflictor",void 0);a.__decorate([e.property()],b.Labeler.prototype,"_textTextureAtlas",void 0);a.__decorate([e.property({type:Boolean,readOnly:!0})],
b.Labeler.prototype,"updating",null);b.Labeler=a.__decorate([v.subclass("esri.views.3d.layers.graphics.Labeler")],b.Labeler);const U=new y.LineCalloutCreationContext(null,null,null);b.areLabelsVisible=P;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/hydratedFeatures":function(){define("exports ../../geometry ../../Graphic ../../core/has ../../core/lang ../../core/typedArrayUtil ../../geometry/support/jsonUtils ./dehydratedPoint ../../geometry/SpatialReference".split(" "),
function(b,a,c,d,f,n,k,g,q){function e(r){return"declaredClass"in r}function m(r){return"declaredClass"in r}function l(r){return"declaredClass"in r}function w(r){return null==r?null:e(r)?r:k.fromJSON(v(r))}function v(r){const {wkid:u,wkt:y,wkt2:z,latestWkid:A}=r.spatialReference,C={wkid:u,wkt:y,wkt2:z,latestWkid:A};switch(r.type){case "point":const {x:E,y:B,z:D,m:F}=r;return{x:E,y:B,z:D,m:F,spatialReference:C};case "polygon":const {rings:K,hasZ:L,hasM:G}=r;return{rings:x(K),hasZ:L,hasM:G,spatialReference:C};
case "polyline":const {paths:O,hasZ:P,hasM:J}=r;return{paths:x(O),hasZ:P,hasM:J,spatialReference:C};case "extent":const {xmin:R,xmax:X,ymin:U,ymax:M,zmin:V,zmax:Y,mmin:W,mmax:H,hasZ:S,hasM:I}=r;return{xmin:R,xmax:X,ymin:U,ymax:M,zmin:V,zmax:Y,mmin:W,mmax:H,hasZ:S,hasM:I,spatialReference:C};case "multipoint":const {points:Q,hasZ:N,hasM:T}=r;return{points:t(Q)?p(Q):Q,hasZ:N,hasM:T,spatialReference:C}}}function x(r){return h(r)?r.map(u=>p(u)):r}function p(r){return r.map(u=>Array.from(u))}function h(r){for(const u of r)if(0!==
u.length)return t(u);return!1}function t(r){return 0<r.length&&(n.isFloat32Array(r[0])||n.isFloat64Array(r[0]))}b.clonePoint=function(r,u){if(!r)return null;if(m(r)){if(null==u)return r.clone();if(m(u))return u.copy(r)}null!=u?(u.x=r.x,u.y=r.y,u.spatialReference=r.spatialReference,r.hasZ?(u.z=r.z,u.hasZ=r.hasZ):(u.z=void 0,u.hasZ=!1),r.hasM?(u.m=r.m,u.hasM=!0):(u.m=void 0,u.hasM=!1)):(u=g.makeDehydratedPoint(r.x,r.y,r.z,r.spatialReference),r.hasM&&(u.m=r.m,u.hasM=!0));return u};b.hydrateGeometry=
w;b.hydrateGraphic=function(r,u){return r?l(r)?r:new c({layer:u,sourceLayer:u,visible:r.visible,symbol:f.clone(r.symbol),attributes:f.clone(r.attributes),geometry:w(r.geometry)}):null};b.hydratedSpatialReference=function(r){const {wkid:u,wkt:y,wkt2:z,latestWkid:A}=r;return q.fromJSON({wkid:u,wkt:y,wkt2:z,latestWkid:A})};b.isHydratedGeometry=e;b.isHydratedGraphic=l;b.isHydratedPoint=m;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/labelFormatUtils":function(){define("exports ../../core/Error ../../core/Logger ../../core/sql ../../intl/date ../../intl/number ./fieldUtils ./labelUtils ../../support/arcadeOnDemand".split(" "),
function(b,a,c,d,f,n,k,g,q){function e(v,x){if(null==v)return"";const p=x.domain;if(p)if("codedValue"===p.type||"coded-value"===p.type)for(var h of p.codedValues){if(h.code===v)return h.name}else if("range"===p.type){h=+v;const t="range"in p?p.range[1]:p.maxValue;if(("range"in p?p.range[0]:p.minValue)<=h&&h<=t)return p.name}k.isDateField(x)?v=f.formatDate(v,f.convertDateFormatToIntlOptions("short-date")):k.isNumericField(x)&&(v=n.formatNumber(+v));return v||""}const m=c.getLogger("esri.layers.support.labelFormatUtils"),
l={type:"simple",evaluate(){return null}},w={getAttribute(v,x){return v.field(x)}};b.createLabelFunction=async function(v,x,p){if(!v||!v.symbol||!x)return l;const h=v.where,t=g.getLabelExpression(v);if("arcade"===t.type){const r=await q.createLabelExpression(t.expression,p,x);if(null==r)return l;v={type:"arcade",evaluate(u,y){try{const z="attributes"in u?r.repurposeFeature(u):u;z.contextTimeZone=y??null;const A=r.evaluate({$view:{timeZone:y},$feature:z},r.services);if(null!=A)return A.toString()}catch(z){m.error(new a("arcade-expression-error",
"Encountered an error when evaluating label expression for feature",{error:z,feature:u,expression:t}))}return null},needsHydrationToEvaluate(){return null==g.getSingleFieldArcadeExpression(t.expression)}}}else v={type:"simple",evaluate(r){return t.expression.replaceAll(/{[^}]*}/g,u=>{var y=u.slice(1,-1);y=x.get(y);if(!y)return u;u=null;"attributes"in r?r&&r.attributes&&(u=r.attributes[y.name]):u=r.field(y.name);return null==u?"":e(u,y)})}};if(h){let r;try{r=await d.parseWhereClause(h,x)}catch(y){return m.error(new a("bad-where-clause",
"Encountered an error when evaluating where clause, ignoring",{where:h,error:y})),l}const u=v.evaluate;v.evaluate=(y,z)=>{const A="attributes"in y?void 0:w;try{if(r.testFeature(y,A))return u(y,z)}catch(C){m.error(new a("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:h,feature:y,error:C}))}return null}}return v};b.formatField=e;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DCalloutSymbolLayerFactory":function(){define(["exports",
"../../../../core/Logger","../../../../symbols/callouts/calloutUtils","./Graphics3DLineCalloutSymbolLayer"],function(b,a,c,d){const f=a.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory"),n={line:d.Graphics3DLineCalloutSymbolLayer};b.make=function(k,g){if(!c.hasCalloutSupport(k))return f.error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${k.type}' does not support callouts`),null;if(!k.callout)return null;const q=n[k.callout.type];return q?new q(k,g):(f.error("Graphics3DCalloutSymbolLayerFactory#make",
`unknown or unsupported callout type ${k.callout.type}`),null)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DLineCalloutSymbolLayer":function(){define("exports ../../../../Color ../../../../core/screenUtils ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../symbols/callouts/calloutUtils ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DGraphicCreationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DObjectMetadata ./Graphics3DSymbolLayer ./graphicUtils ./pointUtils ./SymbolComplexity ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/ContentObjectType ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/LineCalloutMaterial".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y){class z extends w.Graphics3DSymbolLayer{constructor(F,K){super(F,null,K,E);this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};this.ensureDrapedStatus(!1)}async doLoad(){this._materials[0]=new y.LineCalloutMaterial(this._materialParameters);this._context.stage.add(this._materials[0])}destroy(){super.destroy();this._context.stage.remove(this._materials[0]);this._materials.length=0}_perInstanceMaterialParameters(F){const K=
this._materialParameters;K.horizontalScreenOffset=F.horizontalScreenOffset??0;K.centerOffsetUnits=F.centerOffsetUnits||"world";return K}get _materialParameters(){const F=new y.Parameters;var K=this.symbol,L=K.callout;F.color=null!=L.color?a.toUnitRGBA(L.color):[0,0,0,0];F.color[3]*=this._getLayerOpacity();F.size=c.pt2px(L.size||0);if(K.verticalOffset){const {screenLength:G,minWorldLength:O,maxWorldLength:P}=K.verticalOffset;F.verticalOffset={screenLength:c.pt2px(G),minWorldLength:O||0,maxWorldLength:null!=
P?P:Infinity}}F.borderColor=null!=L.border?.color?a.toUnitRGBA(L.border.color):null;L="object"===K.symbolLayers.at(0).type;K="label-3d"===K.type;F.occlusionTest=!L;F.shaderPolygonOffset=L?0:void 0;F.depthHUDAlignStart=K;F.hasSlicePlane=this._context.slicePlaneEnabled;F.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null;return F}_defaultElevationInfoNoZ(){return C}createGraphics3DGraphic(F){const K=F.renderingInfo;F=F.graphic;
const L=this.setGraphicElevationContext(F,new q.ElevationContext,K.elevationOffset||0);var G=K.symbol;const O="on-the-ground"===this._elevationContext.mode&&("cim"===G.type||!G.symbolLayers.some(P=>"object"===P.type||"text"===P.type));if("label-3d"!==G.type&&O||"point-3d"===G.type&&G.symbolLayers.every(P=>"text"===P.type&&!n.textSymbolLayerSupportsVerticalOffset(P)))return null;G=v.computeCentroid(F.geometry);return null==G?null:this._createAs3DShape(G,L,K,F.uid)}layerOpacityChanged(){this._materials[0]?.setParameters(this._materialParameters)}layerElevationInfoChanged(F,
K,L){L=g.elevationModeChangeUpdateType(z.elevationModeChangeTypes,L,this._elevationContext.mode);if(L!==g.SymbolUpdateType.UPDATE)return L;F.forEach(G=>{const O=K(G);null!=O&&this.updateGraphicElevationContext(G.graphic,O)});return L}slicePlaneEnabledChanged(){this._materials[0]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){return!0}setGraphicElevationContext(F,K,L=0){super.setGraphicElevationContext(F,K);K.addOffsetRenderUnits(L);return K}updateGraphicElevationContext(F,
K){this.setGraphicElevationContext(F,K.elevationContext,null!=K.metadata?K.metadata.elevationOffset:0);K.needsElevationUpdates=g.needsElevationUpdates2D(K.elevationContext.mode)}computeComplexity(){return new p.SymbolComplexity({verticesPerFeature:6})}_createVertexData(F){const {translation:K,centerOffset:L}=F;F=K?new h.Attribute([K[0],K[1],K[2]],A,3,!0):new h.Attribute([0,0,0],A,3,!0);const G=L?new h.Attribute([L[0],L[1],L[2],L[3]],A,4,!0):new h.Attribute([0,0,0,1],A,4,!0);return[[u.VertexAttribute.POSITION,
F],[u.VertexAttribute.NORMAL,new h.Attribute([0,0,1],A,3,!0)],[u.VertexAttribute.AUXPOS1,G]]}_getOrCreateMaterial(F){const K=this._perInstanceMaterialParameters(F),L=y.LineCalloutMaterial.uniqueMaterialIdentifier(K);if(L===this._materials[0]?.uniqueMaterialIdentifier)return{material:this._materials[0],isUnique:!1};if(null!=F.materialCollection){let G=F.materialCollection.get(L);null==G&&(G=new y.LineCalloutMaterial(K),F.materialCollection.add(L,G));return{material:G,isUnique:!1}}return{material:new y.LineCalloutMaterial(K),
isUnique:!0}}_createAs3DShape(F,K,L,G){var O=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:G,layerUid:this._context.layer.uid}),P=this._getOrCreateMaterial(L);O=new r.Geometry(P.material,this._createVertexData(L),null,t.ContentObjectType.Point,O);G=x.createStageObject(this._context,F,O,K,G);if(null==G)return null;P=new m.Graphics3DObject3DGraphicLayer(this,G.object,[O],P.isUnique?[P.material]:null,null,k.perObjectElevationAligner,K);P.metadata=new l.Graphics3DObjectMetadata(L.elevationOffset);
P.alignedSampledElevation=G.sampledElevation;P.needsElevationUpdates=g.needsElevationUpdates2D(K.mode);x.extendPointGraphicElevationContext(P,F,this._context.elevationProvider);return P}}z.elevationModeChangeTypes={definedChanged:g.SymbolUpdateType.UPDATE,staysOnTheGround:g.SymbolUpdateType.UPDATE,onTheGroundChanged:g.SymbolUpdateType.RECREATE};const A=[0],C={mode:"relative-to-ground",offset:0},E={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};class B{constructor(F,K,L=d.create(),G=f.create(),
O=0,P="world",J=0,R=null){this.renderer=F;this.symbol=K;this.translation=L;this.centerOffset=G;this.horizontalScreenOffset=O;this.centerOffsetUnits=P;this.elevationOffset=J;this.materialCollection=R}}class D extends e.Graphics3DGraphicCreationContext{}b.Graphics3DLineCalloutSymbolLayer=z;b.LineCalloutCreationContext=D;b.LineCalloutSymbolLayerRenderingInfo=B;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/ElevationAligners":function(){define("exports ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection/computeTranslationToOriginAndRotation ../../../../geometry/projection/projectBuffer ./elevationAlignmentUtils ./graphicUtils ../../support/debugFlags ../../support/ElevationProvider ../../webgl-engine/lib/GeometryWithMapPositions ../../webgl-engine/lib/VertexAttribute".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w){function v(z,A,C,E,B){let D=!1;var F=z.transformation;A=A.requiresSampledElevationInfo;h[0]=F[12];h[1]=F[13];h[2]=F[14];z.invalidateBoundingInfo();var K=z.getMutableAttribute(w.VertexAttribute.POSITION);F=K.data;K=K.size;const L=F.length/K;z=new m.SamplePosition(z.mapPositions,C);let G=0,O=0;for(let P=0;P<L;P++){t[0]=F[G];t[1]=F[G+1];t[2]=F[G+2];E(z,y);A&&(O+=y.sampledElevation);if(e.debugFlags.TESTS_DISABLE_OPTIMIZATIONS)F[G]=z.array[z.offset],F[G+1]=z.array[z.offset+
1],F[G+2]=y.z,k.projectBuffer(F,C,G,F,B.spatialReference,G,1),F[G]-=h[0],F[G+1]-=h[1],F[G+2]-=h[2],D=!0;else{p[0]=F[G]+h[0];p[1]=F[G+1]+h[1];p[2]=F[G+2]+h[2];B.setAltitude(p,y.z);F[G]=p[0]-h[0];F[G+1]=p[1]-h[1];F[G+2]=p[2]-h[2];const J=.01/B.unitInMeters;if(Math.abs(t[0]-F[G])>=J||Math.abs(t[1]-F[G+1])>=J||Math.abs(t[2]-F[G+2])>=J)D=!0}G+=K;z.offset+=3}return{update:D,averageGeometrySampledElevation:O/L}}const x=c.create(),p=f.create(),h=f.create(),t=f.create(),r=c.create(),u=f.create(),y=new g.SampleElevationInfo;
b.perLodInstanceElevationAligner=function(z,A,C,E,B){var D=z.graphics3DSymbolLayer.lodRenderer;if(null==D)return 0;C=A.centerPointInElevationSR;E(C,y);A="absolute-height"!==A.mode?y.sampledElevation:0;E=D.instanceData;z=z.instanceIndex;E.getGlobalTransform(z,r);D=d.set(u,r[12],r[13],r[14]);e.debugFlags.TESTS_DISABLE_OPTIMIZATIONS?(p[0]=C.x,p[1]=C.y,p[2]=y.z,n.computeTranslationToOriginAndRotation(C.spatialReference,p,r,B.spatialReference)&&E.setGlobalTransform(z,r)):B.setAltitudeOfTransformation(y.z,
r);B=.01/B.unitInMeters;(e.debugFlags.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(r[12]-D[0])>=B||Math.abs(r[13]-D[1])>=B||Math.abs(r[14]-D[2])>=B)&&E.setGlobalTransform(z,r);return A};b.perObjectElevationAligner=function(z,A,C,E,B,D){z=z.stageObject;const F=A.centerPointInElevationSR;C=0;z.usesVerticalDistanceToGround?(E(F,y),q.updateVertexAttributeAuxpos1w(z,y.verticalDistanceToGround),C=y.sampledElevation):(E(F,y),"absolute-height"!==A.mode&&(C=y.sampledElevation));A=a.copy(x,D??z.transformation);E=
d.set(u,A[12],A[13],A[14]);e.debugFlags.TESTS_DISABLE_OPTIMIZATIONS?(p[0]=F.x,p[1]=F.y,p[2]=y.z,n.computeTranslationToOriginAndRotation(F.spatialReference,p,A,B.spatialReference)&&(D?a.copy(D,A):z.transformation=A)):B.setAltitudeOfTransformation(y.z,A);B=.01/B.unitInMeters;if(Math.abs(A[12]-E[0])>=B||Math.abs(A[13]-E[1])>=B||Math.abs(A[14]-E[2])>=B)D?a.copy(D,A):z.transformation=A;return C};b.perVertexElevationAligner=function(z,A,C,E,B){z=z.stageObject;const D=z.geometries;let F=0;for(const K of D){if(!l.isGeometryWithMapPositions(K))continue;
const {update:L,averageGeometrySampledElevation:G}=v(K,A,C,E,B);F+=G;L&&z.geometryVertexAttributeUpdated(K,w.VertexAttribute.POSITION)}return F/D.length};b.sharedGeometryElevationAligner=function(z,A,C,E,B){z=z.stageObject;const D=z.geometries;if(0===D.length)return 0;let F=0,K=null,L=0,G=!1;for(const O of D){if(!l.isGeometryWithMapPositions(O))continue;const P=O.attributes.get(w.VertexAttribute.POSITION);if(P!==K){const {update:J,averageGeometrySampledElevation:R}=v(O,A,C,E,B);L=R;K=P;G=J}G&&z.geometryVertexAttributeUpdated(O,
w.VertexAttribute.POSITION);F+=L}return F/D.length};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/elevationAlignmentUtils":function(){define("exports ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3f64 ../../../../geometry/projection/computeTranslationToOriginAndRotation ../../../../geometry/projection/projectBuffer ../../../../layers/graphics/dehydratedFeatureUtils ./graphicUtils ../../support/ElevationProvider".split(" "),
function(b,a,c,d,f,n,k,g,q){function e(p,h,t,r,u){const y=(k.isDehydratedPoint(p)?p.z:q.isSamplePosition(p)?p.array[p.offset+2]:p[2])||0;switch(t.mode){case "on-the-ground":t=q.getElevationAtPoint(h,p,"ground")??0;u.verticalDistanceToGround=0;u.sampledElevation=t;u.z=t;break;case "relative-to-ground":p=q.getElevationAtPoint(h,p,"ground")??0;t=t.geometryZWithOffset(y,r);u.verticalDistanceToGround=t;u.sampledElevation=p;u.z=t+p;break;case "relative-to-scene":p=q.getElevationAtPoint(h,p,"scene")??0;
t=t.geometryZWithOffset(y,r);u.verticalDistanceToGround=t;u.sampledElevation=p;u.z=t+p;break;case "absolute-height":t=t.geometryZWithOffset(y,r);r=q.getElevationAtPoint(h,p,"ground")??0;u.verticalDistanceToGround=t-r;u.sampledElevation=r;u.z=t;break;default:u.z=0}}class m{constructor(){this.z=this.sampledElevation=this.verticalDistanceToGround=0}}b.SymbolUpdateType=void 0;(function(p){p[p.NONE=0]="NONE";p[p.UPDATE=1]="UPDATE";p[p.RECREATE=2]="RECREATE"})(b.SymbolUpdateType||(b.SymbolUpdateType={}));
const l={"absolute-height":{applyElevationAlignmentBuffer:function(p,h,t,r,u,y,z,A){y=A.calculateOffsetRenderUnits(z);A=A.featureExpressionInfoContext;h*=3;r*=3;for(z=0;z<u;++z){const C=p[h+1],E=p[h+2];t[r]=p[h];t[r+1]=C;t[r+2]=null==A?E+y:y;h+=3;r+=3}return 0},requiresAlignment:function(p){const h=p.featureExpressionInfoContext;return 0!==p.meterUnitOffset||null!=h}},"on-the-ground":{applyElevationAlignmentBuffer:function(p,h,t,r,u,y){let z=0;const A=y.spatialReference;h*=3;r*=3;for(let C=0;C<u;++C){const E=
p[h],B=p[h+1],D=y.getElevation(E,B,p[h+2],A,"ground")??0;z+=D;t[r]=E;t[r+1]=B;t[r+2]=D;h+=3;r+=3}return z/u},requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:function(p,h,t,r,u,y,z,A){let C=0;z=A.calculateOffsetRenderUnits(z);A=A.featureExpressionInfoContext;const E=y.spatialReference;h*=3;r*=3;for(let B=0;B<u;++B){const D=p[h],F=p[h+1],K=p[h+2],L=y.getElevation(D,F,K,E,"ground")??0;C+=L;t[r]=D;t[r+1]=F;t[r+2]=null==A?K+L+z:L+z;h+=3;r+=3}return C/u},requiresAlignment:()=>
!0},"relative-to-scene":{applyElevationAlignmentBuffer:function(p,h,t,r,u,y,z,A){let C=0;z=A.calculateOffsetRenderUnits(z);A=A.featureExpressionInfoContext;const E=y.spatialReference;h*=3;r*=3;for(let B=0;B<u;++B){const D=p[h],F=p[h+1],K=p[h+2],L=y.getElevation(D,F,K,E,"scene")??0;C+=L;t[r]=D;t[r+1]=F;t[r+2]=null==A?K+L+z:L+z;h+=3;r+=3}return C/u},requiresAlignment:()=>!0}},w=c.create(),v=new m,x=d.create();b.SampleElevationInfo=m;b.applyElevationAlignmentForHUD=function(p,h,t,r,u){e(h,t,u,r,v);g.updateVertexAttributeAuxpos1w(p,
v.verticalDistanceToGround);t=v.sampledElevation;u=a.copy(w,p.transformation);x[0]=h.x;x[1]=h.y;x[2]=v.z;f.computeTranslationToOriginAndRotation(h.spatialReference,x,u,r.spatialReference)?p.transformation=u:console.warn("Could not locate symbol object properly, it might be misplaced");return t};b.applyPerVertexElevationAlignment=function(p,h,t,r,u,y,z,A,C,E,B){const D=l[B.mode];let F=0;if(n.projectBuffer(p,h,t,r,C.spatialReference,u,A)&&(D.requiresAlignment(B)?(F=D.applyElevationAlignmentBuffer(r,
u,y,z,A,C,E,B),p=y,u=z):p=r,n.projectBuffer(p,C.spatialReference,u,y,E.spatialReference,z,A)))return F};b.elevationModeChangeUpdateType=function(p,h,t){return null==h||null==t?p.definedChanged:"on-the-ground"===h&&"on-the-ground"===t?p.staysOnTheGround:h===t||"on-the-ground"!==h&&"on-the-ground"!==t?b.SymbolUpdateType.UPDATE:p.onTheGroundChanged};b.evaluateElevationAlignmentAtPoint=function(p,h,t,r){e(p,h,t,r,v);return v.z};b.evaluateElevationInfoAtPoint=e;b.needsElevationUpdates2D=function(p){return"relative-to-ground"===
p||"relative-to-scene"===p};b.needsElevationUpdates3D=function(p){return"absolute-height"!==p};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/graphicUtils":function(){define("exports ../../../../core/unitUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/centroid ../../../../geometry/support/coordsUtils ../../../../layers/graphics/dehydratedPoint ../../../../layers/graphics/hydratedFeatures ../../webgl-engine/lib/VertexAttribute".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x){function p(r){var u=r.paths[0];if(!u||0===u.length)return null;u=l.getPointOnPath(u,l.getPathLength(u)/2);return w.makeDehydratedPoint(u[0],u[1],u[2],r.spatialReference)}function h(r,u,y){y=y?r:v.clonePoint(r);return u&&r?g.projectPoint(r,y,u)?y:null:y}function t(r){const u=y=>null==y||0<=y;return Array.isArray(r)?r.every(u):null==r||0<=r}b.computeCentroid=function(r,u){if("point"===r.type)return h(r,u,!1);if(v.isHydratedGeometry(r))switch(r.type){case "extent":return h(r.center,
u,!1);case "polygon":return h(r.centroid,u,!1);case "polyline":return h(p(r),u,!0);case "mesh":return h(r.origin,u,!1)}else switch(r.type){case "extent":return r=w.makeDehydratedPoint(.5*(r.xmax+r.xmin),.5*(r.ymax+r.ymin),null!=r.zmin&&null!=r.zmax&&isFinite(r.zmin)&&isFinite(r.zmax)?.5*(r.zmax+r.zmin):void 0,r.spatialReference),h(r,u,!0);case "polygon":var y=r.rings[0];y&&0!==y.length?(y=m.ringsCentroid(r.rings,!!r.hasZ),r=w.makeDehydratedPoint(y[0],y[1],y[2],r.spatialReference)):r=null;return h(r,
u,!0);case "polyline":return h(p(r),u,!0)}};b.computeObjectRotation=function(r,u,y,z=d.create()){r&&c.rotateZ(z,z,-r/180*Math.PI);u&&c.rotateX(z,z,u/180*Math.PI);y&&c.rotateY(z,z,y/180*Math.PI);return z};b.computeObjectScale=function(r=f.ONES,u,y,z=1){const A=Array(3);if(null==u||null==y)A[0]=1,A[1]=1,A[2]=1;else{let E=0;for(let B=2;0<=B;B--){const D=r[B];let F;const K=null!=D,L=0===B&&!C&&!K,G=y[B];"symbol-value"===D||L?F=0!==G?u[B]/G:1:K&&"proportional"!==D&&isFinite(D)&&(F=0!==G?D/G:1);if(null!=
F){var C=A[B]=F;E=Math.max(E,Math.abs(F))}}for(r=2;0<=r;r--)null==A[r]?A[r]=C:0===A[r]&&(A[r]=.001*E)}for(C=2;0<=C;C--)A[C]/=z;return f.fromArray(A)};b.demResolutionForBoundingBox=function(r,u,y){if(null!=y.minDemResolution)return y.minDemResolution;const z=a.getMetersPerUnitForSR(u),A=q.width(r)*z,C=q.depth(r)*z;r=q.height(r)*(u.isGeographic?1:z);return 0===A&&0===C&&0===r?y.minDemResolutionForPoints:.01*Math.max(A,C,r)};b.enlargeExtent=function(r,u,y,z=0){if(r){u||(u=e.create());let A=.5*r.width*
(y-1);y=.5*r.height*(y-1);r.width<1E-7*r.height?A+=y/20:r.height<1E-7*r.width&&(y+=A/20);n.set(u,r.xmin-A-z,r.ymin-y-z,r.xmax+A+z,r.ymax+y+z);return u}return null};b.isValidSize=t;b.mixinColorAndOpacity=function(r,u,y=null){const z=k.clone(k.ONES);null!=r&&(z[0]=r[0],z[1]=r[1],z[2]=r[2]);null!=u?z[3]=u:null!=r&&3<r.length&&(z[3]=r[3]);y&&(z[0]*=y,z[1]*=y,z[2]*=y,z[3]*=y);return z};b.overrideColor=function(r,u,y,z,A,C=[0,0,0,0]){for(let E=0;3>E;++E)C[E]=null!=r?.[E]?r[E]:null!=y?.[E]?y[E]:A[E];C[3]=
null!=u?u:null!=z?z:A[3];return C};b.updateVertexAttributeAuxpos1w=function(r,u){for(let y=0;y<r.geometries.length;++y){const z=r.geometries[y].getMutableAttribute(x.VertexAttribute.AUXPOS1);z&&z.data[3]!==u&&(z.data[3]=u,r.geometryVertexAttributeUpdated(r.geometries[y],x.VertexAttribute.AUXPOS1))}};b.validateSymbolLayerSize=function(r){return t(null!=r.isPrimitive?[r.width,r.depth,r.height]:r)?null:"Symbol sizes may not be negative values"};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/lib/GeometryWithMapPositions":function(){define(["exports","./Geometry"],function(b,a){class c extends a.Geometry{}b.GeometryWithMapPositions=c;b.isGeometryWithMapPositions=function(d){return null!=d.mapPositions};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/ElevationContext":function(){define(["exports","../../../../symbols/support/unitConversionUtils","./featureExpressionInfoUtils"],function(b,a,c){class d{constructor(){this._renderUnitOffset=
this._meterUnitOffset=0;this._unit="meters";this._metersPerElevationInfoUnit=1;this.mode=this.centerPointInElevationSR=this._featureExpressionInfoContext=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(f){this._unit=f;this._metersPerElevationInfoUnit=a.getMetersPerUnit(f)}get requiresSampledElevationInfo(){return"absolute-height"!==this.mode}reset(){this.mode=null;this._renderUnitOffset=
this._meterUnitOffset=0;this._featureExpressionInfoContext=null;this.unit="meters"}set offsetMeters(f){this._meterUnitOffset=f;this._renderUnitOffset=0}set offsetElevationInfoUnits(f){this._meterUnitOffset=f*this._metersPerElevationInfoUnit;this._renderUnitOffset=0}addOffsetRenderUnits(f){this._renderUnitOffset+=f}geometryZWithOffset(f,n){n=this.calculateOffsetRenderUnits(n);return null!=this.featureExpressionInfoContext?n:f+n}calculateOffsetRenderUnits(f){let n=this._meterUnitOffset;const k=this.featureExpressionInfoContext;
null!=k&&(n+=c.execute(k)*this._metersPerElevationInfoUnit);return n/f.unitInMeters+this._renderUnitOffset}setFromElevationInfo(f){this.mode=f.mode;this.unit=a.supportsUnit(f.unit)?f.unit:"meters";this.offsetElevationInfoUnits=f.offset??0}updateFeatureExpressionInfoContext(f,n,k){if(null==f)this._featureExpressionInfoContext=null;else{var g=f?.arcade;g&&null!=n&&null!=k?(this._featureExpressionInfoContext=c.clone(f),c.setContextFeature(this._featureExpressionInfoContext,c.createFeature(g.modules,
n,k))):this._featureExpressionInfoContext=f}}static fromElevationInfo(f){const n=new d;null!=f&&n.setFromElevationInfo(f);return n}}b.ElevationContext=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/featureExpressionInfoUtils":function(){define(["exports","../../../../core/Logger","../../../../core/promiseUtils","../../../../layers/graphics/hydratedFeatures","../../../../support/arcadeOnDemand"],function(b,a,c,d,f){const n=a.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");
b.clone=function(k){return{cachedResult:k.cachedResult,arcade:k.arcade?{func:k.arcade.func,context:k.arcade.modules.arcadeUtils.createExecContext(null,{sr:k.arcade.context.spatialReference}),modules:k.arcade.modules}:null}};b.createContext=async function(k,g,q,e){k=k?.expression;if("string"!==typeof k)return null;var m="0"===k?0:null;if(null!=m)return{cachedResult:m};m=await f.loadArcade();c.throwIfAborted(q);q=m.arcadeUtils;k=q.createSyntaxTree(k);return q.dependsOnView(k)?(null!=e&&e.error("Expressions containing '$view' are not supported on ElevationInfo"),
{cachedResult:0}):{arcade:{func:q.createFunction(k),context:q.createExecContext(null,{sr:g}),modules:m}}};b.createContextWithoutExpressionSupport=function(k){k=k?.expression;return"string"===typeof k&&(k="0"===k?0:null,null!=k)?{cachedResult:k}:null};b.createFeature=function(k,g,q){return k.arcadeUtils.createFeature(g.attributes,g.geometry,q)};b.execute=function(k){if(null!=k){if(null!=k.cachedResult)return k.cachedResult;var g=k.arcade;g=g?.modules.arcadeUtils.executeFunction(g.func,g.context);"number"!==
typeof g&&(g=k.cachedResult=0);return g}return 0};b.extractExpressionInfo=function(k,g=!1){k=k?.featureExpressionInfo;g||"0"===k?.expression||(k=null);return k??null};b.setContextFeature=function(k,g){null!=k&&null==k.cachedResult&&(g&&k.arcade?(g._geometry&&(g._geometry=d.hydrateGeometry(g._geometry)),k.arcade.modules.arcadeUtils.updateExecContext(k.arcade.context,g)):n.errorOncePerTick("Arcade support required but not provided"))};b.zeroContext={cachedResult:0};Object.defineProperty(b,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DGraphicCreationContext":function(){define(["exports"],function(b){class a{constructor(c,d,f){this.graphic=c;this.renderingInfo=d;this.layer=f}}b.Graphics3DGraphicCreationContext=a;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DObject3DGraphicLayer":function(){define("exports ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../chunks/sphere ./elevationAlignmentUtils ./featureExpressionInfoUtils ./graphicUtils ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/edgeRendering/interfaces".split(" "),
function(b,a,c,d,f,n,k,g,q,e){function m(t){return t.isVisible()?t.parameters.transparent?e.Transparency.TRANSPARENT:e.Transparency.OPAQUE:e.Transparency.INVISIBLE}class l{constructor(t,r,u){this.baseMaterial=t;this.edgeMaterials=r;this.properties=u}}class w{get isElevationSource(){return!!this.stageObject.lastValidElevationBB}constructor(t,r,u,y,z,A,C,E=null){this.graphics3DSymbolLayer=t;this.stageObject=r;this._uniqueGeometries=u;this._uniqueMaterials=y;this._sharedResource=z;this.elevationAligner=
A;this.elevationContext=C;this._edgeState=E;this.type="object3d";this._stageLayer=null;this._addedToStage=this._visible=!1;this.alignedSampledElevation=0;this.useObjectOriginAsAttachmentOrigin=this.needsElevationUpdates=!1}initialize(t){this._stageLayer=t;t=t.stage;t.addMany(this._uniqueMaterials);t.addMany(this._uniqueGeometries);t.add(this.stageObject)}destroy(){if(this._stageLayer){var t=this._stageLayer.stage;t.removeMany(this._uniqueMaterials);t.removeMany(this._uniqueGeometries);t.remove(this.stageObject);
this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1);t=t.renderer.edgeView;t?.hasObject(this.stageObject)&&t.removeObject(this.stageObject);this.stageObject.dispose();this._sharedResource?.release();this._visible=!1;this._stageLayer=null}}layerOpacityChanged(t,r){if(null!=this._edgeState){var u=m(this._edgeState.baseMaterial),y=!1;for(const z of this._edgeState.edgeMaterials)z.objectTransparency!==u&&(z.objectTransparency=u,y=!0);y&&this.resetEdgeObject(r);this._stageLayer.stage.renderer.ensureEdgeView().updateAllComponentOpacities(this.stageObject,
[t])}}slicePlaneEnabledChanged(t,r){null!=this._edgeState&&(this._stageLayer.stage.renderer.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{hasSlicePlane:t},!r),this._edgeState.properties.hasSlicePlane=t)}setVisibility(t){if(null!=this._stageLayer&&this._visible!==t&&(this._visible=t,this.stageObject.visible=t,this._visible&&!this._addedToStage&&(this._stageLayer.add(this.stageObject),this._addedToStage=!0),this._edgeState)){const r=this._stageLayer.stage.renderer.ensureEdgeView();
r.hasObject(this.stageObject)?r.updateObjectVisibility(this.stageObject,t):t&&this._addOrUpdateEdgeObject(r,!1)}}get visible(){return this._visible}alignWithElevation(t,r,u,y){null!=this.elevationAligner&&(null!=u&&k.setContextFeature(this.elevationContext.featureExpressionInfoContext,u),this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,t.spatialReference,(z,A)=>n.evaluateElevationInfoAtPoint(z,t,this.elevationContext,r,A),r),this.resetEdgeObject(y))}alignWithAbsoluteElevation(t,
r,u){this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,(y,z)=>{z.sampledElevation=t;z.verticalDistanceToGround=0;z.z=t},r);this.resetEdgeObject(u)}getCenterObjectSpace(t=c.create()){return a.copy(t,f.getCenter(this.stageObject.boundingVolumeObjectSpace.bounds))}getBoundingBoxObjectSpace(t=d.create()){const r=this.stageObject.boundingVolumeObjectSpace;d.setMin(t,r.min);d.setMax(t,r.max);return t}computeAttachmentOrigin(t){const r=this.stageObject.effectiveTransformation;
if(this.useObjectOriginAsAttachmentOrigin)t.render.origin[0]+=r[12],t.render.origin[1]+=r[13],t.render.origin[2]+=r[14],t.render.num++;else for(const u of this.stageObject.geometries)u.computeAttachmentOrigin(p)&&(a.transformMat4(p,p,r),a.add(t.render.origin,t.render.origin,p),t.render.num++)}async getProjectedBoundingBox(t,r,u,y,z){z=this.getBoundingBoxObjectSpace(z);var A=h,C=d.isPoint(z)?1:A.length;for(var E=0;E<C;E++){const B=A[E];x[0]=z[B[0]];x[1]=z[B[1]];x[2]=z[B[2]];a.transformMat4(x,x,this.stageObject.transformation);
v[3*E]=x[0];v[3*E+1]=x[1];v[3*E+2]=x[2]}if(!t(v,0,C))return null;d.empty(z);t=null;this.calculateRelativeScreenBounds&&(t=this.calculateRelativeScreenBounds());for(A=0;A<3*C;A+=3){for(E=0;3>E;E++)z[E]=Math.min(z[E],v[A+E]),z[E+3]=Math.max(z[E+3],v[A+E]);t&&u.push({location:v.slice(A,A+3),screenSpaceBoundingRect:t})}if(r?.service&&"absolute-height"!==this.elevationContext.mode){d.center(z,p);u="relative-to-scene"===this.elevationContext.mode?"scene":"ground";C=0;if(r.useViewElevation)C=r.service.getElevation(p[0],
p[1],u)??0;else try{const B=g.demResolutionForBoundingBox(z,r.service.spatialReference,r);C=await r.service.queryElevation(p[0],p[1],y,B,u)??0}catch(B){}d.offset(z,0,0,-this.alignedSampledElevation+C)}return z}addObjectState(t,r){t===q.Object3DState.Highlight&&r.addObject(this.stageObject,this.stageObject.highlight());t===q.Object3DState.MaskOccludee&&r.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(t){t.removeObject(this.stageObject)}resetEdgeObject(t){if(null!=this._edgeState){var r=
this._stageLayer.stage.renderer.ensureEdgeView();this._visible?this._addOrUpdateEdgeObject(r,t):r.removeObject(this.stageObject)}}_addOrUpdateEdgeObject(t,r){const u=this._edgeState;if(null!=u){var y=m(u.baseMaterial);for(const z of u.edgeMaterials)z.objectTransparency=y;t.addOrUpdateObject3D(this.stageObject,u.edgeMaterials,u.properties,!r).then(()=>this._stageLayer?.sync())}}}const v=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],x=c.create(),p=c.create(),h=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,
1,5],[3,1,5],[0,4,5],[3,4,5]];b.Graphics3DObject3DGraphicLayer=w;b.Object3DEdgeState=l;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/interfaces":function(){define(["exports"],function(b){b.Transparency=void 0;var a=b.Transparency||(b.Transparency={});a[a.INVISIBLE=0]="INVISIBLE";a[a.TRANSPARENT=1]="TRANSPARENT";a[a.OPAQUE=2]="OPAQUE";Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DObjectMetadata":function(){define(["exports"],
function(b){class a{constructor(c,d=null){this.labelText=d;this.elevationOffset=c??0}}b.Graphics3DObjectMetadata=a;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayer":function(){define("exports ../../../../Color ../../../../core/has ../../../../core/Logger ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ./defaultSymbolComplexity ./elevationAlignmentUtils ./ElevationContext ./featureExpressionInfoUtils ./graphicUtils ./interfaces ./Loadable ../support/FastSymbolUpdates".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v){function x(y){const z={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};y&&"visualVariables"in y&&y.visualVariables&&y.visualVariables.forEach(A=>{switch(A.type){case "color":z.color=!0;if(A.stops)for(let C=0;C<A.stops.length;C++){const E=A.stops[C].color;E&&(z.opacity=!0,1>E.a&&(z.opacityAlwaysOpaque=!1))}break;case "opacity":z.opacity=!0;z.opacityAlwaysOpaque=!1;break;case "size":z.size=!0}});return z}const p=d.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");
class h extends w.Loadable{constructor(y,z,A,C){super(A.schedule);this.symbol=y;this.symbolLayer=z;this._context=A;this.ignoreDrivers=!1;this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};this._materials=[];this.usedMemory=0;this.logger=p;this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0};this.skipHighSymbolLodsChanged=!0;this._renderPriority=C.renderPriority;this._renderPriorityStep=C.renderPriorityStep;this._elevationContext=new q.ElevationContext;
this.complexity=this.computeComplexity();this.ignoreDrivers=C.ignoreDrivers;this.ignoreDrivers||(this._drivenProperties=x(this._context.renderer));this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}get materials(){return this._materials}_drivenPropertiesChanged(y){if(this.ignoreDrivers)return!1;const z=this._drivenProperties;y=x(y);return y.color!==z.color||y.opacity!==z.opacity||y.opacityAlwaysOpaque!==z.opacityAlwaysOpaque||y.size!==z.size}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&
!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(y,z,A,C){const E="polygons"in y?y.polygons:null,B=`${C} geometry failed to be created`;let D=null;y.projectionSuccess?!this._logGeometryValidationWarnings(z,A,C)&&E&&0===E.length&&"rings"===A&&0<z.length&&2<z[0].length&&(D=`${B} (filled rings should use clockwise winding - try reversing the order of vertices)`):D=`${B} (failed to project geometry to view spatial reference)`;D&&p.warnOncePerTick(D)}_logGeometryValidationWarnings(y,
z,A){A=`${A} geometry failed to be created`;return!y.length||1===y.length&&!y[0].length?(p.warnOncePerTick(`${A} (no ${z} were defined)`),!0):Array.isArray(y)&&Array.isArray(y[0])?!1:(p.warnOncePerTick(`${A} (${z} should be defined as a 2D array)`),!0)}_validateGeometry(y,z=null,A=null){return null==z||z.includes(y.type)?"point"!==y.type||isFinite(y.x)&&isFinite(y.y)?!0:(p.warn("point coordinate is not a valid number, graphic skipped"),!1):(this.logger.warn("unsupported geometry type for "+A+` symbol: ${y.type}`),
!1)}_defaultElevationInfoNoZ(){return t}_defaultElevationInfoZ(){return r}_updateElevationContext(){null!=this._elevationInfoOverride?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(y){return y.hasZ?
this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(y,z=this.getDefaultElevationInfo(y)){return this._elevationContext.mode||z.mode}setElevationInfoOverride(y){this._elevationInfoOverride=y;this._updateElevationContext()}setGraphicElevationContext(y,z=new q.ElevationContext){var A=y.geometry;const C=this.getDefaultElevationInfo(A);z.unit=null!=this._elevationContext.unit?this._elevationContext.unit:C.unit;z.mode=this.getGeometryElevationMode(A,C);z.offsetMeters=
this._elevationContext.meterUnitOffset??C.offset??0;if(A=!this._elevationOptions.supportsOnTheGround&&"on-the-ground"===z.mode)z.mode="relative-to-ground",z.offsetMeters=0;z.updateFeatureExpressionInfoContext(A?e.zeroContext:this._elevationContext.featureExpressionInfoContext,y,this._context.layer);return z}prepareSymbolLayerPatch(y){}updateGeometry(y,z){return!1}updateTransform(y,z,A,C){return!1}onRemoveGraphic(y){}_getLayerOpacity(){if(this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner)return this._context.graphicsCoreOwner.fullOpacity??
0;const y=this._context.layer.opacity;return null==y?1:y}_getCombinedOpacity(y,z=u){let A=1;this.draped||(A*=this._getLayerOpacity());if(this._drivenProperties.opacity)return A;null!=y?A*=y.a:z.hasIntrinsicColor||(A=0);return A}_getCombinedOpacityAndColor(y,z=u){z=this._getCombinedOpacity(y,z);if(this._drivenProperties.color)return m.mixinColorAndOpacity(null,z);y=null!=y?a.toUnitRGB(y):f.ONES;return m.mixinColorAndOpacity(y,z)}_getVertexOpacityAndColor(y,z=null){y=m.mixinColorAndOpacity(this._drivenProperties.color?
y.color:null,this._drivenProperties.opacity?y.opacity:null);z&&(y[0]*=z,y[1]*=z,y[2]*=z,y[3]*=z);return y}isFastUpdatesEnabled(){return null!=this._fastUpdates}computeComplexity(){return k.defaultSymbolLayerComplexity(this.symbol,this.symbolLayer)}globalPropertyChanged(y,z,A){switch(y){case "opacity":return this.layerOpacityChanged(z,A),!0;case "elevationInfo":return y=this._elevationContext.mode,this._updateElevationContext(),this.layerElevationInfoChanged(z,A,y)===g.SymbolUpdateType.RECREATE?!1:
!0;case "slicePlaneEnabled":return this.slicePlaneEnabledChanged(z,A);case "physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case "pixelRatio":return this.pixelRatioChanged;case "skipHighSymbolLods":return this.skipHighSymbolLodsChanged;default:return!1}}get pixelRatioChanged(){return!0}updateGraphics3DGraphicElevationInfo(y,z,A){let C=g.SymbolUpdateType.UPDATE;y.forEach(E=>{const B=z(E);null!=B?(this.setGraphicElevationContext(E.graphic,B.elevationContext),B.needsElevationUpdates=
A(B.elevationContext.mode)):C=g.SymbolUpdateType.RECREATE});return C}applyRendererDiff(y,z){return l.ApplyRendererDiffResult.RecreateSymbol}getFastUpdateAttrValues(y){if(!this._fastUpdates)return null;const z=this._fastUpdates.visualVariables,A=z.size?v.getAttributeValue(z.size.field,y):0,C=z.color?v.getAttributeValue(z.color.field,y):0;y=z.opacity?v.getAttributeValue(z.opacity.field,y):0;return n.fromValues(A,C,y,0)}get draped(){return this._draped}ensureDrapedStatus(y){if(null==this._draped)return this._draped=
y,!0;y!==this.draped&&p.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary.");return!1}test(){return{drivenProperties:this._drivenProperties,getVisVarFields:()=>({size:this._fastUpdates?.visualVariables.size?.field??null,color:this._fastUpdates?.visualVariables.color?.field??null,opacity:this._fastUpdates?.visualVariables.opacity?.field??null,rotation:this._fastUpdates?.visualVariables.rotation?.field??
null})}}}const t={mode:"on-the-ground",offset:0,unit:"meters"},r={mode:"absolute-height",offset:0,unit:"meters"},u={hasIntrinsicColor:!1};b.Graphics3DSymbolLayer=h;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/defaultSymbolComplexity":function(){define("exports ../../../../core/compilerUtils ../../../../symbols/support/ObjectSymbol3DLayerResource ./Graphics3DPathSymbolLayerConstants ./primitiveObjectSymbolUtils ./SymbolComplexity ../support/edgeUtils ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(b,a,c,d,f,n,k,g){function q(p){let h=0,t=0,r=0,u=!1,y=0;const z=new n.SymbolComplexityMemory;for(const A of p)null!=A&&(h+=A.verticesPerFeature,t+=A.verticesPerCoordinate,r+=A.drawCallsPerFeature,z.bytesPerFeature+=A.memory.bytesPerFeature,z.bytesPerFeatureLabel+=A.memory.bytesPerFeatureLabel,z.resourceBytes+=A.memory.resourceBytes,z.draped.bytesPerFeature+=A.memory.bytesPerFeature,z.draped.bytesPerFeatureLabel+=A.memory.bytesPerFeatureLabel,u=u||A.estimated,++y);return u?new n.EstimatedAggregateSymbolComplexity(y,
{verticesPerFeature:h,verticesPerCoordinate:t,drawCallsPerFeature:r,memory:z}):new n.AggregateSymbolComplexity(y,{verticesPerFeature:h,verticesPerCoordinate:t,drawCallsPerFeature:r,memory:z})}function e(p,h){const t=m(p,h);var r=k.hasEdges(h)?2:0;switch(h.type){case "extrude":return new n.SymbolComplexity({verticesPerFeature:-12,verticesPerCoordinate:12,drawCallsPerFeature:r,memory:t});case "fill":if("mesh-3d"===p.type)return new n.SymbolComplexity({drawCallsPerFeature:r,memory:t});if(null!=h.outline&&
0<h.outline.size)return new n.SymbolComplexity({verticesPerFeature:-12,verticesPerCoordinate:9,memory:t});case "water":return new n.SymbolComplexity({verticesPerFeature:-6,verticesPerCoordinate:3,memory:t});case "line":return new n.SymbolComplexity({verticesPerFeature:-6,verticesPerCoordinate:6,memory:t});case "object":if(h.resource?.href)return new n.EstimatedSymbolComplexity({verticesPerFeature:100,memory:t});h=h.resource?.primitive??c.defaultPrimitive;(p=v[h])?h=p:(p=f.primitiveLodResources(h,
new g.DefaultMaterial({})),p=l(p.levels),v[h]=new n.SymbolComplexity({verticesPerFeature:p}),h=v[h]);return{...h,memory:t};case "path":var u=p=0;switch(h.profile){case "circle":p=d.pathNumCircleProfileSubdivisions;break;case "quad":p=4;break;default:a.neverReached(h.profile);return}switch(h.join??"simple"){case "round":u=d.pathNumRoundJoinSubdivisions;break;case "miter":case "bevel":u=1;break;default:return}r=2*p;u=p*u*2;let y=-2*u-r;switch(h.cap){case "none":break;case "butt":case "square":y+=2*
(p-1);break;case "round":y+=2*(p*(d.pathNumRoundCapExtrusionSubdivisions-1)*2+p);break;default:return}return new n.SymbolComplexity({verticesPerFeature:y,verticesPerCoordinate:u+r,memory:t});case "text":case "icon":return new n.SymbolComplexity({verticesPerFeature:6,memory:t})}}function m(p,h){p="point-3d"===p.type;switch(h.type){case "extrude":return h.edges&&0<h.edges.size?x.EXTRUDE_EDGES:x.EXTRUDE;case "fill":return null!=h.outline&&0<h.outline.size?x.FILL_OUTLINE:x.FILL;case "water":return x.FILL;
case "line":return"round"===h.join?x.LINE_ROUND:x.LINE_MITER;case "path":switch(h.join){case "round":switch(h.profile){case "circle":return x.PATH_ROUND_CIRCLE;case "quad":return x.PATH_ROUND_QUAD;default:a.neverReached(h.profile);return}case "miter":case "bevel":switch(h.profile){case "circle":return x.PATH_MITER_CIRCLE;case "quad":return x.PATH_MITER_QUAD;default:a.neverReached(h.profile);return}case "simple":return;default:return}case "object":return p?x.OBJECT_POINT:x.OBJECT_POLYGON;case "icon":case "text":return p?
x.ICON_POINT:x.ICON_POLYGON}}function l(p){return p.reduce((h,t,r)=>h+1/10**r*t.numVertices,0)/p.reduce((h,t,r)=>h+1/10**r,0)}const w=new n.EstimatedSymbolComplexity({}),v={},x={ICON_POINT:{bytesPerFeature:2111.586639736967,bytesPerFeatureLabel:870.520855,resourceBytes:0,draped:{bytesPerFeature:1799.2619971817762,bytesPerFeatureLabel:857.4890149999999}},ICON_POLYGON:{bytesPerFeature:2829.8183316810564,bytesPerFeatureLabel:858.0951816666667,resourceBytes:0,draped:{bytesPerFeature:2521.242008227286,
bytesPerFeatureLabel:869.6919750000001}},OBJECT_POINT:{bytesPerFeature:607.8007336777831,bytesPerFeatureLabel:715.7017950000001,resourceBytes:0,draped:{bytesPerFeature:607.8007336777831,bytesPerFeatureLabel:715.7017950000001}},OBJECT_POLYGON:{bytesPerFeature:1111.4123028075749,bytesPerFeatureLabel:684.5498416666667,resourceBytes:0,draped:{bytesPerFeature:1111.4123028075749,bytesPerFeatureLabel:684.5498416666667}},LINE_MITER:{bytesPerFeature:3053.034748007272,bytesPerFeatureLabel:804.5473016666666,
resourceBytes:0,draped:{bytesPerFeature:2649.5661560225844,bytesPerFeatureLabel:843.3404083333334}},LINE_ROUND:{bytesPerFeature:3225.35183564197,bytesPerFeatureLabel:807.296835,resourceBytes:0,draped:{bytesPerFeature:2650.9229994933276,bytesPerFeatureLabel:861.108335}},PATH_MITER_CIRCLE:{bytesPerFeature:38664.832646351235,bytesPerFeatureLabel:862.95665,resourceBytes:0,draped:{bytesPerFeature:38664.832646351235,bytesPerFeatureLabel:862.95665}},PATH_ROUND_CIRCLE:{bytesPerFeature:42462.97022293504,bytesPerFeatureLabel:851.35885,
resourceBytes:0,draped:{bytesPerFeature:42462.97022293504,bytesPerFeatureLabel:851.35885}},PATH_MITER_QUAD:{bytesPerFeature:25558.22153327986,bytesPerFeatureLabel:838.56885,resourceBytes:0,draped:{bytesPerFeature:25558.22153327986,bytesPerFeatureLabel:838.56885}},PATH_ROUND_QUAD:{bytesPerFeature:42274.86801764233,bytesPerFeatureLabel:867.5658500000001,resourceBytes:0,draped:{bytesPerFeature:42274.86801764233,bytesPerFeatureLabel:867.5658500000001}},FILL:{bytesPerFeature:3124.272297197038,bytesPerFeatureLabel:850.6966816666666,
resourceBytes:0,draped:{bytesPerFeature:2630.99580851019,bytesPerFeatureLabel:845.464495}},FILL_OUTLINE:{bytesPerFeature:4501.643043274039,bytesPerFeatureLabel:866.3982816666668,resourceBytes:0,draped:{bytesPerFeature:3841.8870233416183,bytesPerFeatureLabel:854.9969683333334}},EXTRUDE:{bytesPerFeature:7545.975968446941,bytesPerFeatureLabel:859.7106016666668,resourceBytes:0,draped:{bytesPerFeature:7545.975968446941,bytesPerFeatureLabel:859.7106016666668}},EXTRUDE_EDGES:{bytesPerFeature:2872.306473115409,
bytesPerFeatureLabel:604.556581666667,resourceBytes:0,draped:{bytesPerFeature:2872.306473115409,bytesPerFeatureLabel:604.556581666667}}};b.averageSymbolComplexities=function(p){p=q(p);0<p.numComplexities&&(p.verticesPerFeature/=p.numComplexities,p.verticesPerCoordinate/=p.numComplexities,p.drawCallsPerFeature/=p.numComplexities,p.memory.bytesPerFeature/=p.numComplexities,p.memory.bytesPerFeatureLabel/=p.numComplexities,p.memory.resourceBytes/=p.numComplexities,p.memory.draped.bytesPerFeature/=p.numComplexities,
p.memory.draped.bytesPerFeatureLabel/=p.numComplexities);return p};b.defaultSymbolComplexity=function(p){if("web-style"===p.type)return w;const h=p.symbolLayers.toArray().map(t=>e(p,t));return q(h)};b.defaultSymbolLayerComplexity=e;b.defaultSymbolLayerMemoryComplexity=m;b.emptySymbolComplexity=w;b.estimateNumVerticesForLods=l;b.memoryEstimators=x;b.totalSymbolComplexities=q;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DPathSymbolLayerConstants":function(){define(["exports"],
function(b){b.pathNumCircleProfileSubdivisions=10;b.pathNumRoundCapExtrusionSubdivisions=3;b.pathNumRoundJoinSubdivisions=3;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/primitiveObjectSymbolUtils":function(){define(["exports","../../../../core/has","../../webgl-engine/lib/GeometryUtil","../../webgl-engine/lib/lodRendering/LodResources"],function(b,a,c,d){const f=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,
minScreenSpaceRadius:65}];b.isValidPrimitive=function(n){switch(n){case "sphere":case "cube":case "diamond":case "cylinder":case "cone":case "inverted-cone":case "tetrahedron":return!0}return!1};b.primitiveLodResources=function(n,k){const g=(q,e,m=!1)=>new d.LodResources(q.map(l=>{const w=e(l.tesselation);m&&c.cgToGIS(w);return new d.LodLevelResources([new d.LodComponentResources(w)],l.minScreenSpaceRadius)}));switch(n){case "sphere":return g([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,
minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],q=>c.createPolySphereGeometry(k,.5,q,!0));case "cube":return g([{tesselation:0,minScreenSpaceRadius:0}],()=>c.createBoxGeometry(k,1));case "cone":return g(f,q=>c.createConeGeometry(k,1,.5,q,!1),!0);case "inverted-cone":return g(f,q=>c.createConeGeometry(k,1,.5,q,!0),!0);case "cylinder":return g(f,q=>c.createCylinderGeometry(k,1,.5,q,[0,0,1],[0,0,.5]));case "tetrahedron":return g([{tesselation:0,
minScreenSpaceRadius:0}],()=>c.createTetrahedronGeometry(k,1),!0);case "diamond":return g([{tesselation:0,minScreenSpaceRadius:0}],()=>c.createDiamondGeometry(k,1),!0)}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodResources":function(){define(["exports","../../../../../core/arrayUtils","../VertexAttribute"],function(b,a,c){class d{constructor(k,g=null){this.geometry=k;this.textures=g}}class f{constructor(k,g,q){this.components=k;
this.minScreenSpaceRadius=g;this.pivotOffset=q;this.numVertices=this.geometries.reduce((e,m)=>e+m.attributes.get(c.VertexAttribute.POSITION).indices.length,0)}get geometries(){return a.unique(this.components.map(k=>k.geometry))}}class n{constructor(k){this.levels=k;this.levels.sort((g,q)=>g.minScreenSpaceRadius===q.minScreenSpaceRadius?g.numVertices-q.numVertices:g.minScreenSpaceRadius-q.minScreenSpaceRadius)}}b.LodComponentResources=d;b.LodLevelResources=f;b.LodResources=n;b.geometriesFromLodResources=
function(k){const g=[];k.levels.forEach(q=>q.components.forEach(e=>g.push(e.geometry)));return a.unique(g)};b.materialsFromLodResources=function(k){const g=[];k.levels.forEach(q=>q.components.forEach(e=>g.push(e.geometry.material)));return a.unique(g)};b.texturesFromLodResources=function(k){const g=[];k.levels.forEach(q=>q.components.forEach(e=>{null!=e.textures&&g.push(...e.textures)}));return a.unique(g)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/SymbolComplexity":function(){define(["exports"],
function(b){class a{constructor(k){this.estimated=!1;this.verticesPerFeature=k.verticesPerFeature??0;this.verticesPerCoordinate=k.verticesPerCoordinate??0;this.drawCallsPerFeature=k.drawCallsPerFeature??0;this.memory=k.memory??new n}}class c extends a{constructor(k){super(k);this.estimated=!0}}class d extends a{constructor(k,g){super(g);this.numComplexities=k}}class f extends c{constructor(k,g){super(g);this.numComplexities=k}}class n{constructor(){this.resourceBytes=this.bytesPerFeatureLabel=this.bytesPerFeature=
0;this.draped={bytesPerFeature:0,bytesPerFeatureLabel:0}}}b.AggregateSymbolComplexity=d;b.EstimatedAggregateSymbolComplexity=f;b.EstimatedSymbolComplexity=c;b.SymbolComplexity=a;b.SymbolComplexityMemory=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/edgeUtils":function(){define("exports ../../../../Color ../../../../core/has ../../../../core/screenUtils ../../../../chunks/vec4f64 ./layerUtils ../../webgl-engine/lib/edgeRendering/interfaces".split(" "),
function(b,a,c,d,f,n,k){function g(l,w){if(null==l)return null;const v=null!=l.color?f.fromArray(a.toUnitRGBA(l.color)):f.fromValues(0,0,0,0),x=d.pt2px(l.size),p=d.pt2px(l.extensionLength);switch(l.type){case "solid":return q({color:v,size:x,extensionLength:p,...w});case "sketch":return{...m,color:v,size:x,extensionLength:p,...w,type:"sketch"}}}function q(l){return{...e,...l,type:"solid"}}const e={color:f.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:k.Transparency.OPAQUE,
hasSlicePlane:!1},m={color:f.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:k.Transparency.OPAQUE,hasSlicePlane:!1};b.createMaterial=function(l,w){return g(l&&l.enabled&&l.edges||null,w)};b.createMaterialFromEdges=g;b.createSolidEdgeMaterial=q;b.hasEdges=function(l){return l&&l.enabled&&(n.isExtrudeSymbol3DLayer(l)||n.isFillSymbol3DLayer(l))&&null!=l.edges};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/layerUtils":function(){define(["exports"],
function(b){b.isExtrudeSymbol3DLayer=function(a){return"extrude"===a.type};b.isFillSymbol3DLayer=function(a){return"fill"===a.type};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/DefaultMaterial":function(){define("exports ../../../../core/has ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../ViewingMode ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../lib/basicInterfaces ../lib/GLTextureMaterial ../lib/Material ../lib/OrderIndependentTransparency ../lib/RenderSlot ../lib/VertexAttribute ../lib/verticalOffsetUtils ./DefaultBufferWriter ./internal/MaterialUtil ../shaders/DefaultMaterialTechnique ../shaders/DefaultMaterialTechniqueConfiguration ../shaders/RealisticTreeTechnique".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z){class A extends w.Material{constructor(J){super(J,B);this.supportsEdges=!0;this._configuration=new y.DefaultMaterialTechniqueConfiguration;J=this.parameters;const R=n.newLayout().vec3f(p.VertexAttribute.POSITION);J.normalType===g.NormalType.Compressed?R.vec2i16(p.VertexAttribute.NORMALCOMPRESSED,{glNormalized:!0}):R.vec3f(p.VertexAttribute.NORMAL);J.hasVertexTangents&&R.vec4f(p.VertexAttribute.TANGENT);(J.textureId||J.normalTextureId||J.metallicRoughnessTextureId||
J.emissiveTextureId||J.occlusionTextureId)&&R.vec2f(p.VertexAttribute.UV0);J.hasVertexColors&&R.vec4u8(p.VertexAttribute.COLOR);J.hasSymbolColors&&R.vec4u8(p.VertexAttribute.SYMBOLCOLOR);a("enable-feature:objectAndLayerId-rendering")&&R.vec4u8(p.VertexAttribute.OBJECTANDLAYERIDCOLOR);this._vertexBufferLayout=R}isVisibleForOutput(J){return J===k.ShaderOutput.Shadow||J===k.ShaderOutput.ShadowExcludeHighlight||J===k.ShaderOutput.ShadowHighlight?this.parameters.castShadows:!0}isVisible(){var J=this.parameters;
if(!super.isVisible()||0===J.layerOpacity)return!1;const {hasInstancedColor:R,hasVertexColors:X,hasSymbolColors:U,vvColor:M}=J,V="replace"===J.colorMixMode,Y=0<J.opacity;J=J.externalColor&&0<J.externalColor[3];const W=R||M||U;return X&&W?V||Y:X?V?J:Y:W?V||Y:V?J:Y}getConfiguration(J,R){this._configuration.output=J;this._configuration.hasNormalTexture=!!this.parameters.normalTextureId;this._configuration.hasColorTexture=!!this.parameters.textureId;this._configuration.hasVertexTangents=this.parameters.hasVertexTangents;
this._configuration.instanced=this.parameters.isInstanced;this._configuration.instancedDoublePrecision=this.parameters.instancedDoublePrecision;this._configuration.vvSize=!!this.parameters.vvSize;this._configuration.hasVerticalOffset=null!=this.parameters.verticalOffset;this._configuration.hasScreenSizePerspective=null!=this.parameters.screenSizePerspective;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.hasSliceHighlight=this.parameters.hasSliceHighlight;this._configuration.alphaDiscardMode=
this.parameters.textureAlphaMode;this._configuration.normalType=this.parameters.normalType;this._configuration.transparent=this.parameters.transparent;this._configuration.writeDepth=this.parameters.writeDepth;null!=this.parameters.customDepthTest&&(this._configuration.customDepthTest=this.parameters.customDepthTest);this._configuration.hasOccludees=this.parameters.hasOccludees;this._configuration.cullFace=this.parameters.hasSlicePlane?m.CullFaceOptions.None:this.parameters.cullFace;this._configuration.multipassEnabled=
R.multipassEnabled;this._configuration.cullAboveGround=R.multipassTerrain.cullAboveGround;this._configuration.hasModelTransformation=null!=this.parameters.modelTransformation;if(J===k.ShaderOutput.Color||J===k.ShaderOutput.Alpha)this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSymbolColors=this.parameters.hasSymbolColors,this._configuration.doubleSidedMode=this.parameters.treeRendering?q.NormalsDoubleSidedMode.WindingOrder:this.parameters.doubleSided&&"normal"===
this.parameters.doubleSidedType?q.NormalsDoubleSidedMode.View:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?q.NormalsDoubleSidedMode.WindingOrder:q.NormalsDoubleSidedMode.None,this._configuration.instancedColor=this.parameters.hasInstancedColor,this._configuration.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this._configuration.receiveAmbientOcclusion=null!=R.ssao,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.textureAlphaPremultiplied=
!!this.parameters.textureAlphaPremultiplied,this._configuration.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?e.PBRMode.Schematic:e.PBRMode.Normal:e.PBRMode.Disabled,this._configuration.hasMetallicRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this._configuration.hasEmissionTexture=!!this.parameters.emissiveTextureId,this._configuration.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this._configuration.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),
this._configuration.transparencyPassType=R.transparencyPassType,this._configuration.enableOffset=R.camera.relativeElevation<v.OITPolygonOffsetLimit,this._configuration.snowCover=this.hasSnowCover(R),this._configuration.hasColorTextureTransform=!!this.parameters.colorTextureTransformMatrix,this._configuration.hasNormalTextureTransform=!!this.parameters.normalTextureTransformMatrix,this._configuration.hasEmissionTextureTransform=!!this.parameters.emissiveTextureTransformMatrix,this._configuration.hasOcclusionTextureTransform=
!!this.parameters.occlusionTextureTransformMatrix,this._configuration.hasMetallicRoughnessTextureTransform=!!this.parameters.metallicRoughnessTextureTransformMatrix;return this._configuration}hasSnowCover(J){return null!=J.weather&&J.weatherVisible&&"snowy"===J.weather.type&&"enabled"===J.weather.snowCover}intersect(J,R,X,U,M,V){if(null!=this.parameters.verticalOffset){const W=X.camera;c.set(O,R[12],R[13],R[14]);R=null;switch(X.viewingMode){case f.ViewingMode.Global:R=c.normalize(L,O);break;case f.ViewingMode.Local:R=
c.copy(L,K)}let H=0;var Y=c.subtract(P,O,W.eye);const S=c.length(Y);Y=c.scale(Y,Y,1/S);let I=null;this.parameters.screenSizePerspective&&(I=c.dot(R,Y));H+=r.verticalOffsetAtDistance(W,S,this.parameters.verticalOffset,I??0,this.parameters.screenSizePerspective);c.scale(R,R,H);c.transformMat3(G,R,X.transform.inverseRotation);U=c.subtract(D,U,G);M=c.subtract(F,M,G)}r.intersectTriangleGeometry(J,X,U,M,h.getVerticalOffsetObject3D(X.verticalOffset),V)}produces(J,R){return R===k.ShaderOutput.Color||R===
k.ShaderOutput.Alpha||R===k.ShaderOutput.Depth||R===k.ShaderOutput.Normal||R===k.ShaderOutput.Shadow||R===k.ShaderOutput.ShadowHighlight||R===k.ShaderOutput.ShadowExcludeHighlight||R===k.ShaderOutput.Highlight||R===k.ShaderOutput.ObjectAndLayerIdColor?J===(this.parameters.transparent?this.parameters.writeDepth?x.RenderSlot.TRANSPARENT_MATERIAL:x.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:x.RenderSlot.OPAQUE_MATERIAL)||J===x.RenderSlot.DRAPED_MATERIAL:!1}createGLMaterial(J){return new C(J)}createBufferWriter(){return new t.DefaultBufferWriter(this._vertexBufferLayout)}}
class C extends l.GLTextureMaterial{constructor(J){super({...J,...J.material.parameters})}_updateShadowState(J){J.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:J.shadowMap.enabled})}_updateOccludeeState(J){J.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:J.hasOccludees})}beginSlot(J){if(this._output===k.ShaderOutput.Color||this._output===k.ShaderOutput.Alpha)this._updateShadowState(J),
this._updateOccludeeState(J);const R=this._material.parameters;this.updateTexture(R.textureId);const X=J.camera.viewInverseTransposeMatrix;c.set(R.origin,X[3],X[7],X[11]);this._material.setParameters(this.textureBindParameters);return this.ensureTechnique(R.treeRendering?z.RealisticTreeTechnique:u.DefaultMaterialTechnique,J)}}class E extends u.DefaultMaterialPassParameters{constructor(){super(...arguments);this.hasVertexTangents=this.treeRendering=this.initTextureTransparent=!1}}const B=new E,D=d.create(),
F=d.create(),K=d.fromValues(0,0,1),L=d.create(),G=d.create(),O=d.create(),P=d.create();b.DefaultGLMaterial=C;b.DefaultMaterial=A;b.DefaultMaterialParameters=E;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl":function(){define(["exports","../../../../../../core/compilerUtils","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(b,a,c,d){b.NormalType=void 0;(function(f){f[f.Attribute=
0]="Attribute";f[f.Compressed=1]="Compressed";f[f.Ground=2]="Ground";f[f.ScreenDerivative=3]="ScreenDerivative";f[f.COUNT=4]="COUNT"})(b.NormalType||(b.NormalType={}));b.NormalAttribute=function(f,n){switch(n.normalType){case b.NormalType.Compressed:f.attributes.add(d.VertexAttribute.NORMALCOMPRESSED,"vec2");f.vertex.code.add(c.glsl`vec3 normalModel() {
float z = 1.0 - abs(normalCompressed.x) - abs(normalCompressed.y);
return vec3(normalCompressed + sign(normalCompressed) * min(z, 0.0), z);
}`);break;case b.NormalType.Attribute:f.attributes.add(d.VertexAttribute.NORMAL,"vec3");f.vertex.code.add(c.glsl`vec3 normalModel() {
return normal;
}`);break;case b.NormalType.ScreenDerivative:f.fragment.code.add(c.glsl`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`);break;default:a.neverReached(n.normalType);case b.NormalType.COUNT:case b.NormalType.Ground:}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl":function(){define(["exports","../../../../../../core/compilerUtils","../../shaderModules/interfaces"],function(b,a,c){b.NormalsDoubleSidedMode=void 0;(function(d){d[d.None=0]="None";d[d.View=1]="View";d[d.WindingOrder=2]="WindingOrder";d[d.COUNT=3]="COUNT"})(b.NormalsDoubleSidedMode||
(b.NormalsDoubleSidedMode={}));b.Normals=function(d,f){d=d.fragment;d.code.add(c.glsl`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`);switch(f.doubleSidedMode){case b.NormalsDoubleSidedMode.None:d.code.add(c.glsl`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case b.NormalsDoubleSidedMode.View:d.code.add(c.glsl`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case b.NormalsDoubleSidedMode.WindingOrder:d.code.add(c.glsl`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:a.neverReached(f.doubleSidedMode);case b.NormalsDoubleSidedMode.COUNT:}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/DefaultBufferWriter":function(){define(["exports","../lib/VertexAttribute","./internal/bufferWriterUtils"],function(b,a,c){class d{constructor(f){this.vertexBufferLayout=f}elementCount(f){return f.attributes.get(a.VertexAttribute.POSITION).indices.length}write(f,n,k,g,q){c.writeDefaultAttributes(k,this.vertexBufferLayout,
f,n,g,q)}}b.DefaultBufferWriter=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/DefaultMaterialTechnique":function(){define("require exports ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../ViewingMode ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../core/shaderLibrary/attributes/VertexNormal.glsl ../core/shaderLibrary/util/AlphaCutoff ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/basicInterfaces ../lib/DefaultVertexAttributeLocations ../lib/Material ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../lib/TransparencyPassType ../materials/pbrUtils ../../../../chunks/DefaultMaterial.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A){class C extends q.VertexNormalPassParameters{constructor(){super(...arguments);this.usePBR=this.isSchematic=!1;this.mrrFactors=c.fromArray(u.defaultAdvancedMRRFactors);this.doubleSided=this.hasSymbolColors=this.hasVertexColors=!1;this.doubleSidedType="normal";this.cullFace=w.CullFaceOptions.Back;this.hasInstancedColor=this.isInstanced=!1;this.emissiveFactor=c.fromValues(0,0,0);this.instancedDoublePrecision=!1;this.normalType=k.NormalType.Attribute;
this.castShadows=this.receiveShadows=!0;this.shadowMappingEnabled=!1;this.ambient=c.fromValues(.2,.2,.2);this.diffuse=c.fromValues(.8,.8,.8);this.externalColor=d.fromValues(1,1,1,1);this.colorMixMode="multiply";this.layerOpacity=this.opacity=1;this.origin=c.create();this.hasSlicePlane=!1;this.hasSliceHighlight=!0;this.offsetTransparentBackfaces=!1;this.modelTransformation=this.vvSymbolRotationMatrix=this.vvSymbolAnchor=this.vvOpacity=this.vvColor=this.vvSize=null;this.transparent=!1;this.writeDepth=
!0;this.customDepthTest=w.DepthTestFunction.Less;this.textureAlphaMode=w.AlphaDiscardMode.Blend;this.textureAlphaCutoff=e.defaultMaskAlphaCutoff;this.hasOccludees=this.textureAlphaPremultiplied=!1;this.renderOccluded=x.RenderOccludedFlag.Occlude;this.isDecoration=!1}}class E extends q.VertexNormalDrawParameters{constructor(){super(...arguments);this.slicePlaneLocalOrigin=this.origin=c.create()}}class B extends l.ShaderTechnique{initializeConfiguration(D,F){F.spherical=D.viewingMode===f.ViewingMode.Global;
F.doublePrecisionRequiresObfuscation=D.rctx.driverTest.doublePrecisionRequiresObfuscation.result;F.textureCoordinateType=F.hasColorTexture||F.hasMetallicRoughnessTexture||F.hasEmissionTexture||F.hasOcclusionTexture||F.hasNormalTexture?g.TextureCoordinateAttributeType.Default:g.TextureCoordinateAttributeType.None;F.objectAndLayerIdColorInstanced=F.instanced}initializeProgram(D){return this._initializeProgram(D,B.shader)}_initializeProgram(D,F){return new h.Program(D.rctx,F.get().build(this.configuration),
v.Default3D)}_convertDepthTestFunction(D){return D===w.DepthTestFunction.Lequal?z.CompareFunction.LEQUAL:z.CompareFunction.LESS}_makePipeline(D,F){const K=this.configuration,L=D===r.TransparencyPassType.NONE,G=D===r.TransparencyPassType.FrontFace;var O=A.makePipelineState,P=K.output!==n.ShaderOutput.Color&&K.output!==n.ShaderOutput.Alpha||!K.transparent?null:L?p.blendingDefault:p.oitBlending(D);var J=K.cullFace!==w.CullFaceOptions.None?!0:K.hasSlicePlane?!1:!K.transparent&&!K.doubleSidedMode;return O.call(A,
{blending:P,culling:J?A.cullingParams(K.cullFace):null,depthTest:{func:p.oitDepthTest(D,this._convertDepthTestFunction(K.customDepthTest))},depthWrite:L||G?K.writeDepth?A.defaultDepthWriteParams:null:null,colorWrite:A.defaultColorWriteParams,stencilWrite:K.hasOccludees?t.stencilWriteMaskOn:null,stencilTest:K.hasOccludees?F?t.stencilToolMaskBaseParams:t.stencilBaseAllZerosParams:null,polygonOffset:L||G?null:p.getOITPolygonOffset(K.enableOffset)})}initializePipeline(){this._occludeePipelineState=this._makePipeline(this.configuration.transparencyPassType,
!0);return this._makePipeline(this.configuration.transparencyPassType,!1)}getPipeline(D){return D?this._occludeePipelineState:super.getPipeline()}}B.shader=new m.ReloadableShaderModule(y.DefaultMaterial,()=>new Promise((D,F)=>b(["./DefaultMaterial.glsl"],D,F)));a.DefaultMaterialDrawParameters=E;a.DefaultMaterialPassParameters=C;a.DefaultMaterialTechnique=B;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl":function(){define("exports ../../../../../../core/compilerUtils ../../../../../../chunks/mat3f64 ../../../../../../chunks/vec4f64 ./NormalAttribute.glsl ./VertexPosition.glsl ../../shaderModules/interfaces ../../shaderModules/Matrix3DrawUniform ../../shaderModules/Matrix3PassUniform".split(" "),
function(b,a,c,d,f,n,k,g,q){class e extends n.VertexPositionPassParameters{constructor(){super(...arguments);this.transformNormalViewFromGlobal=c.create()}}class m extends n.VertexPositionDrawParameters{constructor(){super(...arguments);this.transformNormalGlobalFromModel=c.create();this.toMapSpace=d.create()}}b.VertexNormal=function(l,w){switch(w.normalType){case f.NormalType.Attribute:case f.NormalType.Compressed:l.include(f.NormalAttribute,w);l.varyings.add("vNormalWorld","vec3");l.varyings.add("vNormalView",
"vec3");l.vertex.uniforms.add(new g.Matrix3DrawUniform("transformNormalGlobalFromModel",v=>v.transformNormalGlobalFromModel),new q.Matrix3PassUniform("transformNormalViewFromGlobal",v=>v.transformNormalViewFromGlobal));l.vertex.code.add(k.glsl`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`);break;case f.NormalType.Ground:l.include(n.VertexPosition,w);l.varyings.add("vNormalWorld","vec3");l.vertex.code.add(k.glsl`
        void forwardNormal() {
          vNormalWorld = ${w.spherical?k.glsl`normalize(vPositionWorldCameraRelative);`:k.glsl`vec3(0.0, 0.0, 1.0);`}
        }
        `);break;case f.NormalType.ScreenDerivative:l.vertex.code.add(k.glsl`void forwardNormal() {}`);break;default:a.neverReached(w.normalType);case f.NormalType.COUNT:}};b.VertexNormalDrawParameters=m;b.VertexNormalPassParameters=e;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/StencilUtils":function(){define(["exports","./basicInterfaces","../../../webgl/enums"],function(b,a,c){const d={func:c.CompareFunction.LESS},f={function:{func:c.CompareFunction.ALWAYS,
ref:a.StencilBits.OutlineVisualElementMask,mask:a.StencilBits.OutlineVisualElementMask},operation:{fail:c.StencilOperation.KEEP,zFail:c.StencilOperation.KEEP,zPass:c.StencilOperation.ZERO}},n={function:{func:c.CompareFunction.ALWAYS,ref:a.StencilBits.OutlineVisualElementMask,mask:a.StencilBits.OutlineVisualElementMask},operation:{fail:c.StencilOperation.KEEP,zFail:c.StencilOperation.KEEP,zPass:c.StencilOperation.REPLACE}},k={function:{func:c.CompareFunction.EQUAL,ref:a.StencilBits.OutlineVisualElementMask,
mask:a.StencilBits.OutlineVisualElementMask},operation:{fail:c.StencilOperation.KEEP,zFail:c.StencilOperation.KEEP,zPass:c.StencilOperation.KEEP}};a={function:{func:c.CompareFunction.NOTEQUAL,ref:a.StencilBits.OutlineVisualElementMask,mask:a.StencilBits.OutlineVisualElementMask},operation:{fail:c.StencilOperation.KEEP,zFail:c.StencilOperation.KEEP,zPass:c.StencilOperation.KEEP}};b.depthCompareAlways={func:c.CompareFunction.ALWAYS};b.depthCompareLess=d;b.renderWhenBitIsNotSet=g=>({function:{func:c.CompareFunction.NOTEQUAL,
ref:g,mask:g},operation:{fail:c.StencilOperation.KEEP,zFail:c.StencilOperation.KEEP,zPass:c.StencilOperation.KEEP}});b.replaceBitWhenDepthTestPasses=g=>({function:{func:c.CompareFunction.ALWAYS,ref:g,mask:g},operation:{fail:c.StencilOperation.KEEP,zFail:c.StencilOperation.KEEP,zPass:c.StencilOperation.REPLACE}});b.stencilBaseAllZerosParams=f;b.stencilToolMaskBaseParams=n;b.stencilToolMaskOccluderParams=k;b.stencilToolTransparentOccluderParams=a;b.stencilWriteMaskOff={mask:0};b.stencilWriteMaskOn=
{mask:255};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/pbrUtils":function(){define(["exports","../../../../chunks/vec3","../../../../chunks/vec3f64"],function(b,a,c){b.defaultAdvancedMRRFactors=[1,1,.5];b.defaultEsriSymbologyMRRFactors=[0,1,.2];b.defaultSchematicMRRFactors=[0,.6,.2];b.useSchematicPBR=function({normalTexture:d,metallicRoughnessTexture:f,metallicFactor:n,roughnessFactor:k,emissiveTexture:g,emissiveFactor:q,occlusionTexture:e}){return null==
d&&null==f&&null==g&&(null==q||a.exactEquals(q,c.ZEROS))&&null==e&&(null==k||1===k)&&(null==n||1===n||0===n)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/DefaultMaterial.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/Offset.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl ../views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/TextureTransformUV.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A,C,E,B,D,F,K,L,G,O,P,J,R,X,U,M){function V(W){const H=new R.ShaderBuilder,{vertex:S,fragment:I,varyings:Q}=H;L.addProjViewLocalOrigin(S,W);H.include(q.PositionAttribute);Q.add("vpos","vec3");H.include(B.VisualVariables,W);H.include(k.InstancedDoublePrecision,W);H.include(v.VerticalOffset,W);W.hasColorTextureTransform&&H.include(E.colorTextureUV);if(W.output===d.ShaderOutput.Color||W.output===d.ShaderOutput.Alpha){W.hasNormalTextureTransform&&H.include(E.normalTextureUV);
W.hasEmissionTextureTransform&&H.include(E.emissiveTextureUV);W.hasOcclusionTextureTransform&&H.include(E.occlusionTextureUV);W.hasMetallicRoughnessTextureTransform&&H.include(E.metallicRoughnessTextureUV);L.addCameraPosition(S,W);H.include(g.NormalAttribute,W);H.include(n.Transform,W);const N=W.normalType===g.NormalType.Attribute||W.normalType===g.NormalType.Compressed;N&&W.offsetBackfaces&&H.include(c.Offset);H.include(p.ComputeNormalTexture,W);H.include(w.VertexNormal,W);W.instancedColor&&H.attributes.add(M.VertexAttribute.INSTANCECOLOR,
"vec4");Q.add("vPositionLocal","vec3");H.include(m.TextureCoordinateAttribute,W);H.include(a.ForwardLinearDepth,W);H.include(e.SymbolColor,W);H.include(l.VertexColor,W);S.uniforms.add(new O.Float4PassUniform("externalColor",T=>T.externalColor));Q.add("vcolorExt","vec4");W.multipassEnabled&&Q.add("depth","float");S.code.add(J.glsl`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${W.instancedColor?"vcolorExt *\x3d instanceColor * 0.003921568627451;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${J.glsl.float(D.symbolAlphaCutoff)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        } else {
          vpos = getVertexInLocalOriginSpace();
          vPositionLocal = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${N?J.glsl`vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${W.hasVertexTangents?"vTangent \x3d dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, vpos);
          ${N&&W.offsetBackfaces?"gl_Position \x3d offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${W.multipassEnabled?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
        ${W.hasColorTextureTransform?J.glsl`forwardColorUV();`:""}
        ${W.hasNormalTextureTransform?J.glsl`forwardNormalUV();`:""}
        ${W.hasEmissionTextureTransform?J.glsl`forwardEmissiveUV();`:""}
        ${W.hasOcclusionTextureTransform?J.glsl`forwardOcclusionUV();`:""}
        ${W.hasMetallicRoughnessTextureTransform?J.glsl`forwardMetallicRoughnessUV();`:""}
      }
    `)}switch(W.output){case d.ShaderOutput.Alpha:H.include(f.SliceDraw,W);H.include(F.DiscardOrAdjustAlphaPass,W);H.include(u.multipassTerrainTest,W);I.uniforms.add(new P.FloatPassUniform("opacity",N=>N.opacity),new P.FloatPassUniform("layerOpacity",N=>N.layerOpacity));W.hasColorTexture&&I.uniforms.add(new X.Texture2DPassUniform("tex",N=>N.texture));I.include(K.MixExternalColor);I.code.add(J.glsl`
      void main() {
        discardBySlice(vpos);
        ${W.multipassEnabled?"terrainDepthTest(depth);":""}
        ${W.hasColorTexture?J.glsl`
                vec4 texColor = texture(tex, ${W.hasColorTextureTransform?J.glsl`colorUV`:J.glsl`vuv0`});
                ${W.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:J.glsl`vec4 texColor = vec4(1.0);`}
        ${W.hasVertexColors?J.glsl`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:J.glsl`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        fragColor = vec4(opacity_);
      }
    `);break;case d.ShaderOutput.Color:H.include(f.SliceDraw,W),H.include(t.EvaluateSceneLighting,W),H.include(h.EvaluateAmbientOcclusion,W),H.include(F.DiscardOrAdjustAlphaPass,W),H.include(W.instancedDoublePrecision?C.ReadShadowMapPass:C.ReadShadowMapDraw,W),H.include(u.multipassTerrainTest,W),L.addCameraPosition(I,W),I.uniforms.add(S.uniforms.get("localOrigin"),new G.Float3PassUniform("ambient",N=>N.ambient),new G.Float3PassUniform("diffuse",N=>N.diffuse),new P.FloatPassUniform("opacity",N=>N.opacity),
new P.FloatPassUniform("layerOpacity",N=>N.layerOpacity)),W.hasColorTexture&&I.uniforms.add(new X.Texture2DPassUniform("tex",N=>N.texture)),H.include(A.PhysicallyBasedRenderingParameters,W),H.include(z.PhysicallyBasedRendering,W),I.include(K.MixExternalColor),H.include(y.Normals,W),t.addAmbientBoostFactor(I),t.addLightingGlobalFactor(I),r.addMainLightIntensity(I),I.code.add(J.glsl`
      void main() {
        discardBySlice(vpos);
        ${W.multipassEnabled?"terrainDepthTest(depth);":""}
        ${W.hasColorTexture?J.glsl`
                vec4 texColor = texture(tex, ${W.hasColorTextureTransform?J.glsl`colorUV`:J.glsl`vuv0`});
                ${W.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:J.glsl`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${W.normalType===g.NormalType.ScreenDerivative?J.glsl`
                vec3 normal = screenDerivativeNormal(vPositionLocal);`:J.glsl`
                shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
        ${W.pbrMode===A.PBRMode.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        vec3 posWorld = vpos + localOrigin;

        float additionalAmbientScale = additionalDirectedAmbientLight(posWorld);
        float shadow = ${W.receiveShadows?"readShadowMap(vpos, linearDepth)":W.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

        vec3 matColor = max(ambient, diffuse);
        ${W.hasVertexColors?J.glsl`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:J.glsl`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${W.hasNormalTexture?J.glsl`
                mat3 tangentSpace = ${W.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
                vec3 shadingNormal = computeTextureNormal(tangentSpace, ${W.hasNormalTextureTransform?J.glsl`normalUV`:"vuv0"});`:J.glsl`vec3 shadingNormal = normal;`}
        vec3 normalGround = ${W.spherical?J.glsl`normalize(posWorld);`:J.glsl`vec3(0.0, 0.0, 1.0);`}

        ${W.snowCover?J.glsl`
                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
                albedo = mix(albedo, vec3(1), snow);
                shadingNormal = mix(shadingNormal, normal, snow);
                ssao = mix(ssao, 1.0, snow);`:""}

        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        ${W.pbrMode===A.PBRMode.Normal||W.pbrMode===A.PBRMode.Schematic?J.glsl`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${W.snowCover?J.glsl`
                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                        emission = mix(emission, vec3(0.0), snow);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:J.glsl`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${W.transparencyPassType===U.TransparencyPassType.Color?J.glsl`fragColor = premultiplyAlpha(fragColor);`:""}
      }
    `)}H.include(x.DefaultMaterialAuxiliaryPasses,W);return H}const Y=Object.freeze(Object.defineProperty({__proto__:null,build:V},Symbol.toStringTag,{value:"Module"}));b.DefaultMaterial=Y;b.build=V})},"esri/views/3d/webgl-engine/core/shaderLibrary/Offset.glsl":function(){define(["exports","../shaderModules/interfaces"],function(b,a){b.Offset=function(c){c.vertex.code.add(a.glsl`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl":function(){define("exports ../../../collections/Component/Material/shader/DecodeSymbolColor.glsl ../../shaderModules/IntegerPassUniform ../../shaderModules/interfaces ../../../lib/VertexAttribute ../../../materials/internal/MaterialUtil".split(" "),function(b,a,c,d,f,n){b.SymbolColor=function(k,g){g.hasSymbolColors?(k.include(a.DecodeSymbolColor),k.attributes.add(f.VertexAttribute.SYMBOLCOLOR,
"vec4"),k.varyings.add("colorMixMode","mediump float"),k.vertex.code.add(d.glsl`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(k.fragment.uniforms.add(new c.IntegerPassUniform("colorMixMode",q=>n.colorMixModes[q.colorMixMode])),k.vertex.code.add(d.glsl`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/DecodeSymbolColor.glsl":function(){define(["exports","../../../../../layers/support/symbolColorUtils","../../../../core/shaderModules/interfaces"],function(b,a,c){b.DecodeSymbolColor=function(d){d.vertex.code.add(c.glsl`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${c.glsl.int(a.ColorMixModeEnum.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${c.glsl.int(a.ColorMixModeEnum.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${c.glsl.int(a.ColorMixModeEnum.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${c.glsl.int(a.ColorMixModeEnum.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/symbolColorUtils":function(){define(["exports","../../../../core/mathUtils"],function(b,a){b.ColorMixModeEnum=void 0;(function(c){c[c.Multiply=1]="Multiply";c[c.Ignore=2]="Ignore";c[c.Replace=3]="Replace";c[c.Tint=4]="Tint"})(b.ColorMixModeEnum||(b.ColorMixModeEnum={}));b.encodeSymbolColor=function(c,d,f){if(null==c||d===b.ColorMixModeEnum.Ignore)f[0]=255,f[1]=255,f[2]=255,f[3]=255;else{var n=a.clamp(Math.round(85*
c[3]),0,85);d=0===n||d===b.ColorMixModeEnum.Tint?0:d===b.ColorMixModeEnum.Replace?85:170;f[0]=a.clamp(Math.round(255*c[0]),0,255);f[1]=a.clamp(Math.round(255*c[1]),0,255);f[2]=a.clamp(Math.round(255*c[2]),0,255);f[3]=n+d}};b.parseColorMixMode=function(c){switch(c){case "multiply":return b.ColorMixModeEnum.Multiply;case "ignore":return b.ColorMixModeEnum.Ignore;case "replace":return b.ColorMixModeEnum.Replace;case "tint":return b.ColorMixModeEnum.Tint;default:return b.ColorMixModeEnum.Multiply}};Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/IntegerPassUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(b,a,c){class d extends a.Uniform{constructor(f,n){super(f,"int",c.BindType.Pass,(k,g,q)=>k.setUniform1i(f,n(g,q)))}}b.IntegerPassUniform=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl":function(){define(["exports","../../shaderModules/interfaces",
"../../../lib/VertexAttribute"],function(b,a,c){b.VertexColor=function(d,f){f.hasVertexColors?(d.attributes.add(c.VertexAttribute.COLOR,"vec4"),d.varyings.add("vColor","vec4"),d.vertex.code.add(a.glsl`void forwardVertexColor() { vColor = color; }`),d.vertex.code.add(a.glsl`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):d.vertex.code.add(a.glsl`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl":function(){define("exports ../ForwardLinearDepth.glsl ../ShaderOutput ../Slice.glsl ../Transform.glsl ../attributes/NormalAttribute.glsl ../attributes/ObjectAndLayerIdColor.glsl ../attributes/TextureCoordinateAttribute.glsl ../attributes/VertexNormal.glsl ../output/OutputDepth.glsl ../output/OutputHighlight.glsl ../shading/VisualVariables.glsl ../util/AlphaDiscard.glsl ../util/View.glsl ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform ../../../lib/basicInterfaces".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h){b.DefaultMaterialAuxiliaryPasses=function(t,r){const {vertex:u,fragment:y}=t,z=r.hasColorTexture&&r.alphaDiscardMode!==h.AlphaDiscardMode.Opaque;switch(r.output){case c.ShaderOutput.Depth:case c.ShaderOutput.Shadow:case c.ShaderOutput.ShadowHighlight:case c.ShaderOutput.ShadowExcludeHighlight:case c.ShaderOutput.ObjectAndLayerIdColor:v.addProjViewLocalOrigin(u,r);t.include(f.Transform,r);t.include(g.TextureCoordinateAttribute,r);t.include(l.VisualVariables,
r);t.include(e.OutputDepth,r);t.include(d.SliceDraw,r);t.include(k.ObjectAndLayerIdColor,r);a.addNearFar(t);t.varyings.add("depth","float");z&&y.uniforms.add(new p.Texture2DPassUniform("tex",A=>A.texture));u.code.add(x.glsl`void main(void) {
vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
forwardTextureCoordinates();
forwardObjectAndLayerIdColor();
}`);t.include(w.DiscardOrAdjustAlphaPass,r);y.code.add(x.glsl`
          void main(void) {
            discardBySlice(vpos);
            ${z?x.glsl`
                    vec4 texColor = texture(tex, ${r.hasColorTextureTransform?x.glsl`colorUV`:x.glsl`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            ${r.output===c.ShaderOutput.ObjectAndLayerIdColor?x.glsl`outputObjectAndLayerIdColor();`:x.glsl`outputDepth(depth);`}
          }
        `);break;case c.ShaderOutput.Normal:v.addProjViewLocalOrigin(u,r);t.include(f.Transform,r);t.include(n.NormalAttribute,r);t.include(q.VertexNormal,r);t.include(g.TextureCoordinateAttribute,r);t.include(l.VisualVariables,r);z&&y.uniforms.add(new p.Texture2DPassUniform("tex",A=>A.texture));r.normalType===n.NormalType.ScreenDerivative&&t.varyings.add("vPositionView","vec3");u.code.add(x.glsl`
          void main(void) {
            vpos = getVertexInLocalOriginSpace();

            ${r.normalType===n.NormalType.Attribute||r.normalType===n.NormalType.Compressed?x.glsl`vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:x.glsl`
                  // Get vertex position in camera space for screen-space derivative normals
                  vPositionView = (view * vec4(vpos, 1.0)).xyz;
                `}
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            forwardTextureCoordinates();
          }
        `);t.include(d.SliceDraw,r);t.include(w.DiscardOrAdjustAlphaPass,r);y.code.add(x.glsl`
          void main() {
            discardBySlice(vpos);
            ${z?x.glsl`
                    vec4 texColor = texture(tex, ${r.hasColorTextureTransform?x.glsl`colorUV`:x.glsl`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}

            ${r.normalType===n.NormalType.ScreenDerivative?x.glsl`vec3 normal = screenDerivativeNormal(vPositionView);`:x.glsl`
                  vec3 normal = normalize(vNormalWorld);
                  if (gl_FrontFacing == false){
                    normal = -normal;
                  }`}
            fragColor = vec4(0.5 + 0.5 * normal, 1.0);
          }
        `);break;case c.ShaderOutput.Highlight:v.addProjViewLocalOrigin(u,r),t.include(f.Transform,r),t.include(g.TextureCoordinateAttribute,r),t.include(l.VisualVariables,r),z&&y.uniforms.add(new p.Texture2DPassUniform("tex",A=>A.texture)),u.code.add(x.glsl`void main(void) {
vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPosition(proj, view, vpos);
forwardTextureCoordinates();
}`),t.include(d.SliceDraw,r),t.include(w.DiscardOrAdjustAlphaPass,r),t.include(m.OutputHighlight,r),y.code.add(x.glsl`
          void main() {
            discardBySlice(vpos);
            ${z?x.glsl`
                    vec4 texColor = texture(tex, ${r.hasColorTextureTransform?x.glsl`colorUV`:x.glsl`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            outputHighlight();
          }
        `)}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl":function(){define(["exports","../ShaderOutput","../util/RgbaFloat16Encoding.glsl","../util/RgbaFloatEncoding.glsl","../../shaderModules/interfaces"],function(b,a,c,d,f){b.OutputDepth=function(n,k){switch(k.output){case a.ShaderOutput.Shadow:case a.ShaderOutput.ShadowHighlight:case a.ShaderOutput.ShadowExcludeHighlight:n.fragment.include(c.Rgba4FloatEncoding);
n.fragment.code.add(f.glsl`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 20.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
return depth + SLOPE_SCALE * m + BIAS;
}
void outputDepth(float _linearDepth) {
fragColor = floatToRgba4(_calculateFragDepth(_linearDepth));
}`);break;case a.ShaderOutput.Depth:n.fragment.include(d.RgbaFloatEncoding),n.fragment.code.add(f.glsl`void outputDepth(float _linearDepth) {
fragColor = float2rgba(_linearDepth);
}`)}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloat16Encoding.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(b,a){b.Rgba4FloatEncoding=function(c){c.code.add(a.glsl`const float MAX_RGBA4_FLOAT =
15.0 / 16.0 +
15.0 / 16.0 / 16.0 +
15.0 / 16.0 / 16.0 / 16.0 +
15.0 / 16.0 / 16.0 / 16.0 / 16.0;
const vec4 FIXED_POINT_FACTORS_RGBA4 = vec4(1.0, 16.0, 16.0 * 16.0, 16.0 * 16.0 * 16.0);
vec4 floatToRgba4(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA4_FLOAT);
vec4 fixedPointU4 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS_RGBA4) * 16.0);
const float toU4AsFloat = 1.0 / 15.0;
return fixedPointU4 * toU4AsFloat;
}
const vec4 RGBA4_2_FLOAT_FACTORS = vec4(
15.0 / (16.0),
15.0 / (16.0 * 16.0),
15.0 / (16.0 * 16.0 * 16.0),
15.0 / (16.0 * 16.0 * 16.0 * 16.0)
);
float rgba4ToFloat(vec4 rgba) {
return dot(rgba, RGBA4_2_FLOAT_FACTORS);
}`)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl":function(){define("exports ./DiscardOrAdjustAlphaBlend.glsl ../../shaderModules/FloatDrawUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../../lib/basicInterfaces".split(" "),function(b,a,c,d,f,n){function k(g,q,e){const m=g.fragment;q.alphaDiscardMode!==n.AlphaDiscardMode.Mask&&q.alphaDiscardMode!==n.AlphaDiscardMode.MaskBlend||
m.uniforms.add(e);switch(q.alphaDiscardMode){case n.AlphaDiscardMode.Blend:return g.include(a.DiscardOrAdjustAlphaBlend);case n.AlphaDiscardMode.Opaque:m.code.add(f.glsl`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case n.AlphaDiscardMode.Mask:m.code.add(f.glsl`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case n.AlphaDiscardMode.MaskBlend:g.fragment.code.add(f.glsl`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}b.DiscardOrAdjustAlphaDraw=function(g,q){k(g,q,new c.FloatDrawUniform("textureAlphaCutoff",e=>e.textureAlphaCutoff))};b.DiscardOrAdjustAlphaPass=function(g,q){k(g,q,new d.FloatPassUniform("textureAlphaCutoff",
e=>e.textureAlphaCutoff))};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/DiscardOrAdjustAlphaBlend.glsl":function(){define(["exports","./AlphaCutoff","../../shaderModules/interfaces"],function(b,a,c){b.DiscardOrAdjustAlphaBlend=function(d){d.fragment.code.add(c.glsl`
    #define discardOrAdjustAlpha(color) { if (color.a < ${c.glsl.float(a.symbolAlphaCutoff)}) { discard; } }
  `)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/FloatDrawUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(b,a,c){class d extends a.Uniform{constructor(f,n){super(f,"float",c.BindType.Draw,(k,g,q)=>k.setUniform1f(f,n(g,q)))}}b.FloatDrawUniform=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl":function(){define("exports ../attributes/TextureCoordinateAttribute.glsl ../attributes/VertexTextureCoordinates.glsl ./Normals.glsl ../../shaderModules/interfaces ../../shaderModules/Texture2DDrawUniform ../../shaderModules/Texture2DPassUniform ../../shaderTechnique/BindType ../../../lib/VertexAttribute".split(" "),
function(b,a,c,d,f,n,k,g,q){b.ComputeNormalTexture=function(e,m){const l=e.fragment;m.hasVertexTangents?(e.attributes.add(q.VertexAttribute.TANGENT,"vec4"),e.varyings.add("vTangent","vec4"),m.doubleSidedMode===d.NormalsDoubleSidedMode.WindingOrder?l.code.add(f.glsl`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):l.code.add(f.glsl`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):l.code.add(f.glsl`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`);m.textureCoordinateType!==a.TextureCoordinateAttributeType.None&&(e.include(c.VertexTextureCoordinates,m),l.uniforms.add(m.pbrTextureBindType===g.BindType.Pass?new k.Texture2DPassUniform("normalTexture",w=>w.textureNormal):new n.Texture2DDrawUniform("normalTexture",w=>w.textureNormal)),l.code.add(f.glsl`vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
vec3 rawNormal = textureLookup(normalTexture, uv).rgb * 2.0 - 1.0;
return tangentSpace * rawNormal;
}`))};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl":function(){define(["exports","../../shaderModules/interfaces","../../shaderModules/Texture2DPassUniform","../../../effects/ssao/SSAO"],function(b,a,c,d){b.EvaluateAmbientOcclusion=function(f,n){f=f.fragment;n.receiveAmbientOcclusion?(f.uniforms.add(new c.Texture2DPassUniform("ssaoTex",(k,g)=>g.ssao?.colorTexture)),f.constants.add("blurSizePixelsInverse",
"float",1/d.blurSizePixels),f.code.add(a.glsl`float evaluateAmbientOcclusionInverse() {
vec2 ssaoTextureSizeInverse = 1.0 / vec2(textureSize(ssaoTex, 0));
return texture(ssaoTex, gl_FragCoord.xy * blurSizePixelsInverse * ssaoTextureSizeInverse).r;
}
float evaluateAmbientOcclusion() {
return 1.0 - evaluateAmbientOcclusionInverse();
}`)):f.code.add(a.glsl`float evaluateAmbientOcclusionInverse() { return 1.0; }
float evaluateAmbientOcclusion() { return 0.0; }`)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/ssao/SSAO":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/maybe ../../../../../core/reactiveUtils ../../../../../core/time ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec2 ../../core/FBOCache ../RenderPlugin ./SSAOBlurTechnique ./SSAONoiseData ./SSAOParameters ./SSAOTechnique ../../lib/RenderFeature ../../lib/RenderSlot ../../../../../chunks/SSAO.glsl ../../../../webgl/enums ../../../../webgl/Texture ../../../../webgl/TextureDescriptor".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A){b.SSAO=class extends w.SyncRenderPlugin{constructor(C){super(C);this._context=null;this._passParameters=new p.SSAOPassParameters;this._drawParameters=new p.BlurDrawParameters;this.produces=new Map([[r.RenderSlot.SSAO,()=>this._produces()]])}_produces(){return null!=this._enableTime&&null!=this._context}consumes(){return this._produces()?w.ConsumesDepthNormal:w.ConsumesNone}initializeRenderContext(C){this._context=C;this.addHandles([d.watch(()=>
this.view.qualitySettings.ambientOcclusion||this._context?.isFeatureEnabled(t.RenderFeature.SSAO),E=>E?this._enable():this._disable(),d.syncAndInitial)])}uninitializeRenderContext(){this._disable();this._context=null}_disable(){this._passParameters.noiseTexture=c.disposeMaybe(this._passParameters.noiseTexture);this._enableTime=null}destroy(){this._disable()}_enable(){if(null==this._enableTime&&this._context){var C=Uint8Array.from(atob(x.noiseData),B=>B.charCodeAt(0)),E=new A.TextureDescriptor;E.wrapMode=
y.TextureWrapMode.CLAMP_TO_EDGE;E.pixelFormat=y.PixelFormat.RGB;E.wrapMode=y.TextureWrapMode.REPEAT;E.hasMipmap=!0;E.width=32;E.height=32;this._passParameters.noiseTexture=new z.Texture(this._context.renderContext.rctx,E,C);null==this._ssaoTechnique&&(this._ssaoTechnique=this._context.techniqueRepository.acquire(h.SSAOTechnique));null==this._blurTechnique&&(this._blurTechnique=this._context.techniqueRepository.acquire(v.SSAOBlurTechnique));this._enableTime=f.Milliseconds(0);this._context?.requestRender()}}renderNode(C,
E,B){E=C.bindParameters;var D=E.linearDepth?.colorTexture,F=B?.normal?.colorTexture;if(null!=this._enableTime&&null!=this._context&&null!=D&&F){if(this._ssaoTechnique.compiled&&this._blurTechnique.compiled){0===this._enableTime&&(this._enableTime=C.time);B=C.rctx;var K=E.camera,L=this.view.qualitySettings.fadeDuration;C=0<L?Math.min(L,C.time-this._enableTime)/L:1;this._passParameters.normalTexture=F;this._passParameters.depthTexture=D;this._passParameters.projScale=1/K.computeScreenPixelSizeAtDist(1);
this._passParameters.intensity=2/u.getRadius(K)**6*C;D=K.fullViewport[2];F=K.fullViewport[3];L=Math.round(D/2);var G=Math.round(F/2),O=this._context.fbos,P=O.acquire(l.ColorFormat.RED,D,F);B.bindFramebuffer(P.fbo);B.setViewport(0,0,D,F);B.bindTechnique(this._ssaoTechnique,this._passParameters,E).bindDraw(this._drawParameters,E,this._passParameters);B.screen.draw();var J=B.bindTechnique(this._blurTechnique,this._passParameters,E);B.setViewport(0,0,L,G);var R=O.acquire(l.ColorFormat.RED,L,G);B.bindFramebuffer(R.fbo);
this._drawParameters.colorTexture=P.colorTexture;m.set(this._drawParameters.blurSize,0,2/F);J.bindDraw(this._drawParameters,E,this._passParameters);B.setViewport(0,0,L,G);B.screen.draw();P.release();O=O.acquire(l.ColorFormat.RED,L,G);B.bindFramebuffer(O.fbo);B.setViewport(0,0,D,F);B.setClearColor(1,1,1,0);B.clear(y.ClearBufferBit.COLOR_BUFFER_BIT);B.setViewport(0,0,L,G);this._drawParameters.colorTexture=R.colorTexture;m.set(this._drawParameters.blurSize,2/D,0);J.bindDraw(this._drawParameters,E,this._passParameters);
B.screen.draw();B.setViewport4fv(K.fullViewport);R.release();1>C&&this._context.requestRender();return O}this._enableTime=C.time;this._context.requestRender()}}};a.__decorate([n.property({constructOnly:!0})],b.SSAO.prototype,"view",void 0);a.__decorate([n.property()],b.SSAO.prototype,"_context",void 0);b.SSAO=a.__decorate([e.subclass("esri.views.3d.webgl-engine.effects.ssao.SSAO")],b.SSAO);b.blurSizePixels=2;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/ssao/SSAOBlurTechnique":function(){define("require exports ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../lib/DefaultVertexAttributeLocations ../../lib/Program ../../../../../chunks/SSAOBlur.glsl ../../../../webgl/renderState".split(" "),
function(b,a,c,d,f,n,k,g){class q extends d.ShaderTechnique{initializeProgram(e){return new n.Program(e.rctx,q.shader.get().build(),f.Default3D)}initializePipeline(){return g.makePipelineState({colorWrite:g.defaultColorWriteParams})}}q.shader=new c.ReloadableShaderModule(k.SSAOBlur,()=>new Promise((e,m)=>b(["../../shaders/SSAOBlur.glsl"],e,m)));a.SSAOBlurTechnique=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/SSAOBlur.glsl":function(){define("exports ./vec3 ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderModules/Float2DrawUniform ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DDrawUniform ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m){function l(){const v=new q.ShaderBuilder,x=v.fragment;v.include(c.ScreenSpacePass);x.include(d.ReadLinearDepth);x.uniforms.add(new m.Texture2DPassUniform("depthMap",p=>p.depthTexture),new e.Texture2DDrawUniform("tex",p=>p.colorTexture),new f.Float2DrawUniform("blurSize",p=>p.blurSize),new k.FloatPassUniform("projScale",(p,h)=>{h=a.distance(h.camera.eye,h.camera.center);return 5E4<h?Math.max(0,p.projScale-(h-5E4)):p.projScale}),new n.Float2PassUniform("nearFar",(p,h)=>
h.camera.nearFar));x.code.add(g.glsl`
    void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
      float c = texture(tex, uv).r;
      float d = linearDepthFromTexture(depthMap, uv, nearFar);

      float ddiff = d - center_d;

      float w = exp(-r * r * ${g.glsl.float(.08)} - ddiff * ddiff * sharpness);
      wTotal += w;
      bTotal += w * c;
    }
  `);v.outputs.add("fragBlur","float");x.code.add(g.glsl`
    void main(void) {
      float b = 0.0;
      float w_total = 0.0;

      float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

      float sharpness = -0.05 * projScale / center_d;
      for (int r = -${g.glsl.int(4)}; r <= ${g.glsl.int(4)}; ++r) {
        float rf = float(r);
        vec2 uvOffset = uv + rf * blurSize;
        blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
      }

      fragBlur = b / w_total;
    }
  `);return v}const w=Object.freeze(Object.defineProperty({__proto__:null,build:l},Symbol.toStringTag,{value:"Module"}));b.SSAOBlur=w;b.build=l})},"esri/views/3d/webgl-engine/core/shaderModules/Float2DrawUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(b,a,c){class d extends a.Uniform{constructor(f,n){super(f,"vec2",c.BindType.Draw,(k,g,q,e)=>k.setUniform2fv(f,n(g,q,e)))}}b.Float2DrawUniform=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/effects/ssao/SSAONoiseData":function(){define(["exports"],function(b){b.noiseData="eXKEvZaUc66cjIKElE1jlJ6MjJ6Ufkl+jn2fcXp5jBx7c6KEflSGiXuXeW6OWs+tfqZ2Yot2Y7Zzfo2BhniEj3xoiXuXj4eGZpqEaHKDWjSMe7palFlzc3BziYOGlFVzg6Zzg7CUY5JrjFF7eYJ4jIKEcyyEonSXe7qUfqZ7j3xofqZ2c4R5lFZ5Y0WUbppoe1l2cIh2ezyUho+BcHN2cG6DbpqJhqp2e1GcezhrdldzjFGUcyxjc3aRjDyEc1h7Sl17c6aMjH92pb6Mjpd4dnqBjMOEhqZleIOBYzB7gYx+fnqGjJuEkWlwnCx7fGl+c4hjfGyRe5qMlNOMfnqGhIWHc6OMi4GDc6aMfqZuc6aMzqJzlKZ+lJ6Me3qRfoFue0WUhoR5UraEa6qMkXiPjMOMlJOGe7JrUqKMjK6MeYRzdod+Sl17boiPc6qEeYBlcIh2c1WEe7GDiWCDa0WMjEmMdod+Y0WcdntzhmN8WjyMjKJjiXtzgYxYaGd+a89zlEV7e2GJfnd+lF1rcK5zc4p5cHuBhL6EcXp5eYB7fnh8iX6HjIKEeaxuiYOGc66RfG2Ja5hzjlGMjEmMe9OEgXuPfHyGhPeEdl6JY02McGuMfnqGhFiMa3WJfnx2l4hwcG1uhmN8c0WMc39og1GBbrCEjE2EZY+JcIh2cIuGhIWHe0mEhIVrc09+gY5+eYBlnCyMhGCDl3drfmmMgX15aGd+gYx+fnuRfnhzY1SMsluJfnd+hm98WtNrcIuGh4SEj0qPdkqOjFF7jNNjdnqBgaqUjMt7boeBhnZ4jDR7c5pze4GGjEFrhLqMjHyMc0mUhKZze4WEa117kWlwbpqJjHZ2eX2Bc09zeId+e0V7WlF7jHJ2l72BfId8l3eBgXyBe897jGl7c66cgW+Xc76EjKNbgaSEjGx4fId8jFFjgZB8cG6DhlFziZhrcIh2fH6HgUqBgXiPY8dahGFzjEmMhEFre2dxhoBzc5SGfleGe6alc7aUeYBlhKqUdlp+cH5za4OEczxza0Gcc4J2jHZ5iXuXjH2Jh5yRjH2JcFx+hImBjH+MpddCl3dreZeJjIt8ZW18bm1zjoSEeIOBlF9oh3N7hlqBY4+UeYFwhLJjeYFwaGd+gUqBYxiEYot2fqZ2ondzhL6EYyiEY02Ea0VjgZB8doaGjHxoc66cjEGEiXuXiXWMiZhreHx8frGMe75rY02Ec5pzfnhzlEp4a3VzjM+EhFFza3mUY7Zza1V5e2iMfGyRcziEhDyEkXZ2Y4OBnCx7g5t2eyBjgV6EhEFrcIh2dod+c4Z+nJ5zjm15jEmUeYxijJp7nL6clIpjhoR5WrZraGd+fnuRa6pzlIiMg6ZzfHx5foh+eX1ufnB5eX1ufnB5aJt7UqKMjIh+e3aBfm5lbYSBhGFze6J4c39oc0mUc4Z+e0V7fKFVe0WEdoaGY02Ec4Z+Y02EZYWBfH6HgU1+gY5+hIWUgW+XjJ57ebWRhFVScHuBfJ6PhBx7WqJzlM+Ujpd4gHZziX6HjHmEgZN+lJt5boiPe2GJgX+GjIGJgHZzeaxufnB5hF2JtdN7jJ57hp57hK6ElFVzg6ZzbmiEbndzhIWHe3uJfoFue3qRhJd2j3xoc65zlE1jc3p8lE1jhniEgXJ7e657vZaUc3qBh52BhIF4aHKDa9drgY5+c52GWqZzbpqJe8tjnM+UhIeMfo2BfGl+hG1zSmmMjKJjZVaGgX15c1lze0mEp4OHa3mUhIWHhDyclJ6MeYOJkXiPc0VzhFiMlKaEboSJa5Jze41re3qRhn+HZYWBe0mEc4p5fnORbox5lEp4hGFjhGGEjJuEc1WEhLZjeHeGa7KlfHx2hLaMeX1ugY5+hIWHhKGPjMN7c1WEho1zhoBzZYx7fnhzlJt5exyUhFFziXtzfmmMa6qMYyiEiXxweV12kZSMeWqXSl17fnhzxmmMrVGEe1mcc4p5eHeGjK6MgY5+doaGa6pzlGV7g1qBh4KHkXiPeW6OaKqafqZ2eXZ5e1V7jGd7boSJc3BzhJd2e0mcYot2h1RoY8dahK6EQmWEWjx7e1l2lL6UgXyBdnR4eU9zc0VreX1umqaBhld7fo2Bc6KEc5Z+hDyEcIeBWtNrfHyGe5qMhMuMe5qMhEGEbVVupcNzg3aHhIF4boeBe0mEdlptc39ofFl5Y8uUlJOGiYt2UmGEcyxjjGx4jFF7a657ZYWBnElzhp57iXtrgZN+tfOEhIOBjE2HgU1+e8tjjKNbiWCDhE15gUqBgYN7fnqGc66ce9d7iYSBj0qPcG6DnGGcT3eGa6qMZY+JlIiMl4hwc3aRdnqBlGV7eHJ2hLZjfnuRhDyEeX6MSk17g6Z+c6aUjHmEhIF4gXyBc76EZW18fGl+fkl+jCxrhoVwhDyUhIqGlL2DlI6EhJd2tdN7eYORhEGMa2Faa6pzc3Bzc4R5lIRznM+UY9eMhDycc5Z+c4p5c4iGY117pb6MgXuPrbJafnx2eYOJeXZ5e657hDyEcziElKZjfoB5eHeGj4WRhGGEe6KGeX1utTStc76EhFGJnCyMa5hzfH6HnNeceYB7hmN8gYuMhIVrczSMgYF8h3N7c5pza5hzjJqEYIRdgYuMlL2DeYRzhGGEeX1uhLaEc4iGeZ1zdl6JhrVteX6Me2iMfm5lWqJzSpqEa6pzdnmchHx2c6OMhNdrhoR5g3aHczxzeW52gV6Ejm15frGMc0Vzc4Z+l3drfniJe+9rWq5rlF1rhGGEhoVwe9OEfoh+e7pac09+c3qBY0lrhDycdnp2lJ6MiYOGhGCDc3aRlL2DlJt5doaGdnp2gYF8gWeOjF2Uc4R5c5Z+jEmMe7KEc4mEeYJ4dmyBe0mcgXiPbqJ7eYB7fmGGiYSJjICGlF1reZ2PnElzbpqJfH6Hc39oe4WEc5eJhK6EhqyJc3qBgZB8c09+hEmEaHKDhFGJc5SGiXWMUpaEa89zc6OMnCyMiXtrho+Be5qMc7KEjJ57dmN+hKGPjICGbmiEe7prdod+hGCDdnmchBx7eX6MkXZ2hGGEa657hm98jFFjY5JreYOJgY2EjHZ2a295Y3FajJ6Mc1J+YzB7e4WBjF2Uc4R5eV12gYxzg1qBeId+c9OUc5pzjFFjgY5+hFiMlIaPhoR5lIpjjIKBlNdSe7KEeX2BfrGMhIqGc65zjE2UhK6EklZ+QmWEeziMWqZza3VzdnR4foh+gYF8n3iJiZhrnKp7gYF8eId+lJ6Me1lrcIuGjKJjhmN8c66MjFF7a6prjJ6UnJ5zezyUfruRWlF7nI5zfHyGe657h4SEe8tjhBx7jFFjc09+c39ojICMeZeJeXt+YzRzjHZ2c0WEcIeBeXZ5onSXkVR+gYJ+eYFwdldzgYF7eX2BjJ6UiXuXlE1jh4SEe1mchLJjc4Z+hqZ7eXZ5bm1zlL6Ue5p7iWeGhKqUY5pzjKJjcIeBe8t7gXyBYIRdlEp4a3mGnK6EfmmMZpqEfFl5gYxzjKZuhGFjhoKGhHx2fnx2eXuMe3aBiWeGvbKMe6KGa5hzYzB7gZOBlGV7hmN8hqZlYot2Y117a6pzc6KEfId8foB5rctrfneJfJ6PcHN2hFiMc5pzjH92c0VzgY2EcElzdmCBlFVzg1GBc65zY4OBboeBcHiBeYJ4ewxzfHx5lIRzlEmEnLKEbk1zfJ6PhmN8eYBljBiEnMOEiXxwezyUcIeBe76EdsKEeX2BdnR4jGWUrXWMjGd7fkl+j4WRlEGMa5Jzho+BhDyEfnqMeXt+g3aHlE1jczClhNN7ZW18eHx8hGFjZW18iXWMjKJjhH57gYuMcIuGWjyMe4ZtjJuExmmMj4WRdntzi4GDhFFzYIRdnGGcjJp7Y0F7e4WEkbCGiX57fnSHa657a6prhBCMe3Z+SmmMjH92eHJ2hK6EY1FzexhrvbKMnI5za4OEfnd+eXuMhImBe897hLaMjN+EfG+BeIOBhF1+eZeJi4GDkXZ2eXKEgZ6Ejpd4c2GHa1V5e5KUfqZuhCx7jKp7lLZrg11+hHx2hFWUoot2nI5zgbh5mo9zvZaUe3qRbqKMfqZ2kbCGhFiM";
Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/ssao/SSAOParameters":function(){define(["exports","../../../../../chunks/vec2f64","../../core/shaderModules/interfaces"],function(b,a,c){class d extends c.NoParameters{constructor(){super(...arguments);this.projScale=1}}class f extends d{constructor(){super(...arguments);this.intensity=1}}class n extends c.NoParameters{}class k extends n{constructor(){super(...arguments);this.blurSize=a.create()}}b.BlurDrawParameters=
k;b.BlurPassParameters=d;b.SSAODrawParameters=n;b.SSAOPassParameters=f;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/ssao/SSAOTechnique":function(){define("require exports ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../lib/DefaultVertexAttributeLocations ../../lib/Program ../../../../../chunks/SSAO.glsl ../../../../webgl/renderState".split(" "),function(b,a,c,d,f,n,k,g){class q extends d.ShaderTechnique{initializeProgram(e){return new n.Program(e.rctx,
q.shader.get().build(),f.Default3D)}initializePipeline(){return g.makePipelineState({colorWrite:g.defaultColorWriteParams})}}q.shader=new c.ReloadableShaderModule(k.SSAO,()=>new Promise((e,m)=>b(["../../shaders/SSAO.glsl"],e,m)));a.SSAOTechnique=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/SSAO.glsl":function(){define("exports ./vec2 ./vec2f64 ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m){function l(){const x=new e.ShaderBuilder,p=x.fragment;x.include(d.ScreenSpacePass);p.include(f.ReadLinearDepth);x.include(n.CameraSpace);p.uniforms.add(new g.FloatPassUniform("radius",(h,t)=>w(t.camera)));p.code.add(q.glsl`vec3 sphere[16];
void fillSphere() {
sphere[0] = vec3(0.186937, 0.0, 0.0);
sphere[1] = vec3(0.700542, 0.0, 0.0);
sphere[2] = vec3(-0.864858, -0.481795, -0.111713);
sphere[3] = vec3(-0.624773, 0.102853, -0.730153);
sphere[4] = vec3(-0.387172, 0.260319, 0.007229);
sphere[5] = vec3(-0.222367, -0.642631, -0.707697);
sphere[6] = vec3(-0.01336, -0.014956, 0.169662);
sphere[7] = vec3(0.122575, 0.1544, -0.456944);
sphere[8] = vec3(-0.177141, 0.85997, -0.42346);
sphere[9] = vec3(-0.131631, 0.814545, 0.524355);
sphere[10] = vec3(-0.779469, 0.007991, 0.624833);
sphere[11] = vec3(0.308092, 0.209288,0.35969);
sphere[12] = vec3(0.359331, -0.184533, -0.377458);
sphere[13] = vec3(0.192633, -0.482999, -0.065284);
sphere[14] = vec3(0.233538, 0.293706, -0.055139);
sphere[15] = vec3(0.417709, -0.386701, 0.442449);
}
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn - bias, 0.0);
}`);p.code.add(q.glsl`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`);p.uniforms.add(new k.Float2PassUniform("nearFar",(h,t)=>t.camera.nearFar),new m.Texture2DPassUniform("normalMap",h=>h.normalTexture),new m.Texture2DPassUniform("depthMap",h=>h.depthTexture),new g.FloatPassUniform("projScale",h=>h.projScale),new m.Texture2DPassUniform("rnm",h=>h.noiseTexture),new k.Float2PassUniform("rnmScale",(h,t)=>a.set(v,t.camera.fullWidth/h.noiseTexture.descriptor.width,t.camera.fullHeight/h.noiseTexture.descriptor.height)),new g.FloatPassUniform("intensity",h=>h.intensity),
new k.Float2PassUniform("screenSize",(h,t)=>a.set(v,t.camera.fullWidth,t.camera.fullHeight)));x.outputs.add("fragOcclusion","float");p.code.add(q.glsl`
    void main(void) {
      fillSphere();
      vec3 fres = normalize(2.0 * texture(rnm, uv * rnmScale).xyz - 1.0);
      float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

      if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
        fragOcclusion = 0.0;
        return;
      }

      vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy, currentPixelDepth);

      // get the normal of current fragment
      vec4 norm4 = texture(normalMap, uv);
      vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;
      bool isTerrain = norm4.w < 0.5;

      float sum = 0.0;
      vec3 tapPixelPos;

      // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
      // bug or deviation from CE somewhere else?
      float ps = projScale / (2.0 * currentPixelPos.z * zScale.x + zScale.y);

      for(int i = 0; i < ${q.glsl.int(16)}; ++i) {
        vec2 unitOffset = reflect(sphere[i], fres).xy;
        vec2 offset = vec2(-unitOffset * radius * ps);

        //don't use current or very nearby samples
        if( abs(offset.x) < 2.0 || abs(offset.y) < 2.0){
          continue;
        }

        vec2 tc = vec2(gl_FragCoord.xy + offset);
        if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
        vec2 tcTap = tc / screenSize;
        float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

        if (isTerrain) {
          if (texture(normalMap, tcTap).w < 0.5) {
            continue;
          }
        }

        tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

        sum += aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
      }

      // output the result
      float A = max(1.0 - sum * intensity / float(${q.glsl.int(16)}), 0.0);

      // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4) / 2.2
      A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;

      fragOcclusion = A;
    }
  `);return x}function w(x){return Math.max(10,20*x.computeScreenPixelSizeAtDist(Math.abs(4*x.relativeElevation)))}const v=c.create();c=Object.freeze(Object.defineProperty({__proto__:null,build:l,getRadius:w},Symbol.toStringTag,{value:"Module"}));b.SSAO=c;b.build=l;b.getRadius=w})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl":function(){define("exports ../../../../../../chunks/vec2 ../../../../../../chunks/vec2f64 ../../../../../../chunks/vec4 ../../../../../../chunks/vec4f64 ../../shaderModules/Float2PassUniform ../../shaderModules/Float4PassUniform ../../shaderModules/interfaces".split(" "),
function(b,a,c,d,f,n,k,g){function q(w){const v=w.camera.projectionMatrix;return 0===v[11]?d.set(m,2/(w.camera.fullWidth*v[0]),2/(w.camera.fullHeight*v[5]),(1+v[12])/v[0],(1+v[13])/v[5]):d.set(m,-2/(w.camera.fullWidth*v[0]),-2/(w.camera.fullHeight*v[5]),(1-v[8])/v[0],(1-v[9])/v[5])}function e(w){return 0===w.camera.projectionMatrix[11]?a.set(l,0,1):a.set(l,1,0)}const m=f.create(),l=c.create();b.CameraSpace=function(w){w.fragment.uniforms.add(new k.Float4PassUniform("projInfo",(v,x)=>q(x)));w.fragment.uniforms.add(new n.Float2PassUniform("zScale",
(v,x)=>e(x)));w.fragment.code.add(g.glsl`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)};b.getProjectionInfo=q;b.getZScale=e;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl":function(){define("exports ../../../../../../core/compilerUtils ./EvaluateAmbientLighting.glsl ./EvaluateAmbientOcclusion.glsl ./MainLighting.glsl ./PhysicallyBasedRendering.glsl ./PhysicallyBasedRenderingParameters.glsl ./PiUtils.glsl ../../shaderModules/BooleanPassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../../lighting/SceneLighting".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l){function w(x){x.constants.add("ambientBoostFactor","float",l.ambientBoost)}function v(x){x.uniforms.add(new e.FloatPassUniform("lightingGlobalFactor",(p,h)=>h.lighting.globalFactor))}b.EvaluateSceneLighting=function(x,p){const h=x.fragment;x.include(d.EvaluateAmbientOcclusion,p);p.pbrMode!==k.PBRMode.Disabled&&x.include(n.PhysicallyBasedRendering,p);x.include(c.EvaluateAmbientLighting,p);x.include(g.PiUtils);h.code.add(m.glsl`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${p.pbrMode===k.PBRMode.Disabled?"":"const vec3 GROUND_REFLECTANCE \x3d vec3(0.2);"}
  `);w(h);v(h);f.addMainLightDirection(h);h.code.add(m.glsl`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${p.spherical?m.glsl`normalize(vPosWorld)`:m.glsl`vec3(0.0, 0.0, 1.0)`}, mainLightDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `);f.addMainLightIntensity(h);h.code.add(m.glsl`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * mainLightIntensity;
}`);switch(p.pbrMode){case k.PBRMode.Disabled:case k.PBRMode.WaterOnIntegratedMesh:case k.PBRMode.Water:x.include(f.MainLighting);h.code.add(m.glsl`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);break;case k.PBRMode.Normal:case k.PBRMode.Schematic:h.code.add(m.glsl`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`);h.code.add(m.glsl`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`);p.useFillLights?h.uniforms.add(new q.BooleanPassUniform("hasFillLights",(t,r)=>r.enableFillLights)):h.constants.add("hasFillLights","bool",!1);h.code.add(m.glsl`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0) ? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * mainLightIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * mainLightIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`);h.uniforms.add(new e.FloatPassUniform("lightingSpecularStrength",(t,r)=>r.lighting.mainLight.specularStrength),new e.FloatPassUniform("lightingEnvironmentStrength",(t,r)=>r.lighting.mainLight.environmentStrength));h.code.add(m.glsl`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * mainLightIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * mainLightIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
float normalDirectionModifier = mix(1., min(mix(0.1, 2.0, (inputs.NdotNG + 1.) * 0.5), 1.0), clamp(inputs.roughness * 5.0, 0.0 , 1.0));
inputs.skyRadianceToSurface = (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.groundRadianceToSurface = 0.5 * GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`);h.code.add(m.glsl`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = _emission == vec3(0.0) ? _emission : pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${p.pbrMode!==k.PBRMode.Schematic||p.hasColorTexture?m.glsl`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`:m.glsl`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `);break;case k.PBRMode.Terrain:case k.PBRMode.TerrainWithWater:x.include(f.MainLighting);h.code.add(m.glsl`const float roughnessTerrain = 0.5;
const float specularityTerrain = 0.5;
const vec3 fresnelReflectionTerrain = vec3(0.04);
vec3 evaluateTerrainLighting(vec3 n, vec3 c, float shadow, float ssao, vec3 al, vec3 vd, vec3 nup) {
vec3 viewDirection = -vd;
vec3 h = normalize(viewDirection + mainLightDirection);
float NdotL = clamp(dot(n, mainLightDirection), 0.001, 1.0);
float NdotV = clamp(abs(dot(n, viewDirection)), 0.001, 1.0);
float NdotH = clamp(dot(n, h), 0.0, 1.0);
float NdotNG = clamp(dot(n, nup), -1.0, 1.0);
vec3 albedoLinear = pow(c, vec3(GAMMA_SRGB));
float lightness = 0.3 * albedoLinear[0] + 0.5 * albedoLinear[1] + 0.2 * albedoLinear[2];
vec3 f0 = (0.85 * lightness + 0.15) * fresnelReflectionTerrain;
vec3 f90 =  vec3(clamp(dot(f0, vec3(50.0 * 0.33)), 0.0, 1.0));
vec3 mainLightIrradianceComponent = (1. - shadow) * NdotL * mainLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(n, ssao) + al;
vec3 ambientSky = ambientLightIrradianceComponent + mainLightIrradianceComponent;
vec3 indirectDiffuse = ((1.0 - NdotNG) * mainLightIrradianceComponent + (1.0 + NdotNG ) * ambientSky) * 0.5;
vec3 outDiffColor = albedoLinear * (1.0 - f0) * indirectDiffuse / PI;
vec3 mainLightRadianceComponent = normalDistribution(NdotH, roughnessTerrain) * mainLightIntensity;
vec2 dfg = prefilteredDFGAnalytical(roughnessTerrain, NdotV);
vec3 specularColor = f0 * dfg.x + f90 * dfg.y;
vec3 specularComponent = specularityTerrain * specularColor * mainLightRadianceComponent;
vec3 outColorLinear = outDiffColor + specularComponent;
vec3 outColor = pow(outColorLinear, vec3(INV_GAMMA_SRGB));
return outColor;
}`);break;default:a.neverReached(p.pbrMode);case k.PBRMode.COUNT:}};b.addAmbientBoostFactor=w;b.addLightingGlobalFactor=v;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl":function(){define(["exports","./AnalyticalSkyModel.glsl","./PhysicallyBasedRenderingParameters.glsl","./PiUtils.glsl","../../shaderModules/interfaces"],function(b,a,c,d,f){b.PhysicallyBasedRendering=function(n,k){const g=n.fragment.code;
n.include(d.PiUtils);if(k.pbrMode===c.PBRMode.Normal||k.pbrMode===c.PBRMode.Schematic||k.pbrMode===c.PBRMode.Terrain||k.pbrMode===c.PBRMode.TerrainWithWater)g.add(f.glsl`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),g.add(f.glsl`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`);if(k.pbrMode===c.PBRMode.Normal||k.pbrMode===c.PBRMode.Schematic)n.include(a.AnalyticalSkyModel),g.add(f.glsl`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),g.add(f.glsl`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),g.add(f.glsl`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),g.add(f.glsl`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`)};b.PhysicallyBasedRenderingWater=function(n,k){const g=n.fragment.code;n.include(d.PiUtils);g.add(f.glsl`
  struct PBRShadingWater
  {
      float NdotL;   // cos angle between normal and light direction
      float NdotV;   // cos angle between normal and view direction
      float NdotH;   // cos angle between normal and half vector
      float VdotH;   // cos angle between view direction and half vector
      float LdotH;   // cos angle between light direction and half vector
      float VdotN;   // cos angle between view direction and normal vector
  };

  float dtrExponent = ${k.useCustomDTRExponentForWater?"2.2":"2.0"};
  `);g.add(f.glsl`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`);g.add(f.glsl`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`);g.add(f.glsl`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`);g.add(f.glsl`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/AnalyticalSkyModel.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(b,a){b.AnalyticalSkyModel=function(c){c=c.fragment.code;c.add(a.glsl`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`);c.add(a.glsl`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`);c.add(a.glsl`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl":function(){define("exports ../../../../../../chunks/mat4f64 ../../../../../../chunks/vec3f64 ../util/RgbaFloat16Encoding.glsl ../../shaderModules/Float4PassUniform ../../shaderModules/IntegerPassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix4sDrawUniform ../../shaderModules/Matrix4sPassUniform ../../shaderModules/Texture2DPassUniform".split(" "),
function(b,a,c,d,f,n,k,g,q,e){function m(p){p=p.fragment;p.include(d.Rgba4FloatEncoding);p.uniforms.add(new e.Texture2DPassUniform("shadowMapTex",(h,t)=>t.shadowMap.depthTexture),new n.IntegerPassUniform("numCascades",(h,t)=>t.shadowMap.numCascades),new f.Float4PassUniform("cascadeDistances",(h,t)=>t.shadowMap.cascadeDistances));p.code.add(k.glsl`int chooseCascade(float depth, out mat4 mat) {
vec4 distance = cascadeDistances;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, ivec2 textureSize, vec3 lvpos) {
float xScale = float(textureSize.y) / float(textureSize.x);
return vec2((float(i) + lvpos.x) * xScale, lvpos.y);
}
float readShadowMapDepth(ivec2 uv, sampler2D _depthTex) {
return rgba4ToFloat(texelFetch(_depthTex, uv, 0));
}
float posIsInShadow(ivec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, ivec2 texSize, sampler2D _depthTex) {
vec2 st = fract(uv * vec2(texSize) + vec2(0.5));
ivec2 base = ivec2(uv * vec2(texSize) - vec2(0.5));
float s00 = posIsInShadow(ivec2(base.x, base.y), lvpos, _depthTex);
float s10 = posIsInShadow(ivec2(base.x + 1, base.y), lvpos, _depthTex);
float s11 = posIsInShadow(ivec2(base.x + 1, base.y + 1), lvpos, _depthTex);
float s01 = posIsInShadow(ivec2(base.x, base.y + 1), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= numCascades) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0) { return 0.0; }
if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
ivec2 size = textureSize(shadowMapTex, 0);
vec2 uv = cascadeCoordinates(i, size, lvpos);
return filterShadow(uv, lvpos, size, shadowMapTex);
}`)}class l extends k.NoParameters{constructor(){super(...arguments);this.origin=c.create()}}class w extends l{}class v extends k.NoParameters{constructor(){super(...arguments);this.modelTransformation=a.IDENTITY}}class x extends v{constructor(){super(...arguments);this.origin=c.create()}}b.ReadShadowMapDraw=function(p,h){h.receiveShadows&&(p.fragment.uniforms.add(new g.Matrix4sDrawUniform("shadowMapMatrix",(t,r)=>r.shadowMap.getShadowMapMatrices(t.origin),4)),m(p))};b.ReadShadowMapDrawParameters=
w;b.ReadShadowMapParameters=v;b.ReadShadowMapPass=function(p,h){h.receiveShadows&&(p.fragment.uniforms.add(new q.Matrix4sPassUniform("shadowMapMatrix",(t,r)=>r.shadowMap.getShadowMapMatrices(t.origin),4)),m(p))};b.ReadShadowMapPassParameters=x;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix4sDrawUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(b,a,c){class d extends a.Uniform{constructor(f,
n,k){super(f,"mat4",c.BindType.Draw,(g,q,e,m)=>g.setUniformMatrix4fv(f,n(q,e,m)),k)}}b.Matrix4sDrawUniform=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix4sPassUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(b,a,c){class d extends a.Uniform{constructor(f,n,k){super(f,"mat4",c.BindType.Pass,(g,q,e)=>g.setUniformMatrix4fv(f,n(q,e)),k)}}b.Matrix4sPassUniform=d;Object.defineProperty(b,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/TextureTransformUV.glsl":function(){define(["exports","../../../../../../chunks/mat3f32","../../shaderModules/interfaces","../../shaderModules/Matrix3PassUniform"],function(b,a,c,d){b.colorTextureUV=function(f){f.vertex.uniforms.add(new d.Matrix3PassUniform("colorTextureTransformMatrix",n=>null!=n.colorTextureTransformMatrix?n.colorTextureTransformMatrix:a.create()));f.varyings.add("colorUV","vec2");f.vertex.code.add(c.glsl`void forwardColorUV(){
colorUV = (colorTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)};b.emissiveTextureUV=function(f){f.vertex.uniforms.add(new d.Matrix3PassUniform("emissiveTextureTransformMatrix",n=>null!=n.emissiveTextureTransformMatrix?n.emissiveTextureTransformMatrix:a.create()));f.varyings.add("emissiveUV","vec2");f.vertex.code.add(c.glsl`void forwardEmissiveUV(){
emissiveUV = (emissiveTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)};b.metallicRoughnessTextureUV=function(f){f.vertex.uniforms.add(new d.Matrix3PassUniform("metallicRoughnessTextureTransformMatrix",n=>null!=n.metallicRoughnessTextureTransformMatrix?n.metallicRoughnessTextureTransformMatrix:a.create()));f.varyings.add("metallicRoughnessUV","vec2");f.vertex.code.add(c.glsl`void forwardMetallicRoughnessUV(){
metallicRoughnessUV = (metallicRoughnessTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)};b.normalTextureUV=function(f){f.vertex.uniforms.add(new d.Matrix3PassUniform("normalTextureTransformMatrix",n=>null!=n.normalTextureTransformMatrix?n.normalTextureTransformMatrix:a.create()));f.varyings.add("normalUV","vec2");f.vertex.code.add(c.glsl`void forwardNormalUV(){
normalUV = (normalTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)};b.occlusionTextureUV=function(f){f.vertex.uniforms.add(new d.Matrix3PassUniform("occlusionTextureTransformMatrix",n=>null!=n.occlusionTextureTransformMatrix?n.occlusionTextureTransformMatrix:a.create()));f.varyings.add("occlusionUV","vec2");f.vertex.code.add(c.glsl`void forwardOcclusionUV(){
occlusionUV = (occlusionTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/mat3f32":function(){define(["exports"],function(b){function a(){const k=new Float32Array(9);k[0]=1;k[4]=1;k[8]=1;return k}function c(k){const g=new Float32Array(9);g[0]=k[0];g[1]=k[1];g[2]=k[2];g[3]=k[3];g[4]=k[4];g[5]=k[5];g[6]=k[6];g[7]=k[7];g[8]=k[8];return g}function d(k,g,q,e,m,l,w,v,x){const p=new Float32Array(9);p[0]=k;p[1]=g;p[2]=q;p[3]=e;p[4]=m;p[5]=l;p[6]=w;p[7]=v;p[8]=x;return p}function f(k,g){return new Float32Array(k,
g,9)}const n=Object.freeze(Object.defineProperty({__proto__:null,clone:c,create:a,createView:f,fromValues:d},Symbol.toStringTag,{value:"Module"}));b.clone=c;b.create=a;b.createView=f;b.fromValues=d;b.mat3f32=n})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl":function(){define(["exports","../../../../layers/support/symbolColorUtils","./ColorConversion.glsl","../../shaderModules/interfaces"],function(b,a,c,d){b.MixExternalColor=function(f){f.include(c.ColorConversion);f.code.add(d.glsl`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${d.glsl.int(a.ColorMixModeEnum.Multiply)}) {
        return allMixed;
      }
      if (mode == ${d.glsl.int(a.ColorMixModeEnum.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${d.glsl.int(a.ColorMixModeEnum.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${d.glsl.int(a.ColorMixModeEnum.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${d.glsl.int(a.ColorMixModeEnum.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/DefaultMaterialTechniqueConfiguration":function(){define("exports ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../lib/TransparencyPassType ../materials/DefaultTechniqueConfiguration".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m){class l extends m.DefaultTechniqueConfiguration{constructor(){super(...arguments);this.output=c.ShaderOutput.Color;this.alphaDiscardMode=q.AlphaDiscardMode.Opaque;this.doubleSidedMode=n.NormalsDoubleSidedMode.None;this.pbrMode=k.PBRMode.Disabled;this.cullFace=q.CullFaceOptions.None;this.transparencyPassType=e.TransparencyPassType.NONE;this.normalType=d.NormalType.Attribute;this.textureCoordinateType=f.TextureCoordinateAttributeType.None;this.customDepthTest=q.DepthTestFunction.Less;
this.hasSlicePlane=this.hasVerticalOffset=this.hasSymbolColors=this.hasVertexColors=this.spherical=!1;this.hasSliceHighlight=!0;this.doublePrecisionRequiresObfuscation=this.instancedDoublePrecision=this.objectAndLayerIdColorInstanced=this.instancedColor=this.instanced=this.textureAlphaPremultiplied=this.receiveAmbientOcclusion=this.receiveShadows=this.vvColor=this.vvSize=this.offsetBackfaces=this.hasModelTransformation=this.multipassEnabled=this.hasOccludees=this.hasVertexTangents=this.hasScreenSizePerspective=
this.hasNormalTexture=this.hasOcclusionTexture=this.hasEmissionTexture=this.hasMetallicRoughnessTexture=this.hasColorTexture=!1;this.writeDepth=!0;this.transparent=!1;this.enableOffset=!0;this.hasMetallicRoughnessTextureTransform=this.hasOcclusionTextureTransform=this.hasNormalTextureTransform=this.hasEmissionTextureTransform=this.hasColorTextureTransform=this.snowCover=this.cullAboveGround=!1}}a.__decorate([g.parameter({count:c.ShaderOutput.COUNT})],l.prototype,"output",void 0);a.__decorate([g.parameter({count:q.AlphaDiscardMode.COUNT})],
l.prototype,"alphaDiscardMode",void 0);a.__decorate([g.parameter({count:n.NormalsDoubleSidedMode.COUNT})],l.prototype,"doubleSidedMode",void 0);a.__decorate([g.parameter({count:k.PBRMode.COUNT})],l.prototype,"pbrMode",void 0);a.__decorate([g.parameter({count:q.CullFaceOptions.COUNT})],l.prototype,"cullFace",void 0);a.__decorate([g.parameter({count:e.TransparencyPassType.COUNT})],l.prototype,"transparencyPassType",void 0);a.__decorate([g.parameter({count:d.NormalType.COUNT})],l.prototype,"normalType",
void 0);a.__decorate([g.parameter({count:f.TextureCoordinateAttributeType.COUNT})],l.prototype,"textureCoordinateType",void 0);a.__decorate([g.parameter({count:q.DepthTestFunction.COUNT})],l.prototype,"customDepthTest",void 0);a.__decorate([g.parameter()],l.prototype,"spherical",void 0);a.__decorate([g.parameter()],l.prototype,"hasVertexColors",void 0);a.__decorate([g.parameter()],l.prototype,"hasSymbolColors",void 0);a.__decorate([g.parameter()],l.prototype,"hasVerticalOffset",void 0);a.__decorate([g.parameter()],
l.prototype,"hasSlicePlane",void 0);a.__decorate([g.parameter()],l.prototype,"hasSliceHighlight",void 0);a.__decorate([g.parameter()],l.prototype,"hasColorTexture",void 0);a.__decorate([g.parameter()],l.prototype,"hasMetallicRoughnessTexture",void 0);a.__decorate([g.parameter()],l.prototype,"hasEmissionTexture",void 0);a.__decorate([g.parameter()],l.prototype,"hasOcclusionTexture",void 0);a.__decorate([g.parameter()],l.prototype,"hasNormalTexture",void 0);a.__decorate([g.parameter()],l.prototype,
"hasScreenSizePerspective",void 0);a.__decorate([g.parameter()],l.prototype,"hasVertexTangents",void 0);a.__decorate([g.parameter()],l.prototype,"hasOccludees",void 0);a.__decorate([g.parameter()],l.prototype,"multipassEnabled",void 0);a.__decorate([g.parameter()],l.prototype,"hasModelTransformation",void 0);a.__decorate([g.parameter()],l.prototype,"offsetBackfaces",void 0);a.__decorate([g.parameter()],l.prototype,"vvSize",void 0);a.__decorate([g.parameter()],l.prototype,"vvColor",void 0);a.__decorate([g.parameter()],
l.prototype,"receiveShadows",void 0);a.__decorate([g.parameter()],l.prototype,"receiveAmbientOcclusion",void 0);a.__decorate([g.parameter()],l.prototype,"textureAlphaPremultiplied",void 0);a.__decorate([g.parameter()],l.prototype,"instanced",void 0);a.__decorate([g.parameter()],l.prototype,"instancedColor",void 0);a.__decorate([g.parameter()],l.prototype,"objectAndLayerIdColorInstanced",void 0);a.__decorate([g.parameter()],l.prototype,"instancedDoublePrecision",void 0);a.__decorate([g.parameter()],
l.prototype,"doublePrecisionRequiresObfuscation",void 0);a.__decorate([g.parameter()],l.prototype,"writeDepth",void 0);a.__decorate([g.parameter()],l.prototype,"transparent",void 0);a.__decorate([g.parameter()],l.prototype,"enableOffset",void 0);a.__decorate([g.parameter()],l.prototype,"cullAboveGround",void 0);a.__decorate([g.parameter()],l.prototype,"snowCover",void 0);a.__decorate([g.parameter()],l.prototype,"hasColorTextureTransform",void 0);a.__decorate([g.parameter()],l.prototype,"hasEmissionTextureTransform",
void 0);a.__decorate([g.parameter()],l.prototype,"hasNormalTextureTransform",void 0);a.__decorate([g.parameter()],l.prototype,"hasOcclusionTextureTransform",void 0);a.__decorate([g.parameter()],l.prototype,"hasMetallicRoughnessTextureTransform",void 0);a.__decorate([g.parameter({constValue:!1})],l.prototype,"occlusionPass",void 0);a.__decorate([g.parameter({constValue:!0})],l.prototype,"hasVvInstancing",void 0);a.__decorate([g.parameter({constValue:!1})],l.prototype,"useCustomDTRExponentForWater",
void 0);a.__decorate([g.parameter({constValue:!1})],l.prototype,"supportsTextureAtlas",void 0);a.__decorate([g.parameter({constValue:!0})],l.prototype,"useFillLights",void 0);b.DefaultMaterialTechniqueConfiguration=l;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/RealisticTreeTechnique":function(){define("require exports ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderTechnique/ReloadableShaderModule ./DefaultMaterialTechnique ../../../../chunks/RealisticTree.glsl".split(" "),
function(b,a,c,d,f,n,k){class g extends n.DefaultMaterialTechnique{initializeConfiguration(q,e){super.initializeConfiguration(q,e);e.hasMetallicRoughnessTexture=!1;e.hasEmissionTexture=!1;e.hasOcclusionTexture=!1;e.hasNormalTexture=!1;e.hasModelTransformation=!1;e.normalType=c.NormalType.Attribute;e.doubleSidedMode=d.NormalsDoubleSidedMode.WindingOrder;e.hasVertexTangents=!1}initializeProgram(q){return this._initializeProgram(q,g.shader)}}g.shader=new f.ReloadableShaderModule(k.RealisticTree,()=>
new Promise((q,e)=>b(["./RealisticTree.glsl"],q,e)));a.RealisticTreeTechnique=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/RealisticTree.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/Offset.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl ../views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A,C,E,B,D,F,K,L,G,O,P,J){function R(U){const M=new G.ShaderBuilder,{vertex:V,fragment:Y,varyings:W}=M;B.addProjViewLocalOrigin(V,U);M.include(q.PositionAttribute);W.add("vpos","vec3");M.include(z.VisualVariables,U);M.include(k.InstancedDoublePrecision,U);M.include(w.VerticalOffset,U);if(U.output===d.ShaderOutput.Color||U.output===d.ShaderOutput.Alpha)B.addCameraPosition(M.vertex,U),M.include(g.NormalAttribute,U),M.include(n.Transform,U),U.offsetBackfaces&&
M.include(c.Offset),U.instancedColor&&M.attributes.add(J.VertexAttribute.INSTANCECOLOR,"vec4"),W.add("vNormalWorld","vec3"),W.add("localvpos","vec3"),U.multipassEnabled&&W.add("depth","float"),M.include(m.TextureCoordinateAttribute,U),M.include(a.ForwardLinearDepth,U),M.include(e.SymbolColor,U),M.include(l.VertexColor,U),V.uniforms.add(new F.Float4PassUniform("externalColor",H=>H.externalColor)),W.add("vcolorExt","vec4"),V.code.add(L.glsl`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${U.instancedColor?"vcolorExt *\x3d instanceColor * 0.003921568627451;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${L.glsl.float(A.symbolAlphaCutoff)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          } else {
            vpos = getVertexInLocalOriginSpace();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${U.offsetBackfaces?"gl_Position \x3d offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${U.multipassEnabled?L.glsl`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `);U.output===d.ShaderOutput.Alpha&&(M.include(f.SliceDraw,U),M.include(C.DiscardOrAdjustAlphaPass,U),M.include(t.multipassTerrainTest,U),Y.uniforms.add(new K.FloatPassUniform("opacity",H=>H.opacity),new K.FloatPassUniform("layerOpacity",H=>H.layerOpacity)),U.hasColorTexture&&Y.uniforms.add(new O.Texture2DPassUniform("tex",H=>H.texture)),Y.include(E.MixExternalColor),Y.code.add(L.glsl`
      void main() {
        discardBySlice(vpos);
        ${U.multipassEnabled?L.glsl`terrainDepthTest(depth);`:""}
        ${U.hasColorTexture?L.glsl`
                vec4 texColor = texture(tex, ${U.hasColorTextureTransform?L.glsl`colorUV`:L.glsl`vuv0`});
                ${U.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:L.glsl`vec4 texColor = vec4(1.0);`}
        ${U.hasVertexColors?L.glsl`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:L.glsl`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}

        fragColor = vec4(opacity_);
      }
    `));U.output===d.ShaderOutput.Color&&(M.include(f.SliceDraw,U),M.include(p.EvaluateSceneLighting,U),M.include(x.EvaluateAmbientOcclusion,U),M.include(C.DiscardOrAdjustAlphaPass,U),M.include(U.instancedDoublePrecision?y.ReadShadowMapPass:y.ReadShadowMapDraw,U),M.include(t.multipassTerrainTest,U),B.addCameraPosition(M.fragment,U),h.addMainLightDirection(Y),p.addAmbientBoostFactor(Y),p.addLightingGlobalFactor(Y),Y.uniforms.add(V.uniforms.get("localOrigin"),V.uniforms.get("view"),new D.Float3PassUniform("ambient",
H=>H.ambient),new D.Float3PassUniform("diffuse",H=>H.diffuse),new K.FloatPassUniform("opacity",H=>H.opacity),new K.FloatPassUniform("layerOpacity",H=>H.layerOpacity)),U.hasColorTexture&&Y.uniforms.add(new O.Texture2DPassUniform("tex",H=>H.texture)),M.include(u.PhysicallyBasedRenderingParameters,U),M.include(r.PhysicallyBasedRendering,U),Y.include(E.MixExternalColor),h.addMainLightIntensity(Y),Y.code.add(L.glsl`
      void main() {
        discardBySlice(vpos);
        ${U.multipassEnabled?L.glsl`terrainDepthTest(depth);`:""}
        ${U.hasColorTexture?L.glsl`
                vec4 texColor = texture(tex, ${U.hasColorTextureTransform?L.glsl`colorUV`:L.glsl`vuv0`});
                ${U.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:L.glsl`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${U.pbrMode===u.PBRMode.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${U.receiveShadows?"float shadow \x3d readShadowMap(vpos, linearDepth);":U.spherical?"float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow \x3d 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${U.hasVertexColors?L.glsl`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:L.glsl`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${U.snowCover?L.glsl`albedo = mix(albedo, vec3(1), 0.9);`:L.glsl``}
        ${L.glsl`
            vec3 shadingNormal = normalize(vNormalWorld);
            albedo *= 1.2;
            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
            float alignmentLightView = clamp(dot(viewForward, -mainLightDirection), 0.0, 1.0);
            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
            float treeRadialFalloff = vColor.r;
            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
            additionalLight += backLightFactor * mainLightIntensity;`}
        ${U.pbrMode===u.PBRMode.Normal||U.pbrMode===u.PBRMode.Schematic?U.spherical?L.glsl`vec3 normalGround = normalize(vpos + localOrigin);`:L.glsl`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:L.glsl``}
        ${U.pbrMode===u.PBRMode.Normal||U.pbrMode===u.PBRMode.Schematic?L.glsl`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${U.snowCover?L.glsl`
                        mrr = vec3(0.0, 1.0, 0.04);
                        emission = vec3(0.0);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:L.glsl`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${U.transparencyPassType===P.TransparencyPassType.Color?L.glsl`fragColor = premultiplyAlpha(fragColor);`:L.glsl``}
      }
    `));M.include(v.DefaultMaterialAuxiliaryPasses,U);return M}const X=Object.freeze(Object.defineProperty({__proto__:null,build:R},Symbol.toStringTag,{value:"Module"}));b.RealisticTree=X;b.build=R})},"esri/views/3d/layers/graphics/interfaces":function(){define(["exports"],function(b){b.ApplyRendererDiffResult=void 0;var a=b.ApplyRendererDiffResult||(b.ApplyRendererDiffResult={});a[a.RecreateSymbol=0]="RecreateSymbol";a[a.RecreateGraphics=1]="RecreateGraphics";a[a.FastUpdate=2]="FastUpdate";Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Loadable":function(){define(["exports","../../../../core/maybe","../../../../core/promiseUtils"],function(b,a,c){class d{constructor(f){this.schedule=f;this._abortController=null;this._loadStatus=b.LoadStatus.LOADING;this.logger=this._loader=this._loadError=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(f,n){if(this._loadStatus===b.LoadStatus.LOADED)return f&&f(),this._loader??Promise.resolve();if(this._loadStatus===
b.LoadStatus.FAILED)return n&&n(this._loadError),this._loader??Promise.resolve();null==this._loader&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null;this._loadStatus=b.LoadStatus.LOADED},k=>{this._loadError=k;this._abortController=null;this._loadStatus=b.LoadStatus.FAILED;!c.isAbortError(k)&&this.logger&&k.message&&this.logger.warn(k.message);throw k;}));this._loader.then(f,n).catch(()=>{});return this._loader}abortLoad(){null!=
this._abortController?this._abortController=a.abortMaybe(this._abortController):this._loadStatus===b.LoadStatus.LOADING&&(this._loadStatus=b.LoadStatus.FAILED);this._loader=null}}b.LoadStatus=void 0;(function(f){f[f.LOADING=0]="LOADING";f[f.LOADED=1]="LOADED";f[f.FAILED=2]="FAILED"})(b.LoadStatus||(b.LoadStatus={}));b.Loadable=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/pointUtils":function(){define("exports ../../../../chunks/vec3f64 ../../../../geometry/projection/projectPointToVector ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/coordsUtils ../../../../layers/graphics/dehydratedPoint ./elevationAlignmentUtils ./graphicUtils ../../webgl-engine/lib/Object3D".split(" "),
function(b,a,c,d,f,n,k,g,q){const e=a.create();b.createStageObject=function(m,l,w,v,x){const p=m.clippingExtent;c.projectPointToVector(l,e,m.elevationProvider.spatialReference);if(null!=p&&!d.containsPoint(p,e))return null;c.projectPointToVector(l,e,m.renderCoordsHelper.spatialReference);w.localOrigin=m.localOriginFactory.getOrigin(e);w=new q.Object3D({geometries:[w],castShadow:!1,layerUid:m.layer.uid,graphicUid:x,usesVerticalDistanceToGround:!0});m=k.applyElevationAlignmentForHUD(w,l,m.elevationProvider,
m.renderCoordsHelper,v);return{object:w,sampledElevation:m}};b.extendPointGraphicElevationContext=function(m,l,w){m=m.elevationContext;w=w.spatialReference;c.projectPointToVector(l,e,w);m.centerPointInElevationSR=n.makeDehydratedPoint(e[0],e[1],l.hasZ?e[2]:0,null!=w?w:null)};b.placePointOnGeometry=function(m){switch(m.type){case "point":return m;case "polygon":case "extent":return g.computeCentroid(m);case "polyline":var l=m.paths[0];if(!l||0===l.length)break;l=f.getPointOnPath(l,f.getPathLength(l)/
2);return n.makeDehydratedPoint(l[0],l[1],l[2],m.spatialReference);case "mesh":return m.origin}return null};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Object3D":function(){define("exports ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/sphere ../../support/mathUtils ./basicInterfaces ./ContentObject ./ContentObjectType ./Object3DStateID ./Util ./VertexAttribute ../materials/renderers/utils".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v){class x extends q.ContentObject{get geometries(){return this._geometries}get transformation(){return this._transformation??c.IDENTITY}set transformation(A){this._transformation=a.copy(this._transformation??c.create(),A);this._invalidateBoundingVolume();this._emit("transformationChanged",this)}get shaderTransformation(){return this._shaderTransformation}set shaderTransformation(A){this._shaderTransformation=A?a.copy(this._shaderTransformation??c.create(),A):null;
this._invalidateBoundingVolume();this._emit("shaderTransformationChanged",this)}get effectiveTransformation(){return this.shaderTransformation??this.transformation}constructor(A={}){super();this.type=e.ContentObjectType.Object;this._parentLayer=this._shaderTransformation=null;this._visible=!0;this.castShadow=A.castShadow??!0;this.usesVerticalDistanceToGround=A.usesVerticalDistanceToGround??!1;this.graphicUid=A.graphicUid;this.layerUid=A.layerUid;A.isElevationSource&&(this.lastValidElevationBB=new p);
this._geometries=A.geometries?Array.from(A.geometries):[]}dispose(){this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(A){l.assert(null==this._parentLayer||null==A,"Object3D can only be added to a single Layer");this._parentLayer=A}addGeometry(A){A.visible=this._visible;this._geometries.push(A);this._emit("geometryAdded",{object:this,geometry:A});this._invalidateBoundingVolume()}removeGeometry(A){if(A=this._geometries.splice(A,1)[0])this._emit("geometryRemoved",{object:this,
geometry:A}),this._invalidateBoundingVolume()}removeAllGeometries(){for(;0<this._geometries.length;)this.removeGeometry(0)}geometryVertexAttributeUpdated(A,C,E=!1){this._emit("attributesChanged",{object:this,geometry:A,attribute:C,sync:E});w.affectsGeometry(C)&&this._invalidateBoundingVolume()}get visible(){return this._visible}set visible(A){if(this._visible!==A){this._visible=A;for(const C of this._geometries)C.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const A=new m.Object3DStateID(g.Object3DState.MaskOccludee);
for(const C of this._geometries)C.occludees=v.addObject3DStateID(C.occludees,A);this._emit("occlusionChanged",this);return A}removeOcclude(A){for(const C of this._geometries)C.occludees=v.removeObject3DStateID(C.occludees,A);this._emit("occlusionChanged",this)}highlight(){const A=new m.Object3DStateID(g.Object3DState.Highlight);for(const C of this._geometries)C.highlights=v.addObject3DStateID(C.highlights,A);this._emit("highlightChanged",this);return A}removeHighlight(A){for(const C of this._geometries)C.highlights=
v.removeObject3DStateID(C.highlights,A);this._emit("highlightChanged",this)}getCombinedStaticTransformation(A,C){return a.multiply(C,this.transformation,A.transformation)}getCombinedShaderTransformation(A,C=c.create()){return a.multiply(C,this.effectiveTransformation,A.transformation)}get boundingVolumeWorldSpace(){this._bvWorldSpace||(this._bvWorldSpace=this._bvWorldSpace||new h,this._validateBoundingVolume(this._bvWorldSpace,z.WorldSpace));return this._bvWorldSpace}get boundingVolumeObjectSpace(){this._bvObjectSpace||
(this._bvObjectSpace=this._bvObjectSpace||new h,this._validateBoundingVolume(this._bvObjectSpace,z.ObjectSpace));return this._bvObjectSpace}_validateBoundingVolume(A,C){C=C===z.ObjectSpace;for(var E of this._geometries){var B=E.boundingInfo;if(B){var D=A,F=C?E.transformation:this.getCombinedShaderTransformation(E),K=B.bbMin;B=B.bbMax;if(a.hasIdentityRotation(F))for(F=d.set(t,F[12],F[13],F[14]),d.add(r,K,F),d.add(u,B,F),K=0;3>K;++K)D.min[K]=Math.min(D.min[K],r[K]),D.max[K]=Math.max(D.max[K],u[K]);
else if(d.transformMat4(r,K,F),d.exactEquals(K,B))for(K=0;3>K;++K)D.min[K]=Math.min(D.min[K],r[K]),D.max[K]=Math.max(D.max[K],r[K]);else{d.transformMat4(u,B,F);for(var L=0;3>L;++L)D.min[L]=Math.min(D.min[L],r[L],u[L]),D.max[L]=Math.max(D.max[L],r[L],u[L]);for(L=0;3>L;++L){d.copy(r,K);d.copy(u,B);r[L]=B[L];u[L]=K[L];d.transformMat4(r,r,F);d.transformMat4(u,u,F);for(let G=0;3>G;++G)D.min[G]=Math.min(D.min[G],r[G],u[G]),D.max[G]=Math.max(D.max[G],r[G],u[G])}}}}d.lerp(A.bounds,A.min,A.max,.5);for(const G of this._geometries)E=
G.boundingInfo,null!=E&&(K=C?G.transformation:this.getCombinedShaderTransformation(G),D=k.maxScale(K),d.transformMat4(y,E.center,K),K=d.distance(y,A.bounds),A.bounds[3]=Math.max(A.bounds[3],K+E.radius*D))}_invalidateBoundingVolume(){const A=this._bvWorldSpace?.bounds;this._bvObjectSpace=this._bvWorldSpace=void 0;this._parentLayer&&A&&this._parentLayer.notifyObjectBBChanged(this,A)}_emit(A,C){this._parentLayer&&this._parentLayer.events.emit(A,C)}get test(){const A=this;return{hasGeometry:C=>A._geometries.includes(C),
getGeometryIndex:C=>A._geometries.indexOf(C)}}}class p{constructor(){this.min=f.fromValues(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);this.max=f.fromValues(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}}class h extends p{constructor(){super(...arguments);this.bounds=n.create()}}const t=f.create(),r=f.create(),u=f.create(),y=f.create();var z;(function(A){A[A.WorldSpace=0]="WorldSpace";A[A.ObjectSpace=
1]="ObjectSpace"})(z||(z={}));b.Object3D=x;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/LineCalloutMaterial":function(){define("exports ../../../../chunks/vec2f32 ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/VertexAttribute ./internal/bufferWriterUtils ../shaders/LineCalloutTechnique ../shaders/LineCalloutTechniqueConfiguration".split(" "),function(b,a,c,
d,f,n,k,g,q,e,m){class l extends n.Material{get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}constructor(t){super(t,new v);this._configuration=new m.LineCalloutTechniqueConfiguration;this._uniqueMaterialIdentifier=l.uniqueMaterialIdentifier(this.parameters)}getPassParameters(){return this.parameters}getConfiguration(t,r){t=r?.slot!==k.RenderSlot.LINE_CALLOUTS;this._configuration.occlusionTestEnabled=this.parameters.occlusionTest;this._configuration.hasVerticalOffset=null!=this.parameters.verticalOffset;
this._configuration.hasScreenSizePerspective=null!=this.parameters.screenSizePerspective;this._configuration.depthHudEnabled=t;this._configuration.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart;this._configuration.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.multipassEnabled=r.multipassEnabled;return this._configuration}intersect(){}produces(t,r){if(r===d.ShaderOutput.Color)switch(t){case k.RenderSlot.LINE_CALLOUTS:case k.RenderSlot.LINE_CALLOUTS_HUD_DEPTH:return!0}return!1}createGLMaterial(t){return new w(t)}createBufferWriter(){return new h}validateParameters(t){t=
l.uniqueMaterialIdentifier(t);t!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=t)}static uniqueMaterialIdentifier(t){return JSON.stringify({horizontalScreenOffset:t.horizontalScreenOffset??0,centerOffsetUnits:t.centerOffsetUnits||"world"})}}class w extends f{beginSlot(t){return this.ensureTechnique(e.LineCalloutTechnique,t)}}class v extends n.MaterialParameters{constructor(){super(...arguments);this.horizontalScreenOffset=0;this.color=[0,0,0,1];this.size=1;this.occlusionTest=!1;
this.shaderPolygonOffset=1E-5;this.depthHUDAlignStart=!1;this.centerOffsetUnits="world";this.hasSlicePlane=!1}}const x=c.newLayout().vec3f(g.VertexAttribute.POSITION).vec3f(g.VertexAttribute.NORMAL).vec2f(g.VertexAttribute.UV0).vec4f(g.VertexAttribute.AUXPOS1),p=[a.fromValues(0,0),a.fromValues(1,0),a.fromValues(0,1),a.fromValues(1,0),a.fromValues(1,1),a.fromValues(0,1)];class h{constructor(){this.vertexBufferLayout=x}elementCount(t){return 6*t.attributes.get(g.VertexAttribute.POSITION).indices.length}write(t,
r,u,y,z){q.writePosition(u.attributes.get(g.VertexAttribute.POSITION),t,y.position,z,6);q.writeNormal(u.attributes.get(g.VertexAttribute.NORMAL),r,y.normal,z,6);q.writeBufferVec4(u.attributes.get(g.VertexAttribute.AUXPOS1),y.auxpos1,z,6);for(t=0;t<p.length;++t)y.uv0.setVec(z+t,p[t])}}b.LineCalloutMaterial=l;b.Parameters=v;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/vec2f32":function(){define(["exports"],function(b){function a(){return new Float32Array(2)}function c(x){const p=
new Float32Array(2);p[0]=x[0];p[1]=x[1];return p}function d(x,p){const h=new Float32Array(2);h[0]=x;h[1]=p;return h}function f(x,p){return new Float32Array(x,p,2)}function n(){return a()}function k(){return d(1,1)}function g(){return d(1,0)}function q(){return d(0,1)}const e=a(),m=k(),l=g(),w=q(),v=Object.freeze(Object.defineProperty({__proto__:null,ONES:m,UNIT_X:l,UNIT_Y:w,ZEROS:e,clone:c,create:a,createView:f,fromValues:d,ones:k,unitX:g,unitY:q,zeros:n},Symbol.toStringTag,{value:"Module"}));b.ONES=
m;b.UNIT_X=l;b.UNIT_Y=w;b.ZEROS=e;b.clone=c;b.create=a;b.createView=f;b.fromValues=d;b.ones=k;b.unitX=g;b.unitY=q;b.vec2f32=v;b.zeros=n})},"esri/views/3d/webgl-engine/shaders/LineCalloutTechnique":function(){define("require exports ../../../ViewingMode ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/LineCallout.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),function(b,
a,c,d,f,n,k,g,q,e){class m extends f.ShaderTechnique{initializeConfiguration(l,w){w.spherical=l.viewingMode===c.ViewingMode.Global}initializeProgram(l){return new k.Program(l.rctx,m.shader.get().build(this.configuration),n.Default3D)}setPipelineState(l){l=l?q.CompareFunction.ALWAYS:q.CompareFunction.LESS;return this.configuration.depthHudEnabled?e.makePipelineState({depthTest:{func:l},depthWrite:e.defaultDepthWriteParams}):e.makePipelineState({blending:e.separateBlendingParams(q.BlendFactor.ONE,q.BlendFactor.SRC_ALPHA,
q.BlendFactor.ONE_MINUS_SRC_ALPHA,q.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:l},colorWrite:e.defaultColorWriteParams})}initializePipeline(){return this.setPipelineState(this.configuration.multipassEnabled)}}m.shader=new d.ReloadableShaderModule(g.LineCallout,()=>new Promise((l,w)=>b(["./LineCallout.glsl"],l,w)));a.LineCalloutTechnique=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/LineCallout.glsl":function(){define("exports ./vec2 ./vec2f64 ./vec4f64 ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUDVisibility.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassGeometryTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p){function h(u){const y=new x.ShaderBuilder,{vertex:z,fragment:A}=y;z.include(n.AlignPixel);y.include(k.HUD,u);y.include(f.SliceDraw,u);y.attributes.add(p.VertexAttribute.UV0,"vec2");z.uniforms.add(new l.Float4PassUniform("viewport",(C,E)=>E.camera.fullViewport),new w.FloatPassUniform("lineSize",(C,E)=>0<C.size?Math.max(1,C.size)*E.camera.pixelRatio:0),new m.Float2PassUniform("pixelToNDC",(C,E)=>a.set(r,2/E.camera.fullViewport[2],2/E.camera.fullViewport[3])),
new w.FloatPassUniform("borderSize",(C,E)=>null!=C.borderColor?E.camera.pixelRatio:0),new m.Float2PassUniform("screenOffset",(C,E)=>a.set(r,C.horizontalScreenOffset*E.camera.pixelRatio,0)));y.varyings.add("coverageSampling","vec4");y.varyings.add("lineSizes","vec2");u.multipassEnabled&&y.varyings.add("depth","float");u.occlusionTestEnabled&&y.include(g.HUDVisibility);u.hasScreenSizePerspective&&e.addScreenSizePerspectiveAlignment(z);z.code.add(v.glsl`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${u.occlusionTestEnabled?v.glsl`
      if (!testHUDVisibility(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${u.hasScreenSizePerspective?v.glsl`
      vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:v.glsl`vec2 screenOffsetScaled = screenOffset;`}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly used to get the
      // correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${u.multipassEnabled?"depth \x3d posView.z;":""}

      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${u.depthHudEnabled?u.depthHudAlignStartEnabled?v.glsl`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:v.glsl`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${u.hasScreenSizePerspective?v.glsl`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:v.glsl`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (-halfPixelSize - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `);A.uniforms.add(new l.Float4PassUniform("uColor",C=>t(C.color)),new l.Float4PassUniform("borderColor",C=>t(C.borderColor)));u.multipassEnabled&&(A.include(q.multipassGeometryTest,u),A.uniforms.add(new m.Float2PassUniform("inverseViewport",(C,E)=>E.inverseViewport)));A.code.add(v.glsl`
    void main() {
      ${u.multipassEnabled?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line blends on top of the
      // border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${u.depthHudEnabled?v.glsl`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:v.glsl`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      fragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `);return y}function t(u){return null!=u?u:d.ZEROS}const r=c.create();c=Object.freeze(Object.defineProperty({__proto__:null,build:h},Symbol.toStringTag,{value:"Module"}));b.LineCallout=c;b.build=h})},"esri/views/3d/webgl-engine/shaders/LineCalloutTechniqueConfiguration":function(){define(["exports","../../../../chunks/tslib.es6","../core/shaderTechnique/ShaderTechniqueConfiguration","../materials/DefaultTechniqueConfiguration"],function(b,a,c,d){class f extends d.DefaultTechniqueConfiguration{constructor(){super(...arguments);
this.spherical=this.screenCenterOffsetUnitsEnabled=!1;this.occlusionTestEnabled=!0;this.multipassEnabled=this.hasSlicePlane=this.depthHudAlignStartEnabled=this.depthHudEnabled=this.hasScreenSizePerspective=this.hasVerticalOffset=!1}}a.__decorate([c.parameter()],f.prototype,"screenCenterOffsetUnitsEnabled",void 0);a.__decorate([c.parameter()],f.prototype,"spherical",void 0);a.__decorate([c.parameter()],f.prototype,"occlusionTestEnabled",void 0);a.__decorate([c.parameter()],f.prototype,"hasVerticalOffset",
void 0);a.__decorate([c.parameter()],f.prototype,"hasScreenSizePerspective",void 0);a.__decorate([c.parameter()],f.prototype,"depthHudEnabled",void 0);a.__decorate([c.parameter()],f.prototype,"depthHudAlignStartEnabled",void 0);a.__decorate([c.parameter()],f.prototype,"hasSlicePlane",void 0);a.__decorate([c.parameter()],f.prototype,"multipassEnabled",void 0);a.__decorate([c.parameter({constValue:!0})],f.prototype,"hasSliceInVertexProgram",void 0);a.__decorate([c.parameter({constValue:!1})],f.prototype,
"draped",void 0);b.LineCalloutTechniqueConfiguration=f;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/graphicSymbolUtils":function(){define(["exports","./Graphics3DSymbol","./Graphics3DWebStyleSymbol"],function(b,a,c){b.getGraphics3DSymbol=function(d){return d instanceof c.Graphics3DWebStyleSymbol?d.graphics3DSymbol:d instanceof a.Graphics3DSymbol?d:null};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DSymbol":function(){define("exports ../../../../core/arrayUtils ../../../../core/asyncUtils ../../../../core/promiseUtils ./defaultSymbolComplexity ./Graphics3DGraphic ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCreationContext ./Graphics3DSymbolLayerFactory ./interfaces ./Loadable".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m){class l extends m.Loadable{set symbol(v){this._symbol=v;v.symbolLayers.forEach((x,p)=>{p=this.symbolLayers[p];null!=p&&(p.symbol=v,p.symbolLayer=x)})}get symbol(){return this._symbol}constructor(v,x,p){super(x.schedule);this._symbol=v;this._context=x;this._backgroundLayers=p;this._destroyed=!1;this.symbolLayers=[];this._extentPadding=this.referenced=0}async doLoad(v){let x=this._symbol.symbolLayers;this._extentPadding=0;this._backgroundLayers&&(x=this._backgroundLayers.concat(x));
const p=x.length;for(;this.symbolLayers.length<x.length;)this.symbolLayers.push(null);this.symbolLayers.length=x.length;const h=[];for(let r=0;r<p;r++){var t=x.at(r);if(!1===t.enabled)continue;w.renderPriority=1-(1+r)/p;w.renderPriorityStep=1/p;w.ignoreDrivers=t.ignoreDrivers;const u=q.make(this.symbol,t,this._context,w);(t=d.onAbortOrThrow(v,()=>{this.symbolLayers[r]=null;u.destroy()}))&&h.push(t);this.symbolLayers[r]=u}await c.forEach(this.symbolLayers,async(r,u)=>{if(null!=r)try{await r.load(),
this._extentPadding+=Math.max(this._extentPadding,r.extentPadding)}catch{this.symbolLayers[u]=null}});h.forEach(r=>r.remove());d.throwIfAborted(v);if(this.symbolLayers.length&&!this.symbolLayers.some(r=>!!r))throw Error();}getSymbolLayerSize(v){v=this.symbolLayers[v];return null!=v?v.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some(v=>v?.queryForSnapping)}createGraphics3DGraphic(v,x){const p=v.graphic,h=this.symbolLayers.map(t=>
t?.createGraphics3DGraphic(v)??null);return new n.Graphics3DGraphic(p,x||this,h,v.layer,this._context.arcade||this._context.featureExpressionInfoContext?.arcade?.modules||null)}get complexity(){return f.totalSymbolComplexities(this.symbolLayers.map(v=>null!=v?v.complexity:null))}globalPropertyChanged(v,x){const p=this.symbolLayers.length;for(let h=0;h<p;h++){const t=this.symbolLayers[h],r=u=>{u=u.layers[h];return u instanceof k.Graphics3DObject3DGraphicLayer?u:null};if(null!=t&&!t.globalPropertyChanged(v,
x,r))return!1}return!0}applyRendererDiff(v,x){return this.loadStatus!==m.LoadStatus.LOADED?e.ApplyRendererDiffResult.RecreateSymbol:this.symbolLayers.reduce((p,h)=>p!==e.ApplyRendererDiffResult.RecreateSymbol&&null!=h?Math.min(p,h.applyRendererDiff(v,x)):p,e.ApplyRendererDiffResult.FastUpdate)}prepareSymbolPatch(v){if(this.loadStatus!==m.LoadStatus.FAILED&&"partial"===v.diff.type){var x=v.diff.diff;if(x.symbolLayers&&"partial"===x.symbolLayers.type){var p=x.symbolLayers.diff;this.symbolLayers.forEach((h,
t)=>{if(null!=h){var r=p[t];if(r){const u={diff:r,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};h.prepareSymbolLayerPatch(u);v.symbolStatePatches.push(...u.symbolLayerStatePatches);u.graphics3DGraphicPatches.length&&v.graphics3DGraphicPatches.push((y,z)=>{const A=y.layers[t];null!=A&&u.graphics3DGraphicPatches.forEach(C=>C(A,z))})}}})}}}updateGeometry(v,x){return this._updateGeometryOrTransform(v,(p,h)=>p.updateGeometry(h,x))}updateTransform(v,x,p,h){return this._updateGeometryOrTransform(v,
(t,r)=>t.updateTransform(r,x,p,h))}_updateGeometryOrTransform(v,x){for(let p=0;p<this.symbolLayers.length;p++){const h=this.symbolLayers[p];if(null==h)continue;const t=v.layers[p];if(!t||!x(h,t))return!1}return!0}onRemoveGraphic(v){for(let x=0;x<this.symbolLayers.length;x++){const p=this.symbolLayers[x];if(null==p)continue;const h=v.layers[x];if(null!=h)p.onRemoveGraphic(h)}}getFastUpdateStatus(){let v=0,x=0,p=0;this.symbolLayers.forEach(h=>{null!=h&&(h.loadStatus===m.LoadStatus.LOADING?v++:h.isFastUpdatesEnabled()?
p++:x++)});return{loading:v,slow:x,fast:p}}async queryForSnapping(v,x,p,h){var t=this.symbolLayers.filter(a.isSome).filter(r=>null!=r.queryForSnapping).map(r=>r.queryForSnapping(v,x,p,h));t=await Promise.all(t);d.throwIfAborted(h);return t.flat()}destroy(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{super.destroy();for(const v of this.symbolLayers)null!=v&&v.destroy();this.symbolLayers.length=0;this._destroyed=!0}}get destroyed(){return this._destroyed}}
const w=new g.Graphics3DSymbolLayerCreationContext;b.Graphics3DSymbol=l;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DGraphic":function(){define("exports ../../../../core/arrayUtils ../../../../core/asyncUtils ../../../../core/byteSizeEstimations ../../../../core/ObjectPool ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/Polygon ../../../../geometry/projection/projectBoundingRect ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/spatialReferenceUtils ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/featureConversionUtils ./enums ./featureExpressionInfoUtils".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t){const r=new f(Array,z=>l.set(z,l.zero),null,10,5),u=w.create();class y{get labelLayers(){return this._labelLayers||a.EmptyArray}get extent(){return this._extent}get isElevationSource(){return this.layers.some(z=>z?.isElevationSource)}constructor(z,A,C,E,B){this.graphic=z;this.graphics3DSymbol=A;this.layers=C;this._visibleFlags=h.VisibilityFlag.ALL_LABEL;this.deconflictionPriority=0;++A.referenced;this._featureExpressionFeature=B?t.createFeature(B,z,E):
null}initialize(z){this._layer=z;this._forEachSymbolLayerGraphic(A=>{A.initialize(z);A.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(z=>z.destroy());this._calloutLayer=null;--this.graphics3DSymbol.referenced;this.graphics3DSymbol=null}get destroyed(){return null==this.layers}clearLabelGraphics(){this._forEachLabelGraphic(z=>z.destroy());this._labelLayers=null}addLabelGraphic(z,A){this._labelLayers||(this._labelLayers=[]);this._labelLayers.push(z);z.initialize(A);z.setVisibility(this.isVisible(h.VisibilityGroup.LABEL))}setCalloutGraphic(z){this._calloutLayer=
z;this._layer&&(z.initialize(this._layer),z.setVisibility(this.isVisible()))}get calloutLayer(){return this._calloutLayer}get isDraped(){let z=!1;this._forEachSymbolLayerGraphic(A=>{"draped"===A.type&&(z=!0)});return z}isVisible(z=h.VisibilityGroup.GRAPHIC,A){A=A?this._visibleFlags|A|h.VisibilityGroup.LABEL*A:this._visibleFlags;return z===h.VisibilityGroup.GRAPHIC?(A&h.VisibilityFlag.ALL_GRAPHIC)===h.VisibilityFlag.ALL_GRAPHIC:(A&h.VisibilityFlag.ALL_LABEL)===h.VisibilityFlag.ALL_LABEL}setVisibilityFlag(z,
A,C){const E=this.isVisible(z);this._visibleFlags=C?this._visibleFlags|z*A:this._visibleFlags&~(z*A);const B=this.isVisible(z);if(E===B)return!1;if(z===h.VisibilityGroup.LABEL)this._forEachLabelGraphic(D=>D.setVisibility(B));else{this._forEachSymbolLayerGraphic(F=>F.setVisibility(B));const D=this.isVisible(h.VisibilityGroup.LABEL);this._forEachLabelGraphic(F=>F.setVisibility(D))}return!0}getVisibilityFlag(z,A){return 0!==(this._visibleFlags&z*A)}computeExtent(z){if(!this._extent){var A=this.graphic.geometry;
if(null==A)return!1;this._extent=w.create();x.computeAABR(A,this._extent);A=A.spatialReference;if(!v.equals(A,z)&&!m.projectBoundingRect(this._extent,A,this._extent,z))return this._extent=null,!1}return!0}getAsOptimizedGeometry(z,A){this._optimizedGeometry||(this._optimizedGeometry=this._convertGraphicToOptimizedGeometry(this.graphic,z,A));return this._optimizedGeometry}_convertGraphicToOptimizedGeometry(z,A,C){z=z.geometry;if("mesh"===z.type||"extent"===z.type)z=e.fromExtent("mesh"===z.type?z.extent:
z);return p.convertFromGeometry(z,A,C)}get usedMemory(){let z=d.estimateAttributesObjectSize(this.graphic.attributes);this._forEachSymbolLayerGraphic(A=>z+=A.graphics3DSymbolLayer.usedMemory);return z}computeAttachmentOrigin(){const z={render:{origin:q.create(),num:0},draped:{origin:k.create(),num:0}};for(const A of this.layers)null!=A&&A.computeAttachmentOrigin(z);1<z.render.num&&g.scale(z.render.origin,z.render.origin,1/z.render.num);1<z.draped.num&&n.scale(z.draped.origin,z.draped.origin,1/z.draped.num);
return z}async getProjectedBoundingBox(z,A,C,E,B){B||(B={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]});B.boundingBox?l.empty(B.boundingBox):B.boundingBox=l.empty();B.requiresDrapedElevation=!1;await c.forEach(this.layers,async D=>{if(null!=D){var F="draped"===D.type?A:z,K=r.acquire();D=await D.getProjectedBoundingBox(F,C,B.screenSpaceObjects,E,K);isFinite(D[2])&&isFinite(D[5])||(B.requiresDrapedElevation=!0);D&&l.expandWithAABB(B.boundingBox,K);r.release(K)}});return l.allFinite(B.boundingBox)||
w.allFinite(l.toRect(B.boundingBox,u))?B:null}needsElevationUpdates(){for(const z of this.layers)if(null!=z&&("object3d"===z.type||"lod-instance"===z.type)&&z.needsElevationUpdates)return!0;return this._labelLayers?.some(z=>z?.needsElevationUpdates??!1)??!1}alignWithElevation(z,A,C){this._forEachRenderedGraphic(E=>{"object3d"!==E.type&&"lod-instance"!==E.type||E.alignWithElevation(z,A,this._featureExpressionFeature,C)})}alignWithAbsoluteElevation(z,A,C){this._forEachRenderedGraphic(E=>{"object3d"===
E.type&&E.alignWithAbsoluteElevation(z,A,C)})}addObjectStateSet(z,A){this._forEachSymbolLayerGraphic(C=>C.addObjectState(z,A))}removeObjectState(z){this._forEachSymbolLayerGraphic(A=>A.removeObjectState(z))}_forEachGraphicList(z,A){z?.forEach(C=>C&&A(C))}_forEachSymbolLayerGraphic(z){this._forEachGraphicList(this.layers,z);this._calloutLayer&&z(this._calloutLayer)}_forEachLabelGraphic(z){this._forEachGraphicList(this._labelLayers,z)}_forEachRenderedGraphic(z){this._forEachSymbolLayerGraphic(z);this._forEachLabelGraphic(z)}get test(){const z=
this;return{addLabelLayer:A=>{z._labelLayers||(z._labelLayers=[]);z._labelLayers.push(A)}}}}b.Graphics3DGraphic=y;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/dehydratedFeatures":function(){define("exports ../../core/byteSizeEstimations ../../core/has ../../core/typedArrayUtil ../../core/uid ../../geometry/SpatialReference ../../geometry/support/aaBoundingBox ../../geometry/support/aaBoundingRect ../../geometry/support/quantizationUtils ../../geometry/support/typeUtils ../support/Field ./dehydratedFeatureComparison".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l){function w(h,t,r){if(null==h)return null;switch(t){case "point":return{x:h.x,y:h.y,z:h.z,m:h.m,hasZ:null!=h.z,hasM:null!=h.m,type:"point",spatialReference:r};case "polyline":return{paths:h.paths,hasZ:!!h.hasZ,hasM:!!h.hasM,type:"polyline",spatialReference:r};case "polygon":return{rings:h.rings,hasZ:!!h.hasZ,hasM:!!h.hasM,type:"polygon",spatialReference:r};case "multipoint":return{points:h.points,hasZ:!!h.hasZ,hasM:!!h.hasM,type:"multipoint",spatialReference:r}}}function v(h){if(null==
h)return 0;let t=32;switch(h.type){case "point":t+=42;break;case "polyline":case "polygon":var r=0;const u=2+(h.hasZ?1:0)+(h.hasM?1:0);h="polyline"===h.type?h.paths:h.rings;for(const y of h)r+=y.length;t+=8*r*u+64;t+=128*r;t=t+34+32*(h.length+1);break;case "multipoint":r=h.points.length;t+=8*r*(2+(h.hasZ?1:0)+(h.hasM?1:0))+64;t+=128*r;t=t+34+32;break;case "extent":t+=98;h.hasM&&(t+=32);h.hasZ&&(t+=32);break;case "mesh":t+=d.estimateSize(h.vertexAttributes.position,h.vertexAttributes.normal,h.vertexAttributes.uv,
h.vertexAttributes.tangent)}return t}class x{constructor(h,t,r){this.uid=h;this.geometry=t;this.attributes=r;this.visible=!0;this.centroid=this.objectId=null}}class p{constructor(){this.exceededTransferLimit=!1;this.features=[];this.fields=[];this.hasZ=this.hasM=!1;this.transform=this.spatialReference=this.geohashFieldName=this.geometryProperties=this.globalIdFieldName=this.objectIdFieldName=this.geometryType=null}}b.equals=l.equals;b.DehydratedFeatureClass=x;b.DehydratedFeatureSetClass=p;b.computeAABB=
function(h,t){k.empty(t);"mesh"===h.type&&(h=h.extent);switch(h.type){case "point":t[0]=t[3]=h.x;t[1]=t[4]=h.y;h.hasZ&&(t[2]=t[5]=h.z);break;case "polyline":for(var r=0;r<h.paths.length;r++)k.expandWithNestedArray(t,h.paths[r],!!h.hasZ);break;case "polygon":for(r=0;r<h.rings.length;r++)k.expandWithNestedArray(t,h.rings[r],!!h.hasZ);break;case "multipoint":k.expandWithNestedArray(t,h.points,!!h.hasZ);break;case "extent":t[0]=h.xmin,t[1]=h.ymin,t[3]=h.xmax,t[4]=h.ymax,null!=h.zmin&&(t[2]=h.zmin),null!=
h.zmax&&(t[5]=h.zmax)}};b.computeAABR=function(h,t){g.empty(t);"mesh"===h.type&&(h=h.extent);switch(h.type){case "point":t[0]=t[2]=h.x;t[1]=t[3]=h.y;break;case "polyline":for(var r=0;r<h.paths.length;r++)g.expandWithNestedArray(t,h.paths[r]);break;case "polygon":for(r=0;r<h.rings.length;r++)g.expandWithNestedArray(t,h.rings[r]);break;case "multipoint":g.expandWithNestedArray(t,h.points);break;case "extent":t[0]=h.xmin,t[1]=h.ymin,t[2]=h.xmax,t[3]=h.ymax}};b.estimateGeometryObjectSize=v;b.estimateSize=
function(h){let t;t=32+a.estimateAttributesObjectSize(h.attributes);return t=t+3+(8+v(h.geometry))};b.fromFeatureSetJSON=function(h){const t=e.featureGeometryTypeKebabDictionary.fromJSON(h.geometryType),r=n.fromJSON(h.spatialReference),u=h.transform,y=h.features.map(z=>{var A=h.objectIdFieldName;z={uid:f.generateUID(),objectId:A&&z.attributes?z.attributes[A]:null,attributes:z.attributes,geometry:w(z.geometry,t,r),visible:!0};A=z.geometry;if(null!=A&&u)switch(A.type){case "point":z.geometry=q.unquantizePoint(u,
A,A,A.hasZ,A.hasM);break;case "multipoint":z.geometry=q.unquantizeMultipoint(u,A,A,!!A.hasZ,!!A.hasM);break;case "polygon":z.geometry=q.unquantizePolygon(u,A,A,!!A.hasZ,!!A.hasM);break;case "polyline":z.geometry=q.unquantizePolyline(u,A,A,!!A.hasZ,!!A.hasM);break;case "extent":z.geometry=A;break;case "mesh":z.geometry=A}return z});return{geometryType:t,features:y,spatialReference:r,fields:h.fields?.map(z=>m.fromJSON(z))??[],objectIdFieldName:h.objectIdFieldName,globalIdFieldName:h.globalIdFieldName,
geohashFieldName:h.geohashFieldName,geometryProperties:h.geometryProperties,hasZ:h.hasZ,hasM:h.hasM,exceededTransferLimit:h.exceededTransferLimit,transform:null}};b.fromJSONGeometry=w;b.getObjectId=function(h,t){return null!=h.objectId?h.objectId:h.attributes&&t?h.attributes[t]:null};b.hasGeometry=function(h){return null!=h.geometry};b.hasVertices=function(h){if(null==h)return!1;switch(h.type){case "extent":case "point":return!0;case "polyline":for(const t of h.paths)if(0<t.length)return!0;return!1;
case "polygon":for(const t of h.rings)if(0<t.length)return!0;return!1;case "multipoint":return 0<h.points.length;case "mesh":return!h.loaded||0<h.vertexAttributes.position.length}};b.numVertices=function(h){if(null==h)return 0;switch(h.type){case "point":return 1;case "polyline":var t=0;for(var r of h.paths)t+=r.length;return t;case "polygon":r=0;for(t of h.rings)r+=t.length;return r;case "multipoint":return h.points.length;case "extent":return 2;case "mesh":return(h=h.vertexAttributes&&h.vertexAttributes.position)?
h.length/3:0}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/quantizationUtils":function(){define(["exports","./jsonUtils"],function(b,a){function c({scale:B,translate:D},F){return Math.round((F-D[0])/B[0])}function d({scale:B,translate:D},F){return Math.round((D[1]-F)/B[1])}function f(B,D,F){const K=[];let L,G,O,P;for(let J=0;J<F.length;J++){const R=F[J];if(0<J){if(O=c(B,R[0]),P=d(B,R[1]),O!==L||P!==G)K.push(D(R,O-L,P-G)),L=O,G=P}else L=c(B,R[0]),G=d(B,R[1]),
K.push(D(R,L,G))}return 0<K.length?K:null}function n(B,D,F,K){return f(B,F?K?E:C:K?C:A,D)}function k(B,D,F,K){const L=[];F=F?K?E:C:K?C:A;for(K=0;K<D.length;K++){const G=f(B,F,D[K]);G&&3<=G.length&&L.push(G)}return L.length?L:null}function g(B,D,F,K){const L=[];F=F?K?E:C:K?C:A;for(K=0;K<D.length;K++){const G=f(B,F,D[K]);G&&2<=G.length&&L.push(G)}return L.length?L:null}function q({scale:B,translate:D},F){return F*B[0]+D[0]}function e({scale:B,translate:D},F){return D[1]-F*B[1]}function m(B,D,F){const K=
Array(F.length);if(!F.length)return K;const [L,G]=B.scale;let O=q(B,F[0][0]);B=e(B,F[0][1]);K[0]=D(F[0],O,B);for(let P=1;P<F.length;P++){const J=F[P];O+=J[0]*L;B-=J[1]*G;K[P]=D(J,O,B)}return K}function l(B,D,F){const K=Array(F.length);for(let L=0;L<F.length;L++)K[L]=m(B,D,F[L]);return K}function w(B,D,F,K){return m(B,F?K?E:C:K?C:A,D)}function v(B,D,F,K){return l(B,F?K?E:C:K?C:A,D)}function x(B,D,F,K){return l(B,F?K?E:C:K?C:A,D)}function p(B,D,F){let [K,L]=F[0],G=Math.min(K,D[0]),O=Math.min(L,D[1]),
P=Math.max(K,D[2]);D=Math.max(L,D[3]);for(let J=1;J<F.length;J++){const [R,X]=F[J];K+=R;L+=X;0>R&&(G=Math.min(G,K));0<R&&(P=Math.max(P,K));0>X?O=Math.min(O,L):0<X&&(D=Math.max(D,L))}B[0]=G;B[1]=O;B[2]=P;B[3]=D;return B}function h(B,D){if(!D.length)return null;B[0]=B[1]=Number.POSITIVE_INFINITY;B[2]=B[3]=Number.NEGATIVE_INFINITY;for(let F=0;F<D.length;F++)p(B,B,D[F]);return B}function t(B,D,F,K,L){D.xmin=c(B,F.xmin);D.ymin=d(B,F.ymin);D.xmax=c(B,F.xmax);D.ymax=d(B,F.ymax);D!==F&&(K&&(D.zmin=F.zmin,
D.zmax=F.zmax),L&&(D.mmin=F.mmin,D.mmax=F.mmax));return D}function r(B,D,F,K,L){D.points=n(B,F.points,K,L)??[];return D}function u(B,D,F,K,L){D.x=c(B,F.x);D.y=d(B,F.y);D!==F&&(K&&(D.z=F.z),L&&(D.m=F.m));return D}function y(B,D,F,K,L){B=k(B,F.rings,K,L);if(!B)return null;D.rings=B;return D}function z(B,D,F,K,L){B=g(B,F.paths,K,L);if(!B)return null;D.paths=B;return D}const A=(B,D,F)=>[D,F],C=(B,D,F)=>[D,F,B[2]],E=(B,D,F)=>[D,F,B[2],B[3]];b.equals=function(B,D){if(B===D||null==B&&null==D)return!0;if(null==
B||null==D)return!1;let F,K,L,G;B&&"upperLeft"===B.originPosition?(F=B.translate[0],K=B.translate[1],B=B.scale[0]):(F=null!=B.extent?B.extent.xmin:0,K=null!=B.extent?B.extent.ymax:0,B=B.tolerance);D&&"upperLeft"===D.originPosition?(L=D.translate[0],G=D.translate[1],D=D.scale[0]):(L=null!=D.extent?D.extent.xmin:0,G=null!=D.extent?D.extent.ymax:0,D=D.tolerance);return F===L&&K===G&&B===D};b.getQuantizedBoundsCoordsArray=p;b.getQuantizedBoundsCoordsArrayArray=h;b.getQuantizedBoundsPaths=function(B){return h([0,
0,0,0],B)};b.getQuantizedBoundsPoints=function(B){const D=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];return p(D,D,B)};b.getQuantizedBoundsRings=function(B){return h([0,0,0,0],B)};b.quantizeBounds=function(B,D,F){D[0]=c(B,F[0]);D[3]=d(B,F[1]);D[2]=c(B,F[2]);D[1]=d(B,F[3]);return D};b.quantizeExtent=t;b.quantizeGeometry=function(B,D){return B&&D?a.isPoint(D)?u(B,{},D,!1,!1):a.isPolyline(D)?z(B,{},D,!1,!1):a.isPolygon(D)?y(B,{},D,!1,!1):a.isMultipoint(D)?
r(B,{},D,!1,!1):a.isExtent(D)?t(B,{},D,!1,!1):null:null};b.quantizeMultipoint=r;b.quantizePaths=g;b.quantizePoint=u;b.quantizePoints=n;b.quantizePolygon=y;b.quantizePolyline=z;b.quantizeRings=k;b.quantizeX=c;b.quantizeY=d;b.toQuantizationTransform=function(B){return B?{originPosition:"upper-left"===B.originPosition?"upperLeft":"lower-left"===B.originPosition?"lowerLeft":B.originPosition,scale:B.tolerance?[B.tolerance,B.tolerance]:[1,1],translate:null!=B.extent?[B.extent.xmin,B.extent.ymax]:[0,0]}:
null};b.unquantizeBounds=function(B,D,F){return F?(D[0]=q(B,F[0]),D[1]=e(B,F[3]),D[2]=q(B,F[2]),D[3]=e(B,F[1]),D):[q(B,D[0]),e(B,D[3]),q(B,D[2]),e(B,D[1])]};b.unquantizeCoordsArray=m;b.unquantizeCoordsArrayArray=l;b.unquantizeExtent=function(B,D,F,K,L){D.xmin=q(B,F.xmin);D.ymin=e(B,F.ymin);D.xmax=q(B,F.xmax);D.ymax=e(B,F.ymax);D!==F&&(K&&(D.zmin=F.zmin,D.zmax=F.zmax),L&&(D.mmin=F.mmin,D.mmax=F.mmax));return D};b.unquantizeMultipoint=function(B,D,F,K,L){null!=F&&(D.points=w(B,F.points,K,L));return D};
b.unquantizePaths=v;b.unquantizePoint=function(B,D,F,K,L){if(null==F)return D;D.x=q(B,F.x);D.y=e(B,F.y);D!==F&&(K&&(D.z=F.z),L&&(D.m=F.m));return D};b.unquantizePoints=w;b.unquantizePolygon=function(B,D,F,K,L){null!=F&&(D.rings=x(B,F.rings,K,L));return D};b.unquantizePolyline=function(B,D,F,K,L){null!=F&&(D.paths=v(B,F.paths,K,L));return D};b.unquantizeRings=x;b.unquantizeX=q;b.unquantizeY=e;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/dehydratedFeatureComparison":function(){define(["exports",
"../../core/has","../../geometry/support/spatialReferenceUtils"],function(b,a,c){function d(q,e){if(q===e)return!0;if(null==q||null==e||q.length!==e.length)return!1;for(let m=0;m<q.length;m++){const l=q[m],w=e[m];if(l.length!==w.length)return!1;for(let v=0;v<l.length;v++)if(l[v]!==w[v])return!1}return!0}function f(q,e){if(q===e)return!0;if(null==q||null==e||q.length!==e.length)return!1;for(let m=0;m<q.length;m++)if(!d(q[m],e[m]))return!1;return!0}function n(q,e){return q===e||null!=q&&null!=e&&c.equals(q.spatialReference,
e.spatialReference)&&q.x===e.x&&q.y===e.y&&q.z===e.z&&q.m===e.m}function k(q,e){if(q===e)return!0;if(null==q||null==e||q.type!==e.type)return!1;switch(q.type){case "point":return n(q,e);case "extent":return q=q.hasZ!==e.hasZ||q.hasM!==e.hasM?!1:c.equals(q.spatialReference,e.spatialReference)?q.xmin===e.xmin&&q.ymin===e.ymin&&q.zmin===e.zmin&&q.xmax===e.xmax&&q.ymax===e.ymax&&q.zmax===e.zmax:!1,q;case "polyline":return q=q.hasZ!==e.hasZ||q.hasM!==e.hasM?!1:c.equals(q.spatialReference,e.spatialReference)?
f(q.paths,e.paths):!1,q;case "polygon":return q=q.hasZ!==e.hasZ||q.hasM!==e.hasM?!1:c.equals(q.spatialReference,e.spatialReference)?f(q.rings,e.rings):!1,q;case "multipoint":return q=q.hasZ!==e.hasZ||q.hasM!==e.hasM?!1:c.equals(q.spatialReference,e.spatialReference)?d(q.points,e.points):!1,q;case "mesh":return!1}}function g(q,e){if(q===e)return!0;if(!q||!e)return!1;const m=Object.keys(q),l=Object.keys(e);if(m.length!==l.length)return!1;for(const w of m)if(q[w]!==e[w])return!1;return!0}b.equals=function(q,
e){return q===e?!0:null!=q&&null!=e&&q.objectId===e.objectId&&k(q.geometry,e.geometry)&&g(q.attributes,e.attributes)?!0:!1};b.pointEquals=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DSymbolCreationContext":function(){define(["exports"],function(b){class a{constructor(d,f){this.scheduler=d;this.schedule=f;this.featureExpressionInfoContext=this.localOriginFactory=this.graphicsCoreOwner=this.drapeSourceRenderer=this.layer=this.overlaySR=this.renderCoordsHelper=
this.clippingExtent=this.stage=this.renderer=this.elevationProvider=this.streamDataRequester=this.sharedResources=null;this.screenSizePerspectiveEnabled=!0;this.isAsync=this.skipHighSymbolLods=this.physicalBasedRenderingEnabled=this.slicePlaneEnabled=!1}}class c{constructor(){this.renderPriority=0;this.renderPriorityStep=1;this.ignoreDrivers=!1}}b.Graphics3DSymbolCreationContext=a;b.Graphics3DSymbolLayerCreationContext=c;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayerFactory":function(){define("exports ../../../../core/Logger ./Graphics3DExtrudeSymbolLayer ./Graphics3DIconSymbolLayer ./Graphics3DLineSymbolLayer ./Graphics3DMeshFillSymbolLayer ./Graphics3DObjectSymbolLayer ./Graphics3DPathSymbolLayer ./Graphics3DPolygonFillSymbolLayer ./Graphics3DTextSymbolLayer ./Graphics3DWaterSymbolLayer".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m){const l={icon:d.Graphics3DIconSymbolLayer,object:k.Graphics3DObjectSymbolLayer,line:f.Graphics3DLineSymbolLayer,path:g.Graphics3DPathSymbolLayer,fill:q.Graphics3DPolygonFillSymbolLayer,extrude:c.Graphics3DExtrudeSymbolLayer,text:e.Graphics3DTextSymbolLayer,water:m.Graphics3DWaterSymbolLayer},w={"mesh-3d":{fill:n.Graphics3DMeshFillSymbolLayer}};b.make=function(v,x,p,h){const t=w[v.type]?.[x.type]||l[x.type];return t?new t(v,x,p,h):(a.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory").error("GraphicsLayerFactory#make",
`unknown symbol type ${x.type}`),null)};b.setSymbolClass=function(v,x){l[v]=x};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DExtrudeSymbolLayer":function(){define("exports ../../../../core/has ../../../../core/Error ../../../../core/lang ../../../../core/unitUtils ../../../../chunks/earcut ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection/computeTranslationToOriginAndRotation ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/DoubleArray ../../../../geometry/support/Indices ../../../../chunks/vec32 ../../../../layers/graphics/data/SnappingCandidate ../../../../renderers/support/renderingInfoUtils ../../../ViewingMode ./elevationAlignmentUtils ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./interfaces ./polygonUtils ../support/edgeUtils ../../support/debugFlags ../../support/ElevationProvider ../../support/renderInfoUtils/polygon ../../webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/ContentObjectType ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryWithMapPositions ../../webgl-engine/lib/Normals ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A,C,E,B,D,F,K,L,G,O,P,J,R,X,U,M,V,Y){function W(ra,ta,ma,pa,ja,qa){const ua=p.getZeroIndexArray(ta.length);ta=[[V.VertexAttribute.POSITION,new O.Attribute(pa.positions,ta,3,!0)],[V.VertexAttribute.NORMALCOMPRESSED,new O.Attribute(pa.normals,ta,2,!0)],[V.VertexAttribute.COLOR,new O.Attribute(ja,ua,4,!0)]];return new R.Geometry(ra,ta,pa.elevation,J.ContentObjectType.Mesh,qa,ma)}function H(ra,ta,ma,pa,ja,qa,ua,wa,za,Aa,Fa,Da,Ha){let Ka=0;var La=2*
pa.count,Na=pa.index,Ra=pa.count,Sa=ma.length/3,sa=La;m.copy(ea,Da);const va=0<Fa?1:-1;La=3*Na;let ya=0;Na=3*ya;let Ea=Ra;Da=3*Ea;for(let Ca=0;Ca<Ra;++Ca)Ha&&(ea[0]=ra[La],ea[1]=ra[La+1],ea[2]=ra[La+2],m.normalize(ea,ea)),ja[Na]=ra[La],ja[Na+1]=ra[La+1],ja[Na+2]=ra[La+2],qa[Na]=ta[La],qa[Na+1]=ta[La+1],qa[Na+2]=ta[La+2],ua[Na]=-va*ea[0],ua[Na+1]=-va*ea[1],ua[Na+2]=-va*ea[2],wa[ya]=0,ja[Da]=ra[La]+Fa*ea[0],ja[Da+1]=ra[La+1]+Fa*ea[1],ja[Da+2]=ra[La+2]+Fa*ea[2],qa[Da]=ta[La],qa[Da+1]=ta[La+1],qa[Da+
2]=ta[La+2],ua[Da]=va*ea[0],ua[Da+1]=va*ea[1],ua[Da+2]=va*ea[2],wa[Ea]=Fa,Na+=3,Da+=3,La+=3,ya+=1,Ea+=1;Na=La=0;Da=3*sa;ra=0>Fa?la:ia;ta=0>Fa?ia:la;for(Ha=0;Ha<Sa;++Ha)Aa[Na]=ma[La+ra[0]],Aa[Na+1]=ma[La+ra[1]],Aa[Na+2]=ma[La+ra[2]],za[Da]=ma[La+ta[0]]+Ra,za[Da+1]=ma[La+ta[1]]+Ra,za[Da+2]=ma[La+ta[2]]+Ra,Na+=3,Da+=3,La+=3;ma=2*pa.count;La=0;I(ja,qa,wa,ua,Ka,pa.pathLengths[0],pa.count,ma,za,La,Fa);ma+=4*pa.pathLengths[0];La+=2*pa.pathLengths[0];Ka+=pa.pathLengths[0];for(Aa=1;Aa<pa.pathLengths.length;++Aa)I(ja,
qa,wa,ua,Ka,pa.pathLengths[Aa],pa.count,ma,za,La,Fa),ma+=4*pa.pathLengths[Aa],La+=2*pa.pathLengths[Aa],Ka+=pa.pathLengths[Aa]}function S(ra,ta,ma,pa,ja,qa,ua){pa[qa]=pa[ua];ua*=3;qa*=3;ra[qa]=ra[ua];ra[qa+1]=ra[ua+1];ra[qa+2]=ra[ua+2];ta[qa]=ta[ua];ta[qa+1]=ta[ua+1];ta[qa+2]=ta[ua+2];ma[qa]=ja[0];ma[qa+1]=ja[1];ma[qa+2]=ja[2]}function I(ra,ta,ma,pa,ja,qa,ua,wa,za,Aa,Fa){let Da=ja,Ha=ja+1,Ka=ja+ua,La=ja+ua+1,Na=wa,Ra=wa+1,Sa=wa+2*qa;wa=wa+2*qa+1;0>Fa&&(Da=ja+ua+1,La=ja);Aa*=3;for(let Ga=0;Ga<qa;++Ga){Ga===
qa-1&&(0<Fa?(Ha=ja,La=ja+ua):(Ha=ja,Da=ja+ua));var sa=ra,va=Da,ya=Ha,Ea=Ka,Ca=T;va*=3;ya*=3;Ea*=3;m.set(aa,sa[va++],sa[va++],sa[va++]);m.set(Z,sa[ya++],sa[ya++],sa[ya++]);m.set(da,sa[Ea++],sa[Ea++],sa[Ea++]);m.subtract(fa,Z,aa);m.subtract(ka,da,aa);m.cross(Ca,ka,fa);m.normalize(Ca,Ca);S(ra,ta,pa,ma,T,Na,Da);S(ra,ta,pa,ma,T,Ra,Ha);S(ra,ta,pa,ma,T,Sa,Ka);S(ra,ta,pa,ma,T,wa,La);za[Aa++]=Na;za[Aa++]=Sa;za[Aa++]=wa;za[Aa++]=Na;za[Aa++]=wa;za[Aa++]=Ra;Da++;Ha++;Ka++;La++;Na+=2;Ra+=2;Sa+=2;wa+=2}}const Q=
["polygon","extent"];class N extends A.Graphics3DSymbolLayer{constructor(ra,ta,ma,pa){super(ra,ta,ma,pa);this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){var ra=C.validateSymbolLayerSize(this._getSymbolSize());if(ra)throw new c("graphics3dextrudesymbollayer:invalid-size",ra);}var ta=this._getCombinedOpacityAndColor(this.symbolLayer?.material?.color);ra=l.fromArray(ta);ta=ta[3];const ma=1>ta||this.needsDrivenTransparentPass;ra={usePBR:this._context.physicalBasedRenderingEnabled,
isSchematic:!0,diffuse:ra,ambient:ra,opacity:ta,transparent:ma,cullFace:ma?P.CullFaceOptions.None:P.CullFaceOptions.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0,normalType:G.NormalType.Compressed};this._materials[oa.Main]=new Y.DefaultMaterial(ra);this._materials[oa.Bottom]=new Y.DefaultMaterial({...ra,cullFace:P.CullFaceOptions.Back});this._context.stage.addMany(this._materials)}destroy(){super.destroy();
this._context.stage.removeMany(this._materials);this._materials.length=0}createGraphics3DGraphic(ra){const ta=ra.graphic;if(!this._validateGeometry(ta.geometry,Q,this.symbolLayer.type))return null;const ma=this._getVertexOpacityAndColor(ra.renderingInfo,255),pa=this.setGraphicElevationContext(ta);return this._createAs3DShape(ta,ra.renderingInfo,ma,pa,ta.uid)}layerOpacityChanged(ra,ta){const ma=this._getCombinedOpacity(this.symbolLayer?.material?.color),pa=1>ma||this.needsDrivenTransparentPass;this._materials[oa.Main]?.setParameters({opacity:ma,
transparent:pa});this._materials[oa.Bottom]?.setParameters({opacity:ma,transparent:pa});const ja=this._getLayerOpacity();ra.forEach(qa=>{qa=ta(qa);null!=qa&&qa.layerOpacityChanged(ja,this._context.isAsync)})}layerElevationInfoChanged(ra,ta){return this.updateGraphics3DGraphicElevationInfo(ra,ta,y.needsElevationUpdates3D)}slicePlaneEnabledChanged(ra,ta){this._materials[oa.Main]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});this._materials[oa.Bottom]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});
ra.forEach(ma=>{ma=ta(ma);null!=ma&&ma.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)});return!0}physicalBasedRenderingChanged(){const ra={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0};this._materials[oa.Main]?.setParameters(ra);this._materials[oa.Bottom]?.setParameters(ra);return!0}_getExtrusionSize(ra){ra=ra.size&&this._drivenProperties.size?r.getDriverAxisSizeValue(ra.size,2)??0:this._getSymbolSize();return ra/=this._context.renderCoordsHelper.unitInMeters}applyRendererDiff(ra,
ta){return this._drivenPropertiesChanged(ta)?E.ApplyRendererDiffResult.RecreateSymbol:E.ApplyRendererDiffResult.RecreateGraphics}async queryForSnapping(ra,ta,ma,pa){ta=this._getExtrusionSize(ma)*this._context.renderCoordsHelper.unitInMeters/f.getMetersPerVerticalUnitForSR(ta);const {objectId:ja,target:qa}=ra;ma=d.clone(qa);ma.z=(ma.z??0)+ta;switch(ra.type){case "edge":const {start:ua,end:wa}=ra;ra=d.clone(ua);pa=d.clone(wa);ra.z=(ra.z??0)+ta;pa.z=(pa.z??0)+ta;return[t.makeEdgeCandidate(ja,ma,Infinity,
ra,pa)];case "vertex":return[t.makeVertexCandidate(ja,ma,Infinity),t.makeEdgeCandidate(ja,qa,Infinity,qa,ma)];default:return[]}}_getSymbolSize(){return this.symbolLayer.size??1}_createAs3DShape(ra,ta,ma,pa,ja){var qa=B.geometryAsPolygon(ra.geometry);if(null==qa)return null;if(0===qa.rings.length||!qa.rings.some(ya=>0<ya.length))return this._logGeometryValidationWarnings(qa.rings,"rings","ExtrudeSymbol3DLayer"),null;ra=L.geometryToRenderInfo(qa,this._context.elevationProvider,this._context.renderCoordsHelper,
pa);this._logGeometryCreationWarnings(ra,qa.rings,"rings","ExtrudeSymbol3DLayer");var ua=C.computeCentroid(qa);if(null==ua)return null;var wa=[];const za=[],Aa=v.create(),Fa=e.create(),Da=l.create(),Ha=this._context.renderCoordsHelper.viewingMode===u.ViewingMode.Global;Ha||this._context.renderCoordsHelper.worldUpAtPosition(null,Da);w.computeTranslationToOriginAndRotation(qa.spatialReference,[ua.x,ua.y,0],Fa,this._context.renderCoordsHelper.spatialReference);qa=e.create();q.invert(qa,Fa);ua=g.create();
k.normalFromMat4(ua,qa);const {polygons:Ka,mapPositions:La,position:Na}=ra;for(const ya of Ka){ua=ya.count;if(this._context.clippingExtent&&(v.empty(Aa),v.expandWithBuffer(Aa,ya.mapPositions),!v.intersectsClippingArea(Aa,this._context.clippingExtent)))continue;var Ra=n.earcut(ya.mapPositions,ya.holeIndices,3);if(0===Ra.length)continue;var Sa=Ra.length,sa=6*ua;ua=p.newIndexArray(sa+Sa);Sa=p.newIndexArray(Sa);var va=x.newDoubleArray(3*sa);const Ea=x.newDoubleArray(3*sa),Ca=x.newDoubleArray(3*sa);sa=
x.newDoubleArray(sa);const Ga=this._getExtrusionSize(ta);H(Na,La,Ra,ya,va,Ca,Ea,sa,ua,Sa,Ga,Da,Ha);h.transformMat4(va,va,qa);Ra=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:ja,layerUid:this._context.layer.uid});va=new na(va,Ca,U.compressNormals(Ea),sa);wa.push(W(this._materials[oa.Main],ua,ua.length-Sa.length,va,ma,Ra),W(this._materials[oa.Bottom],Sa,0,va,ma,Ra));za.push(va.heights)}if(0===wa.length)return null;ta=new M.Object3D({geometries:wa,layerUid:this._context.layer.uid,
graphicUid:ja,isElevationSource:!0});ta.transformation=Fa;ma=D.createMaterial(this.symbolLayer,{opacity:this._getLayerOpacity()});wa=new z.Graphics3DObject3DGraphicLayer(this,ta,wa,null,null,(ya,Ea,Ca,Ga,Ja)=>{ya=ya.stageObject;const Ma=ya.geometries,Ta=Ma.length;Ea="absolute-height"!==Ea.mode;let Va=0;const Wa=ya.transformation,hb=q.invertOrIdentity(e.create(),Wa);for(let Ya=0;Ya<Ta;Ya+=2){const cb=Ma[Ya];if(!X.isGeometryWithMapPositions(cb))continue;const Xa=cb.getMutableAttribute(V.VertexAttribute.POSITION).data,
fb=za[Ya/2],Za=new K.SamplePosition(cb.mapPositions),bb=Xa.length/3;let Oa=0,$a=!1,db=0;for(let kb=0;kb<bb;kb++){ha[0]=Xa[Oa];ha[1]=Xa[Oa+1];ha[2]=Xa[Oa+2];Ga(Za,ca);Ea&&(db+=ca.sampledElevation);F.debugFlags.TESTS_DISABLE_OPTIMIZATIONS?(m.set(ba,Za.array[Za.offset],Za.array[Za.offset+1],ca.z+fb[Oa/3]),null!=Ca&&Ja.toRenderCoords(ba,Ca,ba)):(m.set(ba,Xa[Oa],Xa[Oa+1],Xa[Oa+2]),m.transformMat4(ba,ba,Wa),Ja.setAltitude(ba,ca.z+fb[Oa/3]));m.transformMat4(ba,ba,hb);Xa[Oa]=ba[0];Xa[Oa+1]=ba[1];Xa[Oa+2]=
ba[2];const ib=.01/Ja.unitInMeters;if(Math.abs(ha[0]-Xa[Oa])>=ib||Math.abs(ha[1]-Xa[Oa+1])>=ib||Math.abs(ha[2]-Xa[Oa+2])>=ib)$a=!0;Za.offset+=3;Oa+=3}$a&&(cb.invalidateBoundingInfo(),ya.geometryVertexAttributeUpdated(Ma[Ya],V.VertexAttribute.POSITION),Ma[Ya+1].invalidateBoundingInfo(),ya.geometryVertexAttributeUpdated(Ma[Ya+1],V.VertexAttribute.POSITION));Va+=db/bb}return Va/Ta},pa,null!=ma?{baseMaterial:this._materials[oa.Main],edgeMaterials:[ma],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:
null);wa.alignedSampledElevation=ra.sampledElevation;wa.needsElevationUpdates=y.needsElevationUpdates3D(pa.mode);return wa}}const T=l.create(),aa=l.create(),Z=l.create(),da=l.create(),fa=l.create(),ka=l.create(),ha=l.create(),ba=l.create(),ea=l.create(),ca=new y.SampleElevationInfo,ia=[0,2,1],la=[0,1,2];var oa;(function(ra){ra[ra.Main=0]="Main";ra[ra.Bottom=1]="Bottom"})(oa||(oa={}));class na{constructor(ra,ta,ma,pa){this.positions=ra;this.elevation=ta;this.normals=ma;this.heights=pa}}b.Graphics3DExtrudeSymbolLayer=
N;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/earcut":function(){define(["exports","./_commonjsHelpers"],function(b,a){var c={exports:{}};c.exports;(function(d){(function(f){f=f();void 0!==f&&(d.exports=f)})(function(){function f(B,D,F){F=F||2;var K=D&&D.length,L=K?D[0]*F:B.length,G=n(B,0,L,F,!0),O=[];if(!G||G.next===G.prev)return O;var P;if(K){var J=G;var R=F;G=[];var X;K=0;for(X=D.length;K<X;K++){var U=D[K]*R;var M=K<X-1?D[K+1]*R:B.length;U=n(B,U,M,R,!1);U===U.next&&
(U.steiner=!0);M=G;var V=M.push,Y=U,W=U;do{if(Y.x<W.x||Y.x===W.x&&Y.y<W.y)W=Y;Y=Y.next}while(Y!==U);V.call(M,W)}G.sort(e);for(K=0;K<G.length;K++)R=G[K],D=J,(J=l(R,D))?(X=y(J,R),R=k(J,J.next),X=m(X),k(X,X.next),R=m(R),J=m(D===J?R:D)):J=D,J=k(J,J.next);G=J}if(B.length>80*F){var H=P=B[0];var S=K=B[1];for(R=F;R<L;R+=F)D=B[R],J=B[R+1],D<H&&(H=D),J<S&&(S=J),D>P&&(P=D),J>K&&(K=J);P=Math.max(P-H,K-S);P=0!==P?1/P:0}g(G,O,F,H,S,P);return O}function n(B,D,F,K,L){if(L===0<E(B,D,F,K))for(L=D;L<F;L+=K)var G=z(L,
B[L],B[L+1],G);else for(L=F-K;L>=D;L-=K)G=z(L,B[L],B[L+1],G);G&&p(G,G.next)&&(B=G.next,A(G),G=B);return G}function k(B,D){if(!B)return B;D||(D=B);do{var F=!1;if(B.steiner||!p(B,B.next)&&0!==x(B.prev,B,B.next))B=B.next;else{D=B.prev;A(B);B=D;if(B===B.next)break;F=!0}}while(F||B!==D);return D}function g(B,D,F,K,L,G,O){if(B){if(!O&&G){var P=B,J=P;do null===J.z&&(J.z=w(J.x,J.y,K,L,G)),J.prevZ=J.prev,J=J.nextZ=J.next;while(J!==P);J.prevZ.nextZ=null;J.prevZ=null;P=J;var R,X,U,M,V=1;do{J=P;var Y=P=null;
for(X=0;J;){X++;var W=J;for(R=U=0;R<V&&(U++,W=W.nextZ,W);R++);for(M=V;0<U||0<M&&W;)0!==U&&(0===M||!W||J.z<=W.z)?(R=J,J=J.nextZ,U--):(R=W,W=W.nextZ,M--),Y?Y.nextZ=R:P=R,R.prevZ=Y,Y=R;J=W}Y.nextZ=null;V*=2}while(1<X)}for(P=B;B.prev!==B.next;){J=B.prev;W=B.next;if(G)Y=q(B,K,L,G);else a:if(Y=B,X=Y.prev,U=Y,V=Y.next,0<=x(X,U,V))Y=!1;else{for(R=Y.next.next;R!==Y.prev;){if(v(X.x,X.y,U.x,U.y,V.x,V.y,R.x,R.y)&&0<=x(R.prev,R,R.next)){Y=!1;break a}R=R.next}Y=!0}if(Y)D.push(J.i/F),D.push(B.i/F),D.push(W.i/F),
A(B),P=B=W.next;else if(B=W,B===P){if(!O)g(k(B),D,F,K,L,G,1);else if(1===O){B=k(B);O=D;P=F;J=B;do W=J.prev,Y=J.next.next,!p(W,Y)&&h(W,J,J.next,Y)&&u(W,Y)&&u(Y,W)&&(O.push(W.i/P),O.push(J.i/P),O.push(Y.i/P),A(J),A(J.next),J=B=Y),J=J.next;while(J!==B);B=k(J);g(B,D,F,K,L,G,2)}else if(2===O)a:{O=B;do{for(P=O.next.next;P!==O.prev;){if(J=O.i!==P.i){Y=Y=Y=Y=void 0;J=O;W=P;if(Y=J.next.i!==W.i&&J.prev.i!==W.i){b:{Y=J;do{if(Y.i!==J.i&&Y.next.i!==J.i&&Y.i!==W.i&&Y.next.i!==W.i&&h(Y,Y.next,J,W)){Y=!0;break b}Y=
Y.next}while(Y!==J);Y=!1}Y=!Y}if(Y){if(Y=u(J,W)&&u(W,J)){Y=J;X=!1;U=(J.x+W.x)/2;V=(J.y+W.y)/2;do Y.y>V!==Y.next.y>V&&Y.next.y!==Y.y&&U<(Y.next.x-Y.x)*(V-Y.y)/(Y.next.y-Y.y)+Y.x&&(X=!X),Y=Y.next;while(Y!==J);Y=X}Y=Y&&(x(J.prev,J,W.prev)||x(J,W.prev,W))||p(J,W)&&0<x(J.prev,J,J.next)&&0<x(W.prev,W,W.next)}J=Y}if(J){B=y(O,P);O=k(O,O.next);B=k(B,B.next);g(O,D,F,K,L,G);g(B,D,F,K,L,G);break a}P=P.next}O=O.next}while(O!==B)}break}}}}function q(B,D,F,K){var L=B.prev,G=B.next;if(0<=x(L,B,G))return!1;var O=
L.x>B.x?L.x>G.x?L.x:G.x:B.x>G.x?B.x:G.x,P=L.y>B.y?L.y>G.y?L.y:G.y:B.y>G.y?B.y:G.y,J=w(L.x<B.x?L.x<G.x?L.x:G.x:B.x<G.x?B.x:G.x,L.y<B.y?L.y<G.y?L.y:G.y:B.y<G.y?B.y:G.y,D,F,K);D=w(O,P,D,F,K);F=B.prevZ;for(K=B.nextZ;F&&F.z>=J&&K&&K.z<=D;){if(F!==B.prev&&F!==B.next&&v(L.x,L.y,B.x,B.y,G.x,G.y,F.x,F.y)&&0<=x(F.prev,F,F.next))return!1;F=F.prevZ;if(K!==B.prev&&K!==B.next&&v(L.x,L.y,B.x,B.y,G.x,G.y,K.x,K.y)&&0<=x(K.prev,K,K.next))return!1;K=K.nextZ}for(;F&&F.z>=J;){if(F!==B.prev&&F!==B.next&&v(L.x,L.y,B.x,
B.y,G.x,G.y,F.x,F.y)&&0<=x(F.prev,F,F.next))return!1;F=F.prevZ}for(;K&&K.z<=D;){if(K!==B.prev&&K!==B.next&&v(L.x,L.y,B.x,B.y,G.x,G.y,K.x,K.y)&&0<=x(K.prev,K,K.next))return!1;K=K.nextZ}return!0}function e(B,D){return B.x-D.x}function m(B){if(B.next.prev===B)return B;let D=B;do{const F=D.next;if(F.prev===D||F===D||F===B)break;D=F}while(1);return D}function l(B,D){var F=D,K=B.x,L=B.y,G=-Infinity;do{if(L<=F.y&&L>=F.next.y&&F.next.y!==F.y){var O=F.x+(L-F.y)*(F.next.x-F.x)/(F.next.y-F.y);if(O<=K&&O>G){G=
O;if(O===K){if(L===F.y)return F;if(L===F.next.y)return F.next}var P=F.x<F.next.x?F:F.next}}F=F.next}while(F!==D);if(!P)return null;if(K===G)return P;D=P;O=P.x;var J=P.y,R=Infinity;F=P;do{if(K>=F.x&&F.x>=O&&K!==F.x&&v(L<J?K:G,L,O,J,L<J?G:K,L,F.x,F.y)){var X=Math.abs(L-F.y)/(K-F.x);var U;if((U=u(F,B))&&!(U=X<R)&&(U=X===R)&&!(U=F.x>P.x)&&(U=F.x===P.x)){U=P;var M=F;U=0>x(U.prev,U,M.prev)&&0>x(M.next,U,U.next)}U&&(P=F,R=X)}F=F.next}while(F!==D);return P}function w(B,D,F,K,L){B=32767*(B-F)*L;D=32767*(D-
K)*L;B=(B|B<<8)&16711935;B=(B|B<<4)&252645135;B=(B|B<<2)&858993459;D=(D|D<<8)&16711935;D=(D|D<<4)&252645135;D=(D|D<<2)&858993459;return(B|B<<1)&1431655765|((D|D<<1)&1431655765)<<1}function v(B,D,F,K,L,G,O,P){return 0<=(L-O)*(D-P)-(B-O)*(G-P)&&0<=(B-O)*(K-P)-(F-O)*(D-P)&&0<=(F-O)*(G-P)-(L-O)*(K-P)}function x(B,D,F){return(D.y-B.y)*(F.x-D.x)-(D.x-B.x)*(F.y-D.y)}function p(B,D){return B.x===D.x&&B.y===D.y}function h(B,D,F,K){var L=r(x(B,D,F)),G=r(x(B,D,K)),O=r(x(F,K,B)),P=r(x(F,K,D));return L!==G&&O!==
P||0===L&&t(B,F,D)||0===G&&t(B,K,D)||0===O&&t(F,B,K)||0===P&&t(F,D,K)?!0:!1}function t(B,D,F){return D.x<=Math.max(B.x,F.x)&&D.x>=Math.min(B.x,F.x)&&D.y<=Math.max(B.y,F.y)&&D.y>=Math.min(B.y,F.y)}function r(B){return 0<B?1:0>B?-1:0}function u(B,D){return 0>x(B.prev,B,B.next)?0<=x(B,D,B.next)&&0<=x(B,B.prev,D):0>x(B,D,B.prev)||0>x(B,B.next,D)}function y(B,D){var F=new C(B.i,B.x,B.y),K=new C(D.i,D.x,D.y),L=B.next,G=D.prev;B.next=D;D.prev=B;F.next=L;L.prev=F;K.next=F;F.prev=K;G.next=K;K.prev=G;return K}
function z(B,D,F,K){B=new C(B,D,F);K?(B.next=K.next,B.prev=K,K.next.prev=B,K.next=B):(B.prev=B,B.next=B);return B}function A(B){B.next.prev=B.prev;B.prev.next=B.next;B.prevZ&&(B.prevZ.nextZ=B.nextZ);B.nextZ&&(B.nextZ.prevZ=B.prevZ)}function C(B,D,F){this.i=B;this.x=D;this.y=F;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}function E(B,D,F,K){for(var L=0,G=F-K;D<F;D+=K)L+=(B[G]-B[D])*(B[D+1]+B[G+1]),G=D;return L}f.deviation=function(B,D,F,K){var L=D&&D.length,G=Math.abs(E(B,
0,L?D[0]*F:B.length,F));if(L){L=0;for(var O=D.length;L<O;L++)G-=Math.abs(E(B,D[L]*F,L<O-1?D[L+1]*F:B.length,F))}for(L=D=0;L<K.length;L+=3){O=K[L]*F;var P=K[L+1]*F,J=K[L+2]*F;D+=Math.abs((B[O]-B[J])*(B[P+1]-B[O+1])-(B[O]-B[P])*(B[J+1]-B[O+1]))}return 0===G&&0===D?0:Math.abs((D-G)/G)};f.flatten=function(B){for(var D=B[0][0].length,F={vertices:[],holes:[],dimensions:D},K=0,L=0;L<B.length;L++){for(var G=0;G<B[L].length;G++)for(var O=0;O<D;O++)F.vertices.push(B[L][G][O]);0<L&&(K+=B[L-1].length,F.holes.push(K))}return F};
return f})})(c);a=a.getDefaultExportFromCjs(c.exports);b.earcut=a})},"esri/layers/graphics/data/SnappingCandidate":function(){define(["exports"],function(b){b.makeEdgeCandidate=function(a,c,d,f,n,k=!1){return{objectId:a,target:c,distance:d,type:"edge",start:f,end:n,draped:k}};b.makeVertexCandidate=function(a,c,d){return{objectId:a,target:c,distance:d,type:"vertex"}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/support/renderingInfoUtils":function(){define(["exports",
"../../Color","../visualVariables/support/visualVariableUtils"],function(b,a,c){function d(n,k){if(!n||n.symbol)return null;k=k?.renderer;return n&&null!=k&&k.getObservationRenderer?k.getObservationRenderer(n):k}async function f(n,k){if(null!=n.symbol)return n.symbol;const g=d(n,k);return null!=g?g.getSymbolAsync(n,k):null}b.getDriverAxisSizeValue=function(n,k=0){n=n[k];return"number"===typeof n&&isFinite(n)?n:null};b.getDriverAxisSizeValueAny=function(n){for(let k=0;3>k;k++){const g=n[k];if("number"===
typeof g)return isFinite(g)?g:0}return 0};b.getRenderer=d;b.getRenderingInfo=function(n,k){const g=d(n,k);if(null!=n.symbol)var q=n.symbol;else q=d(n,k),q=null!=q&&"dot-density"!==q.type?q.getSymbol(n,k):null;if(null==q)return null;q={renderer:g,symbol:q};if(!(null!=g&&"visualVariables"in g&&g.visualVariables))return q;k=c.getVisualVariableValues(g,n,k)??[];n=["proportional","proportional","proportional"];for(const {variable:e,value:m}of k)switch(e.type){case "color":q.color=m.toRgba();break;case "size":if("outline"===
e.target)q.outlineSize=m;else switch(k=e.useSymbolValue?"symbol-value":m,e.axis){case "width":n[0]=k;break;case "depth":n[1]=k;break;case "height":n[2]=k;break;case "width-and-depth":n[0]=n[1]=k;break;default:n[0]=n[1]=n[2]=k}break;case "opacity":q.opacity=m;break;case "rotation":switch(e.axis){case "tilt":q.tilt=m;break;case "roll":q.roll=m;break;default:q.heading=m}}if("proportional"!==n[0]||"proportional"!==n[1]||"proportional"!==n[2])q.size=n;return q};b.getRenderingInfoAsync=async function(n,
k){var g=d(n,k),q=await f(n,k);if(!q)return null;q={renderer:g,symbol:q};if(!(g&&"visualVariables"in g&&g.visualVariables))return q;k=c.getVisualVariableValues(g,n,k)??[];n=["proportional","proportional","proportional"];for(const {variable:e,value:m}of k)"color"===e.type?q.color=a.toUnitRGBA(m):"size"===e.type?"outline"===e.target?q.outlineSize=m:(k=e.axis,g=e.useSymbolValue?"symbol-value":m,"width"===k?n[0]=g:"depth"===k?n[1]=g:"height"===k?n[2]=g:n[0]="width-and-depth"===k?n[1]=g:n[1]=n[2]=g):"opacity"===
e.type?q.opacity=m:"rotation"===e.type&&"tilt"===e.axis?q.tilt=m:"rotation"===e.type&&"roll"===e.axis?q.roll=m:"rotation"===e.type&&(q.heading=m);if(isFinite(n[0])||isFinite(n[1])||isFinite(n[2]))q.size=n;return q};b.getSymbolAsync=f;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/polygonUtils":function(){define("exports ../../../../geometry ../../../../core/mathUtils ../../../../core/unitUtils ../../../../chunks/earcut ../../../../chunks/vec3 ../../../../geometry/support/Axis ../../../../geometry/support/Indices ../../../../geometry/support/plane ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/ContentObjectType ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/VertexAttribute ../../../../geometry/Extent ../../../../geometry/Polygon".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x){function p(u,y,z,A){const C=Array.isArray(y[0])?(B,D)=>y[B][D]:(B,D)=>y[3*B+D],E=A?d.getMetersPerUnitForSR(A)/d.getMetersPerVerticalUnitForSR(A):1;return q.fromManyPoints(u,(B,D)=>n.set(B,C(D,0)*E,C(D,1)*E,C(D,2)),z)}function h(u,y,z){u=p(t,u,y,z)?q.normal(t):[0,0,1];return Math.abs(u[2])>Math.cos(c.deg2rad(80))?k.Axis.Z:Math.abs(u[1])>Math.abs(u[0])?k.Axis.Y:k.Axis.X}const t=q.create();class r{constructor(u,y,z){this.renderData=u;this.layerUid=y;this.graphicUid=
z;this.outGeometries=[]}}b.PolygonCreationDataBase=r;b.createColorGeometry=function(u){const y=[[w.VertexAttribute.POSITION,new e.Attribute(u.attributeData.position,u.indices,3,!0)]],z=g.getZeroIndexArray(u.indices.length);null!=u.attributeData.colorFeature?y.push([w.VertexAttribute.COLORFEATUREATTRIBUTE,new e.Attribute([u.attributeData.colorFeature],z,1,!0)]):u.attributeData.color&&y.push([w.VertexAttribute.COLOR,new e.Attribute(u.attributeData.color,z,4,!0)]);u.attributeData.uvMapSpace&&y.push([w.VertexAttribute.UVMAPSPACE,
new e.Attribute(u.attributeData.uvMapSpace,u.indices,4,!0)]);u.attributeData.boundingRect&&y.push([w.VertexAttribute.BOUNDINGRECT,new e.Attribute(u.attributeData.boundingRect,u.indices,9,!0)]);return new l.Geometry(u.material,y,u.mapPositions,m.ContentObjectType.Mesh,u.attributeData.objectAndLayerIdColor)};b.createIndices3D=function(u,y,z){z=h(u,(0<y.length?y[0]:u.length/3)-1,z);if(z!==k.Axis.Z){u=u.slice();for(let A=0;A<u.length;A+=3)u[A+z]=u[A+2]}return f.earcut(u,y,3)};b.createWaterGeometry=function(u,
y=null){const z=[[w.VertexAttribute.POSITION,new e.Attribute(u.attributeData.position,u.indices,3,!0)],[w.VertexAttribute.UV0,new e.Attribute(u.attributeData.uv0,u.indices,2,!0)]];return new l.Geometry(u.material,z,u.mapPositions,m.ContentObjectType.Mesh,y)};b.fitPlane=p;b.geometryAsPolygon=function(u){switch(u.type){case "extent":if(u instanceof v)return x.fromExtent(u);break;case "polygon":return u}return null};b.leastSignificantAxis=h;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/support/renderInfoUtils/polygon":function(){define("exports ../../../../geometry/projection/projectBuffer ../../../../geometry/support/DoubleArray ../../../../geometry/support/triangulationUtils ../../layers/graphics/elevationAlignmentUtils ../../terrain/OverlayRenderer".split(" "),function(b,a,c,d,f,n){function k(v,x,p=null){return v.filter(({count:h})=>1<h).map(({index:h,count:t})=>{const r=3*h,u=3*t;return null!=p?new e(h,t,c.doubleSubArray(x,r,u),c.doubleSubArray(p,r,u)):new q(h,
t,c.doubleSubArray(x,r,u))})}function g(v,x,p=null){const h=[];for(const {index:t,count:r,holeIndices:u,pathLengths:y}of v){if(1>=r)continue;v=3*t;const z=3*r,A=u.map(C=>C-t);v=null!=p?new m(t,r,c.doubleSubArray(x,3*t,3*r),c.doubleSubArray(p,v,z),A,y):new l(t,r,c.doubleSubArray(x,3*t,3*r),A,y);h.push(v)}return h}class q{constructor(v,x,p){this.index=v;this.count=x;this.position=p}}class e extends q{constructor(v,x,p,h){super(v,x,p);this.mapPositions=h}}class m extends e{constructor(v,x,p,h,t,r){super(v,
x,p,h);this.holeIndices=t;this.pathLengths=r}}class l extends q{constructor(v,x,p,h,t){super(v,x,p);this.holeIndices=h;this.pathLengths=t}}class w{constructor(v,x,p,h,t,r){this.position=v;this.mapPositions=x;this.polygons=p;this.outlines=h;this.projectionSuccess=t;this.sampledElevation=r}}b.PolygonRenderInfo=w;b.PolygonVertexData=m;b.PolygonVertexDataDraped=l;b.geometryToRenderInfo=function(v,x,p,h){const t=d.pathsToTriangulationInfo(v.rings,!!v.hasZ,d.CounterClockwiseMode.CCW_IS_HOLE,v.spatialReference),
r=c.newDoubleArray(t.position.length);v=f.applyPerVertexElevationAlignment(t.position,v.spatialReference,0,r,0,t.position,0,t.position.length/3,x,p,h);x=null!=v;return new w(t.position,r,g(t.polygons,t.position,r),k(t.outlines,t.position,r),x,v)};b.geometryToRenderInfoDraped=function(v,x){const p=d.pathsToTriangulationInfo(v.rings,!1,d.CounterClockwiseMode.CCW_IS_HOLE);v=a.projectBuffer(p.position,v.spatialReference,0,p.position,x,0,p.position.length/3);for(x=2;x<p.position.length;x+=3)p.position[x]=
n.drapedZ;return{position:p.position,polygons:g(p.polygons,p.position),outlines:k(p.outlines,p.position),projectionSuccess:v}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/triangulationUtils":function(){define("exports ../../chunks/earcut ./Axis ./coordsUtils ./DoubleArray ./Indices ./meshUtils/deduplicate ../../views/3d/layers/graphics/polygonUtils".split(" "),function(b,a,c,d,f,n,k,g){function q(w,v,x){if(1===w.length)return w[0];v=f.newDoubleArray(v);x=
Array(x);let p=0,h=0,t=0;for(const r of w){for(w=0;w<r.position.length;w++)v[p++]=r.position[w];for(const u of r.faces)x[h++]=u+t;t=p/3}return{position:v,faces:n.compactIndices(x)}}function e(w,v,x,p){const h=w.length,t=Array(h),r=Array(h),u=Array(h);let y=0,z=0,A=0;var C=0;for(var E=0;E<h;++E)C+=w[E].length;C=f.newDoubleArray(3*C);E=0;for(let K=h-1;0<=K;K--){var B=w[K],D=x===b.CounterClockwiseMode.CCW_IS_HOLE?l(B,v,p):!1;if(D&&1!==h)t[y++]=B;else{var F=B.length;for(let L=0;L<y;++L)F+=t[L].length;
F={index:E,pathLengths:Array(y+1),count:F,holeIndices:Array(y)};F.pathLengths[0]=B.length;0<B.length&&(u[A++]={index:E,count:B.length});E=D?m(B,B.length-1,-1,C,E,B.length,v):m(B,0,1,C,E,B.length,v);for(B=0;B<y;++B)D=t[B],F.holeIndices[B]=E,F.pathLengths[B+1]=D.length,0<D.length&&(u[A++]={index:E,count:D.length}),E=m(D,0,1,C,E,D.length,v);y=0;0<F.count&&(r[z++]=F)}}for(w=0;w<y;++w)x=t[w],0<x.length&&(u[A++]={index:E,count:x.length}),E=m(x,0,1,C,E,x.length,v);r.length=z;u.length=A;return{position:C,
polygons:r,outlines:u}}function m(w,v,x,p,h,t,r){h*=3;for(let u=0;u<t;++u){const y=w[v];p[h++]=y[0];p[h++]=y[1];p[h++]=r?y[2]:0;v+=x}return h/3}function l(w,v,x){if(v){v=g.leastSignificantAxis(w,w.length-1,x);if(v===c.Axis.X)return!d.isClockwise(w,c.Axis.Y,c.Axis.Z);if(v===c.Axis.Y)return!d.isClockwise(w,c.Axis.X,c.Axis.Z)}return!d.isClockwise(w,c.Axis.X,c.Axis.Y)}b.CounterClockwiseMode=void 0;(function(w){w[w.NONE=0]="NONE";w[w.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(b.CounterClockwiseMode||(b.CounterClockwiseMode=
{}));b.isCounterClockwise=l;b.pathsToTriangulationInfo=e;b.triangulate=function(w){w=e(w.rings,w.hasZ,b.CounterClockwiseMode.CCW_IS_HOLE,w.spatialReference);const v=[];let x=0,p=0;for(var h of w.polygons){const r=h.index,u=f.doubleSubArray(w.position,3*r,3*h.count);var t=h.holeIndices.map(y=>y-r);t=n.compactIndices(a.earcut(u,t,3));v.push({position:u,faces:t});x+=u.length;p+=t.length}h=q(v,x,p);w=Array.isArray(h.position)?k.deduplicate(h.position,3,{originalIndices:h.faces}):k.deduplicate(h.position.buffer,
6,{originalIndices:h.faces});h.position=f.doubleArrayFrom(new Float64Array(w.buffer));h.faces=w.indices;return h};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshUtils/deduplicate":function(){define(["exports","../../../core/mathUtils","../Indices"],function(b,a,c){let d=null;b.deduplicate=function(f,n,k){var g=Array.isArray(f),q=g?f.length/n:f.byteLength/(4*n),e=g?f:new Uint32Array(f,0,q*n),m=k?.minReduction??0;const l=(f=k?.originalIndices||null)?f.length:
0;var w=k?.componentOffsets||null;k=0;if(w)for(var v=0;v<w.length-1;v++){var x=w[v+1]-w[v];x>k&&(k=x)}else k=q;var p=Math.floor(1.1*k)+1;if(null==d||d.length<2*p)d=new Uint32Array(a.nextHighestPowerOfTwo(2*p));for(k=0;k<2*p;k++)d[k]=0;k=0;const h=(x=!!w&&!!f)?l:q;v=c.newIndexArray(q);var t=new Uint32Array(l),r=0!==m?Math.ceil(7.84*1.96/(m*m)*m*(1-m)):h,u=1,y=w?w[1]:h;for(let B=0;B<h;B++){if(B===r){var z=1-k/B;if(z+1.96*Math.sqrt(z*(1-z)/B)<m)return null;r*=2}if(B===y){for(y=0;y<2*p;y++)d[y]=0;if(f)for(y=
w[u-1];y<w[u];y++)t[y]=v[f[y]];y=w[++u]}z=x?f[B]:B;const D=z*n;var A=0;for(var C=0;C<n;C++)A=e[D+C]+A|0,A=A+(A<<11)+(A>>>2)|0;A>>>=0;C=A%p;let F=k;for(;0!==d[2*C+1];){if(d[2*C]===A){const K=d[2*C+1]-1;var E=K*n;a:{for(let L=0;L<n;L++)if(e[D+L]!==e[E+L]){E=!1;break a}E=!0}if(E){F=v[K];break}}C++;C>=p&&(C-=p)}F===k&&(d[2*C]=A,d[2*C+1]=z+1,k++);v[z]=F}if(0!==m&&1-k/q<m)return null;if(x){for(q=w[u-1];q<t.length;q++)t[q]=v[f[q]];v=c.compactIndices(t)}g=g?Array(k):new Uint32Array(k*n);k=0;for(r=0;r<h;r++)if(v[r]===
k){q=e;m=(x?f[r]:r)*n;w=g;p=k*n;t=n;for(u=0;u<t;u++)w[p+u]=q[m+u];k++}if(f&&!x){n=new Uint32Array(l);for(e=0;e<n.length;e++)n[e]=v[f[e]];v=c.compactIndices(n)}return{buffer:Array.isArray(g)?g:g.buffer,indices:v,uniqueCount:k}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/OverlayRenderer":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Evented ../../../core/MapUtils ../../../core/maybe ../../../core/PooledArray ../../../core/reactiveUtils ../../../core/SetUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat4 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../ViewingMode ../layers/interfaces ../support/debugFlags ./interfaces ./Overlay ./OverlayContent ./OverlayRenderTargets ../webgl-engine/core/FBOCache ../webgl-engine/core/shaderLibrary/ShaderOutput ../webgl-engine/core/shaderLibrary/terrain/Overlay.glsl ../../../chunks/TextureOnly.glsl ../webgl-engine/core/shaderTechnique/ShaderTechniqueRepository ../webgl-engine/effects/RenderPlugin ../webgl-engine/lib/Camera ../webgl-engine/lib/GLMaterialRepository ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/GridLocalOriginFactory ../webgl-engine/lib/Material ../webgl-engine/lib/RenderContext ../webgl-engine/lib/RenderSlot ../webgl-engine/lib/ShadowMap ../webgl-engine/lib/SortedRenderGeometryRenderer ../webgl-engine/lib/TextureTechnique ../webgl-engine/lib/TextureTechniqueConfiguration ../webgl-engine/lib/TransparencyPassType ../webgl-engine/lib/UpdatePolicy ../webgl-engine/lighting/Lightsources ../../../chunks/OverlayCompositing.glsl ../webgl-engine/shaders/OverlayCompositingTechnique ../../support/Scheduler ../../webgl/enums ../../webgl/Texture ../../webgl/TextureDescriptor".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A,C,E,B,D,F,K,L,G,O,P,J,R,X,U,M,V,Y,W,H,S,I,Q,N,T,aa,Z){b.OverlayRenderer=class extends K.SyncRenderPlugin{get _bindParameters(){return this._renderContext.bindParameters}get _rctx(){return this.view._stage.renderView.renderingContext}get rctx(){return this._rctx}get materialRepository(){return this._materialRepository}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}constructor(ha){super(ha);
this._renderTargets=this._overlays=null;this._overlayParameters=new I.OverlayCompositingPassParameters;this._hasWater=this._rendersOccluded=this.hasHighlights=!1;this._renderers=new Map;this._sortedDrapeSourceRenderersDirty=!1;this._sortedRenderers=new n;this._passParameters=new D.TextureOnlyPassParameters;this._materialRepository=null;this._screenToWorldRatio=1;this._localOriginFactory=null;this.unloadedMemory=0;this.ignoresMemoryFactor=!1;this._camera=new L.Camera;this.worldToPCSRatio=1;this.events=
new c;this.longitudeCyclical=null;this.produces=new Map([[X.RenderSlot.DRAPED_MATERIAL,ba=>ba!==E.ShaderOutput.Highlight||this.hasHighlights],[X.RenderSlot.DRAPED_WATER,()=>!0]]);this._hasDrapedRasterSource=this._hasDrapedFeatureSource=this._hasTargetWithoutRasterImage=!1}initialize(){const ha=this.view._stage.renderer.fboCache,ba=this.view._stage.renderView,{waterTextureRepository:ea,stippleTextureRepository:ca,markerTextureRepository:ia}=ba;this._shaderTechniqueRepository=new F.ShaderTechniqueRepository({rctx:this._rctx,
viewingMode:h.ViewingMode.Local,stippleTextureRepository:ca,markerTextureRepository:ia,waterTextureRepository:ea});this._renderContext=new R.OverlayRenderContext(this._rctx,new U.ShadowMap(ha,this.view.state.viewingMode),null);this.addHandles([k.watch(()=>ea.updating,()=>this.events.emit("content-changed"),k.syncAndInitial),k.watch(()=>this.spatialReference,la=>this._localOriginFactory=new P.GridLocalOriginFactory(la),k.syncAndInitial),k.on(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=
!0)]);this._materialRepository=new G.GLMaterialRepository(ba.textureRepository,this._shaderTechniqueRepository,la=>{0<(la.parameters.renderOccluded&ka)!==this._rendersOccluded&&this._updateRendersOccluded();this.events.emit("content-changed");this.notifyChange("updating");this.notifyChange("isEmpty")},()=>this.events.emit("content-changed"));this._bindParameters.slot=X.RenderSlot.DRAPED_MATERIAL;this._bindParameters.mainDepth=O.createEmptyDepthTexture(this._rctx);this._camera.near=1;this._camera.far=
1E4;this._camera.relativeElevation=null;this._bindParameters.camera=this._camera;this._bindParameters.transparencyPassType=W.TransparencyPassType.NONE;this._bindParameters.newLighting.noonFactor=0;this._bindParameters.newLighting.globalFactor=0;this._bindParameters.newLighting.set([new S.AmbientLight(p.fromValues(1,1,1))]);this.addHandles(this.view.resourceController.scheduler.registerTask(N.TaskPriority.STAGE,this))}destroy(){this._renderers.forEach(ha=>ha.destroy());this._renderers.clear();this._debugTextureTechnique=
f.releaseMaybe(this._debugTextureTechnique);this._passParameters.texture=f.disposeMaybe(this._passParameters.texture);this._bindParameters.mainDepth=f.disposeMaybe(this._bindParameters.mainDepth);this._shaderTechniqueRepository=f.destroyMaybe(this._shaderTechniqueRepository);this.disposeOverlays()}initializeRenderContext(ha){this.pluginContext=ha}uninitializeRenderContext(){}renderNode(){}get updating(){return this._sortedDrapeSourceRenderersDirty||d.someMap(this._renderers,ha=>ha.updating)}get hasOverlays(){return null!=
this._overlays&&null!=this._renderTargets}getMemoryForMaterial(ha){return Array.from(this._renderers.values()).reduce((ba,ea)=>ba+ea.getMemoryForMaterial(ha),0)}createGeometryDrapeSourceRenderer(ha){return this.createDrapeSourceRenderer(ha,M.SortedRenderGeometryRenderer)}createDrapeSourceRenderer(ha,ba,ea){const ca=this._renderers.get(ha);null!=ca&&ca.destroy();ba=new ba({...ea,rendererContext:this,drapeSource:ha});this._renderers.set(ha,ba);this._sortedDrapeSourceRenderersDirty=!0;"fullOpacity"in
ha&&this.addHandles(k.watch(()=>ha.fullOpacity,()=>this.events.emit("content-changed")),ha);return ba}removeDrapeSourceRenderer(ha){if(null!=ha){var ba=this._renderers.get(ha);null!=ba&&(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(ha),this.removeHandles(ha),ba.destroy())}}computeValidity(){return this._renderTargets?.computeValidity()??0}releaseRenderTargets(){this._renderTargets?.dispose()}get overlays(){return this._overlays??[]}ensureDrapeTargets(ha){this._hasTargetWithoutRasterImage=
this._overlays?g.someSet(ha,ba=>ba.drapeTargetType===t.DrapeTargetType.WithoutRasterImage):!1}ensureDrapeSources(ha){this._overlays?(this._hasDrapedFeatureSource=g.someSet(ha,ba=>ba.drapeSourceType===t.DrapeSourceType.Features),this._hasDrapedRasterSource=g.someSet(ha,ba=>ba.drapeSourceType===t.DrapeSourceType.RasterImage)):this._hasDrapedFeatureSource=this._hasDrapedRasterSource=!1}get _needsColorWithoutRasterImage(){return this._hasDrapedRasterSource&&this._hasDrapedFeatureSource&&this._hasTargetWithoutRasterImage}ensureOverlays(ha,
ba,ea=this._bindParameters.overlayStretch){null==this._overlays&&(this._renderTargets=new A.OverlayRenderTargets(this.view._stage.renderer.fboCache),this._overlays=[new y.Overlay,new y.Overlay]);this.ensureDrapeTargets(ha);this.ensureDrapeSources(ba);this._bindParameters.overlayStretch=ea}disposeOverlays(){this._overlays=null;this._renderTargets=f.disposeMaybe(this._renderTargets);this.events.emit("textures-disposed")}getTexture(ha){if(null!=ha)return ha===z.OverlayContent.ColorNoRasterImage&&!this._needsColorWithoutRasterImage&&
this._hasDrapedFeatureSource?this._renderTargets?.getTexture(z.OverlayContent.Color):this._renderTargets?.getTexture(ha)}get running(){return this.updating}runTask(ha){this._processDrapeSources(ha,()=>!0)}_processDrapeSources(ha,ba){let ea=!1;for(const [ca,ia]of this._renderers){if(ha.done)break;(ca.destroyed||ba(ca))&&ia.commitChanges()&&(ea=!0,ha.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,ea=!0,this._updateSortedDrapeSourceRenderers());ea&&(null!=
this._overlays&&0===this._renderers.size&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this.hasHighlights=d.someMap(this._renderers,ca=>ca.hasHighlights),this._updateRendersOccluded(),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(N.noBudget,ha=>ha.updatePolicy===H.UpdatePolicy.SYNC)}get isEmpty(){return r.debugFlags.OVERLAY_DRAW_DEBUG_TEXTURE?!1:!d.someMap(this._renderers,ha=>!ha.isEmpty)}get hasWater(){return this._hasWater}get rendersOccluded(){return this._rendersOccluded}get mode(){return this.isEmpty?
B.OverlayMode.Disabled:this._renderTargets?.getTexture(z.OverlayContent.WaterNormal)?B.OverlayMode.EnabledWithWater:this._renderTargets?.getTexture(z.OverlayContent.Color)?B.OverlayMode.Enabled:B.OverlayMode.Disabled}updateAnimation(ha){let ba=!1;this._renderers.forEach(ea=>ba=ea.updateAnimation(ha)||ba);return ba}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawOverlays(ha){if(this._overlays&&this._renderTargets){for(const ba of this._overlays)this.longitudeCyclical?ba.setupGeometryViewsCyclical(this.longitudeCyclical):
ba.setupGeometryViewsDirect();for(const ba of this._renderTargets.targets)if(ba.content!==z.OverlayContent.ColorNoRasterImage||this._needsColorWithoutRasterImage)this._drawTarget(u.OverlayIndex.INNER,ba,ha),this._drawTarget(u.OverlayIndex.OUTER,ba,ha)}}_drawTarget(ha,ba,ea){const ca=this._overlays[ha],ia=ca.canvasGeometries;if(0!==ia.numViews){var {alignPixelEnabled:la,contentPixelRatio:oa}=ea;this._screenToWorldRatio=oa*ca.mapUnitsPerPixel/this._bindParameters.overlayStretch;var na=ba.output;if(!(this.isEmpty||
na===E.ShaderOutput.Highlight&&!this.hasHighlights||na===E.ShaderOutput.Normal&&!this.hasWater)&&ca.hasSomeSizedView()){var ra=this._rctx;this._camera.pixelRatio=ca.pixelRatio*oa;this._renderContext.output=na;this._bindParameters.alignPixelEnabled=la;this._bindParameters.screenToWorldRatio=this._screenToWorldRatio;this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio;this._bindParameters.slot=na===E.ShaderOutput.Normal?X.RenderSlot.DRAPED_WATER:X.RenderSlot.DRAPED_MATERIAL;
if((ea=r.debugFlags.OVERLAY_DRAW_DEBUG_TEXTURE&&ba.content!==z.OverlayContent.Occluded)||this._sortedRenderers.some(({renderer:qa})=>qa.shouldRender(this._renderContext))){var ta=ca.resolution;this._rctx.setViewport(ha===u.OverlayIndex.INNER?0:ta,0,ta,ta);var ma=2*ca.resolution,pa=ca.resolution,ja=ba.fbo;ja.bind(ra,ma,pa);ha===u.OverlayIndex.INNER&&(ra.setClearColor(0,0,0,0),ra.clearSafe(T.ClearBufferBit.COLOR_BUFFER_BIT));ba.content===z.OverlayContent.Occluded&&(this._renderContext.renderOccludedMask=
ka);if(ea)for(ea=0;ea<ia.numViews;ea++)this._setViewParameters(ia.extents[ea],ca),this._ensureDebugPatternResources(ca.resolution,fa[ha]),this._rctx.bindTechnique(this._debugTextureTechnique,this._passParameters,null),this._rctx.screen.draw();this._sortedRenderers.forAll(({drapeSource:qa,renderer:ua})=>{if(ba.content!==z.OverlayContent.ColorNoRasterImage||qa.drapeSourceType!==t.DrapeSourceType.RasterImage){var {fullOpacity:wa}=qa;qa=null!=wa&&1>wa&&na===E.ShaderOutput.Color?this.bindTemporaryFramebuffer(ma,
pa):null;for(let za=0;za<ia.numViews;za++)this._setViewParameters(ia.extents[za],ca),ua.render(this._renderContext);qa&&(ja.bind(ra,ma,pa),this._overlayParameters.texture=qa.colorTexture,this._overlayParameters.opacity=wa,this._overlayParameters.overlayIndex=ha,ua=this.pluginContext.techniqueRepository.acquire(Q.OverlayCompositingTechnique),this._rctx.bindTechnique(ua,this._overlayParameters,this._renderContext.bindParameters),this._rctx.screen.draw(),ua.release(),qa.release())}});ra.bindFramebuffer(null);
ha===u.OverlayIndex.OUTER&&ja.generateMipMap();this._renderContext.resetRenderOccludedMask()}}}}bindTemporaryFramebuffer(ha,ba){const ea=this.view._stage.renderer.fboCache;ha=ea.acquire(C.ColorFormat.RGBA,ha,ba);ea.rctx.bindFramebuffer(ha.fbo);ea.rctx.clearSafe(T.ClearBufferBit.COLOR_BUFFER_BIT);return ha}async reloadShaders(){await this._shaderTechniqueRepository.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(ha,ba,ea,ca){let ia=0;for(const la of this._renderers.values())ia=
la.intersect?.(ha,ba,ea,ca,ia)??ia}_updateSortedDrapeSourceRenderers(){this._sortedRenderers.clear();if(0!==this._renderers.size){var ha=this.view.map.allLayers;this._renderers.forEach((ba,ea)=>{const ca=ha.indexOf(ea.layer),ia=0<=ca;this._sortedRenderers.push(new da(ea,ba,this._renderers.size*(ea.renderGroup??(ia?t.DrapedRenderGroup.MapLayer:t.DrapedRenderGroup.ViewLayer))+(ia?ca:0)))});this._sortedRenderers.sort((ba,ea)=>ba.index-ea.index)}}_setViewParameters(ha,ba){const ea=this._camera;ea.viewport=
[0,0,ba.resolution,ba.resolution];v.ortho(ea.projectionMatrix,0,ha[2]-ha[0],0,ha[3]-ha[1],ea.near,ea.far);v.fromTranslation(ea.viewMatrix,[-ha[0],-ha[1],0])}_updateHasWater(){const ha=d.someMap(this._renderers,ba=>ba.hasWater);ha!==this._hasWater&&(this._hasWater=ha,this.events.emit("has-water",ha))}_updateRendersOccluded(){const ha=d.someMap(this._renderers,ba=>ba.rendersOccluded);ha!==this._rendersOccluded&&(this._rendersOccluded=ha,this.events.emit("renders-occluded",ha))}_ensureDebugPatternResources(ha,
ba){x.set(this._passParameters.color,ba[0],ba[1],ba[2]);if(!this._passParameters.texture){ba=new Uint8Array(ha*ha*4);var ea=0;for(let ca=0;ca<ha;ca++)for(let ia=0;ia<ha;ia++){const la=Math.floor(ia/10),oa=Math.floor(ca/10);2>la||2>oa||10*la>ha-20||10*oa>ha-20?(ba[ea++]=255,ba[ea++]=255,ba[ea++]=255,ba[ea++]=255):(ba[ea++]=255,ba[ea++]=255,ba[ea++]=255,la&1&&oa&1?ba[ea++]=ia&1^ca&1?0:255:ba[ea++]=la&1^oa&1?0:128)}ha=new Z.TextureDescriptor(ha);ha.samplingMode=T.TextureSamplingMode.NEAREST;this._passParameters.texture=
new aa.Texture(this._rctx,ha,ba);ha=new Y.TextureTechniqueConfiguration;ha.hasAlpha=!0;this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(V.TextureTechnique,ha)}}get test(){return{drapedRenderers:Array.from(this._renderers.values()),getDrapeSourceRenderer:ha=>this._renderers.get(ha)}}};a.__decorate([q.property()],b.OverlayRenderer.prototype,"hasHighlights",void 0);a.__decorate([q.property()],b.OverlayRenderer.prototype,"_sortedDrapeSourceRenderersDirty",void 0);a.__decorate([q.property({autoDestroy:!0})],
b.OverlayRenderer.prototype,"_shaderTechniqueRepository",void 0);a.__decorate([q.property({constructOnly:!0})],b.OverlayRenderer.prototype,"view",void 0);a.__decorate([q.property()],b.OverlayRenderer.prototype,"worldToPCSRatio",void 0);a.__decorate([q.property()],b.OverlayRenderer.prototype,"spatialReference",void 0);a.__decorate([q.property({type:Boolean,readOnly:!0})],b.OverlayRenderer.prototype,"updating",null);a.__decorate([q.property()],b.OverlayRenderer.prototype,"isEmpty",null);b.OverlayRenderer=
a.__decorate([w.subclass("esri.views.3d.terrain.OverlayRenderer")],b.OverlayRenderer);class da{constructor(ha,ba,ea){this.drapeSource=ha;this.renderer=ba;this.index=ea}}const fa=[[1,.5,.5],[.5,.5,1]],ka=J.RenderOccludedFlag.OccludeAndTransparent;b.drapedZ=-2;b.overlayRenderOccludedFlag=ka;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/interfaces":function(){define(["exports"],function(b){b.DrapeSourceType=void 0;(function(a){a[a.RasterImage=0]="RasterImage";
a[a.Features=1]="Features"})(b.DrapeSourceType||(b.DrapeSourceType={}));b.DrapedRenderGroup=void 0;(function(a){a[a.MapLayer=0]="MapLayer";a[a.ViewLayer=1]="ViewLayer";a[a.Outline=2]="Outline";a[a.SnappingHint=3]="SnappingHint"})(b.DrapedRenderGroup||(b.DrapedRenderGroup={}));b.DrapeTargetType=void 0;(function(a){a[a.WithRasterImage=0]="WithRasterImage";a[a.WithoutRasterImage=1]="WithoutRasterImage"})(b.DrapeTargetType||(b.DrapeTargetType={}));Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/terrain/interfaces":function(){define(["exports"],function(b){b.OverlayIndex=void 0;(function(a){a[a.INNER=0]="INNER";a[a.OUTER=1]="OUTER"})(b.OverlayIndex||(b.OverlayIndex={}));b.PatchType=void 0;(function(a){a[a.REGULAR=0]="REGULAR";a[a.HAS_NORTH_POLE=1]="HAS_NORTH_POLE";a[a.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE";a[a.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"})(b.PatchType||(b.PatchType={}));b.LODSnapping=void 0;(function(a){a[a.OFF=0]="OFF";a[a.ON=1]="ON"})(b.LODSnapping||(b.LODSnapping={}));
b.TextureUpdate=void 0;(function(a){a[a.FADING=0]="FADING";a[a.IMMEDIATE=1]="IMMEDIATE";a[a.UNFADED=2]="UNFADED"})(b.TextureUpdate||(b.TextureUpdate={}));Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/Overlay":function(){define(["exports","../../../geometry/support/aaBoundingRect","../webgl-engine/lib/LocalOriginFactory"],function(b,a,c){class d{constructor(){this._extent=a.create();this.resolution=0;this.renderLocalOrigin=c.fromValues(0,0,0,"O");this.mapUnitsPerPixel=
this.pixelRatio=1;this.canvasGeometries=new f}get extent(){return this._extent}setupGeometryViewsCyclical(n){this.setupGeometryViewsDirect();var k=.001*n.range;if(this._extent[0]-k<=n.min){const g=this.canvasGeometries.extents[this.canvasGeometries.numViews++];a.offset(this._extent,n.range,0,g)}this._extent[2]+k>=n.max&&(k=this.canvasGeometries.extents[this.canvasGeometries.numViews++],a.offset(this._extent,-n.range,0,k))}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1;a.copy(this.canvasGeometries.extents[0],
this._extent)}hasSomeSizedView(){for(let n=0;n<this.canvasGeometries.numViews;n++){const k=this.canvasGeometries.extents[n];if(k[0]!==k[2]&&k[1]!==k[3])return!0}return!1}}class f{constructor(){this.extents=[a.create(),a.create(),a.create()];this.numViews=0}}b.Overlay=d;b.OverlayStretch=1.3;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/LocalOriginFactory":function(){define(["exports","../../../../chunks/vec3f64"],function(b,a){class c{constructor(d,
f){this.vec3=d;this.id=f}}b.LocalOrigin=c;b.fromValues=function(d,f,n,k){return new c(a.fromValues(d,f,n),k)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/OverlayContent":function(){define(["exports"],function(b){b.OverlayContent=void 0;var a=b.OverlayContent||(b.OverlayContent={});a[a.Color=0]="Color";a[a.ColorNoRasterImage=1]="ColorNoRasterImage";a[a.Highlight=2]="Highlight";a[a.WaterNormal=3]="WaterNormal";a[a.Occluded=4]="Occluded";a[a.ObjectAndLayerIdColor=
5]="ObjectAndLayerIdColor";Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/OverlayRenderTargets":function(){define("exports ../../../core/has ./OverlayContent ./OverlayFramebufferObject ../webgl-engine/core/FBOCache ../webgl-engine/core/shaderLibrary/ShaderOutput".split(" "),function(b,a,c,d,f,n){class k{constructor(q,e,m,l=f.ColorFormat.RGBA_MIPMAP){this.output=e;this.content=m;this.fbo=new d.OverlayFramebufferObject(q,l)}get valid(){return this.fbo.valid}}
class g{constructor(q){this.targets=[new k(q,n.ShaderOutput.Color,c.OverlayContent.Color),new k(q,n.ShaderOutput.Color,c.OverlayContent.ColorNoRasterImage),new k(q,n.ShaderOutput.Highlight,c.OverlayContent.Highlight,f.ColorFormat.RGBA4),new k(q,n.ShaderOutput.Normal,c.OverlayContent.WaterNormal),new k(q,n.ShaderOutput.Color,c.OverlayContent.Occluded)];a("enable-feature:objectAndLayerId-rendering")&&this.targets.push(new k(q,n.ShaderOutput.ObjectAndLayerIdColor,c.OverlayContent.ObjectAndLayerIdColor))}getTexture(q){return this.targets[q]?.fbo.texture}dispose(){for(const q of this.targets)q.fbo.dispose()}computeValidity(){return this.targets.reduce((q,
e,m)=>e.valid?q|=1<<m:q,0)}}b.OverlayRenderTargets=g;b.RenderTargetDescriptor=k;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/OverlayFramebufferObject":function(){define(["exports","../../../core/maybe"],function(b,a){class c{constructor(d,f){this._fbos=d;this._format=f}get valid(){return null!=this._handle}dispose(){this._handle=a.releaseMaybe(this._handle)}get texture(){return this._handle?.colorTexture}bind(d,f,n){this._handle&&this._handle.fbo.width===
f&&this._handle.fbo.height===n||(this._handle?.release(),this._handle=this._fbos.acquire(this._format,f,n));d.bindFramebuffer(this._handle?.fbo)}generateMipMap(){this._handle?.colorTexture?.descriptor?.hasMipmap&&this._handle?.colorTexture?.generateMipmap()}}b.OverlayFramebufferObject=c;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/Overlay.glsl":function(){define("exports ../../../../../../chunks/vec4f64 ../../../../../../geometry/support/aaBoundingRect ../../../../terrain/interfaces ../../../../terrain/OverlayContent ../../renderPasses/AllRenderPasses ../ShaderOutput ../shading/MainLighting.glsl ../shading/PhysicallyBasedRenderingParameters.glsl ../shading/Water.glsl ../../shaderModules/Float4DrawUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform ../../shaderModules/Uniform".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x){function p(u,y){y.pbrMode!==q.PBRMode.Water&&y.pbrMode!==q.PBRMode.WaterOnIntegratedMesh&&y.pbrMode!==q.PBRMode.TerrainWithWater||u.include(e.Water,y);const {vertex:z,fragment:A}=u;u.varyings.add("vtcOverlay","vec4");z.code.add(w.glsl`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`);A.code.add(w.glsl`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`);A.code.add(w.glsl`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`);A.code.add(w.glsl`vec4 getOverlayColorTexel(vec4 texCoords) {
vec2 texDim =  vec2(textureSize(ovColorTex, 0));
vec4 color0 = texelFetch(ovColorTex, ivec2(vec2(texCoords.x * 0.5, texCoords.y) * texDim), 0);
vec4 color1 = texelFetch(ovColorTex, ivec2(vec2(texCoords.z * 0.5 + 0.5, texCoords.w) * texDim), 0);
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`);if(y.pbrMode===q.PBRMode.Water||y.pbrMode===q.PBRMode.WaterOnIntegratedMesh||y.pbrMode===q.PBRMode.TerrainWithWater)g.addMainLightDirection(A),g.addMainLightIntensity(A),A.code.add(w.glsl`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, mainLightDirection, colorInput.rgb, mainLightIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`)}function h(u,y){return u.identifier===n.RenderPassIdentifier.Material&&u.output===k.ShaderOutput.Color?y.overlay?.getTexture(f.OverlayContent.ColorNoRasterImage):u.identifier===n.RenderPassIdentifier.Material&&u.output===k.ShaderOutput.ObjectAndLayerIdColor?y.overlay?.getTexture(f.OverlayContent.ObjectAndLayerIdColor):u.identifier===n.RenderPassIdentifier.Highlight?y.overlay?.getTexture(f.OverlayContent.Highlight):null}b.OverlayMode=void 0;(function(u){u[u.Disabled=0]="Disabled";u[u.Enabled=1]=
"Enabled";u[u.EnabledWithWater=2]="EnabledWithWater";u[u.COUNT=3]="COUNT"})(b.OverlayMode||(b.OverlayMode={}));class t extends x.Uniform{constructor(u){super(u,"vec4")}}const r=a.create();b.OverlayIM=function(u,y){const {vertex:z,fragment:A}=u;z.uniforms.add(new m.Float4DrawUniform("overlayTexOffset",(C,E)=>{const B=E.overlay?.overlays[d.OverlayIndex.INNER]?.extent;c.hasArea(B)&&(r[0]=C.toMapSpace[0]/c.width(B)-B[0]/c.width(B),r[1]=C.toMapSpace[1]/c.height(B)-B[1]/c.height(B));E=E.overlay?.overlays[d.OverlayIndex.OUTER]?.extent;
c.hasArea(E)&&(r[2]=C.toMapSpace[0]/c.width(E)-E[0]/c.width(E),r[3]=C.toMapSpace[1]/c.height(E)-E[1]/c.height(E));return r}),new m.Float4DrawUniform("overlayTexScale",(C,E)=>{const B=E.overlay?.overlays[d.OverlayIndex.INNER]?.extent;c.hasArea(B)&&(r[0]=C.toMapSpace[2]/c.width(B),r[1]=C.toMapSpace[3]/c.height(B));E=E.overlay?.overlays[d.OverlayIndex.OUTER]?.extent;c.hasArea(E)&&(r[2]=C.toMapSpace[2]/c.width(E),r[3]=C.toMapSpace[3]/c.height(E));return r}));A.constants.add("overlayOpacity","float",1);
A.uniforms.add(new v.Texture2DPassUniform("ovColorTex",(C,E)=>h(C,E)));p(u,y)};b.OverlayTerrain=function(u,y){const {vertex:z,fragment:A}=u;z.uniforms.add(new t("overlayTexOffset"),new t("overlayTexScale"));A.uniforms.add(new l.FloatPassUniform("overlayOpacity",C=>C.overlayOpacity),new v.Texture2DPassUniform("ovColorTex",(C,E)=>E.overlay?.getTexture(C.overlayContent)));p(u,y)};b.getIMColorTexture=h;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/renderPasses/AllRenderPasses":function(){define(["exports",
"../../../../../chunks/vec3f64","../shaderLibrary/ShaderOutput","../shaderLibrary/attributes/VertexNormal.glsl"],function(b,a,c,d){class f extends d.VertexNormalPassParameters{constructor(){super(...arguments);this.origin=this.slicePlaneLocalOrigin=a.create();this.modelTransformation=null}}class n extends d.VertexNormalDrawParameters{}b.RenderPassIdentifier=void 0;(function(e){e[e.Material=0]="Material";e[e.ShadowMap=1]="ShadowMap";e[e.Highlight=2]="Highlight"})(b.RenderPassIdentifier||(b.RenderPassIdentifier=
{}));class k extends f{constructor(){super(...arguments);this.identifier=b.RenderPassIdentifier.Material;this.output=c.ShaderOutput.Color;this.transparent=!1}}class g extends f{constructor(){super(...arguments);this.identifier=b.RenderPassIdentifier.ShadowMap}}class q extends f{constructor(){super(...arguments);this.identifier=b.RenderPassIdentifier.Highlight}}b.DrawParameters=n;b.HighlightPassParameters=q;b.MaterialPassParameters=k;b.PassParameters=f;b.ShadowMapPassParameters=g;Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Water.glsl":function(){define("exports ./FoamRendering.glsl ./Gamma.glsl ./PhysicallyBasedRendering.glsl ./ScreenSpaceReflections.glsl ../util/CloudsParallaxShading.glsl ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix4PassUniform ../../shaderModules/Texture2DPassUniform".split(" "),function(b,a,c,d,f,n,k,g,q,e){b.Water=function(m,l){m.include(d.PhysicallyBasedRenderingWater,
l);m.include(c.Gamma);m.include(a.FoamColor);l.hasCloudsReflections&&m.include(n.CloudsParallaxShading,l);l.hasScreenSpaceReflections&&m.include(f.ScreenSpaceReflections,l);m=m.fragment;m.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3E5).add("ssrHeightFadeEnd","float",5E5).add("waterDiffusion","float",.92).add("waterSeaColorMod",
"float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]);m.code.add(g.glsl`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`);m.uniforms.add(new k.FloatPassUniform("lightingSpecularStrength",(w,v)=>v.lighting.mainLight.specularStrength),new k.FloatPassUniform("lightingEnvironmentStrength",(w,v)=>v.lighting.mainLight.environmentStrength));m.code.add(g.glsl`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`);l.hasCloudsReflections&&m.code.add(g.glsl`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y * cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`);l.hasScreenSpaceReflections?(m.uniforms.add(new q.Matrix4PassUniform("view",(w,v)=>v.camera.viewMatrix),new e.Texture2DPassUniform("lastFrameColorTexture",(w,v)=>v.ssr.lastFrameColor?.colorTexture),new k.FloatPassUniform("fadeFactorSSR",(w,v)=>v.ssr.fadeFactor)),m.code.add(g.glsl`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view * vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactorSSR;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture(lastFrameColorTexture, reprojectedCoordinate).xyz) *
reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +
reflSea * seaColorMod + specular + foam);`)):m.code.add(g.glsl`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`);l.hasCloudsReflections?l.hasScreenSpaceReflections?m.code.add(g.glsl`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):m.code.add(g.glsl`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):m.code.add(g.glsl`return waterRenderedColor;
}`)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/FoamRendering.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(b,a){b.FoamColor=function(c){c.fragment.code.add(a.glsl`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)};b.FoamIntensity=function(c){c.fragment.code.add(a.glsl`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ScreenSpaceReflections.glsl":function(){define("exports ../output/ReadLinearDepth.glsl ../../shaderModules/Float2PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix4PassUniform ../../shaderModules/Texture2DPassUniform".split(" "),function(b,a,c,d,f,n,k){b.ScreenSpaceReflections=function(g,q){g=g.fragment;g.include(a.ReadLinearDepth);
g.uniforms.add(new c.Float2PassUniform("nearFar",(e,m)=>m.camera.nearFar));g.uniforms.add(new k.Texture2DPassUniform("depthMap",(e,m)=>m.linearDepth?.colorTexture));g.uniforms.add(new n.Matrix4PassUniform("proj",(e,m)=>m.camera.projectionMatrix));g.uniforms.add(new d.FloatPassUniform("invResolutionHeight",(e,m)=>1/m.camera.height));g.uniforms.add(new n.Matrix4PassUniform("reprojectionMatrix",(e,m)=>m.ssr.reprojectionMatrix));g.code.add(f.glsl`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${q.highStepCount?"150":"75"};

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P = clamp(P + dP, vec2(0.0), vec2(0.999));
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Float4DrawUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(b,a,c){class d extends a.Uniform{constructor(f,n){super(f,"vec4",c.BindType.Draw,(k,g,q)=>k.setUniform4fv(f,n(g,q)))}}b.Float4DrawUniform=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/TextureOnly.glsl":function(){define("exports ./vec4f64 ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(b,a,c,d,f,n,k){function g(){const m=new n.ShaderBuilder;m.include(c.ScreenSpacePass);m.fragment.uniforms.add(new k.Texture2DPassUniform("tex",l=>l.texture),new d.Float4PassUniform("uColor",l=>l.color));m.fragment.code.add(f.glsl`void main() {
vec4 texColor = texture(tex, uv);
fragColor = texColor * uColor;
}`);return m}class q extends f.NoParameters{constructor(){super(...arguments);this.color=a.fromValues(1,1,1,1)}}const e=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:q,build:g},Symbol.toStringTag,{value:"Module"}));b.TextureOnly=e;b.TextureOnlyPassParameters=q;b.build=g})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueRepository":function(){define(["exports","../../../../../core/NestedMap","./ShaderTechniqueConfiguration"],function(b,a,c){class d{constructor(k){this._context=
k;this._perConstructorInstances=new a.NestedMap;this._frameCounter=0;this._keepAliveFrameCount=-1}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}destroy(){this._perConstructorInstances.forEach(k=>k.forEach(g=>g.technique.destroy()));this._perConstructorInstances.clear()}acquire(k,g=n){const q=g.key;let e=this._perConstructorInstances.get(k,q);if(null==e){const m=new k(this._context,g,()=>this.release(m));e=new f(m);this._perConstructorInstances.set(k,
q,e)}++e.refCount;return e.technique}releaseAndAcquire(k,g,q){if(null!=q){if(g.key===q.key)return q;this.release(q)}return this.acquire(k,g)}release(k){null==k||this._perConstructorInstances.empty||(k=this._perConstructorInstances.get(k.constructor,k.key),null!=k&&(--k.refCount,0===k.refCount&&(k.refZeroFrame=this._frameCounter)))}frameUpdate(){this._frameCounter++;-1!==this._keepAliveFrameCount&&this._perConstructorInstances.forEach((k,g)=>{k.forEach((q,e)=>{0===q.refCount&&q.refZeroFrame+this._keepAliveFrameCount<
this._frameCounter&&(q.technique.destroy(),this._perConstructorInstances.delete(g,e))})})}async reloadAll(){const k=[];this._perConstructorInstances.forEach((g,q)=>{k.push((async(e,m)=>{if(m=m.shader)await m.reload(),e.forEach(l=>l.technique.reload(this._context))})(g,q))});await Promise.all(k)}}class f{constructor(k){this.technique=k;this.refZeroFrame=this.refCount=0}}const n=new c.ShaderTechniqueConfiguration;b.ShaderTechniqueRepository=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/lib/GLMaterialRepository":function(){define(["exports","../../../../core/Logger","../../../../core/maybe","../../../../core/NestedMap","./Util"],function(b,a,c,d,f){class n{constructor(g,q,e,m){this._textureRepository=g;this._techniqueRepository=q;this.materialChanged=e;this.requestRender=m;this._id2glMaterialRef=new d.NestedMap}dispose(){this._textureRepository.destroy()}acquire(g,q,e){this._ownMaterial(g);if(!g.produces(q,e))return null;q=this._id2glMaterialRef.get(e,
g.id);null==q&&(q=g.createGLMaterial({material:g,techniqueRep:this._techniqueRepository,textureRepository:this._textureRepository,output:e}),q=new k(q),this._id2glMaterialRef.set(e,g.id,q));q.ref();return q.glMaterial}release(g,q){const e=this._id2glMaterialRef.get(q,g.id);null!=e&&(e.unref(),e.referenced||(c.disposeMaybe(e.glMaterial),this._id2glMaterialRef.delete(q,g.id)))}_ownMaterial(g){g.repository&&g.repository!==this&&a.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository");
g.repository=this}}class k{constructor(g){this.glMaterial=g;this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt;f.assert(0<=this._refCnt)}get referenced(){return 0<this._refCnt}}b.GLMaterialRepository=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/GridLocalOriginFactory":function(){define("exports ../../../../core/uid ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/projection/projectBuffer ./Attribute ./ContentObjectType ./Geometry ./LocalOriginFactory ./Object3D ./testUtils ./VertexAttribute ./WebGLLayer ../materials/RibbonLineMaterial".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x){class p{constructor(t){this._originSR=t;this._rootOriginId="root/"+a.generateUID();this._origins=new Map;this._objects=new Map;this._gridSize=5E5}getOrigin(t){var r=this._origins.get(this._rootOriginId);if(null==r){r=l.gridLocalOriginFactory.rootOrigin;if(null!=r)return this._origins.set(this._rootOriginId,e.fromValues(r[0],r[1],r[2],this._rootOriginId)),this.getOrigin(t);t=e.fromValues(t[0]+Math.random()-.5,t[1]+Math.random()-.5,t[2]+Math.random()-.5,this._rootOriginId);
this._origins.set(this._rootOriginId,t);return t}var u=this._gridSize;const y=Math.round(t[0]/u),z=Math.round(t[1]/u),A=Math.round(t[2]/u),C=`${y}/${z}/${A}`;let E=this._origins.get(C);const B=.5*u;c.subtract(h,t,r.vec3);h[0]=Math.abs(h[0]);h[1]=Math.abs(h[1]);h[2]=Math.abs(h[2]);if(h[0]<B&&h[1]<B&&h[2]<B)return E&&(u=Math.max(...h),c.subtract(h,t,E.vec3),h[0]=Math.abs(h[0]),h[1]=Math.abs(h[1]),h[2]=Math.abs(h[2]),Math.max(...h)<u)?E:r;E||(E=e.fromValues(y*u,z*u,A*u,C),this._origins.set(C,E));return E}_drawOriginBox(t,
r=f.fromValues(1,1,0,1)){const u=window.view,y=u._stage;var z=r.toString();if(!this._objects.has(z)){this._material=new x.RibbonLineMaterial({width:2,color:r});y.add(this._material);r=new v.WebGLLayer(y,{pickable:!1});var A=new m.Object3D({castShadow:!1});y.add(A);r.add(A);this._objects.set(z,A)}z=this._objects.get(z);r=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0];A=r.length;const C=Array(3*A),E=[],B=.5*this._gridSize;for(let D=0;D<A;D++)C[3*D]=t[0]+(r[D]&1?B:-B),C[3*D+1]=t[1]+(r[D]&2?B:-B),C[3*D+2]=t[2]+
(r[D]&4?B:-B),0<D&&E.push(D-1,D);n.projectBuffer(C,this._originSR,0,C,u.renderSpatialReference,0,A);t=new q.Geometry(this._material,[[w.VertexAttribute.POSITION,new k.Attribute(C,E,3,!0)]],null,g.ContentObjectType.Line);y.add(t);z.addGeometry(t)}get test(){const t=this;return{set gridSize(r){t._gridSize=r}}}}const h=d.create();b.GridLocalOriginFactory=p;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/testUtils":function(){define(["exports"],function(b){b.gridLocalOriginFactory=
{rootOrigin:null};b.textTextureAtlas={stableRendering:!1};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/WebGLLayer":function(){define("exports ../../../../core/Evented ../../../../core/Handles ../../../../core/maybe ../../../../core/PooledArray ./ContentObject ./ContentObjectType ./DirtyEvents ./Octree ./UpdatePolicy".split(" "),function(b,a,c,d,f,n,k,g,q,e){class m extends n.ContentObject{get objects(){return this._objects}constructor(l,w,v=""){super();
this.stage=l;this.apiLayerUid=v;this.type=k.ContentObjectType.Layer;this.events=new a;this.pickable=this.visible=!0;this.sliceable=!1;this._objects=new f;this._objectsAdded=new f;this._handles=new c;this.apiLayerUid=v;this.visible=w?.visible??!0;this.pickable=w?.pickable??!0;this.updatePolicy=w?.updatePolicy??e.UpdatePolicy.ASYNC;this._disableOctree=w?.disableOctree??!1;l.add(this);for(const x of g.DirtyEventNames)this._handles.add(this.events.on(x,p=>l.handleEvent(x,p)))}destroy(){this._handles.size&&
(this._handles.destroy(),this.stage.remove(this),this.invalidateSpatialQueryAccelerator())}add(l){this._objects.push(l);l.parentLayer=this;this.events.emit("layerObjectAdded",{layer:this,object:l});null!=this._octree&&this._objectsAdded.push(l)}remove(l){this._objects.removeUnordered(l)&&(l.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:l}),null!=this._octree&&(this._objectsAdded.removeUnordered(l)||this._octree.remove([l])))}addMany(l){this._objects.pushArray(l);for(const w of l)w.parentLayer=
this;this.events.emit("layerObjectsAdded",{layer:this,objects:l});null!=this._octree&&this._objectsAdded.pushArray(l)}removeMany(l){const w=[];this._objects.removeUnorderedMany(l,l.length,w);if(0!==w.length){for(const v of w)v.parentLayer=null;this.events.emit("layerObjectsRemoved",{layer:this,objects:w});if(null!=this._octree){for(l=0;l<w.length;)this._objectsAdded.removeUnordered(w[l])?(w[l]=w[w.length-1],--w.length):++l;this._octree.remove(w)}}}sync(){this.updatePolicy!==e.UpdatePolicy.SYNC&&this.stage.syncLayer(this.id)}notifyObjectBBChanged(l,
w){null==this._octree||this._objectsAdded.includes(l)||this._octree.update(l,w)}getSpatialQueryAccelerator(){null==this._octree&&50<this._objects.length&&!this._disableOctree?(this._octree=new q(l=>l.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)):null!=this._octree&&0<this._objectsAdded.length&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear());return this._octree}invalidateSpatialQueryAccelerator(){this._octree=
d.destroyMaybe(this._octree);this._objectsAdded.clear()}}b.WebGLLayer=m;b.isWebGLLayer=function(l){return null!=l&&l.type===k.ContentObjectType.Layer};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/DirtyEvents":function(){define(["exports"],function(b){b.DirtyEventNames="layerObjectAdded layerObjectRemoved layerObjectsAdded layerObjectsRemoved transformationChanged shaderTransformationChanged visibilityChanged occlusionChanged highlightChanged geometryAdded geometryRemoved attributesChanged".split(" ");
Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Octree":function(){define("../../../../core/ObjectPool ../../../../core/PooledArray ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/frustum ../../../../geometry/support/ray ../../../../chunks/sphere ./Util".split(" "),function(b,a,c,d,f,n,k,g){function q(P,J,R){R[0]=P[0]+J;R[1]=P[1]+J;R[2]=P[2]+J}function e(P,J,R,X){if(1===J)P=R(P[0]),k.copy(P,X);else{A[0]=Infinity;A[1]=
Infinity;A[2]=Infinity;C[0]=-Infinity;C[1]=-Infinity;C[2]=-Infinity;for(let Y=0;Y<J;Y++){var U=R(P[Y]);if(v(U[3])){var M=A,V=U;M[0]=Math.min(M[0],V[0]-V[3]);M[1]=Math.min(M[1],V[1]-V[3]);M[2]=Math.min(M[2],V[2]-V[3]);M=C;M[0]=Math.max(M[0],U[0]+U[3]);M[1]=Math.max(M[1],U[1]+U[3]);M[2]=Math.max(M[2],U[2]+U[3])}}c.lerp(X,A,C,.5);X[3]=Math.max(C[0]-A[0],C[1]-A[1],C[2]-A[2])/2}}function m(P,J,R){if(!G.length)for(var X=0;8>X;++X)G.push({index:0,distance:0});for(X=0;8>X;++X){const U=h[X];G.data[X].index=
X;G.data[X].distance=w(P,J,U)}G.sort((U,M)=>U.distance-M.distance);for(P=0;8>P;++P)R[P]=G.data[P].index}function l(P,J){let R=Infinity,X;for(let U=0;8>U;++U){const M=w(P,J,t[U]);M<R&&(R=M,X=t[U])}return X}function w(P,J,R){return J*(P[0]*R[0]+P[1]*R[1]+P[2]*R[2])}function v(P){return!isNaN(P)&&-Infinity!==P&&Infinity!==P&&0<P}class x{get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}constructor(P,
J){this.objectToBoundingSphere=P;this._maximumObjectsPerNode=10;this._maximumDepth=20;this._degenerateObjects=new Set;this._root=new p;this._objectCount=0;J&&(void 0!==J.maximumObjectsPerNode&&(this._maximumObjectsPerNode=J.maximumObjectsPerNode),void 0!==J.maximumDepth&&(this._maximumDepth=J.maximumDepth))}destroy(){this._degenerateObjects.clear();p.clearPool();u[0]=null;E.prune();G.prune()}add(P,J=P.length){this._objectCount+=J;this._grow(P,J);const R=p.acquire();for(let X=0;X<J;X++){const U=P[X];
this._isDegenerate(U)?this._degenerateObjects.add(U):(R.init(this._root),this._add(U,R))}p.release(R)}remove(P,J=null){this._objectCount-=P.length;const R=p.acquire();for(const X of P)P=null!=J?J:k.copy(this.objectToBoundingSphere(X),B),v(P[3])?(R.init(this._root),this._remove(X,P,R)):this._degenerateObjects.delete(X);p.release(R);this._shrink()}update(P,J){if(v(J[3])||!this._isDegenerate(P))u[0]=P,P=u,this.remove(P,J),this.add(P)}forEachAlongRay(P,J,R){const X=n.wrap(P,J);this._forEachNode(this._root,
U=>{if(!this._intersectsNode(X,U))return!1;U=U.node;U.terminals.forAll(M=>{this._intersectsObject(X,M)&&R(M)});null!==U.residents&&U.residents.forAll(M=>{this._intersectsObject(X,M)&&R(M)});return!0})}forEachAlongRayWithVerticalOffset(P,J,R,X){const U=n.wrap(P,J);this._forEachNode(this._root,M=>{if(!this._intersectsNodeWithOffset(U,M,X))return!1;M=M.node;M.terminals.forAll(V=>{this._intersectsObjectWithOffset(U,V,X)&&R(V)});null!==M.residents&&M.residents.forAll(V=>{this._intersectsObjectWithOffset(U,
V,X)&&R(V)});return!0})}forEach(P){this._forEachNode(this._root,J=>{J=J.node;J.terminals.forAll(P);null!==J.residents&&J.residents.forAll(P);return!0});this._degenerateObjects.forEach(P)}forEachDegenerateObject(P){this._degenerateObjects.forEach(P)}findClosest(P,J,R,X=()=>!0,U=Infinity){let M=Infinity,V=Infinity,Y=null;const W=l(P,J),H=S=>{--U;if(X(S)){var I=this.objectToBoundingSphere(S);if(f.intersectsSphere(R,I)){var Q=w(P,J,k.getCenter(I)),N=Q-I[3];I=Q+I[3];N<M&&(M=N,V=I,Y=S)}}};this._forEachNodeDepthOrdered(this._root,
S=>{if(0>=U||!f.intersectsSphere(R,S.bounds))return!1;c.scale(z,W,S.halfSize);c.add(z,z,S.bounds);if(w(P,J,z)>V)return!1;S=S.node;S.terminals.forAll(I=>H(I));null!==S.residents&&S.residents.forAll(I=>H(I));return!0},P,J);return Y}forEachInDepthRange(P,J,R,X,U,M,V){let Y=-Infinity,W=Infinity;const H={setRange:T=>{R===x.DepthOrder.FRONT_TO_BACK?(Y=Math.max(Y,T.near),W=Math.min(W,T.far)):(Y=Math.max(Y,-T.far),W=Math.min(W,-T.near))}};H.setRange(X);const S=w(J,R,P),I=l(J,R),Q=l(J,-R),N=T=>{if(V(T)){var aa=
this.objectToBoundingSphere(T),Z=k.getCenter(aa);Z=w(J,R,Z)-S;var da=Z+aa[3];Z-aa[3]>W||da<Y||!f.intersectsSphere(M,aa)||U(T,H)}};this._forEachNodeDepthOrdered(this._root,T=>{if(!f.intersectsSphere(M,T.bounds))return!1;c.scale(z,I,T.halfSize);c.add(z,z,T.bounds);if(w(J,R,z)-S>W)return!1;c.scale(z,Q,T.halfSize);c.add(z,z,T.bounds);if(w(J,R,z)-S<Y)return!1;T=T.node;T.terminals.forAll(aa=>N(aa));null!==T.residents&&T.residents.forAll(aa=>N(aa));return!0},J,R)}forEachNode(P){this._forEachNode(this._root,
J=>P(J.node,J.bounds,J.halfSize,J.depth))}forEachNeighbor(P,J){const R=k.getRadius(J),X=k.getCenter(J),U=Y=>{const W=this.objectToBoundingSphere(Y);var H=k.getRadius(W);H=R+H;return 0>=c.squaredDistance(k.getCenter(W),X)-H*H?P(Y):!0};let M=!0;const V=Y=>{M&&(M=U(Y))};this._forEachNode(this._root,Y=>{var W=k.getRadius(Y.bounds);W=R+W;if(0<c.squaredDistance(k.getCenter(Y.bounds),X)-W*W)return!1;Y=Y.node;Y.terminals.forAll(V);M&&null!==Y.residents&&Y.residents.forAll(V);return M});M&&this.forEachDegenerateObject(V)}_intersectsNode(P,
J){q(J.bounds,2*-J.halfSize,A);q(J.bounds,2*J.halfSize,C);return g.rayBoxTest(P.origin,P.direction,A,C)}_intersectsNodeWithOffset(P,J,R){q(J.bounds,2*-J.halfSize,A);q(J.bounds,2*J.halfSize,C);R.applyToMinMax(A,C);return g.rayBoxTest(P.origin,P.direction,A,C)}_intersectsObject(P,J){J=this.objectToBoundingSphere(J);return 0<J[3]?k.intersectsRay(J,P):!0}_intersectsObjectWithOffset(P,J,R){J=this.objectToBoundingSphere(J);return 0<J[3]?k.intersectsRay(R.applyToBoundingSphere(J),P):!0}_forEachNode(P,J){P=
p.acquire().init(P);const R=[P];for(;0!==R.length;){P=R.pop();if(J(P)&&!P.isLeaf())for(let X=0;X<P.node.children.length;X++)P.node.children[X]&&R.push(p.acquire().init(P).advance(X));p.release(P)}}_forEachNodeDepthOrdered(P,J,R,X=x.DepthOrder.FRONT_TO_BACK){P=p.acquire().init(P);const U=[P];for(m(R,X,O);0!==U.length;){P=U.pop();if(J(P)&&!P.isLeaf())for(R=7;0<=R;--R)X=O[R],P.node.children[X]&&U.push(p.acquire().init(P).advance(X));p.release(P)}}_remove(P,J,R){E.clear();J=R.advanceTo(J,(X,U)=>{E.push(X.node);
E.push(U)})?R.node.terminals:R.node.residents;J.removeUnordered(P);if(0===J.length)for(P=E.length-2;0<=P&&this._purge(E.data[P],E.data[P+1]);P-=2);}_nodeIsEmpty(P){if(0!==P.terminals.length)return!1;if(null!==P.residents)return 0===P.residents.length;for(let J=0;J<P.children.length;J++)if(P.children[J])return!1;return!0}_purge(P,J){0<=J&&(P.children[J]=null);return this._nodeIsEmpty(P)?(null===P.residents&&(P.residents=new a({shrink:!0})),!0):!1}_add(P,J){J.advanceTo(this.objectToBoundingSphere(P))?
J.node.terminals.push(P):(J.node.residents.push(P),J.node.residents.length>this._maximumObjectsPerNode&&J.depth<this._maximumDepth&&this._split(J))}_split(P){const J=P.node.residents;P.node.residents=null;for(let R=0;R<J.length;R++){const X=p.acquire().init(P);this._add(J.at(R),X);p.release(X)}}_grow(P,J){0!==J&&(e(P,J,R=>this.objectToBoundingSphere(R),D),v(D[3])&&!this._fitsInsideTree(D)&&(this._nodeIsEmpty(this._root.node)?(k.copy(D,this._root.bounds),this._root.halfSize=1.25*this._root.bounds[3],
this._root.updateBoundsRadiusFromHalfSize()):(P=this._rootBoundsForRootAsSubNode(D),this._placingRootViolatesMaxDepth(P)?this._rebuildTree(D,P):this._growRootAsSubNode(P),p.release(P))))}_rebuildTree(P,J){c.copy(F,J.bounds);F[3]=J.halfSize;e([P,F],2,R=>R,K);P=p.acquire().init(this._root);this._root.initFrom(null,K,K[3]);this._root.increaseHalfSize(1.25);this._forEachNode(P,R=>{this.add(R.node.terminals.data,R.node.terminals.length);null!==R.node.residents&&this.add(R.node.residents.data,R.node.residents.length);
return!0});p.release(P)}_placingRootViolatesMaxDepth(P){const J=Math.log(P.halfSize/this._root.halfSize)*Math.LOG2E;let R=0;this._forEachNode(this._root,X=>{R=Math.max(R,X.depth);return R+J<=this._maximumDepth});return R+J>this._maximumDepth}_rootBoundsForRootAsSubNode(P){var J=P[3],R=-Infinity;const X=this._root.bounds,U=this._root.halfSize;for(var M=0;3>M;M++){var V=Math.max(0,Math.ceil((X[M]-U-(P[M]-J))/(2*U)));const Y=Math.max(0,Math.ceil((P[M]+J-(X[M]+U))/(2*U)))+1;R=Math.max(R,2**Math.ceil(Math.log(V+
Y)*Math.LOG2E));L[M].min=V;L[M].max=Y}for(P=0;3>P;P++)J=L[P].min,M=L[P].max,V=(R-(J+M))/2,J+=Math.ceil(V),M+=Math.floor(V),y[P]=X[P]-U-J*U*2+(M+J)*U;R*=U;y[3]=R*r;return p.acquire().initFrom(null,y,R,0)}_growRootAsSubNode(P){const J=this._root.node;c.copy(D,this._root.bounds);D[3]=this._root.halfSize;this._root.init(P);P.advanceTo(D,null,!0);P.node.children=J.children;P.node.residents=J.residents;P.node.terminals=J.terminals}_shrink(){for(;;){const P=this._findShrinkIndex();if(-1===P)break;this._root.advance(P);
this._root.depth=0}}_findShrinkIndex(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;let P=null;const J=this._root.node.children;let R=0,X=0;for(;X<J.length&&null==P;)R=X++,P=J[R];for(;X<J.length;)if(J[X++])return-1;return R}_isDegenerate(P){P=this.objectToBoundingSphere(P)[3];return!v(P)}_fitsInsideTree(P){const J=this._root.bounds,R=this._root.halfSize;return P[3]<=R&&P[0]>=J[0]-R&&P[0]<=J[0]+R&&P[1]>=J[1]-R&&P[1]<=J[1]+R&&P[2]>=J[2]-R&&P[2]<=J[2]+R}toJSON(){const {maximumDepth:P,
maximumObjectsPerNode:J,_objectCount:R}=this,X=this._nodeToJSON(this._root.node);return{maximumDepth:P,maximumObjectsPerNode:J,objectCount:R,root:{bounds:this._root.bounds,halfSize:this._root.halfSize,depth:this._root.depth,node:X}}}_nodeToJSON(P){const J=P.children.map(X=>X?this._nodeToJSON(X):null),R=P.residents?.map(X=>this.objectToBoundingSphere(X));P=P.terminals?.map(X=>this.objectToBoundingSphere(X));return{children:J,residents:R,terminals:P}}static fromJSON(P){const J=new x(R=>R,{maximumDepth:P.maximumDepth,
maximumObjectsPerNode:P.maximumObjectsPerNode});J._objectCount=P.objectCount;J._root.initFrom(P.root.node,P.root.bounds,P.root.halfSize,P.root.depth);return J}}class p{constructor(){this.bounds=k.create();this.halfSize=0;this.initFrom(null,null,0,0)}init(P){return this.initFrom(P.node,P.bounds,P.halfSize,P.depth)}initFrom(P,J,R,X=this.depth){this.node=null!=P?P:p.createEmptyNode();null!=J&&k.copy(J,this.bounds);this.halfSize=R;this.depth=X;return this}increaseHalfSize(P){this.halfSize*=P;this.updateBoundsRadiusFromHalfSize()}updateBoundsRadiusFromHalfSize(){this.bounds[3]=
this.halfSize*r}advance(P){let J=this.node.children[P];J||(J=p.createEmptyNode(),this.node.children[P]=J);this.node=J;this.halfSize/=2;this.depth++;P=h[P];this.bounds[0]+=P[0]*this.halfSize;this.bounds[1]+=P[1]*this.halfSize;this.bounds[2]+=P[2]*this.halfSize;this.updateBoundsRadiusFromHalfSize();return this}advanceTo(P,J,R=!1){for(;;){if(this.isTerminalFor(P))return J&&J(this,-1),!0;if(this.isLeaf()){if(!R)return J&&J(this,-1),!1;this.node.residents=null}const X=this._childIndex(P);J&&J(this,X);
this.advance(X)}}isLeaf(){return null!=this.node.residents}isTerminalFor(P){return P[3]>this.halfSize/2}_childIndex(P){const J=this.bounds;return(J[0]<P[0]?1:0)+(J[1]<P[1]?2:0)+(J[2]<P[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new a({shrink:!0}),residents:new a({shrink:!0})}}static acquire(){return p._pool.acquire()}static release(P){p._pool.release(P)}static clearPool(){p._pool.prune()}}p._pool=new b(p);(function(P){P=P.DepthOrder||(P.DepthOrder=
{});P[P.FRONT_TO_BACK=1]="FRONT_TO_BACK";P[P.BACK_TO_FRONT=-1]="BACK_TO_FRONT"})(x||(x={}));const h=[d.fromValues(-1,-1,-1),d.fromValues(1,-1,-1),d.fromValues(-1,1,-1),d.fromValues(1,1,-1),d.fromValues(-1,-1,1),d.fromValues(1,-1,1),d.fromValues(-1,1,1),d.fromValues(1,1,1)],t=[d.fromValues(-1,-1,-1),d.fromValues(-1,-1,1),d.fromValues(-1,1,-1),d.fromValues(-1,1,1),d.fromValues(1,-1,-1),d.fromValues(1,-1,1),d.fromValues(1,1,-1),d.fromValues(1,1,1)],r=Math.sqrt(3),u=[null],y=k.create(),z=d.create(),A=
d.create(),C=d.create(),E=new a,B=k.create(),D=k.create(),F=k.create(),K=k.create(),L=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],G=new a,O=[0,0,0,0,0,0,0,0];return x})},"esri/views/3d/webgl-engine/lib/UpdatePolicy":function(){define(["exports"],function(b){b.UpdatePolicy=void 0;var a=b.UpdatePolicy||(b.UpdatePolicy={});a[a.ASYNC=0]="ASYNC";a[a.SYNC=1]="SYNC";Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/RibbonLineMaterial":function(){define("exports ../../../../core/has ../../../../core/Logger ../../../../core/mathUtils ../../../../core/screenUtils ../../../../chunks/vec2 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/support/frustum ../../../../geometry/support/lineSegment ../../../../geometry/support/plane ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/Util ../lib/VertexAttribute ./VisualVariablePassParameters ../shaders/LineMarkerTechniqueConfiguration ../../../../chunks/RibbonLine.glsl ../shaders/RibbonLineTechnique ../shaders/RibbonLineTechniqueConfiguration".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A,C){function E(fa,ka,ha,ba,ea){for(let ca=0;ca<ea;ca++)ha[ba++]=fa[ka++];return ba}var B;(function(fa){fa[fa.LEFT_JOIN_START=-2]="LEFT_JOIN_START";fa[fa.LEFT_JOIN_END=-1]="LEFT_JOIN_END";fa[fa.LEFT_CAP_START=-4]="LEFT_CAP_START";fa[fa.LEFT_CAP_END=-5]="LEFT_CAP_END";fa[fa.RIGHT_JOIN_START=2]="RIGHT_JOIN_START";fa[fa.RIGHT_JOIN_END=1]="RIGHT_JOIN_END";fa[fa.RIGHT_CAP_START=4]="RIGHT_CAP_START";fa[fa.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(B||(B={}));
class D extends p.Material{constructor(fa){super(fa,new K);this._configuration=new C.RibbonLineTechniqueConfiguration;this._vertexAttributeLocations=A.vertexAttributeLocations}getConfiguration(fa,ka){this._configuration.output=fa;this._configuration.draped=ka.slot===h.RenderSlot.DRAPED_MATERIAL;fa=null!=this.parameters.stipplePattern&&fa!==v.ShaderOutput.Highlight;this._configuration.stippleEnabled=fa;this._configuration.stippleOffColorEnabled=fa&&null!=this.parameters.stippleOffColor;this._configuration.stipplePreferContinuous=
fa&&this.parameters.stipplePreferContinuous;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.hasOccludees=this.parameters.hasOccludees;this._configuration.roundJoins="round"===this.parameters.join;this._configuration.capType=this.parameters.cap;fa=this._configuration;if(null!=this.parameters.markerParameters){var ha=this.parameters.markerParameters;ha=ha.anchor===y.LineMarkerAnchor.Tip&&ha.hideOnShortSegments&&"begin-end"===ha.placement&&ha.worldSpace}else ha=!1;
fa.applyMarkerOffset=ha;this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset;this._configuration.writeDepth=this.parameters.writeDepth;this._configuration.vvSize=!!this.parameters.vvSize;this._configuration.vvColor=!!this.parameters.vvColor;this._configuration.vvOpacity=!!this.parameters.vvOpacity;this._configuration.innerColorEnabled=0<this.parameters.innerWidth&&null!=this.parameters.innerColor;this._configuration.falloffEnabled=0<this.parameters.falloff;this._configuration.occluder=
this.parameters.renderOccluded===p.RenderOccludedFlag.OccludeAndTransparentStencil;this._configuration.transparencyPassType=ka.transparencyPassType;this._configuration.multipassEnabled=ka.multipassEnabled;this._configuration.cullAboveGround=ka.multipassTerrain.cullAboveGround;this._configuration.wireframe=this.parameters.wireframe;return this._configuration}intersectDraped(fa,ka,ha,ba,ea,ca){if(ha.options.selectionMode){ka=fa.attributes.get(r.VertexAttribute.POSITION).data;ha=fa.attributes.get(r.VertexAttribute.SIZE);
var ia=this.parameters.width;this.parameters.vvSize?(ha=fa.attributes.get(r.VertexAttribute.SIZEFEATUREATTRIBUTE).data[0],ia*=d.clamp(this.parameters.vvSize.offset[0]+ha*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])):ha&&(ia*=ha.data[0]);ha=ba[0];ba=ba[1];fa=(ia/2+4)*fa.screenToWorldRatio;ia=Number.MAX_VALUE;var la=0;for(let ma=0;ma<ka.length-5;ma+=3){var oa=ka[ma],na=ka[ma+1],ra=ha-oa,ta=ba-na;oa=ka[ma+3]-oa;na=ka[ma+4]-na;const pa=d.clamp((oa*
ra+na*ta)/(oa*oa+na*na),0,1);ra=oa*pa-ra;ta=na*pa-ta;ta=ra*ra+ta*ta;ta<ia&&(ia=ta,la=ma/3)}ia<fa*fa&&ea(ca.dist,ca.normal,la,!1)}}intersect(fa,ka,ha,ba,ea,ca){if(ha.options.selectionMode&&fa.visible)if(t.isTranslationMatrix(ka)){var ia=fa.attributes;ba=ia.get(r.VertexAttribute.POSITION).data;fa=this.parameters.width;this.parameters.vvSize?(ea=ia.get(r.VertexAttribute.SIZEFEATUREATTRIBUTE).data[0],fa*=d.clamp(this.parameters.vvSize.offset[0]+ea*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],
this.parameters.vvSize.maxSize[0])):ia.has(r.VertexAttribute.SIZE)&&(fa*=ia.get(r.VertexAttribute.SIZE).data[0]);var la=ha.camera,oa=R;n.copy(oa,ha.point);ea=fa*la.pixelRatio/2+4*la.pixelRatio;k.set(Q[0],oa[0]-ea,oa[1]+ea,0);k.set(Q[1],oa[0]+ea,oa[1]+ea,0);k.set(Q[2],oa[0]+ea,oa[1]-ea,0);k.set(Q[3],oa[0]-ea,oa[1]-ea,0);for(fa=0;4>fa;fa++)if(!la.unprojectFromRenderScreen(Q[fa],N[fa]))return;l.fromPoints(la.eye,N[0],N[1],T);l.fromPoints(la.eye,N[1],N[2],aa);l.fromPoints(la.eye,N[2],N[3],Z);l.fromPoints(la.eye,
N[3],N[0],da);var na=Number.MAX_VALUE;fa=0;ia=this.parameters.isClosed&&2<ia.get(r.VertexAttribute.POSITION).indices.length?ba.length-2:ba.length-5;for(let ta=0;ta<ia;ta+=3){G[0]=ba[ta]+ka[12];G[1]=ba[ta+1]+ka[13];G[2]=ba[ta+2]+ka[14];var ra=(ta+3)%ba.length;O[0]=ba[ra]+ka[12];O[1]=ba[ra+1]+ka[13];O[2]=ba[ra+2]+ka[14];if(!(0>l.signedDistance(T,G)&&0>l.signedDistance(T,O)||0>l.signedDistance(aa,G)&&0>l.signedDistance(aa,O)||0>l.signedDistance(Z,G)&&0>l.signedDistance(Z,O)||0>l.signedDistance(da,G)&&
0>l.signedDistance(da,O))){la.projectToRenderScreen(G,X);la.projectToRenderScreen(O,U);if(0>X[2]&&0<U[2])k.subtract(P,G,O),ra=la.frustum,ra=-l.signedDistance(ra[e.PlaneIndex.NEAR],G)/k.dot(P,l.normal(ra[e.PlaneIndex.NEAR])),k.scale(P,P,ra),k.add(G,G,P),la.projectToRenderScreen(G,X);else if(0<X[2]&&0>U[2])k.subtract(P,O,G),ra=la.frustum,ra=-l.signedDistance(ra[e.PlaneIndex.NEAR],O)/k.dot(P,l.normal(ra[e.PlaneIndex.NEAR])),k.scale(P,P,ra),k.add(O,O,P),la.projectToRenderScreen(O,U);else if(0>X[2]&&0>
U[2])continue;X[2]=0;U[2]=0;ra=m.distance2(m.fromPoints(X,U,Y),oa);ra<na&&(na=ra,k.copy(M,G),k.copy(V,O),fa=ta/3)}}ka=ha.rayBegin;ha=ha.rayEnd;na<ea*ea&&(ba=Number.MAX_VALUE,m.closestLineSegmentPoint(m.fromPoints(M,V,Y),m.fromPoints(ka,ha,W),J)&&(k.subtract(J,J,ka),ba=k.length(J),k.scale(J,J,1/ba),ba/=k.distance(ka,ha)),ca(ba,J,fa,!1))}else c.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix")}get _layout(){const fa=w.newLayout().vec3f(r.VertexAttribute.POSITION).f32(r.VertexAttribute.SUBDIVISIONFACTOR).vec2f(r.VertexAttribute.UV0).vec3f(r.VertexAttribute.AUXPOS1).vec3f(r.VertexAttribute.AUXPOS2);
this.parameters.vvSize?fa.f32(r.VertexAttribute.SIZEFEATUREATTRIBUTE):fa.f32(r.VertexAttribute.SIZE);this.parameters.vvColor?fa.f32(r.VertexAttribute.COLORFEATUREATTRIBUTE):fa.vec4f(r.VertexAttribute.COLOR);this.parameters.vvOpacity&&fa.f32(r.VertexAttribute.OPACITYFEATUREATTRIBUTE);a("enable-feature:objectAndLayerId-rendering")&&fa.vec4u8(r.VertexAttribute.OBJECTANDLAYERIDCOLOR);return fa}createBufferWriter(){return new L(this._layout,this.parameters)}produces(fa,ka){return ka===v.ShaderOutput.Color||
ka===v.ShaderOutput.Alpha||ka===v.ShaderOutput.Highlight||ka===v.ShaderOutput.Depth||ka===v.ShaderOutput.ObjectAndLayerIdColor?fa===h.RenderSlot.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===p.RenderOccludedFlag.OccludeAndTransparentStencil?fa===h.RenderSlot.OPAQUE_MATERIAL||fa===h.RenderSlot.OCCLUDER_MATERIAL||fa===h.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL:ka===v.ShaderOutput.Color||ka===v.ShaderOutput.Alpha?fa===(this.parameters.writeDepth?h.RenderSlot.TRANSPARENT_MATERIAL:h.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):
fa===h.RenderSlot.OPAQUE_MATERIAL:!1}createGLMaterial(fa){return new F(fa)}validateParameters(fa){"miter"!==fa.join&&(fa.miterLimit=0);null!=fa.markerParameters&&(fa.markerScale=fa.markerParameters.width/fa.width)}}class F extends x{constructor(){super(...arguments);this._stipplePattern=null}dispose(){super.dispose();this._stippleTextureRepository.release(this._stipplePattern);this._stipplePattern=null}_updateOccludeeState(fa){fa.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:fa.hasOccludees})}beginSlot(fa){this._output!==
v.ShaderOutput.Color&&this._output!==v.ShaderOutput.Alpha||this._updateOccludeeState(fa);const ka=this._material.parameters.stipplePattern;this._stipplePattern!==ka&&(this._material.setParameters({stippleTexture:this._stippleTextureRepository.swap(ka,this._stipplePattern)}),this._stipplePattern=ka);return this.ensureTechnique(A.RibbonLineTechnique,fa)}}class K extends u.VisualVariablePassParameters{constructor(){super(...arguments);this.width=0;this.color=q.ONES;this.join="miter";this.cap=C.CapType.BUTT;
this.miterLimit=5;this.writeDepth=!0;this.hasPolygonOffset=!1;this.stippleTexture=null;this.stipplePreferContinuous=!0;this.markerParameters=null;this.markerScale=1;this.isClosed=this.vvFastUpdate=this.hasSlicePlane=!1;this.innerWidth=this.falloff=0;this.wireframe=this.hasOccludees=!1}}class L{constructor(fa,ka){this.vertexBufferLayout=fa;this._parameters=ka;this.numJoinSubdivisions=0;fa=ka.stipplePattern?1:0;switch(this._parameters.join){case "miter":case "bevel":this.numJoinSubdivisions=fa;break;
case "round":this.numJoinSubdivisions=z.ribbonlineNumRoundJoinSubdivisions+fa}}_isClosed(fa){return this._parameters.isClosed?2<fa.attributes.get(r.VertexAttribute.POSITION).indices.length:!1}allocate(fa){return this.vertexBufferLayout.createBuffer(fa)}elementCount(fa){var ka=fa.attributes.get(r.VertexAttribute.POSITION).indices.length/2+1;fa=this._isClosed(fa);ka=(fa?2:4)+((fa?ka:ka-1)-(fa?0:1))*(2*this.numJoinSubdivisions+4);ka+=2;this._parameters.wireframe&&(ka=2+4*(ka-2));return ka}write(fa,ka,
ha,ba,ea){ka=H;const ca=S,ia=I,la=ha.attributes.get(r.VertexAttribute.POSITION);var oa=la.indices;const na=la.data.length/3,ra=ha.attributes.get(r.VertexAttribute.DISTANCETOSTART)?.data;oa&&oa.length!==2*(na-1)&&console.warn("RibbonLineMaterial does not support indices");let ta=1,ma=0;const pa=this.vertexBufferLayout.fields.has(r.VertexAttribute.SIZEFEATUREATTRIBUTE);pa?ma=ha.attributes.get(r.VertexAttribute.SIZEFEATUREATTRIBUTE).data[0]:ha.attributes.has(r.VertexAttribute.SIZE)&&(ta=ha.attributes.get(r.VertexAttribute.SIZE).data[0]);
let ja=[1,1,1,1],qa=0;const ua=this.vertexBufferLayout.fields.has(r.VertexAttribute.COLORFEATUREATTRIBUTE);ua?qa=ha.attributes.get(r.VertexAttribute.COLORFEATUREATTRIBUTE).data[0]:ha.attributes.has(r.VertexAttribute.COLOR)&&(ja=ha.attributes.get(r.VertexAttribute.COLOR).data);const wa=a("enable-feature:objectAndLayerId-rendering")?ha.objectAndLayerIdColor:null;let za=0;const Aa=this.vertexBufferLayout.fields.has(r.VertexAttribute.OPACITYFEATUREATTRIBUTE);Aa&&(za=ha.attributes.get(r.VertexAttribute.OPACITYFEATUREATTRIBUTE).data[0]);
const Fa=new Float32Array(ba.buffer),Da=a("enable-feature:objectAndLayerId-rendering")?new Uint8Array(ba.buffer):null;oa=this.vertexBufferLayout.stride/4;let Ha=ea*oa;ea=Ha;let Ka=0;const La=ra?(ya,Ea,Ca)=>Ka=ra[Ca]:(ya,Ea,Ca)=>Ka+=k.distance(ya,Ea),Na=a("enable-feature:objectAndLayerId-rendering"),Ra=(ya,Ea,Ca,Ga,Ja,Ma,Ta)=>{Fa[Ha++]=Ea[0];Fa[Ha++]=Ea[1];Fa[Ha++]=Ea[2];Fa[Ha++]=Ga;Fa[Ha++]=Ta;Fa[Ha++]=Ja;Fa[Ha++]=ya[0];Fa[Ha++]=ya[1];Fa[Ha++]=ya[2];Fa[Ha++]=Ca[0];Fa[Ha++]=Ca[1];Fa[Ha++]=Ca[2];Fa[Ha++]=
pa?ma:ta;ua?Fa[Ha++]=qa:(ya=Math.min(4*Ma,ja.length-4),Fa[Ha++]=ja[ya],Fa[Ha++]=ja[ya+1],Fa[Ha++]=ja[ya+2],Fa[Ha++]=ja[ya+3]);Aa&&(Fa[Ha++]=za);Na&&(null!=wa&&(Da[4*Ha]=wa[0],Da[4*Ha+1]=wa[1],Da[4*Ha+2]=wa[2],Da[4*Ha+3]=wa[3]),Ha++)};Ha+=oa;k.set(ca,la.data[0],la.data[1],la.data[2]);fa&&k.transformMat4(ca,ca,fa);if(ha=this._isClosed(ha)){var Sa=la.data.length-3;k.set(ka,la.data[Sa],la.data[Sa+1],la.data[Sa+2]);fa&&k.transformMat4(ka,ka,fa)}else k.set(ia,la.data[3],la.data[4],la.data[5]),fa&&k.transformMat4(ia,
ia,fa),Ra(ca,ca,ia,1,B.LEFT_CAP_START,0,0),Ra(ca,ca,ia,1,B.RIGHT_CAP_START,0,0),k.copy(ka,ca),k.copy(ca,ia);Sa=ha?0:1;const sa=ha?na:na-1;for(let ya=Sa;ya<sa;ya++){var va=(ya+1)%na*3;k.set(ia,la.data[va],la.data[va+1],la.data[va+2]);fa&&k.transformMat4(ia,ia,fa);La(ka,ca,ya);Ra(ka,ca,ia,0,B.LEFT_JOIN_END,ya,Ka);Ra(ka,ca,ia,0,B.RIGHT_JOIN_END,ya,Ka);va=this.numJoinSubdivisions;for(let Ea=0;Ea<va;++Ea){const Ca=(Ea+1)/(va+1);Ra(ka,ca,ia,Ca,B.LEFT_JOIN_END,ya,Ka);Ra(ka,ca,ia,Ca,B.RIGHT_JOIN_END,ya,Ka)}Ra(ka,
ca,ia,1,B.LEFT_JOIN_START,ya,Ka);Ra(ka,ca,ia,1,B.RIGHT_JOIN_START,ya,Ka);k.copy(ka,ca);k.copy(ca,ia)}ha?(k.set(ia,la.data[3],la.data[4],la.data[5]),fa&&k.transformMat4(ia,ia,fa),Ka=La(ka,ca,sa),Ra(ka,ca,ia,0,B.LEFT_JOIN_END,Sa,Ka),Ra(ka,ca,ia,0,B.RIGHT_JOIN_END,Sa,Ka)):(Ka=La(ka,ca,sa),Ra(ka,ca,ca,0,B.LEFT_CAP_END,sa,Ka),Ra(ka,ca,ca,0,B.RIGHT_CAP_END,sa,Ka));E(Fa,ea+oa,Fa,ea,oa);Ha=E(Fa,Ha-oa,Fa,Ha,oa);this._parameters.wireframe&&this._addWireframeVertices(ba,ea,Ha,oa)}_addWireframeVertices(fa,ka,
ha,ba){const ea=new Float32Array(fa.buffer,ha*Float32Array.BYTES_PER_ELEMENT);fa=new Float32Array(fa.buffer,ka*Float32Array.BYTES_PER_ELEMENT,ha-ka);ka=0;for(ha=0;ha<fa.length-1;ha+=2*ba)ka=E(fa,ha,ea,ka,ba),ka=E(fa,ha+2*ba,ea,ka,ba),ka=E(fa,ha+1*ba,ea,ka,ba),ka=E(fa,ha+2*ba,ea,ka,ba),ka=E(fa,ha+1*ba,ea,ka,ba),ka=E(fa,ha+3*ba,ea,ka,ba)}}const G=g.create(),O=g.create(),P=g.create(),J=g.create(),R=g.create(),X=f.createRenderScreenPointArray3(),U=f.createRenderScreenPointArray3(),M=g.create(),V=g.create(),
Y=m.create(),W=m.create(),H=g.create(),S=g.create(),I=g.create(),Q=[f.createRenderScreenPointArray3(),f.createRenderScreenPointArray3(),f.createRenderScreenPointArray3(),f.createRenderScreenPointArray3()],N=[g.create(),g.create(),g.create(),g.create()],T=l.create(),aa=l.create(),Z=l.create(),da=l.create();b.Parameters=K;b.RibbonLineMaterial=D;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/LineMarkerTechniqueConfiguration":function(){define("exports ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/TransparencyPassType ../materials/DefaultTechniqueConfiguration".split(" "),
function(b,a,c,d,f,n){b.LineMarkerSpace=void 0;(function(g){g[g.Draped=0]="Draped";g[g.Screen=1]="Screen";g[g.World=2]="World";g[g.COUNT=3]="COUNT"})(b.LineMarkerSpace||(b.LineMarkerSpace={}));b.LineMarkerAnchor=void 0;(function(g){g[g.Center=0]="Center";g[g.Tip=1]="Tip";g[g.COUNT=2]="COUNT"})(b.LineMarkerAnchor||(b.LineMarkerAnchor={}));class k extends n.DefaultTechniqueConfiguration{constructor(){super(...arguments);this.output=c.ShaderOutput.Color;this.transparencyPassType=f.TransparencyPassType.NONE;
this.writeDepth=this.hasSlicePlane=this.occluder=!1;this.space=b.LineMarkerSpace.Screen;this.hasCap=this.hideOnShortSegments=!1;this.anchor=b.LineMarkerAnchor.Center;this.cullAboveGround=this.multipassEnabled=this.hasOccludees=this.vvOpacity=this.vvColor=this.vvSize=this.hasTip=!1}get draped(){return this.space===b.LineMarkerSpace.Draped}}a.__decorate([d.parameter({count:c.ShaderOutput.COUNT})],k.prototype,"output",void 0);a.__decorate([d.parameter({count:f.TransparencyPassType.COUNT})],k.prototype,
"transparencyPassType",void 0);a.__decorate([d.parameter()],k.prototype,"occluder",void 0);a.__decorate([d.parameter()],k.prototype,"hasSlicePlane",void 0);a.__decorate([d.parameter()],k.prototype,"writeDepth",void 0);a.__decorate([d.parameter({count:b.LineMarkerSpace.COUNT})],k.prototype,"space",void 0);a.__decorate([d.parameter()],k.prototype,"hideOnShortSegments",void 0);a.__decorate([d.parameter()],k.prototype,"hasCap",void 0);a.__decorate([d.parameter({count:b.LineMarkerAnchor.COUNT})],k.prototype,
"anchor",void 0);a.__decorate([d.parameter()],k.prototype,"hasTip",void 0);a.__decorate([d.parameter()],k.prototype,"vvSize",void 0);a.__decorate([d.parameter()],k.prototype,"vvColor",void 0);a.__decorate([d.parameter()],k.prototype,"vvOpacity",void 0);a.__decorate([d.parameter()],k.prototype,"hasOccludees",void 0);a.__decorate([d.parameter()],k.prototype,"multipassEnabled",void 0);a.__decorate([d.parameter()],k.prototype,"cullAboveGround",void 0);a.__decorate([d.parameter({constValue:!1})],k.prototype,
"occlusionPass",void 0);a.__decorate([d.parameter({constValue:!0})],k.prototype,"hasVvInstancing",void 0);a.__decorate([d.parameter({constValue:!0})],k.prototype,"hasSliceTranslatedView",void 0);b.LineMarkerTechniqueConfiguration=k;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/RibbonLine.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/ObjectAndLayerIdColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/RibbonVertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/LineStipple.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MarkerSizing.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/shaders/LineMarkerTechniqueConfiguration ../views/3d/webgl-engine/shaders/RibbonLineTechniqueConfiguration".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A,C){function E(D){const F=new u.ShaderBuilder,{vertex:K,fragment:L}=F,G=D.multipassEnabled&&(D.output===c.ShaderOutput.Color||D.output===c.ShaderOutput.Alpha);F.include(m.PiUtils);F.include(n.RibbonVertexPosition,D);F.include(g.LineStipple,D);const O=D.applyMarkerOffset&&!D.draped;O&&(K.uniforms.add(new h.FloatPassUniform("markerScale",V=>V.markerScale)),F.include(q.MarkerSizing,{space:A.LineMarkerSpace.World,draped:!1}));D.output===c.ShaderOutput.Depth&&
F.include(k.OutputDepth,D);F.include(f.ObjectAndLayerIdColor,D);v.addProjViewLocalOrigin(K,D);K.uniforms.add(new r.Matrix4PassUniform("inverseProjectionMatrix",(V,Y)=>Y.camera.inverseProjectionMatrix),new x.Float2PassUniform("nearFar",(V,Y)=>Y.camera.nearFar),new h.FloatPassUniform("miterLimit",V=>"miter"!==V.join?0:V.miterLimit),new p.Float4PassUniform("viewport",(V,Y)=>Y.camera.fullViewport));K.constants.add("LARGE_HALF_FLOAT","float",65500);F.attributes.add(z.VertexAttribute.POSITION,"vec3");F.attributes.add(z.VertexAttribute.SUBDIVISIONFACTOR,
"float");F.attributes.add(z.VertexAttribute.UV0,"vec2");F.attributes.add(z.VertexAttribute.AUXPOS1,"vec3");F.attributes.add(z.VertexAttribute.AUXPOS2,"vec3");F.varyings.add("vColor","vec4");F.varyings.add("vpos","vec3");a.addLinearDepth(F);G&&F.varyings.add("depth","float");const P=D.stippleEnabled;P&&F.varyings.add("vLineSizeInv","float");const J=D.capType===C.CapType.ROUND,R=P||J;R&&F.varyings.add("vLineWidth","float");const X=D.innerColorEnabled||J;X&&F.varyings.add("vLineDistance","float");const U=
D.stippleEnabled&&J,M=D.falloffEnabled||U;M&&F.varyings.add("vLineDistanceNorm","float");J&&(F.varyings.add("vSegmentSDF","float"),F.varyings.add("vReverseSegmentSDF","float"));K.code.add(t.glsl`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`);K.code.add(t.glsl`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`);a.addCalculateLinearDepth(F);K.code.add(t.glsl`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${G?"depth \x3d pos.z;":""}
      linearDepth = calculateLinearDepth(nearFar,pos.z);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `);v.addPixelRatio(K);K.code.add(t.glsl`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;

      float lineSize = getSize();
      float lineWidth = lineSize * pixelRatio;

      ${R?t.glsl`vLineWidth = lineWidth;`:""}
      ${P?t.glsl`vLineSizeInv = 1.0 / lineSize;`:""}

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);
  `);O&&K.code.add(t.glsl`vec4 other = isStartVertex ? next : prev;
bool markersHidden = areWorldMarkersHidden(pos, other);
if(!isJoin && !markersHidden) {
pos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;
}`);K.code.add(t.glsl`clipAndTransform(pos, prev, next, isStartVertex);
vec2 left = (pos.xy - prev.xy);
vec2 right = (next.xy - pos.xy);
float leftLen = length(left);
float rightLen = length(right);`);(D.stippleEnabled||J)&&K.code.add(t.glsl`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${J?t.glsl`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `);K.code.add(t.glsl`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`);D.roundJoins?K.code.add(t.glsl`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${D.stippleEnabled?t.glsl`min(1.0, subdivisionFactor * ${t.glsl.float(1.5)})`:t.glsl`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):K.code.add(t.glsl`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);K.code.add(t.glsl`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${D.capType!==C.CapType.BUTT?t.glsl`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `);K.code.add(t.glsl`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

    ${M||X?t.glsl`float lineDistNorm = sign(uv0.y) * pos.w;`:""}

    ${X?t.glsl`vLineDistance = lineWidth * lineDistNorm;`:""}
    ${M?t.glsl`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `);J&&K.code.add(t.glsl`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`);D.stippleEnabled&&(D.draped?K.uniforms.add(new h.FloatPassUniform("worldToScreenRatio",(V,Y)=>1/Y.screenToPCSRatio)):K.code.add(t.glsl`vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),K.code.add(t.glsl`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),D.draped?K.code.add(t.glsl`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):K.code.add(t.glsl`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),K.uniforms.add(new h.FloatPassUniform("stipplePatternPixelSize",V=>g.computePixelSize(V))),K.code.add(t.glsl`float patternLength = lineSize * stipplePatternPixelSize;
vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);
vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);
if (segmentLengthScreenDouble >= 0.001) {
vec2 stippleDisplacement = pos.xy - segmentOrigin;
float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);
vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
}
vStippleDistanceLimits *= pos.w;
vStippleDistance *= pos.w;
vStippleDistanceLimits = isJoin ?
vStippleDistanceLimits :
isStartVertex ?
vec2(-1e34, vStippleDistanceLimits.y) :
vec2(vStippleDistanceLimits.x, 1e34);`));K.code.add(t.glsl`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${D.wireframe&&!D.draped?"pos.z -\x3d 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
      forwardObjectAndLayerIdColor();
    }
  }
  `);G&&F.include(e.multipassTerrainTest,D);F.include(d.SliceDraw,D);L.include(w.ColorConversion);L.code.add(t.glsl`
  void main() {
    discardBySlice(vpos);
    ${G?"terrainDepthTest(depth);":""}
  `);D.wireframe?L.code.add(t.glsl`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(J&&L.code.add(t.glsl`
      float sdf = min(vSegmentSDF, vReverseSegmentSDF);
      vec2 fragmentPosition = vec2(
        min(sdf, 0.0),
        vLineDistance
      ) * gl_FragCoord.w;

      float fragmentRadius = length(fragmentPosition);
      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

      if (capCoverage < ${t.glsl.float(l.symbolAlphaCutoff)}) {
        discard;
      }
    `),U?L.code.add(t.glsl`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${t.glsl.float(l.symbolAlphaCutoff)}, stippleCoverage);
      `):L.code.add(t.glsl`float stippleAlpha = getStippleAlpha();`),D.output!==c.ShaderOutput.ObjectAndLayerIdColor&&L.code.add(t.glsl`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);`),L.uniforms.add(new p.Float4PassUniform("intrinsicColor",V=>V.color)),L.code.add(t.glsl`vec4 color = intrinsicColor * vColor;`),D.innerColorEnabled&&(L.uniforms.add(new p.Float4PassUniform("innerColor",V=>V.innerColor??V.color),new h.FloatPassUniform("innerWidth",(V,Y)=>V.innerWidth*Y.camera.pixelRatio)),
L.code.add(t.glsl`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),L.code.add(t.glsl`vec4 finalColor = blendStipple(color, stippleAlpha);`),D.falloffEnabled&&(L.uniforms.add(new h.FloatPassUniform("falloff",V=>V.falloff)),L.code.add(t.glsl`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`)));L.code.add(t.glsl`
    ${D.output===c.ShaderOutput.ObjectAndLayerIdColor?t.glsl`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${t.glsl.float(l.symbolAlphaCutoff)}) {
      discard;
    }

    ${D.output===c.ShaderOutput.Alpha?t.glsl`fragColor = vec4(finalColor.a);`:""}
    ${D.output===c.ShaderOutput.Color?t.glsl`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${D.output===c.ShaderOutput.Color&&D.transparencyPassType===y.TransparencyPassType.Color?"fragColor \x3d premultiplyAlpha(fragColor);":""}
    ${D.output===c.ShaderOutput.Highlight?t.glsl`fragColor = vec4(1.0);`:""}
    ${D.output===c.ShaderOutput.Depth?t.glsl`outputDepth(linearDepth);`:""}
    ${D.output===c.ShaderOutput.ObjectAndLayerIdColor?t.glsl`outputObjectAndLayerIdColor();`:""}
  }
  `);return F}const B=Object.freeze(Object.defineProperty({__proto__:null,build:E,ribbonlineNumRoundJoinSubdivisions:1},Symbol.toStringTag,{value:"Module"}));b.RibbonLine=B;b.build=E;b.ribbonlineNumRoundJoinSubdivisions=1})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/RibbonVertexPosition.glsl":function(){define("exports ../shading/VisualVariables.glsl ../../shaderModules/Float3PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/FloatsPassUniform ../../shaderModules/interfaces ../../../lib/VertexAttribute".split(" "),
function(b,a,c,d,f,n,k){b.RibbonVertexPosition=function(g,q){const e=g.vertex;e.uniforms.add(new d.FloatPassUniform("intrinsicWidth",m=>m.width));q.vvSize?(g.attributes.add(k.VertexAttribute.SIZEFEATUREATTRIBUTE,"float"),e.uniforms.add(new c.Float3PassUniform("vvSizeMinSize",m=>m.vvSize.minSize),new c.Float3PassUniform("vvSizeMaxSize",m=>m.vvSize.maxSize),new c.Float3PassUniform("vvSizeOffset",m=>m.vvSize.offset),new c.Float3PassUniform("vvSizeFactor",m=>m.vvSize.factor)),e.code.add(n.glsl`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(g.attributes.add(k.VertexAttribute.SIZE,"float"),e.code.add(n.glsl`float getSize(){
return intrinsicWidth * size;
}`));q.vvOpacity?(g.attributes.add(k.VertexAttribute.OPACITYFEATUREATTRIBUTE,"float"),e.constants.add("vvOpacityNumber","int",8),e.uniforms.add(new f.FloatsPassUniform("vvOpacityValues",m=>m.vvOpacity.values,8),new f.FloatsPassUniform("vvOpacityOpacities",m=>m.vvOpacity.opacityValues,8)),e.code.add(n.glsl`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):e.code.add(n.glsl`vec4 applyOpacity( vec4 color ){
return color;
}`);q.vvColor?(g.include(a.VisualVariables,q),g.attributes.add(k.VertexAttribute.COLORFEATUREATTRIBUTE,"float"),e.code.add(n.glsl`vec4 getColor(){
return applyOpacity(interpolateVVColor(colorFeatureAttribute));
}`)):(g.attributes.add(k.VertexAttribute.COLOR,"vec4"),e.code.add(n.glsl`vec4 getColor(){
return applyOpacity(color);
}`))};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/LineStipple.glsl":function(){define("exports ../util/RgbaFloatEncoding.glsl ../util/View.glsl ../../shaderModules/Float4PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform ../../../materials/stippleTextureRepository ../../../shaders/ensureColor4".split(" "),function(b,a,c,d,f,n,k,g,q){function e(w,v){const x=
!(v.draped&&v.stipplePreferContinuous),{vertex:p,fragment:h}=w;h.include(a.RgbaFloatEncoding);v.draped||(c.addCameraPosition(p,v),p.uniforms.add(new f.FloatPassUniform("worldToScreenPerDistanceRatio",(t,r)=>1/r.camera.perScreenPixelRatio)),p.code.add(n.glsl`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`));w.varyings.add("vStippleDistance","float");w.varyings.add("vStippleDistanceLimits","vec2");w.varyings.add("vStipplePatternStretch","float");p.code.add(n.glsl`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${l};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `);p.code.add(n.glsl`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`);p.code.add(n.glsl`
    if (segmentLengthPseudoScreen >= ${x?"patternLength":"1e4"}) {
  `);c.addPixelRatio(p);p.code.add(n.glsl`float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
float segmentLengthScreenRounded = flooredRepetitions * patternLength;
float stretch = repetitions / flooredRepetitions;
vStipplePatternStretch = max(0.75, stretch);
return vec2(0.0, segmentLengthScreenRounded);
}
return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
}`);h.uniforms.add(new k.Texture2DPassUniform("stipplePatternTexture",t=>t.stippleTexture),new f.FloatPassUniform("stipplePatternSDFNormalizer",t=>(t=t.stipplePattern)?(Math.floor(.5*(g.computeLongestPattern(t)-1))+.5)/t.pixelRatio:1),new f.FloatPassUniform("stipplePatternPixelSizeInv",t=>1/m(t)));h.code.add(n.glsl`float getStippleSDF(out bool isClamped) {
float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;
float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv * vLineSizeInv;
u = fract(u);
float encodedSDF = rgba2float(texture(stipplePatternTexture, vec2(u, 0.5)));
float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;
return (sdf - 0.5) * vStipplePatternStretch + 0.5;
}
float getStippleSDF() {
bool ignored;
return getStippleSDF(ignored);
}
float getStippleAlpha() {
bool isClamped;
float stippleSDF = getStippleSDF(isClamped);
float antiAliasedResult = clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);
return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
}`);v.stippleOffColorEnabled?(h.uniforms.add(new d.Float4PassUniform("stippleOffColor",t=>q.ensureColor4(t.stippleOffColor))),h.code.add(n.glsl`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):h.code.add(n.glsl`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function m(w){const v=w.stipplePattern;return v?g.computeTextureSize(w.stipplePattern)/v.pixelRatio:1}const l=n.glsl.float(.4);b.LineStipple=function(w,v){w.constants.add("stippleAlphaColorDiscard","float",.001);w.constants.add("stippleAlphaHighlightDiscard","float",.5);v.stippleEnabled?e(w,v):w.fragment.code.add(n.glsl`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)};b.computePixelSize=m;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/stippleTextureRepository":function(){define("exports ../../../../core/floatRGBA ./ProceduralTextureRepository ../../../webgl/enums ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),function(b,a,c,d,f,n){function k(e){return e.pattern.map(m=>Math.round(m*e.pixelRatio))}function g(e){if(null==e)return 1;e=k(e);
return Math.floor(e.reduce((m,l)=>m+l))}function q(e){return k(e).reduce((m,l)=>Math.max(m,l))}b.computeLongestPattern=q;b.computeTextureSize=g;b.createStippleTextureRepository=function(e,m){return new c.ProceduralTextureRepository(l=>{var w=k(l),v=1/l.pixelRatio,x=g(l);l=q(l);const p=(Math.floor(.5*(l-1))+.5)*v;l=[];let h=1;for(var t of w){for(let y=0;y<t;y++)l.push(h*(Math.min(y,t-1-y)+.5)*v/p*.5+.5);h=-h}w=Math.round(w[0]/2);w=[...l.slice(w),...l.slice(0,w)];v=new Uint8Array(4*x);t=0;for(const y of w)a.packFloatRGBA(y,
v,t),t+=4;const {encodedData:r,textureSize:u}={encodedData:v,textureSize:x};x=new n.TextureDescriptor;x.internalFormat=d.PixelFormat.RGBA;x.width=u;x.height=1;x.wrapMode=d.TextureWrapMode.REPEAT;return new f.Texture(e,x,r)},l=>`${l.pattern.join(",")}-r${l.pixelRatio}`,m)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/core/floatRGBA":function(){define(["exports","./mathUtils"],function(b,a){function c(k,g=0){let q=0;for(let e=0;4>e;e++)q+=k[g+e]*f[e];return q}const d=[1,256,
65536,16777216],f=[1/256,1/65536,1/16777216,1/4294967296],n=c(new Uint8ClampedArray([255,255,255,255]));b.packFloatRGBA=function(k,g,q=0){k=a.clamp(k,0,n);for(let l=0;4>l;l++){var e=Math,m=k*d[l];g[q+l]=e.floor.call(e,256*(m-Math.floor(m)))}};b.unpackFloatRGBA=c;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/ProceduralTextureRepository":function(){define(["exports","../../../../core/uid"],function(b,a){class c{constructor(f,n,k){this._createTexture=
f;this._parametersKey=n;this._repository=new Map;this._orphanCache=k.newCache(`procedural-texture-repository:${a.generateUID()}`,g=>g.dispose())}destroy(){for(const [,{texture:f}]of this._repository)f.dispose();this._repository.clear();this._orphanCache.destroy()}swap(f,n=null){f=this._acquire(f);this.release(n);return f}release(f){if(null!=f){f=this._parametersKey(f);var n=this._repository.get(f);n&&(n.refCount--,0===n.refCount&&(this._repository.delete(f),{texture:n}=n,this._orphanCache.put(f,n,
n.gpuMemoryUsage)))}}_acquire(f){if(null==f)return null;const n=this._parametersKey(f);var k=this._repository.get(n);if(k)return k.refCount++,k.texture;f=this._orphanCache.pop(n)??this._createTexture(f);k=new d(f);this._repository.set(n,k);return f}}class d{constructor(f){this.texture=f;this.refCount=1}}b.ProceduralTextureRepository=c;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/ensureColor4":function(){define(["exports","../../../../chunks/vec4",
"../../../../chunks/vec4f64"],function(b,a,c){const d=c.create();b.ensureColor4=function(f){return null==f?c.ZEROS:4===f.length?f:a.set(d,f[0],f[1],f[2],1)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/MarkerSizing.glsl":function(){define("exports ../../../../support/engineContent/marker ../util/View.glsl ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../../shaders/LineMarkerTechniqueConfiguration".split(" "),
function(b,a,c,d,f,n){b.MarkerSizing=function(k,g){const {vertex:q,constants:e}=k;e.add("markerSizePerLineWidth","float",a.markerSizePerLineWidth);c.addPixelRatio(q);null==q.uniforms.get("markerScale")&&q.constants.add("markerScale","float",1);q.code.add(f.glsl`float getLineWidth() {
return max(getSize(), 1.0) * pixelRatio;
}
float getScreenMarkerSize() {
return markerSizePerLineWidth * markerScale * getLineWidth();
}`);g.space===n.LineMarkerSpace.World&&(q.constants.add("maxSegmentLengthFraction","float",.45),q.uniforms.add(new d.FloatPassUniform("perRenderPixelRatio",(m,l)=>l.camera.perRenderPixelRatio)),q.code.add(f.glsl`bool areWorldMarkersHidden(vec4 pos, vec4 other) {
vec3 midPoint = mix(pos.xyz, other.xyz, 0.5);
float distanceToCamera = length(midPoint);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
float worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;
float segmentLen = length(pos.xyz - other.xyz);
return worldMarkerSize > maxSegmentLengthFraction * segmentLen;
}
float getWorldMarkerSize(vec4 pos) {
float distanceToCamera = length(pos.xyz);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
return getScreenMarkerSize() * screenToWorldRatio;
}`))};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/engineContent/marker":function(){define(["exports","./sdfPrimitives","../../../webgl/enums","../../../webgl/Texture","../../../webgl/TextureDescriptor"],function(b,a,c,d,f){b.createMarkerTexture=function(n,k){n=a.createPrimitive(n,64,32,6.4);const g=new f.TextureDescriptor;g.internalFormat=c.PixelFormat.RGBA;g.width=64;g.height=64;g.wrapMode=c.TextureWrapMode.CLAMP_TO_EDGE;return new d.Texture(k,g,n)};b.markerSizePerLineWidth=
10;b.markerSymbolSize=32;b.markerTextureSize=64;b.markerThickness=6.4;b.markerTipThicknessFactor=.25;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/engineContent/sdfPrimitives":function(){define(["exports","../../../../core/has","../../../../core/floatRGBA","../../webgl-engine/lib/Texture","../../../webgl/enums"],function(b,a,c,d,f){function n(r,u=128,y=.5*u,z=0){switch(r){case "circle":return k(u,y);case "square":return g(u,y);case "cross":return e(u,y,z);
case "x":return m(u,y,z);case "kite":return q(u,y);case "triangle":return l(u,y);case "arrow":return w(u,y);default:return k(u,y)}}function k(r,u){const y=r/2-.5;return t(r,p(y,y,u/2))}function g(r,u){return v(r,u,!1)}function q(r,u){return v(r,u,!0)}function e(r,u,y=0){return x(r,u,!1,y)}function m(r,u,y=0){return x(r,u,!0,y)}function l(r,u){return t(r,h(r/2,u,u/2))}function w(r,u){const y=u/2,z=r/2,A=.8*u,C=p(z,(r-u)/2-A,Math.sqrt(A*A+y*y)),E=h(z,u,y);return t(r,(B,D)=>Math.max(E(B,D),-C(B,D)))}
function v(r,u,y){y&&(u/=Math.SQRT2);return t(r,(z,A)=>{z=z-.5*r+.25;A=-A+.5*r-.75;if(y){const C=(z+A)/Math.SQRT2;A=(A-z)/Math.SQRT2;z=C}return Math.max(Math.abs(z),Math.abs(A))-.5*u})}function x(r,u,y,z=0){u-=z;y&&(u*=Math.SQRT2);const A=.5*u;return t(r,(C,E)=>{C-=.5*r;E=-E+.5*r-1;if(y){const B=(C+E)/Math.SQRT2;E=(E-C)/Math.SQRT2;C=B}C=Math.abs(C);E=Math.abs(E);C=C>E?C>A?Math.sqrt((C-A)*(C-A)+E*E):E:E>A?Math.sqrt(C*C+(E-A)*(E-A)):C;return C-=z/2})}function p(r,u,y){return(z,A)=>{z-=r;A-=u;return Math.sqrt(z*
z+A*A)-y}}function h(r,u,y){const z=Math.sqrt(u*u+y*y);return(A,C)=>{C=C-r+u/2+.75;return Math.max((u*(Math.abs(A-r)-y)+y*C)/z,-C)}}function t(r,u){const y=new Uint8Array(4*r*r);for(let z=0;z<r;z++)for(let A=0;A<r;A++){const C=A+r*z;let E=u(A,z);E=E/r+.5;c.packFloatRGBA(E,y,4*C)}return y}b.createArrow=w;b.createCircle=k;b.createCross=e;b.createKite=q;b.createPrimitive=n;b.createSquare=g;b.createTexture=function(r,u=128,y=.5*u,z=0){r=n(r,u,y,z);return new d.Texture(r,{mipmap:!1,wrap:{s:f.TextureWrapMode.CLAMP_TO_EDGE,
t:f.TextureWrapMode.CLAMP_TO_EDGE},width:u,height:u,components:4,noUnpackFlip:!0,reloadable:!0})};b.createTriangle=l;b.createX=m;b.defaultSymbolSizeRatio=.5;b.defaultTexSize=128;b.requiresHalfTexelOffset=function(r){return"cross"===r||"x"===r};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Texture":function(){define("exports ../../../../core/has ../../../../core/Error ../../../../core/Evented ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/typedArrayUtil ../../../../core/urlUtils ../../../../support/requestImageUtils ../../../../support/requestUtils ./basicInterfaces ./BasisUtil ./ContentObject ./ContentObjectType ./DDSUtil ./textureUtils ./Util ../../../webgl/enums ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u){function y(E){return E instanceof HTMLVideoElement?{width:E.videoWidth,height:E.videoHeight}:E}class z extends w.ContentObject{get parameters(){return this._parameters}constructor(E,B){super();this._data=E;this.type=v.ContentObjectType.Texture;this._loadingController=this._loadingPromise=this._glTexture=null;this.events=new d;this._parameters={...C,...B};this._startPreload(E)}dispose(){this.unload();this._data=this.frameUpdate=void 0}_startPreload(E){null!=
E&&(E instanceof HTMLVideoElement?(this.frameUpdate=B=>this._frameUpdate(E,B),this._startPreloadVideoElement(E)):E instanceof HTMLImageElement&&this._startPreloadImageElement(E))}_startPreloadVideoElement(E){if(!(g.isBlobProtocol(E.src)||"auto"===E.preload&&E.crossOrigin)){E.preload="auto";E.crossOrigin="anonymous";const B=!E.paused;E.src=E.src;if(B&&E.autoplay){const D=()=>{E.removeEventListener("canplay",D);E.play()};E.addEventListener("canplay",D)}}}_startPreloadImageElement(E){g.isDataProtocol(E.src)||
g.isBlobProtocol(E.src)||E.crossOrigin||(E.crossOrigin="anonymous",E.src=E.src)}_createDescriptor(E){const B=new u.TextureDescriptor;B.wrapMode=this._parameters.wrap??t.TextureWrapMode.REPEAT;B.flipped=!this._parameters.noUnpackFlip;B.samplingMode=this._parameters.mipmap?t.TextureSamplingMode.LINEAR_MIPMAP_LINEAR:t.TextureSamplingMode.LINEAR;B.hasMipmap=!!this._parameters.mipmap;B.preMultiplyAlpha=!!this._parameters.preMultiplyAlpha;B.maxAnisotropy=this._parameters.maxAnisotropy??(this._parameters.mipmap?
E.parameters.maxMaxAnisotropy:1);return B}get glTexture(){return this._glTexture}get memoryEstimate(){var E;if(!(E=this._glTexture?.gpuMemoryUsage)){E=this._data;var B=this._parameters;if(null==E)E=0;else if(k.isArrayBuffer(E)||k.isUint8Array(E))E=B.encoding===m.TextureEncodingMimeType.KTX2_ENCODING?l.estimateMemoryKTX2(E,!!B.mipmap):B.encoding===m.TextureEncodingMimeType.BASIS_ENCODING?l.estimateMemoryBasis(E,!!B.mipmap):E.byteLength;else{var {width:D,height:F}=E instanceof Image||E instanceof ImageData||
E instanceof HTMLCanvasElement||E instanceof HTMLVideoElement?y(E):B;E=(B.mipmap?4/3:1)*D*F*(B.components||4)||0}}return E}load(E){if(this._glTexture)return this._glTexture;if(this._loadingPromise)return this._loadingPromise;const B=this._data;if(null==B)return this._glTexture=new r.Texture(E,this._createDescriptor(E),null);this._parameters.reloadable||(this._data=void 0);return"string"===typeof B?this._loadFromURL(E,B):B instanceof Image?this._loadFromImageElement(E,B):B instanceof HTMLVideoElement?
this._loadFromVideoElement(E,B):B instanceof ImageData||B instanceof HTMLCanvasElement?this._loadFromImage(E,B):(k.isArrayBuffer(B)||k.isUint8Array(B))&&this._parameters.encoding===m.TextureEncodingMimeType.DDS_ENCODING?this._loadFromDDSData(E,B):(k.isArrayBuffer(B)||k.isUint8Array(B))&&this._parameters.encoding===m.TextureEncodingMimeType.KTX2_ENCODING?this._loadFromKTX2(E,B):(k.isArrayBuffer(B)||k.isUint8Array(B))&&this._parameters.encoding===m.TextureEncodingMimeType.BASIS_ENCODING?this._loadFromBasis(E,
B):k.isUint8Array(B)?this._loadFromPixelData(E,B):k.isArrayBuffer(B)?this._loadFromPixelData(E,new Uint8Array(B)):null}_frameUpdate(E,B){if(null==this._glTexture||E.readyState<A.HAVE_CURRENT_DATA||B===E.currentTime)return B;this._glTexture.setData(E);this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap();this._parameters.updateCallback&&this._parameters.updateCallback();return E.currentTime}_loadFromDDSData(E,B){return this._glTexture=x.createDDSTexture(E,this._createDescriptor(E),
B)}_loadFromKTX2(E,B){return this._loadAsync(()=>l.createTextureKTX2(E,this._createDescriptor(E),B).then(D=>this._glTexture=D))}_loadFromBasis(E,B){return this._loadAsync(()=>l.createTextureBasis(E,this._createDescriptor(E),B).then(D=>this._glTexture=D))}_loadFromPixelData(E,B){h.assert(0<this._parameters.width&&0<this._parameters.height);const D=this._createDescriptor(E);D.pixelFormat=1===this._parameters.components?t.PixelFormat.LUMINANCE:3===this._parameters.components?t.PixelFormat.RGB:t.PixelFormat.RGBA;
D.width=this._parameters.width??0;D.height=this._parameters.height??0;return this._glTexture=new r.Texture(E,D,B)}_loadFromURL(E,B){return this._loadAsync(async D=>{const F=await q.requestImage(B,{signal:D});n.throwIfAborted(D);return this._loadFromImage(E,F)})}_loadFromImageElement(E,B){return B.complete?this._loadFromImage(E,B):this._loadAsync(async D=>{const F=await e.loadImageAsync(B,B.src,!1,D);n.throwIfAborted(D);return this._loadFromImage(E,F)})}_loadFromVideoElement(E,B){return B.readyState>=
A.HAVE_CURRENT_DATA?this._loadFromImage(E,B):this._loadFromVideoElementAsync(E,B)}_loadFromVideoElementAsync(E,B){return this._loadAsync(D=>new Promise((F,K)=>{const L=()=>{B.removeEventListener("loadeddata",G);B.removeEventListener("error",O);f.removeMaybe(P)},G=()=>{B.readyState>=A.HAVE_CURRENT_DATA&&(L(),F(this._loadFromImage(E,B)))},O=J=>{L();K(J||new c("Failed to load video"))};B.addEventListener("loadeddata",G);B.addEventListener("error",O);const P=n.onAbort(D,()=>O(n.createAbortError()))}))}_loadFromImage(E,
B){if(!(B instanceof HTMLVideoElement)){var {maxTextureSize:D}=E.parameters;B=this._parameters.downsampleUncompressed?p.downsampleImage(B,D):p.ensureImageMaxSize(B,D)}D=y(B);this._parameters.width=D.width;this._parameters.height=D.height;const F=this._createDescriptor(E);F.pixelFormat=3===this._parameters.components?t.PixelFormat.RGB:t.PixelFormat.RGBA;F.width=D.width;F.height=D.height;return this._glTexture=new r.Texture(E,F,B)}_loadAsync(E){const B=new AbortController;this._loadingController=B;
const D=E(B.signal);this._loadingPromise=D;E=()=>{this._loadingController===B&&(this._loadingController=null);this._loadingPromise===D&&(this._loadingPromise=null)};D.then(E,E);return D}unload(){this._glTexture=f.disposeMaybe(this._glTexture);if(null!=this._loadingController){const E=this._loadingController;this._loadingPromise=this._loadingController=null;E.abort()}this.events.emit("unloaded")}}var A;(function(E){E[E.HAVE_NOTHING=0]="HAVE_NOTHING";E[E.HAVE_METADATA=1]="HAVE_METADATA";E[E.HAVE_CURRENT_DATA=
2]="HAVE_CURRENT_DATA";E[E.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA";E[E.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"})(A||(A={}));const C={wrap:{s:t.TextureWrapMode.REPEAT,t:t.TextureWrapMode.REPEAT},mipmap:!0,noUnpackFlip:!1,preMultiplyAlpha:!1,downsampleUncompressed:!1};b.Texture=z;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/support/requestImageUtils":function(){define(["exports","../request"],function(b,a){b.requestImage=async function(c,d){({data:c}=await a(c,{responseType:"image",
...d}));return c};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/BasisUtil":function(){define("exports ../../../../libs/basisu/BasisU ../../../../libs/basisu/TextureFormat ../../../webgl/enums ../../../webgl/Texture ../../../webgl/Util".split(" "),function(b,a,c,d,f,n){async function k(){null==w&&(w=a.getBasisTranscoder(),l=await w);return w}function g(v,x,p,h,t){x=n.getBytesPerElementFormat(x?d.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC:d.CompressedTextureFormat.COMPRESSED_RGB8_ETC2);
return Math.ceil(p*h*x*(t&&1<v?(4**v-1)/(3*4**(v-1)):1))}function q(v){return 1<=v.getNumImages()&&!v.isUASTC()}function e(v){return 1<=v.getFaces()&&v.isETC1S()}function m(v,x,p,h,t,r,u,y){const {compressedTextureETC:z,compressedTextureS3TC:A}=v.capabilities,[C,E]=z?h?[c.TextureFormat.ETC2_RGBA,d.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC]:[c.TextureFormat.ETC1_RGB,d.CompressedTextureFormat.COMPRESSED_RGB8_ETC2]:A?h?[c.TextureFormat.BC3_RGBA,d.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT]:
[c.TextureFormat.BC1_RGB,d.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT]:[c.TextureFormat.RGBA32,d.PixelFormat.RGBA];p=x.hasMipmap?p:Math.min(1,p);h=[];for(let B=0;B<p;B++)h.push(new Uint8Array(u(B,C))),y(B,C,h[B]);x.internalFormat=E;x.hasMipmap=1<h.length;x.samplingMode=x.hasMipmap?d.TextureSamplingMode.LINEAR_MIPMAP_LINEAR:d.TextureSamplingMode.LINEAR;x.width=t;x.height=r;return new f.Texture(v,x,{type:"compressed",levels:h})}let l=null,w=null;b.createTextureBasis=async function(v,x,p){null==
l&&(l=await k());const h=new l.BasisFile(new Uint8Array(p));if(!q(h))return null;h.startTranscoding();v=m(v,x,h.getNumLevels(0),h.getHasAlpha(),h.getImageWidth(0,0),h.getImageHeight(0,0),(t,r)=>h.getImageTranscodedSizeInBytes(0,t,r),(t,r,u)=>h.transcodeImage(u,0,t,r,0,0));h.close();h.delete();return v};b.createTextureKTX2=async function(v,x,p){null==l&&(l=await k());const h=new l.KTX2File(new Uint8Array(p));if(!e(h))return null;h.startTranscoding();v=m(v,x,h.getLevels(),h.getHasAlpha(),h.getWidth(),
h.getHeight(),(t,r)=>h.getImageTranscodedSizeInBytes(t,0,0,r),(t,r,u)=>h.transcodeImage(u,t,0,0,r,0,-1,-1));h.close();h.delete();return v};b.estimateMemoryBasis=function(v,x){if(null==l)return v.byteLength;v=new l.BasisFile(new Uint8Array(v));x=q(v)?g(v.getNumLevels(0),v.getHasAlpha(),v.getImageWidth(0,0),v.getImageHeight(0,0),x):0;v.close();v.delete();return x};b.estimateMemoryKTX2=function(v,x){if(null==l)return v.byteLength;v=new l.KTX2File(new Uint8Array(v));x=e(v)?g(v.getLevels(),v.getHasAlpha(),
v.getWidth(),v.getHeight(),x):0;v.close();v.delete();return x};b.loadBasis=k;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/libs/basisu/BasisU":function(){define(["require","exports","../../assets"],function(b,a,c){let d;a.getBasisTranscoder=function(){if(null==d){const f=n=>c.getAssetUrl(`esri/libs/basisu/${n}`);d=(new Promise((n,k)=>b(["../../chunks/basis_transcoder"],n,k))).then(n=>n.basis_transcoder).then(({default:n})=>n({locateFile:f}).then(k=>{k.initializeBasis();delete k.then;
return k}))}return d};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/libs/basisu/TextureFormat":function(){define(["exports"],function(b){b.TextureFormat=void 0;var a=b.TextureFormat||(b.TextureFormat={});a[a.ETC1_RGB=0]="ETC1_RGB";a[a.ETC2_RGBA=1]="ETC2_RGBA";a[a.BC1_RGB=2]="BC1_RGB";a[a.BC3_RGBA=3]="BC3_RGBA";a[a.BC4_R=4]="BC4_R";a[a.BC5_RG=5]="BC5_RG";a[a.BC7_M6_RGB=6]="BC7_M6_RGB";a[a.BC7_M5_RGBA=7]="BC7_M5_RGBA";a[a.PVRTC1_4_RGB=8]="PVRTC1_4_RGB";a[a.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA";
a[a.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA";a[a.ATC_RGB=11]="ATC_RGB";a[a.ATC_RGBA=12]="ATC_RGBA";a[a.FXT1_RGB=17]="FXT1_RGB";a[a.PVRTC2_4_RGB=18]="PVRTC2_4_RGB";a[a.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA";a[a.ETC2_EAC_R11=20]="ETC2_EAC_R11";a[a.ETC2_EAC_RG11=21]="ETC2_EAC_RG11";a[a.RGBA32=13]="RGBA32";a[a.RGB565=14]="RGB565";a[a.BGR565=15]="BGR565";a[a.RGBA4444=16]="RGBA4444";Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/DDSUtil":function(){define(["exports",
"../../../../core/Logger","../../../webgl/enums","../../../webgl/Texture"],function(b,a,c,d){function f(m){return m.charCodeAt(0)+(m.charCodeAt(1)<<8)+(m.charCodeAt(2)<<16)+(m.charCodeAt(3)<<24)}function n(m,l){var w=new Int32Array(m,0,31);if(542327876!==w[0])return k.error("Invalid magic number in DDS header"),null;if(!(w[20]&4))return k.error("Unsupported format, must contain a FourCC code"),null;var v=w[21];let x;switch(v){case g:v=8;x=c.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT;break;
case q:v=16;x=c.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case e:v=16;x=c.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return k.error("Unsupported FourCC code:",String.fromCharCode(v&255,v>>8&255,v>>16&255,v>>24&255)),null}let p=1,h=w[4],t=w[3];if(0!==(h&3)||0!==(t&3))k.warn("Rounding up compressed texture size to nearest multiple of 4."),h=h+3&-4,t=t+3&-4;const r=h,u=t;w[2]&131072&&!1!==l&&(p=Math.max(1,w[7]));let y=w[1]+4;const z=[];for(let A=0;A<p;++A)w=
(h+3>>2)*(t+3>>2)*v,l=new Uint8Array(m,y,w),z.push(l),y+=w,h=Math.max(1,h>>1),t=Math.max(1,t>>1);return{textureData:{type:"compressed",levels:z},internalFormat:x,width:r,height:u}}const k=a.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),g=f("DXT1"),q=f("DXT3"),e=f("DXT5");b.createDDSTexture=function(m,l,w){w=n(w,l.hasMipmap??!1);if(null==w)throw Error("DDS texture data is null");const {textureData:v,internalFormat:x,width:p,height:h}=w;l.samplingMode=1<v.levels.length?c.TextureSamplingMode.LINEAR_MIPMAP_LINEAR:
c.TextureSamplingMode.LINEAR;l.hasMipmap=1<v.levels.length;l.internalFormat=x;l.width=p;l.height=h;return new d.Texture(m,l,v)};b.createDDSTextureData=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/RibbonLineTechniqueConfiguration":function(){define("exports ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/TransparencyPassType ../materials/DefaultTechniqueConfiguration".split(" "),
function(b,a,c,d,f,n){b.CapType=void 0;(function(g){g[g.BUTT=0]="BUTT";g[g.SQUARE=1]="SQUARE";g[g.ROUND=2]="ROUND";g[g.COUNT=3]="COUNT"})(b.CapType||(b.CapType={}));class k extends n.DefaultTechniqueConfiguration{constructor(){super(...arguments);this.output=c.ShaderOutput.Color;this.capType=b.CapType.BUTT;this.transparencyPassType=f.TransparencyPassType.NONE;this.stippleOffColorEnabled=this.stippleEnabled=this.draped=this.writeDepth=this.hasPolygonOffset=this.hasSlicePlane=this.occluder=!1;this.stipplePreferContinuous=
!0;this.objectAndLayerIdColorInstanced=this.wireframe=this.cullAboveGround=this.multipassEnabled=this.hasOccludees=this.innerColorEnabled=this.falloffEnabled=this.vvOpacity=this.vvColor=this.vvSize=this.applyMarkerOffset=this.roundJoins=!1}}a.__decorate([d.parameter({count:c.ShaderOutput.COUNT})],k.prototype,"output",void 0);a.__decorate([d.parameter({count:b.CapType.COUNT})],k.prototype,"capType",void 0);a.__decorate([d.parameter({count:f.TransparencyPassType.COUNT})],k.prototype,"transparencyPassType",
void 0);a.__decorate([d.parameter()],k.prototype,"occluder",void 0);a.__decorate([d.parameter()],k.prototype,"hasSlicePlane",void 0);a.__decorate([d.parameter()],k.prototype,"hasPolygonOffset",void 0);a.__decorate([d.parameter()],k.prototype,"writeDepth",void 0);a.__decorate([d.parameter()],k.prototype,"draped",void 0);a.__decorate([d.parameter()],k.prototype,"stippleEnabled",void 0);a.__decorate([d.parameter()],k.prototype,"stippleOffColorEnabled",void 0);a.__decorate([d.parameter()],k.prototype,
"stipplePreferContinuous",void 0);a.__decorate([d.parameter()],k.prototype,"roundJoins",void 0);a.__decorate([d.parameter()],k.prototype,"applyMarkerOffset",void 0);a.__decorate([d.parameter()],k.prototype,"vvSize",void 0);a.__decorate([d.parameter()],k.prototype,"vvColor",void 0);a.__decorate([d.parameter()],k.prototype,"vvOpacity",void 0);a.__decorate([d.parameter()],k.prototype,"falloffEnabled",void 0);a.__decorate([d.parameter()],k.prototype,"innerColorEnabled",void 0);a.__decorate([d.parameter()],
k.prototype,"hasOccludees",void 0);a.__decorate([d.parameter()],k.prototype,"multipassEnabled",void 0);a.__decorate([d.parameter()],k.prototype,"cullAboveGround",void 0);a.__decorate([d.parameter()],k.prototype,"wireframe",void 0);a.__decorate([d.parameter()],k.prototype,"objectAndLayerIdColorInstanced",void 0);a.__decorate([d.parameter({constValue:!1})],k.prototype,"occlusionPass",void 0);a.__decorate([d.parameter({constValue:!0})],k.prototype,"hasVvInstancing",void 0);a.__decorate([d.parameter({constValue:!0})],
k.prototype,"hasSliceTranslatedView",void 0);b.RibbonLineTechniqueConfiguration=k;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/RibbonLineTechnique":function(){define("require exports ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../lib/TransparencyPassType ../lib/VertexAttribute ../../../../chunks/RibbonLine.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w){const v=new Map([[e.VertexAttribute.POSITION,0],[e.VertexAttribute.SUBDIVISIONFACTOR,1],[e.VertexAttribute.UV0,2],[e.VertexAttribute.AUXPOS1,3],[e.VertexAttribute.AUXPOS2,4],[e.VertexAttribute.COLOR,5],[e.VertexAttribute.COLORFEATUREATTRIBUTE,5],[e.VertexAttribute.SIZE,6],[e.VertexAttribute.SIZEFEATUREATTRIBUTE,6],[e.VertexAttribute.OPACITYFEATUREATTRIBUTE,7],[e.VertexAttribute.OBJECTANDLAYERIDCOLOR,8]]);class x extends f.ShaderTechnique{initializeProgram(h){return new k.Program(h.rctx,
x.shader.get().build(this.configuration),v)}_makePipelineState(h,t){const r=this.configuration,u=h===q.TransparencyPassType.NONE,y=h===q.TransparencyPassType.FrontFace;return w.makePipelineState({blending:r.output===c.ShaderOutput.Color||r.output===c.ShaderOutput.Alpha?u?n.blendingDefault:n.oitBlending(h):null,depthTest:{func:n.oitDepthTest(h)},depthWrite:u?r.writeDepth?w.defaultDepthWriteParams:null:n.oitDepthWrite(h),colorWrite:w.defaultColorWriteParams,stencilWrite:r.hasOccludees?g.stencilWriteMaskOn:
null,stencilTest:r.hasOccludees?t?g.stencilToolMaskBaseParams:g.stencilBaseAllZerosParams:null,polygonOffset:u||y?r.hasPolygonOffset?p:null:n.OITPolygonOffset})}initializePipeline(){var h=this.configuration;h.occluder&&(h=h.hasPolygonOffset?p:null,this._occluderPipelineTransparent=w.makePipelineState({blending:n.blendingDefault,polygonOffset:h,depthTest:g.depthCompareAlways,depthWrite:null,colorWrite:w.defaultColorWriteParams,stencilWrite:null,stencilTest:g.stencilToolTransparentOccluderParams}),
this._occluderPipelineOpaque=w.makePipelineState({blending:n.blendingDefault,polygonOffset:h,depthTest:g.depthCompareAlways,depthWrite:null,colorWrite:w.defaultColorWriteParams,stencilWrite:g.stencilWriteMaskOff,stencilTest:g.stencilToolMaskOccluderParams}),this._occluderPipelineMaskWrite=w.makePipelineState({blending:null,polygonOffset:h,depthTest:g.depthCompareLess,depthWrite:null,colorWrite:null,stencilWrite:g.stencilWriteMaskOn,stencilTest:g.stencilToolMaskBaseParams}));this._occludeePipelineState=
this._makePipelineState(this.configuration.transparencyPassType,!0);return this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?l.PrimitiveType.LINES:l.PrimitiveType.TRIANGLE_STRIP}getPipeline(h,t,r){return h?this._occludeePipelineState:this.configuration.occluder?r?this._occluderPipelineTransparent:t?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipeline()}}x.shader=new d.ReloadableShaderModule(m.RibbonLine,
()=>new Promise((h,t)=>b(["./RibbonLine.glsl"],h,t)));const p={factor:0,units:-4};a.RibbonLineTechnique=x;a.vertexAttributeLocations=v;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/RenderContext":function(){define("exports ../../../../core/time ../core/shaderLibrary/ShaderOutput ./BindParameters ./Camera ./Material".split(" "),function(b,a,c,d,f,n){class k{constructor(e,m,l=null){this.rctx=e;this.sliceHelper=l;this.lastFrameCamera=new f.Camera;this.output=
c.ShaderOutput.Color;this.renderOccludedMask=q;this.bindParameters=new d.BindParameters(m,null!=l?l.plane:null);this.bindParameters.alignPixelEnabled=!0}resetRenderOccludedMask(){this.renderOccludedMask=q}}class g extends k{constructor(e,m,l,w){super(e,l,w);this.offscreenRenderingHelper=m;this.sliceHelper=w;this.time=a.Milliseconds(0)}}const q=n.RenderOccludedFlag.Occlude|n.RenderOccludedFlag.OccludeAndTransparent|n.RenderOccludedFlag.OccludeAndTransparentStencil;b.OverlayRenderContext=k;b.RenderContext=
g;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ShadowMap":function(){define("exports ../../../../core/has ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../ViewingMode ../core/FBOCache ./CascadeCamera ./textureUtils ./Util ../../../webgl/enums ../../../webgl/Texture".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u){function y(da,fa){g.set(T,da[fa],da[fa+3]);return T}b.SnapshotSlot=void 0;(function(da){da[da.Highlight=0]="Highlight";da[da.Default=1]="Default"})(b.SnapshotSlot||(b.SnapshotSlot={}));class z{constructor(){this.camera=new p.CascadeCamera;this.lightMat=k.create()}}class A{constructor(){this.maxNumCascadesLowQuality=this.maxNumCascadesHighQuality=4;this.textureSizeModHighQuality=1.3;this.textureSizeModLowQuality=.9;this.splitSchemeLambda=0}}class C{get depthTexture(){return this._handle?.colorTexture}get _textureWidth(){return this._textureHeight*
this._numCascades}get numCascades(){return this._numCascades}get cascadeDistances(){return l.set(this._usedCascadeDistances,this._cascadeDistances[0],1<this._numCascades?this._cascadeDistances[1]:Infinity,2<this._numCascades?this._cascadeDistances[2]:Infinity,3<this._numCascades?this._cascadeDistances[3]:Infinity)}constructor(da,fa){this._fbos=da;this._viewingMode=fa;this._enabled=!1;this._snapshots=[];this._textureHeight=0;this._numCascades=1;this.settings=new A;this._projectionView=k.create();this._projectionViewInverse=
k.create();this._modelViewLight=k.create();this._cascadeDistances=[0,0,0,0,0];this._usedCascadeDistances=w.create();this._cascades=[new z,new z,new z,new z];this._lastOrigin=null;this._maxTextureWidth=Math.min(a("esri-mobile")?4096:16384,da.rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1;this.disposeOffscreenBuffers()}disposeOffscreenBuffers(){this._handle=d.releaseMaybe(this._handle);this._discardSnapshots()}set maxCascades(da){this.settings.maxNumCascadesHighQuality=c.clamp(Math.floor(da),
1,4)}get maxCascades(){return this.settings.maxNumCascadesHighQuality}set enabled(da){(this._enabled=da)||this.disposeOffscreenBuffers()}get enabled(){return this._enabled}get ready(){return this._enabled&&null!=this.depthTexture}get cascades(){for(let da=0;da<this._numCascades;++da)J[da]=this._cascades[da];J.length=this._numCascades;return J}start(da,fa,ka,ha,ba){t.assert(this.enabled);const {near:ea,far:ca}=this._clampNearFar(ka);this._computeCascadeDistances(ea,ca,ha);this._textureHeight=this._computeTextureHeight(da,
ba,ha);this._setupMatrices(da,fa);const {viewMatrix:ia,projectionMatrix:la}=da;for(da=0;da<this._numCascades;++da)this._constructCascade(da,la,ia,fa);this._lastOrigin=null;this.clear()}finish(){t.assert(this.enabled);this._handle?.releaseDepth()}getShadowMapMatrices(da){if(!this._lastOrigin||!e.exactEquals(da,this._lastOrigin)){this._lastOrigin=this._lastOrigin||m.create();e.copy(this._lastOrigin,da);for(let fa=0;fa<this._numCascades;++fa){n.translate(R,this._cascades[fa].lightMat,da);for(let ka=
0;16>ka;++ka)X[16*fa+ka]=R[ka]}}return X}moveSnapshot(da){t.assert(this.enabled);this._handle?.releaseDepth();this._snapshots[da]?.release();this._snapshots[da]=this._handle;this._handle=null}copySnapshot(da){var fa=this._handle?.colorTexture?.descriptor;if(this.enabled&&fa){this._snapshots[da]?.release();var {width:ka,height:ha}=fa;this._snapshots[da]=this._fbos.acquire(x.ColorFormat.RGBA4,ka,ha);fa=this._fbos.rctx;this._bindFbo();da=fa.bindTexture(this._snapshots[da]?.colorTexture,u.Texture.TEXTURE_UNIT_FOR_UPDATES);
fa.gl.copyTexSubImage2D(r.TextureType.TEXTURE_2D,0,0,0,0,0,ka,ha);fa.bindTexture(da,u.Texture.TEXTURE_UNIT_FOR_UPDATES)}}getSnapshot(da){return this.enabled?this._snapshots[da]?.colorTexture:null}clear(){const da=this._fbos.rctx;this._ensureFbo();this._bindFbo();da.setClearColor(1,1,1,1);da.clearSafe(r.ClearBufferBit.COLOR_BUFFER_BIT|r.ClearBufferBit.DEPTH_BUFFER_BIT)}_computeTextureHeight(da,fa,ka){da=h.applyTextureResizeModulo(Math.floor(Math.min(window.devicePixelRatio,fa)/da.pixelRatio*Math.max(da.fullWidth,
da.fullHeight)*(ka?this.settings.textureSizeModHighQuality:this.settings.textureSizeModLowQuality)));return Math.min(this._maxTextureWidth,this._numCascades*da)/this._numCascades}_ensureFbo(){if(this._handle?.fbo.width!==this._textureWidth||this._handle?.fbo.height!==this._textureHeight)this._handle?.release(),this._handle=this._fbos.acquire(x.ColorFormat.RGBA4,this._textureWidth,this._textureHeight);this._handle.acquireDepth(x.DepthFormat.DEPTH16_BUFFER)}_discardSnapshot(da){this._snapshots[da]=
d.releaseMaybe(this._snapshots[da])}_discardSnapshots(){for(let da=0;da<this._snapshots.length;++da)this._discardSnapshot(da);this._snapshots.length=0}_bindFbo(){const da=this._fbos.rctx;da.unbindTexture(this.depthTexture);da.bindFramebuffer(this._handle?.fbo)}_constructCascade(da,fa,ka,ha){const ba=this._cascades[da];var ea=-this._cascadeDistances[da],ca=-this._cascadeDistances[da+1];ea=(fa[10]*ea+fa[14])/Math.abs(fa[11]*ea+fa[15]);fa=(fa[10]*ca+fa[14])/Math.abs(fa[11]*ca+fa[15]);t.assert(ea<fa);
for(ca=0;8>ca;++ca){l.set(B,0===ca%4||3===ca%4?-1:1,0===ca%4||1===ca%4?-1:1,4>ca?ea:fa,1);var ia=D[ca];l.transformMat4(ia,B,this._projectionViewInverse);ia[0]/=ia[3];ia[1]/=ia[3];ia[2]/=ia[3]}e.negate(P,D[0]);ba.camera.viewMatrix=n.translate(E,this._modelViewLight,P);for(ea=0;8>ea;++ea)e.transformMat4(D[ea],D[ea],ba.camera.viewMatrix);ea=D[0][2];fa=D[0][2];for(ca=1;8>ca;++ca)ea=Math.min(ea,D[ca][2]),fa=Math.max(fa,D[ca][2]);ea-=200;fa+=200;ba.camera.near=-fa;ba.camera.far=-ea;ca=ba.camera;ia=1/D[0][3];
var la=1/D[4][3];t.assert(ia<la);ia+=Math.sqrt(ia*la);var oa=Math.sin(c.acosClamped(ka[2]*ha[0]+ka[6]*ha[1]+ka[10]*ha[2]));ka=D;var na=ia/oa;ha=F;var ra=K,ta=L;la=G;ia=O;g.set(U,0,0);for(var ma=0;4>ma;++ma)g.add(U,U,ka[ma]);g.scale(U,U,.25);g.set(M,0,0);for(ma=4;8>ma;++ma)g.add(M,M,ka[ma]);g.scale(M,M,.25);g.lerp(V[0],ka[4],ka[5],.5);g.lerp(V[1],ka[5],ka[6],.5);g.lerp(V[2],ka[6],ka[7],.5);g.lerp(V[3],ka[7],ka[4],.5);ma=0;var pa=g.squaredDistance(V[0],U);for(var ja=1;4>ja;++ja){var qa=g.squaredDistance(V[ja],
U);qa<pa&&(pa=qa,ma=ja)}g.subtract(Y,V[ma],ka[ma+4]);ma=Y[0];Y[0]=-Y[1];Y[1]=ma;g.subtract(W,M,U);0>g.dot(W,Y)&&g.negate(Y,Y);g.lerp(Y,Y,W,oa);g.normalize(Y,Y);oa=ma=g.dot(g.subtract(H,ka[0],U),Y);for(pa=1;8>pa;++pa)ja=g.dot(g.subtract(H,ka[pa],U),Y),ja<oa?oa=ja:ja>ma&&(ma=ja);g.copy(ha,U);g.scale(H,Y,oa-na);g.add(ha,ha,H);ja=-1;qa=1;na=pa=0;for(let ua=0;8>ua;++ua){g.subtract(S,ka[ua],ha);g.normalize(S,S);const wa=Y[0]*S[1]-Y[1]*S[0];0<wa?wa>ja&&(ja=wa,pa=ua):wa<qa&&(qa=wa,na=ua)}t.verify(0<ja,"leftArea");
t.verify(0>qa,"rightArea");g.scale(I,Y,oa);g.add(I,I,U);g.scale(Q,Y,ma);g.add(Q,Q,U);N[0]=-Y[1];N[1]=Y[0];ra=t.rayRay2D(ha,ka[na],Q,g.add(H,Q,N),1,ra);ta=t.rayRay2D(ha,ka[pa],Q,H,1,ta);la=t.rayRay2D(ha,ka[pa],I,g.add(H,I,N),1,la);ka=t.rayRay2D(ha,ka[na],I,H,1,ia);t.verify(ra,"rayRay");t.verify(ta,"rayRay");t.verify(la,"rayRay");t.verify(ka,"rayRay");ta=F;ka=K;ha=G;la=O;ia=ca.projectionMatrix;g.subtract(aa,ha,la);g.scale(aa,aa,.5);Z[0]=aa[0];Z[1]=aa[1];Z[2]=0;Z[3]=aa[1];Z[4]=-aa[0];Z[5]=0;Z[6]=aa[0]*
aa[0]+aa[1]*aa[1];Z[7]=aa[0]*aa[1]-aa[1]*aa[0];Z[8]=1;Z[6]=-g.dot(y(Z,0),ta);Z[7]=-g.dot(y(Z,1),ta);ta=g.dot(y(Z,0),ha)+Z[6];ra=g.dot(y(Z,1),ha)+Z[7];na=g.dot(y(Z,0),la)+Z[6];la=g.dot(y(Z,1),la)+Z[7];ta=-(ta+na)/(ra+la);Z[0]+=Z[1]*ta;Z[3]+=Z[4]*ta;Z[6]+=Z[7]*ta;ta=1/(g.dot(y(Z,0),ha)+Z[6]);ra=1/(g.dot(y(Z,1),ha)+Z[7]);Z[0]*=ta;Z[3]*=ta;Z[6]*=ta;Z[1]*=ra;Z[4]*=ra;Z[7]*=ra;Z[2]=Z[1];Z[5]=Z[4];Z[8]=Z[7];Z[7]+=1;ta=g.dot(y(Z,1),ka)+Z[7];ra=g.dot(y(Z,2),ka)+Z[8];na=g.dot(y(Z,1),ha)+Z[7];la=g.dot(y(Z,2),
ha)+Z[8];ta=-.5*(ta/ra+na/la);Z[1]+=Z[2]*ta;Z[4]+=Z[5]*ta;Z[7]+=Z[8]*ta;ta=g.dot(y(Z,1),ka)+Z[7];ra=g.dot(y(Z,2),ka)+Z[8];na=-ra/ta;Z[1]*=na;Z[4]*=na;Z[7]*=na;ia[0]=Z[0];ia[1]=Z[1];ia[2]=0;ia[3]=Z[2];ia[4]=Z[3];ia[5]=Z[4];ia[6]=0;ia[7]=Z[5];ia[8]=0;ia[9]=0;ia[10]=1;ia[11]=0;ia[12]=Z[6];ia[13]=Z[7];ia[14]=0;ia[15]=Z[8];ca.projectionMatrix[10]=2/(ea-fa);ca.projectionMatrix[14]=-(ea+fa)/(ea-fa);n.multiply(ba.lightMat,ba.camera.projectionMatrix,ba.camera.viewMatrix);ea=this._textureHeight;ba.camera.viewport=
[da*ea,0,ea,ea]}_setupMatrices(da,fa){n.multiply(this._projectionView,da.projectionMatrix,da.viewMatrix);n.invert(this._projectionViewInverse,this._projectionView);da=this._viewingMode===v.ViewingMode.Global?da.eye:e.set(P,0,0,1);n.lookAt(this._modelViewLight,[0,0,0],[-fa[0],-fa[1],-fa[2]],da)}_clampNearFar(da){let {near:fa,far:ka}=da;2>fa&&(fa=2);2>ka&&(ka=2);fa>=ka&&(fa=2,ka=4);return{near:fa,far:ka}}_computeCascadeDistances(da,fa,ka){ka=ka?this.settings.maxNumCascadesHighQuality:this.settings.maxNumCascadesLowQuality;
this._numCascades=Math.min(1+Math.floor(t.logWithBase(fa/da,4)),ka);ka=(fa-da)/this._numCascades;fa=(fa/da)**(1/this._numCascades);let ha=da;for(let ba=0;ba<this._numCascades+1;++ba)this._cascadeDistances[ba]=c.lerp(ha,da,this.settings.splitSchemeLambda),ha*=fa,da+=ka}get test(){return{cascades:this._cascades,textureHeight:this._textureHeight}}}const E=k.create(),B=w.create(),D=[];for(let da=0;8>da;++da)D.push(w.create());const F=q.create(),K=q.create(),L=q.create(),G=q.create(),O=q.create(),P=m.create(),
J=[],R=k.create(),X=k.IDENTITY.concat(k.IDENTITY,k.IDENTITY,k.IDENTITY,k.IDENTITY),U=q.create(),M=q.create(),V=[q.create(),q.create(),q.create(),q.create()],Y=q.create(),W=q.create(),H=q.create(),S=q.create(),I=q.create(),Q=q.create(),N=q.create(),T=q.create(),aa=q.create(),Z=f.create();b.ShadowMap=C;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/CascadeCamera":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4f64 ./Camera".split(" "),
function(b,a,c,d,f,n,k,g,q){b.CascadeCamera=class extends q.Camera{constructor(){super(...arguments);this._projectionMatrix=g.create()}get projectionMatrix(){return this._projectionMatrix}};a.__decorate([c.property()],b.CascadeCamera.prototype,"_projectionMatrix",void 0);a.__decorate([c.property({readOnly:!0})],b.CascadeCamera.prototype,"projectionMatrix",null);b.CascadeCamera=a.__decorate([k.subclass("esri.views.3d.webgl-engine.lib.CascadeCamera")],b.CascadeCamera);Object.defineProperty(b,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/lib/SortedRenderGeometryRenderer":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/PooledArray ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec2f64 ../../terrain/Intersector ./ChangeSet ./Intersector ./IntersectorInterfaces ./ModelDirtyTypes ./rendererUtils ../materials/renderers/MergedRenderer".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h){function t(y,z,A,C,E,B,D){const F=new m.OverlayTarget(B,D,z);z=K=>{K.set(v.IntersectorType.OVERLAY,F,y.dist,y.normal,y.transformation,A,C)};(null==E.results.min.drapedLayerOrder||A>=E.results.min.drapedLayerOrder)&&(null==E.results.min.dist||E.results.ground.dist<=E.results.min.dist)&&z(E.results.min);E.options.store!==v.StoreResults.MIN&&(null==E.results.max.drapedLayerOrder||A<E.results.max.drapedLayerOrder)&&(null==E.results.max.dist||E.results.ground.dist>
E.results.max.dist)&&z(E.results.max);E.options.store===v.StoreResults.ALL&&(B=w.newIntersectorResult(E.ray),z(B),E.results.all.push(B))}b.SortedRenderGeometryRenderer=class extends c{constructor(y){super(y);this._pending=new r;this._changes=new l.ChangeSet;this._materialRenderers=new d;this._sortedMaterialRenderers=new d;this._geometries=new Map;this._hasWater=this._hasHighlights=!1}destroy(){this._changes.prune();this._materialRenderers.forAll(y=>y.dispose());this._materialRenderers.clear();this._sortedMaterialRenderers.clear();
this._geometries.clear();this._pending.clear()}get updating(){return!this._pending.empty||0<this._changes.updates.length}get rctx(){return this.rendererContext.rctx}get _materialRepository(){return this.rendererContext.materialRepository}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return this._materialRenderers.some(y=>y.rendersOccluded)}get isEmpty(){return!this.updating&&
0===this._materialRenderers.length&&0===this._geometries.size}getMemoryForMaterial(y){return null==y?0:this._materialRenderers.find(z=>z.material===y)?.usedMemory??0}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();let y=!1,z=!1,A=!1;p.splitRenderGeometryChangeSetByMaterial(this._changes).forEach((C,E)=>{var B=this._materialRenderers.find(K=>K.material===E);!B&&0<C.adds.length&&(B=new h.MergedRenderer({material:E}),B.initializeRenderContext(this.rendererContext.pluginContext,
this._materialRepository),this._materialRenderers.push(B),A=z=y=!0);if(B){var D=z||B.hasHighlights,F=A||B.hasWater;B.modify(C);z=z||D!==B.hasHighlights;A=A||F!==B.hasWater;B.isEmpty&&(this._materialRenderers.removeUnordered(B),B.dispose(),y=!0)}});this._changes.clear();y&&this._updateSortedMaterialRenderers();z&&(this._hasHighlights=this._materialRenderers.some(C=>C.hasHighlights));A&&(this._hasWater=this._materialRenderers.some(C=>C.hasWater));this.notifyChange("updating");return!0}addGeometries(y,
z){if(0!==y.length){var A=this._validateRenderGeometries(y);for(var C of A)this._geometries.set(C.id,C);C=this._pending.empty;for(const E of A)this._pending.adds.add(E);C&&this.notifyChange("updating");z===x.DirtyOperation.UPDATE&&this._notifyGraphicGeometryChanged(y)}}removeGeometries(y,z){const A=this._pending.empty,C=this._pending.adds;for(const E of y)C.has(E)?(this._pending.removed.add(E),C.delete(E)):this._pending.removed.has(E)||this._pending.removes.add(E),this._geometries.delete(E.id);A&&
!this._pending.empty&&this.notifyChange("updating");z===x.DirtyOperation.UPDATE&&this._notifyGraphicGeometryChanged(y)}modifyGeometries(y,z){const A=0===this._changes.updates.length;for(const C of y){const E=this._changes.updates.pushNew();E.renderGeometry=this._validateRenderGeometry(C);E.updateType=z}A&&0<this._changes.updates.length&&this.notifyChange("updating");switch(z){case x.DirtyState.TRANSFORMATION:case x.DirtyState.GEOMETRY:return this._notifyGraphicGeometryChanged(y);case x.DirtyState.VISIBILITY:return this._notifyGraphicVisibilityChanged(y)}}updateAnimation(y){let z=
!1;this._sortedMaterialRenderers.forAll(A=>z=A.updateAnimation(y)||z);return z}shouldRender(y){return this._sortedMaterialRenderers.some(z=>z.prepareTechnique(y))}render(y){this._sortedMaterialRenderers.forAll(z=>{const A=z.prepareTechnique(y);null!=A&&z.renderNode(y,A)})}intersect(y,z,A,C,E){this._geometries.forEach(B=>{if(!C||C(B)){this._intersectRenderGeometry(B,A,z,0,y,E);var D=this.rendererContext.longitudeCyclical;D&&(B.boundingSphere[0]-B.boundingSphere[3]<D.min&&this._intersectRenderGeometry(B,
A,z,D.range,y,E),B.boundingSphere[0]+B.boundingSphere[3]>D.max&&this._intersectRenderGeometry(B,A,z,-D.range,y,E));E++}});return E}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();this._materialRenderers.forAll((y,z)=>{y.priority=z;this._sortedMaterialRenderers.push(y)});this._sortedMaterialRenderers.sort((y,z)=>z.material.renderPriority===y.material.renderPriority?y.priority-z.priority:z.material.renderPriority-y.material.renderPriority)}_processAddsRemoves(){this._changes.adds.clear();
this._changes.removes.clear();this._changes.adds.pushArray(Array.from(this._pending.adds));this._changes.removes.pushArray(Array.from(this._pending.removes));for(let y=0;y<this._changes.updates.length;)this._pending.has(this._changes.updates.data[y].renderGeometry)?this._changes.updates.removeUnorderedIndex(y):y++;this._pending.clear()}_intersectRenderGeometry(y,z,A,C,E,B){if(y.visible){var D=0;C+=y.transformation[12];D=y.transformation[13];u[0]=A[0]-C;u[1]=A[1]-D;y.screenToWorldRatio=this.rendererContext.screenToWorldRatio;
y.material.intersectDraped(y,null,E,u,(F,K,L)=>{t(z,L,y.material.renderPriority,B,E,y.layerUid,y.graphicUid)},z)}}_notifyGraphicGeometryChanged(y){if(null!=this.drapeSource.notifyGraphicGeometryChanged)for(const A of y)if(y=A.graphicUid,null!=y&&y!==z){this.drapeSource.notifyGraphicGeometryChanged(y);var z=y}}_notifyGraphicVisibilityChanged(y){if(null!=this.drapeSource.notifyGraphicVisibilityChanged)for(const A of y)if(y=A.graphicUid,null!=y&&y!==z){this.drapeSource.notifyGraphicVisibilityChanged(y);
var z=y}}_validateRenderGeometries(y){for(const z of y)this._validateRenderGeometry(z);return y}_validateRenderGeometry(y){null==y.localOrigin&&(y.localOrigin=this._localOriginFactory.getOrigin(y.boundingSphere));return y}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};a.__decorate([f.property()],b.SortedRenderGeometryRenderer.prototype,"drapeSource",void 0);a.__decorate([f.property()],b.SortedRenderGeometryRenderer.prototype,"updating",null);a.__decorate([f.property()],
b.SortedRenderGeometryRenderer.prototype,"rctx",null);a.__decorate([f.property({constructOnly:!0})],b.SortedRenderGeometryRenderer.prototype,"rendererContext",void 0);a.__decorate([f.property()],b.SortedRenderGeometryRenderer.prototype,"_materialRepository",null);a.__decorate([f.property()],b.SortedRenderGeometryRenderer.prototype,"_localOriginFactory",null);a.__decorate([f.property({readOnly:!0})],b.SortedRenderGeometryRenderer.prototype,"isEmpty",null);a.__decorate([f.property()],b.SortedRenderGeometryRenderer.prototype,
"_materialRenderers",void 0);a.__decorate([f.property()],b.SortedRenderGeometryRenderer.prototype,"_geometries",void 0);b.SortedRenderGeometryRenderer=a.__decorate([q.subclass("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],b.SortedRenderGeometryRenderer);class r{constructor(){this.adds=new Set;this.removes=new Set;this.removed=new Set}get empty(){return 0===this.adds.size&&0===this.removes.size&&0===this.removed.size}has(y){return this.adds.has(y)||this.removes.has(y)||this.removed.has(y)}clear(){this.adds.clear();
this.removes.clear();this.removed.clear()}}const u=e.create();Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/Intersector":function(){define(["exports","../webgl-engine/lib/IntersectorInterfaces","../webgl-engine/lib/IntersectorTarget","../webgl-engine/lib/intersectorUtils"],function(b,a,c,d){class f extends c.Graphic3DTarget{constructor(n,k,g){super(n,k);this.triangleNr=g}}b.OverlayTarget=f;b.isOverlayIntersectorResult=function(n){return d.isValidIntersectorResult(n)&&
n.intersector===a.IntersectorType.OVERLAY&&!!n.target};b.isTerrainIntersectorResult=function(n){return d.isValidIntersectorResult(n)&&n.intersector===a.IntersectorType.TERRAIN&&!!n.target};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ChangeSet":function(){define(["exports","../../../../core/PooledArray"],function(b,a){class c{constructor(){this.adds=new a;this.removes=new a;this.updates=new a({allocator:n=>n||new d,deallocator:n=>{n.renderGeometry=
null;return n}})}clear(){this.adds.clear();this.removes.clear();this.updates.clear()}prune(){this.adds.prune();this.removes.prune();this.updates.prune()}get empty(){return 0===this.adds.length&&0===this.removes.length&&0===this.updates.length}}class d{}class f{constructor(){this.adds=[];this.removes=[];this.updates=[]}}b.ChangeSet=c;b.MaterialChangeSet=f;b.RenderGeometryUpdate=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ModelDirtyTypes":function(){define(["exports"],
function(b){b.DirtyOperation=void 0;(function(a){a[a.ADD=0]="ADD";a[a.UPDATE=1]="UPDATE";a[a.REMOVE=2]="REMOVE"})(b.DirtyOperation||(b.DirtyOperation={}));b.DirtyState=void 0;(function(a){a[a.NONE=0]="NONE";a[a.VISIBILITY=1]="VISIBILITY";a[a.GEOMETRY=2]="GEOMETRY";a[a.TRANSFORMATION=4]="TRANSFORMATION";a[a.HIGHLIGHT=8]="HIGHLIGHT";a[a.OCCLUDEE=16]="OCCLUDEE"})(b.DirtyState||(b.DirtyState={}));Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/rendererUtils":function(){define(["exports",
"./ChangeSet"],function(b,a){b.splitRenderGeometryChangeSetByMaterial=function(c){const d=new Map,f=n=>{let k=d.get(n);k||(k=new a.MaterialChangeSet,d.set(n,k));return k};c.removes.forAll(n=>{1<=n.geometry.indexCount&&f(n.material).removes.push(n)});c.adds.forAll(n=>{1<=n.geometry.indexCount&&f(n.material).adds.push(n)});c.updates.forAll(n=>{1<=n.renderGeometry.geometry.indexCount&&f(n.renderGeometry.material).updates.push(n)});return d};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/materials/renderers/MergedRenderer":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/arrayUtils ../../../../../core/MapUtils ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/NestedMap ../../../../../core/PooledArray ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/mat4 ../../../../../chunks/mat4f64 ../../../support/buffer/glUtil ../../core/shaderLibrary/ShaderOutput ../../effects/RenderPlugin ../../lib/GLMaterials ../../lib/Material ../../lib/ModelDirtyTypes ../../lib/RenderSlot ../../lib/Util ../DrawParameters ../WaterMaterial ./BufferRange ./Instance ./PerBufferData ./PerOriginData ./VaoCache".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A,C,E,B,D,F,K){function L(V,Y){let W;if(!V.some(S=>{if(S.numElements<Y)return!1;W=S;return!0}))return null;const H=W.from;W.from+=Y;W.from>=W.to&&V.removeUnordered(W);return H}function G(V){M.length<V&&(M=new Float32Array(V));return M}function O(V){V*=4;return 1024>=V?1024:262144>V?f.nextHighestPowerOfTwo(V):Math.max(Math.min(262144*Math.ceil(1.5*V/262144),16777216),V)}b.MergedRenderer=class extends h.SyncPrepareRenderPlugin{constructor(V){super(V);
this._bufferWriter=this._glMaterials=this._vaoCache=null;this._dataByOrigin=new Map;this._hasOccludees=this._hasHighlights=!1;this.priority=0;this.produces=new Map}dispose(){this._glMaterials=n.disposeMaybe(this._glMaterials);this._dataByOrigin.forEach(V=>V.dispose());this._dataByOrigin.clear();this._vaoCache=n.disposeMaybe(this._vaoCache)}initializeRenderContext(V,Y){const {rctx:W}=V.renderContext;this._glMaterials=new t.GLMaterials(this.material,Y??V.materialRepository);this._bufferWriter=this.material.createBufferWriter();
this._vaoCache=new K.VaoCache(W,this.material.vertexAttributeLocations,x.glLayout(this._bufferWriter.vertexBufferLayout))}uninitializeRenderContext(){}get isEmpty(){return 0===this._dataByOrigin.size}get hasHighlights(){return this._hasHighlights}get hasOccludees(){return this._hasOccludees}get hasWater(){return!this.isEmpty&&this.material instanceof C.WaterMaterial}get isDecoration(){return this.material.parameters.isDecoration}get rendersOccluded(){return!this.isEmpty&&this.material.parameters.renderOccluded!==
r.RenderOccludedFlag.Occlude}get numGeometries(){let V=0;this._dataByOrigin.forEach(Y=>V+=Y.buffers.reduce((W,H)=>W+=H.instances.size,0));return V}get usedMemory(){let V=0;this._dataByOrigin.forEach(Y=>V+=Y.buffers.reduce((W,H)=>W+H.vao.usedMemory,0));return V}forEachGeometry(V){this._dataByOrigin.forEach(Y=>Y.buffers.forEach(W=>W.instances.forEach(H=>V(H.geometry))))}modify(V){this._updateGeometries(V.updates);this._addAndRemoveGeometries(V.adds,V.removes);this._updateDrawCommands()}_updateGeometries(V){const Y=
this._bufferWriter;if(null!==Y){var W=Y.vertexBufferLayout.stride/4;for(const S of V){V=S.renderGeometry;const I=this._dataByOrigin.get(V.localOrigin.id)?.findBuffer(V.id);if(null==I)break;const Q=I.instances.get(V.id);if(S.updateType&(u.DirtyState.GEOMETRY|u.DirtyState.TRANSFORMATION)){var H=Y.elementCount(Q.geometry.geometry)*W;H=G(H);const N=Y.vertexBufferLayout.createView(H.buffer);this._writeGeometry(V,N,0);I.vao.vertexBuffers.geometry.setSubData(H,Q.from*W,0,Q.numElements*W)}S.updateType&(u.DirtyState.HIGHLIGHT|
u.DirtyState.OCCLUDEE|u.DirtyState.VISIBILITY)&&(I.drawCommandsDirty=!0)}}}_computeDeltas(V,Y){const W=new k.NestedMap;for(var H of V){V=H.localOrigin;if(null==V)continue;let S=W.get(V.id,null);null==S&&(S=new P(V.vec3),W.set(V.id,null,S));S.changes.push(H)}for(const S of Y)Y=S.localOrigin,null!=Y&&(H=this._dataByOrigin.get(Y.id)?.findBuffer(S.id),null!=H&&(V=W.get(Y.id,H),null==V&&(V=new P(Y.vec3),W.set(Y.id,H,V)),V.changes.push(S)));return W}_addAndRemoveGeometries(V,Y){if(null!==this._bufferWriter&&
null!==this._vaoCache){var {_bufferWriter:W,_dataByOrigin:H}=this,S=W.vertexBufferLayout.stride/4,I=this._computeDeltas(V,Y);I.forEach((Q,N)=>{const T=Q.get(null),aa=null!=T?T.changes:[];I.delete(N,null);let Z=H.get(N);Q.forEach((da,fa)=>{I.delete(N,fa);if(null==fa)z.assert(!1,"No VAO for removed geometries");else if(fa.instances.size===da.changes.length)this._vaoCache.deleteVao(fa.vao),c.removeUnordered(Z.buffers,fa),0===Z.buffers.length&&0===aa.length&&H.delete(N);else{var ka=fa.numElements,ha=
fa.vao.byteSize/4,ba=aa.reduce((ca,ia)=>ca+W.elementCount(ia.geometry),0),ea=da.changes.reduce((ca,ia)=>ca+W.elementCount(ia.geometry),0);ka=Math.min((ka+ba-ea)*S,4194304);ba=ka>ha;65536<ka&&ka<ha/2?(da.changes.forEach(({id:ca})=>fa.deleteInstance(ca)),fa.instances.forEach(({geometry:ca})=>aa.push(ca)),this._vaoCache.deleteVao(fa.vao),c.removeUnordered(Z.buffers,fa)):ba?this._applyAndRebuild(fa,aa,da):this._applyRemoves(fa,da)}});if(0<aa.length)for(null==Z&&(Z=new F.PerOriginData(T.origin),H.set(N,
Z)),Z.buffers.forEach(da=>this._applyAdds(da,aa));0<aa.length;)Z.buffers.push(this._applyAndRebuild(new D.PerBufferData,aa,null))})}}_updateDrawCommands(){this._hasOccludees=this._hasHighlights=!1;this._dataByOrigin.forEach(V=>{V.buffers.forEach(Y=>{Y.drawCommandsDirty&&(Y.hasHiddenInstances=!1,Y.hasHighlights=!1,Y.hasOccludees=!1,d.someMap(Y.instances,W=>{Y.updateDrawState(W);return Y.hasHiddenInstances&&Y.hasHighlights&&Y.hasOccludees}),Y.updateDrawCommands(this._bufferWriter.vertexBufferLayout.stride));
this._hasHighlights=this._hasHighlights||Y.hasHighlights;this._hasOccludees=this._hasOccludees||Y.hasOccludees})})}_applyAndRebuild(V,Y,W){if(null!=W)for(var H of W.changes)V.deleteInstance(H.id);const S=this._bufferWriter;W=S.vertexBufferLayout.stride;H=W/4;var I=Math.floor(4194304/H);let Q=V.numElements;for(;0<Y.length;){const Z=Y.pop();var N=S.elementCount(Z.geometry);if(Q+N>I&&0<Q){Y.push(Z);break}Q+=N;N=new B.Instance(Z,0,0);z.assert(null==V.instances.get(Z.id));V.addInstance(Z.id,N)}Y=Q*H;I=
G(Y);const T=S.vertexBufferLayout.createView(I.buffer);let aa=0;V.hasHiddenInstances=!1;V.hasHighlights=!1;V.hasOccludees=!1;V.instances.forEach((Z,da)=>{this._writeGeometry(Z.geometry,T,aa);const fa=aa;aa+=S.elementCount(Z.geometry.geometry);V.updateInstance(da,fa,aa);V.updateDrawState(Z)});this._vaoCache.deleteVao(V.vao);V.vao=this._vaoCache.newVao(O(Y));V.vao.vertexBuffers.geometry.setSubData(I,0,0,aa*H);V.holes.clear();Y=V.holes.pushNew();Y.from=aa;Y.to=Math.floor(V.vao.byteSize/W);V.updateDrawCommands(W);
return V}_applyRemoves(V,Y){if(0!==Y.changes.length&&null!==this._bufferWriter){for(var W of Y.changes){var H=W.id;if(Y=V.instances.get(H)){V.deleteInstance(H);if(H=U.back()){if(H.to===Y.from){H.to=Y.to;continue}if(H.from===Y.to){H.from=Y.from;continue}}H=U.pushNew();H.from=Y.from;H.to=Y.to}}E.mergeAdjacentRanges(U);var S=this._bufferWriter.vertexBufferLayout.stride/4;W=U.reduce((N,T)=>Math.max(N,T.numElements),0)*S;var I=G(W);I.fill(0,0,W);var Q=V.vao.vertexBuffers.geometry;U.forAll(N=>Q.setSubData(I,
N.from*S,0,N.numElements*S));V.holes.pushArray(U.data,U.length);U.forAll((N,T)=>U.data[T]=null);U.clear();V.drawCommandsDirty=!0}}_applyAdds(V,Y){if(0!==Y.length&&null!==this._bufferWriter)if(D.hasVao(V)){var W=this._bufferWriter,H=W.vertexBufferLayout.stride/4,S=V.numElements,I=Y.reduce((ha,ba)=>ha+W.elementCount(ba.geometry),0);S=Math.min((S+I)*H,4194304);I=4*S;if(V.vao.byteSize<O(4128768)&&I>V.vao.byteSize)this._applyAndRebuild(V,Y,null);else{E.mergeAdjacentRanges(V.holes);var Q=[];for(var N of Y)I=
W.elementCount(N.geometry),I=L(V.holes,I),Q.push(I);var T=V.vao.vertexBuffers.geometry,aa=0,Z=0,da=0,fa=G(S),ka=W.vertexBufferLayout.createView(fa.buffer);Y.forEach((ha,ba)=>{ba=Q[ba];if(null!=ba){if(da!==ba){var ea=da-Z;0<ea&&T.setSubData(fa,Z*H,0,ea*H);Z=ba;aa=0}ea=W.elementCount(ha.geometry);this._writeGeometry(ha,ka,aa);aa+=ea;da=ba+ea;ba=new B.Instance(ha,ba,ba+ea);z.assert(null==V.instances.get(ha.id));V.addInstance(ha.id,ba);V.drawCommandsDirty=!0}});N=da-Z;0<N&&T.setSubData(fa,Z*H,0,N*H);
c.filterInPlace(Y,(ha,ba)=>null==Q[ba])}}else this._applyAndRebuild(V,Y,null)}_writeGeometry(V,Y,W){if(null!==this._bufferWriter){var H=V.localOrigin.vec3;z.setMatrixTranslation3(J,-H[0],-H[1],-H[2]);H=w.multiply(R,J,V.transformation);w.invert(X,H);w.transpose(X,X);this._bufferWriter.write(H,X,V.geometry,Y,W)}}updateAnimation(V){return this.material.update(V)}prepareTechnique(V){if(!this.material.shouldRender(V))return null;const {output:Y,bindParameters:W}=V;if(!this.material.produces(W.slot,Y))return null;
const H=Y===p.ShaderOutput.Highlight||Y===p.ShaderOutput.ShadowHighlight;if(H&&!this._hasHighlights)return null;const S=Y===p.ShaderOutput.ShadowExcludeHighlight,I=!(H||S);for(const N of this._dataByOrigin.values())for(const T of N.buffers){if(H&&!T.hasHighlights)continue;var Q=(H?T.drawCommandsHighlight:S&&T.needsMultipleCommands()?T.drawCommandsShadowHighlightRest:T.drawCommandsDefault)||null;const aa=I&&T.drawCommandsOccludees||null;if(Q?.length||aa?.length)if(Q=this._glMaterials.load(V.rctx,W.slot,
Y),Q=null!=Q?Q.beginSlot(W):null,null!=Q)return Q}return null}renderNode(V,Y){const {output:W,bindParameters:H}=V,S=W===p.ShaderOutput.Highlight||W===p.ShaderOutput.ShadowHighlight,I=W===p.ShaderOutput.ShadowExcludeHighlight,Q=!(S||I),N=V.rctx,T=V.bindParameters.slot===y.RenderSlot.OCCLUDER_MATERIAL;V=V.bindParameters.slot===y.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL;N.runAppleAmdDriverHelper();N.bindTechnique(Y,this.material.parameters,H);for(const aa of this._dataByOrigin.values())for(const Z of aa.buffers){if(S&&
!Z.hasHighlights)continue;const da=(S?Z.drawCommandsHighlight:I&&Z.needsMultipleCommands()?Z.drawCommandsShadowHighlightRest:Z.drawCommandsDefault)||null,fa=Q&&Z.drawCommandsOccludees||null;if(da?.length||fa?.length)Y.program.bindDraw(new A.DrawParameters(aa.origin),H,this.material.parameters),Y.ensureAttributeLocations(Z.vao),N.bindVAO(Z.vao),da?.length&&(N.setPipelineState(Y.getPipeline(!1,T,V)),da.forAll(ka=>N.drawArrays(Y.primitiveType,ka.first,ka.count))),fa?.length&&(N.setPipelineState(Y.getPipeline(!0,
T,V)),fa.forAll(ka=>N.drawArrays(Y.primitiveType,ka.first,ka.count)))}}get test(){return{material:this.material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}};a.__decorate([q.property({constructOnly:!0})],b.MergedRenderer.prototype,"material",void 0);b.MergedRenderer=a.__decorate([l.subclass("esri.views.3d.webgl-engine.materials.renderers.MergedRenderer")],b.MergedRenderer);class P{constructor(V){this.origin=V;this.changes=[]}}const J=v.create(),R=v.create(),X=v.create(),U=new g({allocator:V=>
V||new E.BufferRange,deallocator:null});let M=new Float32Array(65536);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/GLMaterials":function(){define(["exports","./basicInterfaces"],function(b,a){class c{constructor(d,f){this._material=d;this._repository=f;this._map=new Map}dispose(){this._map.forEach((d,f)=>{null!=d&&this._repository.release(this._material,f)})}load(d,f,n){if(!this._material.produces(f,n))return null;this._map.has(n)||this._map.set(n,
this._repository.acquire(this._material,f,n));f=this._map.get(n);if(null!=f){if(f.ensureResources(d)===a.ResourceState.LOADED)return f;this._repository.requestRender()}return null}}b.GLMaterials=c;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/DrawParameters":function(){define(["exports","../../../../chunks/vec3f64","../core/shaderLibrary/attributes/VertexNormal.glsl"],function(b,a,c){class d extends c.VertexNormalDrawParameters{constructor(f=
a.create()){super();this.slicePlaneLocalOrigin=this.origin=f}}b.DrawParameters=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/WaterMaterial":function(){define("exports ../../../../core/has ../../../../core/time ../../../../chunks/vec2f64 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../core/shaderLibrary/ShaderOutput ../lib/AnimationTimer ../lib/Material ../lib/OrderIndependentTransparency ../lib/RenderSlot ./DefaultBufferWriter ./DefaultLayouts ./TriangleMaterial ./WaterGLMaterial ./WaterTechnique".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p){class h extends v.TriangleMaterial{constructor(r){super(r,new t);this._configuration=new p.WaterTechniqueConfiguration;this._animation=new g.AnimationTimer}getConfiguration(r,u){this._configuration.output=r;this._configuration.writeDepth=this.parameters.writeDepth;this._configuration.receiveShadows=this.parameters.receiveShadows;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.transparent=this.parameters.transparent;this._configuration.hasScreenSpaceReflections=
this.parameters.hasScreenSpaceReflections;this._configuration.hasCloudsReflections=this.parameters.hasCloudsReflections;this._configuration.isDraped=this.parameters.isDraped;this._configuration.transparencyPassType=u.transparencyPassType;this._configuration.enableOffset=u.camera.relativeElevation<e.OITPolygonOffsetLimit;this._configuration.multipassEnabled=u.multipassEnabled;this._configuration.cullAboveGround=u.multipassTerrain.cullAboveGround;return this._configuration}update(r){this._animation.enabled=
35E3>Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*Math.min(r.camera.relativeElevation,r.camera.distance);r=this._animation.advance(r);this.setParameters({timeElapsed:c.secondsFromMilliseconds(this._animation.time)*this.parameters.animationSpeed},!1);return this._animation.enabled&&r}produces(r,u){switch(u){case k.ShaderOutput.Normal:return r===m.RenderSlot.DRAPED_WATER;case k.ShaderOutput.Color:if(this.parameters.isDraped)return r===m.RenderSlot.DRAPED_MATERIAL;break;
case k.ShaderOutput.Alpha:break;case k.ShaderOutput.Highlight:case k.ShaderOutput.ObjectAndLayerIdColor:return r===m.RenderSlot.OPAQUE_MATERIAL||r===m.RenderSlot.DRAPED_MATERIAL;default:return!1}u=m.RenderSlot.OPAQUE_MATERIAL;this.parameters.transparent&&(u=this.parameters.writeDepth?m.RenderSlot.TRANSPARENT_MATERIAL:m.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL);return r===u}createGLMaterial(r){return new x.WaterGLMaterial(r)}createBufferWriter(){return new l.DefaultBufferWriter(a("enable-feature:objectAndLayerId-rendering")?
w.PositionUVLayoutObjectAndLayerId:w.PositionUVLayout)}get test(){return{animationEnabled:this._animation.enabled}}}class t extends q.MaterialParameters{constructor(){super(...arguments);this.waveStrength=.06;this.waveTextureRepeat=32;this.waveDirection=d.fromValues(1,0);this.waveVelocity=.05;this.flowStrength=.015;this.flowOffset=-.5;this.animationSpeed=.35;this.timeElapsed=0;this.color=n.fromValues(0,0,0,0);this.writeDepth=this.transparent=!0;this.isDraped=this.hasSlicePlane=!1;this.receiveShadows=
!0;this.hasCloudsReflections=this.hasScreenSpaceReflections=!1;this.origin=f.create();this.modelTransformation=null}}b.WaterMaterial=h;b.WaterMaterialParameters=t;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/DefaultLayouts":function(){define(["exports","../../support/buffer/InterleavedLayout","../lib/VertexAttribute"],function(b,a,c){const d=a.newLayout().vec3f(c.VertexAttribute.POSITION),f=a.newLayout().vec3f(c.VertexAttribute.POSITION).vec2f(c.VertexAttribute.UV0),
n=a.newLayout().vec3f(c.VertexAttribute.POSITION).vec4u8(c.VertexAttribute.COLOR),k=a.newLayout().vec3f(c.VertexAttribute.POSITION).vec4u8(c.VertexAttribute.OBJECTANDLAYERIDCOLOR),g=a.newLayout().vec3f(c.VertexAttribute.POSITION).vec2f(c.VertexAttribute.UV0).vec4u8(c.VertexAttribute.OBJECTANDLAYERIDCOLOR);a=a.newLayout().vec3f(c.VertexAttribute.POSITION).vec4u8(c.VertexAttribute.COLOR).vec4u8(c.VertexAttribute.OBJECTANDLAYERIDCOLOR);b.PositionColorLayout=n;b.PositionColorLayoutObjectAndLayerId=a;
b.PositionLayout=d;b.PositionLayoutObjectAndLayerId=k;b.PositionUVLayout=f;b.PositionUVLayoutObjectAndLayerId=g;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/TriangleMaterial":function(){define(["exports","../lib/Material","./internal/MaterialUtil"],function(b,a,c){class d extends a.Material{intersect(f,n,k,g,q,e){return c.intersectTriangleGeometry(f,k,g,q,void 0,e)}}b.TriangleMaterial=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/materials/WaterGLMaterial":function(){define(["exports","../core/shaderLibrary/ShaderOutput","../lib/GLMaterial","./WaterTechnique"],function(b,a,c,d){class f extends c{_updateShadowState(n){n.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:n.shadowMap.enabled})}_updateSSRState(n){n=null!=n.ssr.lastFrameColor;n!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:n})}_updateCloudsReflectionState(n){n=
null!=n.cloudsFade.data;n!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:n})}ensureResources(n){return this._techniqueRepository.constructionContext.waterTextureRepository.ensureResources(n)}beginSlot(n){this._output===a.ShaderOutput.Color&&(this._updateShadowState(n),this._updateSSRState(n),this._updateCloudsReflectionState(n));this._material.setParameters(this._techniqueRepository.constructionContext.waterTextureRepository.passParameters);return this.ensureTechnique(d.WaterTechnique,
n)}}b.WaterGLMaterial=f;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/WaterTechnique":function(){define("require exports ../../../../chunks/tslib.es6 ../../../ViewingMode ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderLibrary/shading/WaterDistortion.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../lib/TransparencyPassType ./DefaultTechniqueConfiguration ../../../../chunks/WaterSurface.glsl ../../../webgl/renderState".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h){class t extends k.WaterDistortionPassParameters{}class r extends q.ShaderTechnique{initializeConfiguration(y,z){z.spherical=y.viewingMode===d.ViewingMode.Global;z.doublePrecisionRequiresObfuscation=y.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(y){return new w.Program(y.rctx,r.shader.get().build(this.configuration),m.Default3D)}_setPipelineState(y){const z=this.configuration,A=y===v.TransparencyPassType.NONE,C=y===v.TransparencyPassType.FrontFace;
return h.makePipelineState({blending:z.output!==f.ShaderOutput.Normal&&z.output!==f.ShaderOutput.Highlight&&z.output!==f.ShaderOutput.ObjectAndLayerIdColor&&z.transparent?A?l.blendingDefault:l.oitBlending(y):null,depthTest:{func:l.oitDepthTest(y)},depthWrite:A?z.writeDepth?h.defaultDepthWriteParams:null:l.oitDepthWrite(y),colorWrite:h.defaultColorWriteParams,polygonOffset:A||C?null:l.getOITPolygonOffset(z.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}
r.shader=new g.ReloadableShaderModule(p.WaterSurface,()=>new Promise((y,z)=>b(["../shaders/WaterSurface.glsl"],y,z)));class u extends x.DefaultTechniqueConfiguration{constructor(){super(...arguments);this.output=f.ShaderOutput.Color;this.transparencyPassType=v.TransparencyPassType.NONE;this.transparent=this.hasSlicePlane=this.receiveShadows=this.spherical=!1;this.enableOffset=!0;this.cullAboveGround=this.multipassEnabled=this.isDraped=this.objectAndLayerIdColorInstanced=this.hasCloudsReflections=
this.doublePrecisionRequiresObfuscation=this.hasScreenSpaceReflections=this.writeDepth=!1}}c.__decorate([e.parameter({count:f.ShaderOutput.COUNT})],u.prototype,"output",void 0);c.__decorate([e.parameter({count:v.TransparencyPassType.COUNT})],u.prototype,"transparencyPassType",void 0);c.__decorate([e.parameter()],u.prototype,"spherical",void 0);c.__decorate([e.parameter()],u.prototype,"receiveShadows",void 0);c.__decorate([e.parameter()],u.prototype,"hasSlicePlane",void 0);c.__decorate([e.parameter()],
u.prototype,"transparent",void 0);c.__decorate([e.parameter()],u.prototype,"enableOffset",void 0);c.__decorate([e.parameter()],u.prototype,"writeDepth",void 0);c.__decorate([e.parameter()],u.prototype,"hasScreenSpaceReflections",void 0);c.__decorate([e.parameter()],u.prototype,"doublePrecisionRequiresObfuscation",void 0);c.__decorate([e.parameter()],u.prototype,"hasCloudsReflections",void 0);c.__decorate([e.parameter()],u.prototype,"objectAndLayerIdColorInstanced",void 0);c.__decorate([e.parameter()],
u.prototype,"isDraped",void 0);c.__decorate([e.parameter()],u.prototype,"multipassEnabled",void 0);c.__decorate([e.parameter()],u.prototype,"cullAboveGround",void 0);c.__decorate([e.parameter({constValue:!1})],u.prototype,"occlusionPass",void 0);c.__decorate([e.parameter({constValue:n.PBRMode.Water})],u.prototype,"pbrMode",void 0);c.__decorate([e.parameter({constValue:!0})],u.prototype,"useCustomDTRExponentForWater",void 0);c.__decorate([e.parameter({constValue:!0})],u.prototype,"highStepCount",void 0);
c.__decorate([e.parameter({constValue:!1})],u.prototype,"useFillLights",void 0);a.WaterMaterialPassParameters=t;a.WaterTechnique=r;a.WaterTechniqueConfiguration=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/WaterDistortion.glsl":function(){define("exports ../../../../../../chunks/vec2 ../../../../../../chunks/vec2f64 ../../../../../../chunks/vec4 ../../../../../../chunks/vec4f64 ./FoamRendering.glsl ./ReadShadowMap.glsl ../../shaderModules/Float2PassUniform ../../shaderModules/Float4PassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m){class l extends k.ReadShadowMapPassParameters{}const w=f.create(),v=c.create();b.WaterDistortion=function(x){x.fragment.uniforms.add(new m.Texture2DPassUniform("texWaveNormal",p=>p.waveNormal),new m.Texture2DPassUniform("texWavePerturbation",p=>p.wavePerturbation),new q.Float4PassUniform("waveParams",p=>d.set(w,p.waveStrength,p.waveTextureRepeat,p.flowStrength,p.flowOffset)),new g.Float2PassUniform("waveDirection",p=>a.set(v,p.waveDirection[0]*p.waveVelocity,p.waveDirection[1]*
p.waveVelocity)));x.include(n.FoamIntensity);x.fragment.code.add(e.glsl`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)};b.WaterDistortionPassParameters=l;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/WaterSurface.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/ObjectAndLayerIdColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Water.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/WaterDistortion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A,C){function E(D){const F=new z.ShaderBuilder,{vertex:K,fragment:L}=F;t.addProjViewLocalOrigin(K,D);F.include(f.Transform,D);F.attributes.add(C.VertexAttribute.POSITION,"vec3");F.attributes.add(C.VertexAttribute.UV0,"vec2");const G=new r.Float4PassUniform("waterColor",O=>O.color);if(D.output===c.ShaderOutput.Color&&D.isDraped)return F.varyings.add("vpos","vec3"),K.uniforms.add(G),K.code.add(y.glsl`
        void main(void) {
          if (waterColor.a < ${y.glsl.float(p.symbolAlphaCutoff)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),L.uniforms.add(G),L.code.add(y.glsl`void main() {
fragColor = waterColor;
}`),F;if(D.output===c.ShaderOutput.Color||D.output===c.ShaderOutput.Alpha)F.include(m.NormalUtils,D),F.include(a.ForwardLinearDepth,D),F.varyings.add("vuv","vec2"),F.varyings.add("vpos","vec3"),F.varyings.add("vnormal","vec3"),F.varyings.add("vtbnMatrix","mat3"),D.multipassEnabled&&F.varyings.add("depth","float"),K.uniforms.add(G),K.code.add(y.glsl`
      void main(void) {
        if (waterColor.a < ${y.glsl.float(p.symbolAlphaCutoff)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${D.multipassEnabled?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${D.output===c.ShaderOutput.Color?"forwardLinearDepth();":""}
      }
    `);F.include(e.multipassTerrainTest,D);switch(D.output){case c.ShaderOutput.Alpha:F.include(d.SliceDraw,D);L.uniforms.add(G);L.code.add(y.glsl`
        void main() {
          discardBySlice(vpos);
          ${D.multipassEnabled?"terrainDepthTest(depth);":""}

          fragColor = vec4(waterColor.a);
        }
      `);break;case c.ShaderOutput.Color:F.include(q.MainLighting);F.include(g.EvaluateAmbientLighting,{pbrMode:l.PBRMode.Disabled,lightingSphericalHarmonicsOrder:2});F.include(x.WaterDistortion);F.include(d.SliceDraw,D);F.include(w.ReadShadowMapDraw,D);F.include(v.Water,D);L.uniforms.add(G,new u.FloatPassUniform("timeElapsed",O=>O.timeElapsed),K.uniforms.get("view"),K.uniforms.get("localOrigin"));t.addCameraPosition(L,D);L.include(h.ColorConversion);q.addMainLightDirection(L);q.addMainLightIntensity(L);
L.code.add(y.glsl`
      void main() {
        discardBySlice(vpos);
        ${D.multipassEnabled?"terrainDepthTest(depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${D.receiveShadows?y.glsl`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view * vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, mainLightDirection, waterColor.rgb, mainLightIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        fragColor = delinearizeGamma(final);
        fragColor = highlightSlice(fragColor, vpos);
        ${D.transparencyPassType===A.TransparencyPassType.Color?"fragColor \x3d premultiplyAlpha(fragColor);":""}
      }
    `);break;case c.ShaderOutput.Normal:F.include(m.NormalUtils,D);F.include(x.WaterDistortion,D);F.include(d.SliceDraw,D);F.varyings.add("vpos","vec3");F.varyings.add("vuv","vec2");K.uniforms.add(G);K.code.add(y.glsl`
        void main(void) {
          if (waterColor.a < ${y.glsl.float(p.symbolAlphaCutoff)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `);L.uniforms.add(new u.FloatPassUniform("timeElapsed",O=>O.timeElapsed));L.code.add(y.glsl`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
fragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`);break;case c.ShaderOutput.Highlight:F.include(k.OutputHighlight,D);F.varyings.add("vpos","vec3");K.uniforms.add(G);K.code.add(y.glsl`
      void main(void) {
        if (waterColor.a < ${y.glsl.float(p.symbolAlphaCutoff)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `);F.include(d.SliceDraw,D);L.code.add(y.glsl`void main() {
discardBySlice(vpos);
outputHighlight();
}`);break;case c.ShaderOutput.ObjectAndLayerIdColor:F.include(n.ObjectAndLayerIdColor,D),F.varyings.add("vpos","vec3"),K.uniforms.add(G),K.code.add(y.glsl`
      void main(void) {
        if (waterColor.a < ${y.glsl.float(p.symbolAlphaCutoff)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
        forwardObjectAndLayerIdColor();
      }
    `),F.include(d.SliceDraw,D),L.code.add(y.glsl`void main() {
discardBySlice(vpos);
outputObjectAndLayerIdColor();
}`)}return F}const B=Object.freeze(Object.defineProperty({__proto__:null,build:E},Symbol.toStringTag,{value:"Module"}));b.WaterSurface=B;b.build=E})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(b,a){b.NormalUtils=function(c,d){d.spherical?c.vertex.code.add(a.glsl`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):c.vertex.code.add(a.glsl`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`);d.spherical?c.vertex.code.add(a.glsl`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):c.vertex.code.add(a.glsl`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/BufferRange":function(){define(["exports"],function(b){class a{constructor(c=0,d=0){this.from=c;this.to=d}get numElements(){return this.to-this.from}}b.BufferRange=a;b.mergeAdjacentRanges=function(c){const d=new Map;c.forAll(n=>d.set(n.from,n));let f=!0;for(;f;)f=!1,c.forEach(n=>{const k=d.get(n.to);k&&(n.to=k.to,d.delete(k.from),c.removeUnordered(k),f=!0)})};Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/Instance":function(){define(["exports","./BufferRange"],function(b,a){class c extends a.BufferRange{constructor(d,f,n){super(f,n);this.geometry=d}get isVisible(){return this.geometry.visible}get hasHighlights(){return null!=this.geometry.highlights&&this.isVisible}get hasOccludees(){return null!=this.geometry.occludees}}b.Instance=c;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/PerBufferData":function(){define(["exports",
"../../../../../core/PooledArray","./BufferRange","./DrawCommand"],function(b,a,c,d){function f(){return new a({allocator:q=>q||new d.DrawCommand,deallocator:q=>q})}function n(q,e){const m=q.back();null==m?(q=q.pushNew(),q.first=e.from,q.count=e.numElements):m.first+m.count>=e.from?m.count=e.from-m.first+e.numElements:(q=q.pushNew(),q.first=e.from,q.count=e.numElements)}class k{constructor(){this._numElements=0;this._instances=new Map;this.holes=new a({allocator:q=>q||new c.BufferRange,deallocator:null});
this.hasOccludees=this.hasHighlights=this.hasHiddenInstances=!1;this.drawCommandsDirty=!0;this.drawCommandsDefault=f();this.drawCommandsHighlight=f();this.drawCommandsOccludees=f();this.drawCommandsShadowHighlightRest=f()}get numElements(){return this._numElements}get instances(){return this._instances}addInstance(q,e){this.deleteInstance(q);this._instances.set(q,e);this._numElements+=e.numElements}deleteInstance(q){const e=this._instances.get(q);e&&(this._numElements-=e.numElements,this._instances.delete(q))}updateInstance(q,
e,m){if(q=this._instances.get(q))this._numElements-=q.numElements,q.from=e,q.to=m,this._numElements+=q.numElements}updateDrawState(q){q.isVisible?(q.hasHighlights&&(this.hasHighlights=!0),q.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0}updateDrawCommands(q){this.drawCommandsDefault.clear();this.drawCommandsHighlight.clear();this.drawCommandsOccludees.clear();this.drawCommandsShadowHighlightRest.clear();this.drawCommandsDirty=!1;if(0!==this._instances.size)if(this.needsMultipleCommands()){q=
Array.from(this._instances.values()).sort((m,l)=>m.from===l.from?m.to-l.to:m.from-l.from);for(var e of q)e.isVisible&&(n(e.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,e),n(e.hasHighlights?this.drawCommandsHighlight:this.drawCommandsShadowHighlightRest,e))}else{const m=this.drawCommandsDefault.pushNew();e=this.holes.front();null!=this.vao&&1===this.holes.length&&e.to===Math.floor(this.vao.byteSize/q)?(m.first=0,m.count=e.from):(m.first=Infinity,m.count=0,this._instances.forEach(l=>
{m.first=Math.min(m.first,l.from);m.count=Math.max(m.count,l.to)}),m.count-=m.first)}}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}}class g extends k{}b.PerBufferData=k;b.PerVaoData=g;b.hasVao=function(q){return null!=q.vao};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/DrawCommand":function(){define(["exports"],function(b){class a{constructor(){this.count=this.first=0}}b.DrawCommand=
a;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/PerOriginData":function(){define(["exports"],function(b){class a{constructor(c){this.origin=c;this.buffers=[]}dispose(){this.buffers.forEach(c=>c.vao.dispose());this.buffers.length=0}findBuffer(c){return this.buffers.find(d=>d.instances.has(c))}}b.PerOriginData=a;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/VaoCache":function(){define("exports ../../../../../core/MemCache ../../../../../core/MemCachePool ../../lib/VertexArrayObject ../../../../webgl/BufferObject ../../../../webgl/enums".split(" "),
function(b,a,c,d,f,n){const k=a.minPriority+1;class g{constructor(q,e,m){this._rctx=q;this._locations=e;this._layout=m;this._cache=new c.MemCachePool(q.newCache,"VAOCache")}dispose(){this._cache.destroy()}newVao(q){let e=this._cache.pop(q.toString());if(e)return e;e=new d.VertexArrayObject(this._rctx,this._locations,{geometry:this._layout},{geometry:f.BufferObject.createVertex(this._rctx,n.Usage.STATIC_DRAW)});e.vertexBuffers.geometry.setSize(q);return e}deleteVao(q){null!=q&&this._cache.put(q.byteSize.toString(),
q,k)}}b.VaoCache=g;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextureTechnique":function(){define("require exports ../../../../chunks/TextureOnly.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ./DefaultVertexAttributeLocations ./Program ../../../webgl/enums ../../../webgl/renderState".split(" "),function(b,a,c,d,f,n,k,g,q){class e extends f.ShaderTechnique{initializeProgram(m){return new k.Program(m.rctx,
e.shader.get().build(),n.Default3D)}initializePipeline(){return this.configuration.hasAlpha?q.makePipelineState({blending:q.separateBlendingParams(g.BlendFactor.SRC_ALPHA,g.BlendFactor.ONE,g.BlendFactor.ONE_MINUS_SRC_ALPHA,g.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:q.defaultColorWriteParams}):q.makePipelineState({colorWrite:q.defaultColorWriteParams})}}e.shader=new d.ReloadableShaderModule(c.TextureOnly,()=>new Promise((m,l)=>b(["../core/shaderLibrary/util/TextureOnly.glsl"],m,l)));a.TextureTechnique=
e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextureTechniqueConfiguration":function(){define(["exports","../../../../chunks/tslib.es6","../core/shaderTechnique/ShaderTechniqueConfiguration"],function(b,a,c){class d extends c.ShaderTechniqueConfiguration{constructor(){super(...arguments);this.hasAlpha=!1}}a.__decorate([c.parameter()],d.prototype,"hasAlpha",void 0);b.TextureTechniqueConfiguration=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/chunks/OverlayCompositing.glsl":function(){define("exports ../views/3d/terrain/interfaces ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/IntegerPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),function(b,a,c,d,f,n,k,g){function q(){const l=
new k.ShaderBuilder;l.include(c.ScreenSpacePass);l.fragment.uniforms.add(new g.Texture2DPassUniform("tex",w=>w.texture));l.fragment.uniforms.add(new f.IntegerPassUniform("overlayIdx",w=>w.overlayIndex));l.fragment.uniforms.add(new d.FloatPassUniform("opacity",w=>w.opacity));l.fragment.code.add(n.glsl`void main() {
vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
fragColor = texture(tex, overlayUV) * opacity;
}`);return l}class e extends n.NoParameters{constructor(){super(...arguments);this.overlayIndex=a.OverlayIndex.INNER;this.opacity=1}}const m=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:e,build:q},Symbol.toStringTag,{value:"Module"}));b.OverlayCompositing=m;b.OverlayCompositingPassParameters=e;b.build=q})},"esri/views/3d/webgl-engine/shaders/OverlayCompositingTechnique":function(){define("require exports ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/OverlayCompositing.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(b,a,c,d,f,n,k,g,q){class e extends d.ShaderTechnique{initializeProgram(m){return new n.Program(m.rctx,e.shader.get().build(),f.Default3D)}initializePipeline(){return q.makePipelineState({blending:q.simpleBlendingParams(g.BlendFactor.ONE,g.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:q.defaultColorWriteParams})}}e.shader=new c.ReloadableShaderModule(k.OverlayCompositing,()=>new Promise((m,l)=>b(["./OverlayCompositing.glsl"],m,l)));a.OverlayCompositingTechnique=e;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Normals":function(){define(["exports","../../../../core/mathUtils","../../../../chunks/vec3"],function(b,a,c){function d(k,g,q,e,m,l=2){var w=1/(Math.abs(q)+Math.abs(e)+Math.abs(m));q*=w;e*=w;w=0>=m?(0<=e?1:-1)*(1-Math.abs(q)):e;g*=l;k[g]=f(0>=m?(0<=q?1:-1)*(1-Math.abs(e)):q);k[g+1]=f(w)}function f(k){return a.clamp(Math.round(32767*k),-32767,32767)}function n(k){return a.clamp(k/32767,-1,1)}b.compressNormal=d;b.compressNormals=function(k){const g=
k.length/3,q=new Int16Array(2*g);let e=0;for(let m=0;m<g;++m)d(q,m,k[e++],k[e++],k[e++]);return q};b.decodeInt16=n;b.decompressNormal=function(k,g,q,e=2){e*=q;q=n(g[e]);g=n(g[e+1]);e=1-Math.abs(q)-Math.abs(g);k[2]=e;0>e?(k[0]=(0<=q?1:-1)*(1-Math.abs(g)),k[1]=(0<=g?1:-1)*(1-Math.abs(q))):(k[0]=q,k[1]=g);c.normalize(k,k)};b.encodeInt16=f;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DIconSymbolLayer":function(){define("require exports ../../../../Color ../../../../symbols ../../../../core/asyncUtils ../../../../core/Error ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../core/urlUtils ../../../../chunks/vec2f64 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/projection/projectPointToVector ../../../../geometry/support/aaBoundingBox ../../../../support/arcadeOnDemand ../../../../symbols/support/IconSymbol3DLayerResource ../../../../symbols/support/utils ../../../2d/arcade/callExpressionWithFeature ./constants ./ElevationAligners ./elevationAlignmentUtils ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./interfaces ./placementUtils ./pointUtils ../support/FastSymbolUpdates ../../support/engineContent/sdfPrimitives ../../terrain/OverlayRenderer ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/Texture ../../webgl-engine/materials/HUDMaterial ../../../../symbols/CIMSymbol".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A,C,E,B,D,F,K,L,G,O,P,J,R,X,U){function M(N){return null==N?!1:"cross"===N||"x"===N}const V=l.fromValues(0,0,1);d=G.defaultTexSize;const Y=G.defaultSymbolSizeRatio,W=[Y/2,Y/2,1-Y/2,1-Y/2];class H extends E.Graphics3DSymbolLayer{getCachedSize(){return{size:this._getIconSize()}}constructor(N,T,aa,Z){super(N,T,aa,Z);this._cimLayers=null;this._cimSymbolMaterials=new Map;this._cimSymbolTextures=new Map;this._size=this._cimScaleFactorOrFunction=this._cimRequiredFields=
this._cimMaterialParametersInfo=null;this._symbolTextureRatio=1;this._outlineSize=0;this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}async doLoad(N){this._validateOrThrow();const T=this._prepareMaterialParameters();var aa=this._getPrimitive();if(null!=aa)this._prepareResourcesPrimitive(T,aa);else{aa=t.getIconHref(this.symbolLayer);const Z=e.dataComponents(aa);Z&&"application/json"===Z.mediaType?await this._prepareResourcesCIM(T,JSON.parse(Z.data),N):await this._prepareResourcesHref(T,
aa,N)}}_validateOrThrow(){if(!this._drivenProperties.size){var N=B.validateSymbolLayerSize(this._getIconSize());if(N)throw new n("graphics3diconsymbollayer:invalid-size",N);}}_getIconSize(){var N=this.symbolLayer;N=Math.round(null!=N.size?q.pt2px(N.size):16);return this._drivenProperties.size?Math.max(N,64):N}_generateTextureCIM(N){const T=this._getGraphicHash(N);let aa=""===T?null:this._cimSymbolTextures.get(T);aa||(N=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol3D(this._cimLayers,
N,"esriGeometryPoint",{scaleFactor:this._cimScaleFactorOrFunction},void 0,void 0),this._cimMaterialParametersInfo.anchorPosition=this._getAnchorPos("relative",N.anchorPosition),aa=new R.Texture(N.imageData,{width:N.imageData.width,height:N.imageData.height}),this._cimSymbolTextures.set(T,aa),this._context.stage.add(aa));return aa}_prepareMaterialParameters(){const N={anchorPosition:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},T=this.symbol;if(T&&"point-3d"===T.type&&
T.hasVisibleVerticalOffset()){const {screenLength:aa,minWorldLength:Z,maxWorldLength:da}=T.verticalOffset;N.verticalOffset={screenLength:q.pt2px(aa),minWorldLength:Z||0,maxWorldLength:null!=da?da:Infinity}}this._context.screenSizePerspectiveEnabled&&(N.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);N.occlusionTest=!0;N.hasSlicePlane=this._context.slicePlaneEnabled;return N}_prepareResourcesPrimitive(N,T){var aa=this._getOutlineSize();if(M(T)&&0===aa)throw Error("Nothing to render");
this._outlineSize=aa;N.color=this._getFillColor();N.outlineColor=this._getOutlineColor();N.outlineSize=this._outlineSize;null!=this._context.sharedResources.textures&&(this._textureHandle=aa=this._context.sharedResources.textures.fromData(`${T}-icon`,()=>G.createTexture(T)),N.textureId=aa.texture.id);N.textureIsSignedDistanceField=!0;N.sampleSignedDistanceFieldTexelCenter=G.requiresHalfTexelOffset(T);N.distanceFieldBoundingBox=W;aa=this._getIconSize();this._size=[aa,aa];this._symbolTextureRatio=1/
Y;this._createMaterialAndAddToStage(N,this._context.stage)}async _prepareResourcesHref(N,T,aa){this._outlineSize=this._getOutlineSize();N.color=this._getFillColor();N.outlineColor=this._getOutlineColor();N.outlineSize=this._outlineSize;N.textureIsSignedDistanceField=!1;const Z=this._getIconSize(),da=Z*this._context.graphicsCoreOwner.view.state.rasterPixelRatio;if(null!=this._context.sharedResources.textures){aa=await f.result(this._context.sharedResources.textures.fromUrl(T,da,{signal:aa}));if(!1===
aa.ok)throw g.throwIfAbortError(aa.error),new n("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${T})`);this._textureHandle=aa.value;T=aa.value.texture;aa=T.parameters.width/T.parameters.height;this._size=1<aa?[Z,Math.round(Z/aa)]:[Math.round(Z*aa),Z];N.textureId=T.id}this._createMaterialAndAddToStage(N,this._context.stage)}async _prepareResourcesCIM(N,T,aa){T=new U({data:T});if(!this._context.sharedResources.cimSymbolRasterizer){var Z=(await new Promise((ha,
ba)=>b(["../../../../symbols/cim/CIMSymbolRasterizer"],ha,ba))).CIMSymbolRasterizer;g.throwIfAborted(aa);this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new Z(this._context.renderCoordsHelper.spatialReference,!0))}Z=this._context.layer.fields?this._context.layer.fields.map(ha=>ha.toJSON()):null;this._cimLayers=await this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol3D(T,Z,this._context.renderer&&"dictionary"===this._context.renderer.type?
this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:aa});let da;if(this._context.renderer&&"dictionary"===this._context.renderer.type&&this._context.renderer.scaleExpression)if(T=this._context.renderer,isNaN(T.scaleExpression)){const ha=await p.createRendererExpression(T.scaleExpression,this._context.layer.spatialReference,Z);da=(ba,ea,ca)=>{ba=r(ha,ba,{$view:ca},"esriGeometryPoint",ea);return null!==ba?ba:1}}else var fa=Number(T.scaleExpression);this._cimScaleFactorOrFunction=fa||da||
1;fa=this._context.renderer?await this._context.renderer.getRequiredFields(this._context.layer.fieldsIndex):[];g.throwIfAborted(aa);const ka=this._context.layer.fieldsIndex;this._cimRequiredFields=fa.map(ha=>ka.get(ha).name);this._cimMaterialParametersInfo=N;this._cimMaterialParametersInfo.color=this._getFillColor();this._cimMaterialParametersInfo.outlineColor=[0,0,0,0];this._cimMaterialParametersInfo.outlineSize=0;this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1}_getPrimitive(){return this.symbolLayer.resource&&
this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||h.defaultPrimitive}_getOutlineSize(){var N=0;N=this.symbolLayer;if(null!=N.outline?.size)return Math.max(q.pt2px(N.outline.size),0);N=this._getPrimitive();N=M(N)?1.5:0;return Math.max(N,0)}_getOutlineColor(){const N=this._getLayerOpacity(),T=this.symbolLayer?.outline?.color;if(null!=T){const aa=c.toUnitRGB(T);return[aa[0],aa[1],aa[2],T.a*N]}return[0,0,0,0]}_getFillColor(){if(M(this._getPrimitive()))return u.transparentUnit;
const N=null==this._getPrimitive();return this._getCombinedOpacityAndColor(this.symbolLayer?.material?.color,{hasIntrinsicColor:N})}_getAnchorPos(N,T){return"relative"===N?m.fromValues((T.x||0)+.5,-(T.y||0)+.5):N in F.namedAnchorToHUDMaterialAnchorPos?F.namedAnchorToHUDMaterialAnchorPos[N]:F.namedAnchorToHUDMaterialAnchorPos.center}_createMaterialAndAddToStage(N,T){if(this._cimLayers){this._fastUpdates=null;let aa=N.textureId?this._cimSymbolMaterials.get(N.textureId):null;aa||(aa=new X.HUDMaterial(N),
this._cimSymbolMaterials.set(N.textureId??0,aa),T.add(aa));return aa}(this._fastUpdates=L.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions()))&&(N={...N,...this._fastUpdates.materialParameters});this._materials[0]=new X.HUDMaterial(N);T.add(this._materials[0]);return this._materials[0]}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial(N=>{N.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,
shaderPolygonOffset:0,isDraped:this.draped})}),this.layerOpacityChanged())}destroy(){super.destroy();this._forEachMaterial(N=>this._context.stage.remove(N));this._materials.length=0;this._cimSymbolMaterials.clear();this._cimSymbolTextures.forEach(N=>this._context.stage.remove(N));this._cimSymbolTextures.clear();this._textureHandle=k.releaseMaybe(this._textureHandle)}_getScaleFactor(N,T){if(this._drivenProperties.size&&N.size){for(let aa=0;3>aa;aa++){const Z=N.size[aa];Z&&"symbol-value"!==Z&&"proportional"!==
Z&&(N.size[aa]=q.pt2px(Z))}if("symbol-value"===N.size[0])return 1;if(isFinite(+N.size[0]))return+N.size[0]/T;if(isFinite(+N.size[2]))return+N.size[2]/T}return 1}createGraphics3DGraphic(N){const T=N.graphic;if(!this._validateGeometry(T.geometry))return null;var aa=[0,0];let Z;if(this._cimLayers){if(!this._cimLayers.length)return null;var da=this._generateTextureCIM(T);Z=this._createMaterialAndAddToStage({textureId:da.id,...this._cimMaterialParametersInfo},this._context.stage);aa=[da.parameters.width,
da.parameters.height]}else aa=this._size,Z=this._materials[0];da=K.placePointOnGeometry(T.geometry);if(null==da)return this.logger.warn(`unsupported geometry type for icon symbol: ${T.geometry.type}`),null;var fa=N.renderingInfo;const ka=this._getVertexOpacityAndColor(fa);let ha=1;this._fastUpdates?.visualVariables.size||(ha=this._getScaleFactor(fa,aa[0]>aa[1]?aa[0]:aa[1]));ha*=this._symbolTextureRatio;aa=m.fromValues(aa[0]*ha,aa[1]*ha);fa=this.setGraphicElevationContext(T);this.ensureDrapedStatus("on-the-ground"===
fa.mode)&&this._setDrapingDependentMaterialParameters();return this.draped?this._createAsOverlay(T,da,Z,ka,aa,N.layer.uid):this._createAs3DShape(T,da,Z,ka,aa,fa,T.uid)}layerOpacityChanged(){const N=this._getFillColor(),T=this._getOutlineColor();this._forEachMaterial(aa=>{aa.setParameters({color:N});aa.setParameters({outlineColor:T})})}layerElevationInfoChanged(N,T,aa){const Z=this._elevationContext.mode;aa=z.elevationModeChangeUpdateType(H.elevationModeChangeTypes,aa,Z);if(aa!==z.SymbolUpdateType.UPDATE)return aa;
const da=z.needsElevationUpdates2D(Z)||"absolute-height"===Z;return this.updateGraphics3DGraphicElevationInfo(N,T,()=>da)}slicePlaneEnabledChanged(){this.draped||this._forEachMaterial(N=>{N.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})});return!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return null!=this._getPrimitive()}applyRendererDiff(N,T){for(const aa in N.diff)switch(aa){case "visualVariables":if(L.updateFastSymbolUpdatesState(this._fastUpdates,T,this._fastVisualVariableConvertOptions()))this._materials[0]?.setParameters(this._fastUpdates.materialParameters);
else return D.ApplyRendererDiffResult.RecreateSymbol;break;default:return D.ApplyRendererDiffResult.RecreateSymbol}return D.ApplyRendererDiffResult.FastUpdate}_defaultElevationInfoNoZ(){return S}_createAs3DShape(N,T,aa,Z,da,fa,ka){N=this.getFastUpdateAttrValues(N);const ha=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:ka,layerUid:this._context.layer.uid});Z=P.createPointGeometry(aa,V,null,Z,da,I,null,N,ha);ka=K.createStageObject(this._context,T,Z,fa,ka);if(null==ka)return null;
const ba=new C.Graphics3DObject3DGraphicLayer(this,ka.object,[Z],null,null,y.perObjectElevationAligner,fa);ba.alignedSampledElevation=ka.sampledElevation;ba.needsElevationUpdates=z.needsElevationUpdates2D(fa.mode)||"absolute-height"===fa.mode;ba.getScreenSize=this._createScreenSizeGetter(da,N);ba.calculateRelativeScreenBounds=ea=>aa.calculateRelativeScreenBounds(ba.getScreenSize(),1,ea);K.extendPointGraphicElevationContext(ba,T,this._context.elevationProvider);return ba}_createAsOverlay(N,T,aa,Z,
da,fa){aa.renderPriority=this._renderPriority;const ka=w.create();v.projectPointToVector(T,ka,this._context.overlaySR);ka[2]=O.drapedZ;T=this._context.clippingExtent;if(null!=T&&!x.containsPoint(T,ka))return null;T=this.getFastUpdateAttrValues(N);const ha=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:N.uid,layerUid:this._context.layer.uid});Z=P.createPointGeometry(aa,V,ka,Z,da,null,null,T,ha);N=new J.RenderGeometry(Z,{layerUid:fa,graphicUid:N.uid});const ba=new A.Graphics3DDrapedGraphicLayer(this,
[N],null,this._context.drapeSourceRenderer);ba.getScreenSize=this._createScreenSizeGetter(da,T);ba.calculateRelativeScreenBounds=ea=>aa.calculateRelativeScreenBounds(ba.getScreenSize(),1,ea);return ba}_createScreenSizeGetter(N,T){const aa=this._outlineSize+2;if(this._fastUpdates&&T){const fa=N[0]/this._symbolTextureRatio,ka=N[1]/this._symbolTextureRatio;return(ha=m.create())=>{const [ba,ea]=L.evaluateModelTransformScale(Q,this._fastUpdates.materialParameters,T);ha[0]=ba*fa+aa;ha[1]=ea*ka+aa;return ha}}const Z=
N[0]/this._symbolTextureRatio+aa,da=N[1]/this._symbolTextureRatio+aa;return(fa=m.create())=>{fa[0]=Z;fa[1]=da;return fa}}_fastVisualVariableConvertOptions(){var N=Math.max(this._size[0],this._size[1]);const T=l.fromValues(N,N,N),aa=q.px2pt(1);N*=aa;N=l.fromValues(N,N,N);return new L.ConvertOptions({size:!0,color:!0,rotation:!0,opacity:!1},T,N,aa)}_getGraphicHash(N){let T="";for(const aa of this._cimRequiredFields)T+=aa+N.attributes[aa];return T}_forEachMaterial(N){this._materials.forEach(N);this._cimSymbolMaterials.forEach(N)}test(){return{...super.test(),
material:this._materials[0]}}}H.PRIMITIVE_SIZE=[d*Y,d*Y];H.elevationModeChangeTypes={definedChanged:z.SymbolUpdateType.UPDATE,staysOnTheGround:z.SymbolUpdateType.NONE,onTheGroundChanged:z.SymbolUpdateType.RECREATE};const S={mode:"relative-to-ground",offset:0},I=w.fromValues(0,0,0,1),Q=l.create();a.Graphics3DIconSymbolLayer=H;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/utils":function(){define("require exports ../../Color ../../symbols ../../core/asyncUtils ../../core/has ../../core/screenUtils ../../chunks/vec3f64 ../../layers/effects/jsonUtils ./cimSymbolUtils ./gfxUtils ./Symbol3DMaterial".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l){function w(C){C=C.symbolLayers;if(!C)return null;let E=null;C.forEach(B=>{"object"===B.type&&B.resource?.href||(E="water"===B.type?B.color:B.material?B.material.color:null)});return E?new c(E):null}function v(C,E){if(null==E||null==C)return C;C=C.toRgba();C[3]*=E;return new c(C)}function x(C,E,B){if(C=C.symbolLayers){var D=F=>{E=E??F??(null!=B?A:null);return v(E,B)};C.forEach(F=>{if("object"!==F.type||!F.resource?.href||E)if("water"===F.type)F.color=D(F.color);else{const K=
D(null!=F.material?F.material.color:null);null==F.material?F.material=new l.Symbol3DMaterial({color:K}):F.material.color=K;null!=B&&"outline"in F&&null!=F.outline?.color&&(F.outline.color=v(F.outline.color,B))}})}}async function p(C,E){(C=C.symbolLayers)&&await f.forEach(C,async B=>h(B,E))}async function h(C,E){switch(C.type){case "extrude":C.size="number"===typeof E[2]?E[2]:0;break;case "icon":case "line":case "text":E=t(E);null!=E&&(C.size=E);break;case "path":const B=u(E,g.ONES,[C.width,void 0,
C.height]);C.width=z(E[0],C.width,1,B);C.height=z(E[2],C.height,1,B);break;case "object":await r(C,E)}}function t(C){for(const E of C)if("number"===typeof E)return E;return null}async function r(C,E){const {resourceSize:B,symbolSize:D}=await y(C),F=u(E,B,D);C.width=z(E[0],D[0],B[0],F);C.depth=z(E[1],D[1],B[1],F);C.height=z(E[2],D[2],B[2],F)}function u(C,E,B){for(let D=0;3>D;D++){const F=C[D];switch(F){case "symbol-value":return C=B[D],null!=C?C/E[D]:1;case "proportional":break;default:if(F&&E[D])return F/
E[D]}}return 1}async function y(C){var {computeObjectLayerResourceSize:E}=await new Promise((G,O)=>b(["./symbolLayerUtils"],G,O));E=await E(C,10);const {width:B,height:D,depth:F}=C;C=[B,F,D];let K=1;for(var L=0;3>L;L++){const G=C[L];if(null!=G){K=G/E[L];break}}for(L=0;3>L;L++)null==C[L]&&(C[L]=E[L]*K);return{resourceSize:E,symbolSize:C}}function z(C,E,B,D){switch(C){case "proportional":return B*D;case "symbol-value":return null!=E?E:B;default:return C}}const A=new c("white");a.applyColorToSymbol=
function(C,E,B){if(C&&(E||null!=B))if(E&&(E=new c(E)),d.isSymbol3D(C))x(C,E,B);else if(d.isSymbol2D(C)){if(E=E??C.color)C.color=v(E,B);null!=B&&"outline"in C&&C.outline?.color&&(C.outline.color=v(C.outline.color,B))}};a.applyOpacityToColor=v;a.applyRotationToSymbol=function(C,E,B){C&&null!=E&&(d.isSymbol3D(C)?(C=C.symbolLayers)&&C.forEach(D=>{if(D&&"object"===D.type)switch(B){case "tilt":D.tilt=E;break;case "roll":D.roll=E;break;default:D.heading=E}}):!d.isSymbol2D(C)||"simple-marker"!==C.type&&"picture-marker"!==
C.type&&"text"!==C.type||(C.angle=E))};a.applySizesToSymbol=async function(C,E){if(C&&E){if(d.isSymbol3D(C))return p(C,E);if(d.isSymbol2D(C)&&(E=t(E),null!=E))switch(C.type){case "simple-marker":C.size=E;break;case "picture-marker":const B=C.width/C.height;1<B?(C.width=E,C.height=E*B):(C.width=E*B,C.height=E);break;case "simple-line":C.width=E;break;case "text":C.font.size=E}}};a.fetchWebStyleSymbol=async function(C,E){const B=await C.fetchSymbol(E);return B?B:C.fetchCIMSymbol(E)};a.getCSSFilterFromEffectList=
function(C){if(!C)return null;C=C.effects.filter(E=>"bloom"!==E.type).map(E=>E.toJSON());return q.effectFunctionsFromJSON(C)};a.getColorFromSymbol=function(C,E){if(!C)return null;let B=null;d.isSymbol3D(C)?B=w(C):d.isSymbol2D(C)&&(B="cim"===C.type?e.getCIMSymbolColor(C):C.color?new c(C.color):null);return B?v(B,E):null};a.getIconHref=function(C){return C.resource?.href??""};a.getSymbolOutlineSize=function(C){return C?d.isSymbol3D(C)?(C=(C=C.symbolLayers?.at(-1))&&"outline"in C?C?.outline?.size:void 0,
null!=C?C:0):k.px2pt(m.getStroke(C)?.width):0};a.isVolumetricSymbol=function(C){if(null==C||!("symbolLayers"in C)||null==C.symbolLayers)return!1;switch(C.type){case "point-3d":return C.symbolLayers.some(E=>"object"===E.type);case "line-3d":return C.symbolLayers.some(E=>"path"===E.type);case "polygon-3d":return C.symbolLayers.some(E=>"object"===E.type||"extrude"===E.type);default:return!1}};a.symbolHasExtrudeSymbolLayer=function(C){return null!=C&&"polygon-3d"===C.type&&C.symbolLayers.some(E=>"extrude"===
E.type)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/cimSymbolUtils":function(){define(["exports","../../Color","../cim/utils"],function(b,a,c){function d(l){l=c.toCIMSymbolJSON(l);if("CIMTextSymbol"===l?.type)return l.height??0;let w=0;if(l?.symbolLayers)for(const v of l.symbolLayers)c.isCIMMarker(v)&&null!=v.size&&v.size>w?w=v.size:c.isCIMStroke(v)&&null!=v.width&&v.width>w?w=v.width:c.isCIMFill(v);return w}function f(l,w,v,x){if(l)if("CIMTextSymbol"===
l.type)null!=l.height&&(l.height*=w);else{if(v&&l.effects)for(const p of l.effects)g(p,w);if(l.symbolLayers)for(const p of l.symbolLayers)switch(p.type){case "CIMPictureMarker":case "CIMVectorMarker":n(p,w,x);break;case "CIMPictureStroke":case "CIMSolidStroke":!x?.preserveOutlineWidth&&p.width&&(p.width*=w);break;case "CIMPictureFill":p.height&&(p.height*=w);p.offsetX&&(p.offsetX*=w);p.offsetY&&(p.offsetY*=w);break;case "CIMHatchFill":f(p.lineSymbol,w,!0,{...x,preserveOutlineWidth:!1}),p.offsetX&&
(p.offsetX*=w),p.offsetY&&(p.offsetY*=w),p.separation&&(p.separation*=w)}}}function n(l,w,v){if(l&&(l.markerPlacement&&k(l.markerPlacement,w),l.offsetX&&(l.offsetX*=w),l.offsetY&&(l.offsetY*=w),l.anchorPoint&&"Absolute"===l.anchorPointUnits&&(l.anchorPoint={x:l.anchorPoint.x*w,y:l.anchorPoint.y*w}),l.size=null!=l.size?l.size*w:0,"CIMVectorMarker"===l.type&&l.markerGraphics))for(const x of l.markerGraphics)l.scaleSymbolsProportionally||f(x.symbol,w,!0,v)}function k(l,w){c.isCIMMarkerStrokePlacement(l)&&
l.offset&&(l.offset*=w);switch(l.type){case "CIMMarkerPlacementAlongLineRandomSize":case "CIMMarkerPlacementAlongLineSameSize":l.customEndingOffset&&(l.customEndingOffset*=w);l.offsetAlongLine&&(l.offsetAlongLine*=w);if(l.placementTemplate&&l.placementTemplate.length){var v=l.placementTemplate.map(x=>x*w);l.placementTemplate=v}break;case "CIMMarkerPlacementAlongLineVariableSize":l.maxRandomOffset&&(l.maxRandomOffset*=w);l.placementTemplate&&l.placementTemplate.length&&(v=l.placementTemplate.map(x=>
x*w),l.placementTemplate=v);break;case "CIMMarkerPlacementOnLine":l.startPointOffset&&(l.startPointOffset*=w);break;case "CIMMarkerPlacementAtExtremities":l.offsetAlongLine&&(l.offsetAlongLine*=w);break;case "CIMMarkerPlacementAtRatioPositions":l.beginPosition&&(l.beginPosition*=w);l.endPosition&&(l.endPosition*=w);break;case "CIMMarkerPlacementPolygonCenter":l.offsetX&&(l.offsetX*=w);l.offsetY&&(l.offsetY*=w);break;case "CIMMarkerPlacementInsidePolygon":l.offsetX&&(l.offsetX*=w),l.offsetY&&(l.offsetY*=
w),l.stepX&&(l.stepX*=w),l.stepY&&(l.stepY*=w)}}function g(l,w){switch(l.type){case "CIMGeometricEffectArrow":case "CIMGeometricEffectDonut":l.width&&(l.width*=w);break;case "CIMGeometricEffectBuffer":l.size&&(l.size*=w);break;case "CIMGeometricEffectCut":l.beginCut&&(l.beginCut*=w);l.endCut&&(l.endCut*=w);l.middleCut&&(l.middleCut*=w);break;case "CIMGeometricEffectDashes":l.customEndingOffset&&(l.customEndingOffset*=w);l.offsetAlongLine&&(l.offsetAlongLine*=w);if(l.dashTemplate&&l.dashTemplate.length){const v=
l.dashTemplate.map(x=>x*w);l.dashTemplate=v}break;case "CIMGeometricEffectExtension":case "CIMGeometricEffectJog":case "CIMGeometricEffectRadial":l.length&&(l.length*=w);break;case "CIMGeometricEffectMove":l.offsetX&&(l.offsetX*=w);l.offsetY&&(l.offsetY*=w);break;case "CIMGeometricEffectOffset":case "CIMGeometricEffectOffsetTangent":l.offset&&(l.offset*=w);break;case "CIMGeometricEffectRegularPolygon":l.radius&&(l.radius*=w);break;case "CIMGeometricEffectTaperedPolygon":l.fromWidth&&(l.fromWidth*=
w);l.length&&(l.length*=w);l.toWidth&&(l.toWidth*=w);break;case "CIMGeometricEffectWave":l.amplitude&&(l.amplitude*=w),l.period&&(l.period*=w)}}function q(l,w){if(l){var v="CIMTextSymbol"===l.type?l.symbol:l;l="CIMPolygonSymbol"===l.type;if(v?.symbolLayers)for(const x of v.symbolLayers)if(!(x.colorLocked||l&&(c.isCIMStroke(x)||c.isCIMMarker(x)&&x.markerPlacement&&c.isCIMMarkerStrokePlacement(x.markerPlacement))))switch(x.type){case "CIMPictureMarker":case "CIMPictureStroke":case "CIMPictureFill":x.tintColor&&
e(w,x.tintColor);break;case "CIMVectorMarker":x.markerGraphics?.forEach(p=>{q(p.symbol,w)});break;case "CIMSolidStroke":case "CIMSolidFill":e(w,x.color);break;case "CIMHatchFill":q(x.lineSymbol,w)}}}function e(l,w){for(const v of l)if(v.join(".")===w.join("."))return;l.push(w)}function m(l,w,v){if(l){var x="CIMTextSymbol"===l.type?l.symbol:l;l="CIMPolygonSymbol"===x?.type;if(x?.symbolLayers)for(const p of x.symbolLayers)if(!p.colorLocked){if(l)if(v){if({layersToColor:x}=v,(c.isCIMStroke(p)||c.isCIMMarker(p)&&
p.markerPlacement&&c.isCIMMarkerStrokePlacement(p.markerPlacement))&&"fill"===x||c.isCIMFill(p)&&"outline"===x)continue}else if(c.isCIMStroke(p)||c.isCIMMarker(p)&&p.markerPlacement&&c.isCIMMarkerStrokePlacement(p.markerPlacement))continue;x=w.toArray();switch(p.type){case "CIMPictureMarker":case "CIMPictureStroke":case "CIMPictureFill":p.tintColor=x;break;case "CIMVectorMarker":p.markerGraphics?.forEach(h=>{m(h.symbol,w,v)});break;case "CIMSolidStroke":case "CIMSolidFill":p.color=x;break;case "CIMHatchFill":m(p.lineSymbol,
w,v)}}}}b.applyCIMSymbolColor=function(l,w,v){w instanceof a||(w=new a(w));(l=c.toCIMSymbolJSON(l))&&m(l,w,v)};b.applyCIMSymbolRotation=function(l,w,v=!1){l=c.toCIMSymbolJSON(l);v&&0!==w&&(w=360-w);if("CIMTextSymbol"===l?.type)l.angle=w;else if("CIMPointSymbol"===l?.type&&l.symbolLayers){v=w-(l.angle||0);for(const x of l.symbolLayers)if(c.isCIMMarker(x)){let p=x.rotation||0;p=x.rotateClockwise?p-v:p+v;x.rotation=p}l.angle=w}};b.getCIMSymbolColor=function(l){l=c.toCIMSymbolJSON(l);const w=[];q(l,w);
return w.length?new a(c.fromCIMColor(w[0])):null};b.getCIMSymbolRotation=function(l,w=!1){l=c.toCIMSymbolJSON(l);return"CIMTextSymbol"===l?.type||"CIMPointSymbol"===l?.type?(l=l.angle,null!=l&&0!==l&&w?360-l:l??0):0};b.getCIMSymbolSize=d;b.getCIMSymbolType=function(l){l=c.toCIMSymbolJSON(l);if(!l)return null;switch(l.type){case "CIMPointSymbol":return"CIMPointSymbol";case "CIMLineSymbol":return"CIMLineSymbol";case "CIMPolygonSymbol":return"CIMPolygonSymbol";case "CIMTextSymbol":return"CIMTextSymbol";
case "CIMMeshSymbol":return"CIMMeshSymbol";default:return null}};b.scaleCIMMarker=n;b.scaleCIMSymbol=f;b.scaleCIMSymbolTo=function(l,w,v){if(l){var x=c.toCIMSymbolJSON(l);l=d(l);if(0===l){if(x)if("CIMTextSymbol"===x.type)x.height=w;else if(x.symbolLayers)for(const p of x.symbolLayers)switch(p.type){case "CIMPictureMarker":case "CIMVectorMarker":p.size=w;break;case "CIMPictureStroke":case "CIMSolidStroke":p.width=w}}else f(x,w/l,!1,v)}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/symbols/cim/utils":function(){define(["require","exports"],function(b,a){function c(l){return"function"===typeof l}function d(l){let w=l.length;for(;w--;)if(!" /-,\n".includes(l.charAt(w)))return!1;return!0}function f(l,w){const v=[];var x=0;let p=-1;do p=l.indexOf("[",x),p>=x&&(p>x&&(x=l.substr(x,p-x),v.push([x,null,d(x)])),x=p+1,p=l.indexOf("]",x),p>=x&&(p>x&&(x=l.substr(x,p-x),(x=w[x])&&v.push([null,x,!1])),x=p+1));while(-1!==p);x<l.length-1&&(l=l.substr(x),v.push([l,null,d(l)]));return v}
function n(l,w,v){let x="",p=null;for(const h of w){const [t,r,u]=h;if(t)u?p=t:(p&&(x+=p,p=null),x+=t);else if(w=l.attributes[r])p&&(x+=p,p=null),x+=w}return k(x,v)}function k(l,w){"string"!==typeof l&&(l=String(l));switch(w){case "LowerCase":return l.toLowerCase();case "Allcaps":return l.toUpperCase();default:return l}}function g(l){return l?{r:l[0],g:l[1],b:l[2],a:l[3]/255}:{r:0,g:0,b:0,a:0}}function q(l){if(!l)return null;switch(l.type){case "CIMPolygonSymbol":if(l.symbolLayers)for(const w of l.symbolLayers)if(l=
q(w),null!=l)return l;break;case "CIMTextSymbol":return q(l.symbol);case "CIMSolidFill":return l.color}}function e(l){if(l)switch(l.type){case "CIMPolygonSymbol":case "CIMLineSymbol":if(l=l.symbolLayers)for(const w of l)if(l=e(w),null!=l)return l;break;case "CIMTextSymbol":return e(l.symbol);case "CIMSolidStroke":return l.color}}function m(l){if(l)switch(l.type){case "CIMPolygonSymbol":case "CIMLineSymbol":if(l.symbolLayers)for(const w of l.symbolLayers)if(l=m(w),void 0!==l)return l;break;case "CIMTextSymbol":return m(l.symbol);
case "CIMSolidStroke":case "CIMGradientStroke":case "CIMPictureStroke":return l.width}}a.adjustTextCase=k;a.analyzeTextParts=f;a.assignTextValuesFromFeature=n;a.attributesToFields=function(l){return(l?Object.keys(l):[]).map(w=>({name:w,alias:w,type:"string"===typeof l[w]?"esriFieldTypeString":"esriFieldTypeDouble"}))};a.colorToArray=function(l){return[l.r,l.g,l.b,l.a]};a.createLabelOverrideFunction=function(l,w,v){const x=f(w,l);return p=>n(p,x,v)};a.evaluateValueOrFunction=function(l,w,v,x){return c(l)?
l(w,v,x):l};a.fromCIMColor=g;a.fromCIMFontDecoration=function(l){return l.underline?"underline":l.strikethrough?"line-through":"none"};a.fromCIMFontStyle=function(l){let w="normal",v="normal";l&&(l=l.toLowerCase(),l.includes("italic")?w="italic":l.includes("oblique")&&(w="oblique"),l.includes("bold")?v="bold":l.includes("light")&&(v="lighter"));return{style:w,weight:v}};a.fromCIMHorizontalAlignment=function(l){switch(l){default:return"left";case "Right":return"right";case "Center":return"center";
case "Justify":return"center"}};a.fromCIMVerticalAlignment=function(l){switch(l){default:return"top";case "Center":return"middle";case "Baseline":return"baseline";case "Bottom":return"bottom"}};a.getFillColor=q;a.getFontStyle=function(l){if(!l)return"normal";switch(l.toLowerCase()){case "italic":return"italic";case "oblique":return"oblique";default:return"normal"}};a.getFontWeight=function(l){if(!l)return"normal";switch(l.toLowerCase()){case "bold":return"bold";case "bolder":return"bolder";case "lighter":return"lighter";
default:return"normal"}};a.getStrokeColor=e;a.getStrokeWidth=m;a.getTintColor=l=>l.tintColor?g(l.tintColor):{r:255,g:255,b:255,a:1};a.getValue=(l,w=0)=>null==l||isNaN(l)?w:l;a.importGeometryEngine=function(){return new Promise((l,w)=>b(["../../geometry/geometryEngineJSON"],l,w))};a.isCIMFill=function(l){return null!=l&&("CIMGradientFill"===l.type||"CIMHatchFill"===l.type||"CIMPictureFill"===l.type||"CIMSolidFill"===l.type||"CIMWaterFill"===l.type)};a.isCIMMarker=function(l){return"CIMVectorMarker"===
l.type||"CIMPictureMarker"===l.type||"CIMBarChartMarker"===l.type||"CIMCharacterMarker"===l.type||"CIMPieChartMarker"===l.type||"CIMStackedBarChartMarker"===l.type};a.isCIMMarkerStrokePlacement=function(l){return null!=l&&("CIMMarkerPlacementAlongLineRandomSize"===l.type||"CIMMarkerPlacementAlongLineSameSize"===l.type||"CIMMarkerPlacementAlongLineVariableSize"===l.type||"CIMMarkerPlacementAtExtremities"===l.type||"CIMMarkerPlacementAtMeasuredUnits"===l.type||"CIMMarkerPlacementAtRatioPositions"===
l.type||"CIMMarkerPlacementOnLine"===l.type||"CIMMarkerPlacementOnVertices"===l.type)};a.isCIMStroke=function(l){return"CIMGradientStroke"===l.type||"CIMPictureStroke"===l.type||"CIMSolidStroke"===l.type};a.isFeatureValueFn=c;a.isGeometryEngineRequired=l=>{if(!l)return!1;for(const w of l)switch(w.type){case "CIMGeometricEffectBuffer":case "CIMGeometricEffectOffset":case "CIMGeometricEffectDonut":return!0}return!1};a.isSVGImage=l=>l.includes("data:image/svg+xml");a.mapCIMSymbolToGeometryType=function(l){if(!l)return null;
switch(l.type){case "CIMPointSymbol":case "CIMTextSymbol":return"esriGeometryPoint";case "CIMLineSymbol":return"esriGeometryPolyline";case "CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}};a.resampleHermite=function(l,w,v,x,p,h,t=!0){const r=w/p;v/=h;const u=Math.ceil(r/2),y=Math.ceil(v/2);for(let C=0;C<h;C++)for(let E=0;E<p;E++){const B=4*(E+(t?h-C-1:C)*p);var z=0;let D=0,F=0,K=0,L=0,G=0,O=0;const P=(C+.5)*v;for(let J=Math.floor(C*v);J<(C+1)*v;J++){var A=Math.abs(P-(J+.5))/y;const R=
(E+.5)*r;A*=A;for(let X=Math.floor(E*r);X<(E+1)*r;X++){let U=Math.abs(R-(X+.5))/u;z=Math.sqrt(A+U*U);-1<=z&&1>=z&&(z=2*z*z*z-3*z*z+1,0<z&&(U=4*(X+J*w),O+=z*l[U+3],F+=z,255>l[U+3]&&(z=z*l[U+3]/250),K+=z*l[U],L+=z*l[U+1],G+=z*l[U+2],D+=z))}}x[B]=K/D;x[B+1]=L/D;x[B+2]=G/D;x[B+3]=O/F}};a.toCIMSymbolJSON=function(l){return l.data?.symbol??null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/gfxUtils":function(){define("exports ../../assets ../../Color ../../request ../../core/LRUCache ../../core/screenUtils ./cimSymbolUtils".split(" "),
function(b,a,c,d,f,n,k){function g(m){if(!m)return null;let l=null;switch(m.type){case "simple-fill":case "picture-fill":case "simple-marker":l=g(m.outline);break;case "simple-line":const w=n.pt2px(m.width);null!=m.style&&"none"!==m.style&&0!==w&&(l={color:m.color,style:e(m.style),width:w,cap:m.cap,join:"miter"===m.join?n.pt2px(m.miterLimit):m.join});break;default:l=null}return l}const q=new f.LRUCache(1E3),e=(()=>{const m={};return l=>{if(m[l])return m[l];const w=l.replaceAll("-","");return m[l]=
w}})();c=new c([128,128,128]);b.defaultThematicColor=c;b.dekebabifyLineStyle=e;b.getFill=function(m){const l=m.style;let w=null;if(m)switch(m.type){case "simple-marker":"cross"!==l&&"x"!==l&&(w=m.color);break;case "simple-fill":"solid"===l?w=m.color:"none"!==l&&(w={type:"pattern",x:0,y:0,src:a.getAssetUrl(`esri/symbols/patterns/${l}.png`),width:5,height:5});break;case "picture-fill":w={type:"pattern",src:m.url,width:n.pt2px(m.width)*m.xscale,height:n.pt2px(m.height)*m.yscale,x:n.pt2px(m.xoffset),
y:n.pt2px(m.yoffset)};break;case "text":w=m.color;break;case "cim":w=k.getCIMSymbolColor(m)}return w};b.getPatternUrlWithColor=function(m,l){const w=m+"-"+l;return void 0!==q.get(w)?Promise.resolve(q.get(w)):d(m,{responseType:"image"}).then(v=>{v=v.data;const x=v.naturalWidth,p=v.naturalHeight,h=document.createElement("canvas");h.width=x;h.height=p;const t=h.getContext("2d");t.fillStyle=l;t.fillRect(0,0,x,p);t.globalCompositeOperation="destination-in";t.drawImage(v,0,0);v=h.toDataURL();q.put(w,v);
return v})};b.getStroke=g;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/arcade/callExpressionWithFeature":function(){define(["../../../core/Error","../../../core/Logger","../../../geometry/support/quantizationUtils"],function(b,a,c){function d(n){const k={};switch(n){case "esriGeometryPoint":return(g,q,e,m)=>c.unquantizePoint(q,k,g,e,m);case "esriGeometryPolygon":return(g,q,e,m)=>c.unquantizePolygon(q,k,g,e,m);case "esriGeometryPolyline":return(g,q,e,m)=>c.unquantizePolyline(q,
k,g,e,m);case "esriGeometryMultipoint":return(g,q,e,m)=>c.unquantizeMultipoint(q,k,g,e,m);default:return a.getLogger("esri.views.2d.support.arcadeOnDemand").error(new b("mapview-arcade",`Unable to handle geometryType: ${n}`)),g=>g}}const f=new Map;return function(n,k,g,q,e){if(null==n)return null;if(n.referencesGeometry()&&e){const {transform:m,hasZ:l,hasM:w}=e;f.has(q)||f.set(q,d(q));q=f.get(q)(k.geometry,m,l,w);k={...k,geometry:q}}k=n.repurposeFeature(k);try{return n.evaluate({...g,$feature:k},
n.services)}catch(m){return a.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",m),null}}})},"esri/views/3d/layers/graphics/constants":function(){define(["exports","../../../../chunks/vec4f64"],function(b,a){a=a.ZEROS;b.labelMarginPx=4;b.suspendResumeExtentOptimism=1.2;b.transparentUnit=a;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DDrapedGraphicLayer":function(){define("exports ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ./graphicUtils ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/ModelDirtyTypes".split(" "),
function(b,a,c,d,f,n,k,g){class q{constructor(w,v,x,p){this.graphics3DSymbolLayer=w;this.renderGeometries=v;this.boundingBox=x;this._drapeSourceRenderer=p;this.type="draped";this.stage=null;this.isElevationSource=this._addedToStage=this._visible=!1}initialize(w){this.stage=w.stage}setVisibility(w){if(null!=this.stage&&this._visible!==w)if((this._visible=w)&&!this._addedToStage)this._addedToStage=!0,this._drapeSourceRenderer.addGeometries(this.renderGeometries,g.DirtyOperation.ADD);else if(w||this._addedToStage){for(const v of this.renderGeometries)v.visible=
this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,g.DirtyState.VISIBILITY)}}destroy(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,g.DirtyOperation.REMOVE);this._visible=this._addedToStage=!1;this.stage=null}getCenterObjectSpace(w=c.create()){return a.set(w,0,0,0)}getBoundingBoxObjectSpace(w=d.create()){return d.empty(w)}addObjectState(w,v){w===k.Object3DState.Highlight&&(this.renderGeometries.forEach(x=>{const p=x.geometry.addHighlight();
v.addRenderGeometry(x,p,this)}),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,g.DirtyState.HIGHLIGHT))}removeObjectState(w){this.renderGeometries.forEach(v=>{w.removeRenderGeometry(v)})}removeRenderGeometryObjectState(w,v){w.geometry.removeHighlight(v);this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,g.DirtyState.HIGHLIGHT)}computeAttachmentOrigin(w){for(const v of this.renderGeometries)v.geometry.computeAttachmentOrigin(l)&&
(w.draped.origin[0]+=l[0],w.draped.origin[1]+=l[1],w.draped.num++)}async getProjectedBoundingBox(w,v,x,p,h){d.empty(h);for(let t=0;t<this.renderGeometries.length;t++)this._getRenderGeometryProjectedBoundingRect(this.renderGeometries[t],w,e,x),d.expandWithRect(h,e);if(v){d.center(h,l);let t;w=n.demResolutionForBoundingBox(h,v.service.spatialReference,v);try{t=await v.service.queryElevation(l[0],l[1],p,w,"ground")}catch(r){}null!=t&&(h[2]=Math.min(h[2],t),h[5]=Math.max(h[5],t))}return h}_getRenderGeometryProjectedBoundingRect(w,
v,x,p){if(this.boundingBox)d.set(m,this.boundingBox);else{w=w.boundingSphere;const h=w[3];m[0]=w[0]-h;m[1]=w[1]-h;m[2]=w[2]-h;m[3]=w[0]+h;m[4]=w[1]+h;m[5]=w[2]+h}v(m,0,2);this.calculateRelativeScreenBounds&&p.push({location:d.center(m),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()});return d.toRect(m,x)}}const e=f.create(),m=d.create(),l=c.create();b.Graphics3DDrapedGraphicLayer=q;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/placementUtils":function(){define(["exports",
"../../../../chunks/vec2","../../../../chunks/vec2f64","../../webgl-engine/lib/TextRenderer"],function(b,a,c,d){const f=Object.freeze({left:0,center:.5,right:1}),n=Object.freeze({"bottom-left":c.fromValues(0,0),bottom:c.fromValues(.5,0),"bottom-right":c.fromValues(1,0),left:c.fromValues(0,.5),center:c.fromValues(.5,.5),right:c.fromValues(1,.5),"top-left":c.fromValues(0,1),top:c.fromValues(.5,1),"top-right":c.fromValues(1,1)});b.anchorFromPlacements=function(k,g){switch(g){case "bottom":return"left"===
k?"bottom-left":"right"===k?"bottom-right":"bottom";case "center":return k;case "top":return"left"===k?"top-left":"right"===k?"top-right":"top"}};b.horizontalPlacementFromAnchor=function(k){switch(k){case "bottom-left":case "left":case "top-left":return"left";case "bottom":case "center":case "top":return"center";case "bottom-right":case "right":case "top-right":return"right"}};b.horizontalPlacementToAnchorX=f;b.namedAnchorToHUDMaterialAnchorPos=n;b.textRenderAlignmentFromHorizontalPlacement=function(k){switch(k){case "left":return d.TextRenderAlignment.Left;
case "right":return d.TextRenderAlignment.Right;default:return d.TextRenderAlignment.Center}};b.verticalPlacementFromAlignment=function(k){return"middle"===k?"center":k};b.verticalPlacementFromAnchor=function(k){switch(k){case "bottom-left":case "bottom":case "bottom-right":return"bottom";case "left":case "center":case "right":return"center";case "top-left":case "top":case "top-right":return"top"}};b.verticalScreenOffsetFromAlignment=function(k,g){switch(k){case "top":return a.set(g,0,d.textVerticalPaddingPx);
case "bottom":return a.set(g,0,-d.textVerticalPaddingPx);default:return a.copy(g,c.ZEROS)}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextRenderer":function(){define(["exports","../../../../core/mathUtils","../../support/debugFlags","./FontMetrics","./TextHelperCanvas"],function(b,a,c,d,f){class n{constructor(e,m,l,w){this.text=e;this._alignment=m;this._parameters=l;this._maxSize=w;this._textWidths=[];this._lineWidths=[];this._metricsCached=this._renderPixelRatio=
null;this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${e}`;this._lines=e.replaceAll(" ","\u00a0").split(/\r?\n/)}get displayWidth(){return Math.ceil(this._displayWidth+2*this._horizontalPadding)}get displayHeight(){let e=this._metrics.firstLineAscent;for(let m=0;m<this._lines.length-1;m++)e+=this._lineSpacing;e+=this._metrics.lastLineDescent;return Math.ceil(e+2*this._haloSize+2*this._verticalPadding)}get renderedWidth(){return this._toRoundedRenderUnit(this.displayWidth)}get renderedHeight(){return this._toRoundedRenderUnit(this.displayHeight)}get firstRenderedBaselinePosition(){return this._toRenderUnit(this._firstLineYOffset+
this._metrics.firstLineAscent)}get _firstLineYOffset(){return this._verticalPadding+this._haloSize}get _metrics(){if(null==this._metricsCached){const m=f.getTextHelperCanvas(g,512,512).getContext("2d");this._parameters.setFontProperties(m,this._fontSize);let l=2*this._haloSize;var e=this._parameters.definition.font;if("italic"===e.style||"oblique"===e.style||"bold"===e.weight||"bolder"===e.weight)l+=.3*m.measureText("A").width;this._textWidths.length=0;let w=this._lineWidths.length=0,v,x,p=0,h=0;
this._lines.forEach((t,r)=>{t=m.measureText(t);const u=t.width,y=u+l;this._textWidths.push(u);this._lineWidths.push(y);w=Math.max(w,y);p=Math.max(p,t.actualBoundingBoxAscent);h=Math.max(h,t.actualBoundingBoxDescent);0===r&&(v=t);r===this._lines.length-1&&(x=t)});e=d.getFontMetrics(this._parameters);p=Math.max(p,e.maxAscent);h=Math.max(h,e.maxDescent);this._metricsCached=new q(v.actualBoundingBoxAscent,"underline"===this._parameters.definition.font.decoration?h:x.actualBoundingBoxDescent,p,h,w)}return this._metricsCached}get _lineSpacing(){return(this._midLineHeight+
this._linePadding)*this._parameters.definition.lineSpacingFactor}get _midLineHeight(){return this._metrics.midLineHeight}get _linePadding(){return.2*this._midLineHeight}get _midLineAscent(){return this._metrics.maxLineAscent}get _renderedFontSize(){return this._toRenderUnit(this._fontSize)}get _fontSize(){return this._parameters.definition.size}get _renderedHaloSize(){return this._toRenderUnit(this._haloSize)}get _haloSize(){return this._parameters.haloSize}get _horizontalPadding(){return this._hasBackground?
this._parameters.definition.background.padding[0]:0}get _verticalPadding(){return Math.max(this._hasBackground?this._parameters.definition.background.padding[1]:0,1)}get _hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){null==this._renderPixelRatio&&(this._renderPixelRatio=Math.min(this._parameters.definition.pixelRatio,Math.min(this._maxSize[0]/this.displayWidth,this._maxSize[1]/this.displayHeight)));return this._renderPixelRatio}_getLineXOffset(e){switch(this._alignment){case b.TextRenderAlignment.Left:return this._horizontalPadding;
case b.TextRenderAlignment.Center:return(this.displayWidth-this._lineWidths[e])/2;case b.TextRenderAlignment.Right:return this.displayWidth-this._horizontalPadding-this._lineWidths[e]}}render(e,m,l){e.save();m/=this.renderPixelRatio;l/=this.renderPixelRatio;const w=m,v=l;var x=this._haloSize;const p=this._firstLineYOffset+this._metrics.firstLineAscent;m+=x;l+=p;const h=0<this._haloSize;h&&this._renderHalo(e,w,v,x,p);this._parameters.setFontProperties(e,this._renderedFontSize);for(x=0;x<this._lines.length;++x){const t=
this._lines[x],r=this._getLineXOffset(x);h&&(e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)",this._fillText(e,t,m+r,l),this._renderLineDecoration(e,m+r,l,this._textWidths[x]));e.globalCompositeOperation="source-over";e.fillStyle=this._parameters.textStyle;this._fillText(e,t,m+this._getLineXOffset(x),l);this._renderLineDecoration(e,m+r,l,this._textWidths[x]);l+=this._lineSpacing}if(c.debugFlags.TEXT_SHOW_BASELINE)for(e.strokeStyle="rgb(255, 0, 255, 0.5)",e.setLineDash([2,2]),
e.lineWidth=1,m=v+p,l=0;l<this._lines.length;++l)this._drawLine(e,[w,m],[w+this.displayWidth,m]),m+=this._lineSpacing;c.debugFlags.TEXT_SHOW_BORDER&&(e.strokeStyle="rgb(255, 0, 255, 0.5)",e.setLineDash([]),e.lineWidth=1,this._drawBox(e,[w,v],[this.displayWidth,this.displayHeight]));this._hasBackground&&(this._roundedRect(e,w,v,this._parameters.definition.background.borderRadius*this.renderPixelRatio),e.globalCompositeOperation="destination-over",e.fillStyle=this._parameters.backgroundStyle,e.fill());
e.restore()}_renderLineDecoration(e,m,l,w,v=!1){if("none"!==this._parameters.definition.font.decoration&&0!==w){var x=Math.max(this._parameters.definition.size/16,1);switch(this._parameters.definition.font.decoration){case "underline":l+=2*x;break;case "line-through":l-=.33*this._midLineAscent}var p=v?this._haloSize:0;e.strokeStyle=v?this._parameters.haloStyle:this._parameters.textStyle;e.lineWidth=this._toRenderUnit(x+2*p);e.beginPath();e.moveTo(this._toRenderUnit(m-p),this._toRenderUnit(l));e.lineTo(this._toRenderUnit(m+
w+p),this._toRenderUnit(l));e.stroke()}}_roundedRect(e,m,l,w){m=this._toRenderUnit(m);l=this._toRenderUnit(l);const v=this.renderedWidth,x=this.renderedHeight;0===w?e.rect(m,l,v,x):(w=a.clamp(w,0,Math.floor(x/2)),e.beginPath(),e.moveTo(m,l+w),e.arcTo(m,l,m+w,l,w),e.lineTo(m+v-w,l),e.arcTo(m+v,l,m+v,l+w,w),e.lineTo(m+v,l+x-w),e.arcTo(m+v,l+x,m+v-w,l+x,w),e.lineTo(m+w,l+x),e.arcTo(m,l+x,m,l+x-w,w),e.closePath())}_renderHalo(e,m,l,w,v){const x=this.renderedWidth,p=this.renderedHeight,h=f.getTextHelperCanvas(g,
Math.max(x,512),Math.max(p,512)),t=h.getContext("2d");t.clearRect(0,0,x,p);this._parameters.setFontProperties(t,this._renderedFontSize);t.fillStyle=this._parameters.haloStyle;t.strokeStyle=this._parameters.haloStyle;var r=3>this._renderedHaloSize;t.lineJoin=r?"miter":"round";r?this._renderHaloEmulated(t,w,v):this._renderHaloNative(t,w,v);for(r=0;r<this._lines.length;++r){const u=this._getLineXOffset(r);this._renderLineDecoration(t,w+u,v,this._textWidths[r],!0);v+=this._lineSpacing}e.globalAlpha=this._parameters.definition.halo.color[3];
e.drawImage(h,0,0,x,p,this._toRenderUnit(m),this._toRenderUnit(l),x,p);e.globalAlpha=1}_renderHaloEmulated(e,m,l){for(let w=0;w<this._lines.length;++w){const v=this._lines[w],x=this._getLineXOffset(w);for(const [p,h]of k)this._fillText(e,v,m+x+this._haloSize*p,l+this._haloSize*h);l+=this._lineSpacing}}_renderHaloNative(e,m,l){const w=2*this._haloSize;for(let v=0;v<this._lines.length;++v){const x=this._lines[v],p=this._getLineXOffset(v);for(let h=0;5>h;h++)e.lineWidth=this._toRenderUnit((.6+.1*h)*
w),this._strokeText(e,x,m+p,l);l+=this._lineSpacing}}get _displayWidth(){return this._metrics.displayWidth}_toRenderUnit(e){return e*this.renderPixelRatio}_toRoundedRenderUnit(e){return Math.round(e*this.renderPixelRatio)}_fillText(e,m,l,w){e.fillText(m,this._toRenderUnit(l),this._toRenderUnit(w))}_strokeText(e,m,l,w){e.strokeText(m,this._toRenderUnit(l),this._toRenderUnit(w))}_drawLine(e,m,l){e.beginPath();e.moveTo(this._toRoundedRenderUnit(m[0])+.5,this._toRoundedRenderUnit(m[1])+.5);e.lineTo(this._toRoundedRenderUnit(l[0])+
.5,this._toRoundedRenderUnit(l[1])+.5);e.stroke()}_drawBox(e,m,l){var w=this._toRenderUnit(m[0]);m=this._toRenderUnit(m[1]);var v=this._toRenderUnit(l[0]);const x=this._toRenderUnit(l[1]);l=Math.floor(w)+.5;w=Math.ceil(w+v)-.5;v=Math.floor(m)+.5;m=Math.ceil(m+x)-.5;e.beginPath();e.moveTo(l,v);e.lineTo(w,v);e.lineTo(w,m);e.lineTo(l,m);e.lineTo(l,v);e.stroke()}}const k=[];for(let e=0;360>e;e+=22.5)k.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)]);b.TextRenderAlignment=void 0;(function(e){e[e.Left=
0]="Left";e[e.Center=1]="Center";e[e.Right=2]="Right"})(b.TextRenderAlignment||(b.TextRenderAlignment={}));const g={canvas:null};class q{get firstLineHeight(){return this.firstLineAscent+this.maxLineDescent}get midLineHeight(){return this.maxLineAscent+this.maxLineDescent}get lastLineHeight(){return this.maxLineAscent+this.lastLineDescent}constructor(e,m,l,w,v){this.firstLineAscent=e;this.lastLineDescent=m;this.maxLineAscent=l;this.maxLineDescent=w;this.displayWidth=v}}b.TextRenderer=n;b.textVerticalPaddingPx=
1;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/FontMetrics":function(){define(["exports","./TextHelperCanvas"],function(b,a){const c=new Map;class d{get maxHeight(){return this.maxAscent+this.maxDescent}constructor(k,g){this.maxAscent=k;this.maxDescent=g}}const f={canvas:null},n=(()=>{let k="";for(let g=32;127>g;g++)k+=String.fromCharCode(g);return k})();b.getFontMetrics=function(k){const {size:g}=k.definition,q=k.fontString(g);var e=c.get(q);e||
(e=a.getTextHelperCanvas(f,0,0).getContext("2d"),k.setFontProperties(e,g),k=e.measureText(n),e=new d(k.actualBoundingBoxAscent,k.actualBoundingBoxDescent),c.set(q,e));return e};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextHelperCanvas":function(){define(["exports"],function(b){b.getTextHelperCanvas=function(a,c,d){a.canvas||(a.canvas=document.createElement("canvas"));a.canvas.width=c;a.canvas.height=d;return a.canvas};Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/RenderGeometry":function(){define("exports ../../../../core/uid ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/sphere ../../support/mathUtils".split(" "),function(b,a,c,d,f,n,k){class g{constructor(e,m={}){this.geometry=e;this.screenToWorldRatio=1;this._transformation=d.create();this._boundingSphere=this._shaderTransformation=null;this.id=a.generateUID();this.layerUid=m.layerUid;
this.graphicUid=m.graphicUid;this.castShadow=m.castShadow??!1;null!=m.objectShaderTransformation&&this.objectShaderTransformationChanged(m.objectShaderTransformation)}get transformation(){return this._transformation}set transformation(e){c.copy(this._transformation,e);this._boundingSphere=null}get boundingInfo(){return this.geometry.boundingInfo}objectShaderTransformationChanged(e){null==e?this._shaderTransformation=null:(this._shaderTransformation??(this._shaderTransformation=d.create()),c.multiply(this._shaderTransformation,
e,this.geometry.transformation));this._boundingSphere=null}get boundingSphere(){if(!this.boundingInfo)return n.NullSphere;null==this._boundingSphere&&(this._boundingSphere??(this._boundingSphere=n.create()),f.transformMat4(this._boundingSphere,this.boundingInfo.center,this.shaderTransformation),this._boundingSphere[3]=this.boundingInfo.radius*k.maxScale(this.shaderTransformation));return this._boundingSphere}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return null==
this._shaderTransformation?this.transformation:this._shaderTransformation}get attributes(){return this.geometry.attributes}get highlights(){return this.geometry.highlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(e){this.geometry.visible=e}}class q extends g{}b.RenderGeometry=g;b.ValidatedRenderGeometry=q;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DLineSymbolLayer":function(){define("exports ../../../../geometry ../../../../core/Error ../../../../core/screenUtils ../../../../chunks/vec4f64 ../../../../geometry/support/aaBoundingBox ../../../../renderers/support/renderingInfoUtils ./ElevationAligners ./elevationAlignmentUtils ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./interfaces ./lineUtils ../support/FastSymbolUpdates ../../support/debugFlags ../../support/engineContent/line ../../support/renderInfoUtils/line ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/LineMarkerMaterial ../../webgl-engine/materials/lineStippleUtils ../../webgl-engine/materials/RibbonLineMaterial ../../../../geometry/Extent ../../../../geometry/Polygon".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A,C,E){const B=["polyline","polygon","extent"],D=new x.ConvertOptions({size:!0,color:!0,rotation:!1,opacity:!0});class F extends l.Graphics3DSymbolLayer{constructor(G,O,P,J){super(G,O,P,J)}async doLoad(){this._fastUpdates=x.initFastSymbolUpdatesState(this._context.renderer,D);if(!this._drivenProperties.size&&0>(null!=this.symbolLayer.size?this.symbolLayer.size:d.px2pt(1)))throw new c("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values");
}_getMaterialParameters(G,O=!1){const P=this._getCombinedOpacityAndColor(O&&this._markerColor||this._materialColor);this._patternHidesLine&&!O&&(P[3]=0);G={width:this._computeMaterialWidth(this.symbolLayer?.size),color:P,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:v.parseCapType(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:G,stipplePattern:z.getStipplePatternForLinePattern(this.symbolLayer.pattern)};return this._fastUpdates?.visualVariables?
{...G,...this._fastUpdates.materialParameters}:G}get _materialColor(){return this.symbolLayer.material?.color}get _markerColor(){return this.symbolLayer.marker?.color}get _lineMaterial(){null==this._materials[L.Line]&&(this._materials[L.Line]=new A.RibbonLineMaterial(this._getMaterialParameters(!1)),this._context.stage.add(this._materials[L.Line]));return this._materials[L.Line]}get _ringMaterial(){null==this._materials[L.Ring]&&(this._materials[L.Ring]=new A.RibbonLineMaterial(this._getMaterialParameters(!0)),
this._context.stage.add(this._materials[L.Ring]));return this._materials[L.Ring]}get _wireframeLineMaterial(){null==this._materials[L.LineWireframe]&&(this._materials[L.LineWireframe]=new A.RibbonLineMaterial({...this._getMaterialParameters(!1),wireframe:!0}),this._context.stage.add(this._materials[L.LineWireframe]));return this._materials[L.LineWireframe]}get _wireframeRingMaterial(){null==this._materials[L.RingWireframe]&&(this._materials[L.RingWireframe]=new A.RibbonLineMaterial({...this._getMaterialParameters(!0),
wireframe:!0}),this._context.stage.add(this._materials[L.RingWireframe]));return this._materials[L.RingWireframe]}get _markerMaterial(){null==this._materials[L.Marker]&&null!=this.symbolLayer.marker&&(this._materials[L.Marker]=new y.LineMarkerMaterial({...this._getMaterialParameters(!1,!0),placement:this.symbolLayer.marker.placement,markerPrimitive:v.parseLineMarkerStyle(this.symbolLayer.marker.style)}),this._context.stage.add(this._materials[L.Marker]));return this._materials[L.Marker]}destroy(){super.destroy();
this._forEachMaterial(G=>this._context.stage.remove(G));this._materials.length=0}_getDrivenSize(G){return this._drivenProperties.size&&G.size?d.pt2px(k.getDriverAxisSizeValueAny(G.size)):1}_getDrivenColor(G){const O=f.fromValues(1,1,1,1);this._drivenProperties.color&&G.color&&(O[0]=G.color[0],O[1]=G.color[1],O[2]=G.color[2],0<G.color.length&&(O[3]=G.color[3]));this._drivenProperties.opacity&&G.opacity&&(O[3]=G.opacity);return O}createGraphics3DGraphic(G){const O=G.graphic;if(!this._validateGeometry(O.geometry,
B,this.symbolLayer.type))return null;const P=this.setGraphicElevationContext(O);this.ensureDrapedStatus("on-the-ground"===P.mode);return this.draped?this._createAsOverlay(G,this._context.layer.uid):this._createAs3DShape(G,P,O.uid)}applyRendererDiff(G,O){for(const P in G.diff)switch(P){case "visualVariables":const J=this._fastUpdates;if(x.updateFastSymbolUpdatesState(J,O,D))this._forEachMaterial(R=>R?.setParameters(J.materialParameters));else return w.ApplyRendererDiffResult.RecreateSymbol;break;default:return w.ApplyRendererDiffResult.RecreateSymbol}return w.ApplyRendererDiffResult.FastUpdate}prepareSymbolLayerPatch(G){if("partial"===
G.diff.type){var O=G.diff.diff,P={};"complete"===O.size?.type&&(P.width=this._computeMaterialWidth(O.size.newValue),delete O.size);"complete"===O.cap?.type&&(P.cap=v.parseCapType(O.cap.newValue??"butt"),delete O.cap);var J=this._prepareMarkerPatch(G,O);this._prepareMaterialPatch(G,O,J);G.symbolLayerStatePatches.push(()=>this._forEachMaterial(R=>R?.setParameters(P)))}}layerOpacityChanged(){this._forEachMaterial((G,O)=>this._updateMaterialLayerOpacity(G,O===L.Marker))}_forEachMaterial(G){this._materials.forEach(G)}_updateMaterialLayerOpacity(G,
O=!1){if(null!=G){var P=G.parameters.color,J=this.symbolLayer?.material?.color;O=this._patternHidesLine&&!O?0:this._getCombinedOpacity(J);P=f.fromValues(P[0],P[1],P[2],O);G.setParameters({color:P})}}layerElevationInfoChanged(G,O,P){const J=this._elevationContext.mode;P=q.elevationModeChangeUpdateType(F.elevationModeChangeTypes,P,J);if(P!==q.SymbolUpdateType.UPDATE)return P;const R=q.needsElevationUpdates2D(J);return this.updateGraphics3DGraphicElevationInfo(G,O,()=>R)}slicePlaneEnabledChanged(){const G=
{hasSlicePlane:this._context.slicePlaneEnabled};this._forEachMaterial(O=>O?.setParameters(G));return!0}physicalBasedRenderingChanged(){return!0}_getGeometryAsPolygonOrPolyline(G){switch(G.type){case "extent":if(G instanceof C)return E.fromExtent(G);break;case "polygon":case "polyline":return G}return null}_createAs3DShape(G,O,P){const J=this._getGeometryAsPolygonOrPolyline(G.graphic.geometry);var R="polygon"===J.type?J.rings:J.paths,X=[];const U=n.create(),M=t.geometryToRenderInfo(J,this._context.elevationProvider,
this._context.renderCoordsHelper,O);this._logGeometryCreationWarnings(M,R,"polygon"===J.type?"rings":"paths","LineSymbol3DLayer");for(R=0;R<M.lines.length;R++){var V=M.lines[R],Y=V.position;V=V.mapPositions;if(null!=this._context.clippingExtent&&(n.empty(U),n.expandWithBuffer(U,V),!n.intersectsClippingArea(U,this._context.clippingExtent)))continue;Y=this._createGeometry("polygon"===J.type?this._ringMaterial:this._lineMaterial,G,Y,V,J.type,K.ELEVATED,P);X.push(Y);p.debugFlags.LINE_WIREFRAMES&&X.push(Y.instantiate({material:"polygon"===
J.type?this._wireframeRingMaterial:this._wireframeLineMaterial}));null!=this._markerMaterial&&X.push(Y.instantiate({material:this._markerMaterial}))}if(0===X.length)return null;G=new r.Object3D({geometries:X,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:P});X=new m.Graphics3DObject3DGraphicLayer(this,G,X,null,null,g.sharedGeometryElevationAligner,O);X.alignedSampledElevation=M.sampledElevation;X.needsElevationUpdates=q.needsElevationUpdates2D(O.mode);return X}_createGeometry(G,O,P,J,R,
X,U){X=X===K.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null;R="polygon"===R;const M=this._fastUpdates?.visualVariables.color,V=this._fastUpdates?.visualVariables.size,Y=this._fastUpdates?.visualVariables.opacity;U=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:U,layerUid:this._context.layer.uid});O={position:P,size:V?null:this._getDrivenSize(O.renderingInfo),color:M?null:this._getDrivenColor(O.renderingInfo),sizeFeature:V?
x.getAttributeValue(V.field,O.graphic):null,colorFeature:M?x.getAttributeValue(M.field,O.graphic):null,opacityFeature:Y?x.getAttributeValue(Y.field,O.graphic):null};return h.createGeometry(G,{overlayInfo:X,removeDuplicateStartEnd:R,mapPositions:J,attributeData:O},U)}_createAsOverlay(G,O){const P=G.graphic,J=this._getGeometryAsPolygonOrPolyline(P.geometry);var R="polygon"===J.type?J.rings:J.paths;const X="polygon"===J.type?this._ringMaterial:this._lineMaterial;X.renderPriority=this._renderPriority;
const U=p.debugFlags.LINE_WIREFRAMES?"polygon"===J.type?this._wireframeRingMaterial:this._wireframeLineMaterial:null,M=this._markerMaterial;null!=U&&(U.renderPriority=this._renderPriority-.001);null!=M&&(M.renderPriority=this._renderPriority-.002);const V=[],Y=n.create(),W=n.empty();var H=t.geometryToRenderInfoDraped(J,this._context.overlaySR);this._logGeometryCreationWarnings(H,R,"polygon"===J.type?"rings":"paths","LineSymbol3DLayer");for(const S of H.lines)n.empty(Y),n.expandWithBuffer(Y,S.position),
n.intersectsClippingArea(Y,this._context.clippingExtent)&&(n.expandWithAABB(W,Y),R=I=>{I=this._createGeometry(I,G,S.position,void 0,J.type,K.DRAPED,P.uid);I=new u.RenderGeometry(I,{layerUid:O,graphicUid:P.uid});V.push(I)},null!=M&&(R(M),H=this.symbolLayer.marker.placement,"begin"!==H&&"begin-end"!==H||n.expandWithBuffer(Y,S.position,0,1),"end"!==H&&"begin-end"!==H||n.expandWithBuffer(Y,S.position,S.position.length-3,1)),R(X),p.debugFlags.LINE_WIREFRAMES&&R(U));return new e.Graphics3DDrapedGraphicLayer(this,
V,W,this._context.drapeSourceRenderer)}get _patternHidesLine(){const G=this.symbolLayer.pattern;return null!=G&&"style"===G.type&&"none"===G.style}_computeMaterialWidth(G){G=G??d.px2pt(1);return this._drivenProperties.size?this._fastUpdates?.visualVariables.size?d.pt2px(1):1:d.pt2px(G)}_prepareMaterialPatch(G,O,P){var J=O.material;null==J?P.changed&&P.useMaterialColor&&this._patchMaterialColor(this._getCombinedOpacityAndColor(this._materialColor),this._materials[L.Marker],G):"collection"!==J.type&&
(J=this._getCombinedOpacityAndColor("complete"===J.type?J.newValue?.color:"complete"===J.diff.color?.type?J.diff.color.newValue:null),P.useMaterialColor&&this._patchMaterialColor(f.clone(J),this._materials[L.Marker],G),this._patternHidesLine&&(J[3]=0),this._patchMaterialColor(J,this._materials[L.Line],G),delete O.material)}_prepareMarkerPatch(G,O){const P=O.marker,J=this._markerMaterial;if(null==P||"partial"!==P.type||null==P.diff||null!=P.diff.placement||null!=P.diff.style&&"complete"!==P.diff.style.type||
null!=P.diff.color&&"complete"!==P.diff.color.type||null==J)return{changed:!1,useMaterialColor:null==this._markerColor};var R=P.diff.color;const X=null!=R;R=X?R.newValue:null;const U=null==R&&null==this._markerColor;R&&this._patchMaterialColor(this._getCombinedOpacityAndColor(R),J,G);const M=P.diff.style?.newValue;M&&G.symbolLayerStatePatches.push(()=>J.setParameters({markerPrimitive:v.parseLineMarkerStyle(M)}));delete O.marker;return{changed:X,useMaterialColor:U}}_patchMaterialColor(G,O,P){null!=
O&&P.symbolLayerStatePatches.push(()=>O.setParameters({color:G}))}}F.elevationModeChangeTypes={definedChanged:q.SymbolUpdateType.RECREATE,staysOnTheGround:q.SymbolUpdateType.NONE,onTheGroundChanged:q.SymbolUpdateType.RECREATE};var K;(function(G){G[G.DRAPED=0]="DRAPED";G[G.ELEVATED=1]="ELEVATED"})(K||(K={}));var L;(function(G){G[G.Line=0]="Line";G[G.Ring=1]="Ring";G[G.LineWireframe=2]="LineWireframe";G[G.RingWireframe=3]="RingWireframe";G[G.Marker=4]="Marker"})(L||(L={}));b.Graphics3DLineSymbolLayer=
F;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/lineUtils":function(){define(["exports","../../../../core/has","../../webgl-engine/shaders/RibbonLineTechniqueConfiguration"],function(b,a,c){b.parseCapType=function(d){switch(d){case "butt":return c.CapType.BUTT;case "square":return c.CapType.SQUARE;case "round":return c.CapType.ROUND;default:return null}};b.parseLineMarkerStyle=function(d){return"diamond"===d?"kite":d};Object.defineProperty(b,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/support/engineContent/line":function(){define("exports ../../../../chunks/vec2 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/ellipsoidUtils ../../../../geometry/projection/projectors ../../../../geometry/support/DoubleArray ../../../../geometry/support/FloatArray ../../../../geometry/support/Indices ../../../ViewingMode ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/ContentObjectType ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/VertexAttribute".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x){const p=d.create(),h=d.create();b.createGeometry=function(t,r,u=null){const y=[],z=r.mapPositions,{attributeData:{position:A},removeDuplicateStartEnd:C}=r;var E=A.length;E=A[0]===A[E-3]&&A[1]===A[E-2]&&A[2]===A[E-1]&&C;var B=A.length/3-(E?1:0),D=Array(2*(B-1)),F=E?A.slice(0,-3):A,K=0;for(var L=0;L<B-1;L++)D[K++]=L,D[K++]=L+1;y.push([x.VertexAttribute.POSITION,new l.Attribute(F,D,3,E)]);B=y[0][1].data;E=e.getZeroIndexArray(y[0][1].indices.length);null==r.attributeData.colorFeature&&
y.push([x.VertexAttribute.COLOR,new l.Attribute(r.attributeData.color??f.ONES,E,4)]);null==r.attributeData.sizeFeature&&y.push([x.VertexAttribute.SIZE,new l.Attribute([r.attributeData.size??1],E,1,!0)]);r.attributeData.normal&&y.push([x.VertexAttribute.NORMAL,new l.Attribute(r.attributeData.normal,E,3)]);null!=r.attributeData.colorFeature&&y.push([x.VertexAttribute.COLORFEATUREATTRIBUTE,new l.Attribute([r.attributeData.colorFeature],E,1,!0)]);null!=r.attributeData.sizeFeature&&y.push([x.VertexAttribute.SIZEFEATUREATTRIBUTE,
new l.Attribute([r.attributeData.sizeFeature],E,1,!0)]);null!=r.attributeData.opacityFeature&&y.push([x.VertexAttribute.OPACITYFEATUREATTRIBUTE,new l.Attribute([r.attributeData.opacityFeature],E,1,!0)]);if(null!=r.overlayInfo&&r.overlayInfo.renderCoordsHelper.viewingMode===m.ViewingMode.Global&&r.overlayInfo.spatialReference.isGeographic){E=g.newDoubleArray(B.length);r=n.getReferenceEllipsoid(r.overlayInfo.spatialReference);for(D=0;D<E.length;D+=3)k.lonLatToWebMercatorComparable(B,D,E,D,r);r=B.length/
3;B=q.newFloatArray(r+1);D=p;F=h;L=K=0;c.set(D,E[L++],E[L++],E[L++]);B[0]=0;for(let G=1;G<r+1;++G)G===r&&(L=0),c.set(F,E[L++],E[L++],E[L++]),K+=a.dist(D,F),B[G]=K,[D,F]=[F,D];y.push([x.VertexAttribute.DISTANCETOSTART,new l.Attribute(B,y[0][1].indices,1,!0)])}return new v.Geometry(t,y,z,w.ContentObjectType.Line,u)};b.lineStripsToParameters=function(t,r){if(null==t||0===t.length)return[];const u=[];t.forEach(y=>{const z=g.newDoubleArray(3*y.length);y.forEach((A,C)=>{z[3*C]=A[0];z[3*C+1]=A[1];z[3*C+
2]=A[2]});u.push({attributeData:{position:z,normal:r},removeDuplicateStartEnd:!1})});return u};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/renderInfoUtils/line":function(){define("exports ../../../../geometry/projection/projectBuffer ../../../../geometry/support/DoubleArray ../../../../geometry/support/triangulationUtils ../../layers/graphics/elevationAlignmentUtils ../../terrain/OverlayRenderer".split(" "),function(b,a,c,d,f,n){function k(g,q,e=null){const m=
[];for(const {index:l,count:w}of g){if(1>=w)continue;g=3*l;const v=3*w;m.push({position:c.doubleSubArray(q,3*l,3*w),mapPositions:null!=e?c.doubleSubArray(e,g,v):void 0})}return m}b.geometryToRenderInfo=function(g,q,e,m){const {position:l,outlines:w}=d.pathsToTriangulationInfo("polygon"===g.type?g.rings:g.paths,!!g.hasZ,"polygon"===g.type?d.CounterClockwiseMode.CCW_IS_HOLE:d.CounterClockwiseMode.NONE,g.spatialReference),v=c.newDoubleArray(l.length);g=f.applyPerVertexElevationAlignment(l,g.spatialReference,
0,v,0,l,0,l.length/3,q,e,m);q=null!=g;return{lines:q?k(w,l,v):[],projectionSuccess:q,sampledElevation:g}};b.geometryToRenderInfoDraped=function(g,q){const {position:e,outlines:m}=d.pathsToTriangulationInfo("polygon"===g.type?g.rings:g.paths,!1,"polygon"===g.type?d.CounterClockwiseMode.CCW_IS_HOLE:d.CounterClockwiseMode.NONE);g=a.projectBuffer(e,g.spatialReference,0,e,q,0,e.length/3);for(q=2;q<e.length;q+=3)e[q]=n.drapedZ;return{lines:g?k(m,e):[],projectionSuccess:g}};Object.defineProperty(b,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/materials/LineMarkerMaterial":function(){define("exports ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../lib/GLTextureMaterial ../lib/Material ../lib/RenderSlot ../lib/VertexAttribute ./VisualVariablePassParameters ../shaders/LineMarkerTechnique ../shaders/LineMarkerTechniqueConfiguration ../shaders/RibbonLineTechniqueConfiguration".split(" "),function(b,a,c,d,f,n,k,g,q,
e,m,l,w){class v extends k.Material{constructor(u){super(u,new p);this._vertexAttributeLocations=m.vertexAttributeLocations;this._configuration=new l.LineMarkerTechniqueConfiguration;this._layout=this.createLayout()}getConfiguration(u,y){this._configuration.output=u;this._configuration.space=y.slot===g.RenderSlot.DRAPED_MATERIAL?l.LineMarkerSpace.Draped:this.parameters.worldSpace?l.LineMarkerSpace.World:l.LineMarkerSpace.Screen;this._configuration.hideOnShortSegments=this.parameters.hideOnShortSegments;
this._configuration.hasCap=this.parameters.cap!==w.CapType.BUTT;this._configuration.anchor=this.parameters.anchor;this._configuration.hasTip=this.parameters.hasTip;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.hasOccludees=this.parameters.hasOccludees;this._configuration.writeDepth=this.parameters.writeDepth;this._configuration.vvSize=!!this.parameters.vvSize;this._configuration.vvColor=!!this.parameters.vvColor;this._configuration.vvOpacity=!!this.parameters.vvOpacity;
this._configuration.occluder=this.parameters.renderOccluded===k.RenderOccludedFlag.OccludeAndTransparentStencil;this._configuration.transparencyPassType=y.transparencyPassType;this._configuration.multipassEnabled=y.multipassEnabled;this._configuration.cullAboveGround=y.multipassTerrain.cullAboveGround;return this._configuration}intersect(){}createLayout(){const u=d.newLayout().vec3f(q.VertexAttribute.POSITION).vec2f(q.VertexAttribute.UV0).vec3f(q.VertexAttribute.AUXPOS1);this.parameters.worldSpace&&
u.vec3f(q.VertexAttribute.NORMAL);this.parameters.vvSize?u.f32(q.VertexAttribute.SIZEFEATUREATTRIBUTE):u.f32(q.VertexAttribute.SIZE);this.parameters.vvColor?u.f32(q.VertexAttribute.COLORFEATUREATTRIBUTE):u.vec4f(q.VertexAttribute.COLOR);this.parameters.vvOpacity&&u.f32(q.VertexAttribute.OPACITYFEATUREATTRIBUTE);return u}createBufferWriter(){return new h(this._layout,this.parameters)}produces(u,y){return y===f.ShaderOutput.Color||y===f.ShaderOutput.Alpha||y===f.ShaderOutput.Highlight||y===f.ShaderOutput.Depth?
u===g.RenderSlot.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===k.RenderOccludedFlag.OccludeAndTransparentStencil?u===g.RenderSlot.OPAQUE_MATERIAL||u===g.RenderSlot.OCCLUDER_MATERIAL||u===g.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL:y===f.ShaderOutput.Color||y===f.ShaderOutput.Alpha?u===(this.parameters.writeDepth?g.RenderSlot.TRANSPARENT_MATERIAL:g.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):u===g.RenderSlot.OPAQUE_MATERIAL:!1}createGLMaterial(u){return new x(u)}}class x extends n.GLTextureMaterial{constructor(){super(...arguments);
this._markerPrimitive=null}dispose(){super.dispose();this._markerTextureRepository.release(this._markerPrimitive);this._markerPrimitive=null}_updateParameters(u){const y=this._material.parameters.markerPrimitive;y!==this._markerPrimitive&&(this._material.setParameters({markerTexture:this._markerTextureRepository.swap(y,this._markerPrimitive)}),this._markerPrimitive=y);this._material.setParameters(this.textureBindParameters);return this.ensureTechnique(m.LineMarkerTechnique,u)}_updateOccludeeState(u){u.hasOccludees!==
this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:u.hasOccludees})}beginSlot(u){this._output!==f.ShaderOutput.Color&&this._output!==f.ShaderOutput.Alpha||this._updateOccludeeState(u);return this._updateParameters(u)}}class p extends e.VisualVariablePassParameters{constructor(){super(...arguments);this.width=0;this.color=[1,1,1,1];this.markerPrimitive="arrow";this.placement="end";this.cap=w.CapType.BUTT;this.anchor=l.LineMarkerAnchor.Center;this.hideOnShortSegments=
this.worldSpace=this.hasTip=!1;this.writeDepth=!0;this.hasOccludees=this.vvFastUpdate=this.hasSlicePlane=!1;this.markerTexture=null}}class h{constructor(u,y){this.vertexBufferLayout=u;this._parameters=y}elementCount(){return"begin-end"===this._parameters.placement?12:6}write(u,y,z,A,C){const E=z.attributes.get(q.VertexAttribute.POSITION).data,B=E.length/3;let D=[1,0,0];y=z.attributes.get(q.VertexAttribute.NORMAL);this._parameters.worldSpace&&null!=y&&(D=y.data);let F=1,K=0;this._parameters.vvSize?
K=z.attributes.get(q.VertexAttribute.SIZEFEATUREATTRIBUTE).data[0]:z.attributes.has(q.VertexAttribute.SIZE)&&(F=z.attributes.get(q.VertexAttribute.SIZE).data[0]);let L=[1,1,1,1],G=0;this._parameters.vvColor?G=z.attributes.get(q.VertexAttribute.COLORFEATUREATTRIBUTE).data[0]:z.attributes.has(q.VertexAttribute.COLOR)&&(L=z.attributes.get(q.VertexAttribute.COLOR).data);let O=0;this._parameters.vvOpacity&&(O=z.attributes.get(q.VertexAttribute.OPACITYFEATUREATTRIBUTE).data[0]);const P=new Float32Array(A.buffer);
let J=this.vertexBufferLayout.stride/4*C;const R=(U,M,V,Y)=>{P[J++]=U[0];P[J++]=U[1];P[J++]=U[2];P[J++]=V[0];P[J++]=V[1];P[J++]=M[0];P[J++]=M[1];P[J++]=M[2];this._parameters.worldSpace&&(P[J++]=D[0],P[J++]=D[1],P[J++]=D[2]);this._parameters.vvSize?P[J++]=K:P[J++]=F;this._parameters.vvColor?P[J++]=G:(U=Math.min(4*Y,L.length-4),P[J++]=L[U],P[J++]=L[U+1],P[J++]=L[U+2],P[J++]=L[U+3]);this._parameters.vvOpacity&&(P[J++]=O)};let X;(function(U){U[U.ASCENDING=1]="ASCENDING";U[U.DESCENDING=-1]="DESCENDING"})(X||
(X={}));z=(U,M)=>{const V=a.set(t,E[3*U],E[3*U+1],E[3*U+2]),Y=r;let W=U+M;do a.set(Y,E[3*W],E[3*W+1],E[3*W+2]),W+=M;while(a.equals(V,Y)&&0<=W&&W<B);u&&(a.transformMat4(V,V,u),a.transformMat4(Y,Y,u));R(V,Y,[-1,-1],U);R(V,Y,[1,-1],U);R(V,Y,[1,1],U);R(V,Y,[-1,-1],U);R(V,Y,[1,1],U);R(V,Y,[-1,1],U)};A=this._parameters.placement;"begin"!==A&&"begin-end"!==A||z(0,X.ASCENDING);"end"!==A&&"begin-end"!==A||z(B-1,X.DESCENDING)}}const t=c.create(),r=c.create();b.LineMarkerMaterial=v;b.Parameters=p;Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/LineMarkerTechnique":function(){define("require exports ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../lib/TransparencyPassType ../lib/VertexAttribute ../../../../chunks/LineMarker.glsl ../../../webgl/renderState".split(" "),function(b,a,c,d,f,n,k,g,q,e,m,l){const w=new Map([[e.VertexAttribute.POSITION,
0],[e.VertexAttribute.UV0,1],[e.VertexAttribute.AUXPOS1,2],[e.VertexAttribute.NORMAL,3],[e.VertexAttribute.COLOR,4],[e.VertexAttribute.COLORFEATUREATTRIBUTE,4],[e.VertexAttribute.SIZE,5],[e.VertexAttribute.SIZEFEATUREATTRIBUTE,5],[e.VertexAttribute.OPACITYFEATUREATTRIBUTE,6]]);class v extends f.ShaderTechnique{initializeProgram(x){return new k.Program(x.rctx,v.shader.get().build(this.configuration),w)}_makePipelineState(x,p){const h=this.configuration,t=x===q.TransparencyPassType.NONE;return l.makePipelineState({blending:h.output===
c.ShaderOutput.Color||h.output===c.ShaderOutput.Alpha?t?n.blendingDefault:n.oitBlending(x):null,depthTest:{func:n.oitDepthTest(x)},depthWrite:t?h.writeDepth?l.defaultDepthWriteParams:null:n.oitDepthWrite(x),colorWrite:l.defaultColorWriteParams,stencilWrite:h.hasOccludees?g.stencilWriteMaskOn:null,stencilTest:h.hasOccludees?p?g.stencilToolMaskBaseParams:g.stencilBaseAllZerosParams:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){this.configuration.occluder&&(this._occluderPipelineTransparent=
l.makePipelineState({blending:n.blendingDefault,depthTest:g.depthCompareAlways,depthWrite:null,colorWrite:l.defaultColorWriteParams,stencilWrite:null,stencilTest:g.stencilToolTransparentOccluderParams}),this._occluderPipelineOpaque=l.makePipelineState({blending:n.blendingDefault,depthTest:g.depthCompareAlways,depthWrite:null,colorWrite:l.defaultColorWriteParams,stencilWrite:g.stencilWriteMaskOff,stencilTest:g.stencilToolMaskOccluderParams}),this._occluderPipelineMaskWrite=l.makePipelineState({blending:null,
depthTest:g.depthCompareLess,depthWrite:null,colorWrite:null,stencilWrite:g.stencilWriteMaskOn,stencilTest:g.stencilToolMaskBaseParams}));this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0);return this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipeline(x,p,h){return x?this._occludeePipelineState:this.configuration.occluder?h?this._occluderPipelineTransparent:p?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipeline()}}
v.shader=new d.ReloadableShaderModule(m.LineMarker,()=>new Promise((x,p)=>b(["./LineMarker.glsl"],x,p)));a.LineMarkerTechnique=v;a.vertexAttributeLocations=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/LineMarker.glsl":function(){define("exports ../views/3d/support/engineContent/marker ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/RibbonVertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MarkerSizing.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/shaders/LineMarkerTechniqueConfiguration".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A){function C(B){const D=new r.ShaderBuilder,F=B.multipassEnabled&&(B.output===d.ShaderOutput.Color||B.output===d.ShaderOutput.Alpha),K=B.space===A.LineMarkerSpace.World;D.include(n.RibbonVertexPosition,B);D.include(g.MarkerSizing,B);B.output===d.ShaderOutput.Depth&&D.include(k.OutputDepth,B);const {vertex:L,fragment:G}=D;G.include(l.RgbaFloatEncoding);w.addProjViewLocalOrigin(L,B);D.attributes.add(z.VertexAttribute.POSITION,"vec3");D.attributes.add(z.VertexAttribute.UV0,
"vec2");D.attributes.add(z.VertexAttribute.AUXPOS1,"vec3");D.varyings.add("vColor","vec4");D.varyings.add("vpos","vec3");D.varyings.add("vUV","vec2");D.varyings.add("vSize","float");c.addLinearDepth(D);F&&D.varyings.add("depth","float");B.hasTip&&D.varyings.add("vLineWidth","float");L.uniforms.add(new v.Float2PassUniform("nearFar",(O,P)=>P.camera.nearFar),new x.Float4PassUniform("viewport",(O,P)=>P.camera.fullViewport));L.code.add(h.glsl`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`);L.code.add(h.glsl`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
float interpolation = (-vnp - pos.z) / (prev.z - pos.z);
prev = mix(pos, prev, interpolation);
}
}`);K?(D.attributes.add(z.VertexAttribute.NORMAL,"vec3"),w.addViewNormal(L),L.constants.add("tiltThreshold","float",.7),L.code.add(h.glsl`vec3 perpendicular(vec3 v) {
vec3 n = (viewNormal * vec4(normal.xyz, 1.0)).xyz;
vec3 n2 = cross(v, n);
vec3 forward = vec3(0.0, 0.0, 1.0);
float tiltDot = dot(forward, n);
return abs(tiltDot) < tiltThreshold ? n : n2;
}`)):L.code.add(h.glsl`vec2 perpendicular(vec2 v) {
return vec2(v.y, -v.x);
}`);L.code.add(h.glsl`
      #define vecN ${K?"vec3":"vec2"}

      vecN normalizedSegment(vecN pos, vecN prev) {
        vecN segment = pos - prev;
        float segmentLen = length(segment);

        // normalize or zero if too short
        return (segmentLen > 0.001) ? segment / segmentLen : ${K?"vec3(0.0, 0.0, 0.0)":"vec2(0.0, 0.0)"};
      }

      vecN displace(vecN pos, vecN prev, float displacementLen) {
        vecN segment = normalizedSegment(pos, prev);

        vecN displacementDirU = perpendicular(segment);
        vecN displacementDirV = segment;

        ${B.anchor===A.LineMarkerAnchor.Tip?"pos -\x3d 0.5 * displacementLen * displacementDirV;":""}

        return pos + displacementLen * (uv0.x * displacementDirU + uv0.y * displacementDirV);
      }
    `);B.space===A.LineMarkerSpace.Screen&&(L.uniforms.add(new t.Matrix4PassUniform("inverseProjectionMatrix",(O,P)=>P.camera.inverseProjectionMatrix)),L.code.add(h.glsl`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),L.code.add(h.glsl`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),L.uniforms.add(new p.FloatPassUniform("perScreenPixelRatio",(O,P)=>P.camera.perScreenPixelRatio)),L.code.add(h.glsl`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${B.hasCap?"\n                if(prev.z \x3e posLeft.z) {\n                  vec2 diff \x3d posLeft.xy - posRight.xy;\n                  planeOrigin.xy +\x3d perpendicular(diff) / 2.0;\n                }\n              ":""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `));w.addPixelRatio(L);c.addCalculateLinearDepth(D);L.code.add(h.glsl`void main(void) {
if (uv0.y == 0.0) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
}
else {
float lineWidth = getLineWidth();
float screenMarkerSize = getScreenMarkerSize();
vec4 pos  = view * vec4(position.xyz, 1.0);
vec4 prev = view * vec4(auxpos1.xyz, 1.0);
clip(pos, prev);`);K?(B.hideOnShortSegments&&L.code.add(h.glsl`if (areWorldMarkersHidden(pos, prev)) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
return;
}`),L.code.add(h.glsl`pos.xyz = displace(pos.xyz, prev.xyz, getWorldMarkerSize(pos));
vec4 displacedPosScreen = projectAndScale(pos);`)):(L.code.add(h.glsl`vec4 posScreen = projectAndScale(pos);
vec4 prevScreen = projectAndScale(prev);
vec4 displacedPosScreen = posScreen;
displacedPosScreen.xy = displace(posScreen.xy, prevScreen.xy, screenMarkerSize);`),B.space===A.LineMarkerSpace.Screen&&L.code.add(h.glsl`vec2 displacementDirU = perpendicular(normalizedSegment(posScreen.xy, prevScreen.xy));
vec3 lineRight = inverseProject(posScreen + lineWidth * vec4(displacementDirU.xy, 0.0, 0.0));
vec3 lineLeft = pos.xyz + (pos.xyz - lineRight);
pos = toFront(displacedPosScreen, lineLeft, lineRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`));L.code.add(h.glsl`
        ${F?"depth \x3d pos.z;":""}
        linearDepth = calculateLinearDepth(nearFar,pos.z);

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1]
        vUV = (uv0 + 1.0) / 2.0;

        ${K?"":"vUV *\x3d displacedPosScreen.w;"}

        ${B.hasTip?"vLineWidth \x3d lineWidth;":""}

        vSize = screenMarkerSize;
        vColor = getColor();

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `);F&&D.include(q.multipassTerrainTest,B);D.include(f.SliceDraw,B);G.uniforms.add(new x.Float4PassUniform("intrinsicColor",O=>O.color),new u.Texture2DPassUniform("tex",O=>O.markerTexture));G.include(m.ColorConversion);D.constants.add("texelSize","float",1/a.markerTextureSize);G.code.add(h.glsl`float markerAlpha(vec2 samplePos) {
samplePos += vec2(0.5, -0.5) * texelSize;
float sdf = rgba2float(texture(tex, samplePos)) - 0.5;
float distance = sdf * vSize;
distance -= 0.5;
return clamp(0.5 - distance, 0.0, 1.0);
}`);B.hasTip&&(D.constants.add("relativeMarkerSize","float",a.markerSymbolSize/a.markerTextureSize),D.constants.add("relativeTipLineWidth","float",a.markerTipThicknessFactor),G.code.add(h.glsl`
    float tipAlpha(vec2 samplePos) {
      // Convert coordinates s.t. they are in pixels and relative to the tip of an arrow marker
      samplePos -= vec2(0.5, 0.5 + 0.5 * relativeMarkerSize);
      samplePos *= vSize;

      float halfMarkerSize = 0.5 * relativeMarkerSize * vSize;
      float halfTipLineWidth = 0.5 * max(1.0, relativeTipLineWidth * vLineWidth);

      ${K?"halfTipLineWidth *\x3d fwidth(samplePos.y);":""}

      float distance = max(abs(samplePos.x) - halfMarkerSize, abs(samplePos.y) - halfTipLineWidth);
      return clamp(0.5 - distance, 0.0, 1.0);
    }
  `));D.constants.add("symbolAlphaCutoff","float",e.symbolAlphaCutoff);G.code.add(h.glsl`
  void main() {
    discardBySlice(vpos);
    ${F?"terrainDepthTest(depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    ${K?"vec2 samplePos \x3d vUV;":"vec2 samplePos \x3d vUV * gl_FragCoord.w;"}

    ${B.hasTip?"finalColor.a *\x3d max(markerAlpha(samplePos), tipAlpha(samplePos));":"finalColor.a *\x3d markerAlpha(samplePos);"}

    ${B.output===d.ShaderOutput.ObjectAndLayerIdColor?h.glsl`finalColor.a = 1.0;`:""}

    if (finalColor.a < symbolAlphaCutoff) {
      discard;
    }

    ${B.output===d.ShaderOutput.Alpha?h.glsl`fragColor = vec4(finalColor.a);`:""}
    ${B.output===d.ShaderOutput.Color?h.glsl`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${B.output===d.ShaderOutput.Color&&B.transparencyPassType===y.TransparencyPassType.Color?"fragColor \x3d premultiplyAlpha(fragColor);":""}
    ${B.output===d.ShaderOutput.Highlight?h.glsl`fragColor = vec4(1.0);`:""}
    ${B.output===d.ShaderOutput.Depth?h.glsl`outputDepth(linearDepth);`:""}
  }
  `);return D}const E=Object.freeze(Object.defineProperty({__proto__:null,build:C},Symbol.toStringTag,{value:"Module"}));b.LineMarker=E;b.build=C})},"esri/views/3d/webgl-engine/materials/lineStippleUtils":function(){define(["exports"],function(b){function a(f){null!=f?(f=d[f],f=null==f?f:{pattern:f.slice(),pixelRatio:8}):f=null;return f}const c={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},d={dash:c.dash,"dash-dot":[...c.dash,...c.dot],dot:c.dot,"long-dash":c["long-dash"],
"long-dash-dot":[...c["long-dash"],...c.dot],"long-dash-dot-dot":[...c["long-dash"],...c.dot,...c.dot],none:null,"short-dash":c["short-dash"],"short-dash-dot":[...c["short-dash"],...c["short-dot"]],"short-dash-dot-dot":[...c["short-dash"],...c["short-dot"],...c["short-dot"]],"short-dot":c["short-dot"],solid:null};b.createStipplePatternSimple=function(f){return{pattern:[f,f],pixelRatio:2}};b.getStipplePatternForLinePattern=function(f){return null!=f&&"style"===f.type?a(f.style):null};b.getStipplePatternForPatternStyle=
a;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DMeshFillSymbolLayer":function(){define("exports ../../../../Color ../../../../core/has ../../../../core/mathUtils ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/projection/computeTranslationToOriginAndRotation ../../../../geometry/projection/projectBuffer ../../../../geometry/projection/projectVectorToDehydratedPoint ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/FloatArray ../../../../geometry/support/Indices ../../../../geometry/support/MeshComponent ../../../../geometry/support/MeshMaterialMetallicRoughness ../../../../geometry/support/MeshTextureTransform ../../../../chunks/vec32 ../../../../geometry/support/meshUtils/georeference ../../../../geometry/support/meshUtils/projection ../../../../layers/graphics/dehydratedPoint ../../../../layers/graphics/sources/interfaces ../../../ViewingMode ../../glTF/internal/resourceUtils ../../glTF/internal/TextureTransformUtils ./ElevationAligners ./elevationAlignmentUtils ./Graphics3DMeshObject3DGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./MeshFastUpdateProcessor ../support/edgeUtils ../support/symbolColorUtils ../../support/debugFlags ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/ContentObjectType ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Texture ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/NativeLineMaterial ../../webgl-engine/materials/pbrUtils ../../../webgl/enums".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A,C,E,B,D,F,K,L,G,O,P,J,R,X,U,M,V,Y,W,H,S,I,Q,N,T,aa,Z){const da=["mesh"];class fa extends J.Graphics3DSymbolLayer{constructor(ja,qa,ua,wa){super(ja,qa,ua,wa);this._materialInfoCache=new R.MaterialInfoCache;this._fastUpdateProcessor=new R.MeshFastUpdateProcessor;this._textures=new Map;this.ensureDrapedStatus(!1)}async doLoad(){M.debugFlags.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new T.NativeLineMaterial({color:[1,0,1,1]}),this._debugFaceNormalMaterial=
new T.NativeLineMaterial({color:[0,1,1,1]}))}destroy(){super.destroy();this._textures.forEach(ja=>ja.unload());this._context.stage.removeMany(this._materialInfoCache.materials);this._context.stage.removeMany(Array.from(this._textures.values()));this._materialInfoCache.clear();this._textures.clear();this._fastUpdateProcessor.destroy(this._context.stage)}get materials(){return this._materialInfoCache.materials}createGraphics3DGraphic(ja){const qa=ja.graphic;if(!this._validateGeometry(qa.geometry,da,
"fill on mesh-3d"))return null;const ua=this.setGraphicElevationContext(qa);return this._createAs3DShape(qa,ja.renderingInfo,ua,qa.uid)}onRemoveGraphic(ja){this._fastUpdateProcessor.onRemoveGraphic(ja,this._materialInfoCache,this._context)}layerOpacityChanged(ja,qa){const ua=this._getLayerOpacity();this._updateMaterialParameters(wa=>{wa.material.setParameters({layerOpacity:ua});const za=wa.material.parameters;this._setMaterialTransparentParameter(za,wa);wa.material.setParameters({transparent:za.transparent})});
ja.forEach(wa=>qa(wa)?.layerOpacityChanged(ua,this._context.isAsync))}layerElevationInfoChanged(ja,qa){return this.updateGraphics3DGraphicElevationInfo(ja,qa,G.needsElevationUpdates3D)}slicePlaneEnabledChanged(ja,qa){this._updateMaterialParameters(({material:ua})=>{ua.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})});ja.forEach(ua=>qa(ua)?.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync));return!0}physicalBasedRenderingChanged(){const ja=this._usePBR();
this._updateMaterialParameters(({material:qa})=>qa.setParameters({usePBR:ja}));return!0}updateTransform(ja,qa,ua,wa){const za=this._context.renderCoordsHelper.spatialReference,Aa=na,{origin:Fa,transform:Da}=ua;w.computeTranslationToOriginAndRotation(qa,q.set(ba,Fa.x,Fa.y,Fa.z??0),Aa,za);switch(wa){case B.MeshTransformUpdateAction.EnableFastUpdates:this._fastUpdateProcessor.enable(ja,this._materialInfoCache,this._context);break;case B.MeshTransformUpdateAction.DisableFastUpdates:this._fastUpdateProcessor.disable(ja,
this._materialInfoCache,this._context);break;case B.MeshTransformUpdateAction.UpdateFastLocalOrigin:ja.updateFastLocalOrigin(Aa,Da,this._context.localOriginFactory)}const {elevationContext:Ha}=ja;Ha.centerPointInElevationSR=this._getCenterPointInElevationSR(Aa);const {elevationProvider:Ka,renderCoordsHelper:La}=this._context;ja.alignedSampledElevation=L.perObjectElevationAligner(ja,Ha,Ka.spatialReference,(Na,Ra)=>G.evaluateElevationInfoAtPoint(Na,Ka,Ha,La,Ra),La,Aa);ja.updateTransform(Aa,Da,this._context.isAsync);
return!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_colorOrTextureUid(ja){return null==ja?"-":ja instanceof a?ja.toHex():ja.contentHash}_materialPropertiesDefault(ja,qa){const ua=this._requiresSymbolVertexColors(),wa=!!ja.vertexAttributes.color;ja=!!ja.vertexAttributes.tangent;return{hasSymbolVertexColors:ua,hasVertexColors:wa,hasVertexTangents:ja,uid:`vc:${wa},vt:${ja},vct${qa},svc:${ua}`}}_textureTransformUid(ja){const {offset:qa,scale:ua,
rotation:wa}=ja??ma;return`${qa[0]},${qa[1]},${wa},${ua[0]},${ua[1]}`}_materialProperties(ja,qa,ua){ja=this._materialPropertiesDefault(ja,ua);if(!qa.material)return ja;const {color:wa,colorTexture:za,colorTextureTransform:Aa,normalTexture:Fa,normalTextureTransform:Da,doubleSided:Ha,alphaCutoff:Ka,alphaMode:La}=qa.material;ua=this._colorOrTextureUid(wa);var Na=this._colorOrTextureUid(za),Ra=this._textureTransformUid(Aa),Sa=this._colorOrTextureUid(Fa),sa=this._textureTransformUid(Da);ja.color=wa;ja.colorTexture=
za;ja.normalTexture=Fa;ja.uid=`${ja.uid},cmuid:${ua},ctmuid:${Na},cttuid:${Ra},ntmuid:${Sa},nttuid:${sa},ds:${Ha},ac:${Ka},am:${La}`;if(qa.material instanceof u){const {metallic:va,roughness:ya,metallicRoughnessTexture:Ea,metallicRoughnessTextureTransform:Ca,emissiveColor:Ga,emissiveTexture:Ja,emissiveTextureTransform:Ma,occlusionTexture:Ta,occlusionTextureTransform:Va}=qa.material;qa=this._colorOrTextureUid(Ea);ua=this._textureTransformUid(Ca);Na=this._colorOrTextureUid(Ga);Ra=this._colorOrTextureUid(Ja);
Sa=this._textureTransformUid(Ma);sa=this._colorOrTextureUid(Ta);const Wa=this._textureTransformUid(Va);ja.metallic=va;ja.roughness=ya;ja.metallicRoughnessTexture=Ea;ja.emissiveColor=Ga;ja.emissiveTexture=Ja;ja.occlusionTexture=Ta;ja.colorTextureTransform=this._convertTextureTransform(Aa);ja.normalTextureTransform=this._convertTextureTransform(Da);ja.emissiveTextureTransform=this._convertTextureTransform(Ma);ja.occlusionTextureTransform=this._convertTextureTransform(Va);ja.metallicRoughnessTextureTransform=
this._convertTextureTransform(Ca);ja.uid=`${ja.uid},mrm:${va},mrr:${ya},mrt:${qa},mrtt:${ua},emuid:${Na},etmuid:${Ra},ett:${Sa},otmuid:${sa},ott:${Wa}`}return ja}_convertTextureTransform(ja){if(!ja)return null;const {scale:qa,offset:ua,rotation:wa}=ja;return{scale:qa,offset:ua,rotation:d.deg2rad(wa)}}_setInternalColorValueParameters(ja,qa){qa.diffuse=a.toUnitRGB(ja);qa.opacity=ja.a}_getLoadableTextureResource(ja){return ja.data??ja.url}_getInternalTextureId(ja){return this._getInternalTexture(ja,
Y.AlphaDiscardMode.Opaque)?.id}_getInternalTexture(ja,qa){const ua=this._getLoadableTextureResource(ja);if(!ua)return null;const wa=`${ja.contentHash}/${qa}`;var za=this._textures.get(wa);za||(za=null,za=this._context.stage.renderView.renderingContext.parameters.maxMaxAnisotropy,ja={wrap:this._castTextureWrap(ja.wrap),noUnpackFlip:!0,maxAnisotropy:za,mipmap:1<za},F.isEncodedMeshTexture(ua)?(za=ua.data,ja.preMultiplyAlpha=!1,ja.encoding=ua.encoding):(za=ua,ja.preMultiplyAlpha=qa!==Y.AlphaDiscardMode.Opaque,
ja.downsampleUncompressed=this._context.graphicsCoreOwner.view.qualitySettings.graphics3D.uncompressedTextureDownsamplingEnabled),za=new I.Texture(za,ja),this._textures.set(wa,za),za.load(this._context.stage.renderView.renderingContext),this._context.stage.add(za));return za}_castTextureWrap(ja="repeat"){return"string"===typeof ja?(ja=this._castTextureWrapIndividual(ja),{s:ja,t:ja}):{s:this._castTextureWrapIndividual(ja.horizontal),t:this._castTextureWrapIndividual(ja.vertical)}}_castTextureWrapIndividual(ja){switch(ja){case "clamp":return Z.TextureWrapMode.CLAMP_TO_EDGE;
case "mirror":return Z.TextureWrapMode.MIRRORED_REPEAT;default:return Z.TextureWrapMode.REPEAT}}_setInternalMaterialParameters(ja,qa){null!=ja.color&&this._setInternalColorValueParameters(ja.color,qa);if(null!=ja.colorTexture){const ua=this._getInternalTexture(ja.colorTexture,qa.textureAlphaMode);ua?(qa.textureId=ua.id,qa.textureAlphaPremultiplied=!!ua.parameters.preMultiplyAlpha):qa.textureId=void 0}ja.normalTexture&&(qa.normalTextureId=this._getInternalTextureId(ja.normalTexture));ja.emissiveColor&&
(qa.emissiveFactor=a.toUnitRGB(ja.emissiveColor));ja.emissiveTexture&&(qa.emissiveTextureId=this._getInternalTextureId(ja.emissiveTexture));ja.occlusionTexture&&(qa.occlusionTextureId=this._getInternalTextureId(ja.occlusionTexture));ja.metallicRoughnessTexture&&(qa.metallicRoughnessTextureId=this._getInternalTextureId(ja.metallicRoughnessTexture));qa.colorTextureTransformMatrix=K.getTransformMatrix(ja.colorTextureTransform);qa.normalTextureTransformMatrix=K.getTransformMatrix(ja.normalTextureTransform);
qa.occlusionTextureTransformMatrix=K.getTransformMatrix(ja.occlusionTextureTransform);qa.emissiveTextureTransformMatrix=K.getTransformMatrix(ja.emissiveTextureTransform);qa.metallicRoughnessTextureTransformMatrix=K.getTransformMatrix(ja.metallicRoughnessTextureTransform)}_setExternalMaterialParameters(ja){let qa=this.symbolLayer.material?.colorMixMode??null;if(this._drivenProperties.color)ja.externalColor=m.ONES;else{const ua=this.symbolLayer.material?.color??null;ua?ja.externalColor=a.toUnitRGBA(ua):
(qa=null,ja.externalColor=m.ONES)}qa&&(ja.colorMixMode=qa);ja.castShadows=!!this.symbolLayer.castShadows}_hasTransparentVertexColors(ja){ja=ja.vertexAttributes.color;if(null==ja)return!1;for(let qa=3;qa<ja.length;qa+=4)if(255!==ja[qa])return!0;return!1}_getOrCreateMaterial(ja,qa){var ua=qa.material?.color,wa=qa.material?.colorTexture,za=qa.material?.alphaMode;const Aa="blend"===za;ua="opaque"!==za&&(this._hasTransparentVertexColors(ja)||null!=ua&&1>ua.a||wa?.transparent||Aa);ja=this._materialProperties(ja,
qa,ua);if(wa=this._materialInfoCache.byUid(ja.uid))return wa.material;ua={uid:ja.uid,material:null,isComponentTransparent:ua,alphaMode:qa.material?qa.material.alphaMode:"opaque"};wa=aa.useSchematicPBR({normalTexture:ja.normalTexture,metallicRoughnessTexture:ja.metallicRoughnessTexture,metallicFactor:ja.metallic,roughnessFactor:ja.roughness,emissiveTexture:ja.emissiveTexture,emissiveFactor:a.toUnitRGB(ja.emissiveColor),occlusionTexture:ja.occlusionTexture});za={usePBR:this._usePBR(),isSchematic:wa,
hasVertexColors:ja.hasVertexColors,hasSymbolColors:ja.hasSymbolVertexColors,hasVertexTangents:ja.hasVertexTangents,ambient:e.ZEROS,diffuse:e.ONES,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:Y.CullFaceOptions.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};za.mrrFactors=wa?[...aa.defaultSchematicMRRFactors]:[ja.metallic,ja.roughness,aa.defaultAdvancedMRRFactors[2]];qa.material&&(za.doubleSided=qa.material.doubleSided,
za.cullFace=qa.material.doubleSided?Y.CullFaceOptions.None:Y.CullFaceOptions.Back,za.textureAlphaCutoff=qa.material.alphaCutoff);this._setExternalMaterialParameters(za);this._setMaterialTransparentParameter(za,ua);this._setInternalMaterialParameters(ja,za);qa=new N.DefaultMaterial(za);ua.material=qa;this._materialInfoCache.set(ja.uid,ua);this._context.stage.add(qa);return qa}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(ja,qa){ja.transparent=this.needsDrivenTransparentPass||
qa.isComponentTransparent||1>ja.layerOpacity||1>ja.opacity||ja.externalColor&&1>ja.externalColor[3];ja.textureAlphaMode="auto"===qa.alphaMode?ja.transparent?Y.AlphaDiscardMode.MaskBlend:Y.AlphaDiscardMode.Opaque:"opaque"===qa.alphaMode?Y.AlphaDiscardMode.Opaque:"mask"===qa.alphaMode?Y.AlphaDiscardMode.Mask:Y.AlphaDiscardMode.Blend}_addDebugNormals(ja,qa){var ua=qa.length,wa=ja.spatialReference.isGeographic?20015077/180:1;const za=.1*Math.max(ja.extent.width*wa,ja.extent.height*wa,ja.extent.zmax-ja.extent.zmin);
var Aa=[];const Fa=[];ja=[];wa=[];for(let Ra=0;Ra<ua;Ra++){var Da=qa[Ra],Ha=Da.attributes.get(Q.VertexAttribute.POSITION),Ka=Da.attributes.get(Q.VertexAttribute.NORMAL);Da=Ha.data;Ha=Ha.indices;const Sa=Ka.data;Ka=Ka.indices;for(let sa=0;sa<Ha.length;sa++){var La=3*Ha[sa];const va=3*Ka[sa];for(var Na=0;3>Na;Na++)Aa.push(Da[La+Na]);for(Na=0;3>Na;Na++)Aa.push(Da[La+Na]+Sa[va+Na]*za);Fa.push(Fa.length);Fa.push(Fa.length);if(0===sa%3){this._calculateFaceNormal(Da,Ha,sa,ia);this._getFaceVertices(Da,Ha,
sa,ba,ea,ca);q.add(ba,ba,ea);q.add(ba,ba,ca);q.scale(ba,ba,1/3);for(La=0;3>La;La++)ja.push(ba[La]);for(La=0;3>La;La++)ja.push(ba[La]+ia[La]*za);wa.push(wa.length);wa.push(wa.length)}}}ua=qa[0].transformation;Aa=new H.Geometry(this._debugVertexNormalMaterial,[[Q.VertexAttribute.POSITION,new V.Attribute(Aa,Fa,3,!0)]],null,W.ContentObjectType.Line);qa.push(Aa);Aa.transformation=ua;ja=new H.Geometry(this._debugFaceNormalMaterial,[[Q.VertexAttribute.POSITION,new V.Attribute(ja,wa,3,!0)]],null,W.ContentObjectType.Line);
ja.transformation=ua;qa.push(ja)}_createAs3DShape(ja,qa,ua,wa){ja=ja.geometry;if("mesh"!==ja.type)return null;qa=this._createGeometryInfo(ja,qa,wa);if(null==qa)return null;const {geometries:za,objectTransformation:Aa}=qa;M.debugFlags.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(ja,za);wa=new S.Object3D({geometries:za,layerUid:this._context.layer.uid,graphicUid:wa});wa.transformation=Aa;qa=(qa=X.createMaterial(this.symbolLayer,{opacity:this._getLayerOpacity()}))?new P.Object3DEdgeState(za[0].material,
[qa],{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}):null;qa=new O.Graphics3DMeshObject3DGraphicLayer(this,wa,za,null,null,L.perObjectElevationAligner,ua,qa);this._fastUpdateProcessor.onAddGraphic();qa.needsElevationUpdates=G.needsElevationUpdates3D(ua.mode);qa.useObjectOriginAsAttachmentOrigin=!0;ua.centerPointInElevationSR=this._getCenterPointInElevationSR(wa.transformation);const {elevationProvider:Fa,renderCoordsHelper:Da}=this._context;qa.alignedSampledElevation=L.perObjectElevationAligner(qa,
ua,Fa.spatialReference,(Ha,Ka)=>G.evaluateElevationInfoAtPoint(Ha,Fa,ua,Da,Ka),Da);return qa}_getCenterPointInElevationSR(ja){const qa=E.makeDehydratedPoint(0,0,0,null!=this._context.elevationProvider.spatialReference?this._context.elevationProvider.spatialReference:null);x.projectVectorToDehydratedPoint([ja[12],ja[13],ja[14]],this._context.renderCoordsHelper.spatialReference,qa);return qa}_createComponentNormals(ja,qa,ua,wa){switch(ua.shading||"flat"){default:case "source":return this._createComponentNormalsSource(ja,
qa,ua,wa);case "flat":return this._createComponentNormalsFlat(ja,wa);case "smooth":return this._createComponentNormalsSmooth(ja,wa)}}_createComponentNormalsSource(ja,qa,ua,wa){if(null==qa)return this._createComponentNormalsFlat(ja,wa);let za=!1;if(!ua.trustSourceNormals)for(ua=0;ua<wa.length;ua+=3){this._calculateFaceNormal(ja,wa,ua,ia);for(let Aa=0;3>Aa;Aa++){const Fa=3*wa[ua+Aa];ba[0]=qa[Fa];ba[1]=qa[Fa+1];ba[2]=qa[Fa+2];0>q.dot(ia,ba)&&(qa[Fa]=-qa[Fa],qa[Fa+1]=-qa[Fa+1],qa[Fa+2]=-qa[Fa+2],za=!0)}}return new ka(qa,
wa,za)}_createComponentNormalsFlat(ja,qa){const ua=h.newFloatArray(qa.length),wa=Array(3*qa.length);for(let za=0;za<qa.length;za+=3){const Aa=this._calculateFaceNormal(ja,qa,za,ia);for(let Fa=0;3>Fa;Fa++)ua[za+Fa]=Aa[Fa],wa[za+Fa]=za/3}return new ka(ua,wa,!1)}_createComponentNormalsSmooth(ja,qa){const ua={};for(var wa=0;wa<qa.length;wa+=3){var za=this._calculateFaceNormal(ja,qa,wa,ia);for(var Aa=0;3>Aa;Aa++){var Fa=qa[wa+Aa];let Da=ua[Fa];Da||(Da={normal:e.create(),count:0},ua[Fa]=Da);q.add(Da.normal,
Da.normal,za);Da.count++}}ja=h.newFloatArray(3*qa.length);wa=Array(3*qa.length);for(za=0;za<qa.length;za++){Aa=ua[qa[za]];1!==Aa.count&&(q.normalize(Aa.normal,Aa.normal),Aa.count=1);for(Fa=0;3>Fa;Fa++)ja[3*za+Fa]=Aa.normal[Fa];wa[za]=za}return new ka(ja,wa,!1)}_getFaceVertices(ja,qa,ua,wa,za,Aa){const Fa=3*qa[ua],Da=3*qa[ua+1];qa=3*qa[ua+2];wa[0]=ja[Fa];wa[1]=ja[Fa+1];wa[2]=ja[Fa+2];za[0]=ja[Da];za[1]=ja[Da+1];za[2]=ja[Da+2];Aa[0]=ja[qa];Aa[1]=ja[qa+1];Aa[2]=ja[qa+2]}_calculateFaceNormal(ja,qa,ua,
wa){this._getFaceVertices(ja,qa,ua,ba,ea,ca);q.subtract(ea,ea,ba);q.subtract(ca,ca,ba);q.cross(ba,ea,ca);q.normalize(wa,ba);return wa}_getOrCreateComponents(ja){return ja.components??ta}_createPositionBuffer(ja,qa){let ua=ja.vertexAttributes.position;const wa=qa.reprojection===pa.ECEF?qa.transformBeforeProject:null;wa&&(ua=z.transformMat4(new Float64Array(ua.length),ua,wa));if(qa.reprojection===pa.NONE)return qa.needsBufferCopy?new Float64Array(ua):ua;qa=wa?ua:new Float64Array(ua.length);v.projectBuffer(ua,
ja.spatialReference,0,qa,this._context.renderCoordsHelper.spatialReference,0,ua.length/3);return qa}_createNormalBuffer(ja,qa,ua){let wa=ja.vertexAttributes.normal;if(null==wa)return null;var za=ua.reprojection===pa.ECEF?ua.transformBeforeProject:null;za&&(wa=C.transformNormal(wa,new Float32Array(wa.length),za));if("local"===this._context.graphicsCoreOwner.view.viewingMode||ua.reprojection===pa.NONE)return ua.needsBufferCopy&&ja.vertexAttributes.normal===wa?new Float32Array(wa):wa;ua=ja.vertexAttributes.position;
za=za?wa:new Float32Array(wa.length);return C.projectNormalToPCPF(wa,ua,qa,ja.spatialReference,za)}_createTangentBuffer(ja,qa,ua){let wa=ja.vertexAttributes.tangent;if(null==wa)return null;var za=ua.reprojection===pa.ECEF?ua.transformBeforeProject:null;za&&(wa=C.transformTangent(wa,new Float32Array(wa.length),za));if("local"===this._context.graphicsCoreOwner.view.viewingMode||ua.reprojection===pa.NONE)return ua.needsBufferCopy&&ja.vertexAttributes.normal===wa?new Float32Array(wa):wa;ua=ja.vertexAttributes.position;
za=za?wa:new Float32Array(wa.length);return C.projectTangentToPCPF(wa,ua,qa,ja.spatialReference,za)}_createColorBuffer(ja){return ja.vertexAttributes.color}_createSymbolColorBuffer(ja){if(this._requiresSymbolVertexColors()){ja=this._getVertexOpacityAndColor(ja);const qa=U.parseColorMixMode(this.symbolLayer?.material?.colorMixMode),ua=new Uint8Array(4);U.encodeSymbolColor(ja,qa,ua);return ua}return null}_createBuffers(ja,qa){var ua=ja.vertexAttributes&&ja.vertexAttributes.position;if(!ua)return this.logger.warn("Mesh geometry must contain position vertex attributes"),
null;var wa=ja.vertexAttributes.normal;const za=ja.vertexAttributes.uv;var Aa=ja.vertexAttributes.tangent;if(wa&&wa.length!==ua.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(Aa&&Aa.length/4!==ua.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(za&&za.length/2!==ua.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),
null;Aa=this._computeReprojectionInfo(ja);ua=this._createPositionBuffer(ja,Aa);wa=this._createColorBuffer(ja);qa=this._createSymbolColorBuffer(qa);const Fa=this._createNormalBuffer(ja,ua,Aa),Da=this._createTangentBuffer(ja,ua,Aa);ja=Aa.reprojection===pa.NONE&&Aa.objectTransformation?Aa.objectTransformation:this._transformOriginLocal(ja,ua,Fa,Da);Aa=Aa.reprojection===pa.NONE&&Aa.geometryTransformation?Aa.geometryTransformation:g.create();return{positionBuffer:ua,normalBuffer:Fa,tangentBuffer:Da,uvBuffer:za,
colorBuffer:wa,symbolColorBuffer:qa,objectTransformation:ja,geometryTransformation:Aa}}_computeReprojectionInfo(ja){var {vertexSpace:qa}=ja;const ua=qa.isGeoreferenced?this._context.renderCoordsHelper.viewingMode===D.ViewingMode.Local?pa.NONE:pa.ECEF:pa.NONE;if(qa.isRelative){const {origin:wa}=qa;qa=g.create();const za=ja.transform?.localMatrix??g.IDENTITY;if(ua===pa.NONE)return w.computeTranslationToOriginAndRotation(ja.spatialReference,wa,qa,this._context.renderCoordsHelper.spatialReference),ja=
g.clone(za),{reprojection:ua,objectTransformation:qa,geometryTransformation:ja,needsBufferCopy:!1};ja=k.fromTranslation(g.create(),wa);k.multiply(ja,ja,za);return{reprojection:ua,transformBeforeProject:ja,needsBufferCopy:!0}}return{reprojection:ua,needsBufferCopy:!0}}_transformOriginLocal(ja,qa,ua,wa){const za=this._context.renderCoordsHelper.spatialReference;var Aa=ja.anchor;ha[0]=Aa.x;ha[1]=Aa.y;ha[2]=Aa.z??0;Aa=g.create();w.computeTranslationToOriginAndRotation(ja.spatialReference,ha,Aa,za);k.invert(la,
Aa);z.transformMat4(qa,qa,la);if(ua||wa)f.fromMat4(oa,Aa),f.transpose(oa,oa),ua&&z.transformMat3(ua,ua,oa),wa&&z.transformMat3(wa,wa,oa,4);return Aa}_validateFaces(ja,qa){ja=ja.vertexAttributes.position.length/3;if(qa=qa.faces){let ua=-1;for(let wa=0;wa<qa.length;wa++){const za=qa[wa];za>ua&&(ua=za)}if(ja<=ua)return this.logger.warn(`Vertex index ${ua} is out of bounds of the mesh position buffer`),!1}else if(0!==ja%3)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),
!1;return!0}_getOrCreateFaces(ja,qa){return qa.faces??t.getContinuousIndexArray(ja.vertexAttributes.position.length/3)}_isOutsideClippingArea(ja){if(!this._context.clippingExtent)return!1;var qa=ja.vertexAttributes?.position;if(!qa)return!1;ja=A.project({positions:qa,transform:ja.transform,vertexSpace:ja.vertexSpace,inSpatialReference:ja.spatialReference,outSpatialReference:this._context.elevationProvider.spatialReference??ja.spatialReference,localMode:this._context.stage.viewingMode===D.ViewingMode.Local});
qa=ja.length/3;p.empty(ra);p.expandWithBuffer(ra,ja,0,qa);return!p.intersectsClippingArea(ra,this._context.clippingExtent)}_createGeometryInfo(ja,qa,ua){if(!l.canProjectWithoutEngine(ja.spatialReference,this._context.graphicsCoreOwner.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(ja))return null;qa=this._createBuffers(ja,qa);if(null==qa)return null;const {positionBuffer:wa,uvBuffer:za,colorBuffer:Aa,
symbolColorBuffer:Fa,normalBuffer:Da,tangentBuffer:Ha,objectTransformation:Ka,geometryTransformation:La}=qa;var Na=this._getOrCreateComponents(ja);qa=[];let Ra=!1;var Sa=k.getTranslation(ba,Ka);Sa=this._context.localOriginFactory.getOrigin(Sa);for(const va of Na){if(!this._validateFaces(ja,va))return null;var sa=this._getOrCreateFaces(ja,va);if(0===sa.length)continue;Na=this._createComponentNormals(wa,Da,va,sa);Na.didFlipNormals&&(Ra=!0);Na=[[Q.VertexAttribute.POSITION,new V.Attribute(wa,sa,3,!0)],
[Q.VertexAttribute.NORMAL,new V.Attribute(Na.normals,Na.indices,3,!0)]];Aa&&Na.push([Q.VertexAttribute.COLOR,new V.Attribute(Aa,sa,4,!0)]);Fa&&Na.push([Q.VertexAttribute.SYMBOLCOLOR,new V.Attribute(Fa,t.getZeroIndexArray(sa.length),4,!0)]);za&&Na.push([Q.VertexAttribute.UV0,new V.Attribute(za,sa,2,!0)]);Ha&&Na.push([Q.VertexAttribute.TANGENT,new V.Attribute(Ha,sa,4,!0)]);sa=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:ua,layerUid:this._context.layer.uid});const ya=this._getOrCreateMaterial(ja,
va);Na=new H.Geometry(ya,Na,null,W.ContentObjectType.Mesh,sa);Na.transformation=La;Na.localOrigin=Sa;qa.push(Na)}Ra&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals.");return{geometries:qa,objectTransformation:Ka}}_updateMaterialParameters(ja){this._materialInfoCache.forEachMaterialInfo(ja);this._fastUpdateProcessor.forEachMaterialInfo(ja);this._fastUpdateProcessor.forEachClonedMaterial((qa,
ua)=>{ua.setParameters(qa.parameters)})}test(){return{...super.test(),materials:this._materialInfoCache.materials}}}class ka{constructor(ja,qa,ua){this.normals=ja;this.indices=qa;this.didFlipNormals=ua}}const ha=e.create(),ba=e.create(),ea=e.create(),ca=e.create(),ia=e.create(),la=g.create(),oa=n.create(),na=g.create(),ra=p.create(),ta=[new r],ma=new y;var pa;(function(ja){ja[ja.NONE=0]="NONE";ja[ja.ECEF=1]="ECEF"})(pa||(pa={}));b.Graphics3DMeshFillSymbolLayer=fa;Object.defineProperty(b,Symbol.toStringTag,
{value:"Module"})})},"esri/geometry/projection/projectVectorToDehydratedPoint":function(){define(["exports","../../chunks/vec3f64","./projectBuffer"],function(b,a,c){const d=a.create();b.projectVectorToDehydratedPoint=function(f,n,k){return c.projectBuffer(f,n,0,d,k.spatialReference,0,1)?(k.x=d[0],k.y=d[1],k.z=d[2],k):null};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/MeshComponent":function(){define("../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/ensureType ./MeshMaterial ./MeshMaterialMetallicRoughness ./MeshVertexAttributes".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m){var l;const w=d.getLogger("esri.geometry.support.MeshComponent");a=l=class extends a.JSONSupport{static from(v){return g.ensureClass(l,v)}constructor(v){super(v);this.material=this.faces=null;this.name=void 0;this.shading="source";this.trustSourceNormals=!1}castFaces(v){return m.castArray(v,Uint32Array,[Uint16Array],{loggerTag:".faces\x3d",stride:3},w)}castMaterial(v){return v&&"object"===typeof v&&("metallic"in v||"roughness"in v||"metallicRoughnessTexture"in v)?g.ensureClass(e,
v):g.ensureClass(q,v)}clone(){return new l({faces:c.clone(this.faces),shading:this.shading,material:c.clone(this.material),trustSourceNormals:this.trustSourceNormals,name:this.name})}cloneWithDeduplication(v,x){v={faces:c.clone(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(v,x):null,trustSourceNormals:this.trustSourceNormals,name:this.name};return new l(v)}get memoryUsage(){let v=0;null!=this.faces&&(v+=this.faces.byteLength);null!=this.material&&(v+=
this.material.memoryUsage);return v}};b.__decorate([f.property({json:{write:!0}})],a.prototype,"faces",void 0);b.__decorate([n.cast("faces")],a.prototype,"castFaces",null);b.__decorate([f.property({type:q,json:{write:!0}})],a.prototype,"material",void 0);b.__decorate([n.cast("material")],a.prototype,"castMaterial",null);b.__decorate([f.property()],a.prototype,"name",void 0);b.__decorate([f.property({type:String,json:{write:!0}})],a.prototype,"shading",void 0);b.__decorate([f.property({type:Boolean})],
a.prototype,"trustSourceNormals",void 0);return a=l=b.__decorate([k.subclass("esri.geometry.support.MeshComponent")],a)})},"esri/geometry/support/MeshMaterial":function(){define("../../chunks/tslib.es6 ../../Color ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ./MeshTexture ./MeshTextureTransform".split(" "),function(b,a,c,d,f,n,k,g,q,e){var m;c=m=class extends c.JSONSupport{constructor(l){super(l);
this.colorTextureTransform=this.colorTexture=this.color=null;this.normalTextureTransform=this.normalTexture=void 0;this.alphaMode="auto";this.alphaCutoff=.5;this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(l,w){const v=null!=l?l.get(this):null;if(v)return v;w=new m(this.clonePropertiesWithDeduplication(w));null!=l&&l.set(this,w);return w}clonePropertiesWithDeduplication(l){return{color:null!=this.color?this.color.clone():null,colorTexture:this.colorTexture?.cloneWithDeduplication(l),
normalTexture:this.normalTexture?.cloneWithDeduplication(l),alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided,colorTextureTransform:this.colorTextureTransform?.clone(),normalTextureTransform:this.normalTextureTransform?.clone()}}get memoryUsage(){return this.getMemoryUsage()}getMemoryUsage(){let l;l=null!=this.color?16:0;null!=this.colorTexture&&(l+=this.colorTexture.memoryUsage);l+=null!=this.colorTextureTransform?20:0;null!=this.normalTexture&&(l+=this.normalTexture.memoryUsage);
return l+=null!=this.normalTextureTransform?20:0}};b.__decorate([d.property({type:a,json:{write:!0}})],c.prototype,"color",void 0);b.__decorate([d.property({type:q,json:{write:!0}})],c.prototype,"colorTexture",void 0);b.__decorate([d.property({type:e,json:{write:!0}})],c.prototype,"colorTextureTransform",void 0);b.__decorate([d.property({type:q,json:{write:!0}})],c.prototype,"normalTexture",void 0);b.__decorate([d.property({type:e,json:{write:!0}})],c.prototype,"normalTextureTransform",void 0);b.__decorate([d.property({nonNullable:!0,
json:{write:!0}})],c.prototype,"alphaMode",void 0);b.__decorate([d.property({nonNullable:!0,json:{write:!0}})],c.prototype,"alphaCutoff",void 0);b.__decorate([d.property({nonNullable:!0,json:{write:!0}})],c.prototype,"doubleSided",void 0);return c=m=b.__decorate([g.subclass("esri.geometry.support.MeshMaterial")],c)})},"esri/geometry/support/MeshTexture":function(){define("../../chunks/tslib.es6 ../../core/has ../../core/imageUtils ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../chunks/persistableUrlUtils".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m){var l;const w=new WeakMap;let v=0;a=l=class extends d.JSONSupport{constructor(x){super(x);this.wrap="repeat"}get url(){return this._get("url")||null}set url(x){this._set("url",x);x&&this._set("data",null)}get data(){return this._get("data")||null}set data(x){this._set("data",x);x&&this._set("url",null)}writeData(x,p,h,t){x instanceof HTMLImageElement?(x={type:"image-element",src:m.toJSON(x.src,t),crossOrigin:x.crossOrigin},p[h]=x):x instanceof HTMLCanvasElement?(x=
x.getContext("2d").getImageData(0,0,x.width,x.height),x={type:"canvas-element",imageData:this._encodeImageData(x)},p[h]=x):x instanceof HTMLVideoElement?(x={type:"video-element",src:m.toJSON(x.src,t),autoplay:x.autoplay,loop:x.loop,muted:x.muted,crossOrigin:x.crossOrigin,preload:x.preload},p[h]=x):x instanceof ImageData&&(x={type:"image-data",imageData:this._encodeImageData(x)},p[h]=x)}readData(x){switch(x.type){case "image-element":var p=new Image;p.src=x.src;p.crossOrigin=x.crossOrigin;return p;
case "canvas-element":return x=this._decodeImageData(x.imageData),p=document.createElement("canvas"),p.width=x.width,p.height=x.height,p.getContext("2d").putImageData(x,0,0),p;case "image-data":return this._decodeImageData(x.imageData);case "video-element":return p=document.createElement("video"),p.src=x.src,p.crossOrigin=x.crossOrigin,p.autoplay=x.autoplay,p.loop=x.loop,p.muted=x.muted,p.preload=x.preload,p}}get transparent(){var x=this.data,p=this.url;return x instanceof HTMLCanvasElement?this._imageDataContainsTransparent(x.getContext("2d").getImageData(0,
0,x.width,x.height)):x instanceof ImageData?this._imageDataContainsTransparent(x):p&&(x=p.substr(p.length-4,4).toLowerCase(),p=p.substr(0,15).toLocaleLowerCase(),".png"===x||"data:image/png;"===p)?!0:!1}set transparent(x){this._overrideIfSome("transparent",x)}get contentHash(){const x="string"===typeof this.wrap?this.wrap:"object"===typeof this.wrap?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",p=(h="")=>`d:${h},t:${this.transparent},w:${x}`;if(null!=this.url)return p(this.url);if(null!=this.data){if(this.data instanceof
HTMLImageElement||this.data instanceof HTMLVideoElement)return p(this.data.src);w.has(this.data)||w.set(this.data,++v);return p(w.get(this.data))}return p()}get memoryUsage(){let x;x=0+(null!=this.url?this.url.length:0);if(null!=this.data){const p=this.data;"data"in p?x+=p.data.byteLength:p instanceof HTMLImageElement?x+=p.naturalWidth*p.naturalHeight*3:p instanceof HTMLCanvasElement&&(x+=p.width*p.height*3)}return x}clone(){const x={url:this.url,data:this.data,wrap:this._cloneWrap()};return new l(x)}cloneWithDeduplication(x){var p=
x.get(this);if(p)return p;p=this.clone();x.set(this,p);return p}_cloneWrap(){return"string"===typeof this.wrap?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}_encodeImageData(x){let p="";for(let h=0;h<x.data.length;h++)p+=String.fromCharCode(x.data[h]);return{data:btoa(p),width:x.width,height:x.height}}_decodeImageData(x){const p=atob(x.data),h=new Uint8ClampedArray(p.length);for(let t=0;t<p.length;t++)h[t]=p.charCodeAt(t);return c.wrapImageData(h,x.width,x.height)}_imageDataContainsTransparent(x){for(let p=
3;p<x.data.length;p+=4)if(255!==x.data[p])return!0;return!1}static from(x){return"string"===typeof x?new l({url:x}):x instanceof HTMLImageElement||x instanceof HTMLCanvasElement||x instanceof ImageData||x instanceof HTMLVideoElement?new l({data:x}):n.ensureClass(l,x)}};b.__decorate([f.property({type:String,json:{write:m.write}})],a.prototype,"url",null);b.__decorate([f.property({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),f.property()],a.prototype,"data",null);b.__decorate([e.writer("data")],
a.prototype,"writeData",null);b.__decorate([g.reader("data")],a.prototype,"readData",null);b.__decorate([f.property({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],a.prototype,"transparent",null);b.__decorate([f.property({json:{write:!0}})],a.prototype,"wrap",void 0);b.__decorate([f.property({readOnly:!0})],a.prototype,"contentHash",null);return a=l=b.__decorate([q.subclass("esri.geometry.support.MeshTexture")],a)})},"esri/core/imageUtils":function(){define("require exports ../request ./Error ./promiseUtils ./urlUtils ../support/base64Utils".split(" "),
function(b,a,c,d,f,n,k){function g(w,v,x){x||(m||(m=document.createElement("canvas"),m.width=1,m.height=1),x=m);return x.getContext("2d").createImageData(w,v)}async function q(w,v){w=window.URL.createObjectURL(w);try{const {data:x}=await c(w,{...v,responseType:"image"});return x}catch(x){if(!f.isAbortError(x))throw new d("invalid-image",`Could not fetch requested image at ${w}`);throw x;}finally{window.URL.revokeObjectURL(w)}}async function e(w,v){const x=n.dataComponents(w);if(x?.isBase64)return{arrayBuffer:k.base64ToArrayBuffer(x.data),
mediaType:x.mediaType};v=await c(w,{responseType:"array-buffer",...v});w=v.data;v=v.getHeader("Content-Type");return{arrayBuffer:w,mediaType:v}}let m=null,l=!0;a.createEmptyImageData=function(w,v,x){if(!w||!v)throw Error("Cannot construct image data without dimensions");if(l)try{return new ImageData(w,v)}catch(p){l=!1}return g(w,v,x)};a.getImageData=async function(w,v){const {arrayBuffer:x,mediaType:p}=await e(w,v);w="image/png"===p;if("image/gif"===p){const {isAnimatedGIF:h,parseGif:t}=await new Promise((r,
u)=>b(["./image/gif"],r,u));if(h(x))return t(x,v)}if(w){const {isAnimatedPNG:h,parseApng:t}=await new Promise((r,u)=>b(["./image/apng"],r,u));if(h(x))return t(x,v)}w=new Blob([x],{type:p});return q(w,v)};a.wrapImageData=function(w,v,x,p){if(!v||!x)throw Error("Cannot construct image data without dimensions");if(l)try{return new ImageData(w,v,x)}catch(h){l=!1}v=g(v,x,p);v.data.set(w,0);return v};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/MeshTextureTransform":function(){define("../../chunks/tslib.es6 ../../core/Clonable ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),
function(b,a,c,d,f,n,k,g){a=class extends a.ClonableMixin(c.JSONSupport){constructor(q){super(q);this.offset=[0,0];this.rotation=0;this.scale=[1,1]}};b.__decorate([d.property({type:[Number],nonNullable:!0,json:{write:!0}})],a.prototype,"offset",void 0);b.__decorate([d.property({type:Number,nonNullable:!0,json:{write:!0}})],a.prototype,"rotation",void 0);b.__decorate([d.property({type:[Number],nonNullable:!0,json:{write:!0}})],a.prototype,"scale",void 0);return a=b.__decorate([g.subclass("esri.geometry.support.MeshTextureTransform")],
a)})},"esri/geometry/support/MeshMaterialMetallicRoughness":function(){define("../../chunks/tslib.es6 ../../Color ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ./MeshMaterial ./MeshTexture ./MeshTextureTransform".split(" "),function(b,a,c,d,f,n,k,g,q,e){var m;d=m=class extends g{constructor(l){super(l);this.emissiveTexture=this.emissiveColor=null;this.emissiveTextureTransform=
void 0;this.occlusionTexture=null;this.occlusionTextureTransform=void 0;this.roughness=this.metallic=1;this.metallicRoughnessTexture=null;this.metallicRoughnessTextureTransform=void 0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(l,w){const v=null!=l?l.get(this):null;if(v)return v;w=new m(this.clonePropertiesWithDeduplication(w));null!=l&&l.set(this,w);return w}getMemoryUsage(){let l=super.getMemoryUsage();l+=null!=this.emissiveColor?16:0;null!=this.emissiveTexture&&
(l+=this.emissiveTexture.memoryUsage);l+=null!=this.emissiveTextureTransform?20:0;null!=this.occlusionTexture&&(l+=this.occlusionTexture.memoryUsage);l+=null!=this.occlusionTextureTransform?20:0;null!=this.metallicRoughnessTexture&&(l+=this.metallicRoughnessTexture.memoryUsage);return l+=null!=this.metallicRoughnessTextureTransform?20:0}clonePropertiesWithDeduplication(l){return{...super.clonePropertiesWithDeduplication(l),emissiveColor:this.emissiveColor?.clone(),emissiveTexture:this.emissiveTexture?.cloneWithDeduplication(l),
emissiveTextureTransform:this.emissiveTextureTransform?.clone(),occlusionTexture:this.occlusionTexture?.cloneWithDeduplication(l),occlusionTextureTransform:this.occlusionTextureTransform?.clone(),metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:this.metallicRoughnessTexture?.cloneWithDeduplication(l),metallicRoughnessTextureTransform:this.metallicRoughnessTextureTransform?.clone()}}};b.__decorate([c.property({type:a,json:{write:!0}})],d.prototype,"emissiveColor",void 0);b.__decorate([c.property({type:q,
json:{write:!0}})],d.prototype,"emissiveTexture",void 0);b.__decorate([c.property({type:e,json:{write:!0}})],d.prototype,"emissiveTextureTransform",void 0);b.__decorate([c.property({type:q,json:{write:!0}})],d.prototype,"occlusionTexture",void 0);b.__decorate([c.property({type:e,json:{write:!0}})],d.prototype,"occlusionTextureTransform",void 0);b.__decorate([c.property({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],d.prototype,"metallic",void 0);b.__decorate([c.property({type:Number,
nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],d.prototype,"roughness",void 0);b.__decorate([c.property({type:q,json:{write:!0}})],d.prototype,"metallicRoughnessTexture",void 0);b.__decorate([c.property({type:e,json:{write:!0}})],d.prototype,"metallicRoughnessTextureTransform",void 0);return d=m=b.__decorate([k.subclass("esri.geometry.support.MeshMaterialMetallicRoughness")],d)})},"esri/geometry/support/MeshVertexAttributes":function(){define("exports ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass".split(" "),
function(b,a,c,d,f,n,k,g){function q(v,x,p,h){const {loggerTag:t,stride:r}=x;return 0!==v.length%r?(h.error(t,`Invalid array length, expected a multiple of ${r}`),new p([])):v}function e(v,x,p,h,t){if(!v)return v;if(v instanceof x)return q(v,h,x,t);for(const r of p)if(v instanceof r)return q(new x(v),h,x,t);if(Array.isArray(v))return q(new x(v),h,x,t);p=p.map(r=>`'${r.name}'`);t.error(`Failed to set property, expected one of ${p}, but got ${v.constructor.name}`);return new x([])}function m(v,x,p){const h=
Array(v.length);for(let t=0;t<v.length;t++)h[t]=v[t];x[p]=h}var l;const w=f.getLogger("esri.geometry.support.MeshVertexAttributes");b.MeshVertexAttributes=l=class extends c.JSONSupport{constructor(v){super(v);this.color=null;this.position=new Float64Array(0);this.tangent=this.normal=this.uv=null}castColor(v){return e(v,Uint8Array,[Uint8ClampedArray],{loggerTag:".color\x3d",stride:4},w)}castPosition(v){v&&v instanceof Float32Array&&w.warn(".position\x3d","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array");
return e(v,Float64Array,[Float32Array],{loggerTag:".position\x3d",stride:3},w)}castUv(v){return e(v,Float32Array,[Float64Array],{loggerTag:".uv\x3d",stride:2},w)}castNormal(v){return e(v,Float32Array,[Float64Array],{loggerTag:".normal\x3d",stride:3},w)}castTangent(v){return e(v,Float32Array,[Float64Array],{loggerTag:".tangent\x3d",stride:4},w)}clone(){const v={position:d.clone(this.position),uv:d.clone(this.uv),normal:d.clone(this.normal),tangent:d.clone(this.tangent),color:d.clone(this.color)};return new l(v)}clonePositional(){const v=
{position:d.clone(this.position),normal:d.clone(this.normal),tangent:d.clone(this.tangent),uv:this.uv,color:this.color};return new l(v)}get memoryUsage(){let v;v=0+this.position.byteLength;null!=this.uv&&(v+=this.uv.byteLength);null!=this.normal&&(v+=this.normal.byteLength);null!=this.tangent&&(v+=this.tangent.byteLength);null!=this.color&&(v+=this.color.byteLength);return v}};a.__decorate([n.property({json:{write:m}})],b.MeshVertexAttributes.prototype,"color",void 0);a.__decorate([k.cast("color")],
b.MeshVertexAttributes.prototype,"castColor",null);a.__decorate([n.property({nonNullable:!0,json:{write:m}})],b.MeshVertexAttributes.prototype,"position",void 0);a.__decorate([k.cast("position")],b.MeshVertexAttributes.prototype,"castPosition",null);a.__decorate([n.property({json:{write:m}})],b.MeshVertexAttributes.prototype,"uv",void 0);a.__decorate([k.cast("uv")],b.MeshVertexAttributes.prototype,"castUv",null);a.__decorate([n.property({json:{write:m}})],b.MeshVertexAttributes.prototype,"normal",
void 0);a.__decorate([k.cast("normal")],b.MeshVertexAttributes.prototype,"castNormal",null);a.__decorate([n.property({json:{write:m}})],b.MeshVertexAttributes.prototype,"tangent",void 0);a.__decorate([k.cast("tangent")],b.MeshVertexAttributes.prototype,"castTangent",null);b.MeshVertexAttributes=l=a.__decorate([g.subclass("esri.geometry.support.MeshVertexAttributes")],b.MeshVertexAttributes);b.castArray=e;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshUtils/georeference":function(){define("exports ../../../core/unitUtils ../../../chunks/mat3f64 ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/mat3 ../../projection ../../spatialReferenceEllipsoidUtils ../../projection/computeTranslationToOriginAndRotation ../../projection/projectBuffer ../DoubleArray ../MeshGeoreferencedRelativeVertexSpace ../MeshGeoreferencedVertexSpace ../MeshLocalVertexSpace ../MeshTransform ../../../chunks/vec32 ./geographicUtils ./projection".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u){function y(G,O,P){if(r.isGeographicMesh(O.spatialReference,P)){var J=O.spatialReference,R=B(O,P,F),X=new Float64Array(G.position.length);O=G.position;var U=J;var M=X;t.transformMat4(M,O,R);O=new Float64Array(O.length);U=u.projectFromPCPF(M,O,U);R=g.normalFromMat4(L,R);M=X;O=G.normal;P=R;var V=J;if(null==O)M=null;else{var Y=new Float32Array(O.length);t.transformMat3(Y,O,P);u.projectNormalFromPCPF(Y,U,M,V,Y);M=Y}G=G.tangent;if(null==G)G=null;else{O=
new Float32Array(G.length);t.transformMat3(O,G,R,4);for(R=3;R<O.length;R+=4)O[R]=G[R];u.projectTangentFromPCPF(O,U,X,J,O);G=O}G={position:U,normal:M,tangent:G}}else{J=new Float64Array(G.position.length);U=G.position;X=O.x;R=O.y;M=O.z??0;O=D(P?P.unit:null,O.spatialReference);for(P=0;P<U.length;P+=3)J[P]=U[P]*O+X,J[P+1]=U[P+1]*O+R,J[P+2]=U[P+2]*O+M;G={position:J,normal:G.normal,tangent:G.tangent}}return G}function z(G,O=f.IDENTITY){const {position:P,normal:J,tangent:R}=G;G=t.transformMat4(new Float64Array(P.length),
P,O);const X=null!=J?u.transformNormal(J,new Float32Array(J.length),O):null;O=null!=R?u.transformTangent(R,new Float32Array(R.length),O):null;return{position:G,normal:X,tangent:O}}function A(G,O,P,J){const {position:R,normal:X,tangent:U}=G;if(!O.isRelative)return{position:R,normal:X,tangent:U};G=z(G,P?.localMatrix);return y(G,O.getOriginPoint(J),{geographic:!O.isGeoreferenced})}function C(G,O,P){if(r.isGeographicMesh(O.spatialReference,P)){const U=O.spatialReference;B(O,P,F);var J=d.invert(K,F);O=
new Float64Array(G.position.length);P=J;var R=u.projectToPCPF(G.position,U,O),X=new Float64Array(R.length);t.transformMat4(X,R,P);P=X;J=g.normalFromMat4(L,J);X=G.normal;R=J;null==X?R=null:(X=u.projectNormalToPCPF(X,G.position,O,U,new Float32Array(X.length)),t.transformMat3(X,X,R),R=X);X=G.tangent;null==X?G=null:(G=u.projectTangentToPCPF(X,G.position,O,U,new Float32Array(X.length)),t.transformMat3(G,G,J,4));G={position:P,normal:R,tangent:G}}else G=E(G,O,P);return G}function E(G,O,P){const J=new Float64Array(G.position.length),
R=G.position,X=O.x,U=O.y,M=O.z??0;O=D(P?P.unit:null,O.spatialReference);for(P=0;P<R.length;P+=3)J[P]=(R[P]-X)/O,J[P+1]=(R[P+1]-U)/O,J[P+2]=(R[P+2]-M)/O;return{position:J,normal:G.normal,tangent:G.tangent}}function B(G,O,P){m.computeTranslationToOriginAndRotation(G.spatialReference,[G.x,G.y,G.z??0],P,e.getSphericalPCPF(G.spatialReference));G=D(O?O.unit:null,G.spatialReference);d.scale(P,P,[G,G,G]);return P}function D(G,O){if(null==G)return 1;O=a.getMetersPerCartesianUnitForSR(O);return 1/a.convertUnit(O,
"meters",G)}const F=f.create(),K=f.create(),L=c.create();b.applyTransform=z;b.georeference=y;b.georeferenceApplyTransform=A;b.georeferenceByTransform=function(G,O,P){if(P?.useTransform){const {position:J,normal:R,tangent:X}=G,{x:U,y:M,z:V}=O;G=k.fromValues(U,M,V??0);return{vertexAttributes:{position:J,normal:R,tangent:X},vertexSpace:P.geographic??!0?new p({origin:G}):new v({origin:G}),transform:new h}}return{vertexAttributes:y(G,O,P),vertexSpace:new x,transform:null}};b.project=function({positions:G,
transform:O,vertexSpace:P,inSpatialReference:J,outSpatialReference:R,outPositions:X,localMode:U}){const M=P.isRelative?P.origin:k.ZEROS;O=P.isRelative?O?.localMatrix??f.IDENTITY:f.IDENTITY;if(P.isGeoreferenced){X=X??w.newDoubleArray(G.length);d.equals(O,f.IDENTITY)?w.copyInto(X,G):t.transformMat4(X,G,O);if(!n.exactEquals(M,k.ZEROS)){const [Y,W,H]=M;for(G=0;G<X.length;G+=3)X[G]+=Y,X[G+1]+=W,X[G+2]+=H}l.projectBuffer(X,J,0,X,R,0,X.length/3);return X}P=J;const V=e.getSphericalPCPF(J);P=R.isWebMercator&&
U||!q.canProjectWithoutEngine(J,V)?P:V;m.computeTranslationToOriginAndRotation(J,M,F,P);d.multiply(F,F,O);J=X??w.newDoubleArray(G.length);t.transformMat4(J,G,F);l.projectBuffer(J,P,0,J,R,0,J.length/3);return J};b.ungeoreference=C;b.ungeoreferenceByTransform=function(G,O,P,J,R){if(!O.isRelative)return C(G,J,R);const {spatialReference:X}=J;G=A(G,O,P,X);return J.equals(O.getOriginPoint(X))?E(G,J,R):C(G,J,R)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/MeshGeoreferencedVertexSpace":function(){define("../../chunks/tslib.es6 ../../core/Clonable ../../core/JSONSupport ../../core/Logger ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/Error ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass".split(" "),
function(b,a,c,d,f,n,k,g,q,e){a=class extends a.ClonableMixin(c.JSONSupport){constructor(){super({});this.type="georeferenced";this.isRelative=!1;this.isGeoreferenced=!0}};b.__decorate([q.enumeration({georeferenced:"georeferenced"},{readOnly:!0})],a.prototype,"type",void 0);return a=b.__decorate([e.subclass("esri.geometry.support.MeshGeoreferencedVertexSpace")],a)})},"esri/geometry/support/MeshLocalVertexSpace":function(){define("../../chunks/tslib.es6 ../../core/Clonable ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass ../../chunks/vec3f64 ../Point".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m){a=class extends a.ClonableMixin(c.JSONSupport){constructor(l){super(l);this.type="local";this.isRelative=!0;this.isGeoreferenced=!1;this.origin=e.create()}getOriginPoint(l){const [w,v,x]=this.origin;return new m({x:w,y:v,z:x,spatialReference:l})}setOriginFromPoint({x:l,y:w,z:v}){this.origin=e.fromValues(l,w,v??0)}};b.__decorate([g.enumeration({local:"local"},{readOnly:!0})],a.prototype,"type",void 0);b.__decorate([d.property({type:[Number],nonNullable:!0,json:{write:!0}})],
a.prototype,"origin",void 0);return a=b.__decorate([q.subclass("esri.geometry.support.MeshLocalVertexSpace")],a)})},"esri/geometry/support/MeshTransform":function(){define("../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../chunks/mat4 ../../chunks/mat4f64 ../../chunks/quat ../../chunks/quatf64 ../../chunks/vec3 ../../chunks/vec3f64 ./axisAngleDegrees".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v){var x;a=x=class extends a.JSONSupport{constructor(h){super(h);this.translation=w.create();this.rotationAxis=w.fromArray(v.up);this.rotationAngle=0;this.scale=w.fromValues(1,1,1)}get rotation(){return v.fromAxisAndAngle(this.rotationAxis,this.rotationAngle)}set rotation(h){this.rotationAxis=w.clone(v.axis(h));this.rotationAngle=v.angle(h)}get localMatrix(){const h=q.create();e.setAxisAngle(p,v.axis(this.rotation),v.angleRad(this.rotation));g.fromRotationTranslationScale(h,
p,this.translation,this.scale);return h}get localMatrixInverse(){return g.invert(q.create(),this.localMatrix)}applyLocal(h,t){return l.transformMat4(t,h,this.localMatrix)}applyLocalInverse(h,t){return l.transformMat4(t,h,this.localMatrixInverse)}equals(h){return this===h||null!=h&&g.exactEquals(this.localMatrix,h.localMatrix)}clone(){const h={translation:w.clone(this.translation),rotationAxis:w.clone(this.rotationAxis),rotationAngle:this.rotationAngle,scale:w.clone(this.scale)};return new x(h)}};
b.__decorate([c.property({type:[Number],nonNullable:!0,json:{write:!0}})],a.prototype,"translation",void 0);b.__decorate([c.property({type:[Number],nonNullable:!0,json:{write:!0}})],a.prototype,"rotationAxis",void 0);b.__decorate([c.property({type:Number,nonNullable:!0,json:{write:!0}})],a.prototype,"rotationAngle",void 0);b.__decorate([c.property({type:[Number],nonNullable:!0,json:{write:!0}})],a.prototype,"scale",void 0);b.__decorate([c.property()],a.prototype,"rotation",null);b.__decorate([c.property()],
a.prototype,"localMatrix",null);b.__decorate([c.property()],a.prototype,"localMatrixInverse",null);a=x=b.__decorate([k.subclass("esri.geometry.support.MeshTransform")],a);const p=m.create();return a})},"esri/geometry/support/meshUtils/geographicUtils":function(){define(["exports","../../../core/Logger"],function(b,a){b.isGeographicMesh=function(c,d){return c.isGeographic||c.isWebMercator&&(d?.geographic??!0)};b.validateGeographicFlag=function(c,d,f){const n=!c.isGeoreferenced;null!=f?.geographic&&
f.geographic!==n&&a.getLogger(d).warnOnce(`Specifying the 'geographic' parameter (${f.geographic}) for a Mesh vertex space of type "${c.type}" is not supported. This parameter will be ignored.`)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshUtils/projection":function(){define("exports ../../../core/Logger ../../../chunks/mat3 ../../../chunks/mat3f64 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../spatialReferenceEllipsoidUtils ../../projection/computeTranslationToOriginAndRotation ../../projection/projectBuffer ../spatialReferenceUtils ../webMercatorUtils ../buffer/BufferView ../../../chunks/vec32".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v){function x(C,E,B,D,F,K){if(E){var L=B.count,G=g.getSphericalPCPF(F);if(h(F))for(B=0;B<L;B++)D.getVec(B,u),E.getVec(B,y),q.computeTranslationToOriginAndRotation(G,u,z,G),c.fromMat4(A,z),C===r.FROM_PCPF&&c.transpose(A,A),n.transformMat3(y,y,A),K.setVec(B,y);else for(F=0;F<L;F++){D.getVec(F,u);E.getVec(F,y);q.computeTranslationToOriginAndRotation(G,u,z,G);c.fromMat4(A,z);var O=l.y2lat(B.get(F,1));O=Math.cos(O);C===r.TO_PCPF&&(O=1/O);A[0]*=O;A[1]*=O;A[2]*=O;A[3]*=
O;A[4]*=O;A[5]*=O;C===r.FROM_PCPF&&c.transpose(A,A);n.transformMat3(y,y,A);n.normalize(y,y);K.setVec(F,y)}return K}}function p(C){return h(C)||C.isWebMercator}function h(C){return C.isWGS84||m.isCGCS2000(C)||m.isMars(C)||m.isMoon(C)}const t=a.getLogger("esri.geometry.support.meshUtils.normalProjection");var r;(function(C){C[C.TO_PCPF=0]="TO_PCPF";C[C.FROM_PCPF=1]="FROM_PCPF"})(r||(r={}));const u=k.create(),y=k.create(),z=f.create(),A=d.create();b.projectFromPCPF=function(C,E,B){e.projectBuffer(C,
g.getSphericalPCPF(B),0,E,B,0,C.length/3);return E};b.projectNormalFromPCPF=function(C,E,B,D,F){if(!p(D))return t.error("Cannot convert to spatial reference from PCPF"),F;x(r.FROM_PCPF,w.BufferViewVec3f.fromTypedArray(C),w.BufferViewVec3f64.fromTypedArray(E),w.BufferViewVec3f64.fromTypedArray(B),D,w.BufferViewVec3f.fromTypedArray(F));return F};b.projectNormalToPCPF=function(C,E,B,D,F){if(!p(D))return t.error("Cannot convert spatial reference to PCPF"),F;x(r.TO_PCPF,w.BufferViewVec3f.fromTypedArray(C),
w.BufferViewVec3f64.fromTypedArray(E),w.BufferViewVec3f64.fromTypedArray(B),D,w.BufferViewVec3f.fromTypedArray(F));return F};b.projectTangentFromPCPF=function(C,E,B,D,F){if(!p(D))return t.error("Cannot convert to spatial reference from PCPF"),F;x(r.FROM_PCPF,w.BufferViewVec3f.fromTypedArray(C,16),w.BufferViewVec3f64.fromTypedArray(E),w.BufferViewVec3f64.fromTypedArray(B),D,w.BufferViewVec3f.fromTypedArray(F,16));for(E=3;E<C.length;E+=4)F[E]=C[E];return F};b.projectTangentToPCPF=function(C,E,B,D,F){if(!p(D))return t.error("Cannot convert spatial reference to PCPF"),
F;x(r.TO_PCPF,w.BufferViewVec3f.fromTypedArray(C,4*Float32Array.BYTES_PER_ELEMENT),w.BufferViewVec3f64.fromTypedArray(E),w.BufferViewVec3f64.fromTypedArray(B),D,w.BufferViewVec3f.fromTypedArray(F,4*Float32Array.BYTES_PER_ELEMENT));for(E=3;E<C.length;E+=4)F[E]=C[E];return F};b.projectToPCPF=function(C,E,B){e.projectBuffer(C,E,0,B,g.getSphericalPCPF(E),0,C.length/3);return B};b.transformNormal=function(C,E,B){c.normalFromMat4(A,B);v.transformMat3(E,C,A);c.isOrthoNormal(A)||v.normalize(E,E);return E};
b.transformTangent=function(C,E,B){c.normalFromMat4(A,B);v.transformMat3(E,C,A,4);c.isOrthoNormal(A)||v.normalize(E,E,4);if(C!==E)for(B=3;B<C.length;B+=4)E[B]=C[B];return E};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/sources/interfaces":function(){define(["exports"],function(b){b.MeshTransformUpdateAction=void 0;var a=b.MeshTransformUpdateAction||(b.MeshTransformUpdateAction={});a[a.EnableFastUpdates=0]="EnableFastUpdates";a[a.DisableFastUpdates=1]="DisableFastUpdates";
a[a.UpdateFastLocalOrigin=2]="UpdateFastLocalOrigin";Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/internal/resourceUtils":function(){define(["exports","../../../../core/has","../../webgl-engine/lib/basicInterfaces"],function(b,a,c){class d{constructor(f){this.data=f;this.type="encoded-mesh-texture";this.encoding=c.TextureEncodingMimeType.KTX2_ENCODING}}b.EncodedMeshTexture=d;b.imageFromBinaryData=async function(f,n){if(n===c.TextureEncodingMimeType.KTX2_ENCODING)return new d(f);
f=new Blob([f],{type:n});const k=URL.createObjectURL(f),g=new Image;if(a("esri-iPhone"))return new Promise((q,e)=>{const m=()=>{w();q(g)},l=v=>{w();e(v)},w=()=>{URL.revokeObjectURL(k);g.removeEventListener("load",m);g.removeEventListener("error",l)};g.addEventListener("load",m);g.addEventListener("error",l);g.src=k});try{g.src=k,await g.decode()}catch(q){console.warn("Failed decoding HTMLImageElement")}URL.revokeObjectURL(k);return g};b.isEncodedMeshTexture=function(f){return"encoded-mesh-texture"===
f?.type};b.jsonFromBinaryData=async function(f){f=await (new Blob([f])).text();return JSON.parse(f)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/internal/TextureTransformUtils":function(){define(["exports","../../../../chunks/mat3f32","../../../../chunks/vec2f32","../../../../chunks/mat3"],function(b,a,c,d){b.getTransformMatrix=function(f){if(null==f)return null;var n=null!=f.offset?f.offset:c.ZEROS,k=null!=f.rotation?f.rotation:0;f=null!=f.scale?f.scale:c.ONES;
n=a.fromValues(1,0,0,0,1,0,n[0],n[1],1);k=a.fromValues(Math.cos(k),-Math.sin(k),0,Math.sin(k),Math.cos(k),0,0,0,1);f=a.fromValues(f[0],0,0,0,f[1],0,0,0,1);const g=a.create();d.multiply(g,k,f);d.multiply(g,n,g);return g};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DMeshObject3DGraphicLayer":function(){define("exports ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ./ElevationAligners ./elevationAlignmentUtils ./featureExpressionInfoUtils ./Graphics3DObject3DGraphicLayer".split(" "),
function(b,a,c,d,f,n,k,g,q){class e extends q.Graphics3DObject3DGraphicLayer{constructor(){super(...arguments);this._originalGeometries=[];this._fastTransformUpdatesEnabled=!1}get fastTransformUpdatesEnabled(){return this._fastTransformUpdatesEnabled}enableFastTransformUpdates(r,u){if(!this._fastTransformUpdatesEnabled){this._fastTransformUpdatesEnabled=!0;var {stageObject:y}=this,z=y.geometries.slice();y.removeAllGeometries();var A=a.getTranslation(m,y.transformation);u=u.getOrigin(A);for(const C of z)A=
r(C.material),A=C.instantiate({material:A}),A.localOrigin=u,y.addGeometry(A);this._originalGeometries=z}}disableFastTransformUpdates(r){if(this._fastTransformUpdatesEnabled){this._fastTransformUpdatesEnabled=!1;var {stageObject:u}=this,y=u.geometries.map(z=>r(z.material));u.removeAllGeometries();for(let z=0;z<this._originalGeometries.length;z++){const A=this._originalGeometries[z],C=y[z];C.setParameters({modelTransformation:null});C===A.material?u.addGeometry(A):u.addGeometry(A.instantiate({material:C}))}this._originalGeometries.length=
0}}updateFastLocalOrigin(r,u,y){if(this._fastTransformUpdatesEnabled){var {stageObject:z}=this;if(0!==z.geometries.length){var A=z.geometries[0].localOrigin,C=a.getTranslation(m,r),E=y.getOrigin(C);if(E!==A){var B=u?.localMatrix??c.IDENTITY;z.shaderTransformation=null;z.transformation=r;z.geometries.forEach(D=>{D.transformation=B;D.localOrigin=E})}}}}updateTransform(r,u,y){const {stageObject:z}=this,A=u?.localMatrix??c.IDENTITY;if(this._fastTransformUpdatesEnabled){var C=z.geometries[0].transformation;
u=a.multiply(l,z.transformation,C);r=a.multiply(w,r,A);C=a.multiply(x,r,a.invert(x,C));z.shaderTransformation=C;this._setFastMaterialTransformation({matA:u,matB:r})}else z.shaderTransformation=null,z.transformation=r,z.geometries.forEach(E=>{E.transformation=A});this._fastUpdateEdgeTransform()||this.resetEdgeObject(y)}alignWithElevation(r,u,y,z){if(this._fastTransformUpdatesEnabled){null!=y&&g.setContextFeature(this.elevationContext.featureExpressionInfoContext,y);var {stageObject:A}=this;if(A.geometries[0].material.parameters.modelTransformation){y=
a.multiply(l,A.transformation,A.geometries[0].transformation);var C=a.copy(v,A.effectiveTransformation);this.alignedSampledElevation=n.perObjectElevationAligner(this,this.elevationContext,r.spatialReference,(E,B)=>k.evaluateElevationInfoAtPoint(E,r,this.elevationContext,u,B),u,C);A.shaderTransformation=C;A=a.multiply(w,C,A.geometries[0].transformation);this._setFastMaterialTransformation({matA:y,matB:A});this._fastUpdateEdgeTransform()||this.resetEdgeObject(z)}}else super.alignWithElevation(r,u,y,
z)}_setFastMaterialTransformation({matA:r,matB:u}){const {stageObject:y}=this;if(0!==y.geometries.length){var z=a.fromTranslation(t,d.scale(m,y.geometries[0].localOrigin.vec3,-1));r=a.multiply(p,z,r);u=a.multiply(h,z,u);z=a.invert(p,r);u=a.multiply(h,u,z);for(const A of y.geometries)A.material.setParameters({modelTransformation:u})}}_fastUpdateEdgeTransform(){return this._stageLayer.stage.renderer.ensureEdgeView().fastUpdateObject3DEdgesTransform(this.stageObject)}}const m=f.create(),l=c.create(),
w=c.create(),v=c.create(),x=c.create(),p=c.create(),h=c.create(),t=c.create();b.Graphics3DMeshObject3DGraphicLayer=e;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/MeshFastUpdateProcessor":function(){define(["exports","../../webgl-engine/materials/DefaultMaterial"],function(b,a){class c{constructor(){this._fastTransformOriginalMaterials=new Map;this._fastTransformClonedMaterials=new Map;this._graphicReferenceCount=0}enable(f,n,k){f.enableFastTransformUpdates(g=>
{if(1>=this._graphicReferenceCount){if(this._fastTransformOriginalMaterials.has(g))return g;var q=n.byMaterial(g);this._fastTransformOriginalMaterials.set(g,q);n.delete(g);return g}q=new a.DefaultMaterial(g.parameters);k.stage.add(q);this._fastTransformClonedMaterials.set(q,g);return q},k.localOriginFactory)}disable(f,n,k){const g=new Set,q=new Set;f.disableFastTransformUpdates(e=>{if(!this._fastTransformClonedMaterials.has(e)){var m=this._fastTransformOriginalMaterials.get(e);if(n.has(m.uid))return g.add(e),
n.byUid(m.uid).material;q.add(e);return m.material}m=this._fastTransformClonedMaterials.get(e);this._fastTransformClonedMaterials.delete(e);k.stage.remove(e);return m});for(const e of g)this._fastTransformOriginalMaterials.delete(e),k.stage.remove(e);for(const e of q)f=this._fastTransformOriginalMaterials.get(e),this._fastTransformOriginalMaterials.delete(e),n.set(f.uid,f)}onAddGraphic(){this._graphicReferenceCount++}onRemoveGraphic(f,n,k){this._graphicReferenceCount--;this.disable(f,n,k)}forEachMaterialInfo(f){this._fastTransformOriginalMaterials.forEach(f)}forEachClonedMaterial(f){this._fastTransformClonedMaterials.forEach(f)}destroy(f){f.removeMany(Array.from(this._fastTransformClonedMaterials.keys()));
f.removeMany(Array.from(this._fastTransformOriginalMaterials.values(),({material:n})=>n));this._fastTransformClonedMaterials.clear();this._fastTransformOriginalMaterials.clear()}}class d{constructor(){this._byUid=new Map;this._byMaterial=new Map}get materials(){return Array.from(this._byUid.values(),f=>f.material)}byUid(f){return this._byUid.get(f)}byMaterial(f){return this._byMaterial.get(f)}set(f,n){this._byUid.set(f,n);this._byMaterial.set(n.material,n)}delete(f){const n=this._byMaterial.get(f)?.uid;
n&&(this._byUid.delete(n),this._byMaterial.delete(f))}has(f){return this._byUid.has(f)}forEachMaterialInfo(f){this._byUid.forEach(f)}clear(){this._byUid.clear();this._byMaterial.clear()}}b.MaterialInfoCache=d;b.MeshFastUpdateProcessor=c;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/NativeLineMaterial":function(){define("exports ../../../../core/Logger ../../../../core/mathUtils ../../../../core/screenUtils ../../../../chunks/vec2 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/support/frustum ../../../../geometry/support/lineSegment ../../../../geometry/support/plane ../core/shaderLibrary/ShaderOutput ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/Util ../lib/VertexAttribute ./DefaultBufferWriter ./DefaultLayouts ../shaders/NativeLineTechnique ../shaders/NativeLineTechniqueConfiguration".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y){class z extends v.Material{constructor(H){super(H,new C);this._configuration=new y.NativeLineTechniqueConfiguration}getConfiguration(H){this._configuration.output=H;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.hasVertexColors=this.parameters.hasVertexColors;this._configuration.transparent=1>this.parameters.color[3]||1>this.parameters.width;this._configuration.hasOccludees=this.parameters.hasOccludees;return this._configuration}intersect(H,
S,I,Q,N,T){if(I.options.selectionMode&&H.visible)if(p.isTranslationMatrix(S)){N=H.attributes.get(h.VertexAttribute.POSITION).data;var aa=I.camera,Z=R;f.copy(Z,I.point);n.set(X[0],Z[0]-2,Z[1]+2,0);n.set(X[1],Z[0]+2,Z[1]+2,0);n.set(X[2],Z[0]+2,Z[1]-2,0);n.set(X[3],Z[0]-2,Z[1]-2,0);for(H=0;4>H;H++)if(!aa.unprojectFromRenderScreen(X[H],U[H]))return;m.fromPoints(aa.eye,U[0],U[1],M);m.fromPoints(aa.eye,U[1],U[2],V);m.fromPoints(aa.eye,U[2],U[3],Y);m.fromPoints(aa.eye,U[3],U[0],W);Q=Number.MAX_VALUE;H=0;
for(let fa=0;fa<N.length-5;fa+=3)if(E[0]=N[fa]+S[12],E[1]=N[fa+1]+S[13],E[2]=N[fa+2]+S[14],B[0]=N[fa+3]+S[12],B[1]=N[fa+4]+S[13],B[2]=N[fa+5]+S[14],!(0>m.signedDistance(M,E)&&0>m.signedDistance(M,B)||0>m.signedDistance(V,E)&&0>m.signedDistance(V,B)||0>m.signedDistance(Y,E)&&0>m.signedDistance(Y,B)||0>m.signedDistance(W,E)&&0>m.signedDistance(W,B))){aa.projectToRenderScreen(E,K);aa.projectToRenderScreen(B,L);if(0>K[2]&&0<L[2]){n.subtract(D,E,B);var da=aa.frustum;da=-m.signedDistance(da[q.PlaneIndex.NEAR],
E)/n.dot(D,m.normal(da[q.PlaneIndex.NEAR]));n.scale(D,D,da);n.add(E,E,D);aa.projectToRenderScreen(E,K)}else if(0<K[2]&&0>L[2])n.subtract(D,B,E),da=aa.frustum,da=-m.signedDistance(da[q.PlaneIndex.NEAR],B)/n.dot(D,m.normal(da[q.PlaneIndex.NEAR])),n.scale(D,D,da),n.add(B,B,D),aa.projectToRenderScreen(B,L);else if(0>K[2]&&0>L[2])continue;K[2]=0;L[2]=0;da=e.distance2(e.fromPoints(K,L,P),Z);da<Q&&(Q=da,n.copy(G,E),n.copy(O,B),H=fa/3)}S=I.rayBegin;I=I.rayEnd;4>Q&&(Q=Number.MAX_VALUE,e.closestLineSegmentPoint(e.fromPoints(G,
O,P),e.fromPoints(S,I,J),F)&&(n.subtract(F,F,S),Q=n.length(F),n.scale(F,F,1/Q),Q/=n.distance(S,I)),T(Q,F,H,!1))}else a.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial").error("intersection assumes a translation-only matrix")}intersectDraped(H,S,I,Q,N,T){if(I.options.selectionMode){S=H.attributes.get(h.VertexAttribute.POSITION).data;var aa=H.attributes.get(h.VertexAttribute.SIZE);I=Q[0];Q=Q[1];H=(((aa?aa.data[0]:0)+1)/2+4)*H.screenToWorldRatio;aa=Number.MAX_VALUE;var Z=0;for(let ba=
0;ba<S.length-5;ba+=3){var da=S[ba],fa=S[ba+1],ka=I-da,ha=Q-fa;da=S[ba+3]-da;fa=S[ba+4]-fa;const ea=c.clamp((da*ka+fa*ha)/(da*da+fa*fa),0,1);ka=da*ea-ka;ha=fa*ea-ha;ha=ka*ka+ha*ha;ha<aa&&(aa=ha,Z=ba/3)}aa<H*H&&N(T.dist,T.normal,Z,!1)}}produces(H,S){return(S===l.ShaderOutput.Color||S===l.ShaderOutput.Highlight||S===l.ShaderOutput.ObjectAndLayerIdColor)&&(H===x.RenderSlot.OPAQUE_MATERIAL||H===x.RenderSlot.DRAPED_MATERIAL)}createGLMaterial(H){return new A(H)}createBufferWriter(){return new t.DefaultBufferWriter(this.parameters.hasVertexColors?
r.PositionColorLayout:r.PositionLayout)}}class A extends w{_updateOccludeeState(H){H.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:H.hasOccludees})}beginSlot(H){this._output===l.ShaderOutput.Color&&this._updateOccludeeState(H);return this.ensureTechnique(u.NativeLineTechnique,H)}}class C extends v.MaterialParameters{constructor(){super(...arguments);this.color=g.ONES;this.hasSlicePlane=this.hasVertexColors=!1;this.width=1;this.hasOccludees=!1}}const E=
k.create(),B=k.create(),D=k.create(),F=k.create(),K=d.createRenderScreenPointArray3(),L=d.createRenderScreenPointArray3(),G=k.create(),O=k.create(),P=e.create(),J=e.create(),R=k.create(),X=[d.createRenderScreenPointArray3(),d.createRenderScreenPointArray3(),d.createRenderScreenPointArray3(),d.createRenderScreenPointArray3()],U=[k.create(),k.create(),k.create(),k.create()],M=m.create(),V=m.create(),Y=m.create(),W=m.create();b.NativeLineMaterial=z;b.Parameters=C;Object.defineProperty(b,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/NativeLineTechnique":function(){define("require exports ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../lib/StencilUtils ../../../../chunks/NativeLine.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),function(b,a,c,d,f,n,k,g,q,e,m){class l extends f.ShaderTechnique{initializeProgram(w){return new k.Program(w.rctx,
l.shader.get().build(this.configuration),n.Default3D)}initializePipeline(){const w=this.configuration,v=m.separateBlendingParams(e.BlendFactor.SRC_ALPHA,e.BlendFactor.ONE,e.BlendFactor.ONE_MINUS_SRC_ALPHA,e.BlendFactor.ONE_MINUS_SRC_ALPHA),x=(p,h=null,t=null)=>m.makePipelineState({blending:h,depthTest:g.depthCompareLess,depthWrite:t,colorWrite:m.defaultColorWriteParams,stencilWrite:w.hasOccludees?g.stencilWriteMaskOn:null,stencilTest:w.hasOccludees?p?g.stencilToolMaskBaseParams:g.stencilBaseAllZerosParams:
null});return w.output===c.ShaderOutput.Color?(this._occludeePipelineState=x(!0,w.transparent?v:null,m.defaultDepthWriteParams),x(!1,w.transparent?v:null,m.defaultDepthWriteParams)):x(!1)}get primitiveType(){return e.PrimitiveType.LINES}getPipeline(w){return w?this._occludeePipelineState:super.getPipeline()}}l.shader=new d.ReloadableShaderModule(q.NativeLine,()=>new Promise((w,v)=>b(["./NativeLine.glsl"],w,v)));a.NativeLineTechnique=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/chunks/NativeLine.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w){function v(p){const h=new l.ShaderBuilder,{vertex:t,fragment:r}=h;h.include(d.Transform,p);h.include(f.VertexColor,p);g.addProjViewLocalOrigin(t,p);h.attributes.add(w.VertexAttribute.POSITION,"vec3");h.varyings.add("vpos","vec3");t.code.add(m.glsl`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);
}`);p.output===a.ShaderOutput.Highlight&&h.include(n.OutputHighlight,p);h.include(c.SliceDraw,p);r.uniforms.add(new e.FloatPassUniform("alphaCoverage",(u,y)=>Math.min(1,u.width*y.camera.pixelRatio)));p.hasVertexColors||r.uniforms.add(new q.Float4PassUniform("constantColor",u=>u.color));r.code.add(m.glsl`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${p.hasVertexColors?"vColor":"constantColor"};

    ${p.output===a.ShaderOutput.ObjectAndLayerIdColor?m.glsl`color.a = 1.0;`:""}

    if (color.a < ${m.glsl.float(k.symbolAlphaCutoff)}) {
      discard;
    }

    ${p.output===a.ShaderOutput.Color?m.glsl`fragColor = highlightSlice(color, vpos);`:""}
    ${p.output===a.ShaderOutput.Highlight?m.glsl`outputHighlight();`:""}
  }
  `);return h}const x=Object.freeze(Object.defineProperty({__proto__:null,build:v},Symbol.toStringTag,{value:"Module"}));b.NativeLine=x;b.build=v})},"esri/views/3d/webgl-engine/shaders/NativeLineTechniqueConfiguration":function(){define(["exports","../../../../chunks/tslib.es6","../core/shaderLibrary/ShaderOutput","../core/shaderTechnique/ShaderTechniqueConfiguration","../materials/DefaultTechniqueConfiguration"],function(b,a,c,d,f){class n extends f.DefaultTechniqueConfiguration{constructor(){super(...arguments);
this.output=c.ShaderOutput.Color;this.hasOccludees=this.transparent=this.hasVertexColors=this.hasSlicePlane=!1}}a.__decorate([d.parameter({count:c.ShaderOutput.COUNT})],n.prototype,"output",void 0);a.__decorate([d.parameter()],n.prototype,"hasSlicePlane",void 0);a.__decorate([d.parameter()],n.prototype,"hasVertexColors",void 0);a.__decorate([d.parameter()],n.prototype,"transparent",void 0);a.__decorate([d.parameter()],n.prototype,"hasOccludees",void 0);b.NativeLineTechniqueConfiguration=n;Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DObjectSymbolLayer":function(){define("exports ../../../../Color ../../../../core/has ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../core/typedArrayUtil ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/projection/computeTranslationToOriginAndRotation ../../../../geometry/projection/projectPointToVector ../../../../geometry/support/aaBoundingBox ../../../../symbols/support/ObjectSymbol3DLayerResource ../../../../symbols/support/symbolLayerUtils3D ./defaultSymbolComplexity ./ElevationAligners ./elevationAlignmentUtils ./Graphics3DLodInstanceGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./interfaces ./Loadable ./lodResourceUtils ./objectResourceUtils ./pointUtils ./primitiveObjectSymbolUtils ./SymbolComplexity ./webStyleUtils ../support/FastSymbolUpdates ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/lib/lodRendering/LodRenderer ../../webgl-engine/lib/lodRendering/LodResources ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/pbrUtils".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A,C,E,B,D,F,K,L,G,O,P,J,R,X,U){class M{constructor(Q,N,T,aa,Z,da,fa,ka,ha,ba,ea,ca){this.lodResources=Q;this.lodRenderer=N;this.stageResources=T;this.originalMaterialParameters=aa;this.resourceSize=Z;this.isEsriSymbolResource=da;this.isWosr=fa;this.resourceBoundingBox=ka;this.symbolSize=ha;this.extentPadding=ba;this.physicalBasedRenderingEnabled=ea;this.pivotOffset=ca}}class V extends y.Graphics3DSymbolLayer{getCachedSize(){const [Q,N,T]=null!=
this._resources?this._resources.symbolSize:[1,1,1];return{width:Q,depth:N,height:T}}constructor(Q,N,T,aa){super(Q,N,T,aa);this._resources=null;this._optionalFields=[];this._instanceIndexToGraphicUid=new Map;this._hasLoadedPBRTextures=!1;this._disposeResourceHandles=[];this.skipHighSymbolLodsChanged=!1;this.ensureDrapedStatus(!1);this._hasLoadedPBRTextures=T.physicalBasedRenderingEnabled}async doLoad(Q){if(!this._drivenProperties.size&&z.validateSymbolLayerSize(this.symbolLayer))throw Error();if(this._isPrimitive){var N=
this.symbolLayer.resource;N=N&&F.isValidPrimitive(N.primitive)?N.primitive:x.defaultPrimitive;this._resources=await this._createResourcesForPrimitive(N,Q)}else N=(await L.getResourceUrlFromSymbolStyle(this.symbol.styleOrigin))?.href??this.symbolLayer.resource.href,this._resources=await this._createResourcesForUrl(N,Q);this.layerOpacityChanged();this.slicePlaneEnabledChanged();this.physicalBasedRenderingChanged();this.complexity=this.computeComplexity()}get extentPadding(){return null!=this._resources?
this._resources.extentPadding:0}get _isPrimitive(){return!this.symbolLayer.resource?.href}get lodRenderer(){return this._resources?.lodRenderer}get materials(){return this._resources?.stageResources.materials??[]}_setMaterialTransparencyParameters(Q,N=this.symbolLayer?.material?.color){N=this._getCombinedOpacity(N);const T=1>N||this.needsDrivenTransparentPass;Q.transparent=T;Q.opacity=N;Q.cullFace=T?O.CullFaceOptions.None:O.CullFaceOptions.Back;return Q}async _createResourcesForPrimitive(Q,N){var T=
this.symbolLayer;const aa=v.create(p.objectSymbolLayerPrimitiveBoundingBox(Q)),Z=e.fromArray(v.size(aa)),da=e.fromArray(p.objectSymbolLayerSizeWithResourceSize(Z,T)),fa=q.length(da);var ka={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,mrrFactors:[...U.defaultSchematicMRRFactors],ambient:e.ONES,diffuse:e.ONES,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive};const ha=
!!ka.usePBR;this._setMaterialTransparencyParameters(ka);const ba=this.symbol;if("point-3d"===ba.type&&ba.verticalOffset){const {screenLength:ea,minWorldLength:ca,maxWorldLength:ia}=ba.verticalOffset;ka.verticalOffset={screenLength:f.pt2px(ea),minWorldLength:ca||0,maxWorldLength:null!=ia?ia:Infinity};ka.castShadows=!1}this._context.screenSizePerspectiveEnabled&&(ka.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);this._drivenProperties.color?ka.externalColor=m.ONES:
(T=null!=T.material?T.material.color:null,T=null!=T?a.toUnitRGBA(T):m.ONES,ka.externalColor=T);this._fastUpdates=G.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions(aa,da,Z,null));ka.isInstanced=!0;this._fastUpdates?(Object.assign(ka,this._fastUpdates.materialParameters),this._optionalFields.push(P.VertexAttribute.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(ka.hasInstancedColor=!0,this._optionalFields.push(P.VertexAttribute.COLOR));c("enable-feature:objectAndLayerId-rendering")&&
this._optionalFields.push(P.VertexAttribute.OBJECTANDLAYERIDCOLOR);ka=new X.DefaultMaterial(ka);ka=F.primitiveLodResources(Q,ka);if(!ka)throw Error(`Unknown object symbol primitive: ${Q}`);Q=R.materialsFromLodResources(ka).map(ea=>({opacity:1,transparent:ea.parameters.transparent}));T=await this._createStageResources(ka,ha,N);N=await this._createLodRenderer(ka,N);return new M(ka,N,T,Q,Z,!1,!1,aa,da,fa,ha,null)}async _createResourcesForUrl(Q,N){var T={materialParameters:{isInstanced:!0,hasSlicePlane:this._context.slicePlaneEnabled,
castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};(this._fastUpdates=G.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions(null,null,null,null)))?(Object.assign(T.materialParameters,this._fastUpdates.materialParameters),this._optionalFields.push(P.VertexAttribute.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(T.materialParameters.hasInstancedColor=!0,this._optionalFields.push(P.VertexAttribute.COLOR));
c("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(P.VertexAttribute.OBJECTANDLAYERIDCOLOR);var aa=this.symbol;if("point-3d"===aa.type&&aa.verticalOffset){const {screenLength:ta,minWorldLength:ma,maxWorldLength:pa}=aa.verticalOffset;T.materialParameters.verticalOffset={screenLength:f.pt2px(ta),minWorldLength:ma||0,maxWorldLength:null!=pa?pa:Infinity};T.materialParameters.castShadows=!1}aa=this._context.physicalBasedRenderingEnabled;T.signal=N;T.usePBR=aa;T.skipHighLods=this._context.skipHighSymbolLods;
var Z=await B.fetch(Q,T);Q=Z.isEsriSymbolResource;T=Z.isWosr;const da=E.makeLodResources(Z.lods),fa=this._context,ka=this._getExternalColorParameters(this.symbolLayer.material),ha=this._getCombinedOpacity(this.symbolLayer?.material?.color,{hasIntrinsicColor:!0}),ba=this.needsDrivenTransparentPass;var ea=R.materialsFromLodResources(da);const ca=R.materialsFromLodResources(da).map(ta=>({opacity:ta.parameters.opacity||1,transparent:ta.parameters.transparent}));ea.forEach(ta=>{const ma=ta.parameters;
ta.setParameters(ka);const pa=ma.opacity*ha;ta.setParameters({opacity:pa,transparent:1>pa||ba||ma.transparent});fa.screenSizePerspectiveEnabled&&ta.setParameters({screenSizePerspective:fa.sharedResources.screenSizePerspectiveSettings})});Z=Z.referenceBoundingBox;const ia=e.fromArray(v.size(Z)),la=e.fromArray(da.levels[0].pivotOffset),oa=e.fromArray(p.objectSymbolLayerSizeWithResourceSize(ia,this.symbolLayer)),na=q.length(oa),ra=this._fastUpdates;G.updateFastSymbolUpdatesState(ra,this._context.renderer,
this._fastVisualVariableConvertOptions(Z,oa,ia,la))&&ea.forEach(ta=>ta.setParameters(ra.materialParameters));ea=await this._createStageResources(da,aa,N);N=await this._createLodRenderer(da,N);return new M(da,N,ea,ca,ia,Q,T,Z,oa,na,aa,la)}_addDisposeResource(Q){this._disposeResourceHandles.push(Q)}async _createStageResources(Q,N,T){const aa=this._context.stage,Z=R.materialsFromLodResources(Q);N!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged();aa.addMany(Z);this._addDisposeResource(()=>
aa.removeMany(Z));const da=R.texturesFromLodResources(Q);aa.addMany(da);this._addDisposeResource(()=>{da.forEach(ka=>ka.unload());aa.removeMany(da)});await Promise.all(da.map(ka=>this._context.stage.schedule(()=>ka.load(aa.renderView.renderingContext),T)));d.throwIfAborted(T);const fa=R.geometriesFromLodResources(Q);aa.addMany(fa);this._addDisposeResource(()=>aa.removeMany(fa));return{materials:Z,textures:da,geometries:fa}}async _createLodRenderer(Q,N){const T=this._context.stage,aa=this._fastUpdates,
Z=new J.LodRenderer({symbol:Q,optionalFields:this._optionalFields,metadata:{layerUid:this._context.layer.uid,graphicUid:da=>this._instanceIndexToGraphicUid.get(da),notifyGraphicGeometryChanged:da=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(da)),notifyGraphicVisibilityChanged:da=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(da))},shaderTransformation:aa?{applyTransform:(da,fa,ka)=>{da.getFeatureAttribute(fa,S);k.copy(ka,G.evaluateModelTransform(aa.materialParameters,
S,ka))},scaleFactor:(da,fa,ka)=>{fa.getFeatureAttribute(ka,S);G.evaluateModelTransformScale(da,aa.materialParameters,S)}}:null},this._context.scheduler);Z.slicePlaneEnabled=this._context.slicePlaneEnabled;this._addDisposeResource(()=>{T.removeRenderPlugin(Z);Z.destroy()});await T.addRenderPlugin(Z,N);return Z}_getExternalColorParameters(Q){const N={};this._drivenProperties.color?N.externalColor=m.ONES:null!=Q?.color?N.externalColor=a.toUnitRGBA(Q.color):(N.externalColor=m.ONES,N.colorMixMode="ignore");
return N}destroy(){super.destroy();this._cleanupResources()}_cleanupResources(){this._disposeResourceHandles.forEach(Q=>Q());this._disposeResourceHandles.length=0;this._resources=null}createGraphics3DGraphic(Q){const N=Q.graphic;if(!this._validateGeometry(N.geometry))return null;const T=D.placePointOnGeometry(N.geometry);if(null==T)return this.logger.warn(`unsupported geometry type for icon symbol: ${N.geometry.type}`),null;const aa=this.setGraphicElevationContext(N);return this._createAs3DShape(N,
T,Q.renderingInfo,aa,N.uid,Q.layer.uid)}notifyDestroyGraphicLayer(Q){this._instanceIndexToGraphicUid.delete(Q.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){if(null!=this._resources){var Q=this._drivenProperties.opacity,N=!this._isPrimitive,T=this._resources.stageResources.materials,aa=this._resources.originalMaterialParameters;for(let da=0;da<T.length;da++){const fa=T[da];var Z=aa[da];const ka=this._getCombinedOpacity(this.symbolLayer?.material?.color,{hasIntrinsicColor:N})*
Z.opacity;Z=1>ka||Q||Z.transparent;fa.setParameters({opacity:ka,transparent:Z});this._isPrimitive&&fa.setParameters({cullFace:Z?O.CullFaceOptions.None:O.CullFaceOptions.Back})}}}layerElevationInfoChanged(Q,N){return this.updateGraphics3DGraphicElevationInfo(Q,N,r.needsElevationUpdates3D)}slicePlaneEnabledChanged(){if(null==this._resources)return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const Q of this._resources.stageResources.materials)Q.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});
return!0}physicalBasedRenderingChanged(){if(null==this._resources)return!0;const {stageResources:Q,isWosr:N}=this._resources;for(const T of Q.materials)this._isPrimitive?T.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):N||T.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return!1===this._hasLoadedPBRTextures&&!0===this._context.physicalBasedRenderingEnabled?(this._hasLoadedPBRTextures=!0,!1):!0}applyRendererDiff(Q,N){if(null==
this._resources)return A.ApplyRendererDiffResult.RecreateSymbol;const {stageResources:{materials:T},lodRenderer:aa,resourceBoundingBox:Z,symbolSize:da,resourceSize:fa,pivotOffset:ka}=this._resources;for(const ha in Q.diff)switch(ha){case "visualVariables":if(G.updateFastSymbolUpdatesState(this._fastUpdates,N,this._fastVisualVariableConvertOptions(Z,da,fa,ka))){for(const ba of T)ba.setParameters(this._fastUpdates.materialParameters);aa.notifyShaderTransformationChanged()}else return A.ApplyRendererDiffResult.RecreateSymbol;
break;default:return A.ApplyRendererDiffResult.RecreateSymbol}return A.ApplyRendererDiffResult.FastUpdate}computeComplexity(){if(null==this._resources)return super.computeComplexity();var Q=this._resources.lodResources;const N=h.estimateNumVerticesForLods(Q.levels),T=Z=>Array.from(Z.attributes.values()).reduce((da,fa)=>da+n.estimateSize(fa.data,fa.indices),0),aa=R.geometriesFromLodResources(Q).reduce((Z,da)=>Z+T(da),0);Q=R.texturesFromLodResources(Q).reduce((Z,da)=>Z+da.memoryEstimate,0)+aa;Q={...h.defaultSymbolLayerMemoryComplexity(this.symbol,
this.symbolLayer),resourceBytes:Q};return new K.SymbolComplexity({verticesPerFeature:N,memory:Q})}_hasLodRenderer(){return null!=this._resources}_createAs3DShape(Q,N,T,aa,Z,da){if(!this._hasLodRenderer()||null==this._resources)return null;Q=this.getFastUpdateAttrValues(Q);var fa=this._context.clippingExtent;w.projectPointToVector(N,Y,this._context.elevationProvider.spatialReference);if(null!=fa&&!v.containsPoint(fa,Y))return null;fa=this._requiresTerrainElevation(aa);const ka=this._computeGlobalTransform(N,
aa,H,I),ha=this._computeLocalTransform(this._resources,this.symbolLayer,T,W),ba=this._resources.lodRenderer.instanceData,ea=ba.addInstance();this._instanceIndexToGraphicUid.set(ea,Z);ba.setLocalTransform(ea,ha,!1);ba.setGlobalTransform(ea,ka);Q&&ba.setFeatureAttribute(ea,Q);null==this._fastUpdates&&this._hasPerInstanceColor()&&ba.setColor(ea,z.mixinColorAndOpacity(T.color,T.opacity,255));null!=this._context.stage.renderView.objectAndLayerIdRenderHelper&&ba.setObjectAndLayerIdColor(ea,this._context.stage.renderView.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor({graphicUid:Z,
layerUid:da}));T=new u.Graphics3DLodInstanceGraphicLayer(this,ea,t.perLodInstanceElevationAligner,aa);fa&&(T.alignedSampledElevation=I.sampledElevation);T.needsElevationUpdates=r.needsElevationUpdates3D(aa.mode);D.extendPointGraphicElevationContext(T,N,this._context.elevationProvider);return T}_computeGlobalTransform(Q,N,T,aa){r.evaluateElevationInfoAtPoint(Q,this._context.elevationProvider,N,this._context.renderCoordsHelper,aa);Y[0]=Q.x;Y[1]=Q.y;Y[2]=aa.z;l.computeTranslationToOriginAndRotation(Q.spatialReference,
Y,T,this._context.renderCoordsHelper.spatialReference);return T}_computeLocalTransform(Q,N,T,aa){k.identity(aa);this._applyObjectRotation(T,!1,aa);this._applyObjectRotation(N,!0,aa);this._applyObjectScale(Q,T,aa);this._applyAnchor(Q,N,aa);return aa}_applyObjectScale(Q,N,T){this._fastUpdates?.requiresShaderTransformation||(Q=z.computeObjectScale(this._drivenProperties.size&&N.size?N.size:Q.symbolSize,Q.symbolSize,Q.resourceSize,this._context.renderCoordsHelper.unitInMeters),1===Q[0]&&1===Q[1]&&1===
Q[2]||k.scale(T,T,Q))}prepareSymbolLayerPatch(Q){if("partial"===Q.diff.type){var N=Q.diff.diff;this._preparePatchTransform(Q,N);this._preparePatchColor(Q,N)}}updateGeometry(Q,N){if(null==this._resources)return!0;const T=N&&D.placePointOnGeometry(N);if(null==T)return!1;N=this.getGeometryElevationMode(N);if(Q.elevationContext.mode!==N)return!1;this._computeGlobalTransform(T,Q.elevationContext,H,I);this._requiresTerrainElevation(Q.elevationContext)&&(Q.alignedSampledElevation=I.sampledElevation);this._resources.lodRenderer.instanceData.setGlobalTransform(Q.instanceIndex,
H,!0);D.extendPointGraphicElevationContext(Q,T,this._context.elevationProvider);return!0}_preparePatchTransform(Q,N){if((N.heading||N.tilt||N.roll||N.width||N.height||N.depth||N.anchor||N.anchorPosition)&&null!=this._resources){var T=(ia,la,oa)=>(null!=ia&&"complete"===ia.type?ia.newValue:la)??oa,aa=T(N.heading,this.symbolLayer.heading,0),Z=T(N.tilt,this.symbolLayer.tilt,0),da=T(N.roll,this.symbolLayer.roll,0),fa=T(N.width,this.symbolLayer.width,void 0),ka=T(N.height,this.symbolLayer.height,void 0),
ha=T(N.depth,this.symbolLayer.depth,void 0),ba=T(N.anchor,this.symbolLayer.anchor,void 0);T=T(N.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete N.heading;delete N.tilt;delete N.roll;delete N.width;delete N.height;delete N.depth;delete N.anchor;delete N.anchorPosition;var ea={heading:aa,tilt:Z,roll:da,anchor:ba,anchorPosition:T},ca=this._resources;this.loadStatus===C.LoadStatus.LOADED&&Q.symbolLayerStatePatches.push(()=>{ca.symbolSize=e.fromArray(p.objectSymbolLayerSizeWithResourceSize(ca.resourceSize,
{width:fa,height:ka,depth:ha,isPrimitive:this.symbolLayer.isPrimitive}))});Q.graphics3DGraphicPatches.push((ia,la)=>{la=this._computeLocalTransform(ca,ea,la,W);ca.lodRenderer.instanceData.setLocalTransform(ia.instanceIndex,la,!0)})}}_preparePatchColor(Q,N){if(N.material&&"partial"===N.material.type&&(N=N.material.diff,N.color&&"complete"===N.color.type&&null!=N.color.newValue&&null!=N.color.oldValue)){var T=N.color.newValue,aa=null!=T?a.toUnitRGBA(T):m.ONES;delete N.color;var Z=this._resources;null!=
Z&&Q.graphics3DGraphicPatches.push(da=>{this._hasPerInstanceColor()?(Z.lodRenderer.instanceData.setColor(da.instanceIndex,aa),da=this._setMaterialTransparencyParameters({},T)):da=this._setMaterialTransparencyParameters({externalColor:aa},T);for(const fa of Z.stageResources.materials)fa.setParameters(da)})}}_requiresTerrainElevation(Q){return"absolute-height"!==Q.mode}_applyObjectRotation(Q,N,T){if(!this._fastUpdates?.requiresShaderTransformation||!N)return z.computeObjectRotation(Q.heading,Q.tilt,
Q.roll,T)}_computeAnchor(Q,N,T){const aa=e.create();switch(T.anchor){case "center":q.copy(aa,v.center(Q));q.negate(aa,aa);break;case "top":N=v.center(Q);q.set(aa,-N[0],-N[1],-Q[5]);break;case "bottom":N=v.center(Q);q.set(aa,-N[0],-N[1],-Q[2]);break;case "relative":N=v.center(Q);Q=v.size(Q);T=(T=T.anchorPosition)?e.fromValues(T.x,T.y,T.z):e.ZEROS;q.multiply(aa,Q,T);q.add(aa,aa,N);q.negate(aa,aa);break;default:null!=N?q.negate(aa,N):q.copy(aa,e.ZEROS)}return aa}_applyAnchor(Q,N,T){this._fastUpdates?.requiresShaderTransformation||
(Q=this._computeAnchor(Q.resourceBoundingBox,Q.pivotOffset,N))&&k.translate(T,T,Q)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(Q,N,T,aa){const Z=null!=Q?e.fromArray(v.size(Q)):e.ONES;Q=null!=Q?this._computeAnchor(Q,aa,this.symbolLayer):e.ZEROS;aa=this._context.renderCoordsHelper.unitInMeters;T=z.computeObjectScale(null!=N?N:void 0,N,T,aa);const da=e.fromValues(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||
0);return new G.ConvertOptions({size:!0,color:!0,rotation:!0,opacity:!1},Z,N??e.ONES,aa,Q,T,da)}}const Y=e.create(),W=g.create(),H=g.create(),S=m.create(),I=new r.SampleElevationInfo;b.Graphics3DObjectSymbolLayer=V;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DLodInstanceGraphicLayer":function(){define("exports ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ./elevationAlignmentUtils ./featureExpressionInfoUtils ./graphicUtils ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Object3DStateID".split(" "),
function(b,a,c,d,f,n,k,g,q,e){class m{constructor(h,t,r,u){this.graphics3DSymbolLayer=h;this.instanceIndex=t;this.elevationAligner=r;this.elevationContext=u;this.type="lod-instance";this._highlights=new Set;this.alignedSampledElevation=0;this.needsElevationUpdates=this.isElevationSource=!1}initialize(){}setVisibility(h){const t=this._lodRenderer.instanceData;h!==t.getVisible(this.instanceIndex)&&t.setVisible(this.instanceIndex,h)}destroy(){null!=this.instanceIndex&&(this._lodRenderer.instanceData.removeInstance(this.instanceIndex),
this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(h,t,r){this.elevationAligner&&(k.setContextFeature(this.elevationContext.featureExpressionInfoContext,r),r=this.elevationAligner(this,this.elevationContext,h.spatialReference,(u,y)=>n.evaluateElevationInfoAtPoint(u,h,this.elevationContext,t,y),t),null!=r&&(this.alignedSampledElevation=r))}getCenterObjectSpace(h=d.create()){this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,p);return c.transformMat4(h,
this._lodRenderer.baseBoundingSphere.center,p)}getBoundingBoxObjectSpace(h=f.create()){this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,p);const t=this._lodRenderer.baseBoundingBox;f.empty(h);for(let r=0;8>r;++r)c.set(w,0===(r&1)?t[0]:t[3],0===(r&2)?t[1]:t[4],0===(r&4)?t[2]:t[5]),c.transformMat4(w,w,p),f.expandWithVec3(h,w);return h}computeAttachmentOrigin(h){this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,p);h.render.origin[0]+=p[12];h.render.origin[1]+=
p[13];h.render.origin[2]+=p[14];h.render.num++}async getProjectedBoundingBox(h,t,r,u,y){y=this.getBoundingBoxObjectSpace(y);var z=x;const A=f.isPoint(y)?1:z.length;this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,p);for(var C=0;C<A;C++){const E=z[C];w[0]=y[E[0]];w[1]=y[E[1]];w[2]=y[E[2]];c.transformMat4(w,w,p);l[3*C]=w[0];l[3*C+1]=w[1];l[3*C+2]=w[2]}if(!h(l,0,A))return null;f.empty(y);h=null;this.calculateRelativeScreenBounds&&(h=this.calculateRelativeScreenBounds());for(z=0;z<
3*A;z+=3){for(C=0;3>C;C++)y[C]=Math.min(y[C],l[z+C]),y[C+3]=Math.max(y[C+3],l[z+C]);h&&r.push({location:l.slice(z,z+3),screenSpaceBoundingRect:h})}if(t&&(f.center(y,v),"absolute-height"!==this.elevationContext.mode)){let E;r=g.demResolutionForBoundingBox(y,t.service.spatialReference,t);try{E=await t.service.queryElevation(v[0],v[1],u,r,"ground")}catch(B){}null!=E&&f.offset(y,0,0,-this.alignedSampledElevation+E)}return y}addObjectState(h,t){h===q.Object3DState.Highlight&&(h=new e.Object3DStateID(h),
this._addHighlightId(h),t.addExternal(r=>{this._removeHighlightId(r)},h))}removeObjectState(h){this._highlights.forEach(t=>h.remove(t))}_addHighlightId(h){this._highlights.add(h);this._lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}_removeHighlightId(h){this._highlights.delete(h);this._lodRenderer.instanceData.setHighlight(this.instanceIndex,0<this._highlights.size)}get _lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}}const l=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0],w=d.create(),v=d.create(),x=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],p=a.create();b.Graphics3DLodInstanceGraphicLayer=m;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/lodResourceUtils":function(){define(["exports","../../webgl-engine/lib/lodRendering/LodResources"],function(b,a){function c(f,n){const k=f.stageResources.geometries.map(g=>new a.LodComponentResources(g,f.stageResources.textures));n=null==f.lodThreshold||0===
f.lodThreshold&&0<n?d(k):f.lodThreshold;return new a.LodLevelResources(k,n,f.pivotOffset)}function d(f){f=f.reduce((n,{geometry:k})=>n+k.indexCount/3,0);return Math.sqrt(20*f/Math.PI)}b.makeLodResources=function(f){return new a.LodResources(f.map((n,k)=>c(n,k)))};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/objectResourceUtils":function(){define("exports ../../../../core/devEnvironmentUtils ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/FloatArray ../../../../geometry/support/buffer/BufferView ../../../../chunks/vec32 ../../../../chunks/vec42 ../../../../chunks/vec22 ../../../../chunks/vec33 ../../../../chunks/vec43 ../../glTF/DefaultLoadingContext ../../glTF/loader ../../glTF/internal/indexUtils ../../glTF/internal/resourceUtils ../../glTF/internal/TextureTransformUtils ./ProcessedObjectResource ./wosrLoader ../../webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Texture ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/DefaultMaterial_COLOR_GAMMA ../../webgl-engine/materials/pbrUtils".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A,C,E,B,D,F,K,L,G,O){function P(U){const M=U.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return M?{fileType:"gltf",url:M[1],specifiedLodIndex:null!=M[4]?Number(M[4]):null}:U.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:U,specifiedLodIndex:null}:{fileType:"unknown",url:U,specifiedLodIndex:null}}function J(U,M,V,Y){const W=U.model,H=[],S=new Map,I=new Map,Q=W.lods.length,N=q.empty();W.lods.forEach((T,aa)=>{const Z=!0===Y.skipHighLods&&(1<
Q&&0===aa||3<Q&&1===aa)||!1===Y.skipHighLods&&null!=Y.singleLodIndex&&aa!==Y.singleLodIndex;if(!Z||0===aa){var da=new z.ProcessedObjectResource(T.name,T.lodThreshold,[0,0,0]);T.parts.forEach(fa=>{const ka=Z?new L.DefaultMaterial({}):R(W,fa,da,M,V,S,I);var ha=null!=ka?ka:new L.DefaultMaterial({});const ba=fa.attributes.position.count,ea=r.convertPrimitiveToTriangles(fa.indices||ba,fa.primitiveType);var ca=e.newFloatArray(3*ba);const {typedBuffer:ia,typedBufferStride:la}=fa.attributes.position;l.transformMat4(ca,
ia,fa.transform,3,la);ca=[[K.VertexAttribute.POSITION,new E.Attribute(ca,ea,3,!0)]];if(null!=fa.attributes.normal){var oa=e.newFloatArray(3*ba);const {typedBuffer:ta,typedBufferStride:ma}=fa.attributes.normal;c.normalFromMat4(X,fa.transform);l.transformMat3(oa,ta,X,3,ma);ca.push([K.VertexAttribute.NORMAL,new E.Attribute(oa,ea,3,!0)])}if(null!=fa.attributes.tangent){oa=e.newFloatArray(4*ba);const {typedBuffer:ta,typedBufferStride:ma}=fa.attributes.tangent;c.normalFromMat4(X,fa.transform);w.transformMat3(oa,
ta,X,4,ma);ca.push([K.VertexAttribute.TANGENT,new E.Attribute(oa,ea,4,!0)])}if(null!=fa.attributes.texCoord0){oa=e.newFloatArray(2*ba);const {typedBuffer:ta,typedBufferStride:ma}=fa.attributes.texCoord0;v.normalizeIntegerBuffer(oa,ta,2,ma);ca.push([K.VertexAttribute.UV0,new E.Attribute(oa,ea,2,!0)])}null!=fa.attributes.color&&(oa=new Uint8Array(4*ba),4===fa.attributes.color.elementCount?fa.attributes.color instanceof m.BufferViewVec4f?w.scale(oa,fa.attributes.color,255):fa.attributes.color instanceof
m.BufferViewVec4u8?p.copy(oa,fa.attributes.color):fa.attributes.color instanceof m.BufferViewVec4u16&&w.scale(oa,fa.attributes.color,1/256):(oa.fill(255),fa.attributes.color instanceof m.BufferViewVec3f?l.scale(oa,fa.attributes.color,255,4):fa.attributes.color instanceof m.BufferViewVec3u8?x.copy(oa,fa.attributes.color.typedBuffer,4,fa.attributes.color.typedBufferStride):fa.attributes.color instanceof m.BufferViewVec3u16&&l.scale(oa,fa.attributes.color,1/256,4)),ca.push([K.VertexAttribute.COLOR,new E.Attribute(oa,
ea,4,!0)]));fa={geometry:new D.Geometry(ha,ca),vertexCount:ba};const {geometry:na,vertexCount:ra}=fa;fa=na.boundingInfo;null!=fa&&0===aa&&(q.expandWithVec3(N,fa.bbMin),q.expandWithVec3(N,fa.bbMax));null!=ka&&(da.stageResources.geometries.push(na),da.numberOfVertices+=ra)});Z||H.push(da)}});return{engineResources:H,referenceBoundingBox:N}}function R(U,M,V,Y,W,H,S){const I=M.material+(M.attributes.normal?"_normal":"")+(M.attributes.color?"_color":"")+(M.attributes.texCoord0?"_texCoord0":"")+(M.attributes.tangent?
"_tangent":""),Q=U.materials.get(M.material);var N=null!=M.attributes.texCoord0;const T=null!=M.attributes.normal;if(null==Q)return null;a:{switch(Q.alphaMode){case "BLEND":var aa=B.AlphaDiscardMode.Blend;break a;case "MASK":aa=B.AlphaDiscardMode.Mask;break a;case "OPAQUE":case null:case void 0:aa=B.AlphaDiscardMode.Opaque;break a}aa=void 0}if(!H.has(I)){if(N){var Z=(ia,la=!1)=>{if(null!=ia&&!S.has(ia)){const oa=U.textures.get(ia);if(null!=oa){const na=oa.data;S.set(ia,new F.Texture(u.isEncodedMeshTexture(na)?
na.data:na,{...oa.parameters,preMultiplyAlpha:u.isEncodedMeshTexture(na)?!1:la,encoding:u.isEncodedMeshTexture(na)&&null!=na.encoding?na.encoding:void 0}))}}};Z(Q.textureColor,aa!==B.AlphaDiscardMode.Opaque);Z(Q.textureNormal);Z(Q.textureOcclusion);Z(Q.textureEmissive);Z(Q.textureMetallicRoughness)}Z=Q.color[0]**(1/G.colorGamma);const da=Q.color[1]**(1/G.colorGamma),fa=Q.color[2]**(1/G.colorGamma),ka=Q.emissiveFactor[0]**(1/G.colorGamma),ha=Q.emissiveFactor[1]**(1/G.colorGamma),ba=Q.emissiveFactor[2]**
(1/G.colorGamma),ea=null!=Q.textureColor&&N?S.get(Q.textureColor):null,ca=O.useSchematicPBR({normalTexture:Q.textureNormal,metallicRoughnessTexture:Q.textureMetallicRoughness,metallicFactor:Q.metallicFactor,roughnessFactor:Q.roughnessFactor,emissiveTexture:Q.textureEmissive,emissiveFactor:Q.emissiveFactor,occlusionTexture:Q.textureOcclusion});H.set(I,new L.DefaultMaterial({...Y,transparent:aa===B.AlphaDiscardMode.Blend,customDepthTest:B.DepthTestFunction.Lequal,textureAlphaMode:aa,textureAlphaCutoff:Q.alphaCutoff,
diffuse:[Z,da,fa],ambient:[Z,da,fa],opacity:Q.opacity,doubleSided:Q.doubleSided,doubleSidedType:"winding-order",cullFace:Q.doubleSided?B.CullFaceOptions.None:B.CullFaceOptions.Back,hasVertexColors:!!M.attributes.color,hasVertexTangents:!!M.attributes.tangent,normalType:T?C.NormalType.Attribute:C.NormalType.ScreenDerivative,castShadows:!0,textureId:null!=ea?ea.id:void 0,colorMixMode:Q.colorMixMode,normalTextureId:null!=Q.textureNormal&&N?S.get(Q.textureNormal).id:void 0,textureAlphaPremultiplied:null!=
ea&&!!ea.parameters.preMultiplyAlpha,occlusionTextureId:null!=Q.textureOcclusion&&N?S.get(Q.textureOcclusion).id:void 0,emissiveTextureId:null!=Q.textureEmissive&&N?S.get(Q.textureEmissive).id:void 0,metallicRoughnessTextureId:null!=Q.textureMetallicRoughness&&N?S.get(Q.textureMetallicRoughness).id:void 0,emissiveFactor:[ka,ha,ba],mrrFactors:ca?[...O.defaultSchematicMRRFactors]:[Q.metallicFactor,Q.roughnessFactor,Y.mrrFactors[2]],isSchematic:ca,colorTextureTransformMatrix:y.getTransformMatrix(Q.colorTextureTransform),
normalTextureTransformMatrix:y.getTransformMatrix(Q.normalTextureTransform),occlusionTextureTransformMatrix:y.getTransformMatrix(Q.occlusionTextureTransform),emissiveTextureTransformMatrix:y.getTransformMatrix(Q.emissiveTextureTransform),metallicRoughnessTextureTransformMatrix:y.getTransformMatrix(Q.metallicRoughnessTextureTransform),...W}))}M=H.get(I);V.stageResources.materials.push(M);N&&(N=da=>{null!=da&&V.stageResources.textures.push(S.get(da))},N(Q.textureColor),N(Q.textureNormal),N(Q.textureOcclusion),
N(Q.textureEmissive),N(Q.textureMetallicRoughness));return M}const X=d.create();b.fetch=async function(U,M){U=P(a.adjustStaticAGOUrl(U));if("wosr"===U.fileType){U=await (M.cache?M.cache.loadWOSR(U.url,M):A.load(U.url,M));const {engineResources:T,referenceBoundingBox:aa}=A.processLoadResult(U,M);return{lods:T,referenceBoundingBox:aa,isEsriSymbolResource:!1,isWosr:!0}}const V=await (M.cache?M.cache.loadGLTF(U.url,M,!!M.usePBR):t.loadGLTF(new h.DefaultLoadingContext(M.streamDataRequester),U.url,M,M.usePBR)),
Y=V.model.meta?.ESRI_proxyEllipsoid,W=V.meta.isEsriSymbolResource&&null!=Y&&V.meta.uri.includes("/RealisticTrees/");if(W&&!V.customMeta.esriTreeRendering){V.customMeta.esriTreeRendering=!0;a:for(let T=0;T<V.model.lods.length;++T){var H=V.model.lods[T];for(var S of H.parts){H=S.attributes.normal;if(null==H)break a;const aa=S.attributes.position,Z=aa.count,da=g.create(),fa=g.create(),ka=g.create(),ha=new Uint8Array(4*Z),ba=new Float64Array(3*Z),ea=f.invert(n.create(),S.transform);let ca=0,ia=0;for(let la=
0;la<Z;la++){aa.getVec(la,fa);H.getVec(la,da);k.transformMat4(fa,fa,S.transform);k.subtract(ka,fa,Y.center);k.divide(ka,ka,Y.radius);const oa=ka[2];var I=k.length(ka);I=Math.min(.45+.55*I*I,1);k.divide(ka,ka,Y.radius);null!==ea&&k.transformMat4(ka,ka,ea);k.normalize(ka,ka);T+1!==V.model.lods.length&&1<V.model.lods.length&&(-1<oa?k.lerp(ka,ka,da,.2):k.lerp(ka,ka,da,Math.min(-4*oa-3.8,1)));ba[ca]=ka[0];ba[ca+1]=ka[1];ba[ca+2]=ka[2];ca+=3;ha[ia]=255*I;ha[ia+1]=255*I;ha[ia+2]=255*I;ha[ia+3]=255;ia+=4}S.attributes.normal=
new m.BufferViewVec3f(ba);S.attributes.color=new m.BufferViewVec4u8(ha)}}}S=!!M.usePBR;S=V.meta.isEsriSymbolResource?{usePBR:S,isSchematic:!1,treeRendering:W,mrrFactors:[...O.defaultEsriSymbologyMRRFactors]}:{usePBR:S,isSchematic:!1,treeRendering:!1,mrrFactors:[...O.defaultAdvancedMRRFactors]};const {engineResources:Q,referenceBoundingBox:N}=J(V,S,{...M.materialParameters,treeRendering:W},M.skipHighLods&&null==U.specifiedLodIndex?{skipHighLods:!0}:{skipHighLods:!1,singleLodIndex:U.specifiedLodIndex});
return{lods:Q,referenceBoundingBox:N,isEsriSymbolResource:V.meta.isEsriSymbolResource,isWosr:!1}};b.gltfToEngineResources=J;b.parseUrl=P;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/core/devEnvironmentUtils":function(){define(["exports"],function(b){const a=/^devext.arcgis.com$/,c=/^qaext.arcgis.com$/,d=/^[\w-]*\.mapsdevext.arcgis.com$/,f=/^[\w-]*\.mapsqa.arcgis.com$/,n=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,a,c,/^jsapps.esri.com$/,d,f];b.adjustStaticAGOUrl=function(k,
g){return k?(g=g||globalThis.location.hostname)?null!=g.match(a)||null!=g.match(d)?k.replace("static.arcgis.com","staticdev.arcgis.com"):null!=g.match(c)||null!=g.match(f)?k.replace("static.arcgis.com","staticqa.arcgis.com"):k:k:k};b.devHostnames=n;b.isDevEnvironment=function(k){k=k||globalThis.location.hostname;return n.some(g=>null!=k?.match(g))};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/vec42":function(){define(["exports","../geometry/support/buffer/math/common"],
function(b,a){function c(e,m,l){if(e.count!==m.count)a.mathLogger.error("source and destination buffers need to have the same number of elements");else{var w=e.count,v=l[0],x=l[1],p=l[2],h=l[3],t=l[4],r=l[5],u=l[6],y=l[7],z=l[8],A=l[9],C=l[10],E=l[11],B=l[12],D=l[13],F=l[14];l=l[15];var K=e.typedBuffer;e=e.typedBufferStride;var L=m.typedBuffer;m=m.typedBufferStride;for(let O=0;O<w;O++){const P=O*e;var G=O*m;const J=L[G],R=L[G+1],X=L[G+2];G=L[G+3];K[P]=v*J+t*R+z*X+B*G;K[P+1]=x*J+r*R+A*X+D*G;K[P+2]=
p*J+u*R+C*X+F*G;K[P+3]=h*J+y*R+E*X+l*G}}}function d(e,m,l){f(e.typedBuffer,m.typedBuffer,l,e.typedBufferStride,m.typedBufferStride)}function f(e,m,l,w=4,v=w){if(e.length/w!==m.length/v)a.mathLogger.error("source and destination buffers need to have the same number of elements");else{var x=e.length/w,p=l[0],h=l[1],t=l[2],r=l[3],u=l[4],y=l[5],z=l[6],A=l[7];l=l[8];var C=0,E=0;for(let B=0;B<x;B++){const D=m[C],F=m[C+1],K=m[C+2],L=m[C+3];e[E]=p*D+r*F+z*K;e[E+1]=h*D+u*F+A*K;e[E+2]=t*D+y*F+l*K;e[E+3]=L;
C+=v;E+=w}}}function n(e,m){const l=Math.min(e.count,m.count),w=e.typedBuffer;e=e.typedBufferStride;const v=m.typedBuffer;m=m.typedBufferStride;for(let h=0;h<l;h++){const t=h*e;var x=h*m;const r=v[x],u=v[x+1];x=v[x+2];var p=r*r+u*u+x*x;0<p&&(p=1/Math.sqrt(p),w[t]=p*r,w[t+1]=p*u,w[t+2]=p*x)}}function k(e,m,l){g(e.typedBuffer,m,l,e.typedBufferStride)}function g(e,m,l,w=4){const v=Math.min(e.length/w,m.count),x=m.typedBuffer;m=m.typedBufferStride;let p=0,h=0;for(let t=0;t<v;t++)e[h]=l*x[p],e[h+1]=l*
x[p+1],e[h+2]=l*x[p+2],e[h+3]=l*x[p+3],p+=m,h+=w}const q=Object.freeze(Object.defineProperty({__proto__:null,normalize:n,scale:g,scaleView:k,transformMat3:f,transformMat3View:d,transformMat4:c},Symbol.toStringTag,{value:"Module"}));b.normalize=n;b.scale=g;b.scaleView=k;b.transformMat3=f;b.transformMat3View=d;b.transformMat4=c;b.vec4=q})},"esri/chunks/vec22":function(){define(["exports","../core/typedArrayUtil"],function(b,a){function c(k,g){d(k.typedBuffer,g.typedBuffer,k.typedBufferStride,g.typedBufferStride)}
function d(k,g,q=2,e=q){const m=g.length/2;let l=0,w=0;if(a.isArray(g)||a.isFloat(g))for(var v=0;v<m;++v)k[l]=g[w],k[l+1]=g[w+1],l+=q,w+=e;else if(v=a.maximumValue(g),a.isSigned(g))for(var x=0;x<m;++x)k[l]=Math.max(g[w]/v,-1),k[l+1]=Math.max(g[w+1]/v,-1),l+=q,w+=e;else for(x=0;x<m;++x)k[l]=g[w]/v,k[l+1]=g[w+1]/v,l+=q,w+=e}function f(k,g,q,e){const m=k.typedBuffer,l=k.typedBufferStride;k=e?.count??k.count;e=(e?.dstIndex??0)*l;for(let w=0;w<k;++w)m[e]=g,m[e+1]=q,e+=l}const n=Object.freeze(Object.defineProperty({__proto__:null,
fill:f,normalizeIntegerBuffer:d,normalizeIntegerBufferView:c},Symbol.toStringTag,{value:"Module"}));b.fill=f;b.normalizeIntegerBuffer=d;b.normalizeIntegerBufferView=c;b.vec2=n})},"esri/chunks/vec33":function(){define(["exports"],function(b){function a(n,k){c(n.typedBuffer,k.typedBuffer,n.typedBufferStride,k.typedBufferStride)}function c(n,k,g=3,q=g){const e=k.length/q;let m=0,l=0;for(let w=0;w<e;++w)n[m]=k[l],n[m+1]=k[l+1],n[m+2]=k[l+2],m+=g,l+=q}function d(n,k,g,q,e){const m=n.typedBuffer,l=n.typedBufferStride;
n=e?.count??n.count;e=(e?.dstIndex??0)*l;for(let w=0;w<n;++w)m[e]=k,m[e+1]=g,m[e+2]=q,e+=l}const f=Object.freeze(Object.defineProperty({__proto__:null,copy:c,copyView:a,fill:d},Symbol.toStringTag,{value:"Module"}));b.copy=c;b.copyView=a;b.fill=d;b.vec3=f})},"esri/chunks/vec43":function(){define(["exports"],function(b){function a(n,k){c(n.typedBuffer,k,n.typedBufferStride)}function c(n,k,g=4){const q=k.typedBuffer,e=k.typedBufferStride;k=k.count;let m=0,l=0;for(let w=0;w<k;++w)n[m]=q[l],n[m+1]=q[l+
1],n[m+2]=q[l+2],n[m+3]=q[l+3],m+=g,l+=e}function d(n,k,g,q,e,m){const l=n.typedBuffer,w=n.typedBufferStride;n=m?.count??n.count;m=(m?.dstIndex??0)*w;for(let v=0;v<n;++v)l[m]=k,l[m+1]=g,l[m+2]=q,l[m+3]=e,m+=w}const f=Object.freeze(Object.defineProperty({__proto__:null,copy:c,copyView:a,fill:d},Symbol.toStringTag,{value:"Module"}));b.copy=c;b.copyView=a;b.fill=d;b.vec4=f})},"esri/views/3d/glTF/DefaultLoadingContext":function(){define("exports ../../../request ../../../core/asyncUtils ../../../core/Error ../../../core/promiseUtils ../../../core/urlUtils".split(" "),
function(b,a,c,d,f,n){class k{constructor(q){this._streamDataRequester=q}async loadJSON(q,e){return this._load("json",q,e)}async loadBinary(q,e){return n.isDataProtocol(q)?(f.throwIfAborted(e),n.dataToArrayBuffer(q)):this._load("binary",q,e)}async loadImage(q,e){return this._load("image",q,e)}async _load(q,e,m){if(null==this._streamDataRequester)return(await a(e,{responseType:g[q]})).data;q=await c.result(this._streamDataRequester.request(e,q,m));if(!0===q.ok)return q.value;f.throwIfAbortError(q.error);
throw new d("",`Request for resource failed: ${q.error}`);}}const g={image:"image",binary:"array-buffer",json:"json","image+type":void 0};b.DefaultLoadingContext=k;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/loader":function(){define("exports ../../../core/Logger ../../../chunks/mat4f64 ./LoaderResult ./internal/Resource ../../webgl/enums".split(" "),function(b,a,c,d,f,n){function k(l){let w=null;l.json.nodes.forEach(v=>{v=v.extras;null!=v&&(v.ESRI_proxyEllipsoid||
v.ESRI_lod)&&(w=v)});return w}async function g(l,w){async function v(r,u){const y=x.nodes[r];r=l.getNodeTransform(r);null!=y.weights&&a.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Morph targets are not supported.");if(null!=y.mesh){const z=x.meshes[y.mesh];for(const A of z.primitives)t.push(w(A,r,u,z.name))}for(const z of y.children||[])t.push(v(z,u))}const x=l.json;var p=x.scenes[x.scene||0].nodes;const h=1<p.length,t=[];for(const r of p)p=x.nodes[r],t.push(v(r,0)),p.extensions?.MSFT_lod&&
Array.isArray(p.extensions.MSFT_lod.ids)&&!h&&p.extensions.MSFT_lod.ids.forEach((u,y)=>v(u,y+1));await Promise.all(t)}function q(l,w,v){const x=h=>{const t=`${v}_tex_${h&&h.id}${h?.name?"_"+h.name:""}`;h&&!l.textures.has(t)&&(h=d.makeTextureSource(h.data,{wrap:{s:h.wrapS,t:h.wrapT},mipmap:m.has(h.minFilter),noUnpackFlip:!0}),l.textures.set(t,h));return t},p=`${v}_mat_${w.id}_${w.name}`;l.materials.has(p)||(w=d.makeMaterialParameters({color:[w.color[0],w.color[1],w.color[2]],opacity:w.color[3],alphaMode:w.alphaMode,
alphaCutoff:w.alphaCutoff,doubleSided:w.doubleSided,colorMixMode:w.ESRI_externalColorMixMode,textureColor:w.colorTexture?x(w.colorTexture):void 0,textureNormal:w.normalTexture?x(w.normalTexture):void 0,textureOcclusion:w.occlusionTexture?x(w.occlusionTexture):void 0,textureEmissive:w.emissiveTexture?x(w.emissiveTexture):void 0,textureMetallicRoughness:w.metallicRoughnessTexture?x(w.metallicRoughnessTexture):void 0,emissiveFactor:[w.emissiveFactor[0],w.emissiveFactor[1],w.emissiveFactor[2]],colorTextureTransform:w.colorTextureTransform,
normalTextureTransform:w.normalTextureTransform,occlusionTextureTransform:w.occlusionTextureTransform,emissiveTextureTransform:w.emissiveTextureTransform,metallicRoughnessTextureTransform:w.metallicRoughnessTextureTransform,metallicFactor:w.metallicFactor,roughnessFactor:w.roughnessFactor}),l.materials.set(p,w));return p}let e=0;const m=new Set([n.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,n.TextureSamplingMode.LINEAR_MIPMAP_NEAREST]);b.loadGLTF=async function(l,w,v={},x=!0){const p=await f.GLTFResource.load(l,
w,v),h=`gltf_${e++}`,t={lods:[],materials:new Map,textures:new Map,meta:k(p)};l=!(!p.json.asset.extras||"symbolResource"!==p.json.asset.extras.ESRI_type);const r=new Map;await g(p,async(y,z,A,C)=>{const E=r.get(A)??0;r.set(A,E+1);var B=void 0!==y.mode?y.mode:n.PrimitiveType.TRIANGLES,D=B===n.PrimitiveType.TRIANGLES||B===n.PrimitiveType.TRIANGLE_STRIP||B===n.PrimitiveType.TRIANGLE_FAN?B:null;if(null==D)a.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Unsupported primitive mode ("+n.PrimitiveType[B]+
"). Skipping primitive.");else if(p.hasPositions(y)){B=p.getPositionData(y,v);var F=p.getMaterial(y,v,x),K=p.hasNormals(y)?p.getNormalData(y,v):null,L=p.hasTangents(y)?p.getTangentData(y,v):null,G=p.hasTextureCoordinates(y)?p.getTextureCoordinates(y,v):null,O=p.hasVertexColors(y)?p.getVertexColors(y,v):null;y=p.getIndexData(y,v);z={name:C,transform:c.clone(z),attributes:{position:await B,normal:K?await K:null,texCoord0:G?await G:null,color:O?await O:null,tangent:L?await L:null},indices:await y,primitiveType:D,
material:q(t,await F,h)};D=null;null!=t.meta?.ESRI_lod&&"screenSpaceRadius"===t.meta.ESRI_lod.metric&&(D=t.meta.ESRI_lod.thresholds[A]);t.lods[A]=t.lods[A]||{parts:[],name:C,lodThreshold:D};t.lods[A].parts[E]=z}else a.getLogger("esri.views.3d.glTF").warn("Skipping primitive without POSITION vertex attribute.")});for(var u of t.lods)u.parts=u.parts.filter(y=>!!y);u=await p.getLoadedBuffersSize();return{model:t,meta:{isEsriSymbolResource:l,uri:p.uri},customMeta:{},size:u}};Object.defineProperty(b,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/glTF/LoaderResult":function(){define(["exports","../../webgl/enums"],function(b,a){b.makeMaterialParameters=function(c={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,colorTextureTransform:null,normalTextureTransform:null,occlusionTextureTransform:null,emissiveTextureTransform:null,
metallicRoughnessTextureTransform:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...c}};b.makeTextureSource=function(c,d={}){return{data:c,parameters:{wrap:{s:a.TextureWrapMode.REPEAT,t:a.TextureWrapMode.REPEAT,...d.wrap},noUnpackFlip:!0,mipmap:!1,...d}}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/internal/Resource":function(){define("exports ../../../../core/Error ../../../../core/Logger ../../../../core/MapUtils ../../../../core/promiseUtils ../../../../core/urlUtils ../../../../core/Version ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/quat ../../../../chunks/quatf64 ../../../../geometry/support/buffer/BufferView ../../../../chunks/scalar ../../../../core/has ./BinaryStreamReader ./enums ./fillDefaults ./pathUtils ./resourceUtils ../../../webgl/enums".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u){function y(L){switch(L.componentType){case u.DataType.BYTE:return new l.BufferViewVec2i8(L.raw,L.byteOffset,L.byteStride,L.byteOffset+L.byteStride*L.entryCount);case u.DataType.UNSIGNED_BYTE:return new l.BufferViewVec2u8(L.raw,L.byteOffset,L.byteStride,L.byteOffset+L.byteStride*L.entryCount);case u.DataType.SHORT:return new l.BufferViewVec2i16(L.raw,L.byteOffset,L.byteStride,L.byteOffset+L.byteStride*L.entryCount);case u.DataType.UNSIGNED_SHORT:return new l.BufferViewVec2u16(L.raw,
L.byteOffset,L.byteStride,L.byteOffset+L.byteStride*L.entryCount);case u.DataType.UNSIGNED_INT:return new l.BufferViewVec2u32(L.raw,L.byteOffset,L.byteStride,L.byteOffset+L.byteStride*L.entryCount);case u.DataType.FLOAT:return new l.BufferViewVec2f(L.raw,L.byteOffset,L.byteStride,L.byteOffset+L.byteStride*L.entryCount)}}class z{constructor(L,G,O,P){this._context=L;this.uri=G;this.json=O;this._glbBuffer=P;this._bufferLoaders=new Map;this._textureLoaders=new Map;this._textureCache=new Map;this._materialCache=
new Map;this._nodeParentMap=new Map;this._nodeTransformCache=new Map;this._supportedExtensions=["KHR_texture_basisu"];this._baseUri=t.splitURI(this.uri).dirPart;this._checkVersionSupported();this._checkRequiredExtensionsSupported();if(null==O.scenes)throw new a("gltf-loader-unsupported-feature","Scenes must be defined.");if(null==O.meshes)throw new a("gltf-loader-unsupported-feature","Meshes must be defined");if(null==O.nodes)throw new a("gltf-loader-unsupported-feature","Nodes must be defined.");
this._computeNodeParents()}static async load(L,G,O){if(n.isDataProtocol(G)){var P=n.dataComponents(G);if(P&&"model/gltf-binary"!==P.mediaType)try{const J=JSON.parse(P.isBase64?atob(P.data):P.data);return new z(L,G,J)}catch{}P=n.dataToArrayBuffer(G);if(z._isGLBData(P))return this._fromGLBData(L,G,P)}if(F.test(G)||"gltf"===O?.expectedType)return O=await L.loadJSON(G,O),new z(L,G,O);P=await L.loadBinary(G,O);if(z._isGLBData(P))return this._fromGLBData(L,G,P);if(K.test(G)||"glb"===O?.expectedType)throw new a("gltf-loader-invalid-glb",
"This is not a valid glb file.");O=await L.loadJSON(G,O);return new z(L,G,O)}static _isGLBData(L){if(null==L)return!1;L=new x.BinaryStreamReader(L);return 4<=L.remainingBytes()&&1179937895===L.readUint32()}static async _fromGLBData(L,G,O){O=await z._parseGLBData(O);return new z(L,G,O.json,O.binaryData)}static async _parseGLBData(L){const G=new x.BinaryStreamReader(L);if(12>G.remainingBytes())throw new a("gltf-loader-error","glb binary data is insufficiently large.");var O=G.readUint32(),P=G.readUint32();
const J=G.readUint32();if(1179937895!==O)throw new a("gltf-loader-error","Magic first 4 bytes do not fit to expected glb value.");if(L.byteLength<J)throw new a("gltf-loader-error","glb binary data is smaller than header specifies.");if(2!==P)throw new a("gltf-loader-unsupported-feature","An unsupported glb container version was detected. Only version 2 is supported.");L=0;let R,X;for(;8<=G.remainingBytes();){O=G.readUint32();P=G.readUint32();if(0===L){if(1313821514!==P)throw new a("gltf-loader-error",
"First glb chunk must be JSON.");if(0>O)throw new a("gltf-loader-error","No JSON data found.");R=await r.jsonFromBinaryData(G.readUint8Array(O))}else if(1===L){if(5130562!==P)throw new a("gltf-loader-unsupported-feature","Second glb chunk expected to be BIN.");X=G.readUint8Array(O)}else c.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] More than 2 glb chunks detected. Skipping.");L+=1}if(!R)throw new a("gltf-loader-error","No glb JSON chunk detected.");return{json:R,binaryData:X}}async getBuffer(L,
G){const O=this.json.buffers[L];if(null==O.uri){if(null==this._glbBuffer)throw new a("gltf-loader-error","glb buffer not present");return this._glbBuffer}L=await this._getBufferLoader(L,G);if(L.byteLength!==O.byteLength)throw new a("gltf-loader-error","Buffer byte lengths should match.");return L}async _getBufferLoader(L,G){const O=this._bufferLoaders.get(L);if(O)return O;G=this._context.loadBinary(this._resolveUri(this.json.buffers[L].uri),G).then(P=>new Uint8Array(P));this._bufferLoaders.set(L,
G);return G}async getAccessor(L,G){if(!this.json.accessors)throw new a("gltf-loader-unsupported-feature","Accessors missing.");L=this.json.accessors[L];if(null==L?.bufferView)throw new a("gltf-loader-unsupported-feature","Some accessor does not specify a bufferView.");if(L.type in[p.AttributeType.MAT2,p.AttributeType.MAT3,p.AttributeType.MAT4])throw new a("gltf-loader-unsupported-feature",`AttributeType ${L.type} is not supported`);const O=this.json.bufferViews[L.bufferView];G=await this.getBuffer(O.buffer,
G);const P=B[L.type],J=D[L.componentType],R=P*J,X=O.byteStride||R;return{raw:G.buffer,byteStride:X,byteOffset:G.byteOffset+(O.byteOffset||0)+(L.byteOffset||0),entryCount:L.count,isDenselyPacked:X===R,componentCount:P,componentByteSize:J,componentType:L.componentType,min:L.min,max:L.max,normalized:!!L.normalized}}async getIndexData(L,G){if(null!=L.indices)if(L=await this.getAccessor(L.indices,G),L.isDenselyPacked)switch(L.componentType){case u.DataType.UNSIGNED_BYTE:return new Uint8Array(L.raw,L.byteOffset,
L.entryCount);case u.DataType.UNSIGNED_SHORT:return new Uint16Array(L.raw,L.byteOffset,L.entryCount);case u.DataType.UNSIGNED_INT:return new Uint32Array(L.raw,L.byteOffset,L.entryCount)}else switch(L.componentType){case u.DataType.UNSIGNED_BYTE:return w.makeDense(this._wrapAccessor(l.BufferViewUint8,L));case u.DataType.UNSIGNED_SHORT:return w.makeDense(this._wrapAccessor(l.BufferViewUint16,L));case u.DataType.UNSIGNED_INT:return w.makeDense(this._wrapAccessor(l.BufferViewUint32,L))}}async getPositionData(L,
G){if(null==L.attributes.POSITION)throw new a("gltf-loader-unsupported-feature","No POSITION vertex data found.");L=await this.getAccessor(L.attributes.POSITION,G);if(L.componentType!==u.DataType.FLOAT)throw new a("gltf-loader-unsupported-feature","Expected type FLOAT for POSITION vertex attribute, but found "+u.DataType[L.componentType]);if(3!==L.componentCount)throw new a("gltf-loader-unsupported-feature","POSITION vertex attribute must have 3 components, but found "+L.componentCount.toFixed());
return this._wrapAccessor(l.BufferViewVec3f,L)}async getNormalData(L,G){if(null==L.attributes.NORMAL)throw new a("gltf-loader-error","No NORMAL vertex data found.");L=await this.getAccessor(L.attributes.NORMAL,G);if(L.componentType!==u.DataType.FLOAT)throw new a("gltf-loader-unsupported-feature","Expected type FLOAT for NORMAL vertex attribute, but found "+u.DataType[L.componentType]);if(3!==L.componentCount)throw new a("gltf-loader-unsupported-feature","NORMAL vertex attribute must have 3 components, but found "+
L.componentCount.toFixed());return this._wrapAccessor(l.BufferViewVec3f,L)}async getTangentData(L,G){if(null==L.attributes.TANGENT)throw new a("gltf-loader-error","No TANGENT vertex data found.");L=await this.getAccessor(L.attributes.TANGENT,G);if(L.componentType!==u.DataType.FLOAT)throw new a("gltf-loader-unsupported-feature","Expected type FLOAT for TANGENT vertex attribute, but found "+u.DataType[L.componentType]);if(4!==L.componentCount)throw new a("gltf-loader-unsupported-feature","TANGENT vertex attribute must have 4 components, but found "+
L.componentCount.toFixed());return new l.BufferViewVec4f(L.raw,L.byteOffset,L.byteStride,L.byteOffset+L.byteStride*L.entryCount)}async getTextureCoordinates(L,G){if(null==L.attributes.TEXCOORD_0)throw new a("gltf-loader-error","No TEXCOORD_0 vertex data found.");L=await this.getAccessor(L.attributes.TEXCOORD_0,G);if(2!==L.componentCount)throw new a("gltf-loader-unsupported-feature","TEXCOORD_0 vertex attribute must have 2 components, but found "+L.componentCount.toFixed());if(L.componentType===u.DataType.FLOAT)return this._wrapAccessor(l.BufferViewVec2f,
L);if(!L.normalized)throw new a("gltf-loader-unsupported-feature","Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return y(L)}async getVertexColors(L,G){if(null==L.attributes.COLOR_0)throw new a("gltf-loader-error","No COLOR_0 vertex data found.");L=await this.getAccessor(L.attributes.COLOR_0,G);if(4!==L.componentCount&&3!==L.componentCount)throw new a("gltf-loader-unsupported-feature","COLOR_0 attribute must have 3 or 4 components, but found "+L.componentCount.toFixed());
if(4===L.componentCount){if(L.componentType===u.DataType.FLOAT)return this._wrapAccessor(l.BufferViewVec4f,L);if(L.componentType===u.DataType.UNSIGNED_BYTE)return this._wrapAccessor(l.BufferViewVec4u8,L);if(L.componentType===u.DataType.UNSIGNED_SHORT)return this._wrapAccessor(l.BufferViewVec4u16,L)}else if(3===L.componentCount){if(L.componentType===u.DataType.FLOAT)return this._wrapAccessor(l.BufferViewVec3f,L);if(L.componentType===u.DataType.UNSIGNED_BYTE)return this._wrapAccessor(l.BufferViewVec3u8,
L);if(L.componentType===u.DataType.UNSIGNED_SHORT)return this._wrapAccessor(l.BufferViewVec3u16,L)}throw new a("gltf-loader-unsupported-feature","Unsupported component type for COLOR_0 attribute: "+u.DataType[L.componentType]);}hasPositions(L){return void 0!==L.attributes.POSITION}hasNormals(L){return void 0!==L.attributes.NORMAL}hasVertexColors(L){return void 0!==L.attributes.COLOR_0}hasTextureCoordinates(L){return void 0!==L.attributes.TEXCOORD_0}hasTangents(L){return void 0!==L.attributes.TANGENT}async getMaterial(L,
G,O){var P=L.material?this._materialCache.get(L.material):void 0;if(!P){P=null!=L.material?h.material(this.json.materials[L.material]):h.material();const J=P.pbrMetallicRoughness,R=this.hasVertexColors(L),X=this.getTexture(J.baseColorTexture,G),U=this.getTexture(P.normalTexture,G),M=O?this.getTexture(P.occlusionTexture,G):void 0,V=O?this.getTexture(P.emissiveTexture,G):void 0;G=O?this.getTexture(J.metallicRoughnessTexture,G):void 0;L=null!=L.material?L.material:-1;P={alphaMode:P.alphaMode,alphaCutoff:P.alphaCutoff,
color:J.baseColorFactor,doubleSided:!!P.doubleSided,colorTexture:await X,normalTexture:await U,name:P.name,id:L,occlusionTexture:await M,emissiveTexture:await V,emissiveFactor:P.emissiveFactor,metallicFactor:J.metallicFactor,roughnessFactor:J.roughnessFactor,metallicRoughnessTexture:await G,hasVertexColors:R,ESRI_externalColorMixMode:P.extras.ESRI_externalColorMixMode,colorTextureTransform:J?.baseColorTexture?.extensions?.KHR_texture_transform,normalTextureTransform:P.normalTexture?.extensions?.KHR_texture_transform,
occlusionTextureTransform:P.occlusionTexture?.extensions?.KHR_texture_transform,emissiveTextureTransform:P.emissiveTexture?.extensions?.KHR_texture_transform,metallicRoughnessTextureTransform:J?.metallicRoughnessTexture?.extensions?.KHR_texture_transform}}return P}async getTexture(L,G){if(L){if(0!==(L.texCoord||0))throw new a("gltf-loader-unsupported-feature","Only TEXCOORD with index 0 is supported.");var O=L.index;L=this.json.textures[O];var P=h.textureSampler(null!=L.sampler?this.json.samplers[L.sampler]:
{}),J=this._getTextureSourceId(L),R=this.json.images[J],X=await this._loadTextureImageData(O,L,G);return d.getOrCreateMapValue(this._textureCache,O,()=>{const U=V=>33071===V||33648===V||10497===V,M=V=>{throw new a("gltf-loader-error",`Unexpected TextureSampler WrapMode: ${V}`);};return{data:X,wrapS:U(P.wrapS)?P.wrapS:M(P.wrapS),wrapT:U(P.wrapT)?P.wrapT:M(P.wrapT),minFilter:P.minFilter,name:R.name,id:O}})}}getNodeTransform(L){if(void 0===L)return A;var G=this._nodeTransformCache.get(L);if(!G){G=this.getNodeTransform(this._getNodeParent(L));
const O=this.json.nodes[L];O.matrix?G=g.multiply(q.create(),G,O.matrix):O.translation||O.rotation||O.scale?(G=q.clone(G),O.translation&&g.translate(G,G,O.translation),O.rotation&&(E[3]=e.getAxisAngle(E,O.rotation),g.rotate(G,G,E[3],E)),O.scale&&g.scale(G,G,O.scale)):G=q.clone(G);this._nodeTransformCache.set(L,G)}return G}_wrapAccessor(L,G){return new L(G.raw,G.byteOffset,G.byteStride,G.byteOffset+G.byteStride*(G.entryCount-1)+G.componentByteSize*G.componentCount)}_resolveUri(L){return n.makeAbsolute(L,
this._baseUri)}_getNodeParent(L){return this._nodeParentMap.get(L)}_checkVersionSupported(){const L=k.Version.parse(this.json.asset.version,"glTF");C.validate(L)}_checkRequiredExtensionsSupported(){const L=this.json;if(L.extensionsRequired&&!L.extensionsRequired.every(G=>this._supportedExtensions.includes(G)))throw new a("gltf-loader-unsupported-feature","gltf loader was not able to load unsupported feature. Required extensions: "+L.extensionsRequired.join(", "));}_computeNodeParents(){this.json.nodes.forEach((L,
G)=>{L.children&&L.children.forEach(O=>{this._nodeParentMap.set(O,G)})})}async _loadTextureImageData(L,G,O){const P=this._textureLoaders.get(L);if(P)return P;G=this._createTextureLoader(G,O);this._textureLoaders.set(L,G);return G}_getTextureSourceId(L){if(void 0!==L.extensions&&null!==L.extensions.KHR_texture_basisu)return L.extensions.KHR_texture_basisu.source;if(null!==L.source)return L.source;throw new a("gltf-loader-unsupported-feature","Source is expected to be defined for a texture. It can also be omitted in favour of an KHR_texture_basisu extension tag.");
}async _createTextureLoader(L,G){L=this._getTextureSourceId(L);L=this.json.images[L];if(L.uri)return L.uri.endsWith(".ktx2")?(G=await this._context.loadBinary(this._resolveUri(L.uri),G),new r.EncodedMeshTexture(new Uint8Array(G))):this._context.loadImage(this._resolveUri(L.uri),G);if(null==L.bufferView)throw new a("gltf-loader-unsupported-feature","Image bufferView must be defined.");if(null==L.mimeType)throw new a("gltf-loader-unsupported-feature","Image mimeType must be defined.");const O=this.json.bufferViews[L.bufferView];
G=await this.getBuffer(O.buffer,G);if(null!=O.byteStride)throw new a("gltf-loader-unsupported-feature","byteStride not supported for image buffer");return r.imageFromBinaryData(new Uint8Array(G.buffer,G.byteOffset+(O.byteOffset||0),O.byteLength),L.mimeType)}async getLoadedBuffersSize(){if(this._glbBuffer)return this._glbBuffer.byteLength;const L=await f.allSettledValues(Array.from(this._bufferLoaders.values())),G=await f.allSettledValues(Array.from(this._textureLoaders.values()));return L.reduce((O,
P)=>O+(P?.byteLength??0),0)+G.reduce((O,P)=>O+(P?r.isEncodedMeshTexture(P)?P.data.byteLength:P.width*P.height*4:0),0)}}const A=g.fromXRotation(q.create(),Math.PI/2),C=new k.Version(2,0,"glTF"),E=m.create(),B={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},D={[u.DataType.BYTE]:1,[u.DataType.UNSIGNED_BYTE]:1,[u.DataType.SHORT]:2,[u.DataType.UNSIGNED_SHORT]:2,[u.DataType.FLOAT]:4,[u.DataType.INT]:4,[u.DataType.UNSIGNED_INT]:4},F=/\.gltf$/i,K=/\.glb$/i;b.GLTFResource=z;b.transformGltfToEngine=A;
Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/scalar":function(){define(["exports"],function(b){function a(d,f){const n=d.count;f||(f=new d.TypedArrayConstructor(n));for(let k=0;k<n;k++)f[k]=d.get(k);return f}const c=Object.freeze(Object.defineProperty({__proto__:null,makeDense:a},Symbol.toStringTag,{value:"Module"}));b.makeDense=a;b.scalar=c})},"esri/views/3d/glTF/internal/BinaryStreamReader":function(){define(["exports"],function(b){class a{constructor(c){this._data=
c;this._offset4=0;this._dataUint32=new Uint32Array(this._data,0,Math.floor(this._data.byteLength/4))}readUint32(){const c=this._offset4;this._offset4+=1;return this._dataUint32[c]}readUint8Array(c){const d=4*this._offset4;this._offset4+=c/4;return new Uint8Array(this._data,d,c)}remainingBytes(){return this._data.byteLength-4*this._offset4}}b.BinaryStreamReader=a;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/internal/enums":function(){define(["exports"],function(b){b.AttributeType=
void 0;(function(a){a.SCALAR="SCALAR";a.VEC2="VEC2";a.VEC3="VEC3";a.VEC4="VEC4";a.MAT2="MAT2";a.MAT3="MAT3";a.MAT4="MAT4"})(b.AttributeType||(b.AttributeType={}));b.BufferViewTarget=void 0;(function(a){a[a.ARRAY_BUFFER=34962]="ARRAY_BUFFER";a[a.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"})(b.BufferViewTarget||(b.BufferViewTarget={}));Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/internal/fillDefaults":function(){define(["exports","../../../../core/compilerUtils",
"../../../webgl/enums"],function(b,a,c){const d={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},f={pbrMetallicRoughness:d,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},n={ESRI_externalColorMixMode:"tint"},k={magFilter:c.TextureSamplingMode.LINEAR,minFilter:c.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,wrapS:c.TextureWrapMode.REPEAT,wrapT:c.TextureWrapMode.REPEAT};b.material=(g={})=>{const q={...d,...g.pbrMetallicRoughness};var e={...n,...g.extras};switch(e.ESRI_externalColorMixMode){case "multiply":case "tint":case "ignore":case "replace":break;
default:a.neverReached(e.ESRI_externalColorMixMode),e.ESRI_externalColorMixMode="tint"}return{...f,...g,pbrMetallicRoughness:q,extras:e}};b.textureSampler=g=>({...k,...g});Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/internal/pathUtils":function(){define(["exports"],function(b){b.splitURI=function(a){let c,d;a.replace(/^(.*\/)?([^/]*)$/,(f,n,k)=>{c=n||"";d=k||"";return""});return{dirPart:c,filePart:d}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/glTF/internal/indexUtils":function(){define(["exports","../../../../core/typedArrayUtil","../../../../geometry/support/Indices","../../../webgl/enums"],function(b,a,c,d){b.convertPrimitiveToTriangles=function(f,n){switch(n){case d.PrimitiveType.TRIANGLES:return f="number"===typeof f?c.getContinuousIndexArray(f):a.isUint8Array(f)?new Uint16Array(f):f,f;case d.PrimitiveType.TRIANGLE_STRIP:n="number"===typeof f?f:f.length;if(3>n)f=[];else{n-=2;var k=c.newIndexArray(3*n);if("number"===
typeof f){f=0;for(var g=0;g<n;g+=1)0===g%2?(k[f++]=g,k[f++]=g+1):(k[f++]=g+1,k[f++]=g),k[f++]=g+2}else{g=0;for(var q=0;q<n;q+=1)0===q%2?(k[g++]=f[q],k[g++]=f[q+1]):(k[g++]=f[q+1],k[g++]=f[q]),k[g++]=f[q+2]}f=k}return f;case d.PrimitiveType.TRIANGLE_FAN:n="number"===typeof f?f:f.length;if(3>n)f=new Uint16Array(0);else{n-=2;k=65536>=n?new Uint16Array(3*n):new Uint32Array(3*n);if("number"===typeof f)for(f=0,g=0;g<n;++g)k[f++]=0,k[f++]=g+1,k[f++]=g+2;else{g=f[0];q=f[1];var e=0;for(let m=0;m<n;++m){const l=
f[m+2];k[e++]=g;k[e++]=q;q=k[e++]=l}}f=k}return f}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/ProcessedObjectResource":function(){define(["exports"],function(b){class a{constructor(){this.geometries=[];this.materials=[];this.textures=[]}}class c{constructor(d,f,n){this.name=d;this.lodThreshold=f;this.pivotOffset=n;this.stageResources=new a;this.numberOfVertices=0}}b.ProcessedObjectResource=c;b.ProcessedObjectStageResources=a;Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/wosrLoader":function(){define("exports ../../../../request ../../../../core/asyncUtils ../../../../core/byteSizeEstimations ../../../../core/Error ../../../../core/Logger ../../../../core/NestedMap ../../../../core/promiseUtils ../../../../core/Version ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/Indices ../../../../support/requestImageUtils ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Texture ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/DefaultMaterial ../../../webgl/enums".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u){async function y(G,O){const P=O?.streamDataRequester;if(P)return z(G,P,O);G=await c.result(a(G,O));if(!0===G.ok)return G.value.data;g.throwIfAbortError(G.error);A(G.error)}async function z(G,O,P){G=await c.result(O.request(G,"json",P));if(!0===G.ok)return G.value;g.throwIfAbortError(G.error);A(G.error.details.url)}function A(G){throw new f("",`Request for object resource failed: ${G}`);}function C(G){var O=G.params,P=O.topology;let J=!0;O.vertexAttributes||
(K.warn("Geometry must specify vertex attributes"),J=!1);switch(O.topology){case "PerAttributeArray":break;case "Indexed":case null:case void 0:P=O.faces;if(!P)K.warn("Indexed geometries must specify faces"),J=!1;else if(O.vertexAttributes)for(const R in O.vertexAttributes)O=P[R],O?.values?(null!=O.valueType&&"UInt32"!==O.valueType&&(K.warn(`Unsupported indexed geometry indices type '${O.valueType}', only UInt32 is currently supported`),J=!1),null!=O.valuesPerElement&&1!==O.valuesPerElement&&(K.warn(`Unsupported indexed geometry values per element '${O.valuesPerElement}', only 1 is currently supported`),
J=!1)):(K.warn(`Indexed geometry does not specify face indices for '${R}' attribute`),J=!1);break;default:K.warn(`Unsupported topology '${P}'`),J=!1}G.params.material||(K.warn("Geometry requires material"),J=!1);G=G.params.vertexAttributes;for(const R in G)G[R].values||(K.warn("Geometries with externally defined attributes are not yet supported"),J=!1);return J}function E(G){const O=m.empty();G.forEach(P=>{P=P.boundingInfo;null!=P&&(m.expandWithVec3(O,P.bbMin),m.expandWithVec3(O,P.bbMax))});return O}
async function B(G,O){const P=[];for(const X in G){var J=G[X],R=J.images[0].data;if(!R){K.warn("Externally referenced texture data is not yet supported");continue}R=J.encoding+";base64,"+R;const U="/textureDefinitions/"+X,M="rgba"===J.channels?J.alphaChannelUsage||"transparency":"none",V={noUnpackFlip:!0,wrap:{s:u.TextureWrapMode.REPEAT,t:u.TextureWrapMode.REPEAT},preMultiplyAlpha:D(M)!==x.AlphaDiscardMode.Opaque};J=null!=O&&O.disableTextures?Promise.resolve(null):w.requestImage(R,O);P.push(J.then(Y=>
({refId:U,image:Y,parameters:V,alphaChannelUsage:M})))}G=await Promise.all(P);O={};for(const X of G)O[X.refId]=X;return O}function D(G){switch(G){case "mask":return x.AlphaDiscardMode.Mask;case "maskAndTransparency":return x.AlphaDiscardMode.MaskBlend;case "none":return x.AlphaDiscardMode.Opaque;case "transparency":return x.AlphaDiscardMode.Blend;default:return x.AlphaDiscardMode.Blend}}function F(G){G=G.params;return{id:1,material:G.material,texture:G.texture,region:G.texture}}const K=n.getLogger("esri.views.3d.layers.graphics.objectResourceUtils"),
L=new q.Version(1,2,"wosr");b.createTextureResources=B;b.load=async function(G,O){G=await y(G,O);O=await B(G.textureDefinitions??{},O);let P=0;for(const J in O)if(O.hasOwnProperty(J)){const R=O[J];P+=R?.image?R.image.width*R.image.height*4:0}return{resource:G,textures:O,size:P+d.estimateNestedObjectSize(G)}};b.processLoadResult=function(G,O){const P=[],J=[],R=[],X=new k.NestedMap,U=G.resource;var M=q.Version.parse(U.version||"1.0","wosr");L.validate(M);M=U.model.name;const V=U.model.geometries,Y=
U.materialDefinitions??{};G=G.textures;let W=0;const H=new Map;for(let da=0;da<V.length;da++){const fa=V[da];if(!C(fa))continue;var S=F(fa),I=fa.params.vertexAttributes;const ka=[];var Q=ha=>{if("PerAttributeArray"===fa.params.topology)return null;const ba=fa.params.faces;for(const ea in ba)if(ea===ha)return ba[ea].values;return null},N=I[t.VertexAttribute.POSITION];N=N.values.length/N.valuesPerElement;for(const ha in I){var T=I[ha],aa=T.values,Z=Q(ha)??l.getContinuousIndexArray(N);ka.push([ha,new v.Attribute(aa,
Z,T.valuesPerElement,!0)])}I=S.texture;if((Q=G&&G[I])&&!H.has(I)){const {image:ha,parameters:ba}=Q;N=new h.Texture(ha,ba);J.push(N);H.set(I,N)}N=(N=H.get(I))?N.id:void 0;S=S.material;T=X.get(S,I);null==T&&(T=S.substring(S.lastIndexOf("/")+1),T=Y[T].params,1===T.transparency&&(T.transparency=0),aa=Q&&Q.alphaChannelUsage,aa=0<T.transparency||"transparency"===aa||"maskAndTransparency"===aa,Z=Q?D(Q.alphaChannelUsage):void 0,Q={ambient:e.fromArray(T.diffuse),diffuse:e.fromArray(T.diffuse),opacity:1-(T.transparency||
0),transparent:aa,textureAlphaMode:Z,textureAlphaCutoff:.33,textureId:N,initTextureTransparent:!0,doubleSided:!0,cullFace:x.CullFaceOptions.None,colorMixMode:T.externalColorMixMode||"tint",textureAlphaPremultiplied:Q?.parameters.preMultiplyAlpha??!1},O?.materialParameters&&Object.assign(Q,O.materialParameters),T=new r.DefaultMaterial(Q),X.set(S,I,T));R.push(T);I=new p.Geometry(T,ka);W+=ka.find(ha=>ha[0]===t.VertexAttribute.POSITION)?.[1]?.indices.length??0;P.push(I)}return{engineResources:[{name:M,
stageResources:{textures:J,materials:R,geometries:P},pivotOffset:U.model.pivotOffset,numberOfVertices:W,lodThreshold:null}],referenceBoundingBox:E(P)}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/DefaultMaterial_COLOR_GAMMA":function(){define(["exports"],function(b){b.colorGamma=2.1;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/webStyleUtils":function(){define(["exports","../../../../core/Error",
"../../../../symbols/support/styleUtils","../../../../symbols/support/webStyleSymbolUtils"],function(b,a,c,d){b.getResourceUrlFromSymbolStyle=async function(f){if(null===f||null==f.styleName&&null==f.styleUrl)return null;var n=f.name;if(null==n)throw new a("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference");const k={portal:f.portal};f=await c.fetchStyle(f,k).catch(()=>null);if(null===f)return null;const g=d.getStyleItemFromStyle(n,f.data);if(g&&!g.formatInfos?.some(q=>
"gltf_basisu"===q.type))return null;n=await d.fetchSymbolFromStyle(f,n,k,"webRef",(q,e)=>c.symbolUrlFromStyleItem(q,e,["gltf_basisu","gltf"])).catch(()=>null);if(null===n||"point-3d"!==n.type)return null;n=n.symbolLayers.items[0];return"object"===n.type?n.resource:null};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/webStyleSymbolUtils":function(){define("exports ../../symbols ../../core/devEnvironmentUtils ../../core/Error ../../core/urlUtils ../../portal/Portal ../../chunks/persistableUrlUtils ./jsonUtils ./StyleOrigin ./styleUtils ./Thumbnail".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m){function l(x,p){return p.items.find(h=>h.name===x)}function w(x,p,h,t,r,u){const y=null!=h?.portal?h.portal:n.getDefault(),z={portal:y,url:f.urlToObject(x.baseUrl),origin:"portal-item"},A=l(p,x.data);if(!A)return Promise.reject(new d("symbolstyleutils:symbol-name-not-found",`The symbol name '${p}' could not be found`,{symbolName:p}));r=k.fromJSON(r(A,t),z);let C=A.thumbnail?.href??null;const E=A.thumbnail?.imageData;c.isDevEnvironment()&&(r=c.adjustStaticAGOUrl(r)??
"",C=c.adjustStaticAGOUrl(C));const B={portal:y,url:f.urlToObject(f.removeFile(r)),origin:"portal-item"};return e.requestJSON(r,u).then(D=>{D="cimRef"===t?e.makeCIMSymbolRef(D.data):D.data;if((D=g.fromJSON(D,B))&&a.isSymbol3D(D)){if(C){const F=k.fromJSON(C,z);D.thumbnail=new m.Thumbnail({url:F})}else E&&(D.thumbnail=new m.Thumbnail({url:`data:image/png;base64,${E}`}));x.styleUrl?D.styleOrigin=new q({portal:h.portal,styleUrl:x.styleUrl,name:p}):x.styleName&&(D.styleOrigin=new q({portal:h.portal,styleName:x.styleName,
name:p}))}return D})}function v(x,p,h){const t=e.Style2DUrlTemplate.replaceAll(/\{SymbolName\}/gi,x),r=null!=p.portal?p.portal:n.getDefault();return e.requestJSON(t,h).then(u=>{u=e.makeCIMSymbolRef(u.data);return g.fromJSON(u,{portal:r,url:f.urlToObject(f.removeFile(t)),origin:"portal-item"})})}b.fetchSymbolFromStyle=w;b.getStyleItemFromStyle=l;b.resolveWebStyleSymbol=function(x,p,h,t){const r=x.name;return null==r?Promise.reject(new d("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference")):
x.styleName&&"Esri2DPointSymbolsStyle"===x.styleName?v(r,p,t):e.fetchStyle(x,p,t).then(u=>w(u,r,p,h,e.symbolUrlFromStyleItem,t))};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodRenderer":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/arrayUtils ../../../../../core/maybe ../../../../../core/promiseUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../chunks/vec4f64 ../../../support/debugFlags ../../../support/buffer/glUtil ../../../support/buffer/InterleavedLayout ../../core/shaderLibrary/ShaderOutput ../../effects/RenderPlugin ../Camera ../DefaultVertexAttributeLocations ../IntersectorInterfaces ../Octree ../RenderSlot ../Util ../VertexAttribute ./InstanceData ./InstanceOctree ./LevelSelector ./LodLevel ./RenderInstanceData ../../materials/internal/MaterialUtil ../../materials/renderers/utils ../../shaders/DefaultMaterialTechnique ../../../../support/Scheduler ../../../../webgl/Util".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A,C,E,B,D,F,K,L,G,O,P,J,R){function X(N,T,aa){const Z=N.allocateHead();N=N.view;O.encodeDoubleVec3(T.modelOrigin,aa,N.modelOriginHi,N.modelOriginLo,Z);N.model.copyFrom(Z,T.model,aa);N.modelNormal.copyFrom(Z,T.modelNormal,aa);T.color&&N.color&&N.color.copyFrom(Z,T.color,aa);T.objectAndLayerIdColor&&N.objectAndLayerIdColor&&N.objectAndLayerIdColor.copyFrom(Z,T.objectAndLayerIdColor,aa);T.featureAttribute&&N.featureAttribute&&N.featureAttribute.copyFrom(Z,
T.featureAttribute,aa)}function U(N){let T=p.newLayout().vec3f(E.VertexAttribute.INSTANCEMODELORIGINHI).vec3f(E.VertexAttribute.INSTANCEMODELORIGINLO).mat3f(E.VertexAttribute.INSTANCEMODEL).mat3f(E.VertexAttribute.INSTANCEMODELNORMAL);null!=N&&N.includes("featureAttribute")&&(T=T.vec4f(E.VertexAttribute.INSTANCEFEATUREATTRIBUTE));null!=N&&N.includes("color")&&(T=T.vec4u8(E.VertexAttribute.INSTANCECOLOR));null!=N&&N.includes("objectAndLayerIdColor")&&(T=T.vec4u8(E.VertexAttribute.INSTANCEOBJECTANDLAYERIDCOLOR));
return T}const M=N=>{const T=N.baseBoundingSphere.radius;N=N.levels.map(aa=>aa.minScreenSpaceRadius);return new F.LevelSelector(T,N)};b.LodRenderer=class extends t.ASyncPreparesRenderPlugin{constructor(N,T){super(N);this.type=y.IntersectorType.LOD;this.isGround=!1;this._levels=[];this._defaultRenderInstanceData=[[]];this._highlightRenderInstanceData=[[]];this._allRenderInstanceData=[this._defaultRenderInstanceData[0],this._highlightRenderInstanceData[0]];this._cycleStartIndex=this._instanceIndex=
0;this._slicePlane=!1;this._camera=new r.Camera;this._updateCyclesWithStaticCamera=-1;this._needFullCycle=!1;this.produces=new Map([[A.RenderSlot.OPAQUE_MATERIAL,aa=>this._produces(aa)],[A.RenderSlot.TRANSPARENT_MATERIAL,aa=>this._hasTransparentLevels()?this._produces(aa):!1]]);this._instanceData=new B.InstanceData({shaderTransformation:N.shaderTransformation},N.optionalFields);this.addHandles(T.registerTask(J.TaskPriority.LOD_RENDERER,this))}initialize(){this._instanceBufferLayout=U(this.optionalFields);
this._glInstanceBufferLayout=x.glLayout(this._instanceBufferLayout,1);this.addHandles([this._instanceData.events.on("instances-changed",()=>this._requestUpdateCycle()),this._instanceData.events.on("instance-transform-changed",({index:N})=>{this._requestUpdateCycle();this.metadata.notifyGraphicGeometryChanged(N)}),this._instanceData.events.on("instance-visibility-changed",({index:N})=>{this._requestUpdateCycle(!0);this.metadata.notifyGraphicVisibilityChanged(N)}),this._instanceData.events.on("instance-highlight-changed",
()=>this._requestUpdateCycle(!0))])}get _enableLevelSelection(){return 1<this.symbol.levels.length}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(N){this._slicePlane=N}get layerUid(){return this.metadata.layerUid}get instanceData(){return this._instanceData}get usedMemory(){return this._allRenderInstanceData.reduce((N,
T)=>T.reduce((aa,Z)=>aa+Z.usedMemory,N),0)}get renderStats(){const N=this._instanceData.size,T=[];this._levels.forEach((aa,Z)=>{Z=this._allRenderInstanceData[0][Z].size+this._allRenderInstanceData[1][Z].size;aa=aa.triangleCount;T.push({renderedInstances:Z,renderedTriangles:Z*aa,trianglesPerInstance:aa})});return{totalInstances:N,renderedInstances:T.reduce((aa,Z)=>aa+Z.renderedInstances,0),renderedTriangles:T.reduce((aa,Z)=>aa+Z.renderedTriangles,0),levels:T}}async initializeRenderContext(N,T){this._context=
N;const aa=N.renderContext.rctx,Z=await Promise.allSettled(this.symbol.levels.map(fa=>{this._defaultRenderInstanceData[0].push(new L.RenderInstanceData(aa,this._instanceBufferLayout));this._highlightRenderInstanceData[0].push(new L.RenderInstanceData(aa,this._instanceBufferLayout));return K.LodLevel.create(N,fa,T)})),da=Z.map(fa=>"fulfilled"===fa.status?fa.value:null).filter(c.isSome);if(f.isAborted(T)||da.length!==Z.length){da.forEach(fa=>fa.destroy());f.throwIfAborted(T);for(const fa of Z)if("rejected"===
fa.status)throw fa.reason;}this._levels=da;this._levelSelector=M(this)}uninitializeRenderContext(){this._invalidateOctree();this._levels.forEach(N=>N.destroy());this._defaultRenderInstanceData[0].forEach(N=>N.destroy());this._highlightRenderInstanceData[0].forEach(N=>N.destroy())}_hasTransparentLevels(){return this._levels.some(N=>N.components.some(T=>T.material.produces(A.RenderSlot.TRANSPARENT_MATERIAL,h.ShaderOutput.Color)))}hasHighlights(){return this._highlightRenderInstanceData[0].some(N=>0<
N.size)}_produces(N){return N!==h.ShaderOutput.Highlight&&N!==h.ShaderOutput.ShadowHighlight||this.hasHighlights()}prepareRender(N){if(!v.debugFlags.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){const T=N.bindParameters.contentCamera.equals(this._camera);this._camera.copyFrom(N.bindParameters.contentCamera);T||this._requestUpdateCycle()}this._needFullCycle&&(this.runTask(J.noBudget),this._needFullCycle=!1)}}prepareTechniques(N){if(!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleForOutput(N.output))return null;
const T=this._getInstanceDatas(N.output);if(!T)return null;const aa=[];T.forEach(Z=>this.levels.forEach((da,fa)=>{da.components.forEach(ka=>aa.push(this._beginComponent(N,Z[fa],ka)))}));return aa}renderNode(N,T){const aa=this._getInstanceDatas(N.output);if(aa&&null!=T){var Z=0;N.rctx.bindVAO();aa.forEach(da=>this.levels.forEach((fa,ka)=>{fa.components.forEach(ha=>this._renderComponent(N,T[Z++],da[ka],ha,ka))}))}}_getInstanceDatas(N){const T=N!==h.ShaderOutput.Highlight&&N!==h.ShaderOutput.ShadowHighlight;
N=N!==h.ShaderOutput.ShadowExcludeHighlight;return T&&N?this._allRenderInstanceData:T?this._defaultRenderInstanceData:N?this._highlightRenderInstanceData:null}intersect(N,T,aa,Z){if(this.baseMaterial.isVisible()&&null!=this._octree){var da=l.create();m.subtract(da,Z,aa);var fa=ka=>{this._instanceData.getCombinedModelTransform(ka,W);N.transform.set(W);m.transformMat4(H,aa,N.transform.inverse);m.transformMat4(S,Z,N.transform.inverse);const ha=this._instanceData.getState(ka),ba=this._instanceData.getLodLevel(ka),
ea=this._levels.length;C.assert(0!==(ha&B.StateFlags.ACTIVE),"invalid instance state");C.assert(0<=ba&&ba<ea,"invaid lod level");this._levels[ba].intersect(N,T,H,S,ka,this.metadata,ea)};this.baseMaterial.parameters.verticalOffset?this._octree.forEach(fa):this._octree.forEachAlongRay(aa,da,fa)}}notifyShaderTransformationChanged(){this._invalidateOctree();this._requestUpdateCycle()}get _octree(){if(null==this._octreeCached){const N=this._instanceData,T=N.view?.state;if(!T)return null;this._octreeCached=
new D.InstanceOctree(N,this.baseBoundingSphere);for(let aa=0;aa<N.capacity;++aa)T.get(aa)&B.StateFlags.ACTIVE&&this._octreeCached.addInstance(aa)}return this._octreeCached}_invalidateOctree(){this._octreeCached=d.destroyMaybe(this._octreeCached)}queryDepthRange(N){if(null==this._octree)return{near:Infinity,far:-Infinity};var T=N.viewForward,aa=this._octree.findClosest(T,z.DepthOrder.FRONT_TO_BACK,N.frustum);const Z=this._octree.findClosest(T,z.DepthOrder.BACK_TO_FRONT,N.frustum);if(null==aa||null==
Z)return{near:Infinity,far:-Infinity};const da=N.eye,fa=this._instanceData.view;fa.boundingSphere.getVec(aa,Y);m.subtract(Y,Y,da);aa=m.dot(Y,T)-Y[3];fa.boundingSphere.getVec(Z,Y);m.subtract(Y,Y,da);T=m.dot(Y,T)+Y[3];return{near:Math.max(N.near,aa),far:Math.min(N.far,T)}}_requestUpdateCycle(N=!1){this._updateCyclesWithStaticCamera=-1;this._cycleStartIndex=this._instanceIndex;N&&(this._needFullCycle=!0,this._context.requestRender())}_startUpdateCycle(){this._updateCyclesWithStaticCamera++;this._allRenderInstanceData.forEach(N=>
N.forEach(T=>T.startUpdateCycle()))}get running(){return 0<this._instanceData.size&&1>this._updateCyclesWithStaticCamera}runTask(N){const {_enableLevelSelection:T,_camera:aa,_levelSelector:Z}=this;this._allRenderInstanceData.forEach(la=>la.forEach(oa=>oa.beginUpdate()));const da=this._instanceData,fa=da.view;let ka=da.size;const ha=da.capacity;let ba=this._instanceIndex;const ea=Math.ceil(ha/500);for(let la=0;la<ka&&!N.done;++la){ba===this._cycleStartIndex&&this._startUpdateCycle();const oa=fa.state.get(ba);
var ca=0;if(oa&B.StateFlags.ALLOCATED){var ia=fa.lodLevel.get(ba);oa&B.StateFlags.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[0][ia].freeTail();oa&B.StateFlags.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[0][ia].freeTail();oa&B.StateFlags.REMOVE?da.freeInstance(ba):oa&B.StateFlags.VISIBLE?(ia=0,T&&(fa.modelOrigin.getVec(ba,V),ia=Z.selectLevel(V,da.getCombinedMedianScaleFactor(ba),aa)),ca=oa&~(B.StateFlags.ACTIVE|B.StateFlags.TRANSFORM_CHANGED),0<=ia&&(oa&B.StateFlags.HIGHLIGHT?(X(this._highlightRenderInstanceData[0][ia],
fa,ba),ca|=B.StateFlags.HIGHLIGHT_ACTIVE):(X(this._defaultRenderInstanceData[0][ia],fa,ba),ca|=B.StateFlags.DEFAULT_ACTIVE)),fa.state.set(ba,ca),fa.lodLevel.set(ba,ia)):(ca=oa&~(B.StateFlags.ACTIVE|B.StateFlags.TRANSFORM_CHANGED),fa.state.set(ba,ca));null!=this._octreeCached&&(ia=!!(oa&B.StateFlags.ACTIVE),ca=!!(ca&B.StateFlags.ACTIVE),!ia&&ca?this._octreeCached.addInstance(ba):ia&&!ca?this._octreeCached.removeInstance(ba):ia&&ca&&oa&B.StateFlags.TRANSFORM_CHANGED&&(this._octreeCached.removeInstance(ba),
this._octreeCached.addInstance(ba)));ba=ba+1===ha?0:ba+1;0===ba%ea&&N.madeProgress()}else ba=ba+1===ha?0:ba+1,ka++}this._instanceIndex=ba;this._allRenderInstanceData.forEach(la=>la.forEach(oa=>oa.endUpdate()));this._context.requestRender()}_beginComponent(N,T,aa){if(0===T.size)return null;T=aa.glMaterials.load(N.rctx,N.bindParameters.slot,N.output);return null!=T?T.beginSlot(N.bindParameters):null}_renderComponent(N,T,aa,Z,da){if(T){var {bindParameters:fa,rctx:ka}=N;ka.runAppleAmdDriverHelper();var ha=
ka.bindTechnique(T,Z.material.parameters,fa);ka.bindVAO(Z.vao);T.ensureAttributeLocations(Z.vao);ha.bindDraw(Q,fa,Z.material.parameters);v.debugFlags.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&N.output===h.ShaderOutput.Color&&(ha.setUniform4fv("externalColor",I[Math.min(da,I.length-1)]),ha.setUniform1i("colorMixMode",G.colorMixModes.replace));N=aa.capacity;da=aa.headIndex;ha=aa.tailIndex;var ba=aa.firstIndex,ea=this._glInstanceBufferLayout,ca=(ia,la)=>{R.bindVertexBufferLayout(ka,u.Default3D,aa.buffer,
ea,ia);ka.drawArraysInstanced(T.primitiveType,0,Z.vertexCount,la-ia);R.unbindVertexBufferLayout(ka,u.Default3D,aa.buffer,ea)};Z.material.parameters.transparent&&null!=ba?da>ha?(C.assert(ba>=ha&&ba<=da,"invalid firstIndex"),ca(ba,da),ca(ha,ba)):da<ha&&(ba<=da?(C.assert(0<=ba&&ba<=da,"invalid firstIndex"),ca(ba,da),ca(ha,N),ca(0,ba)):(C.assert(ba>=ha&&ba<=N,"invalid firstIndex"),ca(ba,N),ca(0,da),ca(ha,ba))):da>ha?ca(ha,da):da<ha&&(ca(0,da),ca(ha,N));ka.bindVAO(null)}}};a.__decorate([n.property({constructOnly:!0})],
b.LodRenderer.prototype,"symbol",void 0);a.__decorate([n.property({constructOnly:!0})],b.LodRenderer.prototype,"optionalFields",void 0);a.__decorate([n.property({constructOnly:!0})],b.LodRenderer.prototype,"metadata",void 0);a.__decorate([n.property({constructOnly:!0})],b.LodRenderer.prototype,"shaderTransformation",void 0);a.__decorate([n.property()],b.LodRenderer.prototype,"_instanceData",void 0);a.__decorate([n.property()],b.LodRenderer.prototype,"_cycleStartIndex",void 0);a.__decorate([n.property({readOnly:!0})],
b.LodRenderer.prototype,"_enableLevelSelection",null);a.__decorate([n.property()],b.LodRenderer.prototype,"_updateCyclesWithStaticCamera",void 0);a.__decorate([n.property({readOnly:!0})],b.LodRenderer.prototype,"running",null);b.LodRenderer=a.__decorate([q.subclass("esri.views.3d.webgl-engine.lib.lodRendering.LodRenderer")],b.LodRenderer);const V=l.create(),Y=w.create(),W=e.create(),H=l.create(),S=l.create(),I=[w.fromValues(1,0,1,1),w.fromValues(0,0,1,1),w.fromValues(0,1,0,1),w.fromValues(1,1,0,1),
w.fromValues(1,0,0,1)],Q=new P.DefaultMaterialDrawParameters;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceData":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/Accessor ../../../../../core/arrayUtils ../../../../../core/Evented ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/mat3 ../../../../../chunks/mat3f64 ../../../../../chunks/mat4 ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/buffer/BufferView ../../../support/mathUtils ../../../support/buffer/InterleavedLayout ../Util ../VertexAttribute ./RenderInstanceData".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y){b.StateFlags=void 0;(function(D){D[D.ALLOCATED=1]="ALLOCATED";D[D.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE";D[D.VISIBLE=4]="VISIBLE";D[D.HIGHLIGHT=8]="HIGHLIGHT";D[D.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE";D[D.REMOVE=32]="REMOVE";D[D.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED";D[D.ACTIVE=18]="ACTIVE"})(b.StateFlags||(b.StateFlags={}));class z{constructor(D){this.localTransform=D.getField(u.VertexAttribute.LOCALTRANSFORM,p.BufferViewMat4f64);this.globalTransform=
D.getField(u.VertexAttribute.GLOBALTRANSFORM,p.BufferViewMat4f64);this.modelOrigin=D.getField(u.VertexAttribute.MODELORIGIN,p.BufferViewVec3f64);this.model=D.getField(u.VertexAttribute.INSTANCEMODEL,p.BufferViewMat3f);this.modelNormal=D.getField(u.VertexAttribute.INSTANCEMODELNORMAL,p.BufferViewMat3f);this.modelScaleFactors=D.getField(u.VertexAttribute.MODELSCALEFACTORS,p.BufferViewVec2f);this.boundingSphere=D.getField(u.VertexAttribute.BOUNDINGSPHERE,p.BufferViewVec4f64);this.featureAttribute=D.getField(u.VertexAttribute.FEATUREATTRIBUTE,
p.BufferViewVec4f);this.color=D.getField(u.VertexAttribute.COLOR,p.BufferViewVec4u8);this.objectAndLayerIdColor=D.getField(u.VertexAttribute.OBJECTANDLAYERIDCOLOR,p.BufferViewVec4u8);this.state=D.getField(u.VertexAttribute.STATE,p.BufferViewUint8);this.lodLevel=D.getField(u.VertexAttribute.LODLEVEL,p.BufferViewUint8)}}b.InstanceData=class extends c{constructor(D,F){super(D);this.events=new f;this._next=this._size=this._capacity=0;D=t.newLayout().mat4f64(u.VertexAttribute.LOCALTRANSFORM).mat4f64(u.VertexAttribute.GLOBALTRANSFORM).vec4f64(u.VertexAttribute.BOUNDINGSPHERE).vec3f64(u.VertexAttribute.MODELORIGIN).mat3f(u.VertexAttribute.INSTANCEMODEL).mat3f(u.VertexAttribute.INSTANCEMODELNORMAL).vec2f(u.VertexAttribute.MODELSCALEFACTORS);
F.includes(u.VertexAttribute.FEATUREATTRIBUTE)&&(D=D.vec4f(u.VertexAttribute.FEATUREATTRIBUTE));F.includes(u.VertexAttribute.COLOR)&&(D=D.vec4u8(u.VertexAttribute.COLOR));F.includes(u.VertexAttribute.OBJECTANDLAYERIDCOLOR)&&(D=D.vec4u8(u.VertexAttribute.OBJECTANDLAYERIDCOLOR));this._layout=D=D.u8(u.VertexAttribute.STATE).u8(u.VertexAttribute.LODLEVEL);this._capacity=y.initialCapacity;this._buffer=this._layout.createBuffer(this._capacity);this._view=new z(this._buffer)}get capacity(){return this._capacity}get size(){return this._size}get view(){return this._view}addInstance(){this._size+
1>this._capacity&&this._grow();const D=this._findSlot();this._view.state.set(D,b.StateFlags.ALLOCATED);this._size++;this.events.emit("instances-changed");return D}removeInstance(D){const F=this._view.state;r.assert(0<=D&&D<this._capacity&&0!==(F.get(D)&b.StateFlags.ALLOCATED),"invalid instance handle");this._getStateFlag(D,b.StateFlags.ACTIVE)?this._setStateFlags(D,b.StateFlags.REMOVE):this.freeInstance(D);this.events.emit("instances-changed")}freeInstance(D){const F=this._view.state;r.assert(0<=
D&&D<this._capacity&&0!==(F.get(D)&b.StateFlags.ALLOCATED),"invalid instance handle");F.set(D,0);this._size--}setLocalTransform(D,F,K=!0){this._view.localTransform.setMat(D,F);K&&this.updateModelTransform(D)}getLocalTransform(D,F){this._view.localTransform.getMat(D,F)}setGlobalTransform(D,F,K=!0){this._view.globalTransform.setMat(D,F);K&&this.updateModelTransform(D)}getGlobalTransform(D,F){this._view.globalTransform.getMat(D,F)}updateModelTransform(D){const F=this._view;var K=A;const L=C;F.localTransform.getMat(D,
E);F.globalTransform.getMat(D,B);const G=l.multiply(B,B,E);v.set(K,G[12],G[13],G[14]);F.modelOrigin.setVec(D,K);e.fromMat4(L,G);F.model.setMat(D,L);K=h.scaleFromMatrix(A,G);K.sort();F.modelScaleFactors.set(D,0,K[1]);F.modelScaleFactors.set(D,1,K[2]);e.invert(L,L);e.transpose(L,L);F.modelNormal.setMat(D,L);this._setStateFlags(D,b.StateFlags.TRANSFORM_CHANGED);this.events.emit("instance-transform-changed",{index:D})}getModelTransform(D,F){const K=this._view;K.model.getMat(D,C);K.modelOrigin.getVec(D,
A);F[0]=C[0];F[1]=C[1];F[2]=C[2];F[3]=0;F[4]=C[3];F[5]=C[4];F[6]=C[5];F[7]=0;F[8]=C[6];F[9]=C[7];F[10]=C[8];F[11]=0;F[12]=A[0];F[13]=A[1];F[14]=A[2];F[15]=1}applyShaderTransformation(D,F){null!=this.shaderTransformation&&this.shaderTransformation.applyTransform(this,D,F)}getCombinedModelTransform(D,F){this.getModelTransform(D,F);null!=this.shaderTransformation&&this.shaderTransformation.applyTransform(this,D,F);return F}getCombinedLocalTransform(D,F){this._view.localTransform.getMat(D,F);null!=this.shaderTransformation&&
this.shaderTransformation.applyTransform(this,D,F)}getCombinedMaxScaleFactor(D){let F=this._view.modelScaleFactors.get(D,1);null!=this.shaderTransformation&&(this.shaderTransformation.scaleFactor(A,this,D),F*=Math.max(A[0],A[1],A[2]));return F}getCombinedMedianScaleFactor(D){let F=this._view.modelScaleFactors.get(D,0);if(null!=this.shaderTransformation){this.shaderTransformation.scaleFactor(A,this,D);D=A[0];var K=A[1];F*=Math.max(Math.min(D,K),Math.min(Math.max(D,K),A[2]))}return F}getModel(D,F){this._view.model.getMat(D,
F)}setFeatureAttribute(D,F){this._view.featureAttribute.setVec(D,F)}getFeatureAttribute(D,F){this._view.featureAttribute.getVec(D,F)}setColor(D,F){this._view.color.setVec(D,F)}setObjectAndLayerIdColor(D,F){this._view.objectAndLayerIdColor.setVec(D,F)}setVisible(D,F){F!==this.getVisible(D)&&(this._setStateFlag(D,b.StateFlags.VISIBLE,F),this.events.emit("instance-visibility-changed",{index:D}))}getVisible(D){return this._getStateFlag(D,b.StateFlags.VISIBLE)}setHighlight(D,F){F!==this.getHighlight(D)&&
(this._setStateFlag(D,b.StateFlags.HIGHLIGHT,F),this.events.emit("instance-highlight-changed"))}getHighlight(D){return this._getStateFlag(D,b.StateFlags.HIGHLIGHT)}getState(D){return this._view.state.get(D)}getLodLevel(D){return this._view.lodLevel.get(D)}countFlags(D){let F=0;for(let K=0;K<this._capacity;++K)this.getState(K)&D&&++F;return F}_setStateFlags(D,F){const K=this._view.state;F|=K.get(D);K.set(D,F)}_clearStateFlags(D,F){const K=this._view.state;F=K.get(D)&~F;K.set(D,F)}_setStateFlag(D,F,
K){K?this._setStateFlags(D,F):this._clearStateFlags(D,F)}_getStateFlag(D,F){return!!(this._view.state.get(D)&F)}_grow(){this._capacity=Math.max(y.initialCapacity,Math.floor(this._capacity*d.ReallocGrowthFactor));this._buffer=this._layout.createBuffer(this._capacity).copyFrom(this._buffer);this._view=new z(this._buffer)}_findSlot(){const D=this._view.state;let F=this._next;for(;D.get(F)&b.StateFlags.ALLOCATED;)F=F+1===this._capacity?0:F+1;this._next=F+1===this._capacity?0:F+1;return F}};a.__decorate([n.property({constructOnly:!0})],
b.InstanceData.prototype,"shaderTransformation",void 0);a.__decorate([n.property()],b.InstanceData.prototype,"_size",void 0);a.__decorate([n.property({readOnly:!0})],b.InstanceData.prototype,"size",null);b.InstanceData=a.__decorate([q.subclass("esri.views.3d.webgl-engine.lib.lodRendering.InstanceData")],b.InstanceData);const A=x.create(),C=m.create(),E=w.create(),B=w.create();b.InstanceDataView=z;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/RenderInstanceData":function(){define("exports ../../../../../core/arrayUtils ../../../../../geometry/support/buffer/BufferView ../Util ../VertexAttribute ./BackedBufferObject".split(" "),
function(b,a,c,d,f,n){class k{constructor(q){this.modelOriginHi=q.getField(f.VertexAttribute.INSTANCEMODELORIGINHI,c.BufferViewVec3f);this.modelOriginLo=q.getField(f.VertexAttribute.INSTANCEMODELORIGINLO,c.BufferViewVec3f);this.model=q.getField(f.VertexAttribute.INSTANCEMODEL,c.BufferViewMat3f);this.modelNormal=q.getField(f.VertexAttribute.INSTANCEMODELNORMAL,c.BufferViewMat3f);this.featureAttribute=q.getField(f.VertexAttribute.INSTANCEFEATUREATTRIBUTE,c.BufferViewVec4f);this.color=q.getField(f.VertexAttribute.INSTANCECOLOR,
c.BufferViewVec4u8);this.objectAndLayerIdColor=q.getField(f.VertexAttribute.INSTANCEOBJECTANDLAYERIDCOLOR,c.BufferViewVec4u8)}}class g{constructor(q,e){this._tailIndex=this._headIndex=0;this._firstIndex=null;this._captureFirstIndex=!0;this._updating=!1;this._prevHeadIndex=0;this._resized=!1;this._rctx=q;this._instanceBufferLayout=e;this._elementSize=e.stride;this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const q=
this._headIndex,e=this._tailIndex;return q>=e?q-e:q+this._capacity-e}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get usedMemory(){return this._buffer?.usedMemory??0}reset(){this._tailIndex=this._headIndex=0;this._firstIndex=null}startUpdateCycle(){this._captureFirstIndex=!0}beginUpdate(){d.assert(!this._updating,
"already updating");this._updating=!0;this._prevHeadIndex=this._headIndex}endUpdate(){d.assert(this._updating,"not updating");this.size<a.ReallocShrinkTreshold*this.capacity&&this._shrink();this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex);this._updating=!1}allocateHead(){d.assert(this._updating,"not updating");this.isFull&&this._grow();const q=this.headIndex;this._captureFirstIndex&&(this._firstIndex=q,this._captureFirstIndex=!1);
this._incrementHead();d.assert(this._headIndex!==this._tailIndex,"invalid pointers");return q}freeTail(){d.assert(this._updating,"not updating");d.assert(0<this.size,"invalid size");const q=this._tailIndex===this._firstIndex;this._incrementTail();q&&(this._firstIndex=this._tailIndex)}_grow(){this._resize(Math.max(64,Math.floor(this._capacity*a.ReallocGrowthFactor)))}_shrink(){this._resize(Math.max(64,Math.floor(this._capacity*a.ReallocShrinkFactor)))}_resize(q){d.assert(this._updating,"not updating");
if(q!==this._capacity){var e=new n(this._rctx,this._elementSize,q);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const m=this.size,l=this._compactInstances(e);d.assert(l===m,"invalid compaction");this._buffer.destroy();this._tailIndex=0;this._headIndex=l;this._prevHeadIndex=0}this._resized=!0;this._capacity=q;this._buffer=e;this._view=new k(this._instanceBufferLayout.createView(this._buffer.array))}}_compactInstances(q){const e=
this._headIndex,m=this._tailIndex;return m<e?(this._buffer.copyRange(m,e,q),e-m):m>e?(this._buffer.copyRange(m,this._capacity,q),0<e&&this._buffer.copyRange(0,e,q,this._capacity-m),e+(this._capacity-m)):0}_incrementHead(q=1){this._headIndex=(this._headIndex+q)%this._capacity}_incrementTail(q=1){this._tailIndex=(this._tailIndex+q)%this._capacity}_transferRange(q,e){q<e?this._buffer.transferRange(q,e):q>e&&(0<e&&this._buffer.transferRange(0,e),this._buffer.transferRange(q,this._capacity))}}b.RenderInstanceData=
g;b.RenderInstanceDataView=k;b.initialCapacity=64;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/BackedBufferObject":function(){define(["../../../../webgl/BufferObject","../../../../webgl/enums"],function(b,a){class c{constructor(d,f,n){this._elementSize=f;this._buffer=b.BufferObject.createVertex(d,a.Usage.STATIC_DRAW);this.resize(n)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get usedMemory(){return this._array.byteLength+
this._buffer.byteLength}copyRange(d,f,n,k=0){d=new Uint8Array(this.array,d*this.elementSize,(f-d)*this.elementSize);(new Uint8Array(n.array,k*this.elementSize)).set(d)}transferAll(){this._buffer.setData(this._array)}transferRange(d,f){d*=this._elementSize;f*=this._elementSize;this._buffer.setSubData(new Uint8Array(this._array),d,d,f)}resize(d){const f=d*this._elementSize,n=new ArrayBuffer(f);this._array&&(d>=this._capacity?(new Uint8Array(n)).set(new Uint8Array(this._array)):(new Uint8Array(n)).set((new Uint8Array(this._array)).subarray(0,
d*this._elementSize)));this._array=n;this._buffer.setSize(f);this._capacity=d}}return c})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceOctree":function(){define("exports ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/sphere ../../../support/mathUtils ../Octree".split(" "),function(b,a,c,d,f,n){class k extends n{constructor(g,q){super(e=>d.wrap(this._instanceData.view.boundingSphere.getVec(e,this._tmpSphere)),{maximumDepth:25});this._instanceData=g;this._boundingSphere=
q;this._tmpSphere=d.create();this._tmpMat4=a.create()}addInstance(g){const q=this._instanceData.view.boundingSphere,e=this._instanceData.getCombinedModelTransform(g,this._tmpMat4);c.transformMat4(this._tmpSphere,this._boundingSphere.center,e);this._tmpSphere[3]=this._boundingSphere.radius*f.maxScale(e);q.setVec(g,this._tmpSphere);this.add([g])}removeInstance(g){this.remove([g])}}b.InstanceOctree=k;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/LevelSelector":function(){define(["exports"],
function(b){class a{constructor(c,d){this._worldSpaceRadius=c;this._minScreenSpaceRadii=d}selectLevel(c,d,f){c=f.computeScreenPixelSizeAt(c);d=this._worldSpaceRadius*d/c;c=0;for(f=1;f<this._minScreenSpaceRadii.length;++f)d>=this._minScreenSpaceRadii[f]&&(c=f);return c}}b.LevelSelector=a;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodLevel":function(){define("exports ../../../../../core/arrayUtils ../../../../../core/promiseUtils ../../../../../chunks/vec3f64 ../../../../../geometry/support/aaBoundingBox ./LodComponentData".split(" "),
function(b,a,c,d,f,n){class k{static async create(g,q,e){const m=await Promise.allSettled(q.components.map(w=>g.controller.schedule(()=>new n.LodComponentData(g,w),e))),l=m.map(w=>"fulfilled"===w.status?w.value:null).filter(a.isSome);if(c.isAborted(e)||l.length!==m.length){l.forEach(w=>w.destroy());c.throwIfAborted(e);for(const w of m)if("rejected"===w.status)throw w.reason;}return new k(q.minScreenSpaceRadius,l)}constructor(g,q){this.minScreenSpaceRadius=g;this.components=q}destroy(){this.components.forEach(g=>
g.destroy())}intersect(g,q,e,m,l,w,v){this.components.forEach(x=>x.intersect(g,q,e,m,l,w,this.boundingSphere,v))}get boundingBox(){if(null==this._boundingBox){const g=f.empty();this.components.forEach(q=>{null!=q.boundingInfo&&(f.expandWithVec3(g,q.boundingInfo.bbMin),f.expandWithVec3(g,q.boundingInfo.bbMax))});this._boundingBox=g}return this._boundingBox}get boundingSphere(){if(null==this._boundingSphere){const g=this.boundingBox,q=d.create();f.center(g,q);this._boundingSphere={center:q,radius:.5*
f.diameter(g)}}return this._boundingSphere}get triangleCount(){return this.components.reduce((g,q)=>g+q.triangleCount,0)}}b.LodLevel=k;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodComponentData":function(){define("exports ../../../support/buffer/glUtil ../DefaultVertexAttributeLocations ../GLMaterials ../Intersector ../IntersectorInterfaces ../VertexArrayObject ./Intersector ../../../../webgl/BufferObject ../../../../webgl/enums".split(" "),
function(b,a,c,d,f,n,k,g,q,e){class m{constructor(l,w){const v=l.renderContext.rctx;w=w.geometry;this._materialRepository=l.materialRepository;w.material.setParameters({instancedDoublePrecision:!0});l=w.material.createBufferWriter();const x=l.vertexBufferLayout,p=l.elementCount(w),h=x.createBuffer(p);l.write(null,null,w,h,0);this.geometry=w;this.material=w.material;this.glMaterials=new d.GLMaterials(w.material,this._materialRepository);this.vertexBufferLayout=x;this.vbo=q.BufferObject.createVertex(v,
e.Usage.STATIC_DRAW,h.buffer);this.vao=new k.VertexArrayObject(v,c.Default3D,{geometry:a.glLayout(x)},{geometry:this.vbo});this.vertexCount=p}destroy(){this.glMaterials.dispose();this.vbo.dispose();this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(l,w,v,x,p,h,t,r){const u=this.geometry.id;this.material.intersect(this.geometry,l.transform.transform,l,v,x,(y,z,A,C,E)=>{0<=y&&(null==w||w(l.rayBegin,l.rayEnd,y))&&(A=new g.LodTarget(h.layerUid,
h.graphicUid(p),u,A,t,r),(null==l.results.min.drapedLayerOrder||E>=l.results.min.drapedLayerOrder)&&(null==l.results.min.dist||y<l.results.min.dist)&&l.results.min.set(n.IntersectorType.LOD,A,y,z,l.transform.transform,E),l.options.store!==n.StoreResults.MIN&&(null==l.results.max.drapedLayerOrder||E>=l.results.max.drapedLayerOrder)&&(null==l.results.max.dist||y>l.results.max.dist)&&l.results.max.set(n.IntersectorType.LOD,A,y,z,l.transform.transform,E),l.options.store===n.StoreResults.ALL&&(C=f.newIntersectorResult(l.results.min.ray),
C.set(n.IntersectorType.LOD,A,y,z,l.transform.transform,E),l.results.all.push(C)))})}}b.LodComponentData=m;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/Intersector":function(){define(["exports","../IntersectorInterfaces","../IntersectorTarget","../intersectorUtils"],function(b,a,c,d){class f extends c.Graphic3DTarget{constructor(n,k,g,q,e,m){super(n,k);this.layerUid=n;this.graphicUid=k;this.geometryId=g;this.triangleNr=q;this.baseBoundingSphere=
e;this.numLodLevels=m}}b.LodTarget=f;b.isLodIntersectorResult=function(n){return d.isValidIntersectorResult(n)&&n.intersector===a.IntersectorType.LOD&&!!n.target};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DPathSymbolLayer":function(){define("exports ../../../../core/has ../../../../core/Error ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection/projectBuffer ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/DoubleArray ./elevationAlignmentUtils ./Graphics3DObject3DGraphicLayer ./Graphics3DPathSymbolLayerConstants ./Graphics3DSymbolLayer ./graphicUtils ./interfaces ../support/FastSymbolUpdates ../../support/ElevationProvider ../../webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Path ../../webgl-engine/lib/PathBuilder ../../webgl-engine/lib/PathCapBuilder ../../webgl-engine/lib/PathExtruder ../../webgl-engine/lib/PathGeometry ../../webgl-engine/lib/PathGeometryData ../../webgl-engine/lib/pathGeometryUtils ../../webgl-engine/lib/PathProfile ../../webgl-engine/lib/PathVertex ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/PathMaterial".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A,C,E,B,D,F,K,L,G,O,P,J,R){function X(H,S,I){const {origin:Q,positions:N}=H;let T=H.offset;switch(S){default:case F.UpVectorAlignment.World:for(const aa of H.vertices)Y[0]=N[T++]+Q[0],Y[1]=N[T++]+Q[1],Y[2]=N[T++]+Q[2],I.worldUpAtPosition(Y,Y),aa.setFrameFromUpVector(Y);break;case F.UpVectorAlignment.Path:Y[0]=N[T]+Q[0],Y[1]=N[T+1]+Q[1],Y[2]=N[T+2]+Q[2],I.worldUpAtPosition(Y,Y),L.computeMinimumRotationTangentFrame(H,Y)}}function U(H,S,I){switch(H){case "symbol-value":return I;
case "proportional":return S;default:return H}}const M=["polyline"];class V extends p.Graphics3DSymbolLayer{constructor(H,S,I,Q){super(H,S,I,Q);this._intrinsicSize=k.fromValues(1,1);this._upVectorAlignment=F.UpVectorAlignment.Path;this._stencilWidth=.1;this.usedMemory=0;this.ensureDrapedStatus(!1)}async doLoad(){var H=null!=this.symbolLayer.width?this.symbolLayer.width:this.symbolLayer.height;const S=null!=this.symbolLayer.height?this.symbolLayer.height:H;this._vvConvertOptions=new r.ConvertOptions({size:!0,
color:!0,rotation:!1,opacity:!0},[1,1,1],[H,1,S],this._context.renderCoordsHelper.unitInMeters);this._fastUpdates=0<this._context.renderer?.visualVariables?.length?r.initFastSymbolUpdatesState(this._context.renderer,this._vvConvertOptions):null;var I=this.symbolLayer.anchor||"center";this._upVectorAlignment="heading"===this.symbolLayer.profileRotation?F.UpVectorAlignment.World:F.UpVectorAlignment.Path;var Q=this.symbolLayer.profile||"circle";switch(Q){default:case "circle":this._profile=G.circleProfiles[I];
break;case "quad":this._profile=G.quadProfiles[I]}switch(this.symbolLayer.join){case "round":this._extruder=new D.MiterExtruder(0,x.pathNumRoundJoinSubdivisions);break;case "bevel":this._extruder=new D.MiterExtruder(0,1);break;case "miter":this._extruder=new D.MiterExtruder(.8*Math.PI,1);break;default:this._extruder=new D.SimpleExtruder}I=this.symbolLayer.cap||"butt";switch(I){case "none":this._startCap=new B.NoCapBuilder;this._endCap=new B.NoCapBuilder;break;default:this._startCap=new B.TriangulationCapBuilder(this._profile,
0);this._endCap=new B.TriangulationCapBuilder(this._profile,0,!0);break;case "square":this._startCap=new B.TriangulationCapBuilder(this._profile,-.5);this._endCap=new B.TriangulationCapBuilder(this._profile,.5,!0);break;case "round":Q="quad"===Q,this._startCap=new B.RoundCapBuilder({profile:this._profile,flip:!1,breakNormals:Q,subdivisions:x.pathNumRoundCapExtrusionSubdivisions}),this._endCap=new B.RoundCapBuilder({profile:this._profile,flip:!0,breakNormals:Q,subdivisions:x.pathNumRoundCapExtrusionSubdivisions})}var N=
this._getCombinedOpacityAndColor(this.symbolLayer?.material?.color);Q=q.fromArray(N);N=N[3];const T=1>N||this.needsDrivenTransparentPass;I={diffuse:Q,ambient:Q,opacity:N,transparent:T,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:T||"none"===I?z.CullFaceOptions.None:z.CullFaceOptions.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(n.set(this._intrinsicSize,H,S),!h.isValidSize(this._intrinsicSize[0])||!h.isValidSize(this._intrinsicSize[1])))throw new c("graphics3dpathsymbollayer:invalid-size",
"Symbol sizes may not be negative values");this._fastUpdates?.visualVariables.size||n.scale(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters);this._fastUpdates?(H={...I,...this._fastUpdates.materialParameters,size:k.fromArray(this._intrinsicSize)},this._materials[0]=new R.PathMaterial(H)):(I.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,I.normalType=y.NormalType.Compressed,this._materials[0]=new J.DefaultMaterial(I));this._materials[0].setParameters({usePBR:this._context.physicalBasedRenderingEnabled,
isSchematic:!0});this._context.stage.add(this._materials[0])}destroy(){super.destroy();this._context.stage.remove(this._materials[0]);this._materials[0]=null;this._materials.length=0}createGraphics3DGraphic(H){const S=H.graphic;if(!this._validateGeometry(S.geometry,M,this.symbolLayer.type))return null;const I=this.setGraphicElevationContext(S);return this._createAs3DShape(S,H.renderingInfo,I,S.uid)}layerOpacityChanged(){const H=this._getCombinedOpacity(this.symbolLayer?.material?.color),S=1>H||this.needsDrivenTransparentPass;
this._materials[0]?.setParameters({opacity:H,transparent:S})}layerElevationInfoChanged(H,S){return this.updateGraphics3DGraphicElevationInfo(H,S,w.needsElevationUpdates3D)}slicePlaneEnabledChanged(){this._materials[0]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){this._materials[0]?.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0});return!0}applyRendererDiff(H,S){for(const I in H.diff)switch(I){case "visualVariables":if(r.updateFastSymbolUpdatesState(this._fastUpdates,
S,this._vvConvertOptions))this._materials[0]?.setParameters(this._fastUpdates.materialParameters);else return t.ApplyRendererDiffResult.RecreateSymbol;break;default:return t.ApplyRendererDiffResult.RecreateSymbol}return t.ApplyRendererDiffResult.FastUpdate}_getVertexData(H){let S=0;const I=H.paths,Q=[],N=H.spatialReference,T=this._context.elevationProvider.spatialReference,aa=this._context.renderCoordsHelper.spatialReference;for(var Z of I)S+=Z.length;Z=l.newDoubleArray(3*S);let da=0;for(const fa of I){Q.push({offset:da,
numVertices:fa.length});for(const ka of fa)Z[da++]=ka[0],Z[da++]=ka[1],Z[da++]=H.hasZ?ka[2]:0}if(null!=T&&!N.equals(T)&&!e.projectBuffer(Z,N,0,Z,T,0,S))return null;null==T||T.equals(aa)?H=l.doubleArrayFrom(Z):(H=l.newDoubleArray(3*S),e.projectBuffer(Z,T,0,H,aa,0,S));return{pathVertexDataInfos:Q,vertexDataES:Z,vertexDataRS:H}}_createAs3DShape(H,S,I,Q){this.usedMemory=0;var N=H.geometry;const T=this._getVertexData(N);if(null==T)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),
null;if(0===T.pathVertexDataInfos.length)return 0!==N.paths.length&&N.paths.some(ca=>0<ca.length)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)"),null;var aa=[];N=N.spatialReference;const Z=m.create(),da=this._context.renderCoordsHelper,fa=new u.SamplePosition(T.vertexDataES);for(const ca of T.pathVertexDataInfos){var ka=ca.numVertices;if(!(2>ka)){var ha=ca.offset;if(null!=this._context.clippingExtent&&(m.empty(Z),m.expandWithBuffer(Z,T.vertexDataES,ha,
ka),!m.intersectsClippingArea(Z,this._context.clippingExtent)))continue;var ba=[];ka=ha+3*ka;for(var ea=ha;ea<ka;ea+=3){fa.offset=ea;const ia=w.evaluateElevationAlignmentAtPoint(fa,this._context.elevationProvider,I,da);g.set(Y,T.vertexDataRS[ea],T.vertexDataRS[ea+1],T.vertexDataRS[ea+2]);da.setAltitude(Y,ia);T.vertexDataRS[ea]=Y[0];T.vertexDataRS[ea+1]=Y[1];T.vertexDataRS[ea+2]=Y[2];ba.push(O.newPathVertex(this._upVectorAlignment))}ha=new C.Path(ba,T.vertexDataES,T.vertexDataRS,ha);X(ha,this._upVectorAlignment,
this._context.renderCoordsHelper);ha=new E.PathBuilder(ha,this._profile,this._extruder,this._startCap,this._endCap);ba=null;this._fastUpdates?(ea=this._fastUpdates.visualVariables,ba=r.getAttributeValue(ea.size?.field,H)??0,ka=r.getAttributeValue(ea.color?.field,H)??0,ea=r.getAttributeValue(ea.opacity?.field,H)??0,ba=new K.FastUpdatePathGeometry(ha,ba,ka,ea)):(ba=[this._intrinsicSize[0],this._intrinsicSize[1]],this._drivenProperties.size&&(ka=S.size,ba[0]*=U(ka[0],"symbol-value"===ka[2]?this.symbolLayer.height||
0:ka[2],this.symbolLayer.width||0),ba[1]*=U(ka[2],"symbol-value"===ka[0]?this.symbolLayer.width||0:ka[0],this.symbolLayer.height||0)),ka=void 0,this._drivenProperties.color&&(ka=S.color),this._drivenProperties.opacity&&null!=S.opacity&&(ka=ka?[ka[0],ka[1],ka[2],S.opacity]:[1,1,1,S.opacity]),ea=new K.StaticPathGeometry(ha),ea.bake(ba),ka&&ea.bakeVertexColors(ka),ba=ea);ka=ba.createGeometryData();ea=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:Q,layerUid:this._context.layer.uid});
ba=new F.PathGeometry(this._materials[0],ka,ba,N,this._stencilWidth,ea);ba.transformation=d.translate(f.create(),f.IDENTITY,ha.path.origin);aa.push(ba);this.usedMemory+=ha.usedMemory}}if(0===aa.length)return null;H=new A.Object3D({geometries:aa,layerUid:this._context.layer.uid,graphicUid:Q});aa=new v.Graphics3DObject3DGraphicLayer(this,H,aa,null,null,(ca,ia,la,oa,na)=>{ia=this._upVectorAlignment;ca=ca.stageObject;la=ca.geometries;var ra=0;for(const ja of la){if(!F.isPathGeometry(ja))continue;const qa=
ja.path,ua=qa.builder.path;var ta=ua,ma=oa,pa=na;let wa=0;const {origin:za,vertices:Aa,positions:Fa,positionsES:Da}=ta,Ha=ta.offset+3*Aa.length;for(let Ka=ta.offset;Ka<Ha;Ka+=3)g.set(Y,Da[Ka],Da[Ka+1],Da[Ka+2]),ma(Y,W),wa+=W.sampledElevation,Y[0]=Fa[Ka]+za[0],Y[1]=Fa[Ka+1]+za[1],Y[2]=Fa[Ka+2]+za[2],pa.setAltitude(Y,W.z),Fa[Ka]=Y[0]-za[0],Fa[Ka+1]=Y[1]-za[1],Fa[Ka+2]=Y[2]-za[2];ta.updatePathVertexInformation();ra+=wa/Aa.length;ia!==F.UpVectorAlignment.World&&X(ua,ia,na);qa.onPathChanged(ja);ja.invalidateBoundingInfo();
ca.geometryVertexAttributeUpdated(ja,P.VertexAttribute.POSITION)}return ra/la.length},I);aa.alignedSampledElevation=0;aa.needsElevationUpdates=w.needsElevationUpdates3D(I.mode);return aa}}const Y=q.create(),W=new w.SampleElevationInfo;b.Graphics3DPathSymbolLayer=V;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Path":function(){define(["exports","../../../../core/typedArrayUtil","../../../../chunks/vec3","../../../../chunks/vec3f64","../../../../geometry/support/FloatArray"],
function(b,a,c,d,f){class n{constructor(k,g,q,e){this.vertices=k;this.positionsES=g;this.offset=e;var m=k.length;e=this.offset+3*Math.floor(m/2);k=q[e];g=q[e+1];e=q[e+2];this.origin=d.fromValues(k,g,e);this.positions=f.newFloatArray(3*m);m=this.offset+3*m;for(let l=this.offset;l<m;l+=3)this.positions[l]=q[l]-k,this.positions[l+1]=q[l+1]-g,this.positions[l+2]=q[l+2]-e;this.updatePathVertexInformation()}get usedMemory(){return a.estimateSize(this.positions)}updatePathVertexInformation(){const k=this.vertices.length;
var g=this.vertices[0];let q=this.offset;const e=this.positions;g.vRight[0]=e[q+3]-e[q];g.vRight[1]=e[q+4]-e[q+1];g.vRight[2]=e[q+5]-e[q+2];q+=3;let m=c.length(g.vRight);g.vMinSiblingLength=m;c.normalize(g.vRight,g.vRight);var l=g;for(g=1;g<k;++g){const w=this.vertices[g];w.vLeft=l.vRight;g<k-1?(w.vRight[0]=e[q+3]-e[q],w.vRight[1]=e[q+4]-e[q+1],w.vRight[2]=e[q+5]-e[q+2],l=c.length(w.vRight),w.vMinSiblingLength=Math.min(m,l),m=l,c.normalize(w.vRight,w.vRight)):(c.copy(w.vRight,w.vLeft),w.vMinSiblingLength=
m);l=w;q+=3}}}b.Path=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/PathBuilder":function(){define(["exports","../../../../core/typedArrayUtil","../../../../geometry/support/FloatArray","../../../../geometry/support/Indices"],function(b,a,c,d){class f{constructor(n,k,g,q,e,m={}){this.path=n;this.profile=k;this.extruder=g;this.startCap=q;this.endCap=e;this.options=m;this._extrusionVertexCount=0;q=this.path.vertices.length-2;this.numExtrusionProfiles=
g.numProfilesPerJoin()*q+2;this.numVerticesTotal=k.vertices.length*this.numExtrusionProfiles;this.startCap.vertexBufferStart=this.numVerticesTotal;this.numVerticesTotal+=this.startCap.numVertices;this.endCap.vertexBufferStart=this.numVerticesTotal;this.numVerticesTotal+=this.endCap.numVertices;this.pathVertexData=d.newIntArray(1*this.numVerticesTotal);this.profileRightAxes=c.newFloatArray(4*this.numVerticesTotal);this.profileUpAxes=c.newFloatArray(4*this.numVerticesTotal);this.profileVertexAndNormals=
c.newFloatArray(4*this.numVerticesTotal);this.positions=c.floatSubArray(n.positions,n.offset,3*n.vertices.length);this._rebuildGeometry();this.buildTopology()}get usedMemory(){return a.estimateSize(this.pathVertexData,this.profileRightAxes,this.profileUpAxes,this.profileVertexAndNormals)+this.path.usedMemory+this.profile.usedMemory}emitVertex(n,k,g,q,e){const m=4*this._extrusionVertexCount;this.profileRightAxes[m]=k.right[0];this.profileRightAxes[m+1]=k.right[1];this.profileRightAxes[m+2]=k.right[2];
this.profileUpAxes[m]=k.up[0];this.profileUpAxes[m+1]=k.up[1];this.profileUpAxes[m+2]=k.up[2];this.profileVertexAndNormals[m]=g[0];this.profileVertexAndNormals[m+1]=g[1];this.profileVertexAndNormals[m+2]=q[0];this.profileVertexAndNormals[m+3]=q[1];this.pathVertexData[this._extrusionVertexCount]=n;e?(n=this.path.vertices[n],k=n.maxStretchDistance,this.profileRightAxes[m+3]=n.rotationRight[0]*k,this.profileUpAxes[m+3]=n.rotationRight[1]*k):(this.profileRightAxes[m+3]=0,this.profileUpAxes[m+3]=0);++this._extrusionVertexCount}emitCapVertex(n,
k,g,q,e,m){const l=4*this._extrusionVertexCount;this.profileRightAxes[l]=k.right[0];this.profileRightAxes[l+1]=k.right[1];this.profileRightAxes[l+2]=k.right[2];this.profileRightAxes[l+3]=e;this.profileUpAxes[l]=k.up[0];this.profileUpAxes[l+1]=k.up[1];this.profileUpAxes[l+2]=k.up[2];this.profileUpAxes[l+3]=m;this.profileVertexAndNormals[l]=g[0];this.profileVertexAndNormals[l+1]=g[1];this.profileVertexAndNormals[l+2]=q[0];this.profileVertexAndNormals[l+3]=q[1];this.pathVertexData[this._extrusionVertexCount]=
n;++this._extrusionVertexCount}_rebuildGeometry(){this._extrusionVertexCount=0;const {positions:n,offset:k,vertices:g}=this.path;this.positions=c.floatSubArray(n,k,3*g.length);let q=0;const e=(l,w,v,x,p)=>this.emitCapVertex(q,l,w,v,x,p),m=(l,w,v,x)=>this.emitVertex(q,l,w,v,x);this.startCap.rebuildConnectingProfileGeometry(g[q],this.profile,e);for(q=1;q<g.length-1;++q)this.extruder.extrude(g[q],this.profile,m);this.endCap.rebuildConnectingProfileGeometry(g[q],this.profile,e);q=0;this.startCap.rebuildCapGeometry(g[q],
e);q=g.length-1;this.endCap.rebuildCapGeometry(g[q],e)}buildTopology(){const n=this.profile.vertices.length,k=this.profile.numSegments,g=this.numExtrusionProfiles-1;var q=k*g*6;this.startCap.indexBufferStart=q;this.startCap.firstProfileVertexIndex=0;q+=this.startCap.numIndices;this.endCap.indexBufferStart=q;this.endCap.firstProfileVertexIndex=n*(this.numExtrusionProfiles-1);const e=[],m=[],l=[];q=(w,v,x)=>{e.push(w);e.push(v);e.push(x);m.push(w);m.push(v);m.push(x);l.push(this.pathVertexData[w]);
l.push(this.pathVertexData[v]);l.push(this.pathVertexData[x])};for(let w=0;w<k;++w){const v=this.profile.indices[2*w],x=this.profile.indices[2*w+1];for(let p=0;p<g;++p){const h=p*n+v,t=(p+1)*n+x,r=p*n+x;q(h,(p+1)*n+v,t);q(h,t,r)}}this.startCap.buildTopology(this.path.vertices[0],q);this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],q);this.vertexIndices=d.compactIndices(e);this.normalIndices=d.compactIndices(m);this.pathVertexIndices=d.compactIndices(l)}onPathChanged(){this._rebuildGeometry()}}
b.PathBuilder=f;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/PathCapBuilder":function(){define(["exports","../../../../chunks/vec2","../../../../chunks/vec2f64"],function(b,a,c){class d{rebuildConnectingProfileGeometry(e,m,l){for(let w=0;w<m.vertices.length;++w)l(e.frame,m.vertices[w],m.normals[w],0,0)}}class f extends d{constructor(){super();this.numIndices=this.numVertices=0}rebuildCapGeometry(){}buildTopology(){}}class n extends d{constructor(e,
m=0,l=!1){super();this.profile=e;this.profilePlaneOffset=m;this.flip=l}get numVertices(){return this.profile.vertices.length}get numIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(e,m,l){const w=this.profilePlaneOffset;for(let v=0;v<m.vertices.length;++v)l(e.frame,m.vertices[v],m.normals[v],w,0)}rebuildCapGeometry(e,m){const l=this.profile,w=this.flip?1:-1,v=this.profilePlaneOffset,x=q;a.set(x,0,0);for(let p=0;p<l.vertices.length;++p)m(e.frame,l.vertices[p],x,v,w)}buildTopology(e,
m){e=this.profile;const l=this.vertexBufferStart+e.indices[0];for(let w=1;w<e.numSegments;++w){const v=this.vertexBufferStart+e.indices[2*w],x=this.vertexBufferStart+e.indices[2*w+1];this.flip?m(x,v,l):m(l,v,x)}}}class k extends d{constructor(e){super();this.flip=!1;this.sign=0;this.breakNormals=!1;this.numSegments=3;this.profile=e.profile;this.sign=(this.flip=e.flip)?1:-1;this.breakNormals=e.breakNormals;this.numSegments=e.subdivisions}get numVertices(){let e=this.profile.vertices.length*(this.numSegments-
1)+this.profile.poles.length;this.breakNormals&&(e+=this.profile.vertices.length);return e}get numIndices(){let e;const m=this.profile;e=2*m.numSegments*(this.numSegments-1);for(let l=0;l<m.numSegments;++l)e=m.poleIndices[m.indices[2*l]]===m.poleIndices[m.indices[2*l+1]]?e+1:e+2;return 3*e}rebuildCapGeometry(e,m){const l=this.profile;e=e.frame;const w=.5*this.sign,v=g,x=q;a.set(x,0,0);for(var p of l.poles)p.normal?m(e,p.position,p.normal,w,0):m(e,p.position,x,w,this.sign);if(this.breakNormals)for(p=
0;p<l.vertices.length;++p)m(e,l.vertices[p],l.normals[p],0,0);for(p=0;p<this.numSegments-1;++p){var h=(1-(p+1)/this.numSegments)*Math.PI*.5;const t=Math.sin(h);h=Math.cos(h);for(let r=0;r<l.vertices.length;++r){const u=l.poles[l.poleIndices[r]];a.subtract(v,l.vertices[r],u.position);a.scale(v,v,t);u.normal?(a.add(v,v,u.position),m(e,v,u.normal,w*h,0)):(a.normalize(x,v),a.scale(x,x,t),a.add(v,v,u.position),m(e,v,x,w*h,this.sign*h))}}}buildTopology(e,m){e=this.profile;const l=this.breakNormals?this.vertexBufferStart+
e.poles.length:this.firstProfileVertexIndex,w=this.breakNormals?this.vertexBufferStart+e.poles.length+e.vertices.length:this.vertexBufferStart+e.poles.length;for(let v=0;v<e.numSegments;++v){const x=e.indices[2*v],p=e.indices[2*v+1],h=this.vertexBufferStart+e.poleIndices[x],t=this.vertexBufferStart+e.poleIndices[p];let r=l+x,u=l+p;for(let y=0;y<this.numSegments-1;++y){const z=w+y*e.vertices.length+x,A=w+y*e.vertices.length+p;this.flip?(m(z,u,r),m(u,z,A)):(m(r,u,z),m(A,z,u));r=z;u=A}this.flip?(m(h,
u,r),h!==t&&m(h,t,u)):(m(r,u,h),h!==t&&m(u,t,h))}}}const g=c.create(),q=c.create();b.NoCapBuilder=f;b.PathCapBuilder=d;b.RoundCapBuilder=k;b.TriangulationCapBuilder=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/PathExtruder":function(){define("exports ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64".split(" "),function(b,a,c,d,f,n,k){class g{}
class q{numProfilesPerJoin(){return 1}extrude(x,p,h){for(let t=0;t<p.vertices.length;++t)h(x.frame,p.vertices[t],p.normals[t],!1)}}class e{constructor(x,p){this.cutoffAngle=x;this.numBendSubdivisions=p}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(x,p,h){var t=v;const {rotationAngle:r,rotationRight:u,frame:y}=x;if(Math.abs(r)>=this.cutoffAngle){var z=x.rotationFrameUp;for(var A=0;A<this.numBendSubdivisions+1;++A){a.fromRotation(w,.5*-r+A*r/this.numBendSubdivisions,z);var C=t,E=y,
B=w;n.transformMat4(C.up,E.up,B);n.transformMat4(C.right,E.right,B);for(C=0;C<p.vertices.length;++C)0<=d.dot(p.vertices[C],u)*r?h(t,p.vertices[C],p.normals[C],!1):(E=x.applyMiterStretch(l,p.vertices[C]),h(y,E,p.normals[C],!0))}}else for(t=0;t<this.numBendSubdivisions+1;++t)for(z=0;z<p.vertices.length;++z)A=0<=d.dot(p.vertices[z],u)*r,C=x.applyMiterStretch(l,p.vertices[z]),h(y,C,p.normals[z],!A)}}class m{constructor(){this.up=k.create();this.right=k.create()}}const l=f.create(),w=c.create(),v=new m;
b.Frame2D=m;b.MiterExtruder=e;b.PathExtruder=g;b.SimpleExtruder=q;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/PathGeometry":function(){define(["exports","./ContentObjectType","./Geometry"],function(b,a,c){class d extends c.Geometry{constructor(f,n,k,g,q,e){super(f,n,null,a.ContentObjectType.Mesh,e);this.path=k;this.geometrySR=g;this.stencilWidth=q}}b.UpVectorAlignment=void 0;(function(f){f[f.World=0]="World";f[f.Path=1]="Path"})(b.UpVectorAlignment||
(b.UpVectorAlignment={}));b.PathGeometry=d;b.isPathGeometry=function(f){return"path"in f};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/PathGeometryData":function(){define("exports ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/support/FloatArray ../../../../geometry/support/Indices ./Attribute ./Normals ./VertexAttribute ../materials/internal/MaterialUtil".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l){class w{constructor(A){this.builder=A}onPathChanged(A){this.builder.onPathChanged()}}class v extends w{constructor(A){super(A);this.vertexAttributeColor=n.fromValues(255,255,255,255);this.size=[];this.vertexAttributePosition=k.newFloatArray(3*this.builder.numVerticesTotal);this.vertexAttributeNormal=new Int16Array(2*this.builder.numVerticesTotal)}bakeVertexColors(A){this.vertexAttributeColor[0]=255*A[0];this.vertexAttributeColor[1]=255*A[1];this.vertexAttributeColor[2]=
255*A[2];this.vertexAttributeColor[3]=255*(3<A.length?A[3]:1)}bake(A){this.size=A;const {numVerticesTotal:C,pathVertexData:E,path:B,positions:D,profileRightAxes:F,profileUpAxes:K,profileVertexAndNormals:L}=this.builder;for(let J=0;J<C;++J){var G=E[J],O=0===G||G===B.vertices.length-1;G*=3;const R=u;let X=0,U=0;const M=4*J,V=d.set(y,F[M],F[M+1],F[M+2]),Y=d.set(z,K[M],K[M+1],K[M+2]);var P=a.set(p,L[M]*A[0],L[M+1]*A[1]);if(O)d.cross(R,Y,V),X=F[M+3]*A[0],U=K[M+3];else{O=h;const W=t;a.set(O,F[M+3],K[M+
3]);const H=a.length(O);a.normalize(O,O);const S=a.dot(P,O);if(Math.abs(S)>H){a.set(W,-O[1],O[0]);const I=a.dot(P,W);a.scale(O,O,H*Math.sign(S));a.scale(W,W,I);a.add(P,O,W)}d.set(R,0,0,0)}P=d.set(r,V[0]*P[0]+Y[0]*P[1],V[1]*P[0]+Y[1]*P[1],V[2]*P[0]+Y[2]*P[1]);O=3*J;this.vertexAttributePosition[O]=D[G]+P[0]+R[0]*X;this.vertexAttributePosition[O+1]=D[G+1]+P[1]+R[1]*X;this.vertexAttributePosition[O+2]=D[G+2]+P[2]+R[2]*X;G=a.set(p,L[M+2],L[M+3]);e.compressNormal(this.vertexAttributeNormal,J,V[0]*G[0]+
Y[0]*G[1]+R[0]*U,V[1]*G[0]+Y[1]*G[1]+R[1]*U,V[2]*G[0]+Y[2]*G[1]+R[2]*U)}}createGeometryData(){const A=this.builder.vertexIndices.length,{normalIndices:C,vertexIndices:E}=this.builder;return[[m.VertexAttribute.POSITION,new q.Attribute(this.vertexAttributePosition,E,3,!0)],[m.VertexAttribute.NORMALCOMPRESSED,new q.Attribute(this.vertexAttributeNormal,C,2,!0)],[m.VertexAttribute.COLOR,new q.Attribute(this.vertexAttributeColor,g.getZeroIndexArray(A),4)]]}onPathChanged(A){super.onPathChanged(A);this.bake(this.size)}intersect(A,
C,E){const B=this.builder.vertexIndices,D=new q.Vertices(this.vertexAttributePosition,3);l.intersectTriangles(A,C,0,B.length/3,B,D,void 0,void 0,E)}}class x extends w{constructor(A,C,E,B){super(A);this.sizeAttributeValue=C;this.colorAttributeValue=E;this.opacityAttributeValue=B;this.vvData=null;this.baked=new v(A);this.vvData=k.newFloatArray(4*this.builder.path.vertices.length);for(A=0;A<this.builder.path.vertices.length;++A)this.vvData[4*A]=C,this.vvData[4*A+1]=E,this.vvData[4*A+2]=B,this.vvData[4*
A+3]=0===A||A===this.builder.path.vertices.length-1?1:0}createGeometryData(){const {positions:A,profileRightAxes:C,profileUpAxes:E,profileVertexAndNormals:B,pathVertexIndices:D,vertexIndices:F}=this.builder;return[[m.VertexAttribute.POSITION,new q.Attribute(A,D,3,!0)],[m.VertexAttribute.PROFILERIGHT,new q.Attribute(C,F,4,!0)],[m.VertexAttribute.PROFILEUP,new q.Attribute(E,F,4,!0)],[m.VertexAttribute.PROFILEVERTEXANDNORMAL,new q.Attribute(B,F,4,!0)],[m.VertexAttribute.FEATUREVALUE,new q.Attribute(this.vvData,
D,4,!0)]]}onPathChanged(A){super.onPathChanged(A);if(A=A.getMutableAttribute(m.VertexAttribute.POSITION))A.data=this.builder.positions}}const p=c.create(),h=c.create(),t=c.create(),r=f.create(),u=f.create(),y=f.create(),z=f.create();b.FastUpdatePathGeometry=x;b.PathGeometryData=w;b.StaticPathGeometry=v;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/pathGeometryUtils":function(){define("exports ../../../../chunks/vec2 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/plane ../../../../geometry/support/ray ./GeometryUtil".split(" "),
function(b,a,c,d,f,n,k){const g=d.create();b.computeMinimumRotationTangentFrame=function(q,e){let m=null;const l=q.vertices.length,w=d.create(),v=d.create(),x=d.create(),p=d.create(),h=d.create(),t=d.create(),r=f.create();let u=q.vertices[0];c.copy(v,e);c.set(w,0,1,0);k.makeOrthoBasisDirUpFallback(u.vRight,v,w,w,x,v,.99619469809);c.copy(u.frame.up,v);c.copy(u.frame.right,x);e=q.positions;let y=q.offset;m=u;for(let A=1;A<l;++A){u=q.vertices[A];c.add(h,u.vLeft,u.vRight);var z=c.length(h);0<z?(z=1/Math.sqrt(z),
h[0]*=z,h[1]*=z,h[2]*=z):(h[0]=u.vRight[0],h[1]=u.vRight[1],h[2]=u.vRight[2]);t[0]=e[y]+m.frame.up[0];t[1]=e[y+1]+m.frame.up[1];t[2]=e[y+2]+m.frame.up[2];y+=3;z=c.set(g,e[y],e[y+1],e[y+2]);f.fromPositionAndNormal(z,h,r);f.intersectRay(r,n.wrap(t,u.vLeft),p)?(p[0]-=e[y],p[1]-=e[y+1],p[2]-=e[y+2],c.normalize(v,p),c.cross(x,h,v),c.normalize(x,x)):k.makeOrthoBasisDirUpFallback(h,m.frame.up,m.frame.right,w,x,v,.99619469809);c.copy(u.frame.up,v);c.copy(u.frame.right,x);m=u}};b.profileSpaceToVertexSpace=
function(q,e,m){q[0]=m[0]*e.right[0]+m[1]*e.up[0];q[1]=m[0]*e.right[1]+m[1]*e.up[1];q[2]=m[0]*e.right[2]+m[1]*e.up[2]};b.vertexSpaceToProfileSpace=function(q,e,m){a.set(q,c.dot(m,e.right),c.dot(m,e.up))};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/PathProfile":function(){define(["exports","../../../../core/typedArrayUtil","../../../../chunks/vec2f64","../../layers/graphics/Graphics3DPathSymbolLayerConstants"],function(b,a,c,d){function f(m){const l=
d.pathNumCircleProfileSubdivisions,w=new k,v={v0:0,v1:0};w.addPole(c.fromValues(0,0));for(var x=0;x<l;++x){var p=2*x*Math.PI/l,h=Math.cos(p);const t=Math.sin(p);p=c.fromValues(.5*h,.5*t);h=c.fromValues(h,t);w.addVertex(p,h)}for(x=0;x<l-1;++x)w.addSegment({v0:x,v1:x+1},v);w.addSegment({v0:l-1,v1:0},v);"center"!==m&&(m=g[m],w.translate(m[0],m[1]));return w}function n(m){const l=new k,w=c.fromValues(-.5,-.5),v=c.fromValues(.5,-.5),x=c.fromValues(.5,.5),p=c.fromValues(-.5,.5),h=c.fromValues(0,-1),t=c.fromValues(1,
0),r=c.fromValues(0,1),u=c.fromValues(-1,0);l.addPole(c.fromValues(0,.5),r);l.addPole(c.fromValues(0,.5));l.addPole(c.fromValues(0,-.5));l.addPole(c.fromValues(0,-.5),h);l.addVertex(w,h);l.addVertex(v,h);l.addSegment({v0:0,v1:1},{v0:3,v1:3});l.addVertex(v,t);l.addVertex(x,t);l.addSegment({v0:2,v1:3},{v0:2,v1:1});l.addVertex(x,r);l.addVertex(p,r);l.addSegment({v0:4,v1:5},{v0:0,v1:0});l.addVertex(p,u);l.addVertex(w,u);l.addSegment({v0:6,v1:7},{v0:1,v1:2});"center"!==m&&(m=g[m],l.translate(m[0],m[1]));
return l}class k{constructor(){this.vertices=[];this.normals=[];this.indices=[];this.poles=[];this.poleIndices=[]}addVertex(m,l){this.vertices.push(c.clone(m));this.normals.push(c.clone(l));return this.vertices.length-1}addPole(m,l=null){this.poles.push({position:c.clone(m),normal:l?c.clone(l):null});return this.poles.length-1}addSegment(m,l=null){this.indices.push(m.v0);this.indices.push(m.v1);l&&(this.poleIndices.push(l.v0),this.poleIndices.push(l.v1))}get numSegments(){return this.indices.length/
2}translate(m,l){for(const w of this.vertices)w[0]+=m,w[1]+=l;for(const w of this.poles)w.position[0]+=m,w.position[1]+=l}get usedMemory(){return this.vertices.length*a.estimateSize(this.vertices[0])*2+a.estimateSize(this.indices)}}const g={top:[0,-.5],bottom:[0,.5]},q={center:f("center"),top:f("top"),bottom:f("bottom")},e={center:n("center"),top:n("top"),bottom:n("bottom")};b.PathProfile=k;b.circleProfiles=q;b.quadProfiles=e;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/PathVertex":function(){define("exports ../../../../core/mathUtils ../../../../chunks/mat2 ../../../../chunks/mat2f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ./PathExtruder ./PathGeometry".split(" "),
function(b,a,c,d,f,n,k,g,q,e){class m{constructor(){this.vLeft=g.create();this.vRight=g.create();this.vMinSiblingLength=0;this.frame=new q.Frame2D}setFrameFromUpVector(E){k.copy(this.frame.up,E);k.add(z,this.vLeft,this.vRight);k.normalize(z,z);k.scale(y,this.frame.up,k.dot(z,this.frame.up));k.subtract(A,z,y);k.normalize(A,A);k.cross(this.frame.right,A,this.frame.up)}get foldingAngle(){return Math.PI-this.rotationAngle}}class l extends m{get rotationFrameUp(){return this.frame.up}get rotationRight(){return n.UNIT_X}get rotationAngle(){k.scale(r,
this.frame.up,k.dot(this.frame.up,this.vLeft));k.subtract(r,this.vLeft,r);k.negate(r,r);k.normalize(r,r);k.scale(u,this.frame.up,k.dot(this.frame.up,this.vRight));k.subtract(u,this.vRight,u);k.normalize(u,u);k.cross(t,this.rotationFrameUp,this.vLeft);return Math.sign(k.dot(t,this.vRight))*(Math.PI-a.acosClamped(k.dot(r,u)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength/Math.cos(.5*this.foldingAngle))}applyMiterStretch(E,B){var D=this.rotationAngle;if(0>=Math.abs(D))return B;D=a.reciprocalClamped(Math.cos(.5*
D));return f.set(E,(1+(D-1))*B[0],B[1])}}class w extends m{get rotationFrameUp(){const E=Math.sign(k.dot(this.frame.right,this.vRight));k.cross(v,this.vRight,this.vLeft);k.scale(v,v,E);return k.normalize(v,v)}get rotationRight(){var E=this.rotationFrameUp,B=k.dot(E,this.frame.up);E=k.dot(E,this.frame.right);k.scale(p,this.frame.up,-E);k.scale(h,this.frame.right,B);k.add(p,p,h);k.normalize(p,p);B=this.frame;E=p;f.set(x,k.dot(E,B.right),k.dot(E,B.up));return x}get rotationAngle(){const E=Math.sign(k.dot(this.frame.right,
this.vRight));k.negate(t,this.vLeft);return-E*(Math.PI-a.acosClamped(k.dot(t,this.vRight)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength*a.reciprocalClamped(Math.cos(.5*this.foldingAngle)))}applyMiterStretch(E,B){var D=this.rotationAngle;if(0===Math.abs(D))return B;D=a.reciprocalClamped(Math.cos(.5*D));const F=this.rotationRight;D=c.set(C,1+(D-1)*F[0]*F[0],(D-1)*F[0]*F[1],(D-1)*F[0]*F[1],1+(D-1)*F[1]*F[1]);return f.transformMat2(E,B,D)}}const v=g.create(),x=n.create(),p=g.create(),
h=g.create(),t=g.create(),r=g.create(),u=g.create(),y=g.create(),z=g.create(),A=g.create(),C=d.create();b.PathVertex=m;b.newPathVertex=function(E){switch(E){case e.UpVectorAlignment.World:return new l;case e.UpVectorAlignment.Path:return new w}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/mat2":function(){define(["exports","./common"],function(b,a){function c(E,B){E[0]=B[0];E[1]=B[1];E[2]=B[2];E[3]=B[3];return E}function d(E){E[0]=1;E[1]=0;E[2]=0;E[3]=1;return E}function f(E,
B,D,F,K){E[0]=B;E[1]=D;E[2]=F;E[3]=K;return E}function n(E,B){if(E===B){const D=B[1];E[1]=B[2];E[2]=D}else E[0]=B[0],E[1]=B[2],E[2]=B[1],E[3]=B[3];return E}function k(E,B){const D=B[0],F=B[1],K=B[2];B=B[3];let L=D*B-K*F;if(!L)return null;L=1/L;E[0]=B*L;E[1]=-F*L;E[2]=-K*L;E[3]=D*L;return E}function g(E,B){const D=B[0];E[0]=B[3];E[1]=-B[1];E[2]=-B[2];E[3]=D;return E}function q(E){return E[0]*E[3]-E[2]*E[1]}function e(E,B,D){const F=B[0],K=B[1],L=B[2];B=B[3];const G=D[0],O=D[1],P=D[2];D=D[3];E[0]=F*
G+L*O;E[1]=K*G+B*O;E[2]=F*P+L*D;E[3]=K*P+B*D;return E}function m(E,B,D){const F=B[0],K=B[1],L=B[2];B=B[3];const G=Math.sin(D);D=Math.cos(D);E[0]=F*D+L*G;E[1]=K*D+B*G;E[2]=F*-G+L*D;E[3]=K*-G+B*D;return E}function l(E,B,D){const F=B[1],K=B[2],L=B[3],G=D[0];D=D[1];E[0]=B[0]*G;E[1]=F*G;E[2]=K*D;E[3]=L*D;return E}function w(E,B){const D=Math.sin(B);B=Math.cos(B);E[0]=B;E[1]=D;E[2]=-D;E[3]=B;return E}function v(E,B){E[0]=B[0];E[1]=0;E[2]=0;E[3]=B[1];return E}function x(E){return"mat2("+E[0]+", "+E[1]+", "+
E[2]+", "+E[3]+")"}function p(E){return Math.sqrt(E[0]**2+E[1]**2+E[2]**2+E[3]**2)}function h(E,B,D,F){E[2]=F[2]/F[0];D[0]=F[0];D[1]=F[1];D[3]=F[3]-E[2]*D[1];return[E,B,D]}function t(E,B,D){E[0]=B[0]+D[0];E[1]=B[1]+D[1];E[2]=B[2]+D[2];E[3]=B[3]+D[3];return E}function r(E,B,D){E[0]=B[0]-D[0];E[1]=B[1]-D[1];E[2]=B[2]-D[2];E[3]=B[3]-D[3];return E}function u(E,B){return E[0]===B[0]&&E[1]===B[1]&&E[2]===B[2]&&E[3]===B[3]}function y(E,B){const D=E[0],F=E[1],K=E[2];E=E[3];const L=B[0],G=B[1],O=B[2];B=B[3];
const P=a.getEpsilon();return Math.abs(D-L)<=P*Math.max(1,Math.abs(D),Math.abs(L))&&Math.abs(F-G)<=P*Math.max(1,Math.abs(F),Math.abs(G))&&Math.abs(K-O)<=P*Math.max(1,Math.abs(K),Math.abs(O))&&Math.abs(E-B)<=P*Math.max(1,Math.abs(E),Math.abs(B))}function z(E,B,D){E[0]=B[0]*D;E[1]=B[1]*D;E[2]=B[2]*D;E[3]=B[3]*D;return E}function A(E,B,D,F){E[0]=B[0]+D[0]*F;E[1]=B[1]+D[1]*F;E[2]=B[2]+D[2]*F;E[3]=B[3]+D[3]*F;return E}const C=Object.freeze(Object.defineProperty({__proto__:null,LDU:h,add:t,adjoint:g,copy:c,
determinant:q,equals:y,exactEquals:u,frob:p,fromRotation:w,fromScaling:v,identity:d,invert:k,mul:e,multiply:e,multiplyScalar:z,multiplyScalarAndAdd:A,rotate:m,scale:l,set:f,str:x,sub:r,subtract:r,transpose:n},Symbol.toStringTag,{value:"Module"}));b.LDU=h;b.add=t;b.adjoint=g;b.copy=c;b.determinant=q;b.equals=y;b.exactEquals=u;b.frob=p;b.fromRotation=w;b.fromScaling=v;b.identity=d;b.invert=k;b.mat2=C;b.mul=e;b.multiply=e;b.multiplyScalar=z;b.multiplyScalarAndAdd=A;b.rotate=m;b.scale=l;b.set=f;b.str=
x;b.sub=r;b.subtract=r;b.transpose=n})},"esri/chunks/mat2f64":function(){define(["exports"],function(b){function a(){return[1,0,0,1]}function c(k){return[k[0],k[1],k[2],k[3]]}function d(k,g,q,e){return[k,g,q,e]}function f(k,g){return new Float64Array(k,g,4)}const n=Object.freeze(Object.defineProperty({__proto__:null,clone:c,create:a,createView:f,fromValues:d},Symbol.toStringTag,{value:"Module"}));b.clone=c;b.create=a;b.createView=f;b.fromValues=d;b.mat2f64=n})},"esri/views/3d/webgl-engine/materials/PathMaterial":function(){define("exports ../../../../core/mathUtils ../../../../geometry/support/aaBoundingBox ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/shading/Normals.glsl ../lib/GLMaterial ../lib/Material ../lib/PathGeometry ../lib/RenderSlot ../lib/VertexAttribute ./DefaultBufferWriter ./PathTechnique ./internal/MaterialUtil".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v){class x extends g.Material{constructor(t){super(t,new h);this.supportsEdges=!0;this._vertexAttributeLocations=w.vertexAttributeLocations;this._configuration=new w.PathTechniqueConfiguration;this._vertexBufferLayout=x.getVertexBufferLayout()}getConfiguration(t,r){this._configuration.output=t;this._configuration.vvSize=!!this.parameters.vvSize;this._configuration.vvColor=!!this.parameters.vvColor;this._configuration.vvOpacity=!!this.parameters.vvOpacity;this._configuration.hasSlicePlane=
this.parameters.hasSlicePlane;this._configuration.transparent=this.parameters.transparent;this._configuration.hasOccludees=this.parameters.hasOccludees;if(t===f.ShaderOutput.Color||t===f.ShaderOutput.Alpha)this._configuration.doubleSidedMode=this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?n.NormalsDoubleSidedMode.View:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?n.NormalsDoubleSidedMode.WindingOrder:n.NormalsDoubleSidedMode.None,this._configuration.receiveShadows=
this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=null!=r.ssao;this._configuration.transparencyPassType=r.transparencyPassType;this._configuration.multipassEnabled=r.multipassEnabled;this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround;return this._configuration}isVisibleForOutput(t){return t===f.ShaderOutput.Shadow||t===f.ShaderOutput.ShadowExcludeHighlight||t===f.ShaderOutput.ShadowHighlight?this.parameters.castShadows:!0}isVisible(){return super.isVisible()&&
0<this.parameters.opacity}intersect(t,r,u,y,z,A){if(q.isPathGeometry(t)){r=t.path;var C=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSize){const {offset:D,factor:F,minSize:K,maxSize:L}=this.parameters.vvSize;var E=r.sizeAttributeValue;C[0]*=a.clamp(D[0]+E*F[0],K[0],L[0]);C[1]*=a.clamp(D[2]+E*F[2],K[2],L[2])}E=Math.max(C[0],C[1]);t=t.boundingInfo;if(null==t)this._intersectTriangles(r,C,y,z,A);else{t=c.fromValues(t.bbMin[0]-E,t.bbMin[1]-E,t.bbMin[2]-E,t.bbMax[0]+E,t.bbMax[1]+
E,t.bbMax[2]+E);E=[z[0]-y[0],z[1]-y[1],z[2]-y[2]];var B=Math.sqrt(E[0]*E[0]+E[1]*E[1]+E[2]*E[2]);v.intersectAabbInvDir(t,y,[B/E[0],B/E[1],B/E[2]],u.tolerance)&&this._intersectTriangles(r,C,y,z,A)}}}_intersectTriangles(t,r,u,y,z){t.baked.size&&t.baked.size[0]===r[0]&&t.baked.size[1]===r[1]||t.baked.bake(r);t.baked.intersect(u,y,z)}createBufferWriter(){return new l.DefaultBufferWriter(this._vertexBufferLayout)}produces(t,r){switch(r){case f.ShaderOutput.Shadow:case f.ShaderOutput.ShadowHighlight:case f.ShaderOutput.ShadowExcludeHighlight:if(!this.parameters.castShadows)return!1;
case f.ShaderOutput.Color:case f.ShaderOutput.Alpha:case f.ShaderOutput.Depth:case f.ShaderOutput.Normal:case f.ShaderOutput.Highlight:case f.ShaderOutput.ObjectAndLayerIdColor:return t===(this.parameters.transparent?e.RenderSlot.TRANSPARENT_MATERIAL:e.RenderSlot.OPAQUE_MATERIAL)||t===e.RenderSlot.DRAPED_MATERIAL;default:return!1}}createGLMaterial(t){return new p(t)}static getVertexBufferLayout(){return d.newLayout().vec3f(m.VertexAttribute.POSITION).vec4f(m.VertexAttribute.PROFILERIGHT).vec4f(m.VertexAttribute.PROFILEUP).vec4f(m.VertexAttribute.PROFILEVERTEXANDNORMAL).vec4f(m.VertexAttribute.FEATUREVALUE)}}
class p extends k{_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}_updateShadowState(t){null!=this.technique&&t.shadowMap.enabled===this.technique.configuration.receiveShadows||this._material.setParameters({receiveShadows:t.shadowMap.enabled})}beginSlot(t){if(this._output===f.ShaderOutput.Color||this._output===f.ShaderOutput.Alpha)this._updateShadowState(t),this._updateOccludeeState(t);return this.ensureTechnique(w.PathTechnique,
t)}}class h extends w.PathPassParameters{constructor(){super(...arguments);this.doubleSided=!1;this.doubleSidedType="normal";this.receiveShadows=!1;this.castShadows=!0;this.hasOccludees=this.transparent=this.hasSlicePlane=!1}}b.PathMaterial=x;b.PathMaterialParameters=h;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/PathTechnique":function(){define("require exports ../../../../chunks/tslib.es6 ../../../../chunks/vec3f64 ../../../ViewingMode ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/attributes/PathVertexPosition.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../lib/TransparencyPassType ../lib/VertexAttribute ./DefaultTechniqueConfiguration ../../../../chunks/Path.glsl ../../../webgl/renderState".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u){const y=new Map([[h.VertexAttribute.POSITION,0],[h.VertexAttribute.PROFILERIGHT,1],[h.VertexAttribute.PROFILEUP,2],[h.VertexAttribute.PROFILEVERTEXANDNORMAL,3],[h.VertexAttribute.FEATUREVALUE,4]]);class z extends k.PathVertexPositionPassParameters{constructor(){super(...arguments);this.ambient=d.fromValues(.2,.2,.2);this.diffuse=d.fromValues(.8,.8,.8);this.specular=d.fromValues(0,0,0);this.opacity=1;this.origin=d.create();this.modelTransformation=
null}}class A extends m.ShaderTechnique{initializeConfiguration(E,B){B.spherical=E.viewingMode===f.ViewingMode.Global;B.doublePrecisionRequiresObfuscation=E.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(E){return new v.Program(E.rctx,A.shader.get().build(this.configuration),y)}initializePipeline(){const E=this.configuration.transparencyPassType,B=this.configuration,D=E===p.TransparencyPassType.NONE,F=E===p.TransparencyPassType.FrontFace;return u.makePipelineState({blending:B.output!==
n.ShaderOutput.Color&&B.output!==n.ShaderOutput.Alpha||!B.transparent?null:D?w.blendingDefault:w.oitBlending(E),culling:B.hasSlicePlane&&!B.transparent&&B.doubleSidedMode!==g.NormalsDoubleSidedMode.None?u.frontFaceCullingParams:null,depthTest:{func:w.oitDepthTest(E)},depthWrite:D||F?u.defaultDepthWriteParams:null,colorWrite:u.defaultColorWriteParams,stencilWrite:B.hasOccludees?x.stencilWriteMaskOn:null,stencilTest:B.hasOccludees?x.stencilBaseAllZerosParams:null,polygonOffset:D||F?null:w.OITPolygonOffset})}}
A.shader=new e.ReloadableShaderModule(r.Path,()=>new Promise((E,B)=>b(["../shaders/Path.glsl"],E,B)));class C extends t.DefaultTechniqueConfiguration{constructor(){super(...arguments);this.output=n.ShaderOutput.Color;this.doubleSidedMode=g.NormalsDoubleSidedMode.None;this.transparencyPassType=p.TransparencyPassType.NONE;this.doublePrecisionRequiresObfuscation=this.cullAboveGround=this.multipassEnabled=this.hasOccludees=this.transparent=this.hasSlicePlane=this.vvOpacity=this.vvColor=this.vvSize=this.receiveAmbientOcclusion=
this.receiveShadows=this.spherical=!1}}c.__decorate([l.parameter({count:n.ShaderOutput.COUNT})],C.prototype,"output",void 0);c.__decorate([l.parameter({count:g.NormalsDoubleSidedMode.COUNT})],C.prototype,"doubleSidedMode",void 0);c.__decorate([l.parameter({count:p.TransparencyPassType.COUNT})],C.prototype,"transparencyPassType",void 0);c.__decorate([l.parameter()],C.prototype,"spherical",void 0);c.__decorate([l.parameter()],C.prototype,"receiveShadows",void 0);c.__decorate([l.parameter()],C.prototype,
"receiveAmbientOcclusion",void 0);c.__decorate([l.parameter()],C.prototype,"vvSize",void 0);c.__decorate([l.parameter()],C.prototype,"vvColor",void 0);c.__decorate([l.parameter()],C.prototype,"vvOpacity",void 0);c.__decorate([l.parameter()],C.prototype,"hasSlicePlane",void 0);c.__decorate([l.parameter()],C.prototype,"transparent",void 0);c.__decorate([l.parameter()],C.prototype,"hasOccludees",void 0);c.__decorate([l.parameter()],C.prototype,"multipassEnabled",void 0);c.__decorate([l.parameter()],
C.prototype,"cullAboveGround",void 0);c.__decorate([l.parameter()],C.prototype,"doublePrecisionRequiresObfuscation",void 0);c.__decorate([l.parameter({constValue:!1})],C.prototype,"occlusionPass",void 0);c.__decorate([l.parameter({constValue:q.PBRMode.Disabled})],C.prototype,"pbrMode",void 0);c.__decorate([l.parameter({constValue:!0})],C.prototype,"hasVvInstancing",void 0);c.__decorate([l.parameter({constValue:!1})],C.prototype,"useCustomDTRExponentForWater",void 0);c.__decorate([l.parameter({constValue:!1})],
C.prototype,"useFillLights",void 0);c.__decorate([l.parameter({constValue:!1})],C.prototype,"hasColorTexture",void 0);a.PathPassParameters=z;a.PathTechnique=A;a.PathTechniqueConfiguration=C;a.vertexAttributeLocations=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/PathVertexPosition.glsl":function(){define("exports ../../../../../../chunks/vec2f64 ./PositionAttribute.glsl ../../shaderModules/Float2PassUniform ../../shaderModules/Float3PassUniform ../../shaderModules/Float4sPassUniform ../../shaderModules/FloatsPassUniform ../../shaderModules/interfaces ../../../lib/VertexAttribute ../../../materials/VisualVariablePassParameters".split(" "),
function(b,a,c,d,f,n,k,g,q,e){class m extends e.VisualVariablePassParameters{constructor(){super(...arguments);this.size=a.fromValues(1,1)}}b.PathVertexPosition=function(l,w){const v=q.VertexAttribute.FEATUREVALUE;l.attributes.add(v,"vec4");const x=l.vertex;x.code.add(g.glsl`
  bool isCapVertex() {
    return ${v}.w == 1.0;
  }
  `);x.uniforms.add(new d.Float2PassUniform("size",p=>p.size));w.vvSize?(x.uniforms.add(new f.Float3PassUniform("vvSizeMinSize",p=>p.vvSize.minSize),new f.Float3PassUniform("vvSizeMaxSize",p=>p.vvSize.maxSize),new f.Float3PassUniform("vvSizeOffset",p=>p.vvSize.offset),new f.Float3PassUniform("vvSizeFactor",p=>p.vvSize.factor)),x.code.add(g.glsl`
    vec2 getSize() {
      return size * clamp(vvSizeOffset + ${v}.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
    }
    `)):x.code.add(g.glsl`vec2 getSize(){
return size;
}`);w.vvOpacity?(x.constants.add("vvOpacityNumber","int",8),x.uniforms.add(new k.FloatsPassUniform("vvOpacityValues",p=>p.vvOpacity.values,8),new k.FloatsPassUniform("vvOpacityOpacities",p=>p.vvOpacity.opacityValues,8)),x.code.add(g.glsl`
    vec4 applyOpacity(vec4 color) {
      float value = ${v}.z;
      if (value <= vvOpacityValues[0]) {
        return vec4( color.xyz, vvOpacityOpacities[0]);
      }

      for (int i = 1; i < vvOpacityNumber; ++i) {
        if (vvOpacityValues[i] >= value) {
          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
          return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
        }
      }

      return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
    }
    `)):x.code.add(g.glsl`vec4 applyOpacity(vec4 color){
return color;
}`);w.vvColor?(x.constants.add("vvColorNumber","int",e.vvColorNumber),x.uniforms.add(new k.FloatsPassUniform("vvColorValues",p=>p.vvColor.values,e.vvColorNumber),new n.Float4sPassUniform("vvColorColors",p=>p.vvColor.colors,e.vvColorNumber)),x.code.add(g.glsl`
    vec4 getColor() {
      float value = ${v}.y;
      if (value <= vvColorValues[0]) {
        return applyOpacity(vvColorColors[0]);
      }

      for (int i = 1; i < vvColorNumber; ++i) {
        if (vvColorValues[i] >= value) {
          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
          return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
        }
      }

      return applyOpacity(vvColorColors[vvColorNumber - 1]);
    }
    `)):x.code.add(g.glsl`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`);l.include(c.PositionAttribute);l.attributes.add(q.VertexAttribute.PROFILERIGHT,"vec4");l.attributes.add(q.VertexAttribute.PROFILEUP,"vec4");l.attributes.add(q.VertexAttribute.PROFILEVERTEXANDNORMAL,"vec4");x.code.add(g.glsl`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`);x.code.add(g.glsl`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`);x.code.add(g.glsl`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`);x.code.add(g.glsl`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)};b.PathVertexPositionPassParameters=m;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Path.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PathVertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/TransparencyPassType".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z){function A(E){const B=new y.ShaderBuilder,{vertex:D,fragment:F}=B;h.addProjViewLocalOrigin(D,E);B.varyings.add("vpos","vec3");B.include(n.PathVertexPosition,E);if(E.output===c.ShaderOutput.Color||E.output===c.ShaderOutput.Alpha)B.include(f.Transform,E),B.include(x.ReadShadowMapDraw,E),B.include(a.ForwardLinearDepth,E),B.varyings.add("vnormal","vec3"),B.varyings.add("vcolor","vec4"),E.multipassEnabled&&B.varyings.add("depth","float"),D.code.add(u.glsl`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${E.multipassEnabled?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${E.output===c.ShaderOutput.Color?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `);B.include(l.multipassTerrainTest,E);switch(E.output){case c.ShaderOutput.Alpha:B.include(d.SliceDraw,E);F.uniforms.add(new r.FloatPassUniform("opacity",K=>K.opacity));F.code.add(u.glsl`
      void main() {
        discardBySlice(vpos);
        ${E.multipassEnabled?"terrainDepthTest(depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        fragColor = vec4(combinedOpacity);
      }
    `);break;case c.ShaderOutput.Color:B.include(d.SliceDraw,E);B.include(e.EvaluateSceneLighting,E);B.include(q.EvaluateAmbientOcclusion,E);B.include(x.ReadShadowMapDraw,E);B.include(w.Normals,E);h.addCameraPosition(F,E);e.addAmbientBoostFactor(F);e.addLightingGlobalFactor(F);F.uniforms.add(D.uniforms.get("localOrigin"),new t.Float3PassUniform("ambient",K=>K.ambient),new t.Float3PassUniform("diffuse",K=>K.diffuse),new t.Float3PassUniform("specular",K=>K.specular),new r.FloatPassUniform("opacity",
K=>K.opacity));F.include(p.ColorConversion);m.addMainLightIntensity(F);F.code.add(u.glsl`
        void main() {
          discardBySlice(vpos);
          ${E.multipassEnabled?"terrainDepthTest(depth);":""}

          shadingParams.viewDirection = normalize(vpos - cameraPosition);
          shadingParams.normalView = vnormal;
          vec3 normal = shadingNormal(shadingParams);
          float ssao = evaluateAmbientOcclusionInverse();

          float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
          ${E.receiveShadows?"float shadow \x3d readShadowMap(vpos, linearDepth);":E.spherical?"float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow \x3d 0.0;"}
          vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
          float combinedOpacity = vcolor.a * opacity;
          albedo += 0.25 * specular; // don't completely ignore specular for now

          vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
          fragColor = vec4(shadedColor, combinedOpacity);
          fragColor = highlightSlice(fragColor, vpos);
          ${E.transparencyPassType===z.TransparencyPassType.Color?"fragColor \x3d premultiplyAlpha(fragColor);":""}
        }
      `);break;case c.ShaderOutput.Depth:case c.ShaderOutput.Shadow:case c.ShaderOutput.ShadowHighlight:case c.ShaderOutput.ShadowExcludeHighlight:B.include(f.Transform,E);a.addNearFar(B);B.varyings.add("depth","float");D.code.add(u.glsl`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`);B.include(d.SliceDraw,E);B.include(k.OutputDepth,E);F.code.add(u.glsl`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`);break;case c.ShaderOutput.Normal:B.include(f.Transform,E);B.include(v.NormalUtils,E);h.addViewNormal(D);B.varyings.add("vnormal","vec3");D.code.add(u.glsl`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`);B.include(d.SliceDraw,E);F.code.add(u.glsl`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
fragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`);break;case c.ShaderOutput.Highlight:B.include(f.Transform,E),B.include(v.NormalUtils,E),B.varyings.add("vnormal","vec3"),D.code.add(u.glsl`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),B.include(d.SliceDraw,E),B.include(g.OutputHighlight,E),F.code.add(u.glsl`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return B}const C=Object.freeze(Object.defineProperty({__proto__:null,build:A},Symbol.toStringTag,{value:"Module"}));b.Path=C;b.build=A})},"esri/views/3d/layers/graphics/Graphics3DPolygonFillSymbolLayer":function(){define("exports ../../../../Color ../../../../core/screenUtils ../../../../chunks/earcut ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/DoubleArray ../../../../geometry/support/FloatArray ./elevationAlignmentUtils ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./interfaces ./lineUtils ./polygonUtils ../support/FastSymbolUpdates ../support/patternUtils ../support/uvUtils ../../support/engineContent/line ../../support/renderInfoUtils/polygon ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/lineStippleUtils ../../webgl-engine/materials/PatternMaterial ../../webgl-engine/materials/RibbonLineMaterial".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A,C,E){const B=["polyline","polygon","extent"],D=new p.ConvertOptions({size:!1,color:!0,rotation:!1,opacity:!1});class F extends m.Graphics3DSymbolLayer{constructor(P,J,R,X){super(P,J,R,X);this._needsUV=!1}async doLoad(){this._fastUpdates=p.initFastSymbolUpdatesState(this._context.renderer,D)}_createMaterials(){if(!(0<this._materials.length)){var P=this._getCombinedOpacityAndColor(this.symbolLayer?.material?.color);this._materials[O.Fill]=h.createMaterial(this.symbolLayer,
{color:P,forceTransparentMode:this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,draped:this.draped,hasSlicePlane:this._context.slicePlaneEnabled,...this._fastUpdates?.materialParameters});this._needsUV=this._materials[O.Fill]instanceof C.PatternMaterial;P=this.symbolLayer.outline;if(this._isValidOutline(P)){const J=A.getStipplePatternForLinePattern(P.pattern);this._materials[O.Outline]=new E.RibbonLineMaterial({width:c.pt2px(P.size),color:this._getOutlineColor(),
hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:J,cap:v.parseCapType(P.patternCap||"butt")})}this._context.stage.addMany(this._materials)}}_isValidOutline(P){return null!=P?.size&&0<P.size&&null!=P.color&&(null==P.pattern||"style"!==P.pattern.type||"none"!==P.pattern.style)}destroy(){super.destroy();this._context.stage.removeMany(this._materials);this._materials.length=0}createGraphics3DGraphic(P){const J=P.graphic;if(!this._validateGeometry(J.geometry,
B,this.symbolLayer.type))return null;P=this._getVertexOpacityAndColor(P.renderingInfo,255);const R=this.setGraphicElevationContext(J);this.ensureDrapedStatus("on-the-ground"===R.mode);this._createMaterials();return this.draped?this._createAsOverlay(J,P):this._createAs3DShape(J,P,R)}applyRendererDiff(P,J){for(const R in P.diff)switch(R){case "visualVariables":if(p.updateFastSymbolUpdatesState(this._fastUpdates,J,D))this._materials[O.Fill]?.setParameters(this._fastUpdates.materialParameters);else return w.ApplyRendererDiffResult.RecreateSymbol;
break;default:return w.ApplyRendererDiffResult.RecreateSymbol}return w.ApplyRendererDiffResult.FastUpdate}layerOpacityChanged(){if(null!=this._materials[O.Fill]){var P=this._materials[O.Fill].parameters.color;const J=this._getCombinedOpacity(this.symbolLayer?.material?.color);this._materials[O.Fill].setParameters({color:[P[0],P[1],P[2],J],forceTransparentMode:this.needsDrivenTransparentPass})}null!=this._materials[O.Outline]&&(P=this._materials[O.Outline].parameters.color,this._materials[O.Outline].setParameters({color:[P[0],
P[1],P[2],this._getOutlineOpacity()]}))}layerElevationInfoChanged(P,J,R){const X=this._elevationContext.mode;R=g.elevationModeChangeUpdateType(F.elevationModeChangeTypes,R,X);if(R!==g.SymbolUpdateType.UPDATE)return R;const U=g.needsElevationUpdates2D(X);return this.updateGraphics3DGraphicElevationInfo(P,J,()=>U)}slicePlaneEnabledChanged(){this._materials[O.Fill]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});this._materials[O.Outline]&&this._materials[O.Outline].setParameters({hasSlicePlane:this._context.slicePlaneEnabled});
return!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(P,J,R){const X=x.geometryAsPolygon(P.geometry);if(!X)return null;var U=u.geometryToRenderInfo(X,this._context.elevationProvider,this._context.renderCoordsHelper,R);J=new L(U,J,this._context.layer.uid,P.uid);U=J.renderData.position.length/3;this._needsUV&&(J.uvMapSpace=k.newFloatArray(4*U,!0),J.boundingRect=n.newDoubleArray(9*U,!0),t.createMapSpaceUVCoords(J.uvMapSpace,J.boundingRect,J.renderData.position,this._context.renderCoordsHelper));
J.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(J);this._createAs3DShapeFill(P,J);this._materials[O.Outline]&&this._createAs3DShapeOutline(J);this._logGeometryCreationWarnings(J.renderData,X.rings,"rings","FillSymbol3DLayer");if(0===J.outGeometries.length)return null;P=new y.Object3D({geometries:J.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:P.uid});P=new e.Graphics3DObject3DGraphicLayer(this,P,J.outGeometries,null,null,h.uvElevationAligner,
R);P.alignedSampledElevation=J.renderData.sampledElevation;P.needsElevationUpdates=g.needsElevationUpdates2D(R.mode);return P}_createAs3DShapeFill(P,J){var R=J.renderData.polygons;for(const {position:X,mapPositions:U,holeIndices:M,index:V,count:Y}of R){if(null!=this._context.clippingExtent&&(f.empty(K),f.expandWithBuffer(K,U),!f.intersectsClippingArea(K,this._context.clippingExtent)))continue;R=x.createIndices3D(U,M,this._context.elevationProvider.spatialReference);if(0===R.length)continue;const W=
this._fastUpdates?.visualVariables.color;R=x.createColorGeometry({material:this._materials[O.Fill],indices:R,mapPositions:U,attributeData:{position:X,color:W?null:J.color,colorFeature:W?p.getAttributeValue(W.field,P):null,uvMapSpace:this._needsUV?k.floatSubArray(J.uvMapSpace,4*V,4*Y):null,boundingRect:this._needsUV?n.doubleSubArray(J.boundingRect,9*V,9*Y):null,objectAndLayerIdColor:J.objectAndLayerIdColor}});J.outGeometries.push(R)}}_createAs3DShapeOutline(P){if(null!=this._materials[O.Outline]){var J=
P.renderData.outlines;for(const {mapPositions:R,position:X}of J){if(null!=this._context.clippingExtent&&(f.empty(K),f.expandWithBuffer(K,R),!f.intersectsClippingArea(K,this._context.clippingExtent)))continue;J=r.createGeometry(this._materials[O.Outline],{overlayInfo:null,removeDuplicateStartEnd:!0,mapPositions:R,attributeData:{position:X}},P.objectAndLayerIdColor);P.outGeometries.push(J)}}}_createAsOverlay(P,J){const R=x.geometryAsPolygon(P.geometry);if(null==R)return null;this._materials[O.Fill].renderPriority=
this._renderPriority+this._renderPriorityStep/2;null!=this._materials[O.Outline]&&(this._materials[O.Outline].renderPriority=this._renderPriority);var X=u.geometryToRenderInfoDraped(R,this._context.overlaySR);J=new G(X,J,this._context.layer.uid,P.uid);X=J.renderData.position.length/3;this._needsUV&&(J.uvMapSpace=k.newFloatArray(4*X,!0),t.createMapSpaceUVCoordsDraped(J.uvMapSpace,J.renderData.position,this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode));J.outBoundingBox=
f.empty();J.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(J);this._createAsOverlayFill(P,J);this._materials[O.Outline]&&this._createAsOverlayOutline(J);this._logGeometryCreationWarnings(J.renderData,R.rings,"rings","FillSymbol3DLayer");return 0===J.outGeometries.length?null:new q.Graphics3DDrapedGraphicLayer(this,J.outGeometries,J.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayFill(P,J){var R=J.renderData.polygons;for(const {position:U,holeIndices:M,
index:V,count:Y}of R){var X=f.empty(K);f.expandWithBuffer(X,U);f.intersectsClippingArea(X,this._context.clippingExtent)&&(R=d.earcut(U,M,3),0!==R.length&&(f.expandWithAABB(J.outBoundingBox,X),X=this._fastUpdates?.visualVariables.color,R=x.createColorGeometry({material:this._materials[O.Fill],indices:R,attributeData:{position:U,color:X?null:J.color,colorFeature:X?p.getAttributeValue(X.field,P):null,uvMapSpace:this._needsUV?k.floatSubArray(J.uvMapSpace,4*V,4*Y):null,objectAndLayerIdColor:J.objectAndLayerIdColor}}),
J.outGeometries.push(new z.RenderGeometry(R,J))))}}_createAsOverlayOutline(P){if(null!=this._materials[O.Outline]){var J=P.renderData.outlines;for(let X=0;X<J.length;++X){var {position:R}=J[X];f.empty(K);f.expandWithBuffer(K,R);f.intersectsClippingArea(K,this._context.clippingExtent)&&(f.expandWithAABB(P.outBoundingBox,K),R=r.createGeometry(this._materials[O.Outline],{overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:!0,
attributeData:{position:R}},P.objectAndLayerIdColor),P.outGeometries.push(new z.RenderGeometry(R,P)))}}}_getOutlineOpacity(){const P=this.symbolLayer?.outline?.color;return(this.draped?1:this._getLayerOpacity())*(null!=P?P.a:0)}_getOutlineColor(){const P=this.symbolLayer?.outline?.color,J=this._getOutlineOpacity();return l.mixinColorAndOpacity(null!=P?a.toUnitRGB(P):null,J)}test(){return{...super.test(),createAsOverlay:(P,J)=>this._createAsOverlay(P,J),createAs3DShape:(P,J,R)=>this._createAs3DShape(P,
J,R)}}}F.elevationModeChangeTypes={definedChanged:g.SymbolUpdateType.RECREATE,staysOnTheGround:g.SymbolUpdateType.NONE,onTheGroundChanged:g.SymbolUpdateType.RECREATE};const K=f.create();class L extends x.PolygonCreationDataBase{constructor(P,J,R,X){super(P,R,X);this.color=J}}class G extends x.PolygonCreationDataBase{constructor(P,J,R,X){super(P,R,X);this.color=J}}var O;(function(P){P[P.Fill=0]="Fill";P[P.Outline=1]="Outline"})(O||(O={}));b.Graphics3DPolygonFillSymbolLayer=F;Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/patternUtils":function(){define("exports ../../../../core/has ../../../../chunks/vec4f64 ../graphics/ElevationAligners ./uvUtils ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/ColorMaterial ../../webgl-engine/materials/PatternMaterial ../../webgl-engine/materials/PatternStyle".split(" "),function(b,a,c,d,f,n,k,g,q){function e(w){switch(w){case "horizontal":return q.Style.Horizontal;case "vertical":return q.Style.Vertical;
case "cross":return q.Style.Cross;case "forward-diagonal":return q.Style.ForwardDiagonal;case "backward-diagonal":return q.Style.BackwardDiagonal;case "diagonal-cross":return q.Style.DiagonalCross}}function m(w){return w.material instanceof g.PatternMaterial&&!w.material.parameters.draped}function l(w,v){if(m(w)){const x=w.attributes.get(n.VertexAttribute.POSITION).data,p=w.getMutableAttribute(n.VertexAttribute.UVMAPSPACE).data;w=w.getMutableAttribute(n.VertexAttribute.BOUNDINGRECT).data;f.createMapSpaceUVCoords(p,
w,x,v)}}b.createMaterial=function(w,v){w=w?.pattern??null;if(null==w)return new k.ColorMaterial(v);if("none"===w.style||"solid"===w.style)return"none"===w.style&&(v.color=c.fromValues(0,0,0,0),v.forceTransparentMode=!0),new k.ColorMaterial(v);v.style=e(w.style);return new g.PatternMaterial(v)};b.parsePatternStyle=e;b.requiresUVUpdates=m;b.updateMapSpaceUVCoords=l;b.uvElevationAligner=function(w,v,x,p,h){v=d.perVertexElevationAligner(w,v,x,p,h);w=w.stageObject.geometries;for(const t of w)l(t,h);return v};
Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/uvUtils":function(){define("exports ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/ellipsoidUtils ../../../../geometry/projection/projectors ../../../../geometry/support/DoubleArray ../../../../geometry/support/plane ../../../ViewingMode".split(" "),function(b,a,c,d,f,n,k,g,q,e,m){function l(K,L,G,O,P,J,
R){f.set(K,L*P[0]+G*J[0]+O*R[0],L*P[1]+G*J[1]+O*R[1],L*P[2]+G*J[2]+O*R[2])}const w=n.create(),v=n.create(),x=e.create(),p=n.create(),h=n.create(),t=n.create(),r=d.create(),u=d.create(),y=n.create(),z=n.create(),A=n.create(),C=a.create(),E=n.create(),B=n.create(),D=n.create(),F=n.create();b.createMapSpaceUVCoords=function(K,L,G,O,P=1){f.set(p,1,0,0);f.set(h,0,1,0);f.set(t,0,0,1);f.set(F,0,0,0);for(var J=0;J<G.length-3;J+=3)F[0]+=G[J],F[1]+=G[J+1],F[2]+=G[J+2];f.scale(w,F,1/(G.length/3-1));if(e.fromArray(x,
G)){null!=O?(O.basisMatrixAtPosition(w,C),f.set(E,C[0],C[1],C[2]),f.set(B,C[4],C[5],C[6]),f.set(D,C[8],C[9],C[10])):(f.set(E,1,0,0),f.set(B,0,1,0),f.set(D,0,0,1));O=e.normal(x);0>f.dot(O,D)&&f.scale(O,O,-1);f.copy(t,O);J=f.dot(O,B);var R=f.dot(O,E);Math.abs(J)>Math.abs(R)?(f.scaleAndAdd(p,E,O,-R),f.normalize(p,p),f.cross(h,p,O),f.normalize(h,h),f.scale(h,h,-1)):(f.scaleAndAdd(h,B,O,-J),f.normalize(h,h),f.cross(p,h,O),f.normalize(p,p))}c.set(r,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);c.set(u,
Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(O=0;O<G.length;O+=3)f.set(v,G[O],G[O+1],G[O+2]),J=f.dot(p,v),R=f.dot(h,v),r[0]=Math.min(r[0],J),r[1]=Math.min(r[1],R),u[0]=Math.max(u[0],J),u[1]=Math.max(u[1],R);O=f.dot(t,w);l(y,r[0],r[1],O,p,h,t);l(z,u[0],r[1],O,p,h,t);l(A,r[0],u[1],O,p,h,t);f.subtract(z,z,y);f.scale(z,z,.5);f.subtract(A,A,y);f.scale(A,A,.5);f.add(y,y,z);f.add(y,y,A);O=r[0]-r[0]%P;J=r[1]-r[1]%P;for(R=0;R<G.length;R+=3){f.set(v,G[R],G[R+1],G[R+2]);var X=R/3,U=4*X;K[U]=(f.dot(p,
v)-O)/P;K[U+1]=(f.dot(h,v)-J)/P;K[U+2]=O/P;K[U+3]=J/P;X*=9;for(U=0;3>U;U++)L[X+U]=y[U],L[X+U+3]=z[U],L[X+U+6]=A[U]}};b.createMapSpaceUVCoordsDraped=function(K,L,G,O,P=1){if(G.isGeographic&&O===m.ViewingMode.Global){O=q.newDoubleArray(L.length);var J=L.length;G=k.getReferenceEllipsoid(G);for(var R=0;R<J;R+=3)g.lonLatToWebMercatorComparable(L,R,O,R,G);L=O}c.set(r,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(O=0;O<L.length;O+=3)r[0]=Math.min(r[0],L[O]),r[1]=Math.min(r[1],L[O+1]);O=r[0]-r[0]%
P;J=r[1]-r[1]%P;for(G=0;G<L.length;G+=3)R=G/3*4,K[R]=(L[G]-O)/P,K[R+1]=(L[G+1]-J)/P,K[R+2]=O/P,K[R+3]=J/P};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/ColorMaterial":function(){define("exports ../../../../core/has ../../../../chunks/vec4f64 ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../lib/basicInterfaces ../lib/GLMaterial ../lib/OrderIndependentTransparency ../lib/RenderSlot ../lib/VertexAttribute ./DefaultBufferWriter ./TriangleMaterial ./VisualVariablePassParameters ../shaders/ColorMaterialTechnique ../shaders/ColorMaterialTechniqueConfiguration".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x){class p extends l.TriangleMaterial{constructor(r){super(r,new t);this.supportsEdges=!0;this._configuration=new x.ColorMaterialTechniqueConfiguration}getConfiguration(r,u){this._configuration.output=r;this._configuration.cullFace=this.parameters.cullFace;this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.transparent=this._isTransparent;
this._configuration.polygonOffset=this.parameters.polygonOffset;this._configuration.writeDepth=this.parameters.writeDepth;this._configuration.hasOccludees=this.parameters.hasOccludees;this._configuration.transparencyPassType=u.transparencyPassType;this._configuration.enableOffset=u.camera.relativeElevation<g.OITPolygonOffsetLimit;this._configuration.multipassEnabled=u.multipassEnabled;this._configuration.cullAboveGround=u.multipassTerrain.cullAboveGround;this._configuration.vvColor=!!this.parameters.vvColor;
return this._configuration}produces(r,u){return u===f.ShaderOutput.Color||u===f.ShaderOutput.Alpha||u===f.ShaderOutput.Highlight||u===f.ShaderOutput.Depth&&this.parameters.writeLinearDepth||u===f.ShaderOutput.ObjectAndLayerIdColor?r===q.RenderSlot.DRAPED_MATERIAL?!0:u===f.ShaderOutput.Highlight?r===q.RenderSlot.OPAQUE_MATERIAL:r===(this._isTransparent?this.parameters.writeDepth?q.RenderSlot.TRANSPARENT_MATERIAL:q.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:q.RenderSlot.OPAQUE_MATERIAL):!1}createGLMaterial(r){return new h(r)}createBufferWriter(){const r=
d.newLayout().vec3f(e.VertexAttribute.POSITION);a("enable-feature:objectAndLayerId-rendering")&&r.vec4u8(e.VertexAttribute.OBJECTANDLAYERIDCOLOR);this.parameters.vvColor?r.f32(e.VertexAttribute.COLORFEATUREATTRIBUTE):r.vec4u8(e.VertexAttribute.COLOR);return new m.DefaultBufferWriter(r)}get _isTransparent(){return 1>this.parameters.color[3]||this.parameters.forceTransparentMode}}class h extends k{_updateOccludeeState(r){r.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:r.hasOccludees})}beginSlot(r){this._output!==
f.ShaderOutput.Color&&this._output!==f.ShaderOutput.Alpha||this._updateOccludeeState(r);return this.ensureTechnique(v.ColorMaterialTechnique,r)}}class t extends w.VisualVariablePassParameters{constructor(){super(...arguments);this.color=c.ZEROS;this.forceTransparentMode=!1;this.writeDepth=!0;this.hasSlicePlane=this.polygonOffset=this.hasVertexColors=this.writeLinearDepth=!1;this.cullFace=n.CullFaceOptions.None;this.hasOccludees=!1}}b.ColorMaterial=p;b.Parameters=t;Object.defineProperty(b,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/ColorMaterialTechnique":function(){define("require exports ../../../../chunks/vec4f64 ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../lib/TransparencyPassType ../materials/VisualVariablePassParameters ../../../../chunks/ColorMaterial.glsl ../../../webgl/renderState".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v){class x extends l.VisualVariablePassParameters{constructor(){super(...arguments);this.color=c.ZEROS}}class p extends n.ShaderTechnique{initializeProgram(t){return new q.Program(t.rctx,p.shader.get().build(this.configuration),k.Default3D)}_createPipeline(t,r){const u=this.configuration,y=t===m.TransparencyPassType.NONE,z=t===m.TransparencyPassType.FrontFace;return v.makePipelineState({blending:u.output!==d.ShaderOutput.Color&&u.output!==d.ShaderOutput.Alpha||!u.transparent?
null:y?g.blendingDefault:g.oitBlending(t),culling:v.cullingParams(u.cullFace),depthTest:{func:g.oitDepthTest(t)},depthWrite:y||z?u.writeDepth?v.defaultDepthWriteParams:null:null,colorWrite:v.defaultColorWriteParams,stencilWrite:u.hasOccludees?e.stencilWriteMaskOn:null,stencilTest:u.hasOccludees?r?e.stencilToolMaskBaseParams:e.stencilBaseAllZerosParams:null,polygonOffset:y||z?u.polygonOffset?h:null:g.getOITPolygonOffset(u.enableOffset)})}initializePipeline(){this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,
!0);return this._createPipeline(this.configuration.transparencyPassType,!1)}getPipeline(t){return t?this._occludeePipelineState:super.getPipeline()}}p.shader=new f.ReloadableShaderModule(w.ColorMaterial,()=>new Promise((t,r)=>b(["./ColorMaterial.glsl"],t,r)));const h={factor:1,units:1};a.ColorMaterialPassParameters=x;a.ColorMaterialTechnique=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/ColorMaterial.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/ObjectAndLayerIdColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r){function u(z){const A=new h.ShaderBuilder,{vertex:C,fragment:E,attributes:B,varyings:D}=A;v.addProjViewLocalOrigin(C,z);A.include(f.Transform,z);A.include(k.VertexColor,z);A.include(m.VisualVariables,z);A.include(n.ObjectAndLayerIdColor,z);B.add(r.VertexAttribute.POSITION,"vec3");z.vvColor&&B.add(r.VertexAttribute.COLORFEATUREATTRIBUTE,"float");D.add("vColor","vec4");D.add("vpos","vec3");const F=z.multipassEnabled&&(z.output===c.ShaderOutput.Color||
z.output===c.ShaderOutput.Alpha);F&&D.add("depth","float");C.uniforms.add(new x.Float4PassUniform("eColor",L=>L.color));var K=z.output===c.ShaderOutput.Depth;K&&(A.include(g.OutputDepth,z),a.addNearFar(A),a.addLinearDepth(A));C.code.add(p.glsl`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();

      ${z.hasVertexColors?"vColor *\x3d eColor;":z.vvColor?"vColor \x3d eColor * interpolateVVColor(colorFeatureAttribute);":"vColor \x3d eColor;"}
      ${F?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${K?p.glsl`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:p.glsl`transformPosition(proj, view, vpos);`}
    }
  `);A.include(d.SliceDraw,z);F&&A.include(e.multipassTerrainTest,z);E.include(w.ColorConversion);(K=z.output===c.ShaderOutput.Highlight)&&A.include(q.OutputHighlight,z);E.code.add(p.glsl`
  void main() {
    discardBySlice(vpos);
    ${F?"terrainDepthTest(depth);":""}
    vec4 fColor = vColor;

    ${z.output===c.ShaderOutput.ObjectAndLayerIdColor?p.glsl`fColor.a = 1.0;`:""}

    if (fColor.a < ${p.glsl.float(l.symbolAlphaCutoff)}) {
      discard;
    }

    ${z.output===c.ShaderOutput.Alpha?p.glsl`fragColor = vec4(fColor.a);`:""}

    ${z.output===c.ShaderOutput.Color?p.glsl`fragColor = highlightSlice(fColor, vpos); ${z.transparencyPassType===t.TransparencyPassType.Color?"fragColor \x3d premultiplyAlpha(fragColor);":""}`:""}
    ${K?p.glsl`outputHighlight();`:""};
    ${z.output===c.ShaderOutput.Depth?p.glsl`outputDepth(linearDepth);`:""};
    ${z.output===c.ShaderOutput.ObjectAndLayerIdColor?p.glsl`outputObjectAndLayerIdColor();`:""}
  }
  `);return A}const y=Object.freeze(Object.defineProperty({__proto__:null,build:u},Symbol.toStringTag,{value:"Module"}));b.ColorMaterial=y;b.build=u})},"esri/views/3d/webgl-engine/shaders/ColorMaterialTechniqueConfiguration":function(){define("exports ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../lib/TransparencyPassType ../materials/DefaultTechniqueConfiguration".split(" "),function(b,a,c,d,f,n,k){class g extends k.DefaultTechniqueConfiguration{constructor(){super(...arguments);
this.output=c.ShaderOutput.Color;this.cullFace=f.CullFaceOptions.None;this.transparencyPassType=n.TransparencyPassType.NONE;this.polygonOffset=this.transparent=this.hasVertexColors=this.hasSlicePlane=!1;this.writeDepth=this.enableOffset=!0;this.vvColor=this.objectAndLayerIdColorInstanced=this.cullAboveGround=this.multipassEnabled=this.hasOccludees=!1}}a.__decorate([d.parameter({count:c.ShaderOutput.COUNT})],g.prototype,"output",void 0);a.__decorate([d.parameter({count:f.CullFaceOptions.COUNT})],g.prototype,
"cullFace",void 0);a.__decorate([d.parameter({count:n.TransparencyPassType.COUNT})],g.prototype,"transparencyPassType",void 0);a.__decorate([d.parameter()],g.prototype,"hasSlicePlane",void 0);a.__decorate([d.parameter()],g.prototype,"hasVertexColors",void 0);a.__decorate([d.parameter()],g.prototype,"transparent",void 0);a.__decorate([d.parameter()],g.prototype,"polygonOffset",void 0);a.__decorate([d.parameter()],g.prototype,"enableOffset",void 0);a.__decorate([d.parameter()],g.prototype,"writeDepth",
void 0);a.__decorate([d.parameter()],g.prototype,"hasOccludees",void 0);a.__decorate([d.parameter()],g.prototype,"multipassEnabled",void 0);a.__decorate([d.parameter()],g.prototype,"cullAboveGround",void 0);a.__decorate([d.parameter()],g.prototype,"objectAndLayerIdColorInstanced",void 0);a.__decorate([d.parameter()],g.prototype,"vvColor",void 0);a.__decorate([d.parameter({constValue:!1})],g.prototype,"occlusionPass",void 0);a.__decorate([d.parameter({constValue:!0})],g.prototype,"hasVvInstancing",
void 0);a.__decorate([d.parameter({constValue:!1})],g.prototype,"vvSize",void 0);a.__decorate([d.parameter({constValue:!1})],g.prototype,"vvOpacity",void 0);b.ColorMaterialTechniqueConfiguration=g;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/PatternMaterial":function(){define("exports ../../../../chunks/vec4f64 ../../../../geometry/support/buffer/BufferView ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../lib/basicInterfaces ../lib/GLMaterial ../lib/OrderIndependentTransparency ../lib/RenderSlot ../lib/Util ../lib/VertexAttribute ./DefaultBufferWriter ./PatternStyle ./TriangleMaterial ./VisualVariablePassParameters ./internal/bufferWriterUtils ../shaders/PatternTechnique".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h){class t extends v.TriangleMaterial{constructor(z){super(z,new y);this.supportsEdges=!0;this._vertexAttributeLocations=h.vertexAttributeLocations;this._configuration=new h.PatternTechniqueConfiguration}getConfiguration(z,A){this._configuration.output=z;this._configuration.cullFace=this.parameters.cullFace;this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;
this._configuration.polygonOffset=this.parameters.polygonOffset;this._configuration.writeDepth=this.parameters.writeDepth;this._configuration.style=this.parameters.style;this._configuration.patternSpacing=this.parameters.patternSpacing;this._configuration.lineWidth=this.parameters.lineWidth;this._configuration.draped=this.parameters.draped;this._configuration.transparencyPassType=A.transparencyPassType;this._configuration.enableOffset=A.camera.relativeElevation<g.OITPolygonOffsetLimit;this._configuration.multipassEnabled=
A.multipassEnabled;this._configuration.cullAboveGround=A.multipassTerrain.cullAboveGround;this._configuration.vvColor=!!this.parameters.vvColor;return this._configuration}produces(z,A){return A===f.ShaderOutput.Color||A===f.ShaderOutput.Alpha||A===f.ShaderOutput.Highlight||A===f.ShaderOutput.Depth&&this.parameters.writeLinearDepth?z===q.RenderSlot.DRAPED_MATERIAL?!0:A===f.ShaderOutput.Highlight?z===q.RenderSlot.OPAQUE_MATERIAL:z===(this.parameters.writeDepth?q.RenderSlot.TRANSPARENT_MATERIAL:q.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):
!1}createGLMaterial(z){return new r(z)}createBufferWriter(){const z=d.newLayout().vec3f(m.VertexAttribute.POSITION).vec4f(m.VertexAttribute.UVMAPSPACE);this.parameters.draped||z.mat3f(m.VertexAttribute.BOUNDINGRECT);this.parameters.vvColor?z.f32(m.VertexAttribute.COLORFEATUREATTRIBUTE):z.vec4u8(m.VertexAttribute.COLOR);return new u(z)}}class r extends k{_updateParameters(z){return this.ensureTechnique(h.PatternTechnique,z)}_updateOccludeeState(z){z.hasOccludees!==this._material.parameters.hasOccludees&&
this._material.setParameters({hasOccludees:z.hasOccludees})}beginSlot(z){this._output!==f.ShaderOutput.Color&&this._output!==f.ShaderOutput.Alpha||this._updateOccludeeState(z);return this._updateParameters(z)}}class u extends l.DefaultBufferWriter{write(z,A,C,E,B){for(const F of this.vertexBufferLayout.fields.keys()){const K=C.attributes.get(F);var D=K?.indices;if(K&&D)switch(F){case m.VertexAttribute.UVMAPSPACE:e.assert(4===K.size);(D=E.getField(F,c.BufferViewVec4f))&&p.writeBufferVec4(K,D,B);break;
case m.VertexAttribute.BOUNDINGRECT:e.assert(9===K.size);(D=E.getField(F,c.BufferViewMat3f))&&this.writeBoundingRect(K,z,D,B);break;default:p.writeDefaultAttribute(F,K,z,A,E,B)}}}writeBoundingRect(z,A,C,E){const {data:B,indices:D}=z;z=C.typedBuffer;C=C.typedBufferStride;const F=D.length;E*=C;for(let L=0;L<F;++L){const G=9*D[L];var K=B[G];const O=B[G+1],P=B[G+2];z[E]=A[0]*K+A[4]*O+A[8]*P+A[12];z[E+1]=A[1]*K+A[5]*O+A[9]*P+A[13];z[E+2]=A[2]*K+A[6]*O+A[10]*P+A[14];for(K=3;9>K;++K)z[E+K]=B[G+K];E+=C}}}
class y extends x.VisualVariablePassParameters{constructor(){super(...arguments);this.color=a.fromValues(1,1,1,1);this.writeDepth=!0;this.hasSlicePlane=this.polygonOffset=this.hasVertexColors=this.writeLinearDepth=!1;this.cullFace=n.CullFaceOptions.None;this.hasOccludees=!1;this.style=w.Style.Cross;this.patternSpacing=10;this.lineWidth=1;this.draped=!0}}b.Parameters=y;b.PatternMaterial=t;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/PatternStyle":function(){define(["exports"],
function(b){b.Style=void 0;var a=b.Style||(b.Style={});a[a.Horizontal=0]="Horizontal";a[a.Vertical=1]="Vertical";a[a.Cross=2]="Cross";a[a.ForwardDiagonal=3]="ForwardDiagonal";a[a.BackwardDiagonal=4]="BackwardDiagonal";a[a.DiagonalCross=5]="DiagonalCross";a[a.COUNT=6]="COUNT";Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/PatternTechnique":function(){define("require exports ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../lib/TransparencyPassType ../lib/VertexAttribute ../materials/DefaultTechniqueConfiguration ../materials/PatternStyle ../../../../chunks/Pattern.glsl ../../../webgl/renderState".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h){class t extends n.ShaderTechnique{initializeProgram(z){return new e.Program(z.rctx,t.shader.get().build(this.configuration),y)}_setPipelineState(z,A){const C=this.configuration,E=z===l.TransparencyPassType.NONE,B=z===l.TransparencyPassType.FrontFace;return h.makePipelineState({blending:C.output===d.ShaderOutput.Color||C.output===d.ShaderOutput.Alpha?E?q.blendingDefault:q.oitBlending(z):null,culling:h.cullingParams(C.cullFace),depthTest:{func:q.oitDepthTest(z)},
depthWrite:E?C.writeDepth?h.defaultDepthWriteParams:null:q.oitDepthWrite(z),colorWrite:h.defaultColorWriteParams,stencilWrite:C.hasOccludees?m.stencilWriteMaskOn:null,stencilTest:C.hasOccludees?A?m.stencilToolMaskBaseParams:m.stencilBaseAllZerosParams:null,polygonOffset:E||B?C.polygonOffset?r:null:q.getOITPolygonOffset(C.enableOffset)})}initializePipeline(){this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0);return this._setPipelineState(this.configuration.transparencyPassType,
!1)}getPipeline(z){return z?this._occludeePipelineState:super.getPipeline()}}t.shader=new f.ReloadableShaderModule(p.Pattern,()=>new Promise((z,A)=>b(["./Pattern.glsl"],z,A)));const r={factor:1,units:1};class u extends v.DefaultTechniqueConfiguration{constructor(){super(...arguments);this.output=d.ShaderOutput.Color;this.cullFace=g.CullFaceOptions.None;this.transparencyPassType=l.TransparencyPassType.NONE;this.polygonOffset=this.hasVertexColors=this.hasSlicePlane=!1;this.writeDepth=!0;this.hasOccludees=
!1;this.enableOffset=!0;this.vvColor=this.cullAboveGround=this.multipassEnabled=!1}}c.__decorate([k.parameter({count:d.ShaderOutput.COUNT})],u.prototype,"output",void 0);c.__decorate([k.parameter({count:g.CullFaceOptions.COUNT})],u.prototype,"cullFace",void 0);c.__decorate([k.parameter({count:x.Style.COUNT})],u.prototype,"style",void 0);c.__decorate([k.parameter({count:l.TransparencyPassType.COUNT})],u.prototype,"transparencyPassType",void 0);c.__decorate([k.parameter()],u.prototype,"hasSlicePlane",
void 0);c.__decorate([k.parameter()],u.prototype,"hasVertexColors",void 0);c.__decorate([k.parameter()],u.prototype,"polygonOffset",void 0);c.__decorate([k.parameter()],u.prototype,"writeDepth",void 0);c.__decorate([k.parameter()],u.prototype,"hasOccludees",void 0);c.__decorate([k.parameter()],u.prototype,"patternSpacing",void 0);c.__decorate([k.parameter()],u.prototype,"lineWidth",void 0);c.__decorate([k.parameter()],u.prototype,"enableOffset",void 0);c.__decorate([k.parameter()],u.prototype,"draped",
void 0);c.__decorate([k.parameter()],u.prototype,"multipassEnabled",void 0);c.__decorate([k.parameter()],u.prototype,"cullAboveGround",void 0);c.__decorate([k.parameter()],u.prototype,"vvColor",void 0);c.__decorate([k.parameter({constValue:!1})],u.prototype,"occlusionPass",void 0);c.__decorate([k.parameter({constValue:!1})],u.prototype,"hasVvInstancing",void 0);c.__decorate([k.parameter({constValue:!1})],u.prototype,"vvSize",void 0);c.__decorate([k.parameter({constValue:!1})],u.prototype,"vvOpacity",
void 0);const y=new Map([[w.VertexAttribute.POSITION,0],[w.VertexAttribute.COLOR,3],[w.VertexAttribute.UVMAPSPACE,4],[w.VertexAttribute.COLORFEATUREATTRIBUTE,5],[w.VertexAttribute.BOUNDINGRECT,6]]);a.PatternTechnique=t;a.PatternTechniqueConfiguration=u;a.vertexAttributeLocations=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Pattern.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/materials/PatternStyle".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u){function y(C){const E=new h.ShaderBuilder,B=C.multipassEnabled&&(C.output===c.ShaderOutput.Color||C.output===c.ShaderOutput.Alpha),{vertex:D,fragment:F,attributes:K,varyings:L}=E;w.addProjViewLocalOrigin(D,C);E.include(f.Transform,C);E.include(n.VertexColor,C);E.include(e.VisualVariables,C);C.draped?D.uniforms.add(new x.FloatPassUniform("worldToScreenRatio",(O,P)=>1/P.screenToPCSRatio)):K.add(r.VertexAttribute.BOUNDINGRECT,"mat3");K.add(r.VertexAttribute.POSITION,
"vec3");K.add(r.VertexAttribute.UVMAPSPACE,"vec4");C.vvColor&&K.add(r.VertexAttribute.COLORFEATUREATTRIBUTE,"float");L.add("vColor","vec4");L.add("vpos","vec3");L.add("vuv","vec2");B&&L.add("depth","float");D.uniforms.add(new v.Float4PassUniform("uColor",O=>O.color));var G=C.style===u.Style.ForwardDiagonal||C.style===u.Style.BackwardDiagonal||C.style===u.Style.DiagonalCross;G&&D.code.add(p.glsl`
      const mat2 rotate45 = mat2(${p.glsl.float(.70710678118)}, ${p.glsl.float(-.70710678118)},
                                 ${p.glsl.float(.70710678118)}, ${p.glsl.float(.70710678118)});
    `);C.draped||(w.addCameraPosition(D,C),D.uniforms.add(new x.FloatPassUniform("worldToScreenPerDistanceRatio",(O,P)=>1/P.camera.perScreenPixelRatio)),D.code.add(p.glsl`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),D.code.add(p.glsl`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),D.code.add(p.glsl`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${p.glsl.float(.08715574274)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `));D.code.add(p.glsl`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${G?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${G?" * rotate45":""};

      ${C.draped?"":p.glsl`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${p.glsl.float(C.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `);if(G=C.output===c.ShaderOutput.Depth)E.include(k.OutputDepth,C),a.addNearFar(E),a.addLinearDepth(E);D.code.add(p.glsl`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${B?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      ${C.hasVertexColors?"vColor *\x3d uColor;":C.vvColor?"vColor \x3d uColor * interpolateVVColor(colorFeatureAttribute);":"vColor \x3d uColor;"}
      gl_Position = ${G?p.glsl`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:p.glsl`transformPosition(proj, view, vpos);`}
    }
  `);E.include(d.SliceDraw,C);F.include(l.ColorConversion);C.draped&&F.uniforms.add(new x.FloatPassUniform("texelSize",(O,P)=>1/P.camera.pixelRatio));C.output===c.ShaderOutput.Highlight&&E.include(g.OutputHighlight,C);B&&E.include(q.multipassTerrainTest,C);C.output!==c.ShaderOutput.Highlight&&(F.code.add(p.glsl`
      const float lineWidth = ${p.glsl.float(C.lineWidth)};
      const float spacing = ${p.glsl.float(C.patternSpacing)};
      const float spacingINV = ${p.glsl.float(1/C.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),C.draped||F.code.add(p.glsl`const int maxSamples = 5;
float sampleAA(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`));F.code.add(p.glsl`
    void main() {
      discardBySlice(vpos);
      ${B?"terrainDepthTest(depth);":""}
      vec4 color = vColor;
      color = highlightSlice(color, vpos);

      ${C.output!==c.ShaderOutput.Highlight?p.glsl`color.a *= ${z(C)};`:""}

      ${C.output===c.ShaderOutput.ObjectAndLayerIdColor?p.glsl`color.a = 1.0;`:""}

      if (color.a < ${p.glsl.float(m.symbolAlphaCutoff)}) {
        discard;
      }

      ${C.output===c.ShaderOutput.Alpha?p.glsl`fragColor = vec4(color.a);`:""}

      ${C.output===c.ShaderOutput.Color?p.glsl`fragColor = color; ${C.transparencyPassType===t.TransparencyPassType.Color?"fragColor \x3d premultiplyAlpha(fragColor);":""}`:""}
      ${C.output===c.ShaderOutput.Highlight?p.glsl`outputHighlight();`:""}
      ${C.output===c.ShaderOutput.Depth?p.glsl`outputDepth(linearDepth);`:""};
    }
  `);return E}function z(C){function E(B){return C.draped?p.glsl`coverage(vuv.${B}, texelSize)`:p.glsl`sampleAA(vuv.${B})`}switch(C.style){case u.Style.ForwardDiagonal:case u.Style.Horizontal:return E("y");case u.Style.BackwardDiagonal:case u.Style.Vertical:return E("x");case u.Style.DiagonalCross:case u.Style.Cross:return p.glsl`
        1.0 - (1.0 - ${E("x")}) * (1.0 - ${E("y")})
      `;default:return"0.0"}}const A=Object.freeze(Object.defineProperty({__proto__:null,build:y},Symbol.toStringTag,{value:"Module"}));b.Pattern=A;b.build=y})},"esri/views/3d/layers/graphics/Graphics3DTextSymbolLayer":function(){define("exports ../../../../core/Error ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../chunks/vec2f64 ../../../../symbols/callouts/calloutUtils ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DObjectMetadata ./Graphics3DSymbolLayer ./graphicUtils ./LabelParameters ./placementUtils ./pointUtils ../../webgl-engine/lib/FontMetrics ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/TextRenderParameters ../../webgl-engine/lib/TextTextureFactory ../../webgl-engine/materials/HUDMaterial".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y){function z(D,F,K){D&&D.forEach(L=>{const G=F(L);null!=G&&K(G,L.graphic)})}function A(D,F){if("baseline"===F.verticalPlacement)return f.fromValues(x.horizontalPlacementToAnchorX[F.horizontalPlacement],null!=D?D.baselineAnchorY:0);D=x.anchorFromPlacements(F.horizontalPlacement,F.verticalPlacement);return x.namedAnchorToHUDMaterialAnchorPos[D]}const C=[0,0,1];class E extends l.Graphics3DSymbolLayer{constructor(D,F,K,L){super(D,F,K,L);this._elevationOptions=
{supportsOffsetAdjustment:!0,supportsOnTheGround:!1};this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const D=w.validateSymbolLayerSize(this.symbolLayer.size);if(D)throw new a("graphics3dtextsymbollayer:invalid-size",D);}await this._createTextRenderParameters()}async _createTextRenderParameters(){this._textRenderParameters=await r.TextRenderParameters.fromSymbol(this.symbolLayer,this._context.graphicsCoreOwner.view.state.rasterPixelRatio)}destroy(){super.destroy()}createGraphics3DGraphic(D){D=
D.graphic;const F=p.placePointOnGeometry(D.geometry);if(null==F)return this.logger.warn(`unsupported geometry type for text symbol: ${D.geometry.type}`),null;const K=this.symbolLayer.text;if(null==K||""===K)return null;var L=n.hasCalloutSupport(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(null!=L&&!n.textSymbolLayerSupportsVerticalOffset(this.symbolLayer))return this.logger.errorOncePerTick("Callouts and vertical offset on text symbols are currently only supported with 'center' "+
`horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;var {verticalAlignment:G}=this.symbolLayer;L=new v.LabelPlacement(L);x.verticalScreenOffsetFromAlignment(G,L.screenOffset);G=new v.LabelParameters(L,this.symbolLayer.horizontalAlignment,x.verticalPlacementFromAlignment(G));return this._createAs3DShape(D,F,K,G)}createLabel(D,F,K,L,G){D=D.graphic;const O=p.placePointOnGeometry(D.geometry);if(null==O)return this.logger.warn(`unsupported geometry type for label: ${D.geometry.type}`),
null;const P=F.text;return!P||/^\s+$/.test(P)?null:this._createAs3DShape(D,O,P,F,K,L,G)}setGraphicElevationContext(D,F,K=0){super.setGraphicElevationContext(D,F);F.addOffsetRenderUnits(K);return F}layerOpacityChanged(){this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer");return!1}layerElevationInfoChanged(D,F){z(D,F,(K,L)=>{this.updateGraphicElevationContext(L,K)});return g.SymbolUpdateType.UPDATE}slicePlaneEnabledChanged(D,F){z(D,F,K=>{for(const L of K.stageObject.geometries)L.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})});
return!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return!1}updateGraphicElevationContext(D,F){const K=F.elevationContext;this.setGraphicElevationContext(D,K,null!=F.metadata?F.metadata.elevationOffset:0);F.needsElevationUpdates=g.needsElevationUpdates2D(K.mode)||"absolute-height"===K.mode}_defaultElevationInfoNoZ(){return B}_createAs3DShape(D,F,K,L,G=null,O=null,P=()=>L.placement.elevationOffset){const J=this.setGraphicElevationContext(D,new q.ElevationContext,L.placement.elevationOffset);
var R="polyline"===D.geometry?.type,X=D.uid;let U=null,M=null;if(null==O){var V=x.textRenderAlignmentFromHorizontalPlacement(L.horizontalPlacement);U=new u(K,V,this._textRenderParameters);let Y=null;if(null!=this._context.sharedResources.textures){M=this._context.sharedResources.textures.fromData(U.key,()=>U.create());M.texture.events.on("unloaded",()=>Y?.release());V=this._context.stage.renderView.textureRepository.acquire(M.texture.id);if(null==V||c.isPromiseLike(V))return M.release(),null;Y=V}}V=
A(U,L);V={occlusionTest:!0,screenOffset:L.placement.screenOffset,anchorPosition:V,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:L.placement.centerOffsetUnits,drawInSecondSlot:!0};O?V.textureId=O.id:M&&(V.textureId=M.texture.id);if(null!=L.placement.verticalOffset){const {screenLength:Y,minWorldLength:W,maxWorldLength:H}=L.placement.verticalOffset;V.verticalOffset={screenLength:d.pt2px(Y),minWorldLength:W||0,maxWorldLength:null!=H?H:Infinity}}if(this._context.screenSizePerspectiveEnabled){const {screenSizePerspectiveSettings:Y,
screenSizePerspectiveSettingsLabels:W}=this._context.sharedResources;O=h.getFontMetrics(this._textRenderParameters);V.screenSizePerspective=W.overrideFontHeight(O.maxHeight);V.screenSizePerspectiveAlignment=Y}R&&(V.shaderPolygonOffset=1E-4);V.hasSlicePlane=this._context.slicePlaneEnabled;R=(Y,W)=>{const H=JSON.stringify(W);let S=Y.get(H);null==S&&(S=new y.HUDMaterial(W),Y.add(H,S));return S};R=G?R(G,V):new y.HUDMaterial(V);O=L.placement.translation;V=U?f.fromValues(U.displayWidth,U.displayHeight):
f.ZEROS;O=t.createPointGeometry(R,C,O,null,V,L.placement.centerOffset,[0,0],null);X=p.createStageObject(this._context,F,O,J,X);if(null==X)return null;G=new e.Graphics3DObject3DGraphicLayer(this,X.object,[O],null==G?[R]:null,M,(Y,W,H,S,I,Q)=>{const N=P()||L.placement.elevationOffset;W=this.setGraphicElevationContext(D,W,N);return k.perObjectElevationAligner(Y,W,H,S,I,Q)},J);G.alignedSampledElevation=X.sampledElevation;G.needsElevationUpdates=g.needsElevationUpdates2D(J.mode)||"absolute-height"===J.mode;
G.getScreenSize=(Y=f.create())=>{Y[0]=U?U.displayWidth:L.displaySize[0];Y[1]=U?U.displayHeight:L.displaySize[1];return Y};K=new m.Graphics3DObjectMetadata(L.placement.elevationOffset,K);G.metadata=K;p.extendPointGraphicElevationContext(G,F,this._context.elevationProvider);return G}}const B={mode:"relative-to-ground",offset:0};b.Graphics3DTextSymbolLayer=E;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/LabelParameters":function(){define(["exports","../../../../chunks/vec2f64",
"../../../../chunks/vec3f64","../../../../chunks/vec4f64"],function(b,a,c,d){class f{constructor(k,g="center",q=!1,e=a.create(),m=d.fromValues(0,0,0,-1),l="world",w=c.create(),v=0){this.verticalOffset=k;this.anchor=g;this.hasLabelVerticalOffset=q;this.screenOffset=e;this.centerOffset=m;this.centerOffsetUnits=l;this.translation=w;this.elevationOffset=v}}class n{constructor(k,g="center",q="center",e=null,m=a.create()){this.placement=k;this.horizontalPlacement=g;this.verticalPlacement=q;this.text=e;
this.displaySize=m}}b.LabelParameters=n;b.LabelPlacement=f;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextRenderParameters":function(){define("exports ../../../../Color ../../../../core/fontUtils ../../../../core/Logger ../../../../core/screenUtils ../../../../chunks/vec4f64".split(" "),function(b,a,c,d,f,n){class k{constructor(q){this.definition=q;this.key=JSON.stringify(q);this.haloSize=Math.round(q.halo.size);this.textStyle=this._colorToRGBA(q.color);
this.haloStyle=this._colorToRGB(q.halo.color);this.backgroundStyle=0!==q.background.color[3]?this._colorToRGBA(q.background.color):null}fontString(q){const e=this.definition.font;return`${e.style} ${e.weight} ${q}px ${e.family}, ${"sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji"}`}setFontProperties(q,e){q.font=this.fontString(e);q.textAlign="left";q.textBaseline="alphabetic"}_colorToRGB(q){return`rgb(${q.slice(0,3).map(e=>Math.floor(255*e)).toString()})`}_colorToRGBA(q){return`rgba(${q.slice(0,
3).map(e=>Math.floor(255*e)).toString()},${q[3]})`}static async fromSymbol(q,e){var m=a.toUnitRGBA(q?.material?.color)??n.ZEROS,l=null!=q.size?f.pt2px(q.size):12;const w=q.lineHeight,v=null!=q.background?a.toUnitRGBA(q.background.color):n.ZEROS,x={family:q.font?.family??"sans-serif",decoration:q.font?.decoration??"none",weight:q.font?.weight??"normal",style:q.font?.style??"normal"};var p=q.halo;p=null!=p?.color&&0<p.size?{size:f.pt2px(p.size),color:a.toUnitRGBA(p.color)}:{size:0,color:n.ZEROS};e=
new k({color:m,size:l,background:{color:v,padding:null!=q.background?[.65*l,.5*l]:[0,0],borderRadius:null!=q.background?.375*l:0},lineSpacingFactor:w,font:x,halo:p,pixelRatio:e});if(q.font){m=!1;l=e.fontString(l);try{m=(await document.fonts.load(l)).some(h=>!c.isCachedFontFace(h))}catch(h){d.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${l}'. Some text symbology may be rendered using the default browser font.`)}if(!m&&!g.has(q.font.family))try{await c.loadFont(q.font)}catch(h){}}return e}}
const g=new Set("Arial;Times New Roman;Courier New;serif;sans-serif;monospace;cursive;fantasy;system-ui;ui-serif;ui-sans-serif;ui-monospace;ui-rounded;math;emoji;fangsong".split(";"));b.TextRenderParameters=k;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/core/fontUtils":function(){define(["exports","../config"],function(b,a){function c(g){if(!g)return"arial-unicode-ms";g=g.toLowerCase().split(" ").join("-");switch(g){case "serif":return"noto-serif";case "sans-serif":return"arial-unicode-ms";
case "monospace":return"ubuntu-mono";case "fantasy":return"cabin-sketch";case "cursive":return"redressed";default:return g}}function d(g){a:{if(g.weight)switch(g.weight.toLowerCase()){case "bold":case "bolder":var q="-bold";break a}q=""}a:{if(g.style)switch(g.style.toLowerCase()){case "italic":case "oblique":var e="-italic";break a}e=""}q+=e;return c(g.family)+(0<q.length?q:"-regular")}const f=new Map,n=new Set;class k{constructor(g,q){this.fontFace=g;this.promise=q}}b.clearFonts=function(){const g=
document.fonts;f.forEach(q=>{g.delete(q.fontFace)});f.clear();n.clear()};b.defaultFontFamily="arial-unicode-ms";b.getFontFamily=c;b.getFullyQualifiedFontName=d;b.isCachedFontFace=function(g){return n.has(g)};b.loadFont=async function(g){const q=d(g),e=f.get(q);if(e)return e.promise;const m=new FontFace(g.family,`url('${a.fontsUrl}/woff2/${q}.${"woff2"}') format('${"woff2"}')`,{style:g.style,weight:g.weight}),l=document.fonts;if(l.has(m)&&"loading"===m.status)return m.loaded;g=m.load().then(()=>{l.add(m);
return m});f.set(q,new k(m,g));n.add(m);return g};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextTextureFactory":function(){define(["./TextHelperCanvas","./TextRenderer","./TextTextureAtlas","./Texture","../../../webgl/enums"],function(b,a,c,d,f){class n{constructor(g,q,e){this._renderer=new a.TextRenderer(g,q,e,c.TextTextureAtlas.maxSize)}get key(){return this._renderer.key}get baselineAnchorY(){return 1-this._renderer.firstRenderedBaselinePosition/
this._renderer.renderedHeight}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}create(){const g=b.getTextHelperCanvas(k,this._renderer.renderedWidth,this._renderer.renderedHeight),q=g.getContext("2d");q.save();this._renderer.render(q,0,0);q.restore();return new d.Texture(g,{wrap:{s:f.TextureWrapMode.CLAMP_TO_EDGE,t:f.TextureWrapMode.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0})}}const k={canvas:null};return n})},"esri/views/3d/webgl-engine/lib/TextTextureAtlas":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/maybe ../../../../core/uid ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec4 ../../../../chunks/vec4f64 ./ContentObjectType ./testUtils ./textureUtils ./VertexAttribute ../../../support/Scheduler ../../../webgl/enums ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y){function z(D,F){D.geometries[0].setAttributeData(h.VertexAttribute.UV0,F.uv);D.geometryVertexAttributeUpdated(D.geometries[0],h.VertexAttribute.UV0,!0)}b.TextTextureAtlas=class extends c{constructor(D){super(D);this.type=v.ContentObjectType.Texture;this.id=n.generateUID();this.events=new d;this._glTexture=null;this._atlas=new C(256,256);this._needsRepack=!1;this._canRepack=!0;this._elementsToRender=new Map;this._elements=new Map;this._stageObjects=
new Map;this.updating=!1}initialize(){this._canvas=document.createElement("canvas");this._canvas.setAttribute("id","textAtlasCanvas");this._canvas.setAttribute("style","display:none");this._ctx=this._canvas.getContext("2d");this._stage=this.view._stage;this._stage.add(this);this._updateCanvasElementSize(this._atlas);this._reset()}unload(){this._glTexture=f.disposeMaybe(this._glTexture);this.updating=!1;this.events.emit("unloaded")}get glTexture(){return this._glTexture}static get maxSize(){B=x.textTextureAtlas.stableRendering?
2:0;return[4094-B,4094-B-2]}load(D){if(this._glTexture)return this._glTexture;const F=new y.TextureDescriptor;F.wrapMode=r.TextureWrapMode.CLAMP_TO_EDGE;F.samplingMode=r.TextureSamplingMode.LINEAR_MIPMAP_LINEAR;F.hasMipmap=!0;F.preMultiplyAlpha=!0;F.maxAnisotropy=D.parameters.maxMaxAnisotropy;this._glTexture=new u.Texture(D,F,this._canvas);this._frameWorker=this.view.resourceController.scheduler.registerTask(t.TaskPriority.TEXT_TEXTURE_ATLAS,this);this.setDirty();return this._glTexture}dispose(){this._elements.clear();
this._elementsToRender.clear();this._frameWorker=f.removeMaybe(this._frameWorker);this._glTexture&&(this._stage.remove(this),this._glTexture=f.disposeMaybe(this._glTexture));this._canvas.width=0;this._canvas.height=0;this._ctx=this._canvas=null}_updateCanvasElementSize(D){this._canvas.setAttribute("width",D.width.toString());this._canvas.setAttribute("height",D.height.toString())}_resizeAtlas(D,F){const {width:K,height:L}=this._atlas;if(K!==D||L!==F)this._atlas.width=D,this._atlas.height=F,this._glTexture?.resize(D,
F),this._glTexture?.updateData(0,0,0,K,L,this._canvas),this._updateCanvasElementSize(this._atlas),this._elements.forEach(G=>{this._stageObjects.get(G.textRenderer.key)?.forEach(O=>z(O,G))}),this._reset()}_reset(){this._elementsToRender.clear();this._atlas.reset();this._needsRepack=!0;this.setDirty()}_addAtlasElement(D,F,K,L){const G=this._atlas;if(G.width<K||G.height<L)return!1;let O=G.cursors.get(L);if(!O){if(G.height<G.nextY+L)return!1;O=[new E(G.nextY)];G.cursors.set(L,O);G.nextY+=L}let P=O.find(J=>
G.width>=J.x+K);if(null==P){if(G.height<G.nextY+L)return!1;P=new E(G.nextY);G.nextY+=L;O.push(P)}D.setNewPosition(P);this._elements.set(F,D);this._elementsToRender.set(F,D);P.x+=K;return!0}_ensureStageObjects(D){var F=this._stageObjects.get(D);if(F)return F;F=new Set;this._stageObjects.set(D,F);return F}_addStageObject(D,F){this._ensureStageObjects(D).add(F)}_removeStageObject(D,F){this._stageObjects.get(D)?.delete(F)&&(F.geometries[0].setAttributeData(h.VertexAttribute.SIZE,[0,0]),F.geometryVertexAttributeUpdated(F.geometries[0],
h.VertexAttribute.SIZE),this._elementsToRender.delete(D))}_processAddition(D){const F=D.textRenderer.key;if(this._needsRepack)this._elements.set(F,D);else{var K=this._atlas,L=D.textRenderer.renderedWidth+2,G=D.textRenderer.renderedHeight+2+2;this._addAtlasElement(D,F,L,G)||(this._canRepack?this._reset():K.width<L?(L=Math.min(p.applyTextureResizeModulo(Math.max(L,1.5*K.width)),4096),this._resizeAtlas(L,K.height)):(L=Math.min(p.applyTextureResizeModulo(Math.max(K.nextY+G,1.5*K.height)),4096),L>K.height?
this._resizeAtlas(K.width,L):4096>K.width&&(L=Math.min(p.applyTextureResizeModulo(1.5*K.width),4096),this._resizeAtlas(L,K.height))),this._elements.set(F,D))}}_renderElement(D){const F=D.commitNewPosition();this._ctx.clearRect(F[0]-2,F[1]-2,D.textRenderer.renderedWidth+4,D.textRenderer.renderedHeight+4);D.textRenderer.render(this._ctx,F[0],F[1]);this._stageObjects.get(D.textRenderer.key)?.forEach(K=>z(K,D))}get running(){return this.updating}runTask(D){if(null==this._glTexture)return t.Task.YIELD;
for(;this._needsRepack&&(this._canRepack||4096>this._atlas.height&&4096>this._atlas.height);){this._canRepack=this._needsRepack=!1;const F=this._elements;this._elements=new Map;F.forEach(K=>this._processAddition(K));D.madeProgress()}if(0<this._elementsToRender.size){for(const [F,K]of this._elementsToRender){if(D.done)break;this._renderElement(K);this._elementsToRender.delete(F);D.madeProgress()}this._glTexture.setData(this._canvas)}this.updating=0<this._elementsToRender.size}addTextTexture(D,F){var K=
D.key;this._addStageObject(K,F);K=this._elements.get(K);null==K&&(K=new A(this._atlas,D),this._processAddition(K),this.setDirty());F.geometries[0].setAttributeData(h.VertexAttribute.SIZE,[K.textRenderer.displayWidth,K.textRenderer.displayHeight]);F.geometryVertexAttributeUpdated(F.geometries[0],h.VertexAttribute.SIZE);z(F,K)}removeTextTexture(D,F){D=D.key;this._elements.get(D)&&(this._removeStageObject(D,F),(F=this._stageObjects.get(D))&&0!==F.size||this._elements.delete(D),0===F?.size&&this._stageObjects.delete(D),
this._canRepack=!0)}setDirty(){this._glTexture&&(this.updating=!0)}get test(){const {_elements:D,_stageObjects:F,_atlas:K}=this,L=this;return{elements:D,stageObjects:F,atlas:K,resizeAtlas:(G,O)=>L._resizeAtlas(G,O),run:G=>L.runTask(G)}}};a.__decorate([k.property({constructOnly:!0})],b.TextTextureAtlas.prototype,"view",void 0);a.__decorate([k.property({type:Boolean})],b.TextTextureAtlas.prototype,"updating",void 0);b.TextTextureAtlas=a.__decorate([m.subclass("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],
b.TextTextureAtlas);class A{constructor(D,F){this._atlas=D;this.textRenderer=F;this._uv=w.create();this._newPosition=[0,0]}get uv(){if(null==this._xOffset||null==this._yOffset)return w.ZEROS;const {renderedWidth:D,renderedHeight:F}=this.textRenderer;return l.set(this._uv,this._xOffset/this._atlas.width,(this._yOffset+F)/this._atlas.height,(this._xOffset+D)/this._atlas.width,this._yOffset/this._atlas.height)}setNewPosition(D){this._newPosition[0]=D.x;this._newPosition[1]=D.y}commitNewPosition(){this._xOffset=
this._newPosition[0];this._yOffset=this._newPosition[1];return this._newPosition}get xOffset(){return this._xOffset}get yOffset(){return this._yOffset}}class C{constructor(D,F){this.width=D;this.height=F;this.cursors=new Map;this.nextY=0}reset(){this.cursors.clear();this.nextY=B}}class E{constructor(D){this.y=D;this.x=B}}let B=0;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DWaterSymbolLayer":function(){define("exports ../../../../Color ../../../../core/unitUtils ../../../../chunks/earcut ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec4 ../../../../chunks/common ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/DoubleArray ./ElevationAligners ./elevationAlignmentUtils ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./polygonUtils ../../support/renderInfoUtils/polygon ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/WaterMaterial ../../webgl-engine/materials/internal/waterMaterialUtils".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z){const A=["polyline","polygon","extent"];class C extends p.Graphics3DSymbolLayer{constructor(G,O,P,J){super(G,O,P,J)}async doLoad(){}destroy(){super.destroy();this._context.stage.remove(this._materials[0]);this._materials.length=0}createGraphics3DGraphic(G){G=G.graphic;if(!this._validateGeometry(G.geometry,A,this.symbolLayer.type))return null;const O=this.setGraphicElevationContext(G);this.ensureDrapedStatus("on-the-ground"===O.mode);this.ensureMaterial();
return this.draped?this._createAsOverlay(G):this._createAs3DShape(G,O,G.uid)}ensureMaterial(){if(!this._materials[0]){var G=new y.WaterMaterialParameters,O=this.symbolLayer.color;null!=O&&(G.color=a.toUnitRGBA(O));O=this._getCombinedOpacity(O,{hasIntrinsicColor:!0});G.color=[G.color[0],G.color[1],G.color[2],O];G.transparent=1>O||this.needsDrivenTransparentPass;G.waveDirection=null!=this.symbolLayer.waveDirection?C.headingVectorFromAngle(this.symbolLayer.waveDirection):n.fromValues(0,0);O=z.wavePresets[this.symbolLayer.waveStrength+
"-"+this.symbolLayer.waterbodySize];G.waveStrength=O.waveStrength;G.waveTextureRepeat=O.textureRepeat;G.waveVelocity=O.waveVelocity;G.flowStrength=O.perturbationStrength;G.hasSlicePlane=this._context.slicePlaneEnabled;G.isDraped=this.draped;this._materials[0]=new y.WaterMaterial(G);this._context.stage.add(this._materials[0])}}layerOpacityChanged(){if(null!=this._materials[0]){var G=this._materials[0].parameters.color,O=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0});this._materials[0].setParameters({color:[G[0],
G[1],G[2],O],transparent:1>O||this.needsDrivenTransparentPass})}}layerElevationInfoChanged(G,O,P){const J=this._elevationContext.mode;P=w.elevationModeChangeUpdateType(C.elevationModeChangeTypes,P,J);if(P!==w.SymbolUpdateType.UPDATE)return P;const R=w.needsElevationUpdates2D(J);return this.updateGraphics3DGraphicElevationInfo(G,O,()=>R)}slicePlaneEnabledChanged(){this._materials[0]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(G,
O,P){const J=h.geometryAsPolygon(G.geometry);if(null==J)return null;const R=t.geometryToRenderInfo(J,this._context.elevationProvider,this._context.renderCoordsHelper,O),X=R.position.length/3,U=m.newDoubleArray(2*X);this._createUVCoordsFromVertices(U,R.mapPositions,X,this._context.elevationProvider.spatialReference);G=new K(R,U,this._context.layer.uid,G.uid);G.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(G);this._create3DShapeGeometries(G);this._logGeometryCreationWarnings(G.renderData,
J.rings,"rings","WaterSymbol3DLayer");if(0===G.outGeometries.length)return null;P=new r.Object3D({geometries:G.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:P});P=new x.Graphics3DObject3DGraphicLayer(this,P,G.outGeometries,null,null,l.perVertexElevationAligner,O);P.alignedSampledElevation=G.renderData.sampledElevation;P.needsElevationUpdates=w.needsElevationUpdates2D(O.mode);return P}_createUVCoordsFromVertices(G,O,P,J){J=c.getMetersPerUnitForSR(J);e.empty(B);for(var R=0;R<
P;R++)f.set(D,O[3*R],O[3*R+1]),e.expandPointInPlace(B,D);k.scale(B,B,J);R=B[1]%C.unitSizeOfTexture;E[0]=B[0]-B[0]%C.unitSizeOfTexture;E[1]=B[1]-R;for(R=0;R<P;R++)G[2*R]=(O[3*R]*J-E[0])/C.unitSizeOfTexture,G[2*R+1]=(O[3*R+1]*J-E[1])/C.unitSizeOfTexture}_create3DShapeGeometries(G){var O=G.renderData.polygons;const P=G.uvCoords;for(const {count:J,index:R,position:X,mapPositions:U,holeIndices:M}of O){if(null!=this._context.clippingExtent&&(q.empty(F),q.expandWithBuffer(F,U),!q.intersectsClippingArea(F,
this._context.clippingExtent)))continue;O=d.earcut(U,M,3);if(0===O.length)continue;const V=m.doubleSubArray(P,2*R,2*J);O=h.createWaterGeometry({material:this._materials[0],indices:O,mapPositions:U,attributeData:{position:X,uv0:V}},G.objectAndLayerIdColor);G.outGeometries.push(O)}}_createAsOverlay(G){const O=h.geometryAsPolygon(G.geometry);if(null==O)return null;this._materials[0].renderPriority=this._renderPriority;const P=t.geometryToRenderInfoDraped(O,this._context.overlaySR),J=P.position.length/
3,R=m.newDoubleArray(2*J);this._createUVCoordsFromVertices(R,P.position,J,this._context.overlaySR);G=new L(P,R,this._context.layer.uid,G.uid);G.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(G);G.outBoundingBox=q.empty();this._createAsOverlayWater(G);this._logGeometryCreationWarnings(G.renderData,O.rings,"rings","WaterSymbol3DLayer");return 0===G.outGeometries.length?null:new v.Graphics3DDrapedGraphicLayer(this,G.outGeometries,G.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayWater(G){const O=
G.uvCoords;var P=G.renderData.polygons;for(const {position:J,holeIndices:R,index:X,count:U}of P){q.empty(F);q.expandWithBuffer(F,J);if(!q.intersectsClippingArea(F,this._context.clippingExtent))continue;q.expandWithAABB(G.outBoundingBox,F);P=d.earcut(J,R,3);if(0===P.length)continue;const M=m.doubleSubArray(O,2*X,2*U);P=h.createWaterGeometry({material:this._materials[0],indices:P,attributeData:{position:J,uv0:M}},G.objectAndLayerIdColor);G.outGeometries.push(new u.RenderGeometry(P,G))}}static headingVectorFromAngle(G){const O=
n.create();G=g.toRadian(G);O[0]=Math.sin(G);O[1]=Math.cos(G);return O}test(){return{...super.test(),create3DShape:G=>this._createAs3DShape(G.graphic,G.elevationContext,G.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}}C.unitSizeOfTexture=100;C.elevationModeChangeTypes={definedChanged:w.SymbolUpdateType.RECREATE,staysOnTheGround:w.SymbolUpdateType.NONE,onTheGroundChanged:w.SymbolUpdateType.RECREATE};const E=n.create(),B=e.create(),D=n.create(),F=q.create();class K extends h.PolygonCreationDataBase{constructor(G,
O,P,J){super(G,P,J);this.uvCoords=O}}class L extends h.PolygonCreationDataBase{constructor(G,O,P,J){super(G,P,J);this.uvCoords=O}}b.Graphics3DWaterSymbolLayer=C;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/internal/waterMaterialUtils":function(){define(["exports"],function(b){b.wavePresets={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,
waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,
perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DWebStyleSymbol":function(){define(["exports",
"./defaultSymbolComplexity","./interfaces","./Loadable"],function(b,a,c,d){class f extends d.Loadable{constructor(n,k,g){super(k);this.symbol=n;this._convert=g;this.symbologySnappingSupported=!1;this.graphics3DSymbol=null;this.referenced=0}getSymbolLayerSize(n){return null!=this.graphics3DSymbol?this.graphics3DSymbol.getSymbolLayerSize(n):null}get symbolLayers(){return null!=this.graphics3DSymbol?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return null!=this.graphics3DSymbol?this.graphics3DSymbol.extentPadding:
0}async doLoad(n){n=await this.symbol.fetchSymbol({signal:n});n.id=this.symbol.id;this.graphics3DSymbol=this._convert(n);null!=this.graphics3DSymbol&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(n){return null!=this.graphics3DSymbol?this.graphics3DSymbol.createGraphics3DGraphic(n,this):null}get complexity(){return null!=this.graphics3DSymbol?this.graphics3DSymbol.complexity:a.emptySymbolComplexity}globalPropertyChanged(n,k){return null!=this.graphics3DSymbol?this.graphics3DSymbol.globalPropertyChanged(n,
k):!1}applyRendererDiff(n,k){return null!=this.graphics3DSymbol?this.graphics3DSymbol.applyRendererDiff(n,k):c.ApplyRendererDiffResult.RecreateSymbol}prepareSymbolPatch(n){null!=this.graphics3DSymbol&&this.graphics3DSymbol.prepareSymbolPatch(n)}updateGeometry(n,k){return null!=this.graphics3DSymbol?this.graphics3DSymbol.updateGeometry(n,k):!1}updateTransform(n,k,g,q){return this.graphics3DSymbol?.updateTransform(n,k,g,q)??!1}onRemoveGraphic(){}getFastUpdateStatus(){return null!=this.graphics3DSymbol?
this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){null!=this.graphics3DSymbol&&this.graphics3DSymbol.destroy();this.graphics3DSymbol=void 0;super.destroy()}get destroyed(){return void 0===this.graphics3DSymbol}}b.Graphics3DWebStyleSymbol=f;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/labelPlacement":function(){define("exports ../../../../core/has ../../../../core/Logger ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ./constants ./graphicSymbolUtils ./LabelParameters ../../webgl-engine/lib/TextRenderer ../../webgl-engine/materials/HUDMaterial".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m){function l(E){E=g.getGraphics3DSymbol(E.graphics3DGraphic.graphics3DSymbol);return null!=E?E.symbol.symbolLayers.at(0):null}function w(E,B){var D=B.graphics3DGraphic.graphic.geometry;if(null==D)return null;if(null!=B.disablePlacement)return B.labelClass.labelPlacement?(u.warnOncePerTick(v(E?.placement,B.disablePlacement.logEntityDescription)),x(B)):E;D=D.type;switch(D){case "polyline":case "polygon":case "extent":case "multipoint":if(B.labelClass.labelPlacement)return u.warnOncePerTick(v(E?.placement,
`'${D}' geometries`)),x(B)}return E}function v(E,B){return`the requested label placement '${E}' is currently unsupported for ${B} in SceneView.`}function x(E){const B=E.graphics3DGraphic.graphic.geometry;if(null==B)return null;switch(B.type){case "polyline":case "extent":case "multipoint":return{placement:"center-center",normalizedOffset:f.ZEROS,anchor:"center"};case "polygon":return E=l(E),null!=E&&"extrude"===E.type?z["above-center"]:{placement:"center-center",normalizedOffset:f.ZEROS,anchor:"center"};
case "point":return z["above-center"];case "mesh":return z["above-center"]}}function p(E,B=A){({graphics3DGraphic:E}=E);(E=E.layers[0]?.stageObject.geometries[0].material??null)&&E instanceof m.HUDMaterial?(E=E.parameters.anchorPosition,B[0]=2*(E[0]-.5),B[1]=2*(E[1]-.5)):(B[0]=0,B[1]=0);return B}function h(E,B,D){D=null!=D?D.getBoundingBoxObjectSpace(C):C;D=f.fromValues(D[3]-D[0],D[4]-D[1],D[5]-D[2]);E.centerOffset[0]=Math.sqrt(D[0]*D[0]+D[1]*D[1])/2*B.normalizedOffset[0];const F=E.translation[2],
K=D[2]/2*B.normalizedOffset[1];E.translation[2]=0;E.elevationOffset=F+K;D=d.length(D);E.centerOffset[2]=D/2*B.normalizedOffset[2]}function t(E){const B=E.labelClass.labelPlacement,{labelSymbol:D,graphics3DGraphic:F}=E;var K=g.getGraphics3DSymbol(F.graphics3DSymbol);K="point-3d"===K?.symbol.type?K.symbol:null;E=z[B]||x(E);if(null!=K&&K.supportsCallout()&&K.hasVisibleVerticalOffset()&&!F.isDraped)return{placement:null,hasLabelVerticalOffset:!1,verticalOffset:r(K.verticalOffset),anchor:null,normalizedOffset:null};
if(D&&D.hasVisibleVerticalOffset()&&(null==K||!K.supportsCallout()||!K.verticalOffset||F.isDraped)){if(!(K=!E)){a:switch(E.placement){case "above-center":K=!0;break a;default:K=!1}K=!K}return K?(u.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+B+" placement)"),null):{placement:"above-center",verticalOffset:r(D.verticalOffset),anchor:"bottom",normalizedOffset:[0,E.normalizedOffset[1],0],hasLabelVerticalOffset:!0}}return{placement:null,
verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}}function r(E){const {screenLength:B,minWorldLength:D,maxWorldLength:F}=E;return{screenLength:B,minWorldLength:D,maxWorldLength:F}}const u=c.getLogger("esri.views.3d.layers.graphics.labelPlacement");class y{constructor(E,B,D,F=null){this.graphics3DGraphic=E;this.labelSymbol=B;this.labelClass=D;this.disablePlacement=F}}const z={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",
normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",
normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}};a={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],
"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const E in a){const B=z[E];a[E].forEach(D=>{z[D]=B})}Object.freeze&&(Object.freeze(z),Object.keys(z).forEach(E=>{Object.freeze(z[E]);Object.freeze(z[E]?.normalizedOffset)}));const A=[0,0],C=n.create();b.LabelInfo=y;b.getLabelPlacement=function(E){var B=t(E);if(null==B)return null;if(B.anchor)var D=B;else{D=E.labelClass.labelPlacement;var F=z[D],K=F||x(E);D&&!F&&u.warnOncePerTick(`the requested label placement '${D}' is currently unsupported in SceneView.`);
D=w(K,E)}if(null==D)return null;B=new q.LabelPlacement(B.verticalOffset,D.anchor,!!B.hasLabelVerticalOffset);F=E.graphics3DGraphic.graphic.geometry;if(null==F)E=null;else{switch(F.type){case "point":K=l(E);if(null!=K)switch(F=E.graphics3DGraphic.layers[0],null!=F?F.getCenterObjectSpace(B.translation):d.set(B.translation,0,0,0),K.type){case "icon":case "text":({graphics3DGraphic:K}=E);F=null!=F?F.getScreenSize():null;K.isDraped||null==F?B.hasLabelVerticalOffset||"center"===B.anchor||(z[E.labelClass.labelPlacement]&&
u.warnOncePerTick(`the requested placement '${D.placement}' is currently unsupported for draped graphics`),B.anchor="center"):(E=p(E),B.screenOffset[0]=F[0]/2*(D.normalizedOffset[0]-E[0]),E=F[1]/2*(D.normalizedOffset[1]-E[1]),B.hasLabelVerticalOffset?(B.centerOffset[1]=E,B.centerOffsetUnits="screen"):B.screenOffset[1]=E);break;case "object":h(B,D,F)}break;case "polygon":F=l(E);if(null!=F)switch(F.type){case "extrude":E=E.graphics3DGraphic.layers[0],null!=E?(E.getBoundingBoxObjectSpace(C),n.center(C,
B.translation),B.translation[2]=n.height(C)/2):d.set(B.translation,0,0,0),h(B,D,E)}break;case "mesh":h(B,D,E.graphics3DGraphic.layers[0])}E=k.labelMarginPx-e.textVerticalPaddingPx;B.screenOffset[0]+=E*D.normalizedOffset[0];B.screenOffset[1]+=E*D.normalizedOffset[1];E=B}return E};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/MaterialCollection":function(){define(["exports"],function(b){class a{constructor(c){this._stage=c;this._materials=new Map}get(c){return this._materials.get(c)}add(c,
d){this._materials.set(c,d);this._stage.add(d)}dispose(){this._stage.removeMany(Array.from(this._materials.values()));this._materials.clear()}}b.MaterialCollection=a;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTileTree3D":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Collection ../../../../core/handleUtils ../../../../core/Logger ../../../../core/maybe ../../../../core/PooledArray ../../../../core/reactiveUtils ../../../../core/uid ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/support/aaBoundingRect ./FeatureTileDescriptor3D ./FeatureTileMeasurements3D ../../support/extentUtils ../../../support/Scheduler".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u){b.FeatureTileTree3D=class extends c{get tilingScheme(){const z=this.tilingSchemeOwner.tilingScheme;return z?z.clone():null}set filterExtent(z){if(null==z||z.spatialReference.equals(this.viewState.spatialReference)){var A=this._get("filterExtent");A===z||null!=A&&z&&A.equals(z)||(z=null!=z?z.clone():null,this._set("filterExtent",z),this._setDirty())}else n.getLogger(this).error("#extent","extent spatial reference needs to be in the same spatial reference as the view")}get _filterExtentRect(){if(null==
this.filterExtent)return null;const z=p.create();r.toBoundingRect(this.filterExtent,z,this.tilingScheme.spatialReference);return z}get _rootTileIds(){const {tilingScheme:z}=this;return this._filterExtentRect&&z?z.rootTilesInExtent(this._filterExtentRect):[[0,0,0]]}set suspended(z){z!==this._get("suspended")&&(this._set("suspended",z),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}constructor(z){super(z);this.tiles=new d;this.tileSize=512;this._idToTile=new Map;this._clients=
new Set;this._dirty=!1;this._pendingTiles=null;this._newTiles=new g}initialize(){this.addHandles([q.watch(()=>[this.tilingScheme,this.tileSize],()=>this._reset(),q.sync),q.watch(()=>[this.tileSize,this.cameraOnSurface?.location,this.tilingScheme,this.viewState?.contentCamera,this.focus?.location],()=>this._setDirty(),q.syncAndInitial)]);this.scheduler&&(this._frameWorker=this.scheduler.registerTask(u.TaskPriority.FEATURE_TILE_TREE,this))}destroy(){this._frameWorker=k.removeMaybe(this._frameWorker)}addClient(){const z=
e.generateUID();this._clients.add(z);1===this._clients.size&&this._setDirty();return f.makeHandle(()=>this._removeClient(z))}_removeClient(z){this._clients.delete(z);this._hasClients||this._clear()}get _hasClients(){return 0<this._clients.size}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(u.noBudget))}_clear(){this.tiles.removeAll();this._idToTile.clear();this._reset();this._dirty=!1;this.notifyChange("updating")}get running(){return this.updating}runTask(z){this._dirty=
!1;this._pendingTiles||(this._startUpdate(),null!=this._frameWorker&&(this._frameWorker.priority=u.TaskPriority.FEATURE_TILE_TREE_ACTIVE));this._subdivideTilesForView(z);this._pendingTiles||null==this._frameWorker||(this._frameWorker.priority=u.TaskPriority.FEATURE_TILE_TREE);this.notifyChange("updating")}_startUpdate(){this.suspended||(this.tilingScheme?(this._tileMeasurements||(this._tileMeasurements=new t.FeatureTileMeasurements3D({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,
tileSize:this.tileSize})),this._tileMeasurements.begin(this.viewState.contentCamera,this.focus.location,this.cameraOnSurface.location.z??0),this._pendingTiles=this._getRootTiles()):this._clear())}_reset(){this._newTiles.clear();this._pendingTiles=this._tileMeasurements=null;this._setDirty()}_getRootTiles(){const {tilingScheme:z}=this;return this._rootTileIds.map(A=>new h.FeatureTileDescriptor3D(A[0],A[1],A[2],z))}_purgeHorizonTiles(z){z.sort((A,C)=>{A=A.measures.screenRect;C=C.measures.screenRect;
return A[1]+A[3]-(C[1]+C[3])});p.empty(y);for(let A=0;A<z.length;A++)if(p.expand(y,z.data[A].measures.screenRect,y),10<p.height(y))return z.data.slice(A,z.length);return[]}_subdivideTilesForView(z){if(this._pendingTiles){for(var {tilingScheme:A}=this;0<this._pendingTiles.length&&!z.done;){const C=this._pendingTiles.pop();z.madeProgress();if(!this._filterExtentRect||p.intersects(this._filterExtentRect,C.extent))this._tileMeasurements.updateTile(C),C.measures.visibility!==h.Visibility.INVISIBLE&&(C.measures.shouldSplit?
(A.ensureMaxLod(C.lij[0]+1),this._pendingTiles.push(...C.getChildren())):this._newTiles.push(C))}0===this._pendingTiles.length&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}}_updateTiles(z){for(var A of this.tiles.items)A.used=!1;z=z.filter(C=>{const E=this._idToTile.get(C.id);E?(E.copyMeasurementsFrom(C),E.used=!0):this._idToTile.set(C.id,C);return!E});A=this.tiles.items.filter(C=>C.used?!1:(this._idToTile.delete(C.id),
!0));this.tiles.removeMany(A);this.tiles.addMany(z);this._sortTiles()}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort((z,A)=>z.measures.visibility!==A.measures.visibility?z.measures.visibility===h.Visibility.VISIBLE_ON_SURFACE?-1:1:z.measures.distance-A.measures.distance);this.tiles.forEach((z,A)=>z.loadPriority=A)}};a.__decorate([m.property({constructOnly:!0})],b.FeatureTileTree3D.prototype,"scheduler",void 0);a.__decorate([m.property({constructOnly:!0})],b.FeatureTileTree3D.prototype,
"renderCoordsHelper",void 0);a.__decorate([m.property({constructOnly:!0})],b.FeatureTileTree3D.prototype,"tilingSchemeOwner",void 0);a.__decorate([m.property({constructOnly:!0})],b.FeatureTileTree3D.prototype,"cameraOnSurface",void 0);a.__decorate([m.property({constructOnly:!0})],b.FeatureTileTree3D.prototype,"focus",void 0);a.__decorate([m.property({constructOnly:!0})],b.FeatureTileTree3D.prototype,"viewState",void 0);a.__decorate([m.property({constructOnly:!0})],b.FeatureTileTree3D.prototype,"terrain",
void 0);a.__decorate([m.property()],b.FeatureTileTree3D.prototype,"tiles",void 0);a.__decorate([m.property()],b.FeatureTileTree3D.prototype,"tileSize",void 0);a.__decorate([m.property({readOnly:!0})],b.FeatureTileTree3D.prototype,"tilingScheme",null);a.__decorate([m.property()],b.FeatureTileTree3D.prototype,"filterExtent",null);a.__decorate([m.property({readOnly:!0})],b.FeatureTileTree3D.prototype,"_filterExtentRect",null);a.__decorate([m.property({readOnly:!0})],b.FeatureTileTree3D.prototype,"_rootTileIds",
null);a.__decorate([m.property({value:!1})],b.FeatureTileTree3D.prototype,"suspended",null);a.__decorate([m.property({readOnly:!0})],b.FeatureTileTree3D.prototype,"updating",null);b.FeatureTileTree3D=a.__decorate([x.subclass("esri.views.3d.layers.support.FeatureTileTree3D")],b.FeatureTileTree3D);const y=p.create();Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTileDescriptor3D":function(){define(["exports","../../../../geometry/support/aaBoundingRect"],
function(b,a){class c{constructor(d,f,n,k=null){this.lij=[0,0,0];this.extent=a.create();this.loadPriority=this.resolution=0;this.measures={visibility:b.Visibility.VISIBLE_ON_SURFACE,screenRect:a.create(),distance:0,shouldSplit:!1};this.used=!1;k&&this.acquire(d,f,n,k)}acquire(d,f,n,k){this.tilingScheme=k;this.id=c.id(d,f,n);this.lij[0]=d;this.lij[1]=f;this.lij[2]=n;k.getExtent(d,f,n,this.extent);this.resolution=k.resolutionAtLevel(d)}release(){this.tilingScheme=null}getChildren(d){const f=this.lij[0]+
1,n=2*this.lij[1],k=2*this.lij[2];if(!d)return[new c(f,n,k,this.tilingScheme),new c(f,n+1,k,this.tilingScheme),new c(f,n,k+1,this.tilingScheme),new c(f,n+1,k+1,this.tilingScheme)];d[0].acquire(f,n,k,this.tilingScheme);d[1].acquire(f,n+1,k,this.tilingScheme);d[2].acquire(f,n,k+1,this.tilingScheme);d[3].acquire(f,n+1,k+1,this.tilingScheme);return d}copyMeasurementsFrom(d){this.measures.visibility=d.measures.visibility;this.measures.shouldSplit=d.measures.shouldSplit;this.measures.distance=d.measures.distance;
a.copy(d.measures.screenRect,this.measures.screenRect)}static id(d,f,n){return`${d}/${f}/${n}`}}b.Visibility=void 0;(function(d){d[d.INVISIBLE=0]="INVISIBLE";d[d.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED";d[d.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"})(b.Visibility||(b.Visibility={}));b.FeatureTileDescriptor3D=c;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTileMeasurements3D":function(){define("exports ../../../../core/screenUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/frustum ../../../../geometry/support/plane ../../../../geometry/support/triangle ./FeatureTileDescriptor3D ./FeatureTileVisibility3D ../../webgl-engine/lib/Camera".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m){class l{constructor(u){this._camera=new m.Camera;this._focusOnMap=[0,0];this._screenRect=f.create();this._tileSize=u.tileSize;this._renderCoordsHelper=u.renderCoordsHelper;this._tilingScheme=u.tilingScheme;this._visibility=new e.FeatureTileVisibility3D(u.renderCoordsHelper)}begin(u,y,z){this._camera.copyFrom(u);this._surfaceElevation=z;this._focusOnMap[0]=y.x;this._focusOnMap[1]=y.y;f.fromValues(0,0,u.fullWidth,u.fullHeight,this._screenRect);this._visibility.begin(this._camera,
z)}end(){this._visibility.end()}updateTile(u){u.measures.visibility=this._visibility.calculate(u);u.measures.distance=f.distance(u.extent,this._focusOnMap);u.measures.visibility!==q.Visibility.INVISIBLE&&this._updateScreenMeasure(u)}_updateScreenMeasure(u){const y=u.measures.screenRect;f.empty(y);let z=0;const A=u.lij[0]+2,C=u.lij[1]<<2,E=u.lij[2]<<2;var B=this._tileSizeWithBias(u);B*=B;for(let D=0;4>D;D++)for(let F=0;4>F;F++)if(z+=this._computeScreenArea(u,A,C+D,E+F,y),z>B){u.measures.shouldSplit=
!0;return}u.measures.shouldSplit=!1}_tileSizeWithBias(u){return u.measures.visibility===q.Visibility.VISIBLE_WHEN_EXTENDED?5*this._tileSize:this._tileSize}_computeScreenArea(u,y,z,A,C){this._projectToScreen(y,z,A,u.measures.visibility===q.Visibility.VISIBLE_WHEN_EXTENDED,v);f.empty(w);for(u=0;4>u;u++)f.expandPointInPlace(w,v[u]);f.expand(C,w,C);return g.areaPoints2d(v[0],v[1],v[2])+g.areaPoints2d(v[0],v[2],v[3])}_projectToScreen(u,y,z,A,C){this._tilingScheme.ensureMaxLod(u);this._tilingScheme.getExtent(u,
y,z,x);this._toRenderCoords(x,0,3,h[0]);this._toRenderCoords(x,2,3,h[1]);this._toRenderCoords(x,2,1,h[2]);this._toRenderCoords(x,0,1,h[3]);A&&(this._projectToPlane(h,this._camera.frustum[n.PlaneIndex.NEAR]),this._projectToPlane(h,this._camera.frustum[n.PlaneIndex.TOP]),this._projectToPlane(h,this._camera.frustum[n.PlaneIndex.BOTTOM]));for(u=0;4>u;u++)this._camera.projectToRenderScreen(h[u],r),this._camera.renderToScreen(r,C[u])}_projectToPlane(u,y){for(var z=0;4>z;z++)t[z]=k.signedDistance(y,u[z]);
z=Math.max(t[0],t[1],t[2],t[3]);if(0<z)for(y=c.scale(p,k.normal(y),-z),z=0;4>z;z++)c.add(u[z],u[z],y)}_toRenderCoords(u,y,z,A){p[0]=u[y];p[1]=u[z];p[2]=this._surfaceElevation;this._renderCoordsHelper.toRenderCoords(p,this._tilingScheme.spatialReference,A);return A}}const w=f.create(),v=[a.createScreenPointArray(),a.createScreenPointArray(),a.createScreenPointArray(),a.createScreenPointArray()],x=f.create(),p=d.create(),h=[d.create(),d.create(),d.create(),d.create()],t=[0,0,0,0],r=a.createRenderScreenPointArray3();
b.FeatureTileMeasurements3D=l;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTileVisibility3D":function(){define("exports ../../../../core/mathUtils ../../../../core/ObjectPool ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/ellipsoidUtils ../../../../geometry/support/frustum ../../../../geometry/support/plane ../../../../geometry/support/ray ../../../ViewingMode ./FeatureTileDescriptor3D ../../state/Frustum ../../support/FrustumExtentIntersection".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w){class v{constructor(r){this._renderCoordsHelper=r;this._surfaceElevation=0;this._cache=new Map;this._frustum=new l.Frustum(r);this._extendedFrustum=new l.Frustum(r);this._intersector=new w.FrustumExtentIntersection({renderCoordsHelper:r});this._renderCoordsHelper=r}begin(r,u){this._surfaceElevation=u;this._aboveGround=this._renderCoordsHelper.getAltitude(r.eye)>u;this._frustum.update(r);this._shortenFrustumFarPlane(this._frustum);this._updateExtendedFrustum(r)}end(){this._cache.clear()}calculate(r){if(this._allTilesInvisible)return m.Visibility.INVISIBLE;
const u=this._renderCoordsHelper.viewingMode===e.ViewingMode.Global&&2<=r.lij[0]&&6>r.lij[0],y=this._getOrCalculateSingleTileVisibility(r,!u);return y!==m.Visibility.INVISIBLE&&u?this._calculateAggregatedChildrenVisibility(r):y}_shortenFrustumFarPlane(r){var u=l.Frustum.nearFarLineIndices;const y=r.mutablePoints;for(const z of u){const [A,C]=z;u=y[A];d.subtract(x,y[C],u);d.scale(x,x,.95);d.add(y[C],u,x)}r.updatePoints(y)}_calculateAggregatedChildrenVisibility(r){let u=m.Visibility.INVISIBLE;var y=
this._cache.get(r.id);if(null!=y)return y;y=t.acquire();r.getChildren(y);for(const z of y){const A=this.calculate(z);if(A!==m.Visibility.INVISIBLE&&(u=A,A===m.Visibility.VISIBLE_ON_SURFACE))break}t.release(y);this._cache.set(r.id,u);return u}_getOrCalculateSingleTileVisibility(r,u){var y=this._cache.get(r.id);if(null!=y)return y;y=this._calculateSingleTileVisibility(r);u&&this._cache.set(r.id,y);return y}_calculateSingleTileVisibility(r){if(!this._aboveGround&&this._renderCoordsHelper.viewingMode===
e.ViewingMode.Global&&12>r.lij[0]){if(this._calculateSingleTileVisibilitySided(r,!1)===m.Visibility.INVISIBLE)return this._calculateSingleTileVisibilitySided(r,!0)}else return this._calculateSingleTileVisibilitySided(r,this._aboveGround)}_calculateSingleTileVisibilitySided(r,u){this._intersector.update(r.extent,r.tilingScheme.spatialReference,this._surfaceElevation,u);r=n.getReferenceEllipsoid(r.tilingScheme.spatialReference).radius;return this._intersector.isVisibleInFrustum(this._extendedFrustum,
r)?this._intersector.isVisibleInFrustum(this._frustum,r,!0)?m.Visibility.VISIBLE_ON_SURFACE:m.Visibility.VISIBLE_WHEN_EXTENDED:m.Visibility.INVISIBLE}_updateExtendedFrustum(r){this._extendedFrustum.update(r);this._shortenFrustumFarPlane(this._extendedFrustum);var u=this._renderCoordsHelper.worldUpAtPosition(r.eye,x);this._aboveGround||d.negate(u,u);u=a.acosClamped(-d.dot(u,r.viewForward));this._allTilesInvisible=u>(Math.PI+r.fovY)/2;if(!this._allTilesInvisible&&(this._hasExtendedFrustum=u>r.fovY/
2)){r=this._extendedFrustumParameters();u=this._extendedFrustum.mutablePoints;for(let y=0;4>y;y++){const z=r.pointIndices[y],A=u[z],C=this._renderCoordsHelper.getAltitude(A);if(r.needsAltitudeAdjustment(C)){this._renderCoordsHelper.worldUpAtPosition(A,x);switch(z){case k.PointIndex.FAR_BOTTOM_LEFT:case k.PointIndex.FAR_TOP_LEFT:case k.PointIndex.NEAR_BOTTOM_LEFT:case k.PointIndex.NEAR_TOP_LEFT:g.projectVector(this._extendedFrustum.planes[k.PlaneIndex.LEFT],x,x);break;case k.PointIndex.FAR_BOTTOM_RIGHT:case k.PointIndex.FAR_TOP_RIGHT:case k.PointIndex.NEAR_BOTTOM_RIGHT:case k.PointIndex.NEAR_TOP_RIGHT:g.projectVector(this._extendedFrustum.planes[k.PlaneIndex.RIGHT],
x,x)}d.scale(x,x,r.direction);this._renderCoordsHelper.intersectInfiniteManifold(q.wrap(A,x),r.zWithMargin,A)}}this._extendedFrustum.updatePoints(u);g.fromPoints(u[k.PointIndex.NEAR_BOTTOM_LEFT],u[k.PointIndex.NEAR_BOTTOM_RIGHT],u[k.PointIndex.NEAR_TOP_RIGHT],p);g.fromPoints(u[k.PointIndex.NEAR_BOTTOM_RIGHT],u[k.PointIndex.NEAR_TOP_RIGHT],u[k.PointIndex.NEAR_TOP_LEFT],h);0>d.dot(g.normal(p),g.normal(h))&&(r=this._extendedFrustum.mutablePoints,this._aboveGround?[r[k.PointIndex.NEAR_BOTTOM_LEFT],r[k.PointIndex.NEAR_BOTTOM_RIGHT]]=
[r[k.PointIndex.NEAR_BOTTOM_RIGHT],r[k.PointIndex.NEAR_BOTTOM_LEFT]]:[r[k.PointIndex.NEAR_TOP_LEFT],r[k.PointIndex.NEAR_TOP_RIGHT]]=[r[k.PointIndex.NEAR_TOP_RIGHT],r[k.PointIndex.NEAR_TOP_LEFT]],this._extendedFrustum.updatePoints(r))}}_extendedFrustumParameters(){return this._aboveGround?this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()}_extendedFrustumParametersAboveSurface(){const r=this._surfaceElevation-1;return{zWithMargin:r,pointIndices:l.Frustum.planePointIndices.bottom,
direction:-1,needsAltitudeAdjustment(u){return u>r}}}_extendedFrustumParametersBelowSurface(){const r=this._surfaceElevation+1;return{zWithMargin:r,pointIndices:l.Frustum.planePointIndices.top,direction:1,needsAltitudeAdjustment(u){return u<r}}}}const x=f.create(),p=g.create(),h=g.create(),t=new c(Array,r=>{4!==r.length&&(r[0]=new m.FeatureTileDescriptor3D,r[1]=new m.FeatureTileDescriptor3D,r[2]=new m.FeatureTileDescriptor3D,r[3]=new m.FeatureTileDescriptor3D)},r=>{r[0].release();r[1].release();r[2].release();
r[3].release()});b.FeatureTileVisibility3D=v;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/FrustumExtentIntersection":function(){define("exports ../../../core/compilerUtils ../../../core/mathUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/ellipsoidUtils ../../../geometry/projection/computeTranslationToOriginAndRotation ../../../geometry/projection/projectBoundingRect ../../../geometry/projection/projectVectorToVector ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/frustum ../../../geometry/support/lineSegment ../../../geometry/support/plane ../../../geometry/support/ray ../../ViewingMode ./intersectionUtils".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r){const u=.5*Math.PI,y=u/Math.PI*180;class z{constructor(L){this._renderCoordsHelper=L.renderCoordsHelper;this._extent=Array(4);this._planes=Array(6);this._maxSpan=0;this._center={origin:k.create(),direction:k.create()};for(L=0;4>L;L++)this._extent[L]={origin:k.create(),direction:k.create(),cap:{next:null,direction:k.create()}},this._planes[L]=p.create();this._planes[v.PlaneIndex.NEAR]=p.create();this._planes[v.PlaneIndex.FAR]=p.create();this._planesWithoutFar=
this._planes.slice(0,5)}update(L,G,O,P=!0){const J=this._extent;this._toRenderBoundingExtent(L,G,O);n.add(this._center.origin,J[0].origin,J[2].origin);n.scale(this._center.origin,this._center.origin,.5);this._renderCoordsHelper.worldUpAtPosition(this._center.origin,this._center.direction);P||n.scale(this._center.direction,this._center.direction,-1);for(O=0;4>O;O++){const R=J[O];this._renderCoordsHelper.worldUpAtPosition(R.origin,R.direction);const X=J[3===O?0:O+1];R.cap.next=X.origin;n.direction(R.cap.direction,
R.origin,X.origin);p.fromVectorsAndPoint(R.direction,R.cap.direction,R.origin,this._planes[O]);P||n.scale(R.direction,R.direction,-1)}p.fromVectorsAndPoint(J[0].cap.direction,J[1].cap.direction,J[0].origin,this._planes[v.PlaneIndex.NEAR]);P?p.negate(this._planes[v.PlaneIndex.NEAR],this._planes[v.PlaneIndex.FAR]):(p.copy(this._planes[v.PlaneIndex.FAR],this._planes[v.PlaneIndex.NEAR]),p.negate(this._planes[v.PlaneIndex.NEAR],this._planes[v.PlaneIndex.NEAR]));this._maxSpan=Math.max(Math.abs(L[0]-L[2]),
Math.abs(L[1]-L[3]));this._maxSpanSpatialReference=G;this._minGlobalAltitude=.9*g.getReferenceEllipsoid(this._maxSpanSpatialReference).radius}isVisibleInFrustum(L,G,O=!1){if(null==L)return!1;if(this._renderCoordsHelper.viewingMode===t.ViewingMode.Global){if(this._maxSpan>(this._maxSpanSpatialReference.isGeographic?y:u*G))return!0;if(null!=L.altitude&&L.altitude>=this._minGlobalAltitude)return this._isVisibleInFrustumGlobal(L)}if(0===this._maxSpan)return G=this._extent[0],!O&&L.intersectsRay(h.wrap(G.origin,
G.direction))?!0:!1;for(G=0;G<this._extent.length;G++){var P=this._extent[G];if(!O&&L.intersectsRay(h.wrap(P.origin,P.direction))||L.intersectsLineSegment(x.fromPoints(P.origin,P.cap.next,K),P.cap.direction))return!0}O=O?this._planes:this._planesWithoutFar;for(G=0;G<L.lines.length;G++)if(P=L.lines[G],r.frustumLineSegment(O,P.origin,P.endpoint,P.direction))return!0;return!1}_toRenderBoundingExtentGlobal(L,G,O){w.center(L,C);C[2]=O;q.computeTranslationToOriginAndRotation(G,C,E,this._renderCoordsHelper.spatialReference);
d.invert(B,E);l.empty(D);for(const {x0:P,x1:J,y0:R,y1:X}of A)for(let U=0;5>U;U++){const M=U/4;C[0]=c.lerp(L[P],L[J],M);C[1]=c.lerp(L[R],L[X],M);C[2]=O;m.projectVectorToVector(C,G,C,this._renderCoordsHelper.spatialReference);n.transformMat4(C,C,B);l.expandWithVec3(D,C)}n.set(this._extent[0].origin,D[0],D[1],D[2]);n.set(this._extent[1].origin,D[3],D[1],D[2]);n.set(this._extent[2].origin,D[3],D[4],D[2]);n.set(this._extent[3].origin,D[0],D[4],D[2]);for(L=0;4>L;++L)n.transformMat4(this._extent[L].origin,
this._extent[L].origin,E)}_toRenderBoundingExtentLocal(L,G,O){e.projectBoundingRect(L,G,F,this._renderCoordsHelper.spatialReference);n.set(this._extent[0].origin,F[0],F[1],O);n.set(this._extent[1].origin,F[2],F[1],O);n.set(this._extent[2].origin,F[2],F[3],O);n.set(this._extent[3].origin,F[0],F[3],O)}_toRenderBoundingExtent(L,G,O){switch(this._renderCoordsHelper.viewingMode){case t.ViewingMode.Global:this._toRenderBoundingExtentGlobal(L,G,O);break;case t.ViewingMode.Local:this._toRenderBoundingExtentLocal(L,
G,O);break;default:a.neverReached(this._renderCoordsHelper.viewingMode)}}_isVisibleInFrustumGlobal(L){if(0>p.signedDistance(L.planes[v.PlaneIndex.NEAR],this._center.origin)&&0>n.dot(this._center.direction,L.direction))return!0;for(let G=0;4>G;G++){const O=this._extent[G];if(0>p.signedDistance(L.planes[v.PlaneIndex.NEAR],O.origin)&&0>n.dot(O.direction,L.direction))return!0}return!1}}const A=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],C=k.create(),E=f.create(),
B=f.create(),D=l.create(),F=w.create(),K=x.create();b.FrustumExtentIntersection=z;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/extentUtils":function(){define(["exports","../../../chunks/vec3f64","../../../geometry/projection/projectBuffer"],function(b,a,c){const d=a.create();b.projectToBoundingBox=function(f,n,k){if(null==f||null==k)return!1;let g;d[0]=null!=f.xmin?f.xmin:0;d[1]=null!=f.ymin?f.ymin:0;d[2]=null!=f.zmin?f.zmin:0;g=c.projectBuffer(d,f.spatialReference,
0,n,k,0,1);d[0]=null!=f.xmax?f.xmax:0;d[1]=null!=f.ymax?f.ymax:0;d[2]=null!=f.zmax?f.zmax:0;g=g&&c.projectBuffer(d,f.spatialReference,0,n,k,3,1);null==f.xmin&&(n[0]=-Infinity);null==f.ymin&&(n[1]=-Infinity);null==f.zmin&&(n[2]=-Infinity);null==f.xmax&&(n[3]=Infinity);null==f.ymax&&(n[4]=Infinity);null==f.zmax&&(n[5]=Infinity);return g};b.toBoundingRect=function(f,n,k){if(null==f||null==k)return!1;let g;d[0]=null!=f.xmin?f.xmin:0;d[1]=null!=f.ymin?f.ymin:0;d[2]=null!=f.zmin?f.zmin:0;g=c.projectBuffer(d,
f.spatialReference,0,d,k,0,1);n[0]=d[0];n[1]=d[1];d[0]=null!=f.xmax?f.xmax:0;d[1]=null!=f.ymax?f.ymax:0;d[2]=null!=f.zmax?f.zmax:0;g=g&&c.projectBuffer(d,f.spatialReference,0,d,k,0,1);n[2]=d[0];n[3]=d[1];null==f.xmin&&(n[0]=-Infinity);null==f.ymin&&(n[1]=-Infinity);null==f.xmax&&(n[2]=Infinity);null==f.ymax&&(n[3]=Infinity);return g};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/ViewState":function(){define("../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Evented ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/watch ../../../chunks/vec3f64 ../../../geometry/ellipsoidUtils ../../ViewAnimation ../../ViewingMode ./Constraints ./controllers/AnimationController ./controllers/CameraController ../support/PropertiesPool ../webgl-engine/lib/Camera ../../support/RenderState".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u){a=class extends a{constructor(){super(...arguments);this._propertiesPool=new t.PropertiesPool({camera:r.Camera},this);this._lastSeenCameraProjectionValues=new r.Camera;this.mode=u.RenderState.ANIMATING;this._cssCamera=new r.Camera;this._camera=new r.Camera;this.contentPixelRatio=this.rasterPixelRatio=1;this.events=new c;this.viewingMode=v.ViewingMode.Global;this._cameraChanged=!1;this._updateQueue=[];this._processingUpdates=!1}init(z,A){this._set("viewingMode",
z);this._set("spatialReference",A);this._set("constraints",new x.Constraints({mode:this.viewingMode}))}exit(){this.cameraController=null;this._propertiesPool.destroy();this._propertiesPool=new t.PropertiesPool({camera:r.Camera},this)}destroy(){this.cameraController=null;this._propertiesPool?.destroy();this._propertiesPool=null}createInitialCamera(){if(this.viewingMode===v.ViewingMode.Global){const z=l.getReferenceEllipsoid(this.spatialReference).radius;this.camera=new r.Camera({eye:m.fromValues(4*
z,0,0),center:m.fromValues(z,0,0),up:m.fromValues(0,0,1)})}else this.camera=new r.Camera({eye:m.fromValues(0,0,100),center:m.fromValues(0,0,0),up:m.fromValues(0,1,0)})}get animation(){return this.cameraController instanceof p.AnimationController&&null!=this.cameraController.viewAnimation?this.cameraController.viewAnimation:null}get camera(){return this._camera}get cssCamera(){const z=this._cssCamera.copyFrom(this.camera),{height:A,width:C,pixelRatio:E}=this.camera;z.pixelRatio=1;z.height=Math.round(A/
E);z.width=Math.round(C/E);return z}set camera(z){z!==y&&y.copyFrom(z);y.computeUp(this.viewingMode);this.events.emit("before-camera-change",y);z=this._camera;this._cameraProjectionChanged(this._lastSeenCameraProjectionValues,y)&&(this._lastSeenCameraProjectionValues.copyFrom(y),this.events.emit("camera-projection-changed",this._lastSeenCameraProjectionValues));if(!z.equals(y)&&(this._camera=this._propertiesPool.get("camera").copyFrom(y),this._cameraChanged=!z.almostEquals(y))){const A=e.afterDispatch(()=>
{this._cameraChanged=!1;A.remove()})}}get pixelRatio(){return this.camera.pixelRatio}get alignPixelEnabled(){return this.pixelRatio===this.rasterPixelRatio&&this.mode===u.RenderState.IDLE}get updating(){return this.mode!==u.RenderState.IDLE}get contentCamera(){return this._contentCamera??this.camera}set contentCamera(z){this._contentCamera=null!=z?z.clone():null}get fixedContentCamera(){return null!=this._contentCamera}get isGlobal(){return this.viewingMode===v.ViewingMode.Global}get isLocal(){return this.viewingMode===
v.ViewingMode.Local}get navigating(){return!(!this.cameraController||!this.cameraController.isInteractive)}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(z){this.stopActiveCameraController()?(this.cameraController?.destroy(),z&&(this.removeHandles("ViewStateHandles"),this.addHandles(d.when(()=>z.state===h.State.Finished||z.state===h.State.Stopped,()=>{this._set("cameraController",null);this.updateCamera(A=>
z.onControllerEnd(A))},{sync:!0,once:!0}),"ViewStateHandles"),z.onControllerStart(this.camera)),this._set("cameraController",z)):z&&(z.state=h.State.Rejected)}switchCameraController(z){this.cameraController=z;return z.state!==h.State.Rejected}stopActiveCameraController(){return this.cameraController&&!this.cameraController.stopController()?!1:!0}updateCamera(z){this._updateQueue.push(z);this._processUpdateQueue()}_processUpdateQueue(){if(0!==this._updateQueue.length&&!this._processingUpdates){this._processingUpdates=
!0;var z=this._updateQueue.shift();y.copyFrom(this._get("camera"));z(y);this.camera=y;this._processingUpdates=!1;this._processUpdateQueue()}}_cameraProjectionChanged(z,A){return z.fov!==A.fov||z.fullViewport[0]!==A.fullViewport[0]||z.fullViewport[1]!==A.fullViewport[1]||z.fullViewport[2]!==A.fullViewport[2]||z.fullViewport[3]!==A.fullViewport[3]||z.padding[r.PaddingSide.TOP]!==A.padding[r.PaddingSide.TOP]||z.padding[r.PaddingSide.RIGHT]!==A.padding[r.PaddingSide.RIGHT]||z.padding[r.PaddingSide.BOTTOM]!==
A.padding[r.PaddingSide.BOTTOM]||z.padding[r.PaddingSide.LEFT]!==A.padding[r.PaddingSide.LEFT]?!0:!1}};b.__decorate([f.property()],a.prototype,"mode",void 0);b.__decorate([f.property({readOnly:!0,type:w})],a.prototype,"animation",null);b.__decorate([f.property({type:r.Camera})],a.prototype,"camera",null);b.__decorate([f.property({type:r.Camera})],a.prototype,"cssCamera",null);b.__decorate([f.property()],a.prototype,"_cssCamera",void 0);b.__decorate([f.property()],a.prototype,"_camera",void 0);b.__decorate([f.property({readOnly:!0})],
a.prototype,"pixelRatio",null);b.__decorate([f.property()],a.prototype,"rasterPixelRatio",void 0);b.__decorate([f.property()],a.prototype,"contentPixelRatio",void 0);b.__decorate([f.property({readOnly:!0})],a.prototype,"alignPixelEnabled",null);b.__decorate([f.property({readOnly:!0})],a.prototype,"updating",null);b.__decorate([f.property({})],a.prototype,"_contentCamera",void 0);b.__decorate([f.property({type:r.Camera})],a.prototype,"contentCamera",null);b.__decorate([f.property({readOnly:!0})],a.prototype,
"fixedContentCamera",null);b.__decorate([f.property({readOnly:!0})],a.prototype,"constraints",void 0);b.__decorate([f.property({readOnly:!0})],a.prototype,"events",void 0);b.__decorate([f.property({readOnly:!0})],a.prototype,"isGlobal",null);b.__decorate([f.property({readOnly:!0})],a.prototype,"isLocal",null);b.__decorate([f.property({readOnly:!0})],a.prototype,"viewingMode",void 0);b.__decorate([f.property({readOnly:!0})],a.prototype,"spatialReference",void 0);b.__decorate([f.property()],a.prototype,
"navigating",null);b.__decorate([f.property()],a.prototype,"stationary",null);b.__decorate([f.property()],a.prototype,"_cameraChanged",void 0);b.__decorate([f.property()],a.prototype,"cameraController",null);b=a=b.__decorate([q.subclass("esri.views.3d.state.ViewState")],a);const y=new r.Camera;return b})},"esri/views/3d/state/helpers/SceneIntersectionHelper":function(){define("exports ../../../../core/PooledArray ../../../../core/screenUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/ray ../../../../geometry/support/vectorStacks ../../../ViewingMode ../../support/geometryUtils/ray ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces ../../webgl-engine/lib/intersectorUtils".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w){function v(z){t&&t.viewingMode===z||(t=m.newIntersector(z));return t}class x{constructor(z,A,C){this.viewingMode=z;this._forEachLayer=A;this._view=C;this._externalIntersectionHandlers=new a;this._tolerance=m.defaultTolerance;this._tmpRay=k.create();this._tmpRegion=n.create();this._validateHUDIntersector=m.newIntersector(this.viewingMode);this._validateHUDIntersector.options.hud=!1}intersectScreen(z,A,C){return this.intersectRay(this._getPickRay(z,this._tmpRay),
v(this.viewingMode),A,C)}intersectScreenFreePointFallback(z,A,C){return this.intersectRayFreePointFallback(this._getPickRay(z,this._tmpRay),A,C)}intersectRayFreePointFallback(z,A,C){return this.intersectRay(z,v(this.viewingMode),A,C)||this._intersectRayFreePointLocal(z,A)}intersectRay(z,A,C,E){A.options.selectionMode=!1;A.options.store=l.StoreResults.MIN;this.computeIntersection(z,A,E);return A.results.min?A.results.min.getIntersectionPoint(C):!1}getCenterRayWithSubpixelOffset(z,A,C=.5,E=.5){z.getRenderCenter(y,
C,E);y[0]+=.0466;y[1]-=.0123;return e.fromRenderAtEye(z,y,A)}intersectIntersectorScreen(z,A,C){this.computeIntersection(this._getPickRay(z,this._tmpRay),A,C)}intersectToolIntersectorScreen(z,A,C){z=this._getPickRay(z,this._tmpRay);this.intersectToolIntersectorRay(z,A,C)}intersectToolIntersectorRay(z,A,C){A.options.selectionMode=!0;this.computeIntersection(z,A,C);const E=A.results.min;this._view.basemapTerrain&&this._view.basemapTerrain.opaque||w.isValidIntersectorResult(E)&&E.intersector!==l.IntersectorType.TERRAIN||
(A.options.selectionMode=!1,this.computeIntersection(z,A,C))}setTolerance(z=m.defaultTolerance){this._tolerance=z}addIntersectionHandler(z){this._externalIntersectionHandlers.push(z);this._externalIntersectionHandlers.sort((A,C)=>A.type===l.IntersectorType.TERRAIN?1:C.type===l.IntersectorType.TERRAIN?-1:0)}removeIntersectionHandler(z){null!=this._externalIntersectionHandlers.removeUnordered(z)&&this._externalIntersectionHandlers.sort((A,C)=>A.type===l.IntersectorType.TERRAIN?1:C.type===l.IntersectorType.TERRAIN?
-1:0)}_getPickRay(z,A){return e.fromScreen(this._view.state.camera,z,A)}_intersectRayFreePointLocal(z,A){if(this.viewingMode!==q.ViewingMode.Local||null==z)return!1;d.add(A,z.origin,d.normalize(g.sv3d.get(),z.direction));return!1}intersectElevationFromScreen(z,A,C=0,E=null){return this._intersectElevation(this._getPickRay(z,this._tmpRay),A,C,E)}_intersectElevation(z,A,C=0,E=null){if(null==z)return null;var B=null!=A?A.mode:"absolute-height",D=A?.offset??0,F="on-the-ground"!==B?D+C:0;A=F/this._view.renderCoordsHelper.unitInMeters;
if("absolute-height"===B)return this._view.renderCoordsHelper.intersectInfiniteManifold(z,F,u)?(C=this._view.computeMapPointFromVec3d(u),C.z??(C.z=0),C.z-=D,C):null;D=this._view.state.camera;const K=c.castRenderScreenPointArray3(g.sv3d.get());D.projectToRenderScreen(z.origin,K);F=new r(null,this._forEachLayer);const L=this._view.slicePlane,G=null!=L?w.sliceFilterPredicate(L):null,O=m.newIntersector(this.viewingMode);O.options.store=l.StoreResults.MIN;O.options.verticalOffset=A;A=z.origin;z=d.add(g.sv3d.get(),
A,z.direction);O.reset(A,z,D);O.point=K;const P=E?"type"in E&&"graphics"===E.type?J=>J.layerUid!==E.uid:J=>J.graphicUid!==E.uid:null;switch(B){case "relative-to-scene":O.intersect(F.layers,K,this._tolerance,null,J=>(!P||P(J))&&!!J.lastValidElevationBB);this._externalIntersectionHandlers.forAll(J=>{J.type!==l.IntersectorType.I3S&&J.type!==l.IntersectorType.TERRAIN||J.intersect(O,J.slicePlaneEnabled?G:null,O.rayBegin,O.rayEnd,K)});break;case "on-the-ground":case "relative-to-ground":this._externalIntersectionHandlers.forAll(J=>
{J.isGround&&J.intersect(O,J.slicePlaneEnabled?G:null,O.rayBegin,O.rayEnd,K)})}return O.results.min.getIntersectionPoint(u)?(B=this._view.computeMapPointFromVec3d(u),B.z=C,B):null}computeIntersection(z,A,C){if(null!=z){var E=this._view.state.camera,B=c.castRenderScreenPointArray3(g.sv3d.get());E.projectToRenderScreen(z.origin,B);var D=new r(C,this._forEachLayer);A.options.selectOpaqueTerrainOnly=!C||!("include"in C||"exclude"in C);var F=z.origin,K=d.add(g.sv3d.get(),z.origin,z.direction);A.reset(F,
K,E);A.intersect(D.layers,B,this._tolerance);z=this._view.slicePlane;var L=null!=z?w.sliceFilterPredicate(z):null;A.intersect(D.sliceableLayers,B,this._tolerance,L);var G=C&&(C.requiresGroundFeedback||C.enableDraped);this._externalIntersectionHandlers.forAll(O=>{var P=O.layerUid;const J=Array.isArray(P);P=J?P:[P];J&&(A.options.filteredLayerUids=[]);let R=!1;for(const X of P)D.filterLayerUid(X)?R=!0:J&&A.options.filteredLayerUids.push(X);A.options.isFiltered=!R;(O.isGround&&G||!A.options.isFiltered)&&
O.intersect(A,O.slicePlaneEnabled?L:null,F,K,B)});z=g.sv3d.get();E=this._view.basemapTerrain;if(C&&C.enableDraped&&null!=E.spatialReference&&A.results.ground.getIntersectionPoint(z)){C=E.overlayManager.renderer;const O=this._view.renderCoordsHelper.spatialReference,P=g.sv3d.get();this._view.renderCoordsHelper.fromRenderCoords(z,P,E.spatialReference);P[2]=this._view.elevationProvider?.getElevation(z[0],z[1],z[2],O,"ground")??0;C.intersect(A,P,A.results.ground,J=>D.filterRenderGeometry(J))}A.sortResults();
this._processHUDResults(A)}}_processHUDResults(z){var A=z.results.hud;n.copy(this._tmpRegion,n.negativeInfinity);const C=this._view.state.camera,E=[],B=this._tmpRegion;var D=P=>{const J=new h(P);C.projectToRenderScreen(P.target.center,J.screenPoint);J.screenPoint[0]=Math.floor(J.screenPoint[0]);J.screenPoint[1]=Math.floor(J.screenPoint[1]);E.push(J);n.expandPointInPlace(B,J.screenPoint)};z.sortResults(A.all);null!=A.min.dist&&D(A.min);for(var F of A.all)A.min.target.object!==F.target.object&&A.max.target.object!==
F.target.object&&D(F);null!=A.max.dist&&A.max.target.object!==A.min.target.object&&D(A.max);if(E.length){B[0]===B[2]&&(B[2]+=1);B[1]===B[3]&&(B[3]+=1);A=C.fullWidth;D=C.fullHeight;var K=Math.max(0,B[0]-1),L=Math.max(0,B[1]-1);F=Math.min(n.width(B)+2,A-K);var G=Math.min(n.height(B)+2,D-L),O=new Uint8Array(F*G*4);this._view._stage.renderer.readHUDVisibility(K,L,F,G,O);K=!0;L=null==z.results.max.dist;G=0;for(const P of E)for(const J of p)if(O[4*(Math.min(P.screenPoint[0]+J[0],A)-B[0]+(Math.min(P.screenPoint[1]+
J[1],D)-B[1])*F)]){K&&(z.results.min.copy(P.result),K=!1);L&&z.results.max.copy(P.result);z.options.store===l.StoreResults.ALL&&z.results.all.splice(G++,0,P.result);break}}}}const p=(()=>{const z=[];for(let A=-1;1>=A;A++)for(let C=-1;1>=C;C++)z.push([C+1,A+1]);return z})();class h{constructor(z){this.result=z;this.screenPoint=c.createRenderScreenPointArray3()}}let t;class r{constructor(z,A){this.layers=[];this.sliceableLayers=[];this.include=z?.include;this.exclude=z?.exclude;A(C=>{C.pickable&&this.filterLayerUid(C.apiLayerUid)&&
(C.sliceable?this.sliceableLayers:this.layers).push(C)})}filterLayerUid(z){const {include:A,exclude:C}=this;return null==z?null==A&&null==C:(null==A||A.has(z))&&(null==C||!C.has(z))}filterRenderGeometry(z){return this.filterLayerUid(z.layerUid)}}const u=f.create(),y=c.createRenderScreenPointArray3();b.SceneIntersectionHelper=x;b.isIntersectionHandler=function(z){return"object"===typeof z&&"intersect"in z};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/CombinedElevationProvider":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Evented ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../geometry/SpatialReference ../../../geometry/support/spatialReferenceUtils ../layers/graphics/ElevationQuery".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v){function x(p,h,t,r,u,y,z){for(const A of h)h=A.getElevation(t,r,u,y,z),null!=h&&(p=null!=p?Math.max(h,p):h);return p}b.CombinedElevationProvider=class extends d.EventedMixin(c){get spatialReference(){return this.view?.basemapTerrain?.spatialReference}constructor(p){super(p);this._im=[];this._ground=[];this._scene=[];this.lastElevationQuery=null;this.elevationCacheEnabled=!1}destroy(){this._elevationQueryCached=f.destroyMaybe(this._elevationQueryCached)}enableElevationCache(p){p||
(this.lastElevationQuery=null);this.elevationCacheEnabled=p}getElevation(p,h,t,r,u){if(this.elevationCacheEnabled&&null!=this.lastElevationQuery){var y=this.lastElevationQuery;if(p===y.x&&h===y.y&&t===y.z&&w.equals(r,y.spatialReference)&&u===y.queryContext)return y.result}y=x(null,this._im,p,h,t,r,u);null==y&&(y=x(y,this._ground,p,h,t,r,u));"scene"===u&&(y=x(y,this._scene,p,h,t,r,u));this.elevationCacheEnabled&&(this.lastElevationQuery={x:p,y:h,z:t,spatialReference:r,queryContext:u,result:y});return y}getSphereElevationBounds(p,
h){let t=Infinity,r=-Infinity;for(const u of[this._im,this._ground,this._scene])u.forEach(y=>{y.getSphereElevationBounds&&(y=y.getSphereElevationBounds(p,h),null!=y&&(t=Math.min(t,y.min),r=Math.max(r,y.max)))});return{min:t,max:r}}getRootElevationBounds(){let p=Infinity,h=-Infinity;for(const t of[this._im,this._ground,this._scene])t.forEach(r=>{r.getRootElevationBounds&&(r=r.getRootElevationBounds(),null!=r&&(p=Math.min(p,r.min),h=Math.max(h,r.max)))});return{min:p,max:h}}async queryElevation(p,h,
t,r,u,y=null,z=0){const A=this._getElevationQuery(r);try{const C=await A.queryElevation(p,h,y,z);return"scene"===u?x(C,this._scene,p,h,t,r,u):C}catch(C){return n.throwIfAbortError(C),this.getElevation(p,h,t,r,u)}}register(p,h){this.addHandles(h.on("elevation-change",t=>this.emit("elevation-change",t)),h);this._providersFromContext(p).push(h)}unregister(p){this.removeHandles(p);for(const h of[this._im,this._ground,this._scene]){const t=h.indexOf(p);-1<t&&h.splice(t,1)}}_providersFromContext(p){switch(p){case "ground":return this._ground;
case "im":return this._im;case "scene":return this._scene}}_getElevationQuery(p=this.view.spatialReference){const h=this._elevationQueryCached;if(null!=h&&w.equals(p,h.spatialReference))return h;h?.destroy({completeTasks:!0});const {wkid:t,wkt:r,wkt2:u,latestWkid:y}=p;return this._elevationQueryCached=p=new v.ElevationQuery(this.view.resourceController.scheduler,new l({wkid:t,wkt:r,wkt2:u,latestWkid:y}),()=>this.view.map?.ground,{maximumAutoTileRequests:4})}};a.__decorate([k.property({constructOnly:!0})],
b.CombinedElevationProvider.prototype,"view",void 0);a.__decorate([k.property()],b.CombinedElevationProvider.prototype,"spatialReference",null);b.CombinedElevationProvider=a.__decorate([m.subclass("esri.views.3d.support.CombinedElevationProvider")],b.CombinedElevationProvider);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/ElevationQuery":function(){define("exports ../../../../geometry ../../../../core/arrayUtils ../../../../core/promiseUtils ../../../support/Scheduler ../../../../geometry/Multipoint".split(" "),
function(b,a,c,d,f,n){class k{constructor(q,e){this.spatialReference=q;this._view=e}getElevation(q,e,m){return this._view.elevationProvider.getElevation(q,e,0,this.spatialReference,m)}async queryElevation(q,e,m,l,w){return this._view.elevationProvider.queryElevation(q,e,0,this.spatialReference,w,m,l)}}class g{constructor(q,e,m,l){this.spatialReference=e;this._getElevationQueryProvider=m;this._queries=[];this._queryOptions={...l,ignoreInvisibleLayers:!0};this._frameTask=q.registerTask(f.TaskPriority.ELEVATION_QUERY,
this)}destroy({completeTasks:q}={completeTasks:!1}){this._frameTask.remove();if(this.running)if(q)this.runTask(f.noBudget);else for(const e of this._queries)e.result.reject(d.createAbortError())}queryElevation(q,e,m,l=0){const w=d.createResolver(),v={x:q,y:e,minDemResolution:l,result:w,signal:m};this._queries.push(v);d.onAbort(m,()=>{c.remove(this._queries,v);w.reject(d.createAbortError())});return w.promise}get running(){return 0<this._queries.length}runTask(q){const e=this._queries;this._queries=
[];const m=this._getElevationQueryProvider();if(m){var l=e.map(p=>[p.x,p.y]),w=e.reduce((p,h)=>Math.min(p,h.minDemResolution),Infinity);l=new n({points:l,spatialReference:this.spatialReference});var v=1<e.length&&e.some(p=>!!p.signal)?new AbortController:null,x=null!=v?v.signal:e[0].signal;if(null!=v){let p=0;e.forEach(h=>d.onAbort(h.signal,()=>{p++;h.result.reject(d.createAbortError());p===e.length&&v.abort()}))}m.queryElevation(l,{...this._queryOptions,minDemResolution:w,signal:x}).then(p=>{e.forEach((h,
t)=>{null!=h.signal&&h.signal.aborted?h.result.reject(d.createAbortError()):h.result.resolve(p.geometry.points[t][2])})}).catch(p=>{e.forEach(h=>h.result.reject(p))})}else e.forEach(p=>p.result.reject());q.madeProgress()}get test(){const q=this;return{update:()=>0<q._queries.length&&q.runTask(f.noBudget)}}}b.ElevationQuery=g;b.ViewElevationProvider=k;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/DisplayQualityProfile":function(){define(["../../../core/has",
"../../../core/time"],function(b,a){function c(){const n=!!b("esri-mobile"),k=!!b("ios"),g=a.Milliseconds(400);return{low:{graphics3D:{maxTotalNumberOfFeatures:25E3,maxNumberOfDrawCalls:8E3,maxTotalNumberOfVertices:255E4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1,skipHighSymbolLods:!0,uncompressedTextureDownsamplingEnabled:!0},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:25E3},sceneService:{object:{lodFactor:.2,lodCrossfadeinDuration:a.Milliseconds(0),lodCrossfadeoutDuration:a.Milliseconds(0),
lodCrossfadeUncoveredDuration:a.Milliseconds(0)},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,vtlContentZoom:.75,reduceTileLevelDifferences:!0,textureFadeDuration:a.Milliseconds(0)},fadeDuration:a.Milliseconds(0),antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:200+f.IPhone12Pro,
additionalCacheMemory:0,frameRate:0,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:1E5,maxNumberOfDrawCalls:17E3,maxTotalNumberOfVertices:625E4,polygonLodFactor:n?.8:1,polylineLodFactor:n?1.2:1.5,snapshotAvailable:!k,skipHighSymbolLods:!1,uncompressedTextureDownsamplingEnabled:n},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:5E4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:a.Milliseconds(0),lodCrossfadeoutDuration:a.Milliseconds(0),lodCrossfadeUncoveredDuration:g},
point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:n},tiledSurface:{lodBias:0,angledSplitBias:1,vtlContentZoom:1.5,reduceTileLevelDifferences:!b("disable-feature:reduce-map-tile-levels"),textureFadeDuration:g},fadeDuration:g,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:n?600+f.GalaxyS20:750+f.FullHD,additionalCacheMemory:n?-100:
150,frameRate:0,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:1E5,maxNumberOfDrawCalls:17E3,maxTotalNumberOfVertices:125E5,polygonLodFactor:n?1.2:2,polylineLodFactor:n?1.2:2,snapshotAvailable:!k,skipHighSymbolLods:!1,uncompressedTextureDownsamplingEnabled:!1},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:5E4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:a.Milliseconds(0),lodCrossfadeoutDuration:a.Milliseconds(0),lodCrossfadeUncoveredDuration:g},point:{lodFactor:1},
integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,vtlContentZoom:1.5,reduceTileLevelDifferences:!b("disable-feature:reduce-map-tile-levels"),textureFadeDuration:g},fadeDuration:g,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!0,reflections:!0,ambientOcclusion:!0,memoryLimit:n?900+f.SurfacePro7:1500+f.FullHDRetina,additionalCacheMemory:n?-150:0,frameRate:0,
maximumPixelRatio:n?1:Infinity}}}class d{static isValidProfile(n){return n in d.profiles}static getDefaultProfile(){return b("esri-iPhone")?"low":"medium"}static apply(n,k){n=d.profiles[n];k.graphics3D.maxTotalNumberOfFeatures=n.graphics3D.maxTotalNumberOfFeatures;k.graphics3D.maxNumberOfDrawCalls=n.graphics3D.maxNumberOfDrawCalls;k.graphics3D.maxTotalNumberOfVertices=n.graphics3D.maxTotalNumberOfVertices;k.graphics3D.polygonLodFactor=n.graphics3D.polygonLodFactor;k.graphics3D.polylineLodFactor=n.graphics3D.polylineLodFactor;
k.graphics3D.snapshotAvailable=n.graphics3D.snapshotAvailable;k.graphics3D.skipHighSymbolLods=n.graphics3D.skipHighSymbolLods;k.graphics3D.uncompressedTextureDownsamplingEnabled=n.graphics3D.uncompressedTextureDownsamplingEnabled;const g=k.sceneService.object,q=n.sceneService.object;g.lodFactor=q.lodFactor;g.lodCrossfadeinDuration=q.lodCrossfadeinDuration;g.lodCrossfadeoutDuration=q.lodCrossfadeoutDuration;g.lodCrossfadeUncoveredDuration=q.lodCrossfadeUncoveredDuration;k.sceneService.point.lodFactor=
n.sceneService.point.lodFactor;k.sceneService.integratedMesh.lodFactor=n.sceneService.integratedMesh.lodFactor;k.sceneService.pointCloud.lodFactor=n.sceneService.pointCloud.lodFactor;k.sceneService.uncompressedTextureDownsamplingEnabled=n.sceneService.uncompressedTextureDownsamplingEnabled;k.tiledSurface.lodBias=n.tiledSurface.lodBias;k.tiledSurface.angledSplitBias=n.tiledSurface.angledSplitBias;k.tiledSurface.vtlContentZoom=n.tiledSurface.vtlContentZoom;k.tiledSurface.reduceTileLevelDifferences=
n.tiledSurface.reduceTileLevelDifferences;k.tiledSurface.textureFadeDuration=n.tiledSurface.textureFadeDuration;k.heatmap.pixelRatio=n.heatmap.pixelRatio;k.heatmap.maxTotalNumberOfFeatures=n.heatmap.maxTotalNumberOfFeatures;k.fadeDuration=n.fadeDuration;k.antialiasingEnabled=n.antialiasingEnabled;k.physicallyBasedRenderingEnabled=n.physicalBasedRenderingEnabled;k.highQualityTransparency=n.highQualityTransparency;k.highResolutionAtmosphere=n.highResolutionAtmosphere;k.reflections=n.reflections;k.ambientOcclusion=
n.ambientOcclusion;k.memoryLimit=n.memoryLimit;k.additionalCacheMemory=n.additionalCacheMemory;k.frameRate=n.frameRate;k.maximumPixelRatio=n.maximumPixelRatio}}d.test={reset(){const n=c();for(const k of Object.keys(n))d.profiles[k]=n[k]}};const f={IPhone12Pro:120,GalaxyS20:200,FullHD:240,SurfacePro7:300,FullHDRetina:430};(d||(d={})).profiles=c();return d})},"esri/views/3d/support/HighlightOptions":function(){define("../../../chunks/tslib.es6 ../../../Color ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../webgl-engine/effects/highlight/HighlightDefaults".split(" "),
function(b,a,c,d,f,n,k,g,q){c=class extends c{constructor(){super(...arguments);this.color=q.defaultColor.clone();this.haloColor=null;this.haloOpacity=q.defaultHaloOpacity;this.fillOpacity=q.defaultFillOpacity;this.shadowOpacity=q.defaultShadowOpacity;this.shadowColor=q.defaultShadowColor.clone();this.shadowDifference=q.defaultShadowDifference}};b.__decorate([d.property({type:a})],c.prototype,"color",void 0);b.__decorate([d.property({type:a})],c.prototype,"haloColor",void 0);b.__decorate([d.property()],
c.prototype,"haloOpacity",void 0);b.__decorate([d.property()],c.prototype,"fillOpacity",void 0);b.__decorate([d.property()],c.prototype,"shadowOpacity",void 0);b.__decorate([d.property({type:a})],c.prototype,"shadowColor",void 0);b.__decorate([d.property()],c.prototype,"shadowDifference",void 0);return c=b.__decorate([g.subclass("esri.views.3d.support.HighlightOptions")],c)})},"esri/views/3d/webgl-engine/effects/highlight/HighlightDefaults":function(){define(["exports","../../../../../Color"],function(b,
a){const c=new a([0,255,255]);a=new a([0,0,0]);b.defaultColor=c;b.defaultFillOpacity=.25;b.defaultHaloOpacity=1;b.defaultShadowColor=a;b.defaultShadowDifference=.2;b.defaultShadowOpacity=.4;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/MapCoordsHelper":function(){define("exports ../../../geometry ../../../core/Error ../../../core/unitUtils ../../../geometry/ellipsoidUtils ../../../portal/support/geometryServiceUtils ../../../rest/geometryService/project ../../../rest/support/ProjectParameters ../../../geometry/Point ../../../geometry/SpatialReference".split(" "),
function(b,a,c,d,f,n,k,g,q,e){class m{constructor(l,w){this.spatialReference=w;this.unitInMeters=d.getMetersPerUnitForSR(this.spatialReference,f.getReferenceEllipsoid(this.spatialReference).metersPerDegree);this._geometryServiceURLPromise=n.getGeometryServiceURL(l&&"portalItem"in l?l.portalItem:void 0).catch(()=>{throw new c("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config");})}async toGeographic(l){var w=await this._geometryServiceURLPromise;let v=!0;Array.isArray(l[0])&&
"number"!==typeof l[0]||(l=[l],v=!1);l=l.map(x=>x instanceof q?x:new q(x,this.spatialReference));l=new g({geometries:l,outSpatialReference:e.WGS84});w=(await k.project(w,l)).map(x=>"point"===x.type?[x.x,x.y]:void 0).filter(x=>!!x);return v?w:w[0]}}b.MapCoordsHelper=m;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/portal/support/geometryServiceUtils":function(){define("exports ../../config ../../core/Error ../Portal ../../rest/geometryService/project ../../rest/support/ProjectParameters".split(" "),
function(b,a,c,d,f,n){async function k(g=null,q){if(a.geometryServiceUrl)return a.geometryServiceUrl;if(!g)throw new c("internal:geometry-service-url-not-configured");g="portal"in g?g.portal||d.getDefault():g;await g.load({signal:q});q=g.helperServices?.geometry?.url;if(!q)throw new c("internal:geometry-service-url-not-configured");return q}b.getGeometryServiceURL=k;b.projectGeometry=async function(g,q,e=null,m){e=await k(e,m);const l=new n;l.geometries=[g];l.outSpatialReference=q;if((g=await f.project(e,
l,{signal:m}))&&Array.isArray(g)&&1===g.length)return g[0];throw new c("internal:geometry-service-projection-failed");};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/QualitySettings":function(){define("../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/time ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass".split(" "),
function(b,a,c,d,f,n,k,g){let q=class extends a{constructor(){super(...arguments);this.minTotalNumberOfFeatures=2E3;this.maxTotalNumberOfFeatures=5E4;this.maxNumberOfDrawCalls=17E3;this.maxTotalNumberOfVertices=17E5;this.snapshotAvailable=!0;this.polylineLodFactor=this.polygonLodFactor=1;this.uncompressedTextureDownsamplingEnabled=this.skipHighSymbolLods=!1}};b.__decorate([d.property()],q.prototype,"minTotalNumberOfFeatures",void 0);b.__decorate([d.property()],q.prototype,"maxTotalNumberOfFeatures",
void 0);b.__decorate([d.property()],q.prototype,"maxNumberOfDrawCalls",void 0);b.__decorate([d.property()],q.prototype,"maxTotalNumberOfVertices",void 0);b.__decorate([d.property()],q.prototype,"snapshotAvailable",void 0);b.__decorate([d.property()],q.prototype,"polygonLodFactor",void 0);b.__decorate([d.property()],q.prototype,"polylineLodFactor",void 0);b.__decorate([d.property()],q.prototype,"skipHighSymbolLods",void 0);b.__decorate([d.property()],q.prototype,"uncompressedTextureDownsamplingEnabled",
void 0);q=b.__decorate([g.subclass("esri.views.3d.support.QualitySettings.Graphics3DSettings")],q);let e=class extends a{constructor(){super(...arguments);this.lodFactor=1}};b.__decorate([d.property()],e.prototype,"lodFactor",void 0);e=b.__decorate([g.subclass("esri.views.3d.support.QualitySettings.LoDFactorSettings")],e);let m=class extends e{constructor(){super(...arguments);this.lodCrossfadeinDuration=c.Milliseconds(0);this.lodCrossfadeoutDuration=c.Milliseconds(0);this.lodCrossfadeUncoveredDuration=
c.Milliseconds(0)}};m=b.__decorate([g.subclass("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")],m);let l=class extends a{constructor(){super(...arguments);this.object=new m;this.point=new e;this.integratedMesh=new e;this.pointCloud=new e;this.uncompressedTextureDownsamplingEnabled=!1}};b.__decorate([d.property({type:m})],l.prototype,"object",void 0);b.__decorate([d.property({type:e})],l.prototype,"point",void 0);b.__decorate([d.property({type:e})],l.prototype,"integratedMesh",void 0);
b.__decorate([d.property({type:e})],l.prototype,"pointCloud",void 0);b.__decorate([d.property()],l.prototype,"uncompressedTextureDownsamplingEnabled",void 0);l=b.__decorate([g.subclass("esri.views.3d.support.QualitySettings.SceneServiceSettings")],l);let w=class extends a{constructor(){super(...arguments);this.lodBias=0;this.vtlContentZoom=this.angledSplitBias=1;this.reduceTileLevelDifferences=!0;this.textureFadeDuration=c.Milliseconds(400)}};b.__decorate([d.property()],w.prototype,"lodBias",void 0);
b.__decorate([d.property()],w.prototype,"angledSplitBias",void 0);b.__decorate([d.property()],w.prototype,"vtlContentZoom",void 0);b.__decorate([d.property()],w.prototype,"reduceTileLevelDifferences",void 0);b.__decorate([d.property()],w.prototype,"textureFadeDuration",void 0);w=b.__decorate([g.subclass("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],w);let v=class extends a{constructor(){super(...arguments);this.pixelRatio=1;this.maxTotalNumberOfFeatures=5E4}};b.__decorate([d.property()],
v.prototype,"pixelRatio",void 0);b.__decorate([d.property()],v.prototype,"maxTotalNumberOfFeatures",void 0);v=b.__decorate([g.subclass("esri.views.3d.support.QualitySettings.HeatmapSettings")],v);a=class extends a{constructor(){super(...arguments);this.graphics3D=new q;this.sceneService=new l;this.tiledSurface=new w;this.heatmap=new v;this.fadeDuration=c.Milliseconds(400);this.antialiasingEnabled=!0;this.physicallyBasedRenderingEnabled=!1;this.highQualityTransparency=!0;this.ambientOcclusion=this.reflections=
this.highResolutionAtmosphere=!1;this.memoryLimit=750;this.additionalCacheMemory=0;this.frameRate=void 0;this.maximumPixelRatio=Infinity}};b.__decorate([d.property({type:q})],a.prototype,"graphics3D",void 0);b.__decorate([d.property({type:l})],a.prototype,"sceneService",void 0);b.__decorate([d.property({type:w})],a.prototype,"tiledSurface",void 0);b.__decorate([d.property({type:v})],a.prototype,"heatmap",void 0);b.__decorate([d.property()],a.prototype,"fadeDuration",void 0);b.__decorate([d.property()],
a.prototype,"antialiasingEnabled",void 0);b.__decorate([d.property()],a.prototype,"physicallyBasedRenderingEnabled",void 0);b.__decorate([d.property()],a.prototype,"highQualityTransparency",void 0);b.__decorate([d.property()],a.prototype,"highResolutionAtmosphere",void 0);b.__decorate([d.property()],a.prototype,"reflections",void 0);b.__decorate([d.property()],a.prototype,"ambientOcclusion",void 0);b.__decorate([d.property()],a.prototype,"memoryLimit",void 0);b.__decorate([d.property()],a.prototype,
"additionalCacheMemory",void 0);b.__decorate([d.property()],a.prototype,"frameRate",void 0);b.__decorate([d.property()],a.prototype,"maximumPixelRatio",void 0);return a=b.__decorate([g.subclass("esri.views.3d.support.QualitySettings.QualitySettings")],a)})},"esri/views/3d/support/RenderCoordsHelper":function(){define("exports ../../../core/mathUtils ../../../core/unitUtils ../../../chunks/mat4 ../../../chunks/vec3 ../../../core/libs/gl-matrix-2/types/vec3 ../../../geometry/projection/projectPointToVector ../../../geometry/projection/projectVectorToDehydratedPoint ../../../geometry/projection/projectVectorToPoint ../../../geometry/projection/projectVectorToVector ../../../geometry/support/Axis ../../../geometry/support/coordinateSystem ../../../geometry/support/plane ../../../geometry/support/vector ../../../geometry/support/vectorStacks ../../../layers/graphics/dehydratedFeatureUtils ../../ViewingMode".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h){class t{constructor(r,u,y,z){this.viewingMode=r;this.spatialReference=u;this.unitInMeters=y;this._coordinateSystem=z;this._tmpCoordinateSystem=l.create(z)}set extent(r){r&&l.setExtent(this._coordinateSystem,r,this._coordinateSystem)}getAltitude(r){return l.altitudeAt(this._coordinateSystem,r)}setAltitude(r,u,y=r){return l.setAltitudeAt(this._coordinateSystem,y,u,r)}setAltitudeOfTransformation(r,u){l.setAltitudeOfTransformation(this._coordinateSystem,u,r,
u)}worldUpAtPosition(r,u){return l.normalAt(this._coordinateSystem,r,u)}worldBasisAtPosition(r,u,y){return l.axisAt(this._coordinateSystem,r,u,y)}basisMatrixAtPosition(r,u){const y=this.worldBasisAtPosition(r,m.Axis.X,x.sv3d.get()),z=this.worldBasisAtPosition(r,m.Axis.Y,x.sv3d.get());r=this.worldBasisAtPosition(r,m.Axis.Z,x.sv3d.get());d.set(u,y[0],y[1],y[2],0,z[0],z[1],z[2],0,r[0],r[1],r[2],0,0,0,0,1);return u}headingAtPosition(r,u){const y=this.worldUpAtPosition(r,x.sv3d.get());r=this.worldBasisAtPosition(r,
m.Axis.Y,x.sv3d.get());u=v.angleAroundAxis(u,r,y);return a.rad2deg(u)}intersectManifoldClosestSilhouette(r,u,y){l.elevate(this._coordinateSystem,u,this._tmpCoordinateSystem);l.intersectRayClosestSilhouette(this._tmpCoordinateSystem,r,y);return y}intersectManifold(r,u,y){l.elevate(this._coordinateSystem,u,this._tmpCoordinateSystem);u=x.sv3d.get();return l.intersectRay(this._tmpCoordinateSystem,r,u)?f.copy(y,u):null}intersectInfiniteManifold(r,u,y){if(this.viewingMode===h.ViewingMode.Global)return this.intersectManifold(r,
u,y);l.elevate(this._coordinateSystem,u,this._tmpCoordinateSystem);u=this._tmpCoordinateSystem.value;const z=x.sv3d.get();return w.intersectRay(u.plane,r,z)?f.copy(y,z):null}toRenderCoords(r,u,y){return p.isDehydratedPoint(r)?k.projectPointToVector(r,u,this.spatialReference):e.projectVectorToVector(r,u,y,this.spatialReference)}fromRenderCoords(r,u,y=null){return p.isDehydratedPoint(u)?(null!=y&&(u.spatialReference=y),g.projectVectorToDehydratedPoint(r,this.spatialReference,u)):n.isVec3(u)?e.projectVectorToVector(r,
this.spatialReference,u,y)?u:null:q.projectVectorToPoint(r,this.spatialReference,u)}static create(r,u){switch(r){case h.ViewingMode.Local:return new t(h.ViewingMode.Local,u,c.getMetersPerUnitForSR(u),l.createLocal());case h.ViewingMode.Global:return new t(h.ViewingMode.Global,u,1,l.createGlobal(u))}}static renderUnitScaleFactor(r,u){return c.getMetersPerCartesianUnitForSR(r)/c.getMetersPerCartesianUnitForSR(u)}}b.RenderCoordsHelper=t;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/core/libs/gl-matrix-2/types/vec3":function(){define(["exports","../../../typedArrayUtil"],function(b,a){function c(f){return a.isFloat32Array(f)&&3<=f.length}function d(f){return(a.isFloat64Array(f)||Array.isArray(f))&&3<=f.length}b.isVec3=function(f){return c(f)||d(f)};b.isVec3f32=c;b.isVec3f64=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/ResourceController":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/handleUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/scheduling ../../../core/signal ../../../core/time ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./index ./MemoryController ./StreamDataLoader ../../support/Scheduler".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t){c=class extends c{constructor(){super(...arguments);this.updating=!1}};a.__decorate([e.property({readOnly:!0})],c.prototype,"updating",void 0);c=a.__decorate([v.subclass("esri.views.3d.support.ResourceControllerMain")],c);let r=class extends c{constructor(){super(...arguments);this._normalTask=this._immediateTask=t.ImmediateTask;this._updatingObjects=g.signal([]);this._frameTask=null}get immediate(){return this._immediateTask}get normal(){return this._normalTask}initialize(){this._scheduler=
t.newScheduler();this._memoryController=p.newMemoryController(this.view);this._streamDataLoader=new h.StreamDataLoader;this._streamDataLoader.setup(x.maxDownloadSlots,x.downloadSlotsPerClient,this._scheduler);this.addHandles([n.watch(()=>this.view.state?.mode,u=>{null!=u&&(this._scheduler.state=u)},n.sync),n.watch(()=>this.view.stationary,()=>this._stationaryChangedHandler())]);this._frameTask=k.addFrameTask({update:u=>this._frame(u)});this._immediateTask=this._scheduler.registerTask(t.TaskPriority.RESOURCE_CONTROLLER_IMMEDIATE);
this._normalTask=this._scheduler.registerTask(t.TaskPriority.RESOURCE_CONTROLLER)}destroy(){this._immediateTask.remove();this._normalTask.remove();this._frameTask=f.removeMaybe(this._frameTask);this._streamDataLoader=f.destroyMaybe(this._streamDataLoader);this._memoryController=f.destroyMaybe(this._memoryController);this._scheduler=f.destroyMaybe(this._scheduler);this.view=null}get updating(){return!!(this._memoryController?.updating||this._streamDataLoader?.updating||this._immediateTask?.updating)||
this._updatingObjects?.value.some(u=>u.updating)}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}createStreamDataRequester(u){const y=this._streamDataLoader;return{request(z,A,C){return y.request(z,A,u,C)},get busy(){return!y.hasDownloadSlots(u)}}}addUpdatingObject(u){const y=this._updatingObjects;y.value=[...y.value,u];return d.makeHandle(()=>{y.value=y.value.filter(z=>z!==u)})}_frame(u){if(!this.view.suspended){if(this.view.stateManager&&(this.view.stateManager.step(q.secondsFromMilliseconds(u.deltaTime)),
!this._scheduler))return;this._memoryController.update();this._scheduler.updateBudget(u)&&this._scheduler.frame()}}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}get test(){return{getQueueStats:u=>this._streamDataLoader.test.loadQueue.getStatsForType(u)}}};a.__decorate([e.property()],r.prototype,"view",void 0);a.__decorate([e.property()],r.prototype,"_scheduler",void 0);a.__decorate([e.property()],r.prototype,"_memoryController",void 0);a.__decorate([e.property()],r.prototype,
"_streamDataLoader",void 0);a.__decorate([e.property()],r.prototype,"_immediateTask",void 0);a.__decorate([e.property()],r.prototype,"_normalTask",void 0);a.__decorate([e.property()],r.prototype,"_updatingObjects",void 0);a.__decorate([e.property({readOnly:!0})],r.prototype,"updating",null);r=a.__decorate([v.subclass("esri.views.3d.support.ResourceControllerImpl")],r);b.newResourceController=function(u){return new r({view:u})};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/index":function(){define(["exports"],
function(b){b.ClientType=void 0;(function(c){c[c.ELEVATION=0]="ELEVATION";c[c.BASEMAP=1]="BASEMAP";c[c.I3S_INDEX=2]="I3S_INDEX";c[c.I3S_DATA=3]="I3S_DATA";c[c.SYMBOLOGY=4]="SYMBOLOGY"})(b.ClientType||(b.ClientType={}));const a=(()=>{const c=[];c[b.ClientType.ELEVATION]=10;c[b.ClientType.BASEMAP]=10;c[b.ClientType.I3S_INDEX]=10;c[b.ClientType.I3S_DATA]=10;c[b.ClientType.SYMBOLOGY]=5;return c})();b.downloadSlotsPerClient=a;b.maxDownloadSlots=30;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/support/MemoryController":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Logger ../../../core/MemCache ../../../core/scheduling ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./MemoryManagedView".split(" "),function(b,a,c,d,f,n,k,g,q,e,m,l){let w=class extends c{constructor(v){super(v);this._quality=1;this._usedMemory=
0;this._updating=!1;this._downscaleMemoryUsed=this._stableQuality=0;this._canFastRecover=!1;this._memoryPredicted=0;this._cacheStorage=new f.MemCacheStorage;this._warnMemoryUsage=null;this._numQualityChanges=0;this._maxMemory=750;this._additionalCacheMemory=0;this.addHandles(n.addFrameTask({prepare:()=>this._updateMemory()}))}destroy(){this._cacheStorage.destroy()}get maxMemory(){return this._maxMemory}set maxMemory(v){null==v||0>=v||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<
v&&this._updateQuality(1),this._maxMemory=v)}get additionalCacheMemory(){return this._additionalCacheMemory}set additionalCacheMemory(v){null!=v&&(this._additionalCacheMemory=v)}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._usedMemory}get usedCacheMemory(){return this._cacheStorage.size}newCache(v,x){return new f.MemCache(v,this._cacheStorage,x)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(!(0>=
this._memoryPredicted)||this._updating){var v=this._layersUpdating();if(.6>this._memoryPredicted&&this._canFastRecover)this._stableQuality=this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._updateQuality(1);else if(v){if(1.1<this._memoryPredicted||1<this._usedMemory)0<this._stableQuality?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):.1<this._quality&&this._downscaleMemoryUsed<this._usedMemory&&(this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._usedMemory,
this._canFastRecover=!1)}else this._downscaleMemoryUsed=0,1<this._usedMemory?(this._stableQuality=0,this._canFastRecover=!1,v=this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._memoryPredicted):this._stableQuality!==this._quality&&(.75>this._usedMemory&&1>this._quality?(this._stableQuality=this._quality,v=this._updateQuality(this._quality+.05)):1>this._quality&&(this._canFastRecover=!0));this._updating=v}}_updateQuality(v){v=Math.min(Math.max(v,.1),1);if(v===this._quality)return!1;
this._quality=v;++this._numQualityChanges;return!0}_layersUpdating(){return this.view.allLayerViews.some(v=>!!v.updating)}_updateMemory(){if(this.view){this.view._stage?.renderer?.tick();var v=(this.view.basemapTerrain?.usedMemory??0)+(this.view._stage?.renderer?.usedMemory??0),x=0;this.view.allLayerViews&&this.view.allLayerViews.forEach(t=>{if(l.isMemoryManagedView(t)){const r=t.ignoresMemoryFactor?this._quality:1;v+=t.usedMemory*r;x+=t.unloadedMemory*r}});var p=null==this._warnMemoryUsage||Math.round(10*
v)!==Math.round(10*this._warnMemoryUsage),h=1048576*this.maxMemory;if(v>h&&p){this._warnMemoryUsage=v;p=r=>(r/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB";const t=Math.round(100*this._quality);d.getLogger(this).warn(`Memory Limit exceeded! Limit: ${p(h)} Current: ${p(v)} Projected: ${p(v+x)} Quality: ${t}%`)}this._usedMemory=v/h;this._memoryPredicted=(v+x)/h;this._cacheStorage.maxSize=Math.max(0,h-v+1048576*this.additionalCacheMemory)}}get test(){const v=this;return{cacheStorage:this._cacheStorage,
resetQualityChanges:()=>{const x=v._numQualityChanges;v._numQualityChanges=0;return x}}}};a.__decorate([k.property({constructOnly:!0})],w.prototype,"view",void 0);a.__decorate([k.property()],w.prototype,"maxMemory",null);a.__decorate([k.property()],w.prototype,"additionalCacheMemory",null);a.__decorate([k.property({readOnly:!0})],w.prototype,"memoryFactor",null);a.__decorate([k.property({readOnly:!0})],w.prototype,"updating",null);a.__decorate([k.property({readOnly:!0})],w.prototype,"usedMemory",
null);a.__decorate([k.property({readOnly:!0})],w.prototype,"usedCacheMemory",null);a.__decorate([k.property()],w.prototype,"_quality",void 0);a.__decorate([k.property()],w.prototype,"_usedMemory",void 0);a.__decorate([k.property()],w.prototype,"_updating",void 0);a.__decorate([k.property()],w.prototype,"_stableQuality",void 0);a.__decorate([k.property()],w.prototype,"_maxMemory",void 0);a.__decorate([k.property()],w.prototype,"_additionalCacheMemory",void 0);w=a.__decorate([m.subclass("esri.views.3d.support.MemoryController")],
w);b.minQuality=.1;b.newMemoryController=function(v){return new w({view:v})};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/MemoryManagedView":function(){define(["exports"],function(b){b.isMemoryManagedView=function(a){return"usedMemory"in a&&"unloadedMemory"in a&&"ignoresMemoryFactor"in a};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/StreamDataLoader":function(){define("exports ../../../chunks/tslib.es6 ../../../request ../../../core/Accessor ../../../core/arrayUtils ../../../core/Error ../../../core/lang ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ./AsyncWorkerQueue ../webgl-engine/lib/Util ../../support/Scheduler".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x){function p(u){if(2>u.byteLength)return"unknown";u=new Uint8Array(u,0,u.byteLength);return 137===u[0]&&80===u[1]?"image/png":71===u[0]&&73===u[1]?"image/gif":66===u[0]&&77===u[1]?"image/bmp":255===u[0]&&216===u[1]?"image/jpeg":"unknown"}b.StreamDataLoader=class extends d{constructor(){super(...arguments);this._tasks=new Map;this._onLoadQueue=[];this._doneQueue=[];this.updating=!1}setup(u,y,z){this._loadQueue=new w.AsyncWorkerQueue((A,C)=>this._startLoading(A,
C),(A,C)=>this._doneLoadingCB(A,C),u,y);z&&(this._frameTask=z.registerTask(x.TaskPriority.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=g.removeMaybe(this._frameTask);this._tasks.forEach(u=>g.abortMaybe(u.abortController));this._loadQueue=g.destroyMaybe(this._loadQueue);this._tasks=this._doneQueue=this._onLoadQueue=null}hasDownloadSlots(u){return this._loadQueue.hasQuota(u)}request(u,y,z,A={}){const C=q.createResolver();C.__signal=null!=A?A.signal:null;const E=this._createOrUpdateTask(u,y,z,
A,C);q.onAbort(A,()=>this._cancelRequest(E,C));return C.promise}_createTask(u,y,z,A,C,E){u=new r(u,y,z,A,C);this._updateTask(u,E);this._tasks.set(C,u);1===this._tasks.size&&this._set("updating",!0);this._loadQueue.push(u);return u}_cancelRequest(u,y){f.removeUnordered(u.resolvers,y);y.reject(q.createAbortError());0===u.resolvers.length&&(u.status===b.TaskStatus.DOWNLOADING&&(u.status=b.TaskStatus.CANCELLED,this._loadQueue.cancel(u),u.abortController?.abort(),u.request=null,u.abortController=null),
u.status=b.TaskStatus.CANCELLED,this._tasks.delete(u.key),0===this._tasks.size&&this._set("updating",!1))}_updateTask(u,y){u.resolvers.push(y)}_createOrUpdateTask(u,y,z,A,C){const E=`${A?.uid||u}:${y}:${z}`,B=this._tasks.get(E);return B?(this._updateTask(B,C),B):this._createTask(u,A,y,z,E,C)}_doneLoadingCB(u,y){this._loadQueue&&(v.assert(u.status===b.TaskStatus.DOWNLOADING),u.status=b.TaskStatus.DOWNLOADED,this._frameTask?this._doneQueue.push({task:u,err:y}):this._doneLoading(u,y))}get running(){return 0<
this._doneQueue.length||0<this._onLoadQueue.length}runTask(u){for(;!u.done&&0<this._onLoadQueue.length;){var y=this._onLoadQueue.shift();q.throwIfAborted(y.task.abortController);y.task.abortController=null;y.callback(y.task);u.madeProgress()}for(;!u.done&&0<this._doneQueue.length;)y=this._doneQueue.shift(),y.task.status!==b.TaskStatus.DOWNLOADED&&(y.err=y.err||q.createAbortError()),this._doneLoading(y.task,y.err),u.madeProgress()}_doneLoading(u,y){if(y&&!q.isAbortError(y)&&0<u.numRetries)--u.numRetries,
this._loadQueue.push(u);else{var z=u.result instanceof HTMLImageElement?0:u.resolvers.length;for(const A of u.resolvers)if(y)q.isAbortError(y)?A.reject(y):A.reject(new n("stream-data-loader:request-error",`Failed to request resource at '${u.url}'. ${y}`,{url:u.url,error:y}));else{--z;const C=0<z?k.clone(u.result):u.result;A.resolve(C)}this._tasks.delete(u.key);0===this._tasks.size&&this._set("updating",!1)}}_startLoading(u,y){if(u.status===b.TaskStatus.CANCELLED)return!1;u.startTime=performance.now();
u.status=b.TaskStatus.DOWNLOADING;let z,A;switch(u.docType){case "binary":A="array-buffer";z=0;break;case "image":A="image";break;case "image+type":A="array-buffer";break;default:A="json"}u.abortController=new AbortController;const C=u.abortController.signal;u.request=c(u.url,{...u.options,responseType:A,timeout:z,signal:C});let E=()=>{};const B=F=>{u.duration=performance.now()-u.startTime;u.size=F instanceof ArrayBuffer?F.byteLength:u.size||0;u.result=F;this._frameTask?this._onLoadQueue.push({callback:y,
task:u}):(u.abortController=null,y(u))},D=F=>{u.status===b.TaskStatus.DOWNLOADING&&y(u,F);E()};if("image+type"!==u.docType)return u.request.then(F=>B(F.data),D),!0;u.request.then(F=>{F=F.data;const K=p(F);A="image";u.size=F.byteLength;if("unknown"===K)u.request=c(u.url,{responseType:A,timeout:z,signal:C}),u.request.then(G=>B(G.data),D);else{F=new Blob([F],{type:K});var L=window.URL.createObjectURL(F);E=()=>window.URL.revokeObjectURL(L);u.request=c(L,{responseType:A,timeout:z,signal:C});u.request.then(G=>
B(new t(G.data,K,E)),D)}},D);return!0}get test(){return{loadQueue:this._loadQueue}}};a.__decorate([e.property({readOnly:!0})],b.StreamDataLoader.prototype,"updating",void 0);b.StreamDataLoader=a.__decorate([l.subclass("esri.views.3d.support.StreamDataLoader")],b.StreamDataLoader);const h={numRetries:0};class t{constructor(u,y,z){this.image=u;this.type=y;this.release=z}get isOpaque(){return"image/jpeg"===this.type}}class r extends w.BaseTask{constructor(u,y,z,A,C){super(A);this.url=u;this.options=
y;this.docType=z;this.key=C;this.result=null;this.status=b.TaskStatus.QUEUED;this.abortController=this.request=null;this.resolvers=[];this.startTime=0;this.numRetries=h.numRetries}}b.TaskStatus=void 0;(function(u){u[u.QUEUED=1]="QUEUED";u[u.DOWNLOADING=2]="DOWNLOADING";u[u.DOWNLOADED=3]="DOWNLOADED";u[u.CANCELLED=4]="CANCELLED"})(b.TaskStatus||(b.TaskStatus={}));b.ImageWithType=t;b.isImageWithType=function(u){return"image"in u&&"type"in u};b.test=h;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/support/AsyncWorkerQueue":function(){define(["exports","../webgl-engine/lib/Util"],function(b,a){class c{constructor(k){this.client=k;this._cancelled=!1;this.duration=this.size=0}}class d{constructor(k){this.typeWorkerQuota=k;this.tasks=[];this.numWorkers=0;this.statistics=new f}}class f{constructor(){this.speed=this.duration=this.size=this.requests=0}}class n{constructor(k,g,q,e){this._workerFunc=k;this._callbackFunc=g;this._maxTotalNumWorkers=q;this._totalNumWorkers=0;this._clients=
e.map(m=>new d(m))}destroy(){this._clients.length=0}hasQuota(k){return(k=this._clients[k])?this._totalNumWorkers<this._maxTotalNumWorkers||k.numWorkers+k.tasks.length<k.typeWorkerQuota:!1}push(k){const g=this._clients[k.client];g&&(this._totalNumWorkers<this._maxTotalNumWorkers?(g.numWorkers++,this._totalNumWorkers++,this._workerFunc(k,(q,e)=>this._taskCallback(q,e))):g.tasks.push(k))}cancel(k){this._taskFinished(k);k._cancelled=!0}_taskFinished(k){const g=this._clients[k.client];this._totalNumWorkers--;
g&&(g.numWorkers--,g.statistics.requests++,g.statistics.size+=k.size||0,g.statistics.duration+=k.duration||0,g.statistics.speed=0<g.statistics.duration?g.statistics.size/g.statistics.duration:0,a.assert(0<=g.numWorkers));this._next()}_next(){for(const k of this._clients)if(k&&k.numWorkers<k.typeWorkerQuota&&this._processQueue(k))return;for(const k of this._clients)if(k&&this._processQueue(k))break}_processQueue(k){for(;0<k.tasks.length;)if(this._workerFunc(k.tasks.shift(),(g,q)=>this._taskCallback(g,
q)))return k.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(k,g){k._cancelled||(this._callbackFunc(k,g),this._taskFinished(k))}getStatsForType(k){return(k=this._clients[k])?{quota:k.typeWorkerQuota,workers:k.numWorkers,queueSize:k.tasks.length,requestStats:k.statistics}:null}get test(){const k=this;return{set workerFunc(g){k._workerFunc=g}}}}b.AsyncWorkerQueue=n;b.BaseTask=c;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/SceneViewPerformanceInfo":function(){define(["../../../core/ByteSizeUnit",
"../layers/support/MemoryManagedLayerView","./LayerPerformanceInfo","../terrain/terrainUtils"],function(b,a,c,d){class f{constructor(n){this.usedMemory=this.totalMemory=0;this.quality=1;this.edgesMemory=this.terrainMemory=this.load=0;this.layerPerformanceInfos=[];this.fboMemory=this.cachedMemory=0;if(null!=n.resourceController){const k=n.resourceController.memoryController;this.totalMemory=(k.maxMemory??0)*b.ByteSizeUnit.MEGABYTES;this.usedMemory=Math.round(k.usedMemory*this.totalMemory);this.quality=
n.quality;this.load=n.resourceController.scheduler.load;this.cachedMemory=k.usedCacheMemory}this.terrainMemory=n.basemapTerrain?.usedMemory??0;this.edgesMemory=n?._stage?.renderer?.edgeView?.usedMemory??0;this.fboMemory=n?._stage?.renderer?.memoryInfo?.fbos??0;n.allLayerViews.items.forEach(k=>{(a.isMemoryManagedLayerView(k)||d.isSurfaceLayerView(k))&&this.layerPerformanceInfos.push(new c(k,n))});this.layerPerformanceInfos.sort((k,g)=>g.memory-k.memory)}}return f})},"esri/views/3d/layers/support/MemoryManagedLayerView":function(){define(["exports",
"../../support/MemoryManagedView"],function(b,a){b.isMemoryManagedLayerView=function(c){return a.isMemoryManagedView(c)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/LayerPerformanceInfo":function(){define(["../layers/support/PerformanceInfoLayerView","../terrain/terrainUtils"],function(b,a){class c{constructor(d,f){this.layer=null;this.displayedNumberOfFeatures=this.memory=0;this.totalNumberOfFeatures=this.maximumNumberOfFeatures=null;this.layer=d.layer;
this.memory=a.isSurfaceLayerView(d)?f.basemapTerrain.getUsedMemoryForLayerView(d):d.usedMemory;b.isPerformanceInfoLayerView(d)&&(d=d.performanceInfo,this.displayedNumberOfFeatures=d.displayedNumberOfFeatures,this.maximumNumberOfFeatures=d.maximumNumberOfFeatures,this.totalNumberOfFeatures=d.totalNumberOfFeatures)}}return c})},"esri/views/3d/layers/support/PerformanceInfoLayerView":function(){define(["exports"],function(b){b.isPerformanceInfoLayerView=function(a){return"performanceInfo"in a};Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/terrainUtils":function(){define("exports ../../../core/Collection ../../../geometry/support/spatialReferenceUtils ../../../layers/support/layerUtils ../../ViewingMode ../support/StreamDataLoader ./ITile ../../../chunks/terrainUtilsPlanar ../../../chunks/terrainUtilsSpherical".split(" "),function(b,a,c,d,f,n,k,g,q){function e(A){return"imagery-tile"===A?.type||"wcs"===A?.type}function m(A){return"imagery-tile-3d"===A?.type}function l(A){return"tile-3d"===
A?.type}function w(A){return"vector-tile-3d"===A?.type}function v(A){return"wmts-3d"===A?.type}function x(A){return"elevation-3d"===A?.type}function p(A){return A&&(l(A)||m(A)||w(A)||v(A))}function h(A){return null!=A?.data&&"type"in A.data&&"vector-tile"===A.data.type}function t(A,C,E,B){return y[B].checkIfTileInfoSupportedForViewSR(A,E,C)}function r(A,C,E){A=d.getTileMaxtrixSetFromActiveLayer(A);if(null!=A)if(a.isCollection(A)){if(A=A.find(B=>null==t(B.tileInfo,B.fullExtent,C,E)))return{tileInfo:A.tileInfo,
fullExtent:A.fullExtent}}else return{tileInfo:A.tileInfo,fullExtent:A.fullExtent};return{tileInfo:null,fullExtent:null}}function u(A){return A.isWGS84||A.isWebMercator||c.isCGCS2000(A)||!c.isEarth(A)}const y={[f.ViewingMode.Global]:q.terrainUtilsSpherical,[f.ViewingMode.Local]:g.terrainUtilsPlanar};b.enableTerrainInternalChecks=!1;b.enableWaterproofnessTests=!1;const z={force512VTL:!1};g=[k.NeighborIndex.NORTH,k.NeighborIndex.EAST,k.NeighborIndex.SOUTH,k.NeighborIndex.WEST];q=[k.NeighborIndex.NORTH_EAST,
k.NeighborIndex.SOUTH_EAST,k.NeighborIndex.SOUTH_WEST,k.NeighborIndex.NORTH_WEST];b.almostEquals=function(A,C,E=1E-5){return Math.abs(A-C)<E};b.checkIfTileInfoSupportedForView=t;b.enableInternalTerrainChecks=function(A){b.enableTerrainInternalChecks=A};b.enableTerrainWaterproofnessChecks=function(A){b.enableWaterproofnessTests=A;b.enableTerrainInternalChecks=b.enableTerrainInternalChecks||A};b.eps=1E-5;b.getLayerWithExtentRange=function(A){return m(A)?{fullExtent:A.fullExtent,minScale:A.layer.minScale,
maxScale:A.layer.maxScale,tilemapCache:null}:A.layer};b.getTileInfoAndExtentFromWMTSLayer=r;b.getTiledLayerInfo=function(A,C,E){var B=null;let D=null;if("wmts"===A?.type)A=r(A,C,E),B=A.tileInfo,D=A.fullExtent;else if(D=e(A)?A.getCompatibleFullExtent(C):A.fullExtent,B=E===f.ViewingMode.Local,e(A))B=A.getCompatibleTileInfo(C,D,B);else if("vector-tile"===A?.type){B=B&&!u(C)||z.force512VTL;const F=A.tileInfo.spatialReference.isGeographic;B=B?A.tileInfo:A.tileInfo.getOrCreateCompatible(256,F?1:2)}else B=
A.tileInfo;return null!=B&&null!=D&&null==t(B,D,C,E)?{tileInfo:B,fullExtent:D}:null};b.internalAssert=function(A,C){if(b.enableTerrainInternalChecks&&!A)throw A=Error().stack?.slice(5),console.warn("Terrain internal: "+(C??"")+" at "+A),Error("Assertion failed"+(C?": "+C:""));};b.isBlendableLayerView=function(A){return A&&(l(A)||v(A)||m(A)||w(A))};b.isEast=function(A){return A===k.NeighborIndex.NORTH_EAST||A===k.NeighborIndex.EAST||A===k.NeighborIndex.SOUTH_EAST};b.isElevationLayerView=x;b.isGroupLayerView=
function(A){return"group"===A?.type};b.isImageryTileLayerView=m;b.isImageryTileRenderInfo=function(A){A=A?.sourceLayerInfo?.data;return null!=A&&"type"in A&&"raster-tile"===A.type};b.isMapTileLayerView=p;b.isNorth=function(A){return A===k.NeighborIndex.NORTH_EAST||A===k.NeighborIndex.NORTH||A===k.NeighborIndex.NORTH_WEST};b.isNorthCorner=function(A){return A===k.NeighborIndex.NORTH_WEST||A===k.NeighborIndex.NORTH_EAST};b.isProjectableRasterLayer=e;b.isRasterTileRenderInfo=function(A){A=A?.sourceLayerInfo?.data;
return A instanceof HTMLImageElement||A instanceof n.ImageWithType||A instanceof HTMLCanvasElement||A instanceof ImageData};b.isSouth=function(A){return A===k.NeighborIndex.SOUTH_EAST||A===k.NeighborIndex.SOUTH||A===k.NeighborIndex.SOUTH_WEST};b.isSurfaceLayerView=function(A){return p(A)||x(A)};b.isTextureTileRenderInfo=function(A){A=A?.sourceLayerInfo?.data;return null!=A&&"type"in A&&"tile-texture"===A.type};b.isTileLayerView=l;b.isVectorTileLayerView=w;b.isVectorTilePerLayerInfo=h;b.isVectorTileRenderInfo=
function(A){return h(A?.sourceLayerInfo)||!!A?.isVTLBackground};b.isWMTSLayerView=v;b.isWest=function(A){return A===k.NeighborIndex.NORTH_WEST||A===k.NeighborIndex.WEST||A===k.NeighborIndex.SOUTH_WEST};b.isWestCorner=function(A){return A===k.NeighborIndex.NORTH_WEST||A===k.NeighborIndex.SOUTH_WEST};b.lij2s=function(A){return"["+A[0]+","+A[1]+","+A[2]+"]"};b.neighborCornerIndices=q;b.neighborEdgeIndices=g;b.oppositeCorner=function(A){return A===k.NeighborIndex.NORTH_EAST?k.NeighborIndex.SOUTH_WEST:
A===k.NeighborIndex.NORTH_WEST?k.NeighborIndex.SOUTH_EAST:A===k.NeighborIndex.SOUTH_WEST?k.NeighborIndex.NORTH_EAST:k.NeighborIndex.NORTH_WEST};b.oppositeEdge=function(A){return A===k.NeighborIndex.NORTH?k.NeighborIndex.SOUTH:A===k.NeighborIndex.EAST?k.NeighborIndex.WEST:A===k.NeighborIndex.SOUTH?k.NeighborIndex.NORTH:k.NeighborIndex.EAST};b.releaseTileData=function(A){null!=A&&"release"in A&&A.release();return null};b.test=z;b.useFetchTileForLayer=function(A){return A.fetchTile&&!1!==A.hasOverriddenFetchTile};
b.v32s=function(A){return"("+A[0]+","+A[1]+","+A[2]+")"};b.vtlAssumes256PixelSizeAsDefault=u;b.weakAssert=function(A,C){A||console.warn("Terrain: "+C)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/ITile":function(){define(["exports"],function(b){b.TileFrustumVisibility=void 0;(function(a){a[a.INSIDE=0]="INSIDE";a[a.INTERSECTS=1]="INTERSECTS";a[a.OUTSIDE=2]="OUTSIDE"})(b.TileFrustumVisibility||(b.TileFrustumVisibility={}));b.NeighborIndex=void 0;(function(a){a[a.NORTH=
0]="NORTH";a[a.NORTH_EAST=1]="NORTH_EAST";a[a.EAST=2]="EAST";a[a.SOUTH_EAST=3]="SOUTH_EAST";a[a.SOUTH=4]="SOUTH";a[a.SOUTH_WEST=5]="SOUTH_WEST";a[a.WEST=6]="WEST";a[a.NORTH_WEST=7]="NORTH_WEST"})(b.NeighborIndex||(b.NeighborIndex={}));Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/terrainUtilsPlanar":function(){define("exports ../core/Error ./vec3 ./vec3f64 ../geometry/projection ../geometry/support/aaBoundingRect ../views/3d/terrain/TerrainConst ../views/3d/terrain/TilingScheme".split(" "),
function(b,a,c,d,f,n,k,g){function q(h,t,r=0){h=h.extent;return null==h?!1:0===r?n.containsPoint(h,t):n.containsPointWithMargin(h,t,r*Math.min(h[2]-h[0],h[3]-h[1]))}function e(h,t,r,u){c.copy(w,r);w[u]=t[u];u=c.subtract(w,w,t);var y=c.subtract(v,h,t);y=c.dot(y,u);const z=c.dot(u,u);t=0>=y?t:z<=y?r:c.add(w,t,c.scale(u,u,y/z));h=c.subtract(w,h,t);return Math.PI/2-Math.atan(h[2]/Math.sqrt(h[0]*h[0]+h[1]*h[1]))}function m(h,t,r){h=h.extent;if(null==h)return 0;x[0]=h[0];x[1]=h[1];x[2]=r;p[0]=h[2];p[1]=
h[3];p[2]=r;h=r=Infinity;t[0]<x[0]?r=e(t,x,p,0):t[0]>p[0]&&(r=e(t,p,x,0));t[1]<x[1]?h=e(t,x,p,1):t[1]>p[1]&&(h=e(t,p,x,1));return Math.min(r,h)}function l(h,t,r){if(null==h)return g.getMissingTileInfoError();if(h.spatialReference.isGeographic&&!f.canProjectToWGS84ComparableLonLat(h.spatialReference))return new a("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");var u=g.TilingScheme.checkUnsupported(h);if(null!=u)return u;if(null==
r)return new a("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");{var y=h.lods;u=y[0].resolution*2**y[0].level;var z=[u*h.size[0],u*h.size[1]];const A=[h.origin.x,h.origin.y];r=n.fromExtent(r);const C=n.create();g.TilingScheme.computeRowColExtent(r,z,A,C);z=(C[2]-C[0])*(C[3]-C[1]);z>k.maxRootTiles?(y=y[0].scale*2**y[0].level,u=Math.max((r[3]-r[1])/h.size[1],(r[2]-r[0])/h.size[0])*y/u,r=Math.floor(Math.log(u)/Math.log(10)),u=Math.ceil(u/10**r)*10**r,u=new a("tilingscheme:too-many-root-tiles",
"Scale of level 0 of the tiling scheme (1:"+Math.floor(y).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+u.toLocaleString()+".",{level0Scale:y,suggestedLevel0Scale:u,requiredNumRootTiles:z,allowedNumRootTiles:k.maxRootTiles})):u=null}if(u)return u;h=h.spatialReference;return null==t||h.equals(t)||t.isWGS84&&h.isWebMercator?null:new a("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene")}const w=d.create(),
v=d.create(),x=d.create(),p=d.create();d=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:l,isInsideExtent:q,tiltToExtentEdge:m},Symbol.toStringTag,{value:"Module"}));b.checkIfTileInfoSupportedForViewSR=l;b.isInsideExtent=q;b.terrainUtilsPlanar=d;b.tiltToExtentEdge=m})},"esri/chunks/terrainUtilsSpherical":function(){define(["exports","../core/Error","../geometry/projection","../geometry/support/spatialReferenceUtils","../views/3d/terrain/TilingScheme"],function(b,
a,c,d,f){function n(){return!0}function k(){return 0}function g(e,m){if(null==e)return f.getMissingTileInfoError();const l=e.lods.length-1,w=e.spatialReference,v=c.canProjectToWGS84ComparableLonLat(w)||d.isMars(w)||d.isMoon(w);if(w.isWebMercator){if(!f.TilingScheme.makeWebMercatorAuxiliarySphere(l).compatibleWith(e))return new a("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else if(v){if(!f.TilingScheme.makeGCSWithTileSize(e.spatialReference,
e.size[0],l).compatibleWith(e))return e.spatialReference.isWGS84?new a("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new a("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}else return new a("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(null!=m&&!e.spatialReference.equals(m))return new a("tilingscheme:spatial-reference-mismatch",
"The tiling scheme does not match the spatial reference of the global scene")}const q=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:g,isInsideExtent:n,tiltToExtentEdge:k},Symbol.toStringTag,{value:"Module"}));b.checkIfTileInfoSupportedForViewSR=g;b.isInsideExtent=n;b.terrainUtilsSpherical=q;b.tiltToExtentEdge=k})},"esri/views/3d/support/SharedSymbolResources":function(){define("exports ../../../core/arrayUtils ../../../core/Handles ../../../core/handleUtils ../../../core/maybe ../../../core/reactiveUtils ../../../geometry/ellipsoidUtils ../layers/graphics/ObjectResourceCache ./index ./StreamTextureCollection ../webgl-engine/lib/screenSizePerspectiveUtils".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m){class l{constructor(v){this.streamDataRequester=null;this._graphicsOwners=[];this.cimSymbolRasterizer=this._screenSizePerspectiveHandles=null;this._viewState=v.viewState;this._view=v.view;this._pointsOfInterest=v.pointsOfInterest;this.streamDataRequester=v.resourceController.createStreamDataRequester(q.ClientType.SYMBOLOGY);this.objectResourceCache=new g.ObjectResourceCache((p,h)=>v.resourceController.memoryController.newCache(p,h));this.textures=new e.StreamTextureCollection(this.streamDataRequester,
v.view._stage,v.resourceController.scheduler);const x=k.getReferenceEllipsoid(this._view.spatialReference).radius;this.screenSizePerspectiveSettings=m.getSettings(v.viewingMode,x);this.screenSizePerspectiveSettingsLabels=m.getLabelSettings(v.viewingMode,x)}destroy(){this.textures.destroy();this.streamDataRequester=null}addGraphicsOwner(v){if(!v)return d.makeHandle();this._graphicsOwners.push(v);const x=n.watch(()=>v.layer?.screenSizePerspectiveEnabled,()=>this._updateScreenSizePerspectiveEnabled());
this._updateScreenSizePerspectiveEnabled();return d.makeHandle(()=>{x.remove();a.removeUnordered(this._graphicsOwners,v);this._updateScreenSizePerspectiveEnabled()})}_updateScreenSizePerspectiveEnabled(){var v=this._graphicsOwners.some(x=>!0===x.layer?.screenSizePerspectiveEnabled);v&&!this._screenSizePerspectiveHandles?(this._screenSizePerspectiveHandles=new c,v=()=>this._updateScreenSizePerspectiveSettings(),this._screenSizePerspectiveHandles.add([n.watch(()=>this._pointsOfInterest.centerOnSurfaceInfrequent.distance,
v,n.sync),this._viewState.events.on("camera-projection-changed",v)]),this._updateScreenSizePerspectiveSettings()):v||(this._screenSizePerspectiveHandles=f.destroyMaybe(this._screenSizePerspectiveHandles))}_updateScreenSizePerspectiveSettings(){w.distance=this._pointsOfInterest.centerOnSurfaceInfrequent.distance;w.fovY=this._viewState.camera.fovY;this.screenSizePerspectiveSettings.update(w);this.screenSizePerspectiveSettingsLabels.update(w);this._view._stage.renderView.requestRender()}get test(){return{screenSizePerspectiveHandles:this._screenSizePerspectiveHandles}}}
const w={distance:0,fovY:0};b.SharedSymbolResources=l;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/ObjectResourceCache":function(){define("exports ../../../../core/maybe ../../../../core/promiseUtils ../../glTF/DefaultLoadingContext ../../glTF/loader ./wosrLoader".split(" "),function(b,a,c,d,f,n){class k{constructor(g){this._gltfLoading=new Map;this._wosrLoading=new Map;this._gltfMemCache=g("gltf-resources",()=>{});this._wosrMemCache=g("wosr-resources",
()=>{})}destroy(){this._gltfLoading.forEach(g=>g.abortController.abort());this._wosrLoading.forEach(g=>g.abortController.abort());this._gltfMemCache.destroy();this._wosrMemCache.destroy()}loadGLTF(g,q,e){const m=e?`gltfPBR:${g}`:`gltf:${g}`,l=this._gltfMemCache.get(m);return null!=l?Promise.resolve(l):this._loadOnce(this._gltfLoading,this._gltfMemCache,m,w=>f.loadGLTF(new d.DefaultLoadingContext(w.streamDataRequester),g,w,e),q)}loadWOSR(g,q){const e=`wosr:${g}:${q.disableTextures}`,m=this._wosrMemCache.get(e);
return null!=m?Promise.resolve(m):this._loadOnce(this._wosrLoading,this._wosrMemCache,e,l=>n.load(g,l),q)}async _loadOnce(g,q,e,m,l){c.throwIfAborted(l);const w=c.onAbort(l,()=>this._abortLoad(g,e));var v=g.get(e);v?v.refCount++:(v=new AbortController,m=m({...l,signal:v.signal}),v={refCount:1,abortController:v,promise:m},g.set(e,v));try{const x=await v.promise;q.put(e,x,x.size);g.delete(e);c.throwIfAborted(l);return x}finally{a.removeMaybe(w)}}_abortLoad(g,q){const e=g.get(q);null!=e&&0<--e.refCount||
(g.delete(q),null!=e&&e.abortController.abort())}}b.ObjectResourceCache=k;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/StreamTextureCollection":function(){define("exports ../../../core/promiseUtils ../../../core/urlUtils ./TextureCollection ../webgl-engine/lib/Texture ../../webgl/enums".split(" "),function(b,a,c,d,f,n){class k extends d.TextureCollection{constructor(g,q,e){super(q,e);this._streamDataRequester=g}async fromUrl(g,q,e){a.throwIfAborted(e);e=null!=
e?e.signal:null;const m=this.makeUid(g,q);let l=this._textureRequests.get(m);if(!l){const w=new AbortController,v=this._streamDataRequester.request(g,"image",{uid:m,signal:w.signal});l=new d.TextureRequest;l.abortController=w;const x=l;this._textureRequests.set(m,l);l.textureAsync=v.then(async p=>{p=this._createTexture(g,p,q);x.texture=p;x.abortController=null;await p.load(this._stage.renderView.renderingContext);this._stage.add(p);return{uid:m,texture:p,release:()=>this._release(m)}},p=>{x.abortController=
null;throw p;})}l.referenceCount++;try{return await a.whenOrAbort(l.textureAsync,e)}catch(w){throw this._release(m),w;}}_createTexture(g,q,e){const m={width:q.width,height:q.height,wrap:{s:n.TextureWrapMode.CLAMP_TO_EDGE,t:n.TextureWrapMode.CLAMP_TO_EDGE},preMultiplyAlpha:!0,reloadable:!0};if(c.isSVG(g)){if(e||0===q.width&&0===q.height)g=q.width?q.height/q.width:1,e=e||64,1<g?(q.width=Math.round(e/g),q.height=e):(q.width=e,q.height=Math.round(e*g));this._stage.renderView?.renderingContext.driverTest.svgPremultipliesAlpha.result&&
(m.preMultiplyAlpha=!1)}return new f.Texture(q,m)}}b.StreamTextureCollection=k;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/TextureCollection":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../support/Scheduler".split(" "),function(b,a,c,d,f,n,
k,g,q){b.TextureCollection=class extends c{constructor(m,l){super({});this._stage=m;this._textureRequests=new Map;this._frameTask=l?.registerTask(q.TaskPriority.TEXTURE_UNLOAD)??q.ImmediateTask}normalizeCtorArgs(){return{}}destroy(){super.destroy();this._frameTask?.remove();this._textureRequests?.forEach(m=>this._releaseTextureRequest(m));this._textureRequests?.clear()}get updating(){return this._frameTask.updating}fromData(m,l){const w=this.makeUid(m);m=this._textureRequests.get(w);m||(m=new e,m.texture=
l(),this._stage&&(m.texture.load(this._stage.renderView.renderingContext),this._stage.add(m.texture)),this._textureRequests.set(w,m));m.referenceCount++;return{uid:w,texture:m.texture,release:()=>this._release(w)}}_release(m){const l=this._textureRequests.get(m);l?(1>l.referenceCount&&console.warn("TextureCollection: reference count is \x3c 1 for "+m),l.referenceCount--,1>l.referenceCount&&this._frameTask.schedule(()=>this._releaseNow(m))):console.warn(`TextureCollection: texture doesn't exist: '${m}'`)}get test(){return{textureRequests:this._textureRequests}}_releaseNow(m){if(this._textureRequests){var l=
this._textureRequests.get(m);!l||0<l.referenceCount||(l.texture?.unload(),this._releaseTextureRequest(l),this._textureRequests.delete(m))}}_releaseTextureRequest(m){m.texture?this._stage?.remove(m.texture):m.abortController&&(m.abortController.abort(),m.abortController=null)}makeUid(m,l=null){return null!=l?`${m}.${l}px`:m}};a.__decorate([d.property()],b.TextureCollection.prototype,"_frameTask",void 0);a.__decorate([d.property()],b.TextureCollection.prototype,"updating",null);b.TextureCollection=
a.__decorate([g.subclass("esri.views.3d.support.TextureCollection")],b.TextureCollection);class e{constructor(){this.referenceCount=0}}b.TextureRequest=e;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/PointsOfInterest":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/ray ../debugFlags ../debugUtils ../PropertiesPool ../geometryUtils/ray ./CameraOnSurface ./CenterOnSurface ./ContentGeometryUpdates ./Focus ./StableSurfaceCenter ./SurfaceGeometryUpdates ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces ../../webgl-engine/lib/verticalOffsetUtils ../../../support/Scheduler".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A,C,E,B,D){b.PointsOfInterest=class extends c{constructor(O){super(O);this._handles=new d;this._tmpRay=w.create();this._centerRayDirty=!0;this._surfaceAltitudeAtCenter=0;this._surfaceAltitudeAtCenterDirty=!0;this._contentAltitudeAtCenter=0;this._contentAltitudeAtCenterDirty=!0;this._propertiesPool=new p.PropertiesPool({renderPointOfView:F},this);this.renderPointOfView=l.create();this._pois=[];this._debugCenters=new Map}initialize(){const {state:O,
basemapTerrain:P,renderCoordsHelper:J,map:R}=this.view;this._surfaceIntersector=C.newIntersector(O.viewingMode);this._surfaceIntersector.options.backfacesTerrain=O.isGlobal?!1:!0;this._surfaceIntersector.options.invisibleTerrain=!1;this._surfaceIntersector.options.store=E.StoreResults.MIN;this._contentIntersector=C.newIntersector(O.viewingMode);var X=()=>this._estimateSurfaceAltitudeAtCenter();const U=this.view.resourceController.scheduler,M=this.view.basemapTerrain?.elevationQueryCache,V={state:O,
scheduler:U,surface:P,renderCoordsHelper:J};this._set("centerOnSurfaceInfrequent",new r.CenterOnSurface({...V,task:D.TaskPriority.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:X}));this._set("centerOnSurfaceFrequent",new r.CenterOnSurface({...V,task:D.TaskPriority.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:X}));this._set("centerOnContent",new r.CenterOnSurface({...V,task:D.TaskPriority.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()}));
this._set("cameraOnSurface",new t.CameraOnSurface({...V,cache:M,task:D.TaskPriority.POINT_OF_INTEREST_INFREQUENT,map:R}));this._set("surfaceGeometryUpdates",new A.SurfaceGeometryUpdates({...V,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]}));this._set("contentGeometryUpdates",new u.ContentGeometryUpdates({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:J}));this._set("surfaceOrigin",new z.StableSurfaceCenter({cache:M,view:this.view}));
this._set("focus",new y.Focus({state:O,scheduler:U,surface:P,renderCoordsHelper:J,centerOnSurface:this.centerOnSurfaceFrequent,estimateSurfaceIntersectionAtRenderPoint:(Y,W)=>this._estimateSurfaceIntersectionAtRenderPoint(Y,this.view.state.contentCamera,W)}));this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.cameraOnSurface,this.focus);X=this.view.graphics;this._debugCenters.set(this.centerOnContent,new x.PointGraphics(X,"red","CenterOnContent"));
this._debugCenters.set(this.centerOnSurfaceFrequent,new x.PointGraphics(X,"red","CenterOnSurface"));this._debugCenters.set(this.centerOnSurfaceInfrequent,new x.PointGraphics(X,"red","CenterOnSurface"));this._debugCenters.set(this.cameraOnSurface,new x.PointGraphics(X,"blue","CameraOnSurface"));this._debugCenters.set(this.focus,new x.PointGraphics(X,"green","Focus"));this._handles.add([f.watch(()=>O.contentCamera,Y=>this._cameraChanged(Y),f.sync),f.watch(()=>P.extent,()=>this._updateCenterPointsOfInterest()),
f.when(()=>!P.updating,()=>this._updateCenterPointsOfInterest(),f.sync),f.on(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),f.on(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),f.when(()=>v.debugFlags.SHOW_POI,Y=>this._setDebug(Y),f.initial)]);this._cameraChanged(this.view.state.contentCamera);for(const Y of this._pois)Y.runTask()}destroy(){this._setDebug(!1);this._handles.destroy();this._propertiesPool.destroy();
for(const O of this._pois)O.destroy();this.surfaceOrigin.destroy()}get updating(){return!(!this.surfaceGeometryUpdates?.updating&&!this._pois.some(O=>O.updating))}get _centerRay(){this._centerRayDirty&&(this._centerRayCached=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.contentCamera,this._tmpRay),this._centerRayDirty=!1);return this._centerRayCached}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=
!1;const O=this._centerRay;if(null==O)return this._contentAltitudeAtCenter;this.view.sceneIntersectionHelper.intersectRay(O,this._contentIntersector,K,G)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(K):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter();return this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=
!1;const O=this._centerRay;if(null==O)return this._surfaceAltitudeAtCenter;const P=O.origin,J=m.add(K,O.origin,O.direction);this._surfaceIntersector.resetWithRay(O,this.view.state.contentCamera);this.view.basemapTerrain.intersect(this._surfaceIntersector,null,P,J);this._surfaceIntersector.results.min.getIntersectionPoint(K)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(K));return this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(O,P,J){O=h.fromRenderAtEye(P,
O,L);if(null==O)return null;const R=O.origin,X=m.add(K,O.origin,O.direction);this._surfaceIntersector.resetWithRay(O,P);this.view.basemapTerrain.intersect(this._surfaceIntersector,null,R,X);return this._surfaceIntersector.results.min.getIntersectionPoint(J)?J:null}_cameraChanged(O){this._updateCenterPointsOfInterest();O=O.eye;m.exactEquals(this.renderPointOfView,O)||this._set("renderPointOfView",m.copy(this._propertiesPool.get("renderPointOfView"),O))}_updateCenterPointsOfInterest(){this._contentAltitudeAtCenterDirty=
this._surfaceAltitudeAtCenterDirty=this._centerRayDirty=!0;for(const O of this._pois)O.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0;this.centerOnContent.updateRenderLocation()}_setDebug(O){if(O)for(const P of this._pois)this._handles.add(f.watch(()=>P.renderLocation,J=>this._debugCenters.get(P)?.show(J,P.renderCoordsHelper.spatialReference),f.initial),"debug");else this._debugCenters.forEach(P=>P.hide()),this._handles.remove("debug")}get test(){return{update:()=>
{this.surfaceGeometryUpdates.runTask();for(const O of this._pois)O.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}};a.__decorate([n.property({readOnly:!0})],b.PointsOfInterest.prototype,"centerOnContent",void 0);a.__decorate([n.property({readOnly:!0})],b.PointsOfInterest.prototype,"centerOnSurfaceFrequent",void 0);a.__decorate([n.property({readOnly:!0})],b.PointsOfInterest.prototype,"centerOnSurfaceInfrequent",void 0);a.__decorate([n.property({readOnly:!0})],b.PointsOfInterest.prototype,
"cameraOnSurface",void 0);a.__decorate([n.property({readOnly:!0})],b.PointsOfInterest.prototype,"focus",void 0);a.__decorate([n.property({readOnly:!0})],b.PointsOfInterest.prototype,"renderPointOfView",void 0);a.__decorate([n.property({readOnly:!0})],b.PointsOfInterest.prototype,"surfaceOrigin",void 0);a.__decorate([n.property({readOnly:!0})],b.PointsOfInterest.prototype,"contentGeometryUpdates",void 0);a.__decorate([n.property({readOnly:!0})],b.PointsOfInterest.prototype,"surfaceGeometryUpdates",
void 0);a.__decorate([n.property({constructOnly:!0})],b.PointsOfInterest.prototype,"view",void 0);a.__decorate([n.property({readOnly:!0})],b.PointsOfInterest.prototype,"updating",null);b.PointsOfInterest=a.__decorate([e.subclass("esri.views.3d.support.PointsOfInterest")],b.PointsOfInterest);const F=Array,K=l.create(),L=w.create(),G={exclude:new Set([B.terrainId])};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/debugUtils":function(){define("exports ../../../geometry ../../../Graphic ../../../symbols ../../../core/Collection ../../../symbols/PointSymbol3D ../../../symbols/IconSymbol3DLayer ../../../symbols/TextSymbol3DLayer ../../../geometry/Point".split(" "),
function(b,a,c,d,f,n,k,g,q){class e{constructor(m,l,w=""){this.graphics=m;this._symbol=new n({symbolLayers:new f([new k({material:{color:l},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new g({text:w,halo:{color:"white",size:1/.75},material:{color:l},size:12})])})}show(m,l){null!=l&&(this.hide(),m=new q({x:m[0],y:m[1],z:m[2],spatialReference:l}),this._graphic=new c({geometry:m,symbol:this._symbol}),this.graphics.add(this._graphic))}hide(){null!=this._graphic&&(this.graphics.remove(this._graphic),
this._graphic=null)}}b.PointGraphics=e;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/CameraOnSurface":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/Point ../../../ViewingMode ../cameraUtils ../PropertiesPool ./PointOfInterest ../../../support/Scheduler".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t){const r=Array;b.CameraOnSurface=class extends h.PointOfInterest{constructor(y){super(y);this._dirty=!1;this._propertiesPool=new p.PropertiesPool({location:w,renderLocation:r},this);this._estimatedSurfaceAltitude=0;this._pendingElevationQueryController=null;this.renderLocation=l.create();this._tmpPoint=new w}initialize(){this.scheduler&&this.addHandles(this.scheduler.registerTask(this.task,this));this.runTask();if(this.map){const y=()=>this._setDirty();
this.addHandles(f.on(()=>this.map?.ground?.layers,"change",y,{onListenerAdd:y,onListenerRemove:y}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest();this._propertiesPool=c.destroyMaybe(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const y=this._propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,y,this.state.spatialReference);return y}get scale(){const y=this._camera,z=m.distance(y.eye,this.renderLocation);
return x.distanceToScale({renderCoordsHelper:this.renderCoordsHelper,state:{camera:y}},z,0)}get updating(){return this._dirty||null!=this._pendingElevationQueryController}updateRenderLocation(){this._setDirty();this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const y=this._pendingElevationQueryController;y&&(this._pendingElevationQueryController=null,y.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&
this._dirty}runTask(){this._cancelPendingRequest();this._dirty=!1;this.notifyChange("updating");if(!this.map?.ground)return this._updateSurfaceAltitude(0),t.Task.YIELD;var y=this.state.spatialReference;this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this._tmpPoint,y);y=1E5<(this._tmpPoint.z??0)&&this.renderCoordsHelper.viewingMode===v.ViewingMode.Global&&(y.isWGS84||y.isWebMercator);let z=new AbortController;this.map.ground.queryElevation(this._tmpPoint,{signal:z.signal,cache:this.cache,
minDemResolution:y?1E6:0}).then(A=>this._updateSurfaceAltitude(A.geometry.z??0)).catch(A=>{d.isAbortError(A)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===z&&(this._pendingElevationQueryController=null,this.notifyChange("updating"));z=null});this._pendingElevationQueryController=z;return t.Task.YIELD}_updateSurfaceAltitude(y){this._estimatedSurfaceAltitude!==y&&(this._estimatedSurfaceAltitude=y,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(u,
this._estimatedSurfaceAltitude,this._camera.eye);m.exactEquals(this._get("renderLocation"),u)||(this._set("renderLocation",m.copy(this._propertiesPool.get("renderLocation"),u)),this.notifyChange("renderLocation"))}};a.__decorate([n.property({constructOnly:!0})],b.CameraOnSurface.prototype,"scheduler",void 0);a.__decorate([n.property({constructOnly:!0})],b.CameraOnSurface.prototype,"cache",void 0);a.__decorate([n.property({constructOnly:!0})],b.CameraOnSurface.prototype,"task",void 0);a.__decorate([n.property({readOnly:!0})],
b.CameraOnSurface.prototype,"location",null);a.__decorate([n.property({constructOnly:!0})],b.CameraOnSurface.prototype,"map",void 0);a.__decorate([n.property({readOnly:!0})],b.CameraOnSurface.prototype,"renderLocation",void 0);a.__decorate([n.property({readOnly:!0})],b.CameraOnSurface.prototype,"scale",null);a.__decorate([n.property({readOnly:!0})],b.CameraOnSurface.prototype,"updating",null);b.CameraOnSurface=a.__decorate([e.subclass("esri.views.3d.support.CameraOnSurface")],b.CameraOnSurface);const u=
l.create();Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/PointOfInterest":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass".split(" "),function(b,a,c,d,f,n,k,g){b.PointOfInterest=class extends c{constructor(q){super(q)}};
a.__decorate([d.property({constructOnly:!0})],b.PointOfInterest.prototype,"renderCoordsHelper",void 0);a.__decorate([d.property({constructOnly:!0})],b.PointOfInterest.prototype,"surface",void 0);a.__decorate([d.property({constructOnly:!0})],b.PointOfInterest.prototype,"state",void 0);b.PointOfInterest=a.__decorate([g.subclass("esri.views.3d.support.PointOfInterest")],b.PointOfInterest);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/CenterOnSurface":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/mathUtils ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/ellipsoidUtils ../../../../geometry/Point ../../../../geometry/projection/projectBoundingRect ../../../../geometry/support/aaBoundingRect ../debugFlags ../PropertiesPool ./PointOfInterest ../../../support/Scheduler".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r){const u=Array;b.CenterOnSurface=class extends t.PointOfInterest{constructor(C){super(C);this._propertiesPool=new h.PropertiesPool({location:w,renderLocation:u},this);this.distance=this._latestSurfaceAltitude=this._currentSurfaceAltitude=0;this.renderLocation=m.create();this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this);this.runTask()}destroy(){this._frameWorker=d.removeMaybe(this._frameWorker);this._propertiesPool=
d.destroyMaybe(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const C=this._propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,C,this.state.spatialReference);return C}updateRenderLocation(){this.updating=!0;this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter();this._updateRenderLocation();
this.updating=!1;return r.Task.YIELD}_updateRenderLocation(){const C=y;let E=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,C);var B=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!E&&B&&(E=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,C))&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude);B=z;E&&this._latestSurfaceAltitudeChangesDistanceSignificantly(C,B)&&(e.copy(C,B),this._currentSurfaceAltitude=this._latestSurfaceAltitude);E?this.distance=
e.distance(this._camera.eye,C):(e.scale(C,this._camera.viewForward,this._get("distance")),e.add(C,C,this._camera.eye));e.exactEquals(this._get("renderLocation"),C)||this._set("renderLocation",e.copy(this._propertiesPool.get("renderLocation"),C))}_calculateSurfaceIntersection(C,E){var B=this._camera;if(!this.renderCoordsHelper.intersectInfiniteManifold(B.ray,C,E))return!1;if(this.state.isGlobal){const D=l.getReferenceEllipsoid(this.renderCoordsHelper.spatialReference).radius;C=D+C;const F=e.squaredLength(B.eye),
K=F<C*C,L=e.distance(B.eye,E);K&&L>D/4&&(e.scale(E,B.viewForward,C-Math.sqrt(F)),e.add(E,E,B.eye))}else B=this.surface?.ready?this.surface.extent:null,null!=B&&v.projectBoundingRect(B,this.surface?.spatialReference,A,this.renderCoordsHelper.spatialReference)&&(E[0]=c.clamp(E[0],A[0],A[2]),E[1]=c.clamp(E[1],A[1],A[3]));return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(C,E){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||null==C)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,
E)){if(p.debugFlags.TESTS_DISABLE_OPTIMIZATIONS)return!0;const B=this._camera.eye;C=e.distance(B,C);E=e.distance(B,E);if(.05<Math.abs(E-C)/C)return!0}return!1}};a.__decorate([f.property({constructOnly:!0})],b.CenterOnSurface.prototype,"scheduler",void 0);a.__decorate([f.property({constructOnly:!0})],b.CenterOnSurface.prototype,"task",void 0);a.__decorate([f.property()],b.CenterOnSurface.prototype,"distance",void 0);a.__decorate([f.property({constructOnly:!0})],b.CenterOnSurface.prototype,"estimateSurfaceAltitudeAtCenter",
void 0);a.__decorate([f.property({readOnly:!0})],b.CenterOnSurface.prototype,"location",null);a.__decorate([f.property({readOnly:!0})],b.CenterOnSurface.prototype,"renderLocation",void 0);a.__decorate([f.property()],b.CenterOnSurface.prototype,"updating",void 0);b.CenterOnSurface=a.__decorate([q.subclass("esri.views.3d.support.CenterOnSurface")],b.CenterOnSurface);const y=m.create(),z=m.create(),A=x.create();Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/ContentGeometryUpdates":function(){define(["exports",
"../../../../core/Evented","../../../../core/Handles","../../../../core/maybe"],function(b,a,c,d){class f{constructor(k){this._handles=new c;this.events=new a;this._contentLayerViews=k.contentLayerViews;this._handles.add(this._contentLayerViews.on("change",g=>this._layerViewsChanged(g)));this._layerViewsChanged({added:this._contentLayerViews.toArray(),removed:[],moved:[],target:this._contentLayerViews})}destroy(){this._handles=d.destroyMaybe(this._handles);this._contentLayerViews.destroy()}_layerViewsChanged(k){k.added.forEach(g=>
{"esri.views.3d.layers.SceneLayerView3D"===g.declaredClass&&this._handles.add(g.on("visible-geometry-changed",()=>this._contentChanged()),g.uid)});k.removed.forEach(g=>this._handles.remove(g.uid))}_contentChanged(){this.events.emit("request-update",n)}}const n={};b.ContentGeometryUpdates=f;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/Focus":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/mathUtils ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/Point ../../../../geometry/support/ray ../PropertiesPool ./PointOfInterest ../../webgl-engine/lib/Camera ../../../support/Scheduler".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r){const u=Array;b.Focus=class extends h.PointOfInterest{constructor(C){super(C);this._propertiesPool=new p.PropertiesPool({location:v,renderLocation:u},this);this._dirty=!0;this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.addHandles([f.watch(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),f.watch(()=>this.state.contentCamera,()=>this.updateRenderLocation())]);this.scheduler&&this.addHandles(this.scheduler.registerTask(r.TaskPriority.POINT_OF_INTEREST_FREQUENT,
this))}destroy(){this._propertiesPool=d.destroyMaybe(this._propertiesPool)}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const C=this._propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,C,this.state.spatialReference);return C}get running(){return this._dirty}runTask(){var C=this._get("renderLocation");const E=this.centerOnSurface.renderLocation;var B=this.renderCoordsHelper,D=this.state.contentCamera;this._dirty=!1;B.worldUpAtPosition(E,
y);B=Math.max(0,(Math.acos(l.dot(y,D.viewForward))-.5*Math.PI)*(D.aboveGround?1:-1));if(Number.isNaN(B))return C&&l.equals(C,E)||(C=this._propertiesPool.get("renderLocation"),l.copy(C,E),this._set("renderLocation",C)),r.Task.YIELD;B=1-c.clamp(B/(.5*Math.PI),0,1);B*=B*B;this._calculateScreenHorizontalEdgeOnSurface(A);D=this._propertiesPool.get("renderLocation");l.lerp(D,E,A,B);C&&l.equals(C,D)||this._set("renderLocation",D);return r.Task.YIELD}_calculateScreenHorizontalEdgeOnSurface(C){const E=this.state.contentCamera;
var B=E.getRenderCenter(n.createRenderScreenPointArray3());B[1]=E.aboveGround?E.padding[t.PaddingSide.BOTTOM]:E.fullHeight-E.padding[t.PaddingSide.TOP];if(this.estimateSurfaceIntersectionAtRenderPoint(B,C))return C;const D=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);return E.unprojectFromRenderScreen(B,z)&&(l.subtract(z,z,E.eye),B=l.normalize(z,z),this.renderCoordsHelper.intersectInfiniteManifold(x.wrap(E.eye,B),D,C))?C:this.renderCoordsHelper.setAltitude(C,D,E.eye)}updateRenderLocation(){this._dirty=
!0}};a.__decorate([k.property()],b.Focus.prototype,"_dirty",void 0);a.__decorate([k.property({constructOnly:!0})],b.Focus.prototype,"scheduler",void 0);a.__decorate([k.property({constructOnly:!0})],b.Focus.prototype,"centerOnSurface",void 0);a.__decorate([k.property({constructOnly:!0})],b.Focus.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0);a.__decorate([k.property({readOnly:!0})],b.Focus.prototype,"updating",null);a.__decorate([k.property({readOnly:!0})],b.Focus.prototype,"location",
null);a.__decorate([k.property({readOnly:!0})],b.Focus.prototype,"renderLocation",void 0);b.Focus=a.__decorate([m.subclass("esri.views.3d.support.pointsOfInterest.Focus")],b.Focus);const y=w.create(),z=w.create(),A=w.create();Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/StableSurfaceCenter":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3f64 ../../../../geometry/Point ../../../../geometry/support/aaBoundingRect".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w){b.StableSurfaceCenter=class extends c{get surface(){return this.view.map?.ground}get surfaceView(){return this.view.basemapTerrain}get renderLocation(){if(!this.location)return null;const v=m.create();this.view.renderCoordsHelper.toRenderCoords(this.location,v);return v}constructor(v){super(v);this._updateController=this.location=null}initialize(){this.view.state.isLocal&&(this.addHandles([f.watch(()=>[this.surfaceView?.spatialReference,this.surfaceView?.extent],
()=>this._update()),f.on(()=>this.surface?.layers,"change",()=>this._update())]),this._update())}_update(){this._updateController&&(this._updateController.abort(),this._updateController=null);if(null==this.surfaceView?.extent||null==this.surfaceView.spatialReference)this._set("location",null);else{var v=w.center(this.surfaceView.extent);v=new l({x:v[0],y:v[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&0<this.surface.layers.length?(this._set("location",null),this._updateController=
new AbortController,this.surface.queryElevation(v,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(x=>{this._updateController=null;this._set("location",x.geometry)}).catch(x=>{d.isAbortError(x)||x&&"elevation-query:invalid-layer"===x.name||console.error("StableSurfaceCenter failed to update: ",x)})):this._set("location",v)}}};a.__decorate([n.property({constructOnly:!0})],b.StableSurfaceCenter.prototype,"view",void 0);a.__decorate([n.property({constructOnly:!0})],b.StableSurfaceCenter.prototype,
"cache",void 0);a.__decorate([n.property()],b.StableSurfaceCenter.prototype,"surface",null);a.__decorate([n.property()],b.StableSurfaceCenter.prototype,"surfaceView",null);a.__decorate([n.property({readOnly:!0})],b.StableSurfaceCenter.prototype,"location",void 0);a.__decorate([n.property({readOnly:!0})],b.StableSurfaceCenter.prototype,"renderLocation",null);b.StableSurfaceCenter=a.__decorate([e.subclass("esri.views.3d.terrain.StableSurfaceCenter")],b.StableSurfaceCenter);Object.defineProperty(b,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/SurfaceGeometryUpdates":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingRect ../../../support/Scheduler".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l){b.SurfaceGeometryUpdates=class extends c{constructor(h){super(h);this._tileGeometryUpdateExtent=m.empty();this._tileGeometryUpdateSpatialReference=null;this.events=new d;this.updating=!1}initialize(){this.addHandles([this.surface.on("elevation-change",h=>this._tileGeometryChanged(h)),this.scheduler.registerTask(l.TaskPriority.SURFACE_GEOMETRY_UPDATES,this)])}get running(){return this.updating}runTask(){if(!this.updating)return l.Task.YIELD;this._tileGeometryUpdateSpatialReference&&
this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",w);m.empty(this._tileGeometryUpdateExtent);this._set("updating",!1);return l.Task.YIELD}_tileGeometryChanged(h){this._tileGeometryUpdateSpatialReference=h.spatialReference;m.expand(this._tileGeometryUpdateExtent,h.extent,this._tileGeometryUpdateExtent);this._set("updating",!0)}_furthestCenterOnSurface(){let h=this.centerOnSurfaces[0];for(let t=1;t<this.centerOnSurfaces.length;t++){const r=
this.centerOnSurfaces[t];r.distance>h.distance&&(h=r)}return h}_centerIntersectsExtent(h,t){const r=this.state.contentCamera.eye,u=p,y=this._furthestCenterOnSurface();this.renderCoordsHelper.fromRenderCoords(r,v,t);this.renderCoordsHelper.fromRenderCoords(y.renderLocation,x,t);v[0]<x[0]?(u[0]=v[0],u[2]=x[0]):(u[0]=x[0],u[2]=v[0]);v[1]<x[1]?(u[1]=v[1],u[3]=x[1]):(u[1]=x[1],u[3]=v[1]);return m.intersects(u,h)}};a.__decorate([f.property({constructOnly:!0})],b.SurfaceGeometryUpdates.prototype,"state",
void 0);a.__decorate([f.property({constructOnly:!0})],b.SurfaceGeometryUpdates.prototype,"centerOnSurfaces",void 0);a.__decorate([f.property({constructOnly:!0})],b.SurfaceGeometryUpdates.prototype,"renderCoordsHelper",void 0);a.__decorate([f.property({constructOnly:!0})],b.SurfaceGeometryUpdates.prototype,"scheduler",void 0);a.__decorate([f.property({constructOnly:!0})],b.SurfaceGeometryUpdates.prototype,"surface",void 0);a.__decorate([f.property({readOnly:!0})],b.SurfaceGeometryUpdates.prototype,
"updating",void 0);b.SurfaceGeometryUpdates=a.__decorate([q.subclass("esri.views.3d.support.SurfaceGeometryUpdates")],b.SurfaceGeometryUpdates);const w={},v=e.create(),x=e.create(),p=m.empty();Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TerrainSurface":function(){define("require ../../../chunks/tslib.es6 ../../../Color ../../../core/Accessor ../../../core/arrayUtils ../../../core/CollectionFlattener ../../../core/Evented ../../../core/Logger ../../../core/mathUtils ../../../core/maybe ../../../core/MemCachePool ../../../core/ObjectPool ../../../core/PooledArray ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4f64 ../../../core/support/UpdatingHandles ../../../geometry/ellipsoidUtils ../../../geometry/SpatialReference ../../../geometry/projection/projectPointToVector ../../../geometry/projection/projectVectorToVector ../../../geometry/support/aaBoundingRect ../../../geometry/support/frustum ../../../geometry/support/spatialReferenceUtils ../../../layers/mixins/RefreshableLayer ../../../layers/support/ElevationQueryTileCache ../../../layers/support/ElevationTileData ../../../layers/support/layerUtils ../../../layers/support/LercDecoder ../../2d/engine/vectorTiles/VectorTile ../support/cameraUtils ../support/debugFlags ../support/extentUtils ../support/index ../support/updatingProperties ./ElevationBounds ./ElevationData ./ExtentHelper ./interfaces ./LayerClass ./OverlayManager ./PlanarPatch ./RenderOrder ./ScaleRangeQueries ./SphericalPatch ./SplitLimits ./TerrainConst ./TerrainRenderer ./TerrainSurfacePerformanceInfo ./terrainUtils ./Tile ./TilePerLayerInfo ./TileUpdate ./tileUtils ./TilingSchemeLogic ./UpsampleInfo ../webgl-engine/core/shaderLibrary/output/BlendOptions ../webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../webgl-engine/lib/basicInterfaces ../../support/RenderState ../../support/Scheduler".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A,C,E,B,D,F,K,L,G,O,P,J,R,X,U,M,V,Y,W,H,S,I,Q,N,T,aa,Z,da,fa,ka,ha,ba,ea,ca,ia,la,oa,na,ra,ta,ma,pa,ja,qa,ua,wa,za){function Aa(sa,va){return sa[0]===va[0]&&sa[1]===va[1]&&sa[2]===va[2]}function Fa(sa){sa=sa.children;if(!sa[0])return!1;for(const va of sa)if(va.shouldLoad)return!0;for(const va of sa)if(Fa(va))return!0;return!1}function Da(sa,va,ya){for(const Ea of sa)if(Ea.containsPointXY(va,ya)){for(sa=Ea;sa&&!sa.renderData;)sa=sa.children[(va>
sa.extentMidX?1:0)+(ya<sa.extentMidY?2:0)];return Q.sampleElevation(va,ya,sa?.renderData?.geometryState.samplerData??null)}return null}var Ha;d=Ha=class extends k.EventedMixin(d){constructor(sa){super(sa);this._scaleRangeQueries=new ka.ScaleRangeQueries;this._iteratorPool=new l(ta.IteratorPreorder,va=>va.remove=()=>this._iteratorPool.release(va));this._postorderIterator=new ta.IteratorPostorder;this._hasPendingUpdates=!1;this._asyncWorkItems=this._pendingUpdates=0;this._allTilesSorted=this._allTilesDirty=
!0;this._usedMemory=null;this._performanceInfo=new ia;this._viewChangeUpdateDirty=this._inFrameTask=this._viewChanged=!1;this._eyePosRenderSR=A.create();this._eyePosSurfaceSR=A.create();this._splitLimits=new ba.SplitLimits;this._frustum=G.create();this._viewProjectionMatrix=y.create();this._layerViews=[[],[]];this._layerIndexByUid=[new Map,new Map];this._basemapLayerViewHandles=new Map;this._watchUpdatingTracking=new E.UpdatingHandles;this._frameTask=za.ImmediateTask;this._allTiles=new w;this._upsampleInfoPool=
new l(pa.UpsampleInfo);this._shouldEmitChangeEvent=!1;this._rootTilesExtent=L.create();this.updatingProgress=.5;this._maxNumUpdating=1;this.maxTextureScale=1.2;this._spatialReference=D.WebMercator;this.visibleElevationBounds=new I.ElevationBounds(Infinity,-Infinity);this.rootTileElevationBounds=new I.ElevationBounds(Infinity,-Infinity);this._updatingRootTiles=!1;this._pendingTilesForElevationUpdateEvent=new Set;this._pendingTilesToUpdate=new Set;this.totalTileUpdates=this.totalGeometryUpdates=0;this._oneBatchPerFrameTask=
!0;this._layerViewsDirty=!1;this.unloadedMemory=0;this._isWebMercatorOnPlateeCarree=this._isWebMercator=this.ignoresMemoryFactor=!1;this.overlayManager=new Z.OverlayManager({...sa,surface:this});this._tileConstructor=(this._isGlobal=!sa.view?.state?.isLocal)?ha.SphericalPatch:da.PlanarPatch}initialize(){const sa=this.view,va=sa.resourceController;this._lercDecoder=U.acquireDecoder(va);const ya=va.memoryController;this._tileCache=new m.MemCachePool((Ja,Ma)=>ya.newCache(Ja,Ma),"terrain-tile");this._upsampleMapCache=
ya.newCache("terrain-upsample",Ja=>Ja.unloadMapData());this._elevationQueryCache=new J.ElevationQueryTileCache(ya.newCache("elevation-query"));const Ea=this.overlayManager;this._renderer=new ca.TerrainRenderer(Ea.renderer,sa._stage,this._allTiles,B.getReferenceEllipsoid(sa.spatialReference).radius,ya);this.addHandles([x.watch(()=>Ea.rendersOccluded,Ja=>this._renderer.setRenderOccludedOverlay(Ja)),x.watch(()=>Ea.renderer.isEmpty,()=>this._evaluateTransparency()),x.watch(()=>this.renderer.visible,Ja=>
this.suspended=!Ja)],"overlayManager");this.addHandles([x.watch(()=>this.baseOpacity,()=>{this._handleLayerViewChanges();this._updateTileTextures(this._evaluateTransparency()?T.TextureUpdate.UNFADED:T.TextureUpdate.IMMEDIATE)},x.syncAndInitial),x.watch(()=>this.hasCompositeBlendMode,()=>this._updateTileTextures(this._evaluateTransparency()?T.TextureUpdate.UNFADED:T.TextureUpdate.IMMEDIATE),x.syncAndInitial),x.watch(()=>this.backgroundColor,(Ja,Ma)=>{Ja?.equals(Ma)||(this._handleLayerViewChanges(),
this._renderer.updateTileBackground(Ja))},x.sync),x.watch(()=>this.snapLevel,()=>this._viewChanged=!0,x.sync),x.watch(()=>this.view.pointsOfInterest,Ja=>{this._renderer.pointsOfInterest=Ja;this._watchUpdatingTracking.removeAll();Ja&&this._watchUpdatingTracking.add(()=>Ja.focus.renderLocation,()=>this._allTilesSorted=!1)}),x.watch(()=>Y.debugFlags.TERRAIN_TILE_TREE_SHOW_TILES,Ja=>{Ja&&!this._treeDebugger?(new Promise((Ma,Ta)=>b(["../layers/support/TerrainTileTree3DDebugger"],Ma,Ta))).then(({TerrainTileTree3DDebugger:Ma})=>
{!this._treeDebugger&&Y.debugFlags.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new Ma({view:sa}))}):Ja||(this._treeDebugger=e.destroyMaybe(this._treeDebugger))},x.initial)]);var {spatialReference:Ca}=sa;this._extentHelper=N.create(this.viewingMode,{layers:sa.map.allLayers,layerViews:sa.allLayerViews,viewSpatialReference:Ca});const Ga=new n({getCollections:()=>sa.defaultsFromMap?.mapCollections?.map(({layers:Ja})=>Ja),getChildrenFunction:Ja=>Ja&&"layers"in Ja?Ja.layers:null});Ca=new ma.TilingSchemeLogic({layers:Ga,
extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:Ca});this._set("tilingSchemeLogic",Ca);this._updateTilingScheme();this._elevationDataRequester=va.createStreamDataRequester(H.ClientType.ELEVATION);this._mapDataRequester=va.createStreamDataRequester(H.ClientType.BASEMAP);this._frameTask=va.scheduler.registerTask(za.TaskPriority.TERRAIN_SURFACE,this);this.addHandles([x.watch(()=>this._extentHelper.stencilEnabledExtents,Ja=>this._renderer.setStencilEnabledLayerExtents(Ja),
x.initial),x.watch(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),x.sync),x.watch(()=>this.extent,()=>this._updateRootTiles(),x.initial),sa.on("resize",()=>this._viewChangeUpdate()),x.watch(()=>{const Ja=sa.state;return[this._lodBias,this.lodSnapping,sa.quality,Ja.camera,Ja.contentCamera,Ja.fixedContentCamera]},()=>this._viewChangeUpdate(),x.syncAndInitial),x.watch(()=>sa.qualitySettings?.tiledSurface?.textureFadeDuration,Ja=>this._renderer.textureFadingEnabled=0<Ja,x.initial),
x.watch(()=>sa.qualitySettings?.physicallyBasedRenderingEnabled,Ja=>this._renderer.pbrMode=Ja?qa.PBRMode.Terrain:qa.PBRMode.Disabled,x.initial),x.watch(()=>this._userClippingExtent,()=>this._updateClippingExtent(),x.sync)]);this.addHandles(sa.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0));this._layerViewsDirty=!0;this._handleLayerViewChanges();this._renderer.updateTileBackground(this.backgroundColor)}destroy(){this._frameTask.remove();this._watchUpdatingTracking.destroy();this._lercDecoder=
e.releaseMaybe(this._lercDecoder);this._removeAllTiles();this._set("tilingSchemeLogic",e.destroyMaybe(this.tilingSchemeLogic));this._basemapLayerViewHandles.forEach((sa,va)=>this._unregisterTiledLayerView(va));this._mapDataRequester=this._elevationDataRequester=null;this._set("overlayManager",e.destroyMaybe(this.overlayManager));this._tileCache=e.destroyMaybe(this._tileCache);oa.Tile.prune();this._treeDebugger=e.destroyMaybe(this._treeDebugger);this._renderer=e.destroyMaybe(this._renderer);this._iteratorPool=
e.destroyMaybe(this._iteratorPool);this._upsampleMapCache=e.destroyMaybe(this._upsampleMapCache);this._elevationQueryCache=e.destroyMaybe(this._elevationQueryCache);this._set("view",null);this._extentHelper=e.destroyMaybe(this._extentHelper);this._upsampleInfoPool=e.destroyMaybe(this._upsampleInfoPool);M.printAllocations();na.printAllocations()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){if(this.lodSnapping===T.LODSnapping.ON){var sa=this.view,va=this.tilingScheme;
const Ea=sa.pointsOfInterest?.cameraOnSurface?.scale;if(va&&Ea){var ya=sa.state.contentCamera;ya=V.directionToHeadingTilt(sa,ya.eye,ya.viewForward,ya.up).tilt;90<ya&&(ya=180-ya);ya=2*(ya/90)**2;va=va.levelAtScale(Ea);sa=Math.min(va-ya+sa.qualitySettings.tiledSurface.lodBias,this._splitLimits.maxLod||Infinity);return 0>=sa?null:sa}}return null}get lodSnapping(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?T.LODSnapping.ON:T.LODSnapping.OFF}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get mapTileRequester(){return this._mapDataRequester}get _userClippingExtent(){var {spatialReference:sa}=
this,{clippingArea:va}=this.view;if(null==va||null==sa)return null;const ya=L.create();sa=W.toBoundingRect(va,ya,sa)?ya:null;va=this._get("extent");return L.equals(sa,va)?va:sa}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const sa=L.intersection(this.groundExtent,this._userClippingExtent,L.create()),va=this._get("extent");return L.equals(sa,va)?va:sa}get groundExtent(){return null!=this._tilingSchemeExtent?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){return this.tilingSchemeLogic?.extent}get updating(){this._hasPendingUpdates||
(this._maxNumUpdating=1);return!!((this.running||this._watchUpdatingTracking?.updating||0<this._asyncWorkItems)&&this.ready&&!this.suspended||this.overlayManager?.updating)}get running(){return(this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||!this._allTilesSorted||this._layerViewsDirty||this._scaleRangeQueries.updating||this._frameTask.updating)&&this.ready&&!this.suspended}get updatingProgressValue(){this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating);return 1-
this._pendingUpdates/this._maxNumUpdating}get baseOpacity(){return this.view?.map?.ground?.opacity??1}set baseOpacity(sa){this.view.map.ground.opacity=sa}get viewingMode(){return this.view.state.viewingMode}get ready(){return null!=this._rootTiles}set renderOrder(sa){this._renderer.renderOrder=sa;this._set("renderOrder",sa)}get rootTiles(){return this._rootTiles}get spatialReference(){return this.tilingScheme?.spatialReference??null}get backgroundColor(){return this.view?.map?.ground?.surfaceColor}set backgroundColor(sa){this.view.map.ground.surfaceColor=
sa}set slicePlaneEnabled(sa){this._renderer.slicePlaneEnabled=sa;this._set("slicePlaneEnabled",sa);this._evaluateTransparency()}get tilingSchemeLocked(){return this.tilingSchemeLogic?.tilingSchemeLocked??!1}get wireframe(){return this._renderer?.wireframe}set wireframe(sa){sa!==this._renderer.wireframe&&(this._renderer.wireframe=sa,this._updateAllTileGeometries())}get opaque(){return this._renderer.transparency===ca.TransparencyMode.Opaque}set suspended(sa){this._set("suspended",sa);this._viewChangeUpdate()}get textureFadeDuration(){return this.view.qualitySettings.tiledSurface.textureFadeDuration??
0}intersect(sa,va,ya,Ea){this._renderer.intersect(sa,va,ya,Ea)}getElevation(sa,va,ya,Ea){const Ca=this._rootTiles;if(!Ca?.length||0===Ca[0].layerInfo[aa.LayerClass.ELEVATION].length)return null;const Ga=Ka;Ga[0]=sa;Ga[1]=va;Ga[2]=ya;return K.projectVectorToVector(Ga,Ea,Ga,this._spatialReference)?Da(Ca,Ga[0],Ga[1]):(g.getLogger(this).error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null)}getElevations(sa,va,ya){const Ea=this._rootTiles;var Ca=
Ea?Ea[0].layerInfo[aa.LayerClass.ELEVATION].length:0;if(Ea?.length&&0!==Ca)for(Ca=0;Ca<va;++Ca){var Ga=3*Ca;Ga=Da(Ea,sa[Ga],sa[Ga+1]);ya(Ca,Ga)}else for(sa=0;sa<va;++sa)ya(sa,null)}getScale(sa){if(!this.tilingScheme)return null;if(!F.projectPointToVector(sa,Ka,this.spatialReference))return g.getLogger(this).error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;sa=this._rootTiles;if(null!=sa)for(var va of sa)if(va?.containsPoint(Ka)){for(;va.children[0]&&
!va.rendered;){sa=va.children[0].extent;let ya=0;Ka[0]>sa[2]&&(ya+=1);Ka[1]<sa[1]&&(ya+=2);va=va.children[ya]}return this._getLodBiasCorrectedScale(va.level)}return Infinity}getSphereElevationBounds(sa,va){Ka[0]=sa[0];Ka[1]=sa[1];Ka[2]=sa[2];Ka[3]=sa[3];if(!K.projectVectorToVector(Ka,va,Ka,this.tilingScheme?.spatialReference))return g.getLogger(this).error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;let ya=Infinity,Ea=-Infinity;
const Ca=Ga=>{if(Ga&&L.intersectsSphere(Ga.extent,Ka))if(Ga.isLeaf||Ga.rendered)ya=Math.min(ya,Ga.elevationBounds[0]),Ea=Math.max(Ea,Ga.elevationBounds[1]);else for(const Ja of Ga.children)Ca(Ja)};sa=this._rootTiles;if(null!=sa)for(const Ga of sa)Ca(Ga);return{min:ya,max:Ea}}getRootElevationBounds(){return{min:this.rootTileElevationBounds.min,max:this.rootTileElevationBounds.max}}getSphereScale(sa,va){if(!this.tilingScheme)return null;if(!F.projectPointToVector(sa,Ka,this.spatialReference))return g.getLogger(this).error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),
null;Ka[3]=va;let ya=null;const Ea=Ca=>{if(Ca&&L.intersectsSphere(Ca.extent,Ka)){const Ga=Ca.children;if(Ga[0]&&!Ca.rendered)for(const Ja of Ga)Ea(Ja);else Ca=this._getLodBiasCorrectedScale(Ca.level),ya=null==ya?Ca:Math.min(ya,Ca)}};sa=this._rootTiles;if(null!=sa)for(const Ca of sa)Ea(Ca);return ya}queryVisibleScaleRange(sa,va,ya,Ea){va=va?this.tilingScheme.levelAtScale(va):0;ya=ya?this.tilingScheme.levelAtScale(ya):Infinity;const Ca=this._lodBias;this._scaleRangeQueries.queryVisibleLevelRange(sa,
va+Ca,ya+Ca,Ea)}_evaluateTransparency(){var sa=this.baseOpacity;const va=this.overlayManager.renderer.isEmpty;var ya=this._renderer.transparency;sa=this._allSurfaceLayersTransparent()?va?ca.TransparencyMode.Empty:ca.TransparencyMode.TransparentWithDraped:1<=sa&&!this.hasCompositeBlendMode&&!this._renderer.slicePlaneEnabled?ca.TransparencyMode.Opaque:ca.TransparencyMode.Semitransparent;if(ya=ya!==sa)this._renderer.transparency=sa,this.view?._stage?.renderer.setParameters({terrainTransparency:this._renderer.transparency});
return ya}_updateTilingScheme(){const sa=this.tilingSchemeLogic.tilingScheme;if(sa!==this.tilingScheme){la.weakAssert(!!sa,"tiling scheme cannot be reset to undefined");this._isGlobal=!this.view?.state?.isLocal;this.tilingScheme&&this._removeAllTiles();var va=sa?.spatialReference??D.WebMercator;this._spatialReference=va;this._isWebMercatorOnPlateeCarree=(this._isWebMercator=!!va?.isWebMercator)&&O.isPlateCarree(this.view?.renderSpatialReference);this._set("tilingScheme",sa);this._updateClippingExtent();
sa&&(this._updateTiledLayers(),this._renderer.setTileSize(sa.pixelSize),this.overlayManager.setSpatialReference(sa.spatialReference),this._updateRootTiles())}}_acquireTile(sa,va,ya,Ea){const Ca=this._tileCache.pop(Ha._tileMemcacheKey);return Ca?(Ca.init(sa,va,ya,Ea,this),Ca):new this._tileConstructor(sa,va,ya,Ea,this)}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const {extent:sa,tilingScheme:va}=this;if(va){var ya=La,Ea=va.rootTilesInExtent(sa,ya,5*ea.maxRootTiles);if(null!=
this._rootTiles){if(Ea.length>ea.maxRootTiles){g.getLogger(this).warn(ea.tooManyRootTilesAfterChangeError);return}const Ca=this._rootTiles.map(Ja=>Ja.lij),Ga=f.difference(Ca,Ea,Aa);this._updatingRootTiles=!0;if(0<Ga.removed.length||0<Ga.added.length){const Ja=this._rootTiles.filter(Ma=>-1<Ga.removed.findIndex(Ta=>Aa(Ta,Ma.lij))?(this._purgeTile(Ma),!1):!0);Ga.added.forEach(Ma=>Ja.push(this._newRootTile(Ma)));this._setRootTiles(Ja)}}else this._updatingRootTiles=!0,Ea.length>ea.maxRootTiles&&(g.getLogger(this).warn(ea.tooManyRootTilesForLayerError),
Ea=va.rootTilesInExtent(sa,ya,ea.maxRootTiles)),this._setRootTiles(Ea.map(Ca=>this._newRootTile(Ca)));L.equals(ya,this._rootTilesExtent)||(this._rootTilesExtent=L.create(ya));this.renderer.visible=!0;this._viewChangeUpdate();this.overlayManager.setPlacementDirty();this.notifyChange("ready");this._updateAllTileGeometries();this._updatingRootTiles=!1;this.checkAllTilesWaterproofness()}}_updateAllTileGeometries(){const sa=this._allTiles.filter(va=>va.isLoaded&&va.intersectsClippingArea);sa.forEach(va=>
this._renderer.updateTileGeometryState(va));sa.forEach(va=>va.renderData.updateNeighborData());this._updateTilesGeometries(sa);this._pendingTilesToUpdate.clear()}_updateTilesGeometries(sa){if(0!==sa.length){sa.sort(ta.compareTilesByLij);var va=this.renderer;sa.forEach(ya=>va.updateGeometryIfNeeded(ya));sa.forEach(ya=>this._pendingTilesForElevationUpdateEvent.add(ya))}}_shouldSplit(sa){return sa.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.snapLevel)===ra.TileUpdate.SPLIT}_newRootTile(sa){sa=
this._acquireTile(0,sa[1],sa[2],null);this._shouldSplit(sa)&&sa.setPendingUpdate(ra.TileUpdate.SPLIT);this._loadTile(sa);this._markTileToUpdate(sa);this._updateRootTileElevationBounds();return sa}_setRootTiles(sa){this._rootTiles=sa;this._allTiles.clear();if(null!=sa){const va=this._iteratorPool.acquire();for(va.reset(sa);!va.done;)this._allTiles.push(va.next());va.remove()}this._renderer.setRootTiles(this._rootTiles);this._updateTilesVisibility(sa)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&
(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this.renderer.visible&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this._rootTiles)))}_updateClippingStatus(sa){sa.updateClippingStatus(this.extent)&&sa.resetPendingUpdate(ra.TileUpdate.GEOMETRY)&&this._updateTileGeometryState(sa)}_updateTilesVisibility(sa){if(null!=sa){var va=
ta.hasLoadableSiblings(sa),ya=this.visibleElevationBounds,Ea=va?ya.min:Infinity;va=va?ya.max:-Infinity;var Ca=this.extent,Ga=this._viewProjectionMatrix;this.setTileTreeDirty();var Ja=this._iteratorPool.acquire();for(Ja.reset(sa);!Ja.done;)sa=Ja.next(),sa.updateClippingStatus(Ca)&&sa.resetPendingUpdate(ra.TileUpdate.GEOMETRY)&&this._updateTileGeometryState(sa),sa.setPendingUpdate(ra.TileUpdate.RENDERDATA),sa.computeVisibility(),sa.updateScreenDepth(Ga),sa.renderData&&(Ea=Math.min(sa.elevationBounds[0],
Ea),va=Math.max(sa.elevationBounds[1],va));Ja.remove();this._allTilesDirty=this._viewChanged=!0;this._updatePendingTileGeometries();isFinite(Ea)&&isFinite(va)&&(ya.min!==Ea||ya.max!==va)&&(this.visibleElevationBounds=new I.ElevationBounds(Ea,va))}}_updateRootTileElevationBounds(){let sa=Infinity,va=-Infinity;var ya=this._rootTiles;null!=ya&&ya.forEach(({elevationBounds:Ea})=>{sa=Math.min(sa,Ea[0]);va=Math.max(va,Ea[1])});ya=this.rootTileElevationBounds;if(ya.min!==sa||ya.max!==va)this.rootTileElevationBounds=
new I.ElevationBounds(sa,va)}_updateViewDependentParameters(){const {camera:sa,contentCamera:va}=this.view.state,ya=Math.tan(.5*va.fovX),Ea=Math.tan(.5*va.fovY),Ca=this.tilingScheme.pixelSize,Ga=2**-this._lodBias*sa.pixelRatio;this._splitLimits.aboveGround=sa.aboveGround;this._splitLimits.fovX=ya;this._splitLimits.fovY=Ea;this._splitLimits.relativeWidthLimit=Ca/sa.width*this.maxTextureScale*Ga;this._splitLimits.relativeHeightLimit=Ca/sa.height*this.maxTextureScale*Ga;this._splitLimits.maxLod=this.tilingScheme.getMaxLod();
this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias;this._splitLimits.frustum=this.view.state.fixedContentCamera?G.copy(this._splitLimits.frustum??G.create(),va.frustum):null;G.copy(this._frustum,sa.frustum);u.multiply(this._viewProjectionMatrix,va.projectionMatrix,va.viewMatrix);z.copy(this._eyePosRenderSR,va.eye);K.projectVectorToVector(sa.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateRenderData(sa){sa.rendered&&!sa.shouldLoad&&
(Fa(sa)?this._loadChildren(sa):sa.isLeaf&&(sa.parent?.shouldLoad??!1)&&this._loadParent(sa))}_updateTileGeometryState(sa){sa.updateVisibility();this._renderer.updateTileGeometryState(sa)&&this._markTileToUpdate(sa);this._usedMemory=null}_markAllTileNeighborsForGeometryUpdate(sa){sa.forEachLoadedNeighbor(va=>this._pendingTilesToUpdate.add(va))}_updateTileTexture(sa,va){const ya=sa.resetPendingUpdate(ra.TileUpdate.TEXTURE_FADING)?ra.TileUpdate.TEXTURE_FADING:sa.resetPendingUpdate(ra.TileUpdate.TEXTURE_NOFADING)?
ra.TileUpdate.TEXTURE_NOFADING:!1;ya&&(this._renderer.updateTileTexture(sa,ya),this._usedMemory=null,va.madeProgress())}_emitElevationUpdateEventForTiles(){if(this._shouldEmitChangeEvent){var sa=Ra.extent;L.empty(sa);this._pendingTilesForElevationUpdateEvent.forEach(va=>L.expand(sa,va.extent,sa));this._pendingTilesForElevationUpdateEvent.clear();Ra.spatialReference=this.spatialReference;this.emit("elevation-change",Ra);this._shouldEmitChangeEvent=!1}}runTask(sa){this._handleLayerViewChanges(sa);this._frameTask.processQueue(sa);
this.renderer.processScaleRangeQueries(this._scaleRangeQueries,sa);this._inFrameTask=!0;this._pendingUpdates=0;this._hasPendingUpdates=!1;this._updateAllTilesStatus(sa);this._sortTiles(sa);const va=!this.view.state.fixedContentCamera;this._mergeAndSplit(sa,va);this._updateElevation(sa);this._updateTextures(sa);va||this._mergeAndSplit(sa,!0);this._inFrameTask=!1;this._runViewChangeUpdateIfDirty();this._updatePendingTileGeometries();this._emitElevationUpdateEventForTiles();sa.done&&sa.hasProgressed&&
this.requestUpdate();this.notifyChange("updatingProgressValue")}_updateAllTilesStatus(sa){if(this._viewChanged&&this._rootTiles&&!sa.done){this._viewChanged=!1;var va=this._iteratorPool.acquire();va.reset(this._rootTiles);for(var ya=this.snapLevel,Ea=this._splitLimits,Ca=this._eyePosRenderSR;!va.done;){var Ga=va.next(),Ja=Ga.shouldSplit(Ea,Ca,ya);if(Ja===ra.TileUpdate.SPLIT)Ga.resetPendingUpdate(ra.TileUpdate.MERGE),Ga.isLeaf&&(Ga.setPendingUpdate(ra.TileUpdate.SPLIT),va.skipSubtree()),Ga.rendered&&
Ga.setPendingUpdate(ra.TileUpdate.RENDERDATA);else if(Ga.resetPendingUpdate(ra.TileUpdate.SPLIT)&&Ga.updateAgentSuspension(),Ja===ra.TileUpdate.ELEVATION&&Ga.updateAgents(aa.LayerClass.ELEVATION),va.skipSubtree(),!Ga.isLeaf){Ga.setPendingUpdate(ra.TileUpdate.MERGE);Ga.resetPendingUpdate(ra.TileUpdate.SPLIT);Ja=this._iteratorPool.acquire();Ja.resetOne(Ga);Ga=this._viewProjectionMatrix;for(let Ma=Ja.next();!Ja.done;Ma=Ja.next())this._updateClippingStatus(Ma),Ma.updateVisibility(),Ma.updateScreenDepth(Ga);
Ja.remove()}}va.remove();this.requestUpdate();!this._shortBatches&&this._oneBatchPerFrameTask||this._updatePendingTileGeometries();sa.madeProgress()}}_sortTiles(sa){sa.done||this._allTilesSorted||(ta.sortTilesByPOI(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),sa.madeProgress())}_markTileToUpdate(sa){la.internalAssert(sa.isLoaded);sa.intersectsClippingArea&&(this._pendingTilesToUpdate.add(sa),this._markAllTileNeighborsForGeometryUpdate(sa))}_updatePendingTileGeometries(){const sa=
this._pendingTilesToUpdate,va=Array.from(sa.keys()).filter(Ca=>Ca.isLoaded&&Ca.intersectsClippingArea);if(0===va.length)sa.clear();else{var ya=(Ca,Ga)=>{!Ga?.isLoaded||!Ga.intersectsClippingArea||Ga.level<Ca.level||sa.has(Ga)||(sa.add(Ga),va.push(Ga),Ga.renderData.updateNeighborData())};va.sort(ta.compareTilesByLij);var Ea=va.length;for(let Ca=0;Ca<Ea;++Ca){const Ga=va[Ca];la.internalAssert(Ga.isLoaded);la.internalAssert(Ga.intersectsClippingArea);const Ja=Ga.renderData;Ja.updateNeighborData();const Ma=
Ja._dirtyEdgeResolutions,Ta=Ja.geometryState.neighborData.cornerPeerNeighbors,Va=Wa=>{const hb=la.neighborCornerIndices[Wa];ya(Ga,Ta[Wa]?.findCorner(la.oppositeCorner(hb),Ya=>Ya.isLoaded))};for(let Wa=0;4>Wa;++Wa)if(Ma&1<<Wa){const hb=Ja.geometryState.neighborData.edgePeerNeighbors[Wa];hb&&hb?.level>=Ga.level&&hb.forAllSubtreeOnSide(la.oppositeEdge(la.neighborEdgeIndices[Wa]),Ya=>Ya.isLoaded&&Ya.intersectsClippingArea?(la.internalAssert(sa.has(Ya)||0>ta.compareTilesByLij(Ga,Ya)),ya(Ga,Ya),!0):!1);
Va((Wa+1)%4);Va(Wa)}}sa.clear();this._updateTilesGeometries(va);this._shouldEmitChangeEvent=!0;la.enableTerrainInternalChecks&&la.enableWaterproofnessTests&&this.checkAllTilesWaterproofness()}}_mergeAndSplit(sa,va){if(!this.suspended&&!sa.done&&this._allTilesDirty){this._allTilesDirty=!1;this.requestUpdate();for(var ya=!1,Ea=this.view.state.fixedContentCamera,Ca=!1;!sa.done;){Ca=!0;let Ga=!1;const Ja=!this._allTiles.some(Ma=>{if(!ya&&!Ea&&!Ma.visible)return sa.done;let Ta=Ma;if(Ma.resetPendingUpdate(ra.TileUpdate.MERGE)){if(!va)return Ma.setPendingUpdate(ra.TileUpdate.MERGE),
sa.done;for(;Ta.parent?.resetPendingUpdate(ra.TileUpdate.MERGE);)Ta=Ta.parent;this._mergeTile(Ta);Ga=!0;sa.madeProgress()}else Ma.resetPendingUpdate(ra.TileUpdate.SPLIT)&&(this._splitTile(Ma),Ga=!0,sa.madeProgress());!sa.done&&Ta===Ma&&Ma.resetPendingUpdate(ra.TileUpdate.RENDERDATA)&&(this._updateRenderData(Ma),sa.madeProgress());return sa.done});Ga&&(this._allTilesSorted=!1,this._allTilesDirty=!0);if(Ja)if(!ya)ya=!0;else{if(!Ga)break}else this._allTilesDirty=!0}Ca?sa.madeProgress():this._allTilesDirty=
!0;!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries();this._sortTiles(sa)}}_updateElevation(sa){sa.done||(this._allTiles.some(va=>{va.resetPendingUpdate(ra.TileUpdate.GEOMETRY)&&(this._updateTileGeometryState(va),this._updateTileTexture(va,sa),this._shortBatches&&this._updatePendingTileGeometries(),sa.madeProgress());return sa.done}),!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries())}_updateTextures(sa){sa.done||this._allTiles.some(va=>{this._updateTileTexture(va,sa);
return sa.done})}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams(ua.RenderRequestType.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get _lodBias(){return this.view.qualitySettings.tiledSurface.lodBias-(1-this.view.quality)*ea.maxMemoryLodBias}_getLodBiasCorrectedScale(sa){const va=this.tilingScheme.levels;sa=q.clamp(sa-this._lodBias,0,va.length-1);const ya=sa-Math.floor(sa);return va[Math.floor(sa)].scale*(1-ya)+va[Math.ceil(sa)].scale*ya}_removeAllTiles(){null!=
this._rootTiles&&(this._rootTiles.forEach(sa=>this._purgeTile(sa)),this._setRootTiles(null),this.notifyChange("ready"));this._allTiles.clear();this.renderer.visible=!1}_purgeDescendantTiles(sa){if(!sa.children[0])return!1;let va=!1;for(let ya=0;4>ya;++ya)va=this._purgeTile(sa.children[ya])||va;sa.unsetChildren();return va}_purgeTile(sa){const va=this._purgeDescendantTiles(sa)||sa.rendered;this._allTiles.removeUnordered(sa);this._unloadTile(sa);this._tileCache.put(Ha._tileMemcacheKey,sa);return va}_unloadTile(sa){this._pendingTilesToUpdate.delete(sa);
this._pendingTilesForElevationUpdateEvent.delete(sa);sa.unload(this._renderer)}_splitTile(sa){la.weakAssert(sa.isLeaf,"tile that is already split should not be split again!");const va=sa.level+1,ya=2*sa.lij[1],Ea=2*sa.lij[2];sa.setChildren(this._createTile(va,ya,Ea,sa),this._createTile(va,ya,Ea+1,sa),this._createTile(va,ya+1,Ea,sa),this._createTile(va,ya+1,Ea+1,sa));sa.setPendingUpdate(ra.TileUpdate.RENDERDATA);sa.updateAgentSuspension();this._allTiles.pushArray(sa.children);this._allTilesDirty=!0;
++this._performanceInfo.numSplit}_emitTileScaleChange(sa,va=sa.level){Sa.spatialReference=this.spatialReference;Sa.extent=sa.extent;Sa.scale=this._getLodBiasCorrectedScale(va);this.emit("scale-change",Sa)}_createTile(sa,va,ya,Ea){la.weakAssert(!!Ea,"_createTile sanity check");sa=this._acquireTile(sa,va,ya,Ea);sa.updateClippingStatus(this.extent);sa.updateScreenDepth(this._viewProjectionMatrix);this._shouldSplit(sa)&&sa.setPendingUpdate(ra.TileUpdate.SPLIT);return sa}get _shortBatches(){return this.view.state.mode!==
wa.RenderState.IDLE}_mergeTile(sa){la.weakAssert(!sa.hasPendingUpdate(ra.TileUpdate.SPLIT),"_mergeTile sanity check");this._purgeDescendantTiles(sa)&&(la.weakAssert(!sa.renderData,"_mergeTile sanity check"),this._loadTile(sa),this._markTileToUpdate(sa),this._emitTileScaleChange(sa),this._shortBatches&&this._updatePendingTileGeometries());this._allTilesDirty=!0;++this._performanceInfo.numMerged}_loadChildren(sa){la.weakAssert(sa.rendered,"parent should be rendered");this._unloadTile(sa);const va=sa.children;
va.forEach(ya=>this._loadTile(ya));va.forEach(ya=>this._pendingTilesToUpdate.add(ya));this._markAllTileNeighborsForGeometryUpdate(sa);this._emitTileScaleChange(sa,sa.level+1);this._shortBatches&&this._updatePendingTileGeometries()}_loadParent(sa){sa=sa.parent;this._unloadChildren(sa);this._loadTile(sa);this._markTileToUpdate(sa);this._emitTileScaleChange(sa,sa.level);this._shortBatches&&this._updatePendingTileGeometries()}_unloadChildren(sa){sa=sa.children;if(sa[0])for(let va=0;4>va;++va){const ya=
sa[va];this._unloadChildren(ya);this._unloadTile(ya)}}_loadTile(sa){sa.load();sa.setPendingUpdate(ra.TileUpdate.RENDERDATA);this.requestUpdate();this._allTilesDirty=!0;this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(sa)}_elevationDataArrived(sa,va,ya){ya=new Q.ElevationData(sa.lij,sa.extent,ya);sa.dataArrived(va,aa.LayerClass.ELEVATION,ya);ya=[sa];sa=sa.level;const Ea=this._iteratorPool.acquire();for(Ea.reset(ya);!Ea.done;){const Ca=Ea.next();Ca.findElevationBoundsForLayer(va,
sa);Ca.computeElevationBounds()}0===sa&&this._updateRootTileElevationBounds();Ea.remove();this._updateTilesVisibility(ya)}_handleLayerViewChanges(sa=za.noBudget){if(this._layerViewsDirty){var va=this._layerViewsDirty=!1,ya=new Set,Ea=-1;for(const Ga of this.view.allLayerViews.items)if(ya.add(Ga.uid),la.isSurfaceLayerView(Ga)||la.isGroupLayerView(Ga))if(this._basemapLayerViewHandles.has(Ga.uid)&&!la.isGroupLayerView(Ga)){var Ca=this._layerClassFromLayerView(Ga);Ca=this._getLayerIdxByUID(Ca,Ga.uid);
if(null!=Ca){if(Ca<Ea||null==Ea)va=!0;Ea=Ca}}else this._registerTiledLayerView(Ga),Ga.layer.loaded&&(va=!0);this._basemapLayerViewHandles.forEach((Ga,Ja)=>{ya.has(Ja)||(this._unregisterTiledLayerView(Ja),va=!0)});va&&this._updateTiledLayers();this.hasCompositeBlendMode=this._hasCompositeBlendMode();this._evaluateTransparency();sa.madeProgress()}}_allSurfaceLayersTransparent(){let sa=0===this.view.map?.ground?.opacity;for(const va of this.view.allLayerViews.items)if(la.isMapTileLayerView(va)&&!X.isBaseLayer(va.layer)&&
0!==va.fullOpacity){sa=!1;break}return sa}_hasCompositeBlendMode(){for(const sa of this.view.allLayerViews.items)if((la.isBlendableLayerView(sa)||la.isGroupLayerView(sa))&&ja.isCompositeBlendMode(ja.blendModeFromString[sa.layer.blendMode]))return!0;return!1}_layerClassFromLayerView(sa){return la.isElevationLayerView(sa)?aa.LayerClass.ELEVATION:aa.LayerClass.MAP}_registerTiledLayerView(sa){const va=[];(la.isBlendableLayerView(sa)||la.isGroupLayerView(sa))&&va.push(x.watch(()=>sa.layer.blendMode,()=>
{this.hasCompositeBlendMode=this._hasCompositeBlendMode();this._updateTileTextures(T.TextureUpdate.UNFADED)}));if(!la.isGroupLayerView(sa)){const ya=this._layerClassFromLayerView(sa);va.push(x.watch(()=>sa.suspended,()=>this._updateTiledLayers()));va.push(x.watch(()=>sa.fullOpacity,()=>this._updateTileTextures(T.TextureUpdate.UNFADED)));va.push(x.watch(()=>"effectiveScaleRange"in sa.layer?sa.layer.effectiveScaleRange:null,()=>this._restartAllAgents(ya)));va.push(sa.on("data-changed",()=>{const Ea=
this._getLayerIdxByUID(ya,sa.uid);null!=Ea&&this._invalidateLayerData(Ea,ya)}))}this._unregisterTiledLayerView(sa.uid);this._basemapLayerViewHandles.set(sa.uid,va)}_unregisterTiledLayerView(sa){const va=this._basemapLayerViewHandles.get(sa);if(va){for(const ya of va)ya.remove();this._basemapLayerViewHandles.delete(sa)}}_updateTiledLayers(){if(this.tilingScheme&&!this.view.suspended){var sa=[[],[]],va=null;this.view.allLayerViews.forEach(Ea=>{if(Ea.layer&&!Ea.suspended&&la.isSurfaceLayerView(Ea)&&
Ea.fullExtent){var Ca=this._layerClassFromLayerView(Ea);if(Ca===aa.LayerClass.MAP){const Ga=Ea.displayLevelRange.maxLevel;Infinity!==Ga&&(null===va||Ga>va)&&(va=Ga)}sa[Ca].push(Ea)}});for(const Ea of aa.LayerClasses){var ya=this._layerViews[Ea];const Ca=sa[Ea];Ca.reverse();const Ga=Ca.length;let Ja=ya.length!==Ga;const Ma=Array(Ga),Ta=Array(ya.length);this._layerIndexByUid[Ea].clear();for(let Va=0;Va<Ga;Va++){this._layerIndexByUid[Ea].set(Ca[Va].uid,Va);const Wa=ya.indexOf(Ca[Va]);Ma[Va]=Wa;Va!==
Wa&&(Ja=!0);-1<Wa&&(Ta[Wa]=Va)}if(Ja){ya=this._postorderIterator;for(ya.reset(this._rootTiles);!ya.done;)ya.next().modifyLayers(Ta,Ma,Ea);this._layerViews[Ea]=Ca;this._restartAllAgents(Ea);this._updateTilesVisibility(this._rootTiles)}}this.tilingScheme.ensureMaxLod(va)&&this._viewChangeUpdate()}}_restartAllAgents(sa){const va=this._postorderIterator;for(va.reset(this._rootTiles);!va.done;){const ya=va.next();ya.restartAgents(sa);sa===aa.LayerClass.ELEVATION&&ya.computeElevationBounds()}this._updateRootTileElevationBounds()}layerViewByIndex(sa,
va){return this._layerViews[va][sa]}numLayers(sa){return this._layerViews[sa].length}_updateTileTextures(sa){this._allTiles.forAll(va=>{va.updateAgents(aa.LayerClass.MAP);sa===T.TextureUpdate.IMMEDIATE?this.renderer.updateTileTexture(va,ra.TileUpdate.TEXTURE_NOFADING):va.updateRenderData(aa.LayerClass.MAP,sa)});this._evaluateTransparency()}_invalidateLayerData(sa,va){this._allTiles.forAll(ya=>ya.removeLayerAgent(sa,va));this._allTiles.forAll(ya=>ya.invalidateLayerData(sa,va))}setTileTreeDirty(){this._allTilesDirty=
!0}requestRender(sa=ua.RenderRequestType.UPDATE){this.renderer.setNeedsRender(sa)}requestUpdate(){1===++this._pendingUpdates&&(this._hasPendingUpdates=!0)}requestTileData(sa,va,ya,Ea){const Ca=this.layerViewByIndex(va,ya);va=Ca.layer;if(!va.tilemapCache||la.isVectorTileLayerView(Ca))return this._requestTileData(sa,ya,Ca,Ea);++this._asyncWorkItems;return va.tilemapCache.fetchAvailability(sa.lij[0],sa.lij[1],sa.lij[2],{...Ea,timeout:6E3}).then(()=>--this._asyncWorkItems).catch(Ga=>{--this._asyncWorkItems;
v.throwIfAborted(Ea);v.isAbortError(Ga)||this._dataMissing(sa,ya,Ca,{notInTilemap:!0});throw Ga;}).then(()=>this._frameTask.schedule(()=>this._requestTileData(sa,ya,Ca,Ea),Ea.signal))}_requestTileData(sa,va,ya,Ea){return va===aa.LayerClass.ELEVATION?la.isElevationLayerView(ya)?this._requestElevationTileData(sa,ya,Ea):Promise.reject():la.isMapTileLayerView(ya)?this._requestMapTileData(sa,ya,Ea):Promise.reject()}_requestElevationTileData(sa,va,ya){++this._asyncWorkItems;const Ea=Ja=>{if(!v.isAborted(ya)){var Ma=
this._layerIndexByUid[aa.LayerClass.ELEVATION].get(va.uid);null==Ma?g.getLogger(this).warn("TerrainSurface: received data from unknown layer %d %s",aa.LayerClass.ELEVATION,sa.lij.toString()):(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(sa,Ma,Ja))}},Ca=Ja=>{v.isAbortError(Ja)||(this._dataMissing(sa,aa.LayerClass.ELEVATION,va,Ja),this.requestUpdate())};if(la.useFetchTileForLayer(va.layer))return va.layer.fetchTile(sa.lij[0],sa.lij[1],sa.lij[2],{noDataValue:ea.elevationNodataValue,
signal:ya.signal}).then(Ja=>{if(v.isAborted(ya))g.getLogger(this).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true.");else return this._frameTask.schedule(()=>Ea(Ja),ya.signal,Ca)},Ca).finally(()=>{--this._asyncWorkItems});const Ga=va.getTileUrl(sa.lij[0],sa.lij[1],sa.lij[2]);return this._elevationDataRequester.request(Ga,"binary",ya).then(Ja=>this._lercDecoder.decode(Ja,{noDataValue:ea.elevationNodataValue},
ya.signal)).then(Ja=>{Ja?Ea(new R.ElevationTileData(Ja)):Ca(Error("LERC decoding failed"))},Ca).finally(()=>{--this._asyncWorkItems})}_requestMapTileData(sa,va,ya){++this._asyncWorkItems;const Ea=(Ta,Va)=>{--this._asyncWorkItems;la.releaseTileData(Va);v.isAborted(ya)||(this._dataMissing(sa,aa.LayerClass.MAP,va,Ta),this.requestUpdate())},Ca=Ta=>Va=>Ea(Va,Ta),Ga=Ta=>this._frameTask.schedule(()=>{--this._asyncWorkItems;this.requestUpdate();v.isAborted(ya)?la.releaseTileData(Ta):this._mapTileDataArrived(sa,
va,Ta)},ya.signal,Ca(Ta)).catch(Ca(Ta)),Ja=(Ta,Va=null)=>this._frameTask.schedule(()=>Ea(Ta,Va));if(la.isVectorTileLayerView(va)){var Ma=va.schemaHelper.getLevelRowColumn(sa.lij);return va.fetchTile(Ma[0],Ma[1],Ma[2],ya).then(Ga,Ja)}if(la.isImageryTileLayerView(va))return va.fetchTile(sa.lij[0],sa.lij[1],sa.lij[2],ya).then(Ga,Ja);if(la.isTileLayerView(va)&&la.useFetchTileForLayer(va.layer))return va.layer.fetchTile(sa.lij[0],sa.lij[1],sa.lij[2],ya).then(Ta=>{v.isAborted(ya)?(g.getLogger(this).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),
Ja(v.createAbortError())):Ga(Ta)},Ja);Ma=va.getTileUrl(sa.lij[0],sa.lij[1],sa.lij[2]);P.isRefreshableLayer(va.layer)&&va.layer.refreshTimestamp&&(Ma+=`${Ma.includes("?")?"\x26":"?"}_ts=${va.layer.refreshTimestamp}`);return this._mapDataRequester.request(Ma,va.hasMixedImageFormats?"image+type":"image",ya).then(Ga,Ja)}_mapTileDataArrived(sa,va,ya){va=this._getLayerIdxByUID(aa.LayerClass.MAP,va.uid);null!=va?sa.dataArrived(va,aa.LayerClass.MAP,ya):(la.releaseTileData(ya),g.getLogger(this).warn("TerrainSurface: received data from unknown layer"))}_getLayerIdxByUID(sa,
va){return this._layerIndexByUid[sa].get(va)}_dataMissing(sa,va,ya,Ea){ya=this._getLayerIdxByUID(va,ya.uid);null!=ya?sa.dataMissing(ya,va,Ea):g.getLogger(this).warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(sa){this._rootTiles&&this.overlayManager&&(this._allTiles.forAll(va=>{va.renderData&&this.overlayManager.setTileParameters(va)}),this._renderer.setNeedsRender(sa))}get performanceInfo(){const sa=this._performanceInfo;sa.numNodes=this._allTiles.length;sa.numLeaves=
sa.numVisible=sa.numRendered=sa.numLoadedPerLevel.length=sa.numRenderedPerLevel.length=0;this._allTiles.forAll(va=>{va.isLeaf&&sa.numLeaves++;const ya=va.level;va.renderData&&(sa.numLoadedPerLevel[ya]=(sa.numLoadedPerLevel[ya]||0)+1);va.visible&&(sa.numVisible++,va.rendered&&(sa.numRenderedPerLevel[ya]=(sa.numRenderedPerLevel[ya]||0)+1,sa.numRendered++))});return sa}get usedMemory(){if(!this.tilingScheme)return 0;null==this._usedMemory&&(this._usedMemory=this._recalculateUsedMemory());return this._usedMemory??
0}_recalculateUsedMemory(){return this.tilingScheme?Math.round(this._allTiles.reduce((sa,va)=>sa+va.usedMemory,0)):null}getUsedMemoryForLayerView(sa){let va=0;const ya=this._layerClassFromLayerView(sa),Ea=this._getLayerIdxByUID(ya,sa.uid);null!=Ea&&this._allTiles.forAll(Ca=>va+=Ca.getUsedMemoryForLayer(ya,Ea));return va}getTile(sa){if(null==sa||null==this._rootTiles)return null;const va=sa.split("/").map(Ga=>+Ga);if(0===va[0])return this._rootTiles.find(Ga=>Ga.lij[1]===va[1]&&Ga.lij[2]===va[2]);sa=
2**va[0];const ya=Math.floor(va[1]/sa),Ea=Math.floor(va[2]/sa);let Ca;this._rootTiles.some(Ga=>Ga.lij[1]===ya&&Ga.lij[2]===Ea?(Ca=Ga,!0):!1);if(Ca){for(sa=1<<va[0]-1;Ca.lij[0]<va[0];){let Ga=va[1]&sa?2:0;0<(va[2]&sa)&&Ga++;if(!Ca.children[Ga])return null;Ca=Ca.children[Ga];sa>>=1}la.weakAssert(Ca.lij[0]===va[0]&&Ca.lij[1]===va[1]&&Ca.lij[2]===va[2],"not the right tile?");return Ca}return null}get renderPatchBorders(){return this._renderer.renderPatchBorders}set renderPatchBorders(sa){this._renderer.renderPatchBorders=
sa}get visualizeNormals(){return this._renderer.visualizeNormals}set visualizeNormals(sa){this._renderer.visualizeNormals=sa}get renderingDisabled(){return this._renderer.renderingDisabled}set renderingDisabled(sa){this._renderer.renderingDisabled=sa}get test(){const sa=this;return{renderer:sa._renderer,lercDecoder:sa._lercDecoder,forceReload:()=>{null!=sa._rootTiles&&0<sa._rootTiles.length&&(sa._mergeTile(sa._rootTiles[0]),sa._viewChangeUpdate())},getTiles:()=>sa._allTiles.toArray(),getRenderedTiles(){Na.clear();
sa._allTiles.forAll(ya=>{ya.visible&&ya.rendered&&Na.push(ya)});const va=Na.toArray();ta.sortTiles(sa.renderOrder,va);return va},lockTilingScheme(va,ya){sa._extentHelper.defaultTiledLayersExtent=ya;sa.tilingSchemeLogic.test.lockTilingScheme(va)}}}checkAllTilesWaterproofness(){if(la.enableWaterproofnessTests){var sa=this._rootTiles;if(null!=sa){var va=Ca=>0<Ca?.renderData?.geometry?.indices?.length,ya=Ca=>{if(Ca.intersectsClippingArea)if(Ca.renderData&&!Ca.renderData.geometryState&&console.error("Tile[",
Ca.lij,"] has renderData but not geometryState"),Ca.renderData&&!Ca.renderData.geometry&&console.error("Tile[",Ca.lij,"] has renderData but not geometryInfo"),!Ca.renderData?.geometry||0<(Ca.renderData.geometry.indices?.length??0)||console.error("Tile[",Ca.lij,"] has renderData but no indices - geometryInfo: ",Ca.renderData.geometry),va(Ca)){Ca.checkGeometryWaterproofness();for(const Ma of Ca.children){var Ga=Ma,Ja=Ca;va(Ga)&&console.error("Tile[",Ga.lij,"] has geometry although parent[",Ja.lij,"] has geom")}}else if(Ca.isLeaf)console.error("Tile[",
Ca.lij,"] has no geometry and no children, from root to leaf");else for(Ga of Ca.children)ya(Ga)},Ea=Ca=>{const Ga=Ca.parent?.visible??!0,Ja=Ca.visible;Ca.computeVisibility();const Ma=Ca.visible;Ja!==Ma&&Ga&&console.error(" Tile[",Ca.lij,"] has out of date visibility: ",Ja," instead of ",Ma);if(!Ca.isLeaf)for(const Ta of Ca.children)Ea(Ta)};for(const Ca of sa)ya(Ca),Ea(Ca)}}}get isGlobal(){return this._isGlobal}get isWebMercator(){return this._isWebMercator}get isWebMercatorOnPlateeCarree(){return this._isWebMercatorOnPlateeCarree}isEastEndWrap(sa){return this.isGlobal&&
sa[2]===this.lijEastEnd(sa[0])-1}isWestEndWrap(sa){return this.isGlobal&&0===sa[2]}lijEastEnd(sa){return 2**(sa+(null!=this.spatialReference&&this.spatialReference.isGeographic?1:0))}wrapEastWest(sa){const va=this.lijEastEnd(sa[0]),ya=sa[2];return 0<=ya&&ya<va?sa:this.isGlobal?[sa[0],sa[1],(ya+(0>ya?va:0))%va]:null}enableInternalChecks(sa){la.enableInternalTerrainChecks(sa)}enableWaterproofnessChecks(sa){la.enableTerrainWaterproofnessChecks(sa)}};d._tileMemcacheKey="TerrainTileMemcache";a.__decorate([p.property()],
d.prototype,"_renderer",void 0);a.__decorate([p.property({constructOnly:!0})],d.prototype,"_scaleRangeQueries",void 0);a.__decorate([p.property({constructOnly:!0})],d.prototype,"view",void 0);a.__decorate([p.property({constructOnly:!0})],d.prototype,"overlayManager",void 0);a.__decorate([p.property()],d.prototype,"_hasPendingUpdates",void 0);a.__decorate([p.property()],d.prototype,"_asyncWorkItems",void 0);a.__decorate([p.property()],d.prototype,"_allTilesDirty",void 0);a.__decorate([p.property()],
d.prototype,"_allTilesSorted",void 0);a.__decorate([p.property()],d.prototype,"_viewChanged",void 0);a.__decorate([p.property()],d.prototype,"_splitLimits",void 0);a.__decorate([p.property({readOnly:!0})],d.prototype,"_watchUpdatingTracking",void 0);a.__decorate([p.property()],d.prototype,"_frameTask",void 0);a.__decorate([p.property({readOnly:!0})],d.prototype,"snapLevel",null);a.__decorate([p.property({readOnly:!0})],d.prototype,"lodSnapping",null);a.__decorate([p.property()],d.prototype,"_userClippingExtent",
null);a.__decorate([p.property()],d.prototype,"_rootTilesExtent",void 0);a.__decorate([p.property({readOnly:!0})],d.prototype,"extent",null);a.__decorate([p.property({readOnly:!0})],d.prototype,"groundExtent",null);a.__decorate([p.property({readOnly:!0})],d.prototype,"_tilingSchemeExtent",null);a.__decorate([p.property({readOnly:!0})],d.prototype,"updating",null);a.__decorate([p.property({readOnly:!0})],d.prototype,"running",null);a.__decorate([p.property(S.updatingProgress)],d.prototype,"updatingProgress",
void 0);a.__decorate([p.property({readOnly:!0})],d.prototype,"updatingProgressValue",null);a.__decorate([p.property()],d.prototype,"_maxNumUpdating",void 0);a.__decorate([p.property()],d.prototype,"baseOpacity",null);a.__decorate([p.property()],d.prototype,"hasCompositeBlendMode",void 0);a.__decorate([p.property({readOnly:!0})],d.prototype,"viewingMode",null);a.__decorate([p.property()],d.prototype,"maxTextureScale",void 0);a.__decorate([p.property({readOnly:!0})],d.prototype,"ready",null);a.__decorate([p.property({value:fa.RenderOrder.FRONT_TO_BACK})],
d.prototype,"renderOrder",null);a.__decorate([p.property({readOnly:!0})],d.prototype,"rootTiles",null);a.__decorate([p.property()],d.prototype,"_rootTiles",void 0);a.__decorate([p.property({readOnly:!0})],d.prototype,"spatialReference",null);a.__decorate([p.property({type:c})],d.prototype,"backgroundColor",null);a.__decorate([p.property({value:!1})],d.prototype,"slicePlaneEnabled",null);a.__decorate([p.property({readOnly:!0})],d.prototype,"tilingScheme",void 0);a.__decorate([p.property({readOnly:!0})],
d.prototype,"tilingSchemeLocked",null);a.__decorate([p.property({readOnly:!0})],d.prototype,"tilingSchemeLogic",void 0);a.__decorate([p.property()],d.prototype,"wireframe",null);a.__decorate([p.property({value:!1})],d.prototype,"suspended",null);a.__decorate([p.property()],d.prototype,"textureFadeDuration",null);a.__decorate([p.property()],d.prototype,"visibleElevationBounds",void 0);a.__decorate([p.property()],d.prototype,"rootTileElevationBounds",void 0);a.__decorate([p.property()],d.prototype,
"_layerViewsDirty",void 0);a.__decorate([p.property()],d.prototype,"renderPatchBorders",null);a.__decorate([p.property()],d.prototype,"visualizeNormals",null);a.__decorate([p.property()],d.prototype,"renderingDisabled",null);a=d=Ha=a.__decorate([r.subclass("esri.views.3d.terrain.TerrainSurface")],d);const Ka=C.create(),La=L.create(),Na=new w,Ra={spatialReference:null,extent:L.create(),context:"ground"},Sa={spatialReference:null,extent:null,scale:0};return a})},"esri/layers/support/ElevationQueryTileCache":function(){define(["exports"],
function(b){class a{constructor(c){this._store=c}destroy(){this._store.destroy()}get(c){return this._store.get(c)}put(c,d){this._store.put(c,d,d.values.byteLength+256)}}b.ElevationQueryTileCache=a;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/ElevationTileData":function(){define(["exports"],function(b){class a{constructor(c,d,f,n){this._maxValue=this._minValue=this._hasNoDataValues=null;"pixelData"in c?(this.values=c.pixelData,this.width=c.width,this.height=
c.height,this.noDataValue=c.noDataValue):(this.values=c,this.width=d,this.height=f,this.noDataValue=n)}get hasNoDataValues(){null==this._hasNoDataValues&&(this._hasNoDataValues=this.values.includes(this.noDataValue));return this._hasNoDataValues}get minValue(){this._ensureBounds();return this._minValue}get maxValue(){this._ensureBounds();return this._maxValue}_ensureBounds(){if(null==this._minValue){var {noDataValue:c,values:d}=this,f=Infinity,n=-Infinity,k=!0;for(const g of d)g===c?this._hasNoDataValues=
!0:(f=g<f?g:f,n=g>n?g:n,k=!1);k?this._maxValue=this._minValue=0:(this._minValue=f,this._maxValue=-3E38<n?n:0)}}}b.ElevationTileData=a;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/LercDecoder":function(){define(["exports","../../core/workers/WorkerHandle"],function(b,a){class c extends a.WorkerHandle{constructor(f=null){super("LercWorker","_decode",{_decode:n=>[n.buffer]},f,{strategy:"dedicated"});this.schedule=f;this.ref=0}decode(f,n,k){return f&&0!==f.byteLength?
this.invoke({buffer:f,options:n},k):Promise.resolve(null)}release(){0>=--this.ref&&(d.forEach((f,n)=>{f===this&&d.delete(n)}),this.destroy())}}const d=new Map;b.acquireDecoder=function(f=null){let n=d.get(f);n||(null!=f?(n=new c(k=>f.immediate.schedule(k)),d.set(f,n)):(n=new c,d.set(null,n)));++n.ref;return n};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/core/workers/WorkerHandle":function(){define("exports ../arrayUtils ../handleUtils ../Logger ../promiseUtils ./workers".split(" "),
function(b,a,c,d,f,n){class k{constructor(g,q,e,m,l={}){this._mainMethod=q;this._transferLists=e;this._listeners=[];this._promise=n.open(g,{...l,schedule:m}).then(w=>{if(void 0===this._thread){this._thread=w;this._promise=null;l.hasInitialize&&this.broadcast({},"initialize");for(const v of this._listeners)this._connectListener(v)}else w.close()});this._promise.catch(w=>d.getLogger("esri.core.workers.WorkerHandle").error(`Failed to initialize ${g} worker: ${w}`))}on(g,q){const e={removed:!1,eventName:g,
callback:q,threadHandle:null};this._listeners.push(e);this._connectListener(e);return c.makeHandle(()=>{e.removed=!0;a.remove(this._listeners,e);this._thread&&null!=e.threadHandle&&e.threadHandle.remove()})}destroy(){this._thread&&(this._thread.close(),this._thread=null);this._promise=null;this._listeners.length=0;this._transferLists={}}invoke(g,q){return this.invokeMethod(this._mainMethod,g,q)}invokeMethod(g,q,e){if(this._thread){var m=this._transferLists[g];m=m?m(q):[];return this._thread.invoke(g,
q,{transferList:m,signal:e})}return this._promise?this._promise.then(()=>{f.throwIfAborted(e);return this.invokeMethod(g,q,e)}):Promise.reject(null)}broadcast(g,q){return this._thread?Promise.all(this._thread.broadcast(q,g)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(g,q)):Promise.reject()}get promise(){return this._promise}_connectListener(g){this._thread&&this._thread.on(g.eventName,g.callback).then(q=>{g.removed||(g.threadHandle=q)})}}b.WorkerHandle=k;Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/VectorTile":function(){define("exports ../../../../core/has ../../../../chunks/mat3 ../../../../chunks/mat3f32 ./enums ./RenderBucket ./decluttering/config ../webgl/TiledDisplayObject".split(" "),function(b,a,c,d,f,n,k,g){class q extends g.TiledDisplayObject{constructor(m,l,w,v,x,p,h,t=null){super(m,l,w,v,x,p,4096,4096);this.styleRepository=h;this._memCache=t;this.type="vector-tile";this._referenced=0;this._hasSymbolBuckets=
!1;this._memoryUsedByLayerData=0;this.layerData=new Map;this.status="loading";this.allSymbolsFadingOut=!1;this.lastOpacityUpdate=0;this.symbols=new Map;this.decluttered=this.neededForCoverage=this.isCoverage=!1;this.parentTile=null;this.childrenTiles=new Set;this._processed=!1;this._referenced=1;this.id=m.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<k.fadeDuration}get isHoldingForFade(){return this._hasSymbolBuckets&&
(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<k.fadeDuration)}get wasRequested(){return"errored"===this.status||"loaded"===this.status||"reloading"===this.status}setData(m){this.changeDataImpl(m);this.requestRender();this.ready();this._processed=!0}deleteLayerData(m){let l=!1;for(const w of m)if(m=this.layerData.get(w))this._memoryUsedByLayerData-=m.memoryUsed,m.type===f.BucketType.SYMBOL&&this.symbols.delete(w)&&(l=!0),m.destroy(),this.layerData.delete(w);this._memCache?.updateSize(this.key.id,
this,this._memoryUsedByLayerData);l&&this.emit("symbols-changed");this.requestRender()}processed(){return this._processed}hasData(){return 0<this.layerData.size}dispose(){"unloaded"!==this.status&&(e.delete(this),q._destroyRenderBuckets(this.layerData),this.layerData=null,this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return 0===--this._referenced?(this.dispose(),this.stage=null,!0):!1}retain(){++this._referenced}get referenced(){return this._referenced}get memoryUsed(){return this._memoryUsedByLayerData+
256}changeDataImpl(m){let l=!1;if(m){const {bucketsWithData:w,emptyBuckets:v}=m;m=this._createRenderBuckets(w);if(v&&0<v.byteLength){const x=new Uint32Array(v);for(const p of x)this._deleteLayerData(p)}for(const [x,p]of m)this._deleteLayerData(x),p.type===f.BucketType.SYMBOL&&(this.symbols.set(x,p.symbols),l=!0),this._memoryUsedByLayerData+=p.memoryUsed,this.layerData.set(x,p);this._memCache?.updateSize(this.key.id,this,this.memoryUsed)}this._hasSymbolBuckets=!1;for(const [,w]of this.layerData)w.type===
f.BucketType.SYMBOL&&(this._hasSymbolBuckets=!0);l&&this.emit("symbols-changed")}attachWithContext(m){this.stage={context:m,trashDisplayObject(l){l.processDetach()},untrashDisplayObject(){return!1}}}setTransform(m){super.setTransform(m);var l=this.resolution/(m.resolution*m.pixelRatio);const w=this.width/this.rangeX*l;l*=this.height/this.rangeY;const v=[0,0];m.toScreen(v,[this.x,this.y]);const x=this.transforms.tileUnitsToPixels;c.identity(x);c.translate(x,x,v);c.rotate(x,x,Math.PI*m.rotation/180);
c.scale(x,x,[w,l,1])}_createTransforms(){return{dvs:d.create(),tileMat3:d.create(),tileUnitsToPixels:d.create()}}static _destroyRenderBuckets(m){if(m){var l=new Set;for(const w of m.values())l.has(w)||(w.destroy(),l.add(w));m.clear()}}_createRenderBuckets(m){const l=new Map,w=new Map;for(const v of m){m=this._deserializeBucket(v,w);for(const x of m.layerUIDs)l.set(x,m)}return l}_deserializeBucket(m,l){let w=l.get(m);if(w)return w;switch((new Uint32Array(m))[0]){case f.BucketType.FILL:w=new n.FillRenderBucket(m,
this.styleRepository);break;case f.BucketType.LINE:w=new n.LineRenderBucket(m,this.styleRepository);break;case f.BucketType.SYMBOL:w=new n.SymbolRenderBucket(m,this.styleRepository,this);break;case f.BucketType.CIRCLE:w=new n.CircleRenderBucket(m,this.styleRepository)}l.set(m,w);return w}_deleteLayerData(m){if(this.layerData.has(m)){var l=this.layerData.get(m);this._memoryUsedByLayerData-=l.memoryUsed;l.destroy();this.layerData.delete(m)}}}const e=new Map;b.VectorTile=q;b.printAllocations=function(){e.forEach((m,
l)=>{console.log(`\n${l.key}:`);m[0].forEach(w=>console.log(w));console.log("\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d");m[1].forEach(w=>console.log(w))})};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/enums":function(){define(["exports"],function(b){b.BucketType=void 0;(function(a){a[a.FILL=1]="FILL";a[a.LINE=2]="LINE";a[a.SYMBOL=3]="SYMBOL";a[a.CIRCLE=4]="CIRCLE"})(b.BucketType||(b.BucketType={}));b.ShaderProgramType=void 0;(function(a){a[a.BACKGROUND=
0]="BACKGROUND";a[a.FILL=1]="FILL";a[a.OUTLINE=2]="OUTLINE";a[a.LINE=3]="LINE";a[a.ICON=4]="ICON";a[a.CIRCLE=5]="CIRCLE";a[a.TEXT=6]="TEXT";a[a.TILEINFO=7]="TILEINFO"})(b.ShaderProgramType||(b.ShaderProgramType={}));b.StyleUpdateType=void 0;(function(a){a[a.PAINTER_CHANGED=0]="PAINTER_CHANGED";a[a.LAYOUT_CHANGED=1]="LAYOUT_CHANGED";a[a.LAYER_CHANGED=2]="LAYER_CHANGED";a[a.LAYER_REMOVED=3]="LAYER_REMOVED";a[a.SPRITES_CHANGED=4]="SPRITES_CHANGED"})(b.StyleUpdateType||(b.StyleUpdateType={}));Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/RenderBucket":function(){define("exports ../../../../core/maybe ../../../../core/typedArrayUtil ./enums ./decluttering/util ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/VertexArrayObject".split(" "),function(b,a,c,d,f,n,k,g){class q{constructor(v,x){this.layerUIDs=[];this.isDestroyed=!1;this._data=v;let p=1;v=new Uint32Array(v);this.layerUIDs=[];const h=v[p++];for(let t=0;t<h;t++)this.layerUIDs[t]=v[p++];
this.bufferDataOffset=p;x&&(this.layer=x.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return null==this._data}get offset(){return this.bufferDataOffset}get data(){return this._data}destroy(){this.isDestroyed||(this.doDestroy(),this._data=null,this.isDestroyed=!0)}prepareForRendering(v){null!=this._data&&(this.doPrepareForRendering(v,this._data,this.bufferDataOffset),this._data=null)}}class e extends q{constructor(v,x){super(v,x);this.type=d.BucketType.LINE;this.lineIndexCount=
this.lineIndexStart=0;v=new Uint32Array(v);x=this.bufferDataOffset;this.lineIndexStart=v[x++];this.lineIndexCount=v[x++];const p=v[x++];if(0<p){this.patternMap=new Map;for(let h=0;h<p;h++){const t=v[x++],r=v[x++],u=v[x++];this.patternMap.set(t,[r,u])}}this.bufferDataOffset=x}get memoryUsed(){return(this.data?.byteLength??0)+(this.vao?.usedMemory??0)}hasData(){return 0<this.lineIndexCount}triangleCount(){return this.lineIndexCount/3}doDestroy(){this.vao=a.disposeMaybe(this.vao)}doPrepareForRendering(v,
x,p){var h=new Uint32Array(x);x=new Int32Array(h.buffer);var t=h[p++];x=n.BufferObject.createVertex(v,k.Usage.STATIC_DRAW,new Int32Array(x.buffer,4*p,t));p+=t;t=h[p++];h=n.BufferObject.createIndex(v,k.Usage.STATIC_DRAW,new Uint32Array(h.buffer,4*p,t));p+=t;p=this.layer.lineMaterial;this.vao=new g.VertexArrayObject(v,p.getAttributeLocations(),p.getLayoutInfo(),{geometry:x},h)}}class m extends q{constructor(v,x){super(v,x);this.type=d.BucketType.FILL;this.outlineIndexCount=this.outlineIndexStart=this.fillIndexCount=
this.fillIndexStart=0;v=new Uint32Array(v);x=this.bufferDataOffset;this.fillIndexStart=v[x++];this.fillIndexCount=v[x++];this.outlineIndexStart=v[x++];this.outlineIndexCount=v[x++];const p=v[x++];if(0<p){this.patternMap=new Map;for(let h=0;h<p;h++){const t=v[x++],r=v[x++],u=v[x++];this.patternMap.set(t,[r,u])}}this.bufferDataOffset=x}get memoryUsed(){return(this.data?.byteLength??0)+(this.fillVAO?.usedMemory??0)+(this.outlineVAO?.usedMemory??0)}hasData(){return 0<this.fillIndexCount||0<this.outlineIndexCount}triangleCount(){return(this.fillIndexCount+
this.outlineIndexCount)/3}doDestroy(){this.fillVAO=a.disposeMaybe(this.fillVAO);this.outlineVAO=a.disposeMaybe(this.outlineVAO)}doPrepareForRendering(v,x,p){var h=new Uint32Array(x),t=new Int32Array(h.buffer),r=h[p++];x=n.BufferObject.createVertex(v,k.Usage.STATIC_DRAW,new Int32Array(t.buffer,4*p,r));p+=r;var u=h[p++];r=n.BufferObject.createIndex(v,k.Usage.STATIC_DRAW,new Uint32Array(h.buffer,4*p,u));p+=u;u=h[p++];t=n.BufferObject.createVertex(v,k.Usage.STATIC_DRAW,new Int32Array(t.buffer,4*p,u));
p+=u;u=h[p++];h=n.BufferObject.createIndex(v,k.Usage.STATIC_DRAW,new Uint32Array(h.buffer,4*p,u));p+=u;u=this.layer;p=u.fillMaterial;u=u.outlineMaterial;this.fillVAO=new g.VertexArrayObject(v,p.getAttributeLocations(),p.getLayoutInfo(),{geometry:x},r);this.outlineVAO=new g.VertexArrayObject(v,u.getAttributeLocations(),u.getLayoutInfo(),{geometry:t},h)}}class l extends q{constructor(v,x,p){super(v,x);this.type=d.BucketType.SYMBOL;this.iconPerPageElementsMap=new Map;this.glyphPerPageElementsMap=new Map;
this.symbolInstances=[];this.opacityChanged=this.isIconSDF=!1;this.lastOpacityUpdate=0;this.symbols=[];x=new Uint32Array(v);const h=new Int32Array(v);v=new Float32Array(v);let t=this.bufferDataOffset;this.isIconSDF=!!x[t++];var r=x[t++];for(var u=0;u<r;u++){var y=x[t++],z=x[t++],A=x[t++];this.iconPerPageElementsMap.set(y,[z,A])}r=x[t++];for(u=0;u<r;u++)y=x[t++],z=x[t++],A=x[t++],this.glyphPerPageElementsMap.set(y,[z,A]);r=x[t++];u=x[t++];this.iconOpacity=new Int32Array(r);this.textOpacity=new Int32Array(u);
this.bufferDataOffset=t=f.deserializeSymbols(x,h,v,t,this.symbols,p)}get memoryUsed(){return(this.data?.byteLength??0)+(this.iconVAO?.usedMemory??0)+(this.textVAO?.usedMemory??0)+c.estimateSize(this.iconOpacity)+c.estimateSize(this.textOpacity)}hasData(){return 0<this.iconPerPageElementsMap.size||0<this.glyphPerPageElementsMap.size}triangleCount(){let v=0;for(const [,x]of this.iconPerPageElementsMap)v+=x[1];for(const [,x]of this.glyphPerPageElementsMap)v+=x[1];return v/3}doDestroy(){this.iconVAO=
a.disposeMaybe(this.iconVAO);this.textVAO=a.disposeMaybe(this.textVAO)}updateOpacityInfo(){if(this.opacityChanged){this.opacityChanged=!1;var v=this.iconOpacity,x=this.iconVAO.vertexBuffers.opacity;0<v.length&&v.byteLength===x.byteLength&&x.setSubData(v,0,0,v.length);v=this.textOpacity;x=this.textVAO.vertexBuffers.opacity;0<v.length&&v.byteLength===x.byteLength&&x.setSubData(v,0,0,v.length)}}doPrepareForRendering(v,x,p){var h=new Uint32Array(x),t=new Int32Array(h.buffer),r=h[p++];x=n.BufferObject.createVertex(v,
k.Usage.STATIC_DRAW,new Int32Array(t.buffer,4*p,r));p+=r;var u=h[p++];r=n.BufferObject.createIndex(v,k.Usage.STATIC_DRAW,new Uint32Array(h.buffer,4*p,u));p+=u;u=h[p++];t=n.BufferObject.createVertex(v,k.Usage.STATIC_DRAW,new Int32Array(t.buffer,4*p,u));p+=u;u=h[p++];h=n.BufferObject.createIndex(v,k.Usage.STATIC_DRAW,new Uint32Array(h.buffer,4*p,u));p+=u;p=n.BufferObject.createVertex(v,k.Usage.STATIC_DRAW,this.iconOpacity.buffer);u=n.BufferObject.createVertex(v,k.Usage.STATIC_DRAW,this.textOpacity.buffer);
var y=this.layer;const z=y.iconMaterial;y=y.textMaterial;this.iconVAO=new g.VertexArrayObject(v,z.getAttributeLocations(),z.getLayoutInfo(),{geometry:x,opacity:p},r);this.textVAO=new g.VertexArrayObject(v,y.getAttributeLocations(),y.getLayoutInfo(),{geometry:t,opacity:u},h)}}class w extends q{constructor(v,x){super(v,x);this.type=d.BucketType.CIRCLE;this.circleIndexCount=this.circleIndexStart=0;v=new Uint32Array(v);x=this.bufferDataOffset;this.circleIndexStart=v[x++];this.circleIndexCount=v[x++];
this.bufferDataOffset=x}get memoryUsed(){return(this.data?.byteLength??0)+(this.vao?.usedMemory??0)}hasData(){return 0<this.circleIndexCount}triangleCount(){return this.circleIndexCount/3}doDestroy(){this.vao=a.disposeMaybe(this.vao)}doPrepareForRendering(v,x,p){var h=new Uint32Array(x);x=new Int32Array(h.buffer);var t=h[p++];x=n.BufferObject.createVertex(v,k.Usage.STATIC_DRAW,new Int32Array(x.buffer,4*p,t));p+=t;t=h[p++];h=n.BufferObject.createIndex(v,k.Usage.STATIC_DRAW,new Uint32Array(h.buffer,
4*p,t));p+=t;p=this.layer.circleMaterial;this.vao=new g.VertexArrayObject(v,p.getAttributeLocations(),p.getLayoutInfo(),{geometry:x},h)}}b.CircleRenderBucket=w;b.FillRenderBucket=m;b.LineRenderBucket=e;b.RenderBucketBase=q;b.SymbolRenderBucket=l;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/util":function(){define(["exports","../enums","./core"],function(b,a,c){class d{constructor(f,n,k){this._rows=Math.ceil(n/k);this._columns=Math.ceil(f/
k);this._cellSize=k;this.cells=Array(this._rows);for(f=0;f<this._rows;f++)for(this.cells[f]=Array(this._columns),n=0;n<this._columns;n++)this.cells[f][n]=[]}getCell(f,n){n=Math.min(Math.max(Math.floor(n/this._cellSize),0),this._rows-1);f=Math.min(Math.max(Math.floor(f/this._cellSize),0),this._columns-1);return this.cells[n]&&this.cells[n][f]||null}getCellSpan(f,n,k,g){return[Math.min(Math.max(Math.floor(f/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(n/this._cellSize),0),this.rows-
1),Math.min(Math.max(Math.floor(k/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(g/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}}b.GridIndex=d;b.deserializeSymbols=function(f,n,k,g,q,e){const m=n[g++];for(let v=0;v<m;v++){const x=new c.VTLSymbol(e);x.xTile=n[g++];x.yTile=n[g++];x.hash=n[g++];x.priority=n[g++];var l=n[g++];for(var w=0;w<l;w++){const p=n[g++],h=n[g++],t=n[g++],r=n[g++],u=!!n[g++],
y=n[g++],z=k[g++],A=k[g++],C=n[g++],E=n[g++];x.colliders.push({xTile:p,yTile:h,dxPixels:t,dyPixels:r,hard:u,partIndex:y,width:C,height:E,minLod:z,maxLod:A})}l=f[g++];for(w=0;w<l;w++)x.textVertexRanges.push([f[g++],f[g++]]);l=f[g++];for(w=0;w<l;w++)x.iconVertexRanges.push([f[g++],f[g++]]);q.push(x)}return g};b.tileCoordChange=function(f,n,k,g,q,e){k-=q;if(0<=k)return(n>>k)+(g-(e<<k))*(f>>k);k=-k;return n-(e-(g<<k))*(f>>k)<<k};b.writeOpacityToBuffers=function(f,n,k){for(const [v,x]of f.symbols){{var g=
f,q=n,e=k,m=x;const p=g.layerData.get(v);if(p.type===a.BucketType.SYMBOL){for(const h of m){m=h.unique;var l=void 0;if(h.selectedForRendering){var w=m.parts[0];l=w.startOpacity;w=w.targetOpacity;g.allSymbolsFadingOut=g.allSymbolsFadingOut&&0===w;l=e?Math.floor(127*l)|w<<7:w?255:0;l|=l<<24|l<<16|l<<8}else l=0;for(const [t,r]of h.iconVertexRanges)for(w=t;w<t+r;w+=4)p.iconOpacity[w/4]=l;h.selectedForRendering?(l=m.parts[1],m=l.startOpacity,l=l.targetOpacity,g.allSymbolsFadingOut=g.allSymbolsFadingOut&&
0===l,m=e?Math.floor(127*m)|l<<7:l?255:0,l=m<<24|m<<16|m<<8|m):l=0;for(const [t,r]of h.textVertexRanges)for(m=t;m<t+r;m+=4)p.textOpacity[m/4]=l}p.lastOpacityUpdate=q;p.opacityChanged=!0}}}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/core":function(){define(["exports"],function(b){class a{constructor(d){this.hash=this.yTile=this.xTile=0;this.priority=1;this.colliders=[];this.textVertexRanges=[];this.iconVertexRanges=[];this.tile=d}}
class c{constructor(){this.tileSymbols=[];this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}];this.show=!1}}b.VTLSymbol=a;b.VTLUniqueSymbol=c;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/config":function(){define(["exports"],function(b){b.collisionGridCellSize=32;b.declutterBudget=1.5;b.declutterTiles=!0;b.fadeDuration=200;Object.defineProperty(b,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/engine/webgl/TiledDisplayObject":function(){define(["exports","../../../../chunks/mat3","../DisplayObject","../../tiling/TileKey"],function(b,a,c,d){class f extends c.DisplayObject{constructor(n,k,g,q,e,m,l=e,w=m){super();this.triangleCount=this.triangleCountReportedInDebug=0;this.texture=null;this.key=new d(n);this.resolution=k;this.x=g;this.y=q;this.width=e;this.height=m;this.rangeX=l;this.rangeY=w}destroy(){this.texture&&(this.texture.dispose(),this.texture=
null)}setTransform(n){const k=this.resolution/(n.resolution*n.pixelRatio),g=this.transforms.tileMat3,[q,e]=n.toScreenNoRotation([0,0],[this.x,this.y]);a.set(g,this.width/this.rangeX*k,0,0,0,this.height/this.rangeY*k,0,q,e,1);a.multiply(this.transforms.dvs,n.displayViewMat3,g)}}b.TiledDisplayObject=f;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/DisplayObject":function(){define(["exports","../../../core/Evented","../../../core/has","../../../core/promiseUtils"],
function(b,a,c,d){const f=1/c("mapview-transitions-duration");class n extends a{constructor(){super(...arguments);this._clips=this._fadeInResolver=this._fadeOutResolver=null;this.computedVisible=!0;this.computedOpacity=1;this._isReady=this.inFadeTransition=this.fadeTransitionEnabled=!1;this._opacity=1;this._stage=this.parent=null;this._visible=!0}get clips(){return this._clips}set clips(k){this._clips=k;this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(k){this._opacity!==
k&&(this._opacity=Math.min(1,Math.max(k,0)),this.requestRender())}get stage(){return this._stage}set stage(k){if(this._stage!==k){var g=this._stage;(this._stage=k)?this._stage?.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):g?.trashDisplayObject(this)}}get transforms(){return this._getTransforms()}_getTransforms(){null==this._transforms&&(this._transforms=this._createTransforms());return this._transforms}get visible(){return this._visible}set visible(k){this._visible!==k&&(this._visible=
k,this.requestRender())}get hasLabels(){return!1}get hasHighlight(){return!1}get hasBlending(){return!1}fadeIn(){if(this._fadeInResolver)return this._fadeInResolver.promise;this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null);this.opacity=1;this.computedOpacity=0;this.fadeTransitionEnabled=!0;this._fadeInResolver=d.createResolver();this.requestRender();return this._fadeInResolver.promise}fadeOut(){if(this._fadeOutResolver)return this._fadeOutResolver.promise;this.opacity=0;
this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null);this.fadeTransitionEnabled=!0;this._fadeOutResolver=d.createResolver();this.requestRender();return this._fadeOutResolver.promise}endTransitions(){this._fadeInResolver?.();this._fadeInResolver=null;this._fadeOutResolver?.();this._fadeOutResolver=null;this.computedOpacity=this.visible?this.opacity:0;this.requestRender()}beforeRender(k){this.updateTransitionProperties(k.deltaTime,k.state.scale);this.setTransform(k.state)}afterRender(k){this._fadeInResolver&&
this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&0===this.computedOpacity&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){this.parent?.removeChild(this)}setTransform(k){}processRender(k){this.stage&&this.computedVisible&&this.doRender(k)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null);this._fadeOutResolver&&(this._fadeOutResolver(),
this._fadeOutResolver=null);this.onDetach();this.emit("detach")}updateTransitionProperties(k,g){if(this.fadeTransitionEnabled){g=this._fadeOutResolver||!this.visible?0:this.opacity;const q=this.computedOpacity;q===g?this.computedVisible=this.visible:(k*=f,this.computedOpacity=q>g?Math.max(g,q-k):Math.min(g,q+k),this.computedVisible=0<this.computedOpacity,k=g===this.computedOpacity,this.inFadeTransition=!k,k||this.requestRender())}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(k){}ready(){this._isReady||
(this._isReady=!0,this.emit("isReady"),this.requestRender())}}b.DisplayObject=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/tiling/TileKey":function(){define(["../../../core/ObjectPool"],function(b){class a{static getId(c,d,f,n){return"object"===typeof c?`${c.level}/${c.row}/${c.col}/${c.world}`:`${c}/${d}/${f}/${n}`}constructor(c,d,f,n){this.set(c,d,f,n)}get key(){return this}get id(){return this.toString()}set id(c){this.set(c)}get hash(){return(this.world&3)<<
30|(this.col&4095)<<22|(this.row&4095)<<8|this.level&63}acquire(c,d,f,n){this.set(c,d,f,n)}contains(c){const d=c.level-this.level;return 0<=d&&this.row===c.row>>d&&this.col===c.col>>d&&this.world===c.world}equals(c){return this.level===c.level&&this.row===c.row&&this.col===c.col&&this.world===c.world}clone(){return new a(this)}release(){this.world=this.col=this.row=this.level=0}set(c,d,f,n){if(null==c)this.world=this.col=this.row=this.level=0;else if("object"===typeof c)this.level=c.level||0,this.row=
c.row||0,this.col=c.col||0,this.world=c.world||0;else if("string"===typeof c){const [k,g,q,e]=c.split("/");this.level=parseFloat(k);this.row=parseFloat(g);this.col=parseFloat(q);this.world=parseFloat(e)}else this.level=+c,this.row=+d,this.col=+f,this.world=+n||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return 0>=this.level?null:new a(this.level-1,this.row>>1,this.col>>1,this.world)}getChildKeys(){const c=this.level+1,d=this.row<<1,f=this.col<<
1,n=this.world;return[new a(c,d,f,n),new a(c,d,f+1,n),new a(c,d+1,f,n),new a(c,d+1,f+1,n)]}compareRowMajor(c){return this.row<c.row?-1:this.row>c.row?1:this.col<c.col?-1:this.col>c.col?1:0}}a.pool=new b(a,null,null,25,50);return a})},"esri/views/3d/support/updatingProperties":function(){define(["exports"],function(b){b.updatingProgress={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};b.updatingProgressValue={value:.5,readOnly:!0};Object.defineProperty(b,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/terrain/ElevationBounds":function(){define(["exports"],function(b){class a{constructor(c=0,d=0){this.min=c;this.max=d;this.level=0;this.hasNoDataValues=!1}copyFrom(c){this.min=c.min;this.max=c.max;this.level=c.level;this.hasNoDataValues=c.hasNoDataValues}}b.ElevationBounds=a;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/ElevationData":function(){define(["exports","../../../core/mathUtils","../../../layers/support/ElevationSamplerData",
"../support/mathUtils","./TerrainConst"],function(b,a,c,d,f){class n{constructor(g,q,e){this.type="elevation";this.level=g[0];this.i=g[1];this.j=g[2];this.extent=q;this.samplerData=new c.ElevationSamplerData(e,q)}computeMinMaxValue(g,q,e,m){m.min=Infinity;m.max=-Infinity;m.hasNoDataValues=!1;g-=this.level;if(0>=g)return m;var l=2**g;if(Math.floor(q/l)!==this.i||Math.floor(e/l)!==this.j)return m;var w=Infinity,v=-Infinity,x=this.samplerData.data.width,p=this.samplerData.data.values,h=.5*f.elevationNodataValue;
g=(x-1)/l;e=(e-this.j*l)*g;let t=(q-this.i*l)*g;if(1>g){const y=Math.floor(e),z=Math.floor(t);var r=y+z*x;q=p[r];l=p[r+1];var u=p[r+x];r=p[r+x+1];if(q+l+u+r<h)return w=e-y,h=t-z,v=d.bilerp(q,l,u,r,w,h),x=d.bilerp(q,l,u,r,w+g,h),p=d.bilerp(q,l,u,r,w,h+g),g=d.bilerp(q,l,u,r,w+g,h+g),m.min=Math.min(v,x,p,g),m.max=Math.max(v,x,p,g),m;e=y;t=z;g=1}else e=Math.floor(e),t=Math.floor(t),g=Math.ceil(g);for(q=e;q<=e+g;q++)for(l=t;l<=t+g;l++)u=p[q+l*x],u<h?(w=Math.min(w,u),v=Math.max(v,u)):m.hasNoDataValues=
!0;m.min=w;m.max=v;return m}}const k=.5*f.elevationNodataValue;b.ElevationData=n;b.sampleElevation=function(g,q,e){if(null==e)return null;for(const x of e){if(!x)continue;var m=x.safeWidth;e=a.clamp(x.dy*(x.y1-q),0,m);m=a.clamp(x.dx*(g-x.x0),0,m);const p=Math.floor(e),h=Math.floor(m);var l=x.data.width,w=p*l+h,v=x.data.values;const t=v[w],r=v[w+1];w+=l;l=v[w];v=v[w+1];if(t+l+r+v<k)return e-=p,m-=h,g=t+(r-t)*m,g+(l+(v-l)*m-g)*e}return null};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/layers/support/ElevationSamplerData":function(){define(["exports"],function(b){class a{constructor(c,d){this.data=c;this.safeWidth=.99999999*(c.width-1);this.dx=(c.width-1)/(d[2]-d[0]);this.dy=(c.width-1)/(d[3]-d[1]);this.x0=d[0];this.y1=d[3]}}b.ElevationSamplerData=a;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/ExtentHelper":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../geometry/projection ../../../geometry/support/aaBoundingRect ../../../layers/support/layerUtils ../../ViewingMode ./TerrainConst ./terrainUtils".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v){function x(t,r){return null==t||t.spatialReference.equals(r)?t:q.projectWithoutEngine(t,t.spatialReference,r)}b.ExtentHelper=class extends c{constructor(t){super(t)}initialize(){this.addHandles([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const t=
[];this.layerViews.forEach(r=>{r=r.layer;"IntegratedMeshLayer"===r.operationalLayerType&&null!=this.viewSpatialReference&&(r=x(r.fullExtent,this.viewSpatialReference),null!=r&&t.push(e.fromExtent(r)))});return t}};a.__decorate([d.property({readOnly:!0})],b.ExtentHelper.prototype,"layerViewsExtent",null);a.__decorate([d.property({readOnly:!0})],b.ExtentHelper.prototype,"tiledLayersExtent",null);a.__decorate([d.property({readOnly:!0})],b.ExtentHelper.prototype,"stencilEnabledExtents",null);a.__decorate([d.property()],
b.ExtentHelper.prototype,"viewSpatialReference",void 0);a.__decorate([d.property()],b.ExtentHelper.prototype,"tilingScheme",void 0);a.__decorate([d.property()],b.ExtentHelper.prototype,"defaultTiledLayersExtent",void 0);a.__decorate([d.property({constructOnly:!0})],b.ExtentHelper.prototype,"layers",void 0);a.__decorate([d.property({constructOnly:!0})],b.ExtentHelper.prototype,"layerViews",void 0);b.ExtentHelper=a.__decorate([g.subclass("esri.views.3d.terrain.ExtentHelper")],b.ExtentHelper);let p=
class extends b.ExtentHelper{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?w.webmercatorWorldExtent:w.geographicWorldExtent}};p=a.__decorate([g.subclass("esri.views.3d.terrain.ExtentHelperGlobal")],p);let h=class extends b.ExtentHelper{_computeLayerViewsExtent(){const t=e.empty(),r=this.viewSpatialReference;this.layerViews.forEach(z=>{const A=z.layer;!z.isResolved()||"graphics"===
A.type&&A.internal||(z=x("fullExtentInLocalViewSpatialReference"in z&&z.fullExtentInLocalViewSpatialReference||z.layer.fullExtent,r),e.expand(t,z,t))});const u=e.allFinite(t)?t:null,y=this._get("layerViewsExtent");return e.equals(u,y)?y:u}_computeTiledLayersExtent(){const t=this.tilingScheme;if(!t)return null;const r=this.viewSpatialReference,u=e.empty();this.layers.forEach(A=>{if(A.loaded&&m.isTiledLayer(A)){const B=v.getTiledLayerInfo(A,r,l.ViewingMode.Local);if(null!=B){var {tileInfo:C,fullExtent:E}=
B;null!=C&&null!=E&&(v.isProjectableRasterLayer(A)||t.compatibleWith(C)&&E.spatialReference.equals(t.spatialReference))&&e.expand(u,E,u)}}});e.expand(u,this.defaultTiledLayersExtent,u);const y=e.allFinite(u)?u:null,z=this._get("tiledLayersExtent");return e.equals(y,z)?z:y}};h=a.__decorate([g.subclass("esri.views.3d.terrain.ExtentHelperLocal")],h);b.create=function(t,r){return t===l.ViewingMode.Global?new p(r):new h(r)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/LayerClass":function(){define(["exports"],
function(b){b.LayerClass=void 0;var a=b.LayerClass||(b.LayerClass={});a[a.ELEVATION=0]="ELEVATION";a[a.MAP=1]="MAP";b.LayerClasses=[b.LayerClass.ELEVATION,b.LayerClass.MAP];Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/OverlayManager":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Cyclical ../../../core/has ../../../core/mathUtils ../../../core/reactiveUtils ../../../core/time ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec2 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../chunks/vec4f64 ../../../geometry/ellipsoidUtils ../../../geometry/projection/projectVectorToVector ../../../geometry/support/aaBoundingRect ../../../geometry/support/ray ../../../chunks/sphere ../../../geometry/support/vector ../../../geometry/support/webMercatorUtils ../state/utils/viewUtils ../support/debugFlags ../support/debugUtils ./interfaces ./OverlayRenderer ../webgl-engine/lib/basicInterfaces ../webgl-engine/lib/Intersector ../webgl-engine/lib/LocalOriginFactory ../webgl-engine/lib/Material ../webgl-engine/lib/SortedRenderGeometryRenderer ../webgl-engine/lib/textureUtils ../webgl-engine/parts/requireUtils ../../support/Scheduler".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A,C,E,B,D,F,K,L,G,O,P,J,R,X,U){const M=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let V;b.OverlayManager=class extends c{get running(){return this._placementDirty&&(0<this._drapeSources.size||0<this.view.graphics.length||B.debugFlags.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this.view.state.isGlobal}get _worldToPCSRatio(){return null!=
this._spatialReference&&this._spatialReference.isGeographic&&!this.view.state.isLocal?t.getReferenceEllipsoid(this._spatialReference).metersPerDegree:1}get _overlayStretch(){return 1.3/this.view.resolutionScale}get suspended(){return this.surface.suspended}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get rendersOccluded(){return this.renderer.rendersOccluded}constructor(aa){super(aa);this._renderSR=this._spatialReference=null;this._overlaySREqualsRenderSR=!0;this._drapeSources=
new Set;this._drapeTargets=new Set;this._drawTexturesAnimateDirty=this._drawTexturesDirty=this._contentUpdated=this._placementDirty=!1;this._longitudeCyclical=null;this._latestOriginId=0;this._maxResolution=f("esri-mobile")?2048:4096;this._animationTimeLast=0}initialize(){const aa=this.view;this.renderer=new K.OverlayRenderer({view:aa,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference});aa._stage.renderer.renderPlugins.add(this.renderer);const Z=()=>this.setDrawTexturesDirty();
this._groundIntersector=G.newIntersector(this.view.state.viewingMode);this._groundIntersector.options.backfacesTerrain=!0;this._groundIntersector.options.invisibleTerrain=!0;this._groundIntersector.options.hud=!1;this.addHandles([k.watch(()=>this.renderer.hasHighlights,Z),this.renderer.events.on("has-water",da=>aa._stage?.renderer.setParameters({hasOverlayWater:da})),this.renderer.events.on("renders-occluded",()=>{Z();this.notifyChange("rendersOccluded")}),this.renderer.events.on("content-changed",
Z),k.watch(()=>aa.state.camera.pixelRatio,Z),k.watch(()=>aa.state.alignPixelEnabled,Z),this.renderer.events.on("textures-disposed",()=>this.surface.requestRender()),k.watch(()=>[aa.pointsOfInterest?.renderPointOfView,aa.pointsOfInterest?.centerOnSurfaceFrequent?.location],()=>this.setPlacementDirty()),k.watch(()=>[aa.state?.pixelRatio,aa.state?.contentPixelRatio],()=>this.setPlacementDirty(),k.sync),this.surface.on("elevation-change",()=>this.setPlacementDirty()),aa.on("resize",()=>this.setPlacementDirty()),
aa.resourceController.scheduler.registerTask(U.TaskPriority.OVERLAY,this),aa._stage.renderView.events.on("force-camera-for-screenshot",da=>{this._updateOverlays(U.noBudget,da.camera,L.RenderRequestType.BACKGROUND);this.renderer.hasOverlays&&this._drawOverlays(L.RenderRequestType.BACKGROUND,da)})]);aa._stage.renderer.renderOverlay=da=>this._renderOverlay(da)}_renderOverlay(aa){this._contentUpdated=!1;this.renderer.processSyncDrapeSources();if(this.renderer.hasOverlays)return this._dispatchAnimationUpdate(aa),
this._drawOverlays(L.RenderRequestType.UPDATE,this.view.state)}destroy(){this.view?._stage&&(this.view._stage.renderer.renderPlugins.remove(this.renderer),this.view._stage.renderer.renderOverlay=()=>{});V&&(V.hide(),V=null)}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(aa){this._spatialReference=aa;this.renderer.spatialReference=aa;this._longitudeCyclical=null;const Z=this.view.renderSpatialReference;null!=aa&&null!=Z?(this._renderSR=Z,this._overlaySREqualsRenderSR=aa.equals(this._renderSR),
this._isSpherical&&(this._longitudeCyclical=aa.isWebMercator?new d.Cyclical(-2.0037508342787E7,2.0037508342787E7):new d.Cyclical(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()}registerDrapeSource(aa,Z,da){this._drapeSources.add(aa);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);Z=this.renderer.createDrapeSourceRenderer(aa,Z,da);this._updateDrapeSourceExtent(aa);
this._setContentDirty();this.notifyChange("running");return Z}registerGeometryDrapeSource(aa){return this.registerDrapeSource(aa,J.SortedRenderGeometryRenderer)}_updateDrapeSourceExtent(aa){2===this.renderer.overlays.length&&null!=aa.setDrapingExtent&&null!=this._spatialReference&&aa.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(aa){this._drapeSources.has(aa)&&(this._drapeSources.delete(aa),this.renderer.removeDrapeSourceRenderer(aa),this.renderer.ensureDrapeSources(this._drapeSources),
this._setContentDirty(),this.notifyChange("running"))}registerDrapeTarget(aa){this._drapeTargets.add(aa);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}unregisterDrapeTarget(aa){this._drapeTargets.delete(aa);this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty();this.setDrawTexturesDirty()}setPlacementDirty(){this._placementDirty=!0}runTask(aa){return this._updateOverlays(aa,this.view.state.contentCamera,L.RenderRequestType.UPDATE)}_updateOverlays(aa,
Z,da){if(!this._spatialReference)return U.Task.YIELD;var fa=this._computeOverlayResolution(Z);this._computeOverlayExtents(Z,fa,S);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources,S.stretch);Z=this._updateOverlay(F.OverlayIndex.INNER,S.inner,fa,1*S.pixelRatioAdjustment,S.mapUnitsPerPixel);const ka=u.width(S.inner)/u.width(S.outer);fa=this._updateOverlay(F.OverlayIndex.OUTER,S.outer,fa,ka*S.pixelRatioAdjustment,S.mapUnitsPerPixel);if(Z===T.EXTENT||fa===T.EXTENT)this._drapeSources.forEach(ha=>
this._updateDrapeSourceExtent(ha)),this.surface.updateTileOverlayParams(da);Z===T.NONE&&fa===T.NONE||this.setDrawTexturesDirty();this._placementDirty=!1;aa.madeProgress()}_computeOverlayResolution(aa){const Z=this.view.state.contentPixelRatio*this.view.resolutionScale;return Math.min(R.applyTextureResizeModulo(Math.ceil(1.5*Math.max(aa.fullWidth/aa.pixelRatio*Z,aa.fullHeight/aa.pixelRatio*Z))),this._maxResolution)}_updateOverlay(aa,Z,da,fa,ka){if(0===this.renderer.overlays.length)return T.NONE;aa=
this.renderer.overlays[aa];const ha=aa.mapUnitsPerPixel;aa.mapUnitsPerPixel=ka;aa.pixelRatio=fa;fa=aa.extent;const ba=B.debugFlags.TESTS_DISABLE_OPTIMIZATIONS?0:1E-5*Math.max(Z[2]-Z[0],Z[3]-Z[1],fa[2]-fa[0],fa[3]-fa[1]);if(Math.abs(fa[0]-Z[0])<=ba&&Math.abs(fa[1]-Z[1])<=ba&&Math.abs(fa[2]-Z[2])<=ba&&Math.abs(fa[3]-Z[3])<=ba&&da===aa.resolution)return ha===ka?T.NONE:T.RERENDER_ONLY;u.copy(aa.extent,Z);aa.resolution=da;Z=u.center(aa.extent);aa.renderLocalOrigin=O.fromValues(Z[0],Z[1],0,`OV_${this._latestOriginId++}`);
return T.EXTENT}setTileParameters(aa){const Z=aa.renderData.overlay;if(0<this.renderer.overlays.length){const da=this.renderer.overlays[F.OverlayIndex.INNER],fa=this.renderer.overlays[F.OverlayIndex.OUTER];aa=aa.extent;this._rectInsideRect(da.extent,aa)||this._rectanglesOverlap(aa,da.extent)||this._rectanglesOverlap(aa,fa.extent)?(this._setTileOverlayData(aa,F.OverlayIndex.INNER,Z),this._setTileOverlayData(aa,F.OverlayIndex.OUTER,Z)):(this._clearTileOverlayData(F.OverlayIndex.INNER,Z),this._clearTileOverlayData(F.OverlayIndex.OUTER,
Z))}else this._clearTileOverlayData(F.OverlayIndex.INNER,Z),this._clearTileOverlayData(F.OverlayIndex.OUTER,Z)}overlayPixelSizeInMapUnits(aa,Z){if(0===this.renderer.overlays.length)return Z();Z=this.renderer.overlays[F.OverlayIndex.INNER];const da=this.renderer.overlays[F.OverlayIndex.OUTER];aa=this._pointIsInExtent(aa,Z.extent)?Z:da;return(aa.extent[2]-aa.extent[0])/aa.resolution}_setTileOverlayData(aa,Z,da){if(0!==this.renderer.overlays.length){var fa=this.renderer.overlays[Z].extent,ka=u.width(fa),
ha=u.height(fa),ba=aa[0];if(this._longitudeCyclical){ba=this._longitudeCyclical.minimalMonotonic(fa[0],ba);const ea=this._longitudeCyclical.minimalMonotonic(fa[0],aa[2]);ba>ea&&(ba=ea-(aa[2]-aa[0]))}da.setScale(Z,u.width(aa)/ka,u.height(aa)/ha);da.setOffset(Z,(ba-fa[0])/ka,(aa[1]-fa[1])/ha)}}_clearTileOverlayData(aa,Z){Z.setScale(aa,-1,-1);Z.setOffset(aa,-1,-1)}async reloadShaders(){X.removeLoadedShaderModules();await this.renderer.reloadShaders();this.setDrawTexturesDirty();this.runTask(U.noBudget)}_dispatchAnimationUpdate(aa){var Z=
g.Milliseconds(aa-this._animationTimeLast);if(Z>=this.surface.view._stage.renderer.animationTimestep||null!=this.view.state.forcedAnimationTime||this._drawTexturesDirty||this._drawTexturesAnimateDirty)Z=g.Milliseconds(Z/this.surface.view._stage.renderer.animationTimeDilation),Z=new P.UpdateParameters(this.view.state.camera,Z,this.view.state.forcedAnimationTime),this.renderer.updateAnimation(Z)&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=aa}setDrawTexturesDirty(){this.renderer.hasOverlays?
(this._drawTexturesDirty=this._contentUpdated=!0,this.view._stage.renderView.requestRender()):this.setPlacementDirty()}_intersectGroundFromView(aa,Z,da,fa){da=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(aa,N,Z,da);if(null==da)return!1;Z=da.origin;da=v.add(H,da.origin,da.direction);this._groundIntersector.reset(Z,da,aa);this._groundIntersector.intersect([]);this.view.basemapTerrain.intersect(this._groundIntersector,null,Z,da);return this._groundIntersector.results.min.getIntersectionPoint(fa)}_findHorizonBasedPointOfInterest(aa,
Z){var da=.5;da=this.view.renderCoordsHelper.getAltitude(aa.eye);const fa=this.view.pointsOfInterest.centerOnSurfaceFrequent;var ka=n.clamp(fa.estimatedSurfaceAltitude,aa.aboveGround?-Infinity:da+1E-5,aa.aboveGround?da-1E-5:Infinity);da=aa.aboveGround;if("global"===this.view.viewingMode){var ha=H;z.closestPointOnSilhouette(z.fromRadius(z.tmpSphere,t.getReferenceEllipsoid(this.view.spatialReference).radius+ka),y.wrap(aa.eye,aa.viewForward),ha);v.subtract(ha,ha,aa.eye);ka=d.cyclicalPI.normalize(A.angleAroundAxis(aa.viewForward,
ha,aa.viewRight))/aa.fovY+.5;ha=0>=ka||1<=ka?.5:.55;da=da?ha*ka:ka+ha*(1-ka)}else ka=h.fromValues(0,Math.tan(.5*Math.PI-Math.acos(-aa.viewForward[2])),1,0),ka=p.transformMat4(ka,ka,aa.projectionMatrix)[1],ka=n.clamp(.5+.5*ka,0,1),da=1===ka||0===ka?.5:da?.55*ka:1-.55*(1-ka);return this._intersectGroundFromView(aa,.5,da,Z)?v.sqrDist(Z,aa.eye)<fa.distance*fa.distance:!1}_computeOverlayExtents(aa,Z,da){var fa=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation;const ka=x.create();this._findHorizonBasedPointOfInterest(aa,
ka)||v.copy(ka,fa);B.debugFlags.OVERLAY_SHOW_CENTER?(null==V&&(V=new D.PointGraphics(this.view.graphics,"red")),V.show(ka,this._renderSR)):null!=V&&V.hide();var ha=Math.max(.1,v.distance(aa.eye,ka));const ba=E.viewAngle(this.view.renderCoordsHelper,fa,aa.eye);this._overlaySREqualsRenderSR||r.projectVectorToVector(ka,this._renderSR,ka,this._spatialReference);fa=this.surface.extent;var ea=!this._isSpherical&&this._spatialReference&&this._spatialReference.isGeographic,ca=ea&&this._spatialReference?1/
t.getReferenceEllipsoid(this._spatialReference).metersPerDegree:1;ha=aa.perScreenPixelRatio/this.view.state.contentPixelRatio*ha*ca;da.mapUnitsPerPixel=ha/this._worldToPCSRatio;da.stretch=this._overlayStretch;ha=Z*ha/2*da.stretch;var ia=!1;ea=ea?90:Infinity;this._isSpherical&&fa&&this._spatialReference&&(this._spatialReference.isWebMercator?(ha/=Math.cos(C.y2lat(ka[1])),ea=fa[3]):(ia=!0,ha/=t.getReferenceEllipsoid(this._spatialReference).metersPerDegree,ea=90),ha>=ea&&(ha=ea,ka[1]=0,this._spatialReference.isWebMercator&&
(ka[0]=0)));ca=1;ia&&(ca=1/Math.max(.2,Math.cos(Math.abs(n.deg2rad(ka[1])))),180<ha*ca&&(ca=180/ha),da.mapUnitsPerPixel*=ca);ia=Math.log(2)/12;ha=Math.exp(Math.round(Math.log(ha)/ia)*ia);const la=ha*ca;ia=.5*Z/(32*la);var oa=.5*Z/(32*ha);ka[0]=Math.round(ka[0]*ia)/ia;ka[1]=Math.round(ka[1]*oa)/oa;ia=da.inner;ia[0]=ka[0]-la;ia[1]=ka[1]-ha;ia[2]=ka[0]+la;ia[3]=ka[1]+ha;this._isSpherical&&this._shiftExtentToFitBounds(ia,Infinity,ea);oa=da.outer;6*la>u.width(fa)?u.copy(oa,fa):Math.PI/2-Math.abs(ba-Math.PI/
2)<=.25*Math.PI?(oa[0]=ia[0]-la,oa[1]=ia[1]-ha,oa[2]=ia[2]+la,oa[3]=ia[3]+ha):(r.projectVectorToVector(aa.eye,this._renderSR,H,this._spatialReference),w.subtract(W,ka,H),aa=-Math.atan2(W[1],W[0])+.125*Math.PI,0>aa&&(aa+=2*Math.PI),p.scale(W,M[Math.floor(aa/(.25*Math.PI))],2*ha),W[0]*=ca,W[2]*=ca,p.add(oa,ia,W));this._isSpherical?(oa[0]=this._longitudeCyclical.clamp(oa[0]),oa[2]=this._longitudeCyclical.clamp(oa[2]),oa[1]=Math.max(oa[1],-ea),oa[3]=Math.min(oa[3],ea)):(aa=u.intersection(ia,fa,I),fa=
u.intersection(oa,fa,Q),u.contains(aa,fa)&&(oa[2]=oa[0],oa[3]=oa[1]));Z=Math.abs(ia[2]-ia[0])/Z;da.mapUnitsPerPixel=Math.max(da.mapUnitsPerPixel,Z);da.pixelRatioAdjustment=da.mapUnitsPerPixel/Z}_drawOverlays(aa,Z){if(this.renderer.hasOverlays){if(!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return this.renderer;var da=this._drawTexturesDirty;this._drawTexturesDirty=this._drawTexturesAnimateDirty=!1;var fa=this.renderer.computeValidity();this.renderer.releaseRenderTargets();this.renderer.drawOverlays(Z);
Z=this.renderer.computeValidity();fa!==Z&&this.surface.updateTileOverlayParams(L.RenderRequestType.UPDATE);da?(this.surface.requestRender(aa),aa===L.RenderRequestType.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(L.RenderRequestType.BACKGROUND);return this.renderer}}_rectanglesOverlap(aa,Z){return null==aa?!1:this._longitudeCyclical?(this._longitudeCyclical.contains(Z[0],Z[2],aa[0])||this._longitudeCyclical.contains(Z[0],Z[2],aa[2])||this._longitudeCyclical.contains(aa[0],aa[2],
Z[0]))&&!(aa[1]>Z[3]||aa[3]<Z[1]):u.intersects(aa,Z)}_rectInsideRect(aa,Z){return null==Z?!1:this._longitudeCyclical?this._longitudeCyclical.contains(aa[0],aa[2],Z[0])&&this._longitudeCyclical.contains(aa[0],aa[2],Z[2])&&Z[1]>aa[1]&&Z[3]<aa[3]:u.contains(aa,Z)}_pointIsInExtent(aa,Z){if(this._longitudeCyclical)return this._longitudeCyclical.contains(Z[0],Z[2],aa.x)&&aa.y>=Z[1]&&aa.y<=Z[3];const da=aa.x;aa=aa.y;return da>Z[0]&&da<Z[2]&&aa>Z[1]&&aa<Z[3]}_shiftExtentToFitBounds(aa,Z,da){let fa=0,ka=0;
aa[0]<-Z?fa=aa[0]+Z:aa[2]>Z&&(fa=Z-aa[2]);aa[1]<-da?ka=aa[1]+da:aa[3]>da&&(ka=da-aa[3]);u.offset(aa,fa,ka)}get test(){return{renderer:this.renderer,update:()=>this.runTask(U.noBudget)}}};a.__decorate([q.property()],b.OverlayManager.prototype,"_spatialReference",void 0);a.__decorate([q.property({readOnly:!0})],b.OverlayManager.prototype,"running",null);a.__decorate([q.property()],b.OverlayManager.prototype,"_placementDirty",void 0);a.__decorate([q.property()],b.OverlayManager.prototype,"_contentUpdated",
void 0);a.__decorate([q.property()],b.OverlayManager.prototype,"_isSpherical",null);a.__decorate([q.property()],b.OverlayManager.prototype,"_worldToPCSRatio",null);a.__decorate([q.property({autoDestroy:!0})],b.OverlayManager.prototype,"renderer",void 0);a.__decorate([q.property({constructOnly:!0})],b.OverlayManager.prototype,"view",void 0);a.__decorate([q.property({constructOnly:!0})],b.OverlayManager.prototype,"surface",void 0);a.__decorate([q.property()],b.OverlayManager.prototype,"suspended",null);
a.__decorate([q.property()],b.OverlayManager.prototype,"updating",null);a.__decorate([q.property({type:Boolean})],b.OverlayManager.prototype,"rendersOccluded",null);b.OverlayManager=a.__decorate([l.subclass("esri.views.3d.terrain.OverlayManager")],b.OverlayManager);class Y{constructor(){this.inner=u.create();this.outer=u.create();this.mapUnitsPerPixel=0;this.pixelRatioAdjustment=1;this.stretch=1.3}}const W=h.create(),H=x.create(),S=new Y,I=u.create(),Q=u.create(),N=y.create();var T;(function(aa){aa[aa.NONE=
0]="NONE";aa[aa.EXTENT=1]="EXTENT";aa[aa.RERENDER_ONLY=2]="RERENDER_ONLY"})(T||(T={}));Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/parts/requireUtils":function(){define(["exports"],function(b){b.removeLoadedShaderModules=function(){const a=globalThis.require?.modules;if(a){const c=Object.keys(a);for(const d of c)d.includes(".glsl")&&delete a[d]}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/PlanarPatch":function(){define("exports ../../../chunks/vec3f64 ../../../geometry/SpatialReference ../../../geometry/projection/projectVectorToVector ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/spatialReferenceUtils ./ITile ./PatchGeometryFactory ./Tile ../webgl-engine/materials/internal/MaterialUtil".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m){class l extends e.Tile{constructor(v,x,p,h,t){super();this._horizontalScaleFactor=1;this._extentInRenderSR=n.create();this._baseUsedMemory=900;this.init(v,x,p,h,t)}init(v,x,p,h,t){super.init(v,x,p,h,t);v=t.view.renderSpatialReference;t=t.spatialReference;this._horizontalScaleFactor=x=null!=v&&k.isPlateCarree(v)&&null!=t&&t.isGeographic?this.ellipsoid.radius*Math.PI/180:1;t=this._extentInRenderSR;v=this.extent;if(this.surface.isWebMercatorOnPlateeCarree)x=a.fromValues(v[0],
v[1],0),d.projectVectorToVector(x,c.WebMercator,x,c.PlateCarree),v=a.fromValues(v[2],v[3],0),d.projectVectorToVector(v,c.WebMercator,v,c.PlateCarree),t[0]=x[0],t[1]=x[1],t[2]=v[0],t[3]=v[1];else for(p=0;4>p;++p)t[p]=v[p]*x;this.centerAtSeaLevel[0]=.5*(t[0]+t[2]);this.centerAtSeaLevel[1]=.5*(t[1]+t[3]);this.centerAtSeaLevel[2]=0;this._edgeLen=Math.max(t[2]-t[0],t[3]-t[1]);this._edgeLen2=this._edgeLen*this._edgeLen;this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();var v=this._extentInRenderSR;
const x=.5*(v[2]-v[0]);v=.5*(v[3]-v[1]);this._center[e.CenterPosition.MIDDLE][3]=Math.max(Math.sqrt(x*x+v*v),.5*(this.elevationBounds[0]-this.elevationBounds[1]))}_calculateFrustumVisibilityStatus(v){var x=this._aabb();const p=x[0],h=x[1],t=x[2],r=x[3],u=x[4];x=x[5];let y=!0;for(let A=0;6>A;A++){var z=v[A];const C=z[0],E=z[1],B=z[2];z=z[3];if(0<=C*(0<C?p:r)+E*(0<E?h:u)+B*(0<B?t:x)+z)return g.TileFrustumVisibility.OUTSIDE;y=y&&0>=C*(0>C?p:r)+E*(0>E?h:u)+B*(0>B?t:x)+z}return y?g.TileFrustumVisibility.INSIDE:
g.TileFrustumVisibility.INTERSECTS}_aabb(){const v=this._extentInRenderSR;return f.wrap(v[0],v[1],this.elevationBounds[0],v[2],v[3],this.elevationBounds[1])}intersectsRay(v,x,p,h){w[0]=1/x[0];w[1]=1/x[1];w[2]=1/x[2];return m.intersectAabbInvDirBefore(this._aabb(),v,w,p,h)}createGeometry(){q.createPlanarGlobePatch(this.renderData,this._horizontalScaleFactor);this.setMemoryDirty()}getDefaultVerticesPerSide(){return 9>this.level?3:2}updateCornerElevations(){q.updateCornersPlanar(this.renderData,this._horizontalScaleFactor)}updateEdgeElevations(){q.updateEdgesAndCornersPlanar(this.renderData,
this._horizontalScaleFactor)}get horizontalScale(){return this._horizontalScaleFactor}}const w=a.create();b.PlanarPatch=l;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/PatchGeometryFactory":function(){define("exports ../../../core/mathUtils ../../../chunks/vec4 ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ./ElevationData ./interfaces ./ITile ./PatchGeometry ./PatchGeometryLUT ./PatchRenderData ./terrainUtils ./Tile ./tileUtils ../webgl-engine/lib/Normals".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x){function p(R){var X=R.tile;if(X.intersectsClippingArea){var U=R.geometryState,M=U.numVerticesPerSide,V=M-2;--M;var Y=R.geometry,W=Y.vertexAttributes,H=W.position,S=W.uv0,{typedBuffer:I,typedBufferStride:Q}=W.normalCompressed,N=X.extent;W=N[0];var T=N[2],aa=N[1];N=N[3];X=X.ellipsoid.radius;U=U.samplerData;var Z=R.localOrigin;R=Z[0];var da=Z[1];Z=Z[2];var fa=H.typedBuffer;H=H.typedBufferStride;var ka=1/M;Y=Y.boundingBox;var ha=0;if(1<=V){var ba=aa*(1-ka)+N*ka,
ea=O.sinLatLUT[1],ca=O.cosLatLUT[1];for(var ia=1;ia<=V;ia++){var la=ia*ka,oa=O.sinLonLUT[ia],na=O.cosLonLUT[ia],ra=X+n.sampleElevation(W*(1-la)+T*la,ba,U);na=-R+ra*na*ca;oa=-da+ra*oa*ca;ra=-Z+ra*ea;q.minMaxBoundingBox(na,oa,ra,Y);var ta=(ia-1)*H;fa[ta]=na;fa[ta+1]=oa;fa[ta+2]=ra;q.encodeUVInBuffer(S,ia-1,la,ka)}}for(ba=1;ba<=V;ba++){ea=ba*ka;ea=aa*(1-ea)+N*ea;ca=O.sinLatLUT[ba];ia=O.cosLatLUT[ba];oa=ba+1;la=oa*ka;na=aa*(1-la)+N*la;ra=O.sinLatLUT[oa];oa=O.cosLatLUT[oa];var ma=O.sinLonLUT[0];ta=O.cosLonLUT[0];
var pa=X+n.sampleElevation(W,ea,U);ta=ta*ia*pa-R;ma=ma*ia*pa-da;pa=ca*pa-Z;var ja=ha*H;let Ra=fa[ja],Sa=fa[ja+1];ja=fa[ja+2];for(let sa=1;sa<=V;sa++){var qa=sa*ka,ua=W*(1-qa)+T*qa,wa=O.sinLonLUT[sa],za=O.cosLonLUT[sa],Aa=0,Fa=0,Da=0;sa<V?(Da=(ha+1)*H,Aa=fa[Da],Fa=fa[Da+1],Da=fa[Da+2]):(Fa=O.sinLonLUT[M],Aa=O.cosLonLUT[M],Da=X+n.sampleElevation(T,ea,U),Aa=Aa*ia*Da-R,Fa=Fa*ia*Da-da,Da=ca*Da-Z);var Ha=ta,Ka=ma,La=pa;ta=Ra;ma=Sa;pa=ja;Ra=Aa;Sa=Fa;ja=Da;Aa-=Ha;Fa-=Ka;Da-=La;Ha=Ka=La=0;if(1<ba)Ha=(ha-V)*
H,La=fa[Ha],Ka=fa[Ha+1],Ha=fa[Ha+2];else{Ha=O.sinLatLUT[0];Ka=O.cosLatLUT[0];var Na=X+n.sampleElevation(ua,aa,U);La=za*Ka*Na-R;Ka=wa*Ka*Na-da;Ha=Ha*Na-Z}Na=X+n.sampleElevation(ua,na,U);const va=za*oa*Na-R;ua=wa*oa*Na-da;Na=ra*Na-Z;if(ba<V){const ya=ha+V,Ea=ya*H;fa[Ea]=va;fa[Ea+1]=ua;fa[Ea+2]=Na;q.minMaxBoundingBox(va,ua,Na,Y);q.encodeUVInBuffer(S,ya,qa,la)}qa=La-va;ua=Ka-ua;La=Ha-Na;za*=ia;wa*=ia;Ka=ca;.999>Ka*Ka&&(za=Da*ua-Fa*La,wa=Aa*La-Da*qa,Ka=Fa*qa-Aa*ua);qa=1/Math.sqrt(za*za+wa*wa+Ka*Ka);x.compressNormal(I,
ha,za*qa,wa*qa,Ka*qa,Q);++ha}}}}function h(R){R.tile.intersectsClippingArea&&(D(R),t(R))}function t(R,X=!1){var U=R.geometryState;const M=R.geometry,V=U.neighborData,Y=R.tile,W=Y.level,H=Y.extent,S=Y.ellipsoid.radius;var I=Y.extentInRadians;const Q=I[0],N=I[2],T=I[1];I=I[3];const aa=U.samplerData,Z=H[0],da=H[2],fa=H[1],ka=H[3],ha=r(R),ba=M.boundingBox;U=R.localOrigin;const ea=U[0],ca=U[1],ia=U[2];U=M.vertexAttributes;var la=U.position;const oa=la.typedBuffer,na=la.typedBufferStride,ra=U.uv0;for(let pa=
0;4>pa;++pa){const ja=1===pa||3===pa;U=V.edgeResolutions[pa];l.internalAssert(a.isPowerOfTwo(U));const qa=U+1;var ta=m.neighborTileIfLoadedOrSelf(Y,V.edgePeerNeighbors[pa]);if(L(Y,ta,pa)){B(R,pa,ta);continue}const ua=null!=ta;l.internalAssert(!ua||ta.level===Y.level);l.internalAssert(!ua||0>=v.compareTilesByLij(Y,ta));la=ta?.renderData?.geometryState;if(l.enableTerrainInternalChecks){var ma=Y.surface;if(!ta&&ma&&!ma.updatingRootTiles){const Ma=l.neighborEdgeIndices[pa],Ta=Y.findNeighborTile(Ma,Va=>
Va.isLoaded||Va.isLeaf||Va.level===Y.level);Ta?Ta.intersectsClippingArea&&(l.internalAssert(!Ta.isLoaded),l.internalAssert(!Ta.isLeaf),l.internalAssert(Ta.level===W)):l.internalAssert(null==ma?.rootTiles||!Y.shouldHaveNeighbor(Ma))}}const wa=1===pa?H[2]:H[0],za=(ta=ta?.extent)&&ja?1===pa?ta[0]:ta[2]:wa,Aa=0===pa?H[3]:H[1],Fa=1===pa?1:0,Da=0===pa?1:0,Ha=1===pa?N:Q,Ka=0===pa?I:T,La=Math.sin(Ha),Na=Math.cos(Ha),Ra=Math.sin(Ka),Sa=Math.cos(Ka),sa=la?.samplerData;la=(Ma,Ta,Va)=>n.sampleElevation(Ma,Ta,
aa);ma=(Ma,Ta,Va)=>.5*(n.sampleElevation(Ma,Ta,aa)+n.sampleElevation(Va,Ta,sa));const va=ua?ma:la,ya=M.outerEdges[pa],Ea=X&&3<qa?qa-3:1;la=null!=aa&&aa.some(Ma=>null!=Ma);ma=null!=sa&&sa.some(Ma=>null!=Ma);const Ca=la||ma,Ga=1/U,Ja=ya.index0;l.internalAssert(!ta||l.almostEquals(ta[2]-ta[0],H[2]-H[0]));(()=>{const Ma=1===pa?-1:3===pa?1:0,Ta=0===pa?-1:2===pa?1:0,Va=(H[2]-H[0])*Ga,Wa=Ma*Va,hb=Ta*Va,Ya=N-Q,cb=ja?Ma*Ya*Ga:0,Xa=ja?0:Ta*Ga,fb=Da,Za=ja?Ha+cb:Ha,bb=ja?Math.sin(Za):La,Oa=ja?Math.cos(Za):Na,
$a=ja?Ha-cb:Ha,db=ja?Math.sin($a):La,kb=ja?Math.cos($a):Na,ib=ja?Ka:ha(fb+Xa),xa=ja?Ra:Math.sin(ib),Ba=ja?Sa:Math.cos(ib),Ia=ja?Ka:ha(fb-Xa),Qa=ja?Ra:Math.sin(Ia),Pa=ja?Sa:Math.cos(Ia);let Ua=0,ab=0,jb=0;const eb=0*Ga,sb=ja?wa:Z*(1-eb)+da*eb,Gb=ja?za:sb,Hb=ja?fa*(1-eb)+ka*eb:Aa,Ab=ja?Ha:Q*(1-eb)+N*eb,Ib=ja?La:Math.sin(Ab),wb=ja?Na:Math.cos(Ab),Bb=ja?ha(eb):Ka,Fb=ja?Math.sin(Bb):Ra,Cb=ja?Math.cos(Bb):Sa,xb=S+va(sb,Hb,Gb);Ua=wb*Cb*xb;ab=Ib*Cb*xb;jb=Fb*xb;let tb=0,qb=0,yb=0;const rb=1*Ga,ob=ja?wa:Z*
(1-rb)+da*rb,mb=ja?za:ob,pb=ja?fa*(1-rb)+ka*rb:Aa,nb=ja?Ha:Q*(1-rb)+N*rb,gb=ja?La:Math.sin(nb),lb=ja?Na:Math.cos(nb),ub=ja?ha(rb):Ka,Db=ja?Math.sin(ub):Ra,Mb=ja?Math.cos(ub):Sa,Jb=S+va(ob,pb,mb);tb=lb*Mb*Jb;qb=gb*Mb*Jb;yb=Db*Jb;for(let vb=1;vb<qa-1;vb+=Ea){let Nb=0,Kb=0,Eb=0;const zb=(vb+1)*Ga,Lb=ja?wa:Z*(1-zb)+da*zb,Qb=ja?za:Lb,Vb=ja?fa*(1-zb)+ka*zb:Aa,Ob=ja?Ha:Q*(1-zb)+N*zb,Yb=ja?La:Math.sin(Ob),Qc=ja?Na:Math.cos(Ob),pc=ja?ha(zb):Ka,Rc=ja?Math.sin(pc):Ra,qc=ja?Math.cos(pc):Sa,$b=S+va(Lb,Vb,Qb);
Nb=Qc*qc*$b;Kb=Yb*qc*$b;Eb=Rc*$b;const rc=Nb,sc=Kb,tc=Eb,ac=tb,bc=qb,cc=yb;tb=rc;qb=sc;yb=tc;const uc=Ja+vb,dc=uc*na,vc=ac-ea,wc=bc-ca,xc=cc-ia;oa[dc]=vc;oa[dc+1]=wc;oa[dc+2]=xc;q.minMaxBoundingBox(vc,wc,xc,ba);const yc=vb*Ga;q.encodeUVInBuffer(ra,uc,ja?Fa:yc,ja?yc:Da);const Sc=Ua,Tc=ab,Uc=jb;Ua=ac;ab=bc;jb=cc;const Wb=ac,Xb=bc,Rb=cc,Zb=1/Math.sqrt(Wb*Wb+Xb*Xb+Rb*Rb),zc=Rb*Zb;let Sb=0,Tb=0,Ub=0;if(Ca&&.999>zc*zc){let ec=0,fc=0,gc=0;const hc=0===pa?-1:1;ec=hc*(rc-Sc);fc=hc*(sc-Tc);gc=hc*(tc-Uc);const Pb=
vb*Ga,Ac=ja?wa:Z*(1-Pb)+da*Pb,Vc=ja?za:Ac,Bc=ja?fa*(1-Pb)+ka*Pb:Aa,Cc=ja?Ha:Q*(1-Pb)+N*Pb,Dc=ja?La:Math.sin(Cc),Ec=ja?Na:Math.cos(Cc),Fc=ja?ha(Pb):Ka,Gc=ja?Math.sin(Fc):Ra,Hc=ja?Math.cos(Fc):Sa;let ic=Wb,jc=Xb,kc=Rb;if(ua){const lc=S+n.sampleElevation(Vc-Wa,Bc-hb,sa),Wc=ja?db:Dc,Xc=ja?Gc:Qa,Ic=ja?Hc:Pa;ic=(ja?kb:Ec)*Ic*lc;jc=Wc*Ic*lc;kc=Xc*lc}const mc=S+n.sampleElevation(Ac+Wa,Bc+hb,aa),Jc=ja?Hc:Ba,Kc=(ja?Oa:Ec)*Jc*mc,Lc=(ja?bb:Dc)*Jc*mc,Mc=(ja?Gc:xa)*mc;ua||(ic=2*Wb-Kc,jc=2*Xb-Lc,kc=2*Rb-Mc);const nc=
3===pa?-1:1,Nc=nc*(ic-Kc),Oc=nc*(jc-Lc),Pc=nc*(kc-Mc);Sb=gc*Oc-fc*Pc;Tb=ec*Pc-gc*Nc;Ub=fc*Nc-ec*Oc;const oc=1/Math.sqrt(Sb*Sb+Tb*Tb+Ub*Ub);Sb*=oc;Tb*=oc;Ub*=oc}else Sb=Wb*Zb,Tb=Xb*Zb,Ub=Rb*Zb;ya.setNormalFromValues(vb,Sb,Tb,Ub)}})()}}function r(R){R=R.tile;if(R.surface.isWebMercator){const U=R.extent,M=R.ellipsoid.radius;return V=>Math.PI/2-2*Math.atan(Math.exp(-(U[1]*(1-V)+U[3]*V)/M))}const X=R.extentInRadians;return U=>X[1]*(1-U)+X[3]*U}function u(R){const X=R.tile;if(X.intersectsClippingArea){var U=
R.geometryState,M=U.samplerData,V=R.localOrigin,Y=X.surface.isWebMercatorOnPlateeCarree,W=U.clippingArea,H=null!=W?W:P,S=X.extent,I=S[0],Q=S[1],N=S[2],T=S[3],aa=Math.max(I,H[0]),Z=Math.min(N,H[2]),da=Math.max(Q,H[1]),fa=Math.min(T,H[3]),ka=X.ellipsoid.radius,ha=X.horizontalScale,ba=U.numVerticesPerSide,ea=ba-1,ca=ba-2,ia=R.geometry,la=ia.vertexAttributes,oa=la.position,na=la.uv0,{typedBuffer:ra,typedBufferStride:ta}=la.normalCompressed,ma=ia.uvRange,pa=ma[0],ja=ma[1],qa=ma[2],ua=ma[3],wa=ia.boundingBox,
za=V[0],Aa=V[1],Fa=V[2],Da=oa.typedBuffer,Ha=oa.typedBufferStride,Ka=0,La=a.clamp(Q,da,fa),Na=Y?(Math.PI/2-2*Math.atan(Math.exp(-La/ka)))*ka:La*ha,Ra=1/ea,Sa=a.clamp(Q*(1-Ra)+T*Ra,da,fa),sa=Na,va=Y?(Math.PI/2-2*Math.atan(Math.exp(-Sa/ka)))*ka:Sa*ha;for(let ya=1;ya<=ca;ya++){const Ea=ya/ea,Ca=a.clamp(Q*(1-Ea)+T*Ea,da,fa),Ga=a.clamp(Ea,ja,ua),Ja=va,Ma=(ya-1)/ea,Ta=a.clamp(Q*(1-Ma)+T*Ma,da,fa),Va=sa,Wa=(ya+1)/ea,hb=a.clamp(Q*(1-Wa)+T*Wa,da,fa),Ya=Y?(Math.PI/2-2*Math.atan(Math.exp(-hb/ka)))*ka:hb*ha,
cb=a.clamp(Wa,ja,ua);sa=va;va=Ya;const Xa=a.clamp(I,aa,Z);let fb=Xa*ha,Za=n.sampleElevation(Xa,Ca,M);const bb=1/ea,Oa=a.clamp(bb,pa,qa),$a=a.clamp(I*(1-Oa)+N*Oa,aa,Z);let db=Oa,kb=$a,ib=$a*ha,xa=n.sampleElevation($a,Ca,M);if(1===ya){const Ba=ib-za,Ia=sa-Aa,Qa=xa-Fa,Pa=0*Ha;Da[Pa]=Ba;Da[Pa+1]=Ia;Da[Pa+2]=Qa;q.minMaxBoundingBox(Ba,Ia,Qa,wa);const Ua=a.clamp(bb,pa,qa);q.encodeUVInBuffer(na,Ka,Ua,Ga)}for(let Ba=1;Ba<=ca;Ba++){const Ia=ib,Qa=xa,Pa=(Ba+1)/ea,Ua=a.clamp(Pa,pa,qa),ab=a.clamp(I*(1-Pa)+N*Pa,
aa,Z),jb=kb;kb=ab;const eb=Ka+1,sb=eb*Ha;if(1===ya||Ba===ca){const ob=n.sampleElevation(ab,Ca,M),mb=ab*ha,pb=Ja,nb=ob;if(1===ya&&Ba<ca){const gb=mb-za,lb=pb-Aa,ub=nb-Fa;Da[sb]=gb;Da[sb+1]=lb;Da[sb+2]=ub;q.minMaxBoundingBox(gb,lb,ub,wa);q.encodeUVInBuffer(na,eb,Ua,Ga)}ib=mb;xa=nb}else ib=Da[sb]+za,xa=Da[sb+2]+Fa;const Gb=ib,Hb=xa,Ab=fb,Ib=Za;fb=Ia;Za=Qa;const wb=(Ka-ca)*Ha,Bb=1===ya?n.sampleElevation(jb,Ta,M):Da[wb+2]+Fa,Fb=n.sampleElevation(jb,hb,M);if(ya<ca){const ob=Ka+ca,mb=ob*Ha,pb=Ia-za,nb=Ya-
Aa,gb=Fb-Fa;Da[mb]=pb;Da[mb+1]=nb;Da[mb+2]=gb;q.minMaxBoundingBox(pb,nb,gb,wa);const lb=db;db=Ua;q.encodeUVInBuffer(na,ob,lb,cb)}const Cb=Gb-Ab,xb=Va-Ya,tb=xb*(Hb-Ib),qb=Cb*(Bb-Fb),yb=-xb*Cb,rb=tb*tb+qb*qb+yb*yb;if(0===rb)x.compressNormal(ra,Ka,0,0,1,ta);else{const ob=1/Math.sqrt(rb);x.compressNormal(ra,Ka,tb*ob,qb*ob,yb*ob,ta)}++Ka}}}}function y(R,X){R.tile.intersectsClippingArea&&(D(R),z(R,!1))}function z(R,X){const U=R.geometryState,M=U.neighborData,V=R.tile,Y=V.surface,W=V.extent,H=U.clippingArea,
S=null!=H?H:P,I=W[0],Q=W[2],N=W[1],T=W[3],aa=[T>S[3],Q>S[2],N<S[1],I<S[0]],Z=R.geometry,da=V.horizontalScale,fa=A(Y.isWebMercatorOnPlateeCarree,V.ellipsoid.radius,da),ka=Z.boundingBox,ha=Z.uvRange[0],ba=Z.uvRange[1],ea=Z.uvRange[2],ca=Z.uvRange[3],ia=Math.max(I,S[0]),la=Math.min(Q,S[2]),oa=Math.max(N,S[1]),na=Math.min(T,S[3]),ra=R.localOrigin,ta=ra[0],ma=ra[1],pa=ra[2],ja=U.samplerData;for(let qa=0;4>qa;++qa){const ua=1===qa||3===qa,wa=M.edgeResolutions[qa];l.internalAssert(a.isPowerOfTwo(wa));const za=
wa+1,Aa=aa[qa],Fa=m.neighborTileIfLoadedOrSelf(V,M.edgePeerNeighbors[qa]);if(!Aa&&L(V,Fa,qa)){B(R,qa,Fa);continue}const Da=null!=Fa&&!Aa,Ha=Fa?.renderData?.geometryState;if(l.enableTerrainInternalChecks&&(l.internalAssert(!Da||Fa.level===V.level),l.internalAssert(!Da||0>=v.compareTilesByLij(V,Fa)),V&&!Fa&&!Y.updatingRootTiles)){const Pa=l.neighborEdgeIndices[qa],Ua=V.findNeighborTile(Pa,ab=>ab.isLoaded||ab.isLeaf||ab.level===V.level);Y.updatingRootTiles||(Ua?Ua.intersectsClippingArea&&(l.internalAssert(!Ua.isLoaded),
l.internalAssert(!Ua.isLeaf),l.internalAssert(Ua.level===V.level)):l.internalAssert(null==Y?.rootTiles||!V.shouldHaveNeighbor(Pa)))}const Ka=a.clamp(1===qa?Q:I,ia,la),La=a.clamp(0===qa?T:N,oa,na),Na=Ha?.samplerData,Ra=Z.outerEdges[qa],Sa=X&&3<za?za-3:1,sa=a.clamp(1===qa?1:0,ha,ea),va=a.clamp(0===qa?1:0,ba,ca),ya=(Pa,Ua)=>n.sampleElevation(Pa,Ua,ja),Ea=(Pa,Ua)=>.5*(n.sampleElevation(Pa,Ua,Na)+n.sampleElevation(Pa,Ua,ja)),Ca=Da?Ea:ya,Ga=(Q-I)/wa,Ja=ua?1===qa?Ga:-Ga:0,Ma=ua?0:0===qa?Ga:-Ga,Ta=-Ja,Va=
-Ma;let Wa=0,hb=0,Ya=0;const cb=0/wa,Xa=ua?Ka:a.clamp(I*(1-cb)+Q*cb,ia,la),fb=ua?a.clamp(N*(1-cb)+T*cb,oa,na):La,Za=Ca(Xa,fb);Wa=Xa*da;hb=fa(fb);Ya=Za;let bb=0,Oa=0,$a=0;const db=1/wa,kb=ua?Ka:a.clamp(I*(1-db)+Q*db,ia,la),ib=ua?a.clamp(N*(1-db)+T*db,oa,na):La,xa=Ca(kb,ib),Ba=kb*da,Ia=fa(ib),Qa=xa;bb=Ba;Oa=Ia;$a=Qa;for(let Pa=1;Pa<za-1;Pa+=Sa){const Ua=Pa/wa,ab=bb,jb=Oa,eb=$a,sb=ua?sa:a.clamp(Ua,ha,ea),Gb=ua?a.clamp(Ua,ba,ca):va,Hb=ab-ta,Ab=jb-ma,Ib=eb-pa;q.minMaxBoundingBox(ab,Ab,Ib,ka);Ra.setVertexFromValuesRawPositionUV(Pa,
Hb,Ab,Ib,sb,Gb);const wb=(Pa+1)/wa,Bb=ua?Ka:a.clamp(I*(1-wb)+Q*wb,ia,la),Fb=ua?a.clamp(N*(1-wb)+T*wb,oa,na):La,Cb=Ca(Bb,Fb);bb=Bb*da;Oa=fa(Fb);$a=Cb;const xb=bb,tb=Oa,qb=$a,yb=Wa,rb=hb,ob=Ya;Wa=ab;hb=jb;Ya=eb;let mb=0,pb=0,nb=0;if(ua){const lb=tb-jb,ub=qb-eb,Db=rb-jb,Mb=ob-eb,Jb=a.clamp(N*(1-Ua)+T*Ua,oa,na),vb=Ka+Ta,Nb=vb*da,Kb=n.sampleElevation(vb,Jb,ja),Eb=Nb-ab,zb=Kb-eb,Lb=3===qa?-1:1;mb=Lb*(-Db+lb)*zb;pb=Lb*Eb*(-Mb+ub);nb=-Lb*Eb*(-Db+lb);if(Da){const Qb=Ka+Ja,Vb=Qb*da,Ob=n.sampleElevation(Qb,
Jb,Na),Yb=Vb-ab;mb=(-Db+lb)*(zb-(Ob-eb));pb=(Eb-Yb)*(-Mb+ub);nb=-(Eb-Yb)*(-Db+lb)}}else{const lb=xb-ab,ub=qb-eb,Db=yb-ab,Mb=ob-eb,Jb=a.clamp(I*(1-Ua)+Q*Ua,ia,la),vb=La+Va,Nb=n.sampleElevation(Jb,vb,ja)-eb,Kb=fa(vb)-jb,Eb=2===qa?-1:1;mb=Eb*Kb*(-Mb+ub);pb=Eb*(-Db+lb)*Nb;nb=-Eb*Kb*(-Db+lb);if(Da){const zb=Jb,Lb=La+Ma,Qb=fa(Lb),Vb=n.sampleElevation(zb,Lb,Na)-eb,Ob=Qb-jb;mb=(-Kb+Ob)*(-Mb+ub);pb=(-Db+lb)*(-Nb+Vb);nb=-(-Kb+Ob)*(-Db+lb)}}const gb=1/Math.sqrt(mb*mb+pb*pb+nb*nb);Ra.setNormalFromValues(Pa,mb*
gb,pb*gb,nb*gb)}}}function A(R,X,U){return R?M=>(Math.PI/2-2*Math.atan(Math.exp(-M/X)))*X:M=>M*U}function C(R,X,U,M,V,Y){const W=X-1,H=R.vertexAttributes.count,S=2*(Math.min(X-2,M[1])-Math.max(1,M[0]))*(Math.min(X-2,V[1])-Math.max(1,V[0])),I=l.neighborEdgeIndices.map((ba,ea)=>0===ea&&V[1]<X-2||1===ea&&M[1]<X-2||2===ea&&1<V[0]||3===ea&&1<M[0]),Q=R.outerEdges.reduce((ba,ea,ca)=>ba+(I[ca]?0:W-2+ea.count-1),0),N=U.reduce((ba,ea)=>ba+W*(2*(ea.latitudeResolution-1)+1),0),T=Y?2:1,aa=3*(S+Q+N)*T,Z=65536<=
H?new Uint32Array(aa):new Uint16Array(aa);let da=0;const fa=X-2,ka=W-2;l.internalAssert(0<=ka);const ha=(ba,ea,ca,ia,la,oa)=>{var na=ba*la;ba=oa[na];const ra=oa[na+1];na=oa[na+2];var ta=ea*la;ea=oa[ta];const ma=oa[ta+1];ta=oa[ta+2];var pa=ca*la;ca=oa[pa];const ja=oa[pa+1];pa=oa[pa+2];const qa=ia*la;ia=oa[qa];la=oa[qa+1];oa=oa[qa+2];return(ea-ia)*(ea-ia)+(ma-la)*(ma-la)+(ta-oa)*(ta-oa)>(ba-ca)*(ba-ca)+(ra-ja)*(ra-ja)+(na-pa)*(na-pa)};if(Y){const ba=(ea,ca,ia)=>{Z[da++]=ea;Z[da++]=ca;Z[da++]=ca;Z[da++]=
ia;Z[da++]=ia;Z[da++]=ea;l.enableTerrainInternalChecks&&(l.internalAssert(ea<H),l.internalAssert(ca<H),l.internalAssert(ia<H),l.internalAssert(da<=aa))};(()=>{for(let ea=Math.max(V[0],1)-1;ea<Math.min(V[1],X-2)-1;++ea){const ca=ea*fa;for(let ia=Math.max(M[0],1)-1;ia<Math.min(M[1],X-2)-1;++ia){const la=ea*fa+ia,oa=la+1,na=oa+fa,ra=na-1,ta=ca+ia,ma=ta+1,pa=ma+fa;ha(ta,ma,pa,pa-1,R.vertexAttributes.position.typedBufferStride,R.vertexAttributes.position.typedBuffer)?(ba(la,oa,na),ba(na,ra,la)):(ba(la,
oa,ra),ba(ra,na,oa))}}})();l.internalAssert(da===3*S*T);(()=>{for(let ca=0;4>ca;++ca){const ia=da;if(I[ca])continue;const la=R.outerEdges[ca],oa=R.innerEdges[ca];let na=0,ra=0;const ta=la.count,ma=oa.count;l.internalAssert(ma===W-1);let pa=0;const ja=1===ca||2===ca?(qa,ua,wa)=>ba(qa,ua,wa):(qa,ua,wa)=>ba(qa,wa,ua);for(;na<ta-1||ra<ma-1;){const qa=oa.getVertexIndex(ra),ua=la.getVertexIndex(na);var ea=na<ta-1;const wa=ra<ma-1,za=ea?W*(na+.5)/(ta-1):0,Aa=wa?1+ka*(ra+.5)/(ma-1):0;ea&&(!wa||za<=Aa)?(++na,
l.enableTerrainInternalChecks&&l.internalAssert(na<ta),ea=la.getVertexIndex(na),ja(qa,ua,ea)):(++ra,l.enableTerrainInternalChecks&&l.internalAssert(ra<ma),ea=oa.getVertexIndex(ra),ja(qa,ua,ea));pa++}l.enableTerrainInternalChecks&&(l.internalAssert(na===ta-1),l.internalAssert(ra===ma-1),l.internalAssert(pa===ta+ma-2),l.internalAssert(pa===W-2+la.count-1),l.internalAssert(da===ia+3*pa*T))}})();l.internalAssert(da===3*(S+Q)*T);U.forEach(ea=>{var ca=R.outerEdges[ea.connectedOuterEdgeOffset];let ia=ca.getVertexIndex(0);
ca=ca.stride;for(let la=0;la<ea.latitudeResolution;++la){const oa=0===la?ea.rowOffset:ia+X;for(let na=0;na<W;na++)ba(ia,ia+1,oa+na),la<ea.latitudeResolution-1&&ba(ia+1,oa+na+1,oa+na),ia+=ca;ia=oa;ca=1}})}else(()=>{var ba=Math.max(V[0],1)-1;const ea=Math.min(V[1],X-2)-1,ca=Math.max(M[0],1)-1,ia=Math.min(M[1],X-2)-1;for(;ba<ea;++ba){const la=ba*fa;for(let oa=ca;oa<ia;++oa){const na=la+oa,ra=na+1,ta=ra+fa,ma=ta-1;ha(na,ra,ta,ma,R.vertexAttributes.position.typedBufferStride,R.vertexAttributes.position.typedBuffer)?
(Z[da]=na,Z[da+1]=ra,Z[da+2]=ta,Z[da+3]=ta,Z[da+4]=ma,Z[da+5]=na):(Z[da]=na,Z[da+1]=ra,Z[da+2]=ma,Z[da+3]=ma,Z[da+4]=ra,Z[da+5]=ta);da+=6}}})(),l.internalAssert(da===3*S*T),(()=>{for(let la=0;4>la;++la){if(I[la])continue;var ba=R.outerEdges[la],ea=R.innerEdges[la];let oa=0,na=0;const ra=ba.count,ta=ea.count;l.internalAssert(ta===W-1);var ca=1===la||2===la;const ma=ca?1:2;ca=ca?2:1;const pa=ba.index0;ba=ba.stride;const ja=ea.index0;for(ea=ea.stride;oa<ra-1||na<ta-1;){const qa=ja+na*ea,ua=pa+oa*ba;
var ia=oa<ra-1;const wa=na<ta-1,za=ia?W*(oa+.5)/(ra-1):0,Aa=wa?1+ka*(na+.5)/(ta-1):0;(ia=ia&&(!wa||za<=Aa))?++oa:++na;ia=ia?ua+ba:qa+ea;Z[da]=qa;Z[da+ma]=ua;Z[da+ca]=ia;da+=3}}})(),l.internalAssert(da===3*(S+Q)*T),U.forEach(ba=>{var ea=R.outerEdges[ba.connectedOuterEdgeOffset];let ca=ea.getVertexIndex(0);ea=ea.stride;for(let ia=0;ia<ba.latitudeResolution;++ia){const la=0===ia?ba.rowOffset:ca+X;for(let oa=0;oa<W;oa++){const na=la+oa;Z[da]=ca;Z[da+1]=ca+1;Z[da+2]=na;ia<ba.latitudeResolution-1?(Z[da+
3]=ca+1,Z[da+4]=na+1,Z[da+5]=na,da+=6):da+=3;ca+=ea}ca=la;ea=1}});l.internalAssert(da===aa);R.indices=Z;R.indexCount=aa}function E(R,X){const U=R.localOrigin,M=R.geometry;R=R.geometryState.neighborData.edgeResolutions;const V=M.numVerticesPerSide-2,Y=M.vertexAttributes;for(let H=0;4>H;++H){var W=0===H||2===H;M.innerEdges[H]=new q.EdgeDescriptor(Y,U,(0===H?V-1:0)*V+(1===H?V-1:0),(W?0:1)*V+(W?1:0),V);W=R[H]+1;M.outerEdges[H]=new q.EdgeDescriptor(Y,U,X,1,W);X+=W}}function B(R,X,U){var M=(X+2)%4,V=R.tile,
Y=V.level-U.level;const W=1===X||3===X,H=R.geometryState.neighborData.edgeResolutions[X];l.internalAssert(a.isPowerOfTwo(H));const S=H+1;var I=R.geometry;const Q=I.boundingBox;var N=I.outerEdges[X];const T=I.uvRange[0],aa=I.uvRange[1],Z=I.uvRange[2];I=I.uvRange[3];const da=a.clamp(1===X?1:0,T,Z),fa=a.clamp(0===X?1:0,aa,I);var ka=U.renderData,ha=ka.geometryState,ba=ka.geometry.outerEdges[M];X=V.getNeighborEdgeStartVertexIndex(X,U)*H;Y=H*2**Y;l.internalAssert(ha.neighborData.edgeResolutions[M]===Y);
l.internalAssert(ba.count-1===Y);M=ka.localOrigin[0]-R.localOrigin[0];Y=ka.localOrigin[1]-R.localOrigin[1];R=ka.localOrigin[2]-R.localOrigin[2];var ea=N.attributes;ka=N.index0;N=N.stride;ha=ea.position.typedBuffer;U=ea.position.typedBufferStride;V=ea.normalCompressed.typedBuffer;const ca=ea.normalCompressed.typedBufferStride;ea=ea.uv0;var ia=ba.attributes;const la=ba.index0;ba=ba.stride;const oa=ia.position.typedBuffer,na=ia.position.typedBufferStride,ra=ia.normalCompressed.typedBuffer;ia=ia.normalCompressed.typedBufferStride;
for(let ja=1;ja<S-1;++ja){const qa=ka+N*ja;var ta=la+ba*(X+ja),ma=qa*U,pa=ta*na;const ua=oa[pa]+M,wa=oa[pa+1]+Y;pa=oa[pa+2]+R;ha[ma]=ua;ha[ma+1]=wa;ha[ma+2]=pa;q.minMaxBoundingBox(ua,wa,pa,Q);ma=qa*ca;ta*=ia;V[ma]=ra[ta];V[ma+1]=ra[ta+1];ma=ja/H;ta=W?da:a.clamp(ma,T,Z);ma=W?a.clamp(ma,aa,I):fa;q.encodeUVInBuffer(ea,qa,ta,ma)}}function D(R){const X=R.geometryState,U=R.localOrigin,M=X.neighborData.cornerNeighborData,V=R.geometry,Y=V.outerEdges,W=V.boundingBox,H=R.tile,S="local"===R.tile.surface.view?.viewingMode,
I=H.ellipsoid.radius,Q=H.extentInRadians,N=H.horizontalScale;let T=0,aa=0,Z=0;const da=()=>{const va=R.geometryState.clippingArea,ya=H.extent,Ea=null!=va&&(ya[3]>va[3]||ya[2]>va[2]||ya[1]<va[1]||ya[0]<va[0]),Ca=A(H.surface.isWebMercatorOnPlateeCarree,H.ellipsoid.radius,N);return(Ga,Ja,Ma)=>{Ga=0===Ga?pa[0]:pa[2];Ja=0===Ja?pa[1]:pa[3];Ga=Ea?a.clamp(Ga,va[0],va[2]):Ga;Ja=Ea?a.clamp(Ja,va[1],va[3]):Ja;T=Ga*N;aa=Ca(Ja);Z=Ma}},fa=(va,ya,Ea)=>{var Ca=Q[0===ya?1:3];va=Q[0===va?0:2];ya=Math.cos(Ca);Ca=Math.sin(Ca);
const Ga=Math.sin(va);Ea=I+Ea;T=Math.cos(va)*ya*Ea;aa=Ga*ya*Ea;Z=Ca*Ea},ka=S?da():fa;let ha=0,ba=0,ea=0,ca=0,ia=0,la=0,oa=0,na=0,ra=0;const ta=S&&R.tile.surface.isWebMercatorOnPlateeCarree,ma=(va,ya,Ea,Ca,Ga)=>{var Ja=0,Ma=0;let Ta=0;S?(Ea=ta?(Math.PI/2-2*Math.atan(Math.exp(-Ea/I)))*I:Ea*N,Ja=ya*N-T,Ma=Ea-aa,Ta=Ca-Z):(Ja=r(va),va=va.tile,Ma=va.extent,va=va.extentInRadians,ya=(ya-Ma[0])/(Ma[2]-Ma[0]),ya=va[0]*(1-ya)+va[2]*ya,Ja=Ja((Ea-Ma[1])/(Ma[3]-Ma[1])),Ea=Math.cos(Ja),va=Math.sin(Ja),Ma=Math.sin(ya),
Ca=I+Ca,Ja=Math.cos(ya)*Ea*Ca-T,Ma=Ma*Ea*Ca-aa,Ta=va*Ca-Z);switch(Ga){case 0:oa+=Ja;na+=Ma;ra+=Ta;break;case 1:ca-=Ja;ia-=Ma;la-=Ta;break;case 2:oa-=Ja;na-=Ma;ra-=Ta;break;case 3:ca+=Ja,ia+=Ma,la+=Ta}},pa=H.extent,ja=X.clippingArea??P,qa=pa[0],ua=pa[2],wa=pa[1],za=pa[3],Aa=[za>ja[3],ua>ja[2],wa<ja[1],qa<ja[0]],Fa=Math.max(qa,ja[0]),Da=Math.min(ua,ja[2]),Ha=Math.max(wa,ja[1]),Ka=Math.min(za,ja[3]),La=V.uvRange[0],Na=V.uvRange[1],Ra=V.uvRange[2],Sa=V.uvRange[3],sa=va=>{va=M[va].cornerTiles;ba=ha=0;
ea=1;ra=na=oa=la=ia=ca=0;var ya=Infinity;for(var Ea=0;4>Ea;++Ea)ya=Math.min(ya,va[Ea]?.level??Infinity);for(Ea=0;4>Ea;++Ea){var Ca=va[Ea];J[Ea]=Ca?.level===ya?Ca:null}va=1;ya=0;for(Ea=0;4>Ea;++Ea)if(Ca=J[Ea])va=Math.max(va,Ca?.renderData.geometryState.numVerticesPerSide),ya=Ca.extent[2]-Ca.extent[0];l.internalAssert(1<va);va=ya/va;for(ya=0;4>ya;++ya){var Ga=J[(ya+3)%4],Ja=J[ya%4];if(Ga||Ja){Ca=0===ya?1:1===ya?2:2===ya?3:0;var Ma=0===ya?2:1===ya?3:2===ya?0:1;if(Ga&&Ja){var Ta=G[ya][0]*va,Va=G[ya][1]*
va,Wa=Ga.extent;Ea=Math.max(ja[0],Math.min(ja[2],Wa[0===Ca||1===Ca?2:0]+Ta));Ca=Math.max(ja[1],Math.min(ja[3],Wa[0===Ca||3===Ca?3:1]+Va));Wa=Ja.extent;Ta=Math.max(ja[0],Math.min(ja[2],Wa[0===Ma||1===Ma?2:0]+Ta));Ma=Math.max(ja[1],Math.min(ja[3],Wa[0===Ma||3===Ma?3:1]+Va));Ga=Ga.renderData;Va=Ja.renderData;Ja=n.sampleElevation(Ea,Ca,Ga.geometryState.samplerData);Ma=n.sampleElevation(Ta,Ma,Va.geometryState.samplerData);ma(Ga,Ea,Ca,.5*(Ja+Ma),ya)}else Ea=Ga??Ja,Ga=Ga?Ca:Ma,Ja=Ea.extent,Ma=G[ya],Ca=Math.max(ja[0],
Math.min(ja[2],Ja[0===Ga||1===Ga?2:0]+Ma[0]*va)),Ga=Math.max(ja[1],Math.min(ja[3],Ja[0===Ga||3===Ga?3:1]+Ma[1]*va)),Ea=Ea.renderData,Ja=n.sampleElevation(Ca,Ga,Ea.geometryState.samplerData),ma(Ea,Ca,Ga,Ja,ya)}}S||(va=Math.sqrt(T*T+aa*aa+Z*Z),ha=T/va,ba=aa/va,ea=Z/va);if(S||.999>ea*ea)va=Math.sqrt(ca*ca+ia*ia+la*la),ca/=va,ia/=va,la/=va,va=Math.sqrt(oa*oa+na*na+ra*ra),oa/=va,na/=va,ra/=va,ha=la*na-ia*ra,ba=ca*ra-la*oa,ea=ia*oa-ca*na,va=1/Math.sqrt(ha*ha+ba*ba+ea*ea),ha*=va,ba*=va,ea*=va};for(let va=
0;4>va;++va){const ya=va,Ea=(va+1)%4,Ca=0===va||1===va?1:0,Ga=0===va||3===va?1:0,Ja=a.clamp(Ca,La,Ra),Ma=a.clamp(Ga,Na,Sa),Ta=Y[ya],Va=0===va||3===va?Ta.count-1:0,Wa=Y[Ea],hb=0===va||1===va?Wa.count-1:0,Ya=M[va].cornerTiles;let cb=-1;for(let Za=0;4>Za;++Za){const bb=Ya[Za];bb&&(-1===cb||0<v.compareTilesByLij(Ya[cb],bb))&&(cb=Za)}const Xa=cb,fb=Ya[Xa];if(fb!==H){const Za=H.level-fb.level,bb=2**Za,Oa=[fb.lij[0]+Za,fb.lij[1]*bb,fb.lij[2]*bb],$a=[Oa[1]+bb===H.lij[1],0===va&&(1===Xa||0===Xa&&fb!==Ya[3])||
1===va&&(0===Xa||1===Xa&&fb!==Ya[2]),Oa[1]===H.lij[1]+1,2===va&&(3===Xa||2===Xa&&fb!==Ya[1])||3===va&&(2===Xa||3===Xa&&fb!==Ya[0])],db=$a.reduce((gb,lb)=>gb+(lb?1:0),0);l.internalAssert(1===db||2===db);let kb=-1,ib=-1;const xa=fb.renderData;if(1===db){const gb=$a.findIndex(ub=>ub);l.internalAssert(0<=gb&&3>=gb);kb=(gb+2)%4;const lb=R.geometryState.neighborData.edgeResolutions[gb];ib=H.getNeighborEdgeStartVertexIndex(gb,fb)*lb+lb*(0===gb&&0===va||1===gb&&0===va||2===gb&&1===va||3===gb&&3===va?1:0)}else{l.internalAssert($a[1]||
$a[3]);kb=$a[1]?3:1;const gb=xa.geometryState.neighborData.edgeResolutions[kb];ib=0===va||3===va?0:gb}const Ba=xa.geometry.outerEdges[kb],Ia=Ta.index0+Va*Ta.stride,Qa=Wa.index0+hb*Wa.stride,Pa=Ba.index0+ib*Ba.stride,Ua=Ba.attributes.position,ab=Ua.typedBuffer,jb=Pa*Ua.typedBufferStride,eb=R.localOrigin,sb=Ba.localOrigin,Gb=ab[jb]+sb[0]-eb[0],Hb=ab[jb+1]+sb[1]-eb[1],Ab=ab[jb+2]+sb[2]-eb[2];q.minMaxBoundingBox(Gb,Hb,Ab,W);const Ib=Ta.attributes.position,wb=Ib.typedBuffer,Bb=Ia*Ib.typedBufferStride;
wb[Bb]=Gb;wb[Bb+1]=Hb;wb[Bb+2]=Ab;const Fb=Wa.attributes.position,Cb=Fb.typedBuffer,xb=Qa*Fb.typedBufferStride;Cb[xb]=Gb;Cb[xb+1]=Hb;Cb[xb+2]=Ab;q.encodeUVInBuffer(Ta.attributes.uv0,Ia,Ja,Ma);q.encodeUVInBuffer(Wa.attributes.uv0,Qa,Ja,Ma);const tb=Ba.attributes.normalCompressed.typedBuffer,qb=Pa*Ba.attributes.normalCompressed.typedBufferStride,yb=Ta.attributes.normalCompressed,rb=yb.typedBuffer,ob=Ia*yb.typedBufferStride;rb[ob]=tb[qb];rb[ob+1]=tb[qb+1];const mb=Wa.attributes.normalCompressed,pb=mb.typedBuffer,
nb=Qa*mb.typedBufferStride;pb[nb]=tb[qb];pb[nb+1]=tb[qb+1]}else{const Za=Aa[Ea];let bb=void 0;if(Aa[ya]||Za){const kb=a.clamp(qa*(1-Ca)+ua*Ca,Fa,Da),ib=a.clamp(wa*(1-Ga)+za*Ga,Ha,Ka);bb=n.sampleElevation(kb,ib,X.samplerData)}else bb=F(Ya);ka(Ca,Ga,bb);sa(va);const Oa=T-U[0],$a=aa-U[1],db=Z-U[2];q.minMaxBoundingBox(Oa,$a,db,W);Ta.setVertexFromValuesRawPositionUVNormal(Va,Oa,$a,db,Ja,Ma,ha,ba,ea);Wa.setVertexFromValuesRawPositionUVNormal(hb,Oa,$a,db,Ja,Ma,ha,ba,ea)}}for(let va=0;4>va;++va)J[va]=null}
function F(R){const X=R.reduce((Y,W)=>Math.min(Y,W?.level??Infinity),Infinity);l.enableTerrainInternalChecks&&(l.internalAssert(!R[0]||!R[2]||w.isCornerNeighbor(R[0],R[2],g.NeighborIndex.SOUTH_WEST)),l.internalAssert(!R[1]||!R[3]||w.isCornerNeighbor(R[1],R[3],g.NeighborIndex.NORTH_WEST)));let U=0,M=0;for(let Y=0;4>Y;++Y){var V=R[Y];if(V&&V.level===X){const W=V.extent;V=n.sampleElevation(W[0===Y||1===Y?0:2],W[0===Y||3===Y?1:3],V.renderData?.geometryState?.samplerData);M+=V;U++}}R=U?M/U:0;l.internalAssert(null!=
R);return R}function K(R){const X=R.geometry.vertexAttributes.position.typedBuffer;R.vao.vertexBuffers.geometry.setSubData(X,0,0,X.length)}function L(R,X,U){if(!X)return!1;R=v.compareTilesByLij(R,X);return 0<R||0===R&&2<=U}const G=[[0,1],[1,0],[0,-1],[-1,0]],O=new e.PatchGeometryLUT,P=f.fromValues(-Infinity,-Infinity,Infinity,Infinity),J=[null,null,null,null];b.createPlanarGlobePatch=function(R,X){const {extent:U,surface:M}=R.tile;X=R.geometryState;var V=U[0],Y=U[1],W=U[2]-V,H=U[3]-Y,S=X.clippingArea;
const I=null!=S?Math.max(0,(S[0]-V)/W):0,Q=null!=S?Math.max(0,(S[1]-Y)/H):0;V=null!=S?Math.min(1,(S[2]-V)/W):1;Y=null!=S?Math.min(1,(S[3]-Y)/H):1;H=X.numVerticesPerSide;S=(H-2)**2;W=X.neighborData.edgeResolutions.reduce((T,aa)=>T+aa+1,0);W=M.renderer.tileGeometryCache.acquire(S+W);const N=R.geometry;d.empty(N.boundingBox);N.numVerticesPerSide=X.numVerticesPerSide;N.vertexAttributes=W;c.set(N.uvRange,I,Q,V,Y);u(R);E(R,S);y(R);C(N,X.numVerticesPerSide,[],[0,H-1],[0,H-1],X.wireframe);R.intersectionData=
null};b.createSphericalGlobePatch=function(R,X){const U=R.tile,{extent:M,extentInRadians:V,surface:Y}=U,W=R.localOrigin,H=R.geometryState;var S=Y.isWebMercator;const I=H.numVerticesPerSide,Q=I-1,N=(I-2)**2,T=S&&(X===k.PatchType.HAS_SOUTH_POLE||X===k.PatchType.HAS_BOTH_POLES),aa=S&&(X===k.PatchType.HAS_NORTH_POLE||X===k.PatchType.HAS_BOTH_POLES);S=6*((T?1:0)+(aa?1:0))*(Q+1);X=H.neighborData;const Z=X.edgeResolutions.reduce((ba,ea)=>ba+ea+1,0),da=Y.renderer.tileGeometryCache.acquire(N+S+Z);S=R.geometry;
S.numVerticesPerSide=H.numVerticesPerSide;S.vertexAttributes=da;const fa=S.boundingBox;d.empty(fa);const ka=r(R);O.update(Q,V,ka);p(R);E(R,N);h(R);const ha=[];(()=>{let ba=N+Z;const ea=W[0],ca=W[1],ia=W[2],la=U.ellipsoid.radius,oa=M[1],na=M[3],ra=(ta,ma)=>{ma*=I;q.minMaxBoundingBox(-ea,-ca,-ia+ta*la,fa);ha.push({connectedRowOffset:ma,connectedOuterEdgeOffset:1===ta?0:2,rowOffset:ba,latitudeResolution:6});ma=Math.PI/2-2*Math.atan(Math.exp(-(-1===ta?oa:na)/la));const pa=ta*Math.PI/2-ma;ta=.99*(1===
ta?1:-1);const ja=la+0,{position:qa,uv0:ua}=da,{typedBuffer:wa,typedBufferStride:za}=da.normalCompressed;for(let Fa=1;6>=Fa;++Fa){var Aa=ma+Fa/6*pa;const Da=Math.cos(Aa);Aa=Math.sin(Aa);for(let Ha=0;Ha<=Q;Ha++){const Ka=Ha/Q,La=O.cosLonLUT[Ha]*Da,Na=O.sinLonLUT[Ha]*Da,Ra=Aa,Sa=La*ja-ea,sa=Na*ja-ca,va=Ra*ja-ia;q.minMaxBoundingBox(Sa,sa,va,fa);qa.setValues(ba,Sa,sa,va);q.encodeUVInBuffer(ua,ba,Ka,ta);x.compressNormal(wa,ba,La,Na,Ra,za);++ba}}};T&&ra(-1,0);aa&&ra(1,Q)})();C(S,H.numVerticesPerSide,ha,
[0,I-1],[0,I-1],H.wireframe);R.intersectionData=null;if(l.enableTerrainInternalChecks)for(R=0;4>R;++R)l.internalAssert(S.outerEdges[R].count===X.edgeResolutions[R]+1)};b.updateCornerSpherical=function(R){R.tile.intersectsClippingArea&&(D(R),t(R,!0),K(R))};b.updateCornersPlanar=function(R,X){R.tile.intersectsClippingArea&&(D(R),z(R,!0),K(R))};b.updateEdgesAndCornersPlanar=function(R,X){R.tile.intersectsClippingArea&&(y(R),K(R))};b.updateEdgesAndCornersSpherical=function(R){R.tile.intersectsClippingArea&&
(h(R),K(R))};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/PatchGeometry":function(){define("exports ../../../core/maybe ../../../chunks/vec3 ../../../geometry/support/aaBoundingBox ./terrainUtils ../webgl-engine/lib/Normals".split(" "),function(b,a,c,d,f,n){function k(e,m,l,w){e.setValues(m,16384*l,16384*w)}class g{constructor(){this.vertexAttributes=this.indices=null;this.boundingBox=d.empty();this.numVerticesPerSide=this.indexCount=0;this.uvRange=[0,0,1,
1];this.outerEdges=[null,null,null,null];this.innerEdges=[null,null,null,null]}release(){this.vertexAttributes=a.releaseMaybe(this.vertexAttributes);this.indices=null}}class q{constructor(e,m,l,w,v){this.attributes=e;this.localOrigin=m;this.index0=l;this.stride=w;this.count=v}getVertexIndex(e){return this.getAttributeIndex(e)}getAttributeIndex(e){f.internalAssert(0<=e&&e<this.count);return this.index0+this.stride*e}_getVertexRaw(e,m){this.attributes.position.getVec(e,m)}getVertexPos(e,m){this._getVertexRaw(this.getAttributeIndex(m),
e);c.add(e,e,this.localOrigin)}getNormal(e,m){const {typedBuffer:l,typedBufferStride:w}=this.attributes.normalCompressed;n.decompressNormal(e,l,this.getAttributeIndex(m),w)}_setNormal(e,m,l,w){const {typedBuffer:v,typedBufferStride:x}=this.attributes.normalCompressed;n.compressNormal(v,e,m,l,w,x)}_setUV(e,m,l){k(this.attributes.uv0,e,m,l)}setNormalFromValues(e,m,l,w){this._setNormal(this.getAttributeIndex(e),m,l,w)}setVertexFromValuesRawPositionUV(e,m,l,w,v,x){e=this.getAttributeIndex(e);this.attributes.position.setValues(e,
m,l,w);this._setUV(e,v,x)}setVertexFromValuesRawPositionUVNormal(e,m,l,w,v,x,p,h,t){e=this.getAttributeIndex(e);this.attributes.position.setValues(e,m,l,w);this._setUV(e,v,x);this._setNormal(e,p,h,t)}}b.EdgeDescriptor=q;b.PatchGeometry=g;b.encodeUVInBuffer=k;b.minMaxBoundingBox=function(e,m,l,w){e<w[0]?w[0]=e:e>w[3]&&(w[3]=e);m<w[1]?w[1]=m:m>w[4]&&(w[4]=m);l<w[2]?w[2]=l:l>w[5]&&(w[5]=l)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/PatchGeometryLUT":function(){define(["exports",
"./TerrainConst"],function(b,a){class c{constructor(){this.sinLonLUT=Array(a.maxPatchTesselation+1);this.cosLonLUT=Array(a.maxPatchTesselation+1);this.sinLatLUT=Array(a.maxPatchTesselation+1);this.cosLatLUT=Array(a.maxPatchTesselation+1)}update(d,f,n){const k=f[0];f=f[2];for(let q=0;q<=d;q++){var g=q/d;const e=k*(1-g)+f*g;this.sinLonLUT[q]=Math.sin(e);this.cosLonLUT[q]=Math.cos(e);g=n(g);this.sinLatLUT[q]=Math.sin(g);this.cosLatLUT[q]=Math.cos(g)}}}b.PatchGeometryLUT=c;Object.defineProperty(b,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/terrain/PatchRenderData":function(){define("exports ../../../core/arrayUtils ../../../core/mathUtils ../../../core/maybe ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/Ellipsoid ../support/buffer/glUtil ./GeometryState ./ITile ./LayerClass ./PatchGeometry ./terrainUtils ./TextureFader ./Tile ./TileOverlayData ./tileUtils ../webgl-engine/lib/VertexArrayObject ../webgl-engine/shaders/TerrainTechnique ../../webgl/BufferObject ../../webgl/enums".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A){function C(P,J){return J?.isLoaded||J===P?J:null}class E{constructor(){this.geometry=new v.PatchGeometry;this.geometryState=this.intersectionData=null;this._textureRef=new p.TextureFader(()=>this.tile.surface.textureFadeDuration);this.overlay=new t;this._geometryStateChangedSinceLastUpdate=!0;this._wireframeChanged=this._clippingAreaChanged=this._samplerDataChanged=this._numVerticesPerSideChanged=this._hasGeometry=!1;this._dirtyCorners=this._dirtyEdges=
this._dirtyEdgeResolutions=15}get tile(){return this._tile}init(P){this.clear();this._tile=P;P=this.geometry;P.indices=null;P.vertexAttributes=null;k.empty(P.boundingBox);P.indexCount=0;P.numVerticesPerSide=0;this.intersectionData=null;this.geometryState=new m.GeometryState;this.localOrigin=null;this.overlay.clear()}clear(){this.releaseGeometry();this.releaseTexture();this._textureRef.clear();this.geometryState=this.intersectionData=this._tile=null}updateGeometryIfNeeded(P){if(!this._vao||this._geometryStateChangedSinceLastUpdate||
this._wireframeChanged||this._clippingAreaChanged||this._samplerDataChanged||this._numVerticesPerSideChanged||this._dirtyCorners||this._dirtyEdgeResolutions||this._dirtyEdges)this._updateGeometry(P),this._geometryStateChangedSinceLastUpdate=!1;if(x.enableTerrainInternalChecks&&this.tile.intersectsClippingArea)for(P=0;4>P;++P)x.internalAssert(this.geometry.outerEdges[P].count===this.geometryState.neighborData.edgeResolutions[P]+1)}_calculateEdgeResolution(P,J){const R=this.tile,X=this.geometryState.numVerticesPerSide-
1;if(!R.surface.isGlobal){var U=R.surface.extent;if(null!=U&&(0===P&&R.extent[3]>U[3]||1===P&&R.extent[2]>U[2]||2===P&&R.extent[1]<U[1]||3===P&&R.extent[0]<U[0]))return X}const M=R.level;U=x.neighborEdgeIndices[P];if(!J)return x.internalAssert(null==R.surface?.rootTiles||R.surface.updatingRootTiles||!R.shouldHaveNeighbor(U)),X;if(J.isLoaded)return U=J.renderData.geometryState,J=M-J.level,x.internalAssert(0<=J),0===J?Math.max(U.numVerticesPerSide-1,X):Math.max(1,U.neighborData.edgeResolutions[(P+2)%
4]/2**J);x.internalAssert(!J.isLeaf);let V=X;J.forAllSubtreeOnSide(x.oppositeEdge(U),Y=>{if(Y===R)return!0;if(Y.isLoaded)return V=Math.max(V,2**(Y.level-M)),!0;x.internalAssert(!Y.isLeaf);return!1});return V}updateNeighborData(){const P=this.tile;if(P.intersectsClippingArea){var J=P.renderData.geometryState.neighborData,R=S=>(S.isLoaded||S.level===P.level)&&S?.intersectsClippingArea,X=J.edgePeerNeighbors,U=J.edgePeerNeighborSamplerVersions;for(var M=0;4>M;++M){var V=P.findNeighborTile(x.neighborEdgeIndices[M],
R),Y=C(P,V),W=Y?.renderData?.geometryState.samplerDataVersion??-1,H=C(P,X[M]);Y=Y!==H;H=U[M]!==W;X[M]=V;if(Y||H)U[M]=W,this._markEdgeDirty(M);W=J.edgeResolutions[M];V=this._calculateEdgeResolution(M,V);x.internalAssert(c.isPowerOfTwo(V));x.internalAssert(1<=V);J.edgeResolutions[M]=V;W!==V&&this._markEdgeResolutionDirty(M)}U=J.cornerPeerNeighbors;for(M=0;4>M;++M){Y=P.findNeighborTile(x.neighborCornerIndices[M],R);U[M]=Y;V=C(P,X[M]);W=C(P,X[(M+1)%4]);Y=C(P,Y);O[M]=Y;O[(M+1)%4]=W;O[(M+2)%4]=P;O[(M+3)%
4]=V;x.internalAssert(O.some(I=>I?.isLoaded||I===P));const S=O.reduce((I,Q)=>Math.min(I,Q?.level??Infinity),Infinity);O.forEach((I,Q)=>{I&&I?.level>S&&(O[Q]=null)});x.internalAssert(O.some(I=>I?.isLoaded||I===P));V=J.cornerNeighborData[M].cornerTiles;W=J.cornerNeighborData[M].cornerTileSamplerVersions;for(Y=0;4>Y;++Y){H=O[Y];const I=H?.renderData.geometryState.samplerDataVersion??-1,Q=V[Y]!==H,N=!Q&&W[Y]!==I;if(Q||N)V[Y]=H,W[Y]=I,this._markCornerDirty(M)}x.internalAssert(V.some(I=>I?.isLoaded||I===
P))}x.enableTerrainInternalChecks&&x.internalAssert(this.geometryState.neighborData.edgeResolutions.every(S=>0<S));for(J=0;4>J;++J)O[J]=null}}_updateGeometry(P){if(this.tile.intersectsClippingArea){x.enableTerrainInternalChecks&&x.internalAssert(!this.tile.intersectsClippingArea||this.geometryState.neighborData.edgeResolutions.every(M=>0<M));this.intersectionData=null;var J=this.tile,R=this.geometry.vertexAttributes;R=!this._vao||!R||this._wireframeChanged||this._numVerticesPerSideChanged||this._samplerDataChanged||
this._clippingAreaChanged||this._dirtyEdgeResolutions;var X=!R&&(0!==this._dirtyEdges||0!==this._dirtyEdgeResolutions),U=!X&&0!==this._dirtyCorners;R?(this.releaseGeometry(),this._createGeometry(P)):X||U?J.updateEdgeElevations():U?J.updateCornerElevations():console.warn("Update for no reason?");this._samplerDataChanged=this._numVerticesPerSideChanged=!1;this._dirtyCorners=this._dirtyEdges=this._dirtyEdgeResolutions=0;this._wireframeChanged=this._clippingAreaChanged=!1}}get hasGeometry(){return this._hasGeometry}releaseGeometry(){this._hasGeometry=
!1;this.intersectionData=null;if(!this._vao)return!1;this._vao=d.disposeMaybe(this._vao);this.geometry.release();return!0}ensureTexture(P,J,R){J=J?A.PixelFormat.RGBA:A.PixelFormat.RGB;null==this._texture||this._texture.descriptor.width===P&&this._texture.descriptor.pixelFormat===J||this.releaseTexture();null==this._texture&&(this._texture=R(),this.tile.setMemoryDirty());return this._texture}releaseTexture(){null!=this._texture&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}_markCornerDirty(P){this._dirtyCorners|=
1<<P}_markEdgeDirty(P){this._dirtyEdges|=1<<P;this._markCornerDirty((P+0)%4);this._markCornerDirty((P+3)%4)}_markEdgeResolutionDirty(P){this._dirtyEdgeResolutions|=1<<P;this._markEdgeDirty(P)}_markAllEdgesAndCornersDirty(){this._dirtyEdgeResolutions=this._dirtyEdges=this._dirtyCorners=15}updateGeometryState(){var P=this._getElevationInfo();const J=this.tile;var R=P.samplerData?J.getElevationVerticesPerSide(P.maxTileLevel):J.getDefaultVerticesPerSide();const X=Math.max(R,5);let U=J.clippingArea;if(!J.intersectsClippingArea||
J.isWithinClippingArea)U=null;R=this.geometryState;let M=!1;R.numVerticesPerSide!==X&&(this._numVerticesPerSideChanged=!0,R.numVerticesPerSide=X,R.samplerDataVersion++,M=!0);P.changed&&(this._samplerDataChanged=!0,R.samplerData=P.samplerData,R.samplerDataVersion++,M=!0);a.equals(R.clippingArea,U)||(this._clippingAreaChanged=!0,R.clippingArea=U,M=!0);P=J.surface.wireframe;R.wireframe!==P&&(this._wireframeChanged=!0,R.wireframe=P,M=!0);this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=
M);M&&this._markAllEdgesAndCornersDirty();this._hasGeometry=!0;return this._geometryStateChangedSinceLastUpdate}_createGeometry(P){this.tile.createGeometry();const J=this.geometry.vertexAttributes,R=this.geometry.indices,X=P.gl;this._vao=new u.VertexArrayObject(P,y.terrainVertexAttributeLocations,{geometry:e.glLayout(J.layout)},{geometry:z.BufferObject.createVertex(P,X.STATIC_DRAW,J.buffer)},z.BufferObject.createIndex(P,X.STATIC_DRAW,R));this._hasGeometry=!0}get vao(){return this._vao}setTextureReference(P,
J=p.ActivationTime.Immediate){null!=P&&P.texture!==this._texture&&this.releaseTexture();this._textureRef.push(P,J)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_getElevationInfo(){var P=this.geometryState.samplerData;const J=this.tile.layerInfo[w.LayerClass.ELEVATION],R=J.length,X=Array(R);let U=0;var M=0;let V=!1;for(let H=
0;H<R;H++){var Y=J[H];if(null!=Y.upsampleInfo){Y=Y.upsampleInfo.tile;var W=Y.layerInfo[w.LayerClass.ELEVATION][H].data;W=W&&W.samplerData;P&&P[U]===W||(V=!0);X[U++]=W;M=Math.max(M,Y.lij[0])}else Y.data&&(W=this.tile.surface.layerViewByIndex(H,w.LayerClass.ELEVATION),r.fallsWithinLayer(this.tile,W.layer,!1)&&(M=Y.data,P&&P[U]===M.samplerData||(V=!0),X[U++]=M.samplerData,M=this.tile.level))}null!=P&&P.length!==U&&(V=!0);if(P=0<U)X.length=U;return{changed:V,samplerData:P?X:null,maxTileLevel:M}}get estimatedGeometryMemoryUsage(){return(this.geometry.indices?.byteLength??
0)+(this.geometry.vertexAttributes?.byteLength??0)+(this.intersectionData?.estimatedMemoryUsage??0)}get texture(){return this._texture}get test(){return{hasTexture:null!=this._texture}}checkGeometryWaterproofness(){if(x.enableTerrainInternalChecks){var P=this.tile;if(P.isLoaded&&P.intersectsClippingArea&&0!==P.level){var J=P.surface.extent;if(null==J||P.intersectsExtent(J)){var R=x.neighborEdgeIndices.map((V,Y)=>null!=J?0>(2>Y?-1:1)*(P.extent[3-Y]-J[3-Y]):!1),X=P.level;x.internalAssert(0===this._dirtyCorners);
x.internalAssert(0===this._dirtyEdges);x.internalAssert(0===this._dirtyEdgeResolutions);x.internalAssert(!this._numVerticesPerSideChanged);x.internalAssert(!this._samplerDataChanged);x.internalAssert(!this._clippingAreaChanged);x.internalAssert(!this._wireframeChanged);var U=x.neighborCornerIndices.map(V=>P.findNeighborCornerTileExact(V,Y=>!Y.intersectsClippingArea||Y.isLoaded||Y.level===P.level)??null).map(V=>V?.intersectsClippingArea?V:null),M=this.geometryState.neighborData;for(let V=0;4>V;++V){const Y=
M.cornerPeerNeighbors[V],W=U[V];x.internalAssert(W===Y,`Tile[${P.lij}].corner[${V}] out of date: cur=[${Y?.lij}] exp=[${W?.lij}]`)}x.neighborEdgeIndices.forEach((V,Y)=>{if(!R[Y]){var W=P.findNeighborTile(V,la=>(la.level===X||la?.isLoaded)&&la?.intersectsClippingArea);if(W){x.internalAssert(W.isLoaded||W.level===P.level);x.internalAssert(W===this.geometryState.neighborData.edgePeerNeighbors[Y]);var H=X-W.level;if(W.isLoaded){var S=W.renderData;x.internalAssert(h.isEdgeNeighbor(P,W,V));x.internalAssert(0<=
H);var I=2**H;if(0>H)x.internalAssert(!1);else{var Q=P.renderData,N=Q.geometry,T=N.outerEdges[Y],aa=N.numVerticesPerSide-1,Z=S.geometry;if(Z){N=this.geometryState.neighborData.edgePeerNeighbors[Y];if(N?.isLoaded){var da=N.renderData;x.internalAssert(N===N);x.internalAssert(Q.geometryState.neighborData.edgePeerNeighborSamplerVersions[Y]===da.geometryState.samplerDataVersion);x.internalAssert(this.geometryState.neighborData.edgePeerNeighborSamplerVersions[Y]===da.geometryState.samplerDataVersion)}var fa=
(Y+2)%4,ka=Z.outerEdges[fa];N=T.count-1;da=ka.count-1;x.internalAssert(N*I===da,`Tile[${P.lij}]:e${Y},res=${N} edgeRes mismatch with`+` Neighbor[${W.lij}]:e${fa},res=${da} (expected:${N*I})`);N=P.extent;da=V===l.NeighborIndex.NORTH||V===l.NeighborIndex.SOUTH;var ha=ka.count-1,ba=ha/2**H,ea=T.count-1;if(1>ba)x.internalAssert(1===ea);else{x.internalAssert(ba===ea);x.internalAssert(c.isPowerOfTwo(ba));Z=Z.numVerticesPerSide-1;x.internalAssert(0<H||ba===Math.max(Z,aa));H=P.getNeighborEdgeStartVertexIndex(Y,
W);x.internalAssert(0<=H&&H<I);I=H*ba;x.internalAssert(0<=I&&I<=ha-ba);var ca=0,ia=I;T.getVertexPos(B,0);T.getVertexPos(D,T.count-1);I=f.distance(B,D);I=Math.max(1,1E-4*I);for(H=0;H<=ba;++H){T.getVertexPos(B,ca);ka.getVertexPos(D,ia);Z=H/ba;aa=da?N[0]+Z*(N[2]-N[0]):V===l.NeighborIndex.WEST?N[0]:N[2];const la=da?V===l.NeighborIndex.SOUTH?N[1]:N[3]:N[1]+Z*(N[3]-N[1]),oa=P.surface.extent;if(null==oa||g.containsXY(oa,aa,la)){Z=f.dist(B,D);ha=f.len(B)-q.earth.radius;ea=f.len(D)-q.earth.radius;const na=
Z<I;na||(console.warn("Tile edge vertex position mismatch: between"+` [${P.lij}].edge${Y}[${ca}/${T.count}] and`+` [${W.lij}].edge${fa}[${ia}/${ka.count}]`),null!=oa&&console.warn("  surface extent\x3d ",oa," x,y\x3d",aa,",",la),aa=n.create(),f.subtract(aa,Q.localOrigin,S.localOrigin),0<f.len(aa)&&console.warn(`   localOrigins: ${Q.localOrigin} vs ${S.localOrigin}`+` d=${f.len(aa)} [${aa}]`),(()=>{const ta=n.clone(B),ma=n.clone(D);P.updateEdgeElevations();W.updateEdgeElevations();T.getVertexPos(B,
ca);ka.getVertexPos(D,ia);const pa=n.create();f.sub(pa,B,ta);0<f.len(pa)&&console.warn(`  XXX Tile[${P.lij}] edge out of date: ${ta} vs ${B} d=${f.len(pa)} [${pa}]`);f.sub(pa,D,ma);0<f.len(pa)&&console.warn(`  XXX Neighbor[${W.lij}] edge out of date: ${ma} vs ${D} d=${f.len(pa)} [${pa}]`)})(),x.internalAssert(na,"Mismatch in tile"+` [${P.lij}].edge[${Y}][${ca}/${T.count}] vs neighbor`+` [${W.lij}].edge[${fa}][${ia}/${ka.count}]`+` ${x.v32s(B)} vs ${x.v32s(D)}  dist=${Z} h(t|n|d)=${ha}|${ea}|${ea-
ha}`));T.getNormal(F,ca);ka.getNormal(K,ia);f.normalize(L,F);f.normalize(G,K);const ra=f.dot(L,G);aa=.01>1-ra||P===W;if(!aa){const ta=n.create();f.sub(ta,F,K);Z=()=>`Mismatch in tile edge normal ${x.lij2s(P.lij)} (${ca}/${T.count-1}) edge ${Y} vs neighbor ${x.lij2s(W.lij)}  (${ia}/${ka.count-1}) nedge ${fa} :`+`${x.v32s(F)} vs ${x.v32s(K)}  dot = ${ra} : ${x.v32s(ta)}`;console.warn("Mismatch in tile edge normal: ",Z());P.updateEdgeElevations();W.updateEdgeElevations();ha=n.create();ea=n.create();
T.getNormal(ha,ca);ka.getNormal(ea,ia);f.equals(F,ha)||console.warn("Missing update in tile normal: ",x.v32s(F)," \x3d\x3e ",x.v32s(ha));f.equals(K,ea)||console.warn("Missing update in neighbor normal: ",x.v32s(K)," \x3d\x3e ",x.v32s(ea));x.internalAssert(aa,Z())}}ca+=1;ia+=1}}}else x.internalAssert(!1)}}else x.internalAssert(!W.isLeaf),x.internalAssert(0===H)}else V=!P.surface.updatingRootTiles&&null!=P.surface.rootTiles&&0<P.surface.rootTiles.length&&P.shouldHaveNeighbor(V),x.internalAssert(!V)}})}}else x.internalAssert(P?.isLoaded)}}}
const B=n.create(),D=n.create(),F=n.create(),K=n.create(),L=n.create(),G=n.create(),O=[null,null,null,null];Object.defineProperty(b,"ActivationTime",{enumerable:!0,get:()=>p.ActivationTime});b.PatchRenderData=E;b.neighborTileIfLoadedOrSelf=C;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/GeometryState":function(){define(["exports"],function(b){class a{constructor(){this.cornerTiles=[null,null,null,null];this.cornerTileSamplerVersions=[-1,-1,-1,-1]}}class c{constructor(){this.cornerNeighborData=
[new a,new a,new a,new a];this.edgeResolutions=[-1,-1,-1,-1];this.edgePeerNeighbors=[null,null,null,null];this.edgePeerNeighborSamplerVersions=[-1,-1,-1,-1];this.cornerPeerNeighbors=[null,null,null,null]}}class d{constructor(){this.numVerticesPerSide=0;this.clippingArea=this.samplerData=null;this.wireframe=!1;this.samplerDataVersion=0;this.neighborData=new c}}b.CornerNeighborData=a;b.GeometryState=d;b.NeighborhoodData=c;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TextureFader":function(){define(["exports",
"../../../core/maybe","./interfaces"],function(b,a,c){class d{constructor(f){this._getFadeDuration=f;this._delayedTime=this._fadeStart=0}clear(){this._current=a.destroyMaybe(this._current);this._next=a.destroyMaybe(this._next);this._waiting=a.destroyMaybe(this._waiting);this._delayed=a.destroyMaybe(this._delayed)}get current(){if(null==this._current)return null;if(!this._isFadingEnabled){var f=this._delayed||this._waiting||this._next||this._current;f!==this._current&&(this._current=null,this.clear(),
this._current=f)}f=d.test.fadeMoment;null!=this._delayed&&(f=f||performance.now(),f>=this._delayedTime&&(this._push(this._delayed,b.ActivationTime.Immediate),this._delayed=null));if(null!=this._next){f=f||performance.now();const n=this._next.type!==c.TextureUpdate.FADING,k=f-this._fadeStart>=this._fadeDuration;if(null!=this._current&&this._next.texture===this._current.texture||n||k)a.destroyMaybe(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(f)}return this._current}get next(){return this._next}get fadeFactor(){if(null==
this._next)return 1;var f=d.test.fadeMoment||performance.now();f=Math.max(0,f-this._fadeStart);const n=this._fadeDuration;return f>n?0:1-f/n}get isFading(){return null!=this._next||null!=this._delayed}push(f,n=b.ActivationTime.Immediate){this._delayed=a.destroyMaybe(this._delayed);this._push(f,n)}_push(f,n){this._isFadingEnabled||this.clear();if(null==this._current)this._current=f;else{var k=d.test.fadeMoment||performance.now();n!==b.ActivationTime.Immediate?(this._delayed=f,this._delayedTime=k+n):
null==this._next?(this._next=f,this._fadeStart=this._alignFadeStart(k)):null!=f&&(a.destroyMaybe(this._waiting),this._waiting=f)}}get _fadeDuration(){return null==this._waiting?this._getFadeDuration():.5*this._getFadeDuration()}_alignFadeStart(f){const n=this._getFadeDuration();return f+n-f%n}get _isFadingEnabled(){return 0<this._getFadeDuration()}}d.test={fadeMoment:0};b.ActivationTime=void 0;(function(f){f[f.Immediate=0]="Immediate";f[f.Delayed=5E3]="Delayed"})(b.ActivationTime||(b.ActivationTime=
{}));b.TextureFader=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/Tile":function(){define("exports ../../../core/mathUtils ../../../core/maybe ../../../core/ObjectPool ../../../chunks/vec2 ../../../chunks/vec2f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/common ../../../geometry/ellipsoidUtils ../../../geometry/support/aaBoundingRect ../../../chunks/sphere ../../../layers/support/layerUtils ../../2d/engine/vectorTiles/VectorTile ../support/StreamDataLoader ./ElevationBounds ./ElevationTileAgent ./interfaces ./ITile ./LayerClass ./MapTileAgent ./RasterTile ./TerrainConst ./terrainUtils ./TileAgent ./TilePerLayerInfo ./TileTexture ./TileUpdate ./tileUtils".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A,C,E,B,D,F,K){function L(W){W.dispose();W instanceof h.ElevationTileAgent?R.release(W):W instanceof y.MapTileAgent&&J.release(W)}function G(W,H,S){return null==W||null==H||H===W?!1:W.level>=H.level?O(W,H,S):O(H,W,C.oppositeCorner(S))}function O(W,H,S){C.internalAssert(W.level>=H.level);var I=C.isWestCorner(S),Q=C.isNorthCorner(S),N=W.extent;S=H.extent;var T=[I?N[0]:N[2],Q?N[3]:N[1]];const aa=[I?S[2]:S[0],Q?S[1]:S[3]];I=1E-5*(N[2]-N[0]);Q=C.almostEquals(T[0],
aa[0],I)||W.surface.isGlobal&&C.almostEquals(T[0],-aa[0],I);T=C.almostEquals(T[1],aa[1],I);if(Q&&T)return!0;if(W.level===H.level||!Q&&!T)return C.internalAssert(!1),!1;Q?(W=N[1],N=N[3],S=S[1]-I<=W&&W<=N&&N<=S[3]+I):(W=N[0],N=N[2],S=S[0]-I<=W&&W<=N&&N<=S[2]+I);C.internalAssert(S);return S}class P{constructor(){this.lij=[0,0,0];this._children=[null,null,null,null];this._pendingUpdates=0;this.renderData=null;this._dirty=!0;this._previouslyRendered=!1;this.extent=m.create();this._elevationBounds=n.create();
this.layerInfo=[[],[]];this.extentInRadians=m.create();this.centerAtSeaLevel=g.create();this._center=[g.create(),l.create(),g.create()];this.up=g.unitZ();this._intersectsClippingArea=this._isWithinClippingArea=!0;this._maxTesselation=0;this._usedMemory=null;this.extentMidY=this.extentMidX=this._curvatureHeight=this._edgeLen2=this._edgeLen=this.renderOrder=this.screenDepth=this._mapDataRefCount=this._mapTileMemoryInternal=0;this.distanceToPOI=-1;this._lastPOI=g.create()}static prune(){J.prune(0);R.prune(0);
B.TilePerLayerInfo.prune()}get _isCached(){return!this.shouldLoad&&0>=this._mapDataRefCount}get maxTesselation(){return this._maxTesselation}get isWithinClippingArea(){return this._isWithinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBounds(){return this._elevationBounds}get level(){return this.lij[0]}get key(){return`${this.lij[0]}/${this.lij[1]}/${this.lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[b.CenterPosition.MIDDLE][3]}get visible(){this._dirty&&
this.computeVisibility();return this._visible}get frustumVisibility(){this._dirty&&this.computeVisibility();return this._frustumVisibility}computeVisibility(){this._dirty=!1;var W=this.parent?.frustumVisibility??r.TileFrustumVisibility.INTERSECTS;this._frustumVisibility=W===r.TileFrustumVisibility.INSIDE?r.TileFrustumVisibility.INSIDE:W===r.TileFrustumVisibility.OUTSIDE?r.TileFrustumVisibility.OUTSIDE:this._calculateFrustumVisibilityStatus(this.surface.frustum);W=this._frustumVisibility!==r.TileFrustumVisibility.OUTSIDE&&
this._intersectsClippingArea;W!==this._visible&&(this._visible=W,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setDirty(),this.updateAgentSuspension())}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const W=!!this.renderData;W!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=W,this._surface.renderer.setDirty());return W}get shouldLoad(){return this.isLeaf}init(W,H,S,I,Q){this.lij[0]=
W;this.lij[1]=H;this.lij[2]=S;this.ellipsoid=e.getReferenceEllipsoid(Q.tilingScheme.spatialReference);Q.tilingScheme.getExtent(W,H,S,this.extent);Q.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians);this.extentMidX=.5*(this.extent[0]+this.extent[2]);this.extentMidY=.5*(this.extent[1]+this.extent[3]);this._intersectsClippingArea=this._isWithinClippingArea=!0;this._clippingArea=null;this._mapDataRefCount=0;Q.upsampleMapCache.pop(this.key);this._edgeLen2=this._edgeLen=0;this._center[b.CenterPosition.MIDDLE][3]=
0;this.elevationLevel=W;I&&I.elevationBounds?f.copy(this._elevationBounds,I.elevationBounds):f.set(this._elevationBounds,0,0);this._pendingUpdates=0;this.renderData=null;this.screenDepth=0;this._previouslyRendered=this._visible=!1;this._parent=I;this.unsetChildren();this._surface=Q;this.updateVisibility();for(const N of u.LayerClasses){W=Q.numLayers(N);H=this.layerInfo[N];for(const T of H)T.release();H.length=W;for(S=0;S<W;S++)H[S]=B.TilePerLayerInfo.acquire(this._surface.upsampleInfoPool),N===u.LayerClass.ELEVATION&&
this.findElevationBoundsForLayer(S,-1)}this.computeElevationBounds();this._maxTesselation=Math.min(Q.tilingScheme.pixelSize,A.maxPatchTesselation)}dispose(){C.weakAssert(!this.renderData,"tile.renderData was not unloaded");this._surface.upsampleMapCache.pop(this.key);for(var W of u.LayerClasses){for(const H of this.layerInfo[W])H.release();this.layerInfo[W].length=0}this._parent=null;for(W=0;4>W;++W)this._children[W]=null;this._surface=null;this.setMemoryDirty()}refMapData(){++this._mapDataRefCount;
this._isCached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){--this._mapDataRefCount;if(this._isCached){this.setMemoryDirty();const W=this._cachedMemory;0<W&&this._surface.upsampleMapCache.put(this.key,this,W)}}setMemoryDirty(){this._usedMemory=null}get usedMemory(){return this._ensureUsedMemory()+(this._isCached?0:this._mapTileMemoryInternal)}get _cachedMemory(){return this._isCached?this._mapTileMemory:0}get _mapTileMemory(){this._ensureUsedMemory();return this.layerInfo[u.LayerClass.MAP].reduce((W,
H)=>W+(H instanceof v.VectorTile?H.memoryUsed/H.referenced:0),this._mapTileMemoryInternal)}get _cpuImageMemorySize(){const W=this._surface.tilingScheme.pixelSize;return W*W*4}_ensureUsedMemory(){if(null!=this._usedMemory)return this._usedMemory;this._usedMemory=this._baseUsedMemory;let W=this._mapTileMemoryInternal=0;for(var {data:H}of this.layerInfo[u.LayerClass.MAP])H instanceof v.VectorTile?W+=this._getTerrainDataMemory(H):this._mapTileMemoryInternal+=this._getTerrainDataMemory(H);H=this._cpuImageMemorySize;
for(const S of this.layerInfo[u.LayerClass.ELEVATION])this._usedMemory+=S.data?H:0;this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemoryInternal+=this.renderData.texture?.usedMemory??0);this._isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemoryInternal+W);return this._usedMemory}getUsedMemoryForLayer(W,H){H=this.layerInfo[W][H];return H?.data?W===u.LayerClass.MAP?this._isCached?0:this._getTerrainDataMemory(H.data):W===
u.LayerClass.ELEVATION?this._cpuImageMemorySize:0:0}_getTerrainDataMemory(W){return W instanceof D?W.texture.gpuMemoryUsage:W instanceof HTMLImageElement||W instanceof x.ImageWithType?this._cpuImageMemorySize:W instanceof z.RasterTile?W.memoryUsage:W instanceof v.VectorTile?W.memoryUsed/W.referenced:0}updateScreenDepth(W){var H=this._center[b.CenterPosition.MIDDLE];const S=H[0],I=H[1];H=H[2];const Q=W[2]*S+W[6]*I+W[10]*H+W[14];this.screenDepth=0>Q?0:Q/(W[3]*S+W[7]*I+W[11]*H+W[15])}shouldSplit(W,H,
S){if(!this.visible||W.frustum&&(!this._intersectsClippingArea||this._calculateFrustumVisibilityStatus(W.frustum)===r.TileFrustumVisibility.OUTSIDE))return F.TileUpdate.NONE;const I=this.level;k.subtract(U,this._center[b.CenterPosition.MIDDLE],H);var Q=k.squaredLength(U),N=U;let T=b.CenterPosition.MIDDLE;k.subtract(M,this._center[b.CenterPosition.TOP],H);var aa=k.squaredLength(M);aa<Q&&(Q=aa,N=M,T=b.CenterPosition.TOP);k.subtract(V,this._center[b.CenterPosition.BOTTOM],H);aa=k.squaredLength(V);aa<
Q&&(Q=aa,N=V,T=b.CenterPosition.BOTTOM);if(this._edgeLen2>Q&&I<W.maxLod)return F.TileUpdate.SPLIT;const Z=null!=S?S-I:Infinity;Q=Math.sqrt(Q);const da=this._edgeLen/(W.fovX*Q*2),fa=()=>{if(I<W.maxLod)return this.elevationLevel=I,F.TileUpdate.NONE;const ba=I+Math.ceil(-Math.log2(W.relativeWidthLimit/da));return ba!==this.elevationLevel?(this.elevationLevel=ba,F.TileUpdate.ELEVATION):F.TileUpdate.NONE};if(.5>=Z)return fa();const ka=k.dot(this.up,U);aa=this._elevationBounds[1]-this._elevationBounds[0];
const ha=aa/this.edgeLen;if(W.aboveGround&&0<ka&&.001>ha&&0<ka/Q-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-ha)return F.TileUpdate.NONE;S=null!=S?3-Math.min(Z,2):1;if(da*S<W.relativeWidthLimit||I>=W.maxLod)return fa();if(7>I)return F.TileUpdate.SPLIT;k.scale(Y,this.up,ka);k.subtract(Y,Y,N);N=k.squaredLength(Y);if(N<=this.radius*this.radius)return F.TileUpdate.SPLIT;k.scale(Y,Y,this.radius/Math.sqrt(N));k.add(Y,Y,this._center[T]);k.subtract(Y,H,Y);return Math.min(1,(Math.abs(k.dot(Y,
this.up))+.5*aa+this._curvatureHeight)/k.length(Y))*(this._edgeLen/(W.fovY*Q*2))*S<.1/W.angledSplitBias*W.relativeHeightLimit?F.TileUpdate.NONE:F.TileUpdate.SPLIT}setChildren(W,H,S,I){C.weakAssert(!!(W&&H&&S&&I),"Null child passed");this._children[0]=W;this._children[1]=H;this._children[2]=S;this._children[3]=I}unsetChildren(){this._children[0]=null;this._children[1]=null;this._children[2]=null;this._children[3]=null}get isLoaded(){return this.renderData?.hasGeometry??!1}load(){this.refMapData();
for(const W of u.LayerClasses)this._createOrUpdateAgents(0,W);this.surface.renderer.loadTile(this)}unload(W){W.unloadTile(this);for(const H of u.LayerClasses){W=this.layerInfo[H];for(const S of W)S.loadingAgent&&S.loadingAgent!==E.tileAgentDone&&(L(S.loadingAgent),S.loadingAgent=null),S.pendingUpdates=0}this.resetPendingUpdate(F.TileUpdate.GEOMETRY);this.resetPendingUpdate(F.TileUpdate.TEXTURE_NOFADING);this.resetPendingUpdate(F.TileUpdate.TEXTURE_FADING);this.unrefMapData()}unloadMapData(){const W=
this.layerInfo[u.LayerClass.MAP];for(const H of W)H.loadingAgent&&H.loadingAgent!==E.tileAgentDone&&(L(H.loadingAgent),H.loadingAgent=null),H.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture();this.setMemoryDirty()}updateClippingStatus(W){if(m.equals(W,this._clippingArea))return!1;var H=this._intersectsClippingArea;const S=this._isWithinClippingArea;null!=W?(this._intersectsClippingArea=this.intersectsExtent(W),this._isWithinClippingArea=this._isWithinExtent(W)):this._isWithinClippingArea=
this._intersectsClippingArea=!0;this._clippingArea=W;this.updateVisibility();W=S&&this._isWithinClippingArea;H=!S&&!H&&!this._isWithinClippingArea&&!this._intersectsClippingArea;!this.renderData||W||H||this.setPendingUpdate(F.TileUpdate.GEOMETRY);return!0}updateVisibility(){this._dirty=!0;this._surface.setTileTreeDirty()}getLayerInfo(W,H){return this.layerInfo[H][W]}hasLayerData(W,H){W=this.layerInfo[H][W];return!(!W?.data||W.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const W of u.LayerClasses){const H=
this.layerInfo[W];for(const S of H)if(S.loadingAgent&&S.loadingAgent!==E.tileAgentDone&&S.loadingAgent.updating)return!0}return!1}_isSuspended(W){return this.hasPendingUpdate(F.TileUpdate.SPLIT)?!0:W===u.LayerClass.ELEVATION?!1:!this.loadable}get hasPendingUpdates(){return 0!==this._pendingUpdates}hasPendingUpdate(W){return(this._pendingUpdates&W)===W}setPendingUpdate(W){this._pendingUpdates|=W;W===F.TileUpdate.SPLIT||W===F.TileUpdate.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate()}resetPendingUpdate(W){return this.hasPendingUpdate(W)?
(this._pendingUpdates&=~W,!0):!1}requestLayerData(W,H,S){const I=this.layerInfo[H][W];if(I.waitingAgents.has(S))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),S.tile.lij.toString(),H,W),!0;I.waitingAgents.push(S);if(I.data&&!I.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),S.tile.lij.toString(),H,W),S.dataArrived(this,I.data&&"type"in I.data&&
"vector-tile"===I.data.type),!0;if(I.requestPromise)return!0;c.abortMaybe(I.requestAbort);I.requestAbort=new AbortController;const Q=this._surface.requestTileData(this,W,H,I.requestAbort);if(!Q)return I.requestAbort=null,!1;W=()=>{I.requestPromise===Q&&(I.requestPromise=null,I.requestAbort=null)};I.requestPromise=Q;Q.then(W,W);return!0}get isLeaf(){return null==this._children[0]}hasLij(W){return this.lij[0]===W[0]&&this.lij[1]===W[1]&&this.lij[2]===W[2]}findByLij(W){if(this.hasLij(W))return this;
const H=this._children;return H[0]?H[0].findByLij(W)||H[1].findByLij(W)||H[2].findByLij(W)||H[3].findByLij(W):null}distanceToSquared(W){return k.squaredLength(k.subtract(Y,this._center[b.CenterPosition.MIDDLE],W))}containsPoint(W){const H=this.extent;return W[0]>=H[0]&&W[1]>=H[1]&&W[0]<=H[2]&&W[1]<=H[3]}containsPointXY(W,H){const S=this.extent;return W>=S[0]&&H>=S[1]&&W<=S[2]&&H<=S[3]}unrequestLayerData(W,H,S){W=this.layerInfo[H][W];H=W.waitingAgents;S=null!=H.removeUnordered(S);C.weakAssert(S,"agent has not requested this piece of map data");
1>H.length&&(W.abortRequest(),this.setMemoryDirty())}dataArrived(W,H,S){const I=null!=S&&"type"in S&&"vector-tile"===S.type;W=this.layerInfo[H][W];W.data=S;W.dataInvalidated=!1;W.waitingAgents.forAll(Q=>Q.dataArrived(this,I));W.waitingAgents.clear();this.setMemoryDirty()}dataMissing(W,H,S){S.notInTilemap||console.error(`Tile ${this.lij.toString()} layer ${H}/${W} error ${S}`);W=this.layerInfo[H][W];W.dataMissing=!0;W.waitingAgents.forAll(I=>I.dataMissing());W.waitingAgents.clear();this.setMemoryDirty()}updateRenderData(W,
H,S){S&&this.forEachLoadedNeighbor(I=>I.updateRenderData(W,H));switch(W){case u.LayerClass.MAP:return this._updateTexture(H);case u.LayerClass.ELEVATION:return this._updateGeometry()}}_updateTexture(W){this.renderData&&(this.resetPendingUpdate(W===t.TextureUpdate.FADING?F.TileUpdate.TEXTURE_NOFADING:F.TileUpdate.TEXTURE_FADING),this.setPendingUpdate(W===t.TextureUpdate.FADING?F.TileUpdate.TEXTURE_FADING:F.TileUpdate.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(F.TileUpdate.GEOMETRY);
for(const W of this.layerInfo[u.LayerClass.ELEVATION])W.pendingUpdates|=F.TileUpdate.GEOMETRY}invalidateLayerData(W,H){this.layerInfo[H][W].invalidateSourceData();this.restartAgents(H)}computeElevationBounds(){const W=this._elevationBounds,H=W[0],S=W[1];f.set(W,Infinity,-Infinity);const I=this.layerInfo[u.LayerClass.ELEVATION];let Q=!0;for(const N of I)null!=N.elevationBounds&&(W[0]=Math.min(W[0],N.elevationBounds.min),W[1]=Math.max(W[1],N.elevationBounds.max),N.elevationBounds.hasNoDataValues||(Q=
!1));Q&&(W[0]=Math.min(W[0],0),W[1]=Math.max(W[1],0));if(H!==W[0]||S!==W[1])this.updateRadiusAndCenter(),this._surface.setTileTreeDirty()}_updateCenter(){const W=this._elevationBounds,H=this._center;k.scale(Y,this.up,.5*(W[0]+W[1]));k.add(H[b.CenterPosition.MIDDLE],this.centerAtSeaLevel,Y);k.scale(Y,this.up,W[0]);k.add(H[b.CenterPosition.TOP],this.centerAtSeaLevel,Y);k.scale(Y,this.up,W[1]);k.add(H[b.CenterPosition.BOTTOM],this.centerAtSeaLevel,Y)}findElevationBoundsForLayer(W,H){const S=this.layerInfo[u.LayerClass.ELEVATION][W],
I=A.getElevationDesiredResolutionLevel(this.level),Q=Math.max(this.elevationLevel-I,0);var N=S.elevationBounds;if(!(null!=N&&N.level>=H&&N.level<=Q)&&(H=this._surface.layerViewByIndex(W,u.LayerClass.ELEVATION),H=C.getLayerWithExtentRange(H),K.fallsWithinLayer(this,H,!1))){H=X;N=!1;var T=S.data;if(T&&T.level<=Q)W=S.data,H.min=W.samplerData.data.minValue,H.max=W.samplerData.data.maxValue,H.hasNoDataValues=W.samplerData.data.hasNoDataValues,H.level=this.level,N=!0;else{T=0;let aa,Z;for(let da=this._parent;da&&
(!Z||T<I)&&!(T=this.elevationLevel-da.level,aa=Z||aa,Z=da.layerInfo[u.LayerClass.ELEVATION][W].data,!Z&&aa&&da.level<=Q);da=da.parent);if(Z=Z||aa)Z.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],H),Infinity!==H.min&&(H.level=Z.level,N=!0)}N&&(null==S.elevationBounds&&(S.elevationBounds=new p.ElevationBounds),S.elevationBounds.copyFrom(H))}}modifyLayers(W,H,S){S=this.layerInfo[S];for(var I of S)I.loadingAgent&&I.loadingAgent!==E.tileAgentDone&&(L(I.loadingAgent),I.loadingAgent=null),I.waitingAgents.clear();
for(I=0;I<S.length;++I)void 0===W[I]&&S[I].release();W=Array(...S);I=H.length;S.length=I;for(let Q=0;Q<I;Q++){const N=H[Q];S[Q]=-1<N?W[N]:B.TilePerLayerInfo.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(W){this.renderData&&(this._createOrUpdateAgents(0,W),this.updateRenderData(W,t.TextureUpdate.FADING))}updateAgents(W){if(this.renderData){const H=this.layerInfo[W];for(const S of H)S.loadingAgent===E.tileAgentDone&&(S.loadingAgent=null);this._createOrUpdateAgents(0,W)}}updateAgentSuspension(){for(const W of u.LayerClasses){const H=
this._isSuspended(W);for(const S of this.layerInfo[W])S.loadingAgent&&S.loadingAgent!==E.tileAgentDone&&(S.loadingAgent.setSuspension(H),S.loadingAgent===E.tileAgentDone&&this.updateRenderData(W,t.TextureUpdate.FADING))}}removeLayerAgent(W,H){W=this.layerInfo[H][W];W.loadingAgent&&W.loadingAgent!==E.tileAgentDone&&W.loadingAgent.dispose();W.loadingAgent=null}agentDone(W,H){const S=this.layerInfo[H][W];S.loadingAgent=E.tileAgentDone;S.data||null!=S.upsampleInfo||this._createOrUpdateAgents(W+1,H)}_hasBlendableAncestor(W){return"normal"!==
W.blendMode||w.isGroupLayer(W.parent)&&this._hasBlendableAncestor(W.parent)}_hasBlendModes(W,H,S){for(;W<H;++W){const I=this._surface.layerViewByIndex(W,S);if(C.isBlendableLayerView(I)&&"normal"!==I?.layer?.blendMode||w.isGroupLayer(I?.layer?.parent)&&this._hasBlendableAncestor(I?.layer?.parent))return!0}return!1}_createOrUpdateAgents(W,H){const S=this.layerInfo[H];if(0!==S.length){var I=this._isSuspended(H);for(let aa=W;aa<S.length;++aa){const Z=S[aa];var Q=!1;const da=this._surface.layerViewByIndex(aa,
H);var N=C.getLayerWithExtentRange(da);if(Z.loadingAgent)K.fallsWithinLayer(this,N,!1)?(Z.loadingAgent!==E.tileAgentDone&&Z.loadingAgent.setSuspension(I),Z.loadingAgent!==E.tileAgentDone&&(Q=Z.loadingAgent.update())):Z.dispose();else if(K.fallsWithinLayer(this,N,!1)){Q=aa;N=H;var T=I;const fa=N===u.LayerClass.ELEVATION?R.acquire():J.acquire();fa.init(this,Q,N,T);Z.loadingAgent=fa;(Q=Z.loadingAgent.startLoading())?Z.loadingAgent===E.tileAgentDone&&this.setPendingUpdate(F.TileUpdate.GEOMETRY):(L(Z.loadingAgent),
Z.loadingAgent=E.tileAgentDone)}Z.loadingAgent===E.tileAgentDone&&this.updateRenderData(H,t.TextureUpdate.FADING);if(!this._hasBlendModes(W,S.length,H)&&Q&&da.isOpaque)break}}}_isWithinExtent(W){const H=this.extent;return H[0]>=W[0]&&W[2]>=H[2]&&H[1]>=W[1]&&W[3]>=H[3]}intersectsExtent(W){const H=this.extent;return H[2]>=W[0]&&W[2]>=H[0]&&H[3]>=W[1]&&W[3]>=H[1]}getElevationVerticesPerSide(W){var H=this.elevationLevel-this.level;W=Math.max(this.level-W,A.getElevationDesiredResolutionLevel(this.level)-
H);W=a.clamp((this.maxTesselation>>W)+1,2,this.maxTesselation+1);H=this.getDefaultVerticesPerSide();return Math.max(W,H)}get test(){return{cachedMemory:this._cachedMemory}}_findLIJ(W,H){if(!W)return null;var S=this.surface.rootTiles;if(null!=S)for(var I of S){S=I.level;var Q=W[0];S>Q?S=!1:(S=Q-S,Q=Math.floor(W[2]/2**S),S=Math.floor(W[1]/2**S)===I.lij[1]&&Q===I.lij[2]);if(S){for(S=W[0]-I.level-1;0<=S&&!I.isLeaf&&!H(I);)I=I.children[2*(W[1]>>S&1)+(W[2]>>S&1)],S--;return H(I)?I:null}}return null}findNeighborTile(W,
H){const S=this.lij;return(W=this.getNeighborLIJ(S,W))?S[0]===W[0]&&S[1]===W[1]&&S[2]===W[2]?H(this)?this:null:this._findLIJ(W,H):null}findCorner(W,H){W=W===r.NeighborIndex.NORTH_EAST?1:W===r.NeighborIndex.NORTH_WEST?0:W===r.NeighborIndex.SOUTH_WEST?2:3;let S=this;for(;S.children[0]&&(!H||!H(S));)S=S.children[W];return S}findNeighborCornerTileExact(W,H){return this.findNeighborTile(W,S=>H(S)||S.level===this.level)?.findCorner(C.oppositeCorner(W),H)||null}forAllSubtreeOnSide(W,H){const S=W===r.NeighborIndex.NORTH?
[0,1]:W===r.NeighborIndex.NORTH_EAST?[1]:W===r.NeighborIndex.EAST?[1,3]:W===r.NeighborIndex.SOUTH_EAST?[3]:W===r.NeighborIndex.SOUTH?[2,3]:W===r.NeighborIndex.SOUTH_WEST?[2]:W===r.NeighborIndex.WEST?[0,2]:[0],I=Q=>{const N=Q.children;!H(Q)&&N[0]&&S.forEach(T=>I(N[T]))};I(this)}getNeighborEdgeStartVertexIndex(W,H){if(!H)return 0;var S=this.level-H.level;C.internalAssert(!C.enableTerrainInternalChecks||0<=S);if(0===S)return 0;S=2**S;var I=(W=1===(W&1))?0:1;H=H.lij[I+1]*S;I=this.lij[I+1];const Q=I-H;
W=W?S-1-Q:Q;C.enableTerrainInternalChecks&&(C.internalAssert(H<=I&&I<H+S),C.internalAssert(0<=W&&W<S));return W}forEachLoadedNeighbor(W){const H=this.level,S=I=>I.level===H||I.isLoaded;C.neighborEdgeIndices.forEach(I=>{const Q=this.findNeighborTile(I,S);null!=Q&&Q!==this&&Q.forAllSubtreeOnSide(C.oppositeEdge(I),N=>N.isLoaded?(W(N,I),!0):!1)});C.neighborCornerIndices.forEach(I=>{const Q=this.findNeighborTile(I,S)?.findCorner(C.oppositeCorner(I),N=>N.isLoaded);C.internalAssert(!Q||G(this,Q,I));Q?.isLoaded&&
W(Q,I)})}getNeighborLIJ(W,H){const S=C.isNorth(H)?-1:C.isSouth(H)?1:0;H=C.isWest(H)?-1:C.isEast(H)?1:0;W=[W[0],W[1]+S,W[2]+H];return 0>W[1]?null:this.surface.isGlobal?this.wrapLIJ(W):0>W[2]?null:W}wrapLIJ(W){return!W||0>W[1]||W[1]>=2**W[0]?null:this.surface.wrapEastWest(W)}get westNeighborWestExtent(){return this.extent[0]*(this.isWestEnd?-1:1)}get eastNeighborEastExtent(){return this.extent[2]*(this.isEastEnd?-1:1)}get isEastEnd(){return this.lij[2]===this.surface.lijEastEnd(this.level)-1}get isWestEnd(){return 0===
this.lij[2]}get isNorthEnd(){return 0===this.lij[1]}get isSouthEnd(){const W=this.surface.extent?.[1]??null;return null!=W&&this.extent[1]+q.getEpsilon()>=W}checkGeometryWaterproofness(){C.enableWaterproofnessTests&&(C.internalAssert(this.isLoaded),this.renderData?.checkGeometryWaterproofness())}shouldHaveNeighbor(W){const H=this.extent,S=this.surface.rootTilesExtent,I=.25*(H[2]-H[0]);if(C.isNorth(W)&&H[3]+I>=S[3]||C.isSouth(W)&&H[1]-I<=S[1])return!1;const Q=this.surface.isGlobal;return!Q&&C.isWest(W)&&
H[0]-I<=S[0]||!Q&&C.isEast(W)&&H[2]+I>=S[2]?!1:!0}updateDistanceToPOI(W){var H=this._lastPOI;if(!(0<=this.distanceToPOI&&H[0]===W[0]&&H[1]===W[1]&&H[2]===W[2])){k.copy(this._lastPOI,W);var S=this._center[b.CenterPosition.MIDDLE];H=W[0]-S[0];var I=W[1]-S[1];W=W[2]-S[2];this.distanceToPOI=H*H+I*I+W*W}}}const J=new d(y.MapTileAgent),R=new d(h.ElevationTileAgent),X=new p.ElevationBounds;b.CenterPosition=void 0;(function(W){W[W.TOP=0]="TOP";W[W.MIDDLE=1]="MIDDLE";W[W.BOTTOM=2]="BOTTOM"})(b.CenterPosition||
(b.CenterPosition={}));const U=g.create(),M=g.create(),V=g.create(),Y=g.create();b.Tile=P;b.isCornerNeighbor=G;b.isEdgeNeighbor=function(W,H,S){if(null==W||null==H)return!1;if(0===W.level&&0===H.level&&(W.isEastEnd&&H.isWestEnd&&S===r.NeighborIndex.EAST||W.isWestEnd&&H.isEastEnd&&S===r.NeighborIndex.WEST))return!0;const I=Math.max(1E-6*(W.extent[2]-W.extent[0]),1);switch(S){case r.NeighborIndex.NORTH:return C.almostEquals(W.extent[3],H.extent[1],I);case r.NeighborIndex.SOUTH:return C.almostEquals(W.extent[1],
H.extent[3],I);case r.NeighborIndex.EAST:return C.almostEquals(W.extent[2],H.extent[0],I)||C.almostEquals(W.extent[2],-H.extent[0],I);case r.NeighborIndex.WEST:return C.almostEquals(W.extent[0],H.extent[2],I)||C.almostEquals(W.extent[0],-H.extent[2],I)}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/ElevationTileAgent":function(){define(["exports","./TerrainConst","./TileAgent"],function(b,a,c){class d extends c.TileAgent{constructor(){super(...arguments);
this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return a.getElevationDesiredResolutionLevel(this.tile.level)-(this.tile.elevationLevel-this.tile.level)}get _progressiveLevelModulo(){return 0}}b.ElevationTileAgent=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TileAgent":function(){define(["exports","./interfaces","./TerrainConst","./terrainUtils","./tileUtils"],function(b,a,c,d,f){class n{get updating(){return!!this._tileRequested}init(e,m,l,w){this.tile=
e;this._layerIdx=m;this._layerClass=l;this._suspended=w;this._tileLayerInfo=e.getLayerInfo(m,l);this._tileRequested=null;e=this._findAncestorWithData();this._setUpsampleTile(e)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null);this._tileLayerInfo=this.tile=null}setSuspension(e){e!==this._suspended&&((this._suspended=e)?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,
this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const e=this._findAncestorWithData();this._setUpsampleTile(e);return this._requestNext()}dataArrived(e,m){this._setUpsampleTile(e,m);this._tileRequested=null;e===this.tile?this.tile.updateRenderData(this._layerClass,a.TextureUpdate.FADING,m):this._requestNext()}dataMissing(){this._tileRequested=null;this._tileLayerInfo.data=null;this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass);
this.dispose()}_requestNext(){if(this._suspended)return!0;const e=this._findNextDownload();if(this._tileRequested){if(e===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this);this._tileRequested=null}null!=e?e.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=e):this._agentDone();return!!this._tileRequested}_findNextDownload(){const e=this._layerIdx,m=this._layerClass;var l=this.tile.surface.layerViewByIndex(e,m),w=d.getLayerWithExtentRange(l);
const {minLevel:v,maxLevel:x}=l.dataLevelRange,p=this._desiredMinLevelDelta,h=this._progressiveLevelModulo+p,t=this._scaleRangeEnabled?f.fallsWithinLayer:()=>!0;let r=this.tile;const u=r.level;let y;const z=this._tileLayerInfo.upsampleInfo,A=null!=z?z.tile.level:-1,C=null!=z?A-u>=p:!1,E=w?.tilemapCache;for(l="vector-tile-3d"===l.type?l.schemaHelper:null;r&&t(r,w,!1)&&r.level>=v;){const B=r.level,D=u-B,F=r.layerInfo[m][e];if(F.data&&D>=p){(!C||B>A)&&this._setUpsampleTile(r);F.dataInvalidated&&(y=r);
break}const K=l?.getLevelRowColumn(r.lij)??r.lij;if("unavailable"!==E?.getAvailability(K[0],K[1],r.lij[2])&&B<=x&&!F.data&&!F.dataMissing){if(!y||r.level===v||0===B%c.progressiveLoadingModulo||u-y.level<p)y=r;if(D>=h)break}r=r.parent}null!=y&&u-y.level<p&&(z?y=null:(w=this._findAncestorWithData(),null!=w&&(this._setUpsampleTile(w),y=w.layerInfo[m][e].dataInvalidated?w:null)));return y}_findAncestorWithData(){const e=this.tile.elevationLevel,m=this._desiredMinLevelDelta;let l;for(let w=this.tile;w;w=
w.parent)if(w.hasLayerData(this._layerIdx,this._layerClass)){if(e-w.level>=m)return w;l=w}return l}_setUpsampleTile(e,m){this._tileLayerInfo.setUpsampleInfo(this.tile,e);this.tile.updateRenderData(this._layerClass,a.TextureUpdate.FADING,m)}get test(){return{findNextDownload:()=>this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}}class k extends n{get _desiredMinLevelDelta(){throw g;}get _progressiveLevelModulo(){throw g;}dispose(){}}const g=Error("Abstract method called on TileAgent"),q=
new k;b.TileAgent=n;b.tileAgentDone=q;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/tileUtils":function(){define(["exports","../../../core/PooledArray","./RenderOrder"],function(b,a,c){function d(v,x){x(v);if(!v.isLeaf)for(const p of v.children)d(p,x)}function f(v,x){v=v.lij;x=x.lij;return v[0]-x[0]||v[1]-x[1]||v[2]-x[2]}function n(v,x){const p=x.screenDepth-v.screenDepth;if(0!==p)return p;v=v.lij;x=x.lij;return v[0]-x[0]||v[1]-x[1]||v[2]-x[2]}function k(v,
x){const p=v.screenDepth-x.screenDepth;if(0!==p)return p;v=v.lij;x=x.lij;return v[0]-x[0]||v[1]-x[1]||v[2]-x[2]}function g(v,x,p){const h=v.screenDepth,t=x.screenDepth;return h<t?-p:h>t?p:f(v,x)}function q(v,x,p,h){const t=e(v,h);h=e(x,h);return t===h?g(v,x,p):v?p:-p}function e(v,x){for(const p of x)if(v.intersectsExtent(p))return!0;return!1}function m(v,x){const p=v.distanceToPOI-x.distanceToPOI;if(0!==p)return p;v=v.lij;x=x.lij;return v[0]-x[0]||v[1]-x[1]||v[2]-x[2]}class l{constructor(){this._queue=
new a;this.remove=()=>{}}get done(){return 0===this._queue.length&&(!this._last||this._last.isLeaf)}resetOne(v){this._queue.clear();this._queue.push(v);this._last=void 0}reset(v=null){this._queue.clear();null!=v&&this._queue.pushArray(v);this._last=void 0}skipSubtree(){this._last=void 0}next(){const v=this._last?.children;v?.[0]&&this._queue.pushArray(v);return this._last=this._queue.pop()}}class w{constructor(){this._q=new a}get done(){return 0===this._q.length}reset(v){this._q.clear();if(null!=
v)for(this._q.pushArray(v),v=0;v<this._q.length;++v){const x=this._q.data[v];x.isLeaf||this._q.pushArray(x.children)}}next(){return this._q.pop()}}b.IteratorPostorder=w;b.IteratorPreorder=l;b.compareTiles=g;b.compareTilesByLij=f;b.compareTilesWithStencil=q;b.computeUpsampleInfo=function(v,x,p){let h=1,t=0,r=0;for(;v!==x;)if(h*=.5,t*=.5,r*=.5,v.lij[2]&1&&(t+=.5),0===(v.lij[1]&1)&&(r+=.5),v=v.parent,null==v)throw Error("tile was not a descendant of upsampleTile");p.init(x,t,r,h)};b.fallsWithinLayer=
function(v,x,p){if(null==x?.fullExtent)return!1;const h=x.fullExtent,t=v.extent;if(p){if(t[0]<h.xmin||t[1]<h.ymin||t[2]>h.xmax||t[3]>h.ymax)return!1}else if(h.xmin>t[2]||h.ymin>t[3]||h.xmax<t[0]||h.ymax<t[1])return!1;v=v.surface.tilingScheme.levels[v.level].scale;p=x.minScale;if(0<p&&v>1.00000001*p)return!1;x=x.maxScale;return 0<x&&v<.99999999*x?!1:!0};b.hasLoadableSiblings=function(v){for(let x=0;x<v.length;x++){const p=v[x],h=p.parent;if(h)for(let t=0;4>t;t++){const r=h.children[t];if(r&&r!==p)return!0}}return!1};
b.sortTiles=function(v,x,p=null){null==p||0===p.length?v===c.RenderOrder.BACK_TO_FRONT?x.sort(n):x.sort(k):x.sort((h,t)=>q(h,t,v,p))};b.sortTilesByPOI=function(v,x){const p=v.length;for(let h=0;h<p;++h)v.at(h).updateDistanceToPOI(x);v.sort(m)};b.tilesAreRelated=function(v,x){if(!v||!x||v[0]===x[0])return!1;const p=v[0]<x[0],h=p?v:x;v=p?x:v;x=1<<v[0]-h[0];return Math.floor(v[1]/x)===h[1]&&Math.floor(v[2]/x)===h[2]};b.traverseTilesPreorder=function(v,x){if(Array.isArray(v))for(let p=0;p<v.length;p++)d(v[p],
x);else d(v,x)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/RenderOrder":function(){define(["exports"],function(b){b.RenderOrder=void 0;var a=b.RenderOrder||(b.RenderOrder={});a[a.BACK_TO_FRONT=-1]="BACK_TO_FRONT";a[a.NONE=0]="NONE";a[a.FRONT_TO_BACK=1]="FRONT_TO_BACK";Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/MapTileAgent":function(){define(["exports","./TerrainConst","./TileAgent"],function(b,a,c){class d extends c.TileAgent{constructor(){super();
this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return a.progressiveLoadingModulo}}b.MapTileAgent=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/RasterTile":function(){define(["exports","../../../core/maybe","../../../chunks/RasterColorizer.glsl","../../webgl/enums","../../webgl/rasterUtils"],function(b,a,c,d,f){const n={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,
1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};class k{constructor(g,q,e=null,m=null){this.type="raster-tile";this._interpolation=this._bandIds=this._symbolizerParameters=this._source=this._memoryUsed=null;this._dirty=!1;this._transformGrid=null;this.isRendereredSource=!1;this.lij=this.rawPixelData=this.symbolizerRenderer=null;this.opacity=1;this.lij=g;this.source=q;this.width=e||q.width;this.height=m||q.height}get source(){return this._source}set source(g){this._source=
g;this._rasterTexture=a.disposeMaybe(this._rasterTexture);this._memoryUsed=null}get symbolizerParameters(){return this.isRendereredSource?{...n,maxCutOff:[1,1,1],factor:[1,1,1]}:this._symbolizerParameters||n}set symbolizerParameters(g){this._symbolizerParameters=g}get bandIds(){return this._bandIds}set bandIds(g){null!=g&&0<g.length?this._bandIds&&g.every((q,e)=>this._bandIds?.[e]?q===this._bandIds[e]:!1)||(this._bandIds=g,this._dirty=!0):this._bandIds=null}get interpolation(){return this._interpolation||
"nearest"}set interpolation(g){this._interpolation=g;null!=this._rasterTexture&&(g=this._getRasterTextureInterpolation(g),this._rasterTexture.setSamplingMode("bilinear"===g?d.TextureSamplingMode.LINEAR:d.TextureSamplingMode.NEAREST))}get transformGrid(){return this._transformGrid}set transformGrid(g){this._transformGrid=g;this._transformGridTexture=a.disposeMaybe(this._transformGridTexture);this._memoryUsed=null}bind(g){if(!(this.source&&this.source.pixels&&0<this.source.pixels.length))return!1;(null==
this._rasterTexture||this._dirty)&&this._updateRasterTexture(g,this.bandIds);null!=this._rasterTexture&&(this._updateColormapTexture(g),this.transformGrid&&null==this._transformGridTexture&&(this._transformGridTexture=f.createTransformTexture(g,this.transformGrid)));return!0}getUniforms(){const {symbolizerParameters:g,transformGrid:q,width:e,height:m,opacity:l}=this,w=f.getCommonUniforms(q,[e,m],[this.source.width,this.source.height],l),v=f.getColormapUniforms(g.colormap,g.colormapOffset),x="stretch"===
this.symbolizerParameters.type?f.getStretchUniforms(this.symbolizerParameters):null,p="hillshade"===this.symbolizerParameters.type?f.getShadedReliefUniforms(this.symbolizerParameters):null;return new c.ColorizerUniforms(w,v,x||p,this._rasterTexture,this._transformGridTexture,this._colormapTexture)}get isBilinearWithStretchColorRamp(){const {symbolizerParameters:g}=this;return"bilinear"===this.interpolation&&null!=g.colormap&&"stretch"===g.type}get memoryUsage(){null==this._memoryUsed&&(this._memoryUsed=
[this._rasterTexture,this._transformGridTexture,this._colormapTexture].map(g=>null!=g?g.descriptor.width*g.descriptor.height*4:0).reduce((g,q)=>g+q,0));return this._memoryUsed}release(){this._rasterTexture=a.disposeMaybe(this._rasterTexture);this._transformGridTexture=a.disposeMaybe(this._transformGridTexture);this._colormapTexture=a.disposeMaybe(this._colormapTexture);this.rawPixelData=this.transformGrid=this.source=null;return!0}_updateRasterTexture(g,q){const e=this.source?this.source.extractBands(q):
null;e&&e.pixels&&0<e.pixels.length?(q=null==q&&null==this.bandIds||null!=q&&null!=this.bandIds&&q.join("")===this.bandIds.join(""),null!=this._rasterTexture&&q||(this._rasterTexture=a.disposeMaybe(this._rasterTexture),q=this._getRasterTextureInterpolation(this.interpolation),this._rasterTexture=f.createRasterTexture(g,e,q,this.isRendereredSource||this.hasStretchTypeNone()))):this._rasterTexture=a.disposeMaybe(this._rasterTexture)}hasStretchTypeNone(){return"stretchType"in this.symbolizerParameters&&
"none"===this.symbolizerParameters.stretchType&&!this.symbolizerParameters.useGamma&&"u8"===this.source.pixelType}_getRasterTextureInterpolation(g){return"lut"===this.symbolizerParameters.type||"nearest"===g||"majority"===g||this.isBilinearWithStretchColorRamp?"nearest":"bilinear"}_updateColormapTexture(g){const q=this._colormap,e=this.symbolizerParameters.colormap;if(!e)this._colormapTexture=a.disposeMaybe(this._colormapTexture),this._colormap=null;else if(!q)this._colormapTexture=f.createColormapTexture(g,
e),this._colormap=e;else if(e.length!==q.length||e.some((m,l)=>m!==q[l]))this._colormapTexture=a.disposeMaybe(this._colormapTexture),this._colormapTexture=f.createColormapTexture(g,e),this._colormap=e}}b.RasterTile=k;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/RasterColorizer.glsl":function(){define("exports ./vec3f64 ../views/2d/engine/imagery/enums ../views/3d/webgl-engine/core/shaderLibrary/raster/Colormap.glsl ../views/3d/webgl-engine/core/shaderLibrary/raster/Common.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/TileBackground.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/TileComposite.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderModules/BooleanPassUniform ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/FloatsPassUniform ../views/3d/webgl-engine/core/shaderModules/IntegerPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p){function h(C){const E=new x.ShaderBuilder;E.include(k.TileComposite);E.include(f.Common,C);E.include(d.Colormap,C);E.include(n.TileBackground,C);E.fragment.code.add(v.glsl`vec4 applyBackgroundBlend(vec4 layerColor) {
vec4 bgColor = getBackground(vuv);
return blendLayers(bgColor, layerColor, u_opacity);
}`);C.colorizerType===c.RasterColorizerType.Stretch?t(E,C):C.colorizerType===c.RasterColorizerType.Lut?E.fragment.code.add(v.glsl`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
fragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`):C.colorizerType===c.RasterColorizerType.Hillshade&&r(E,C);return E}function t(C,E){C.fragment.uniforms.add(new w.IntegerPassUniform("u_bandCount",D=>D.symbolizer.u_bandCount),new l.FloatsPassUniform("u_minCutOff",D=>D.symbolizer.u_minCutOff,3),new l.FloatsPassUniform("u_maxCutOff",D=>D.symbolizer.u_maxCutOff,3),new l.FloatsPassUniform("u_factor",D=>D.symbolizer.u_factor,3),new m.FloatPassUniform("u_minOutput",D=>D.symbolizer.u_minOutput),new m.FloatPassUniform("u_maxOutput",D=>D.symbolizer.u_maxOutput),
new q.BooleanPassUniform("u_useGamma",D=>D.symbolizer.u_useGamma),new l.FloatsPassUniform("u_gamma",D=>D.symbolizer.u_gamma,3),new l.FloatsPassUniform("u_gammaCorrection",D=>D.symbolizer.u_gammaCorrection,3),new m.FloatPassUniform("u_opacity",D=>D.common.u_opacity));C.fragment.code.add(v.glsl`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const B=E.applyColormap?v.glsl`fragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:v.glsl`fragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;C.fragment.code.add(v.glsl`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${E.stretchType===c.RasterColorizerStretchType.Noop?v.glsl`
        fragColor = applyBackgroundBlend(currentPixel);`:v.glsl`
        if (currentPixel.a == 0.0) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${B}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          fragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`)}function r(C,E){C=C.fragment;C.uniforms.add(new p.Texture2DPassUniform("u_image",B=>B.u_image),new w.IntegerPassUniform("u_hillshadeType",B=>B.symbolizer.u_hillshadeType),new l.FloatsPassUniform("u_sinZcosAs",B=>B.symbolizer.u_sinZcosAs,6),new l.FloatsPassUniform("u_sinZsinAs",B=>B.symbolizer.u_sinZsinAs,6),new l.FloatsPassUniform("u_cosZs",B=>B.symbolizer.u_cosZs,6),new l.FloatsPassUniform("u_weights",B=>B.symbolizer.u_weights,6),new e.Float2PassUniform("u_factor",B=>B.symbolizer.u_factor),
new m.FloatPassUniform("u_minValue",B=>B.symbolizer.u_minValue),new m.FloatPassUniform("u_maxValue",B=>B.symbolizer.u_maxValue),new e.Float2PassUniform("u_srcImageSize",B=>B.common.u_srcImageSize));C.include(g.ColorConversion);C.code.add(v.glsl`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec4 color = colormap(vec4(val, val, val, 1.0), false);
vec3 hsv = rgb2hsv(color.rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv), 1.0) * alpha * color.a;
}`);C.code.add(v.glsl`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);E=E.applyColormap?v.glsl`fragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:v.glsl`hillshade *= alpha;
fragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;C.code.add(v.glsl`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture(u_image, pixelLocation);
      vec4 vf = texture(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${E}
    }
  `)}class u extends f.CommonPassParameters{constructor(C,E,B,D,F,K){super(C,D,F);this.colormap=E;this.symbolizer=B;this.u_colormap=K;this.backgroundColor=a.ZEROS;this.fboTexture=null;this.baseOpacity=1}}class y extends u{}class z extends u{}const A=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:z,ColorizerStretchUniforms:y,ColorizerUniforms:u,build:h},Symbol.toStringTag,{value:"Module"}));b.ColorizerHillshadeUniforms=z;b.ColorizerStretchUniforms=y;b.ColorizerUniforms=
u;b.RasterColorizer=A;b.build=h})},"esri/views/2d/engine/imagery/enums":function(){define(["exports"],function(b){b.RasterColorizerType=void 0;(function(a){a[a.Stretch=0]="Stretch";a[a.Lut=1]="Lut";a[a.Hillshade=2]="Hillshade";a[a.COUNT=3]="COUNT"})(b.RasterColorizerType||(b.RasterColorizerType={}));b.RasterColorizerStretchType=void 0;(function(a){a[a.Noop=0]="Noop";a[a.PerBand=1]="PerBand";a[a.COUNT=2]="COUNT"})(b.RasterColorizerStretchType||(b.RasterColorizerStretchType={}));Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Colormap.glsl":function(){define(["exports","../../shaderModules/FloatPassUniform","../../shaderModules/interfaces","../../shaderModules/Texture2DPassUniform"],function(b,a,c,d){b.Colormap=function(f){f.fragment.uniforms.add(new d.Texture2DPassUniform("u_colormap",n=>n.u_colormap),new a.FloatPassUniform("u_colormapOffset",n=>n.colormap.u_colormapOffset),new a.FloatPassUniform("u_colormapMaxIndex",n=>n.colormap.u_colormapMaxIndex),
new a.FloatPassUniform("u_opacity",n=>n.common.u_opacity));f.fragment.code.add(c.glsl`vec4 colormap(vec4 currentPixel, bool isFloat) {
float colorIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || colorIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 texelCoordinates = vec2((colorIndex + 0.5), 0.5);
result = texelFetch(u_colormap, ivec2(texelCoordinates), 0);
}
return result;
}`)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Common.glsl":function(){define("exports ./Projection.glsl ../terrain/TileComposite.glsl ../../shaderModules/BooleanPassUniform ../../shaderModules/Float2PassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform".split(" "),function(b,a,c,d,f,n,k){class g extends c.TileCompositePassParameters{constructor(q,e,m){super();this.common=q;this.u_image=e;this.u_transformGrid=
m}}b.Common=function(q,e){q.include(a.Projection);q.fragment.uniforms.add(new k.Texture2DPassUniform("u_image",m=>m.u_image),new d.BooleanPassUniform("u_flipY",m=>m.common.u_flipY),new d.BooleanPassUniform("u_applyTransform",m=>m.common.u_applyTransform));({requireBilinearWithNN:e}=e);e&&q.fragment.uniforms.add(new f.Float2PassUniform("u_srcImageSize",m=>m.common.u_srcImageSize));q.fragment.code.add(n.glsl`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}`);e?q.fragment.code.add(n.glsl`vec4 sampleBilinear(sampler2D sampler, vec2 coords, vec2 texSize) {
vec2 texelStart = floor(coords * texSize);
vec2 coord0 = texelStart / texSize;
vec2 coord1 = (texelStart +  vec2(1.0, 0.0)) / texSize;
vec2 coord2 = (texelStart +  vec2(0.0, 1.0)) / texSize;
vec2 coord3 = (texelStart +  vec2(1.0, 1.0)) / texSize;
vec4 color0 = texture(sampler, coord0);
vec4 color1 = texture(sampler, coord1);
vec4 color2 = texture(sampler, coord2);
vec4 color3 = texture(sampler, coord3);
vec2 blend = fract(coords * texSize);
vec4 color01 = mix(color0, color1, blend.x);
vec4 color23 = mix(color2, color3, blend.x);
vec4 color = mix(color01, color23, blend.y);
float alpha = floor(color0.a * color1.a * color2.a * color3.a + 0.5);
color = color * alpha + (1.0 - alpha) * texture(sampler, coords);
return color;
}
vec4 getPixel(vec2 pixelLocation) {
return sampleBilinear(u_image, pixelLocation, u_srcImageSize);
}`):q.fragment.code.add(n.glsl`vec4 getPixel(vec2 pixelLocation) {
return texture(u_image, pixelLocation);
}`)};b.CommonPassParameters=g;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Projection.glsl":function(){define(["exports","../../shaderModules/Float2PassUniform","../../shaderModules/interfaces","../../shaderModules/Texture2DPassUniform"],function(b,a,c,d){b.Projection=function(f){f.fragment.uniforms.add(new d.Texture2DPassUniform("u_transformGrid",n=>n.u_transformGrid),new a.Float2PassUniform("u_transformSpacing",n=>n.common.u_transformSpacing),
new a.Float2PassUniform("u_targetImageSize",n=>n.common.u_targetImageSize));f.fragment.code.add(c.glsl`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(4.0, 1.0);
vec2 index_transform = floor(index_image / u_transformSpacing) * oneTransformPixel;
vec2 pos = fract((index_image + 0.5) / u_transformSpacing);
vec2 transform_location = index_transform + 0.5;
vec2 srcLocation;
if (pos.s <= pos.t) {
vec3 ll_abc = texelFetch(u_transformGrid, ivec2(transform_location), 0).rgb;
vec3 ll_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 1.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ll_abc, vec3(pos, 1.0));
srcLocation.t = dot(ll_def, vec3(pos, 1.0));
} else {
vec3 ur_abc = texelFetch(u_transformGrid, ivec2(transform_location.s + 2.0, transform_location.t), 0).rgb;
vec3 ur_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 3.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ur_abc, vec3(pos, 1.0));
srcLocation.t = dot(ur_def, vec3(pos, 1.0));
}
return srcLocation;
}`)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/TileComposite.glsl":function(){define("exports ../../../../../../chunks/vec2f64 ../../shaderModules/Float2PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../../lib/VertexAttribute".split(" "),function(b,a,c,d,f,n){class k extends f.NoParameters{constructor(){super(...arguments);this.scale=1;this.offset=a.ZEROS}}b.TileComposite=function(g){g.attributes.add(n.VertexAttribute.POSITION,
"vec2");g.attributes.add(n.VertexAttribute.UV0,"vec2");g.vertex.uniforms.add(new d.FloatPassUniform("scale",q=>q.scale));g.vertex.uniforms.add(new c.Float2PassUniform("offset",q=>q.offset));g.varyings.add("uv","vec2");g.varyings.add("vuv","vec2");g.vertex.code.add(f.glsl`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`)};b.TileCompositePassParameters=k;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/TileBackground.glsl":function(){define("exports ../../../../../../chunks/vec3f64 ../output/BlendOptions ./BackgroundGrid.glsl ../util/BlendModes.glsl ../../shaderModules/Float3PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform".split(" "),function(b,a,c,d,f,n,k,g,q){b.BlendLayersOutput=
void 0;(function(m){m[m.Composite=0]="Composite";m[m.ColorComposite=1]="ColorComposite";m[m.GridComposite=2]="GridComposite";m[m.GroupBackgroundComposite=3]="GroupBackgroundComposite";m[m.COUNT=4]="COUNT"})(b.BlendLayersOutput||(b.BlendLayersOutput={}));b.BaseOpacityMode=void 0;(function(m){m[m.NotRequired=0]="NotRequired";m[m.Required=1]="Required";m[m.COUNT=2]="COUNT"})(b.BaseOpacityMode||(b.BaseOpacityMode={}));b.PremultipliedAlphaSource=void 0;(function(m){m[m.Off=0]="Off";m[m.On=1]="On";m[m.COUNT=
2]="COUNT"})(b.PremultipliedAlphaSource||(b.PremultipliedAlphaSource={}));class e extends g.NoParameters{constructor(){super(...arguments);this.baseOpacity=1;this.backgroundColor=a.ZEROS;this.fboTexture=null}}b.TileBackground=function(m,l){const w=l.output===b.BlendLayersOutput.GridComposite,v=l.output===b.BlendLayersOutput.ColorComposite,x=l.output===b.BlendLayersOutput.GroupBackgroundComposite,p=l.output===b.BlendLayersOutput.Composite;w&&m.fragment.include(d.BackgroundGrid);v&&m.fragment.uniforms.add(new n.Float3PassUniform("backgroundColor",
u=>u.backgroundColor));const h=l.baseOpacityMode===b.BaseOpacityMode.Required;h&&m.fragment.uniforms.add(new k.FloatPassUniform("baseOpacity",u=>u.baseOpacity));p&&m.fragment.uniforms.add(new q.Texture2DPassUniform("fboColor",u=>u.fboTexture));const t=l.blendMode!==c.LayerBlendMode.Normal,r=l.premultipliedSource===b.PremultipliedAlphaSource.On;m.fragment.include(f.BlendModes,l);m.fragment.code.add(g.glsl`
    vec4 getBackground(vec2 uv) {
      return ${h?g.glsl`baseOpacity *`:""} ${x?g.glsl`vec4(0.0, 0.0, 0.0, 0.0)`:v?g.glsl`vec4(backgroundColor, 1.0)`:w?g.glsl`vec4(gridColor(uv), 1.0)`:g.glsl`texelFetch(fboColor, ivec2(gl_FragCoord.xy), 0)`};
    }

    vec4 blendLayers(vec4 bgColor, vec4 colorLayer, float opacity) {
      ${t?g.glsl`
          vec3 cl = colorLayer.a == 0.0 ? colorLayer.rgb : colorLayer.rgb / colorLayer.a;
          vec3 cb = bgColor.a == 0.0 ? bgColor.rgb : bgColor.rgb / bgColor.a;
          return applyBlendMode(clamp(cl, vec3(0.0), vec3(1.0)), colorLayer.a * opacity, cb, bgColor.a);`:g.glsl`
          float composeAlpha = colorLayer.a * opacity;
          return ${!r&&(p&&!h||x)?g.glsl`colorLayer * opacity;`:g.glsl`bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`}`}
    }`)};b.TileBackgroundPassParameters=e;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/BlendOptions":function(){define(["exports"],function(b){b.LayerBlendMode=void 0;(function(a){a[a.Normal=0]="Normal";a[a.Average=1]="Average";a[a.Lighten=2]="Lighten";a[a.Lighter=3]="Lighter";a[a.Plus=4]="Plus";a[a.Screen=5]="Screen";a[a.ColorDodge=6]="ColorDodge";a[a.Darken=7]="Darken";a[a.Multiply=8]="Multiply";a[a.ColorBurn=9]="ColorBurn";
a[a.Overlay=10]="Overlay";a[a.SoftLight=11]="SoftLight";a[a.HardLight=12]="HardLight";a[a.VividLight=13]="VividLight";a[a.Hue=14]="Hue";a[a.Saturation=15]="Saturation";a[a.Luminosity=16]="Luminosity";a[a.Color=17]="Color";a[a.DestinationOver=18]="DestinationOver";a[a.DestinationAtop=19]="DestinationAtop";a[a.DestinationIn=20]="DestinationIn";a[a.DestinationOut=21]="DestinationOut";a[a.SourceAtop=22]="SourceAtop";a[a.SourceIn=23]="SourceIn";a[a.SourceOut=24]="SourceOut";a[a.Xor=25]="Xor";a[a.Difference=
26]="Difference";a[a.Exclusion=27]="Exclusion";a[a.Minus=28]="Minus";a[a.Invert=29]="Invert";a[a.Reflect=30]="Reflect";a[a.COUNT=31]="COUNT"})(b.LayerBlendMode||(b.LayerBlendMode={}));b.blendModeFromString={normal:b.LayerBlendMode.Normal,average:b.LayerBlendMode.Average,lighten:b.LayerBlendMode.Lighten,lighter:b.LayerBlendMode.Lighter,screen:b.LayerBlendMode.Screen,plus:b.LayerBlendMode.Plus,"color-dodge":b.LayerBlendMode.ColorDodge,darken:b.LayerBlendMode.Darken,multiply:b.LayerBlendMode.Multiply,
"color-burn":b.LayerBlendMode.ColorBurn,overlay:b.LayerBlendMode.Overlay,"soft-light":b.LayerBlendMode.SoftLight,"hard-light":b.LayerBlendMode.HardLight,"vivid-light":b.LayerBlendMode.VividLight,hue:b.LayerBlendMode.Hue,saturation:b.LayerBlendMode.Saturation,luminosity:b.LayerBlendMode.Luminosity,color:b.LayerBlendMode.Color,difference:b.LayerBlendMode.Difference,exclusion:b.LayerBlendMode.Exclusion,minus:b.LayerBlendMode.Minus,invert:b.LayerBlendMode.Invert,reflect:b.LayerBlendMode.Reflect,"destination-over":b.LayerBlendMode.DestinationOver,
"destination-atop":b.LayerBlendMode.DestinationAtop,"destination-in":b.LayerBlendMode.DestinationIn,"destination-out":b.LayerBlendMode.DestinationOut,"source-atop":b.LayerBlendMode.SourceAtop,"source-in":b.LayerBlendMode.SourceIn,"source-out":b.LayerBlendMode.SourceOut,xor:b.LayerBlendMode.Xor};b.isCompositeBlendMode=function(a){return a===b.LayerBlendMode.DestinationOver||a===b.LayerBlendMode.DestinationAtop||a===b.LayerBlendMode.DestinationIn||a===b.LayerBlendMode.DestinationOut||a===b.LayerBlendMode.SourceAtop||
a===b.LayerBlendMode.SourceIn||a===b.LayerBlendMode.SourceOut||a===b.LayerBlendMode.Xor};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/BackgroundGrid.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(b,a){b.BackgroundGrid=function(c){c.code.add(a.glsl`
    float lineFactorAtPosition(float value) {
      float pos = value * ${a.glsl.float(257)};
      if(pos < 0.5 || pos > ${a.glsl.float(256.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec3 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec3(1.0, 0.972, 0.918) * line;
    }`)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/BlendModes.glsl":function(){define(["exports","../output/BlendOptions","../../shaderModules/interfaces"],function(b,a,c){b.BlendModes=function(d,f){f=f.blendMode;if(f!==a.LayerBlendMode.Normal){f===a.LayerBlendMode.Reflect&&d.code.add(c.glsl`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`);f!==a.LayerBlendMode.ColorDodge&&f!==a.LayerBlendMode.VividLight||d.code.add(c.glsl`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`);f!==a.LayerBlendMode.ColorBurn&&f!==a.LayerBlendMode.VividLight||d.code.add(c.glsl`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`);f===a.LayerBlendMode.Overlay&&d.code.add(c.glsl`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`);f===a.LayerBlendMode.HardLight&&d.code.add(c.glsl`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`);f===a.LayerBlendMode.SoftLight&&d.code.add(c.glsl`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`);f===a.LayerBlendMode.VividLight&&d.code.add(c.glsl`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`);if(f===a.LayerBlendMode.Hue||f===a.LayerBlendMode.Saturation||f===a.LayerBlendMode.Color||f===a.LayerBlendMode.Luminosity)d.code.add(c.glsl`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),f!==a.LayerBlendMode.Hue&&f!==a.LayerBlendMode.Saturation||d.code.add(c.glsl`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`);d.code.add(c.glsl`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${f===a.LayerBlendMode.Multiply?c.glsl`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:f===a.LayerBlendMode.Average?c.glsl`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:f===a.LayerBlendMode.Lighten?c.glsl`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:f===a.LayerBlendMode.Darken?c.glsl`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:
f===a.LayerBlendMode.Lighter?c.glsl`return vec4(cl * ol + cb * ob, ol + ob);`:f===a.LayerBlendMode.Plus?c.glsl`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:f===a.LayerBlendMode.Minus?c.glsl`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:f===a.LayerBlendMode.Screen?c.glsl`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:f===a.LayerBlendMode.Difference?c.glsl`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:
f===a.LayerBlendMode.Invert?c.glsl`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:f===a.LayerBlendMode.DestinationOver?c.glsl`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:f===a.LayerBlendMode.DestinationAtop?c.glsl`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:f===a.LayerBlendMode.DestinationOut?c.glsl`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:f===a.LayerBlendMode.SourceAtop?c.glsl`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:f===a.LayerBlendMode.SourceOut?
c.glsl`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:f===a.LayerBlendMode.Xor?c.glsl`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:f===a.LayerBlendMode.DestinationIn?c.glsl`return vec4(cb * ob * ol, ol * ob);`:f===a.LayerBlendMode.SourceIn?c.glsl`return vec4(cl * ol * ob, ol * ob);`:f===a.LayerBlendMode.Hue?c.glsl`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:f===a.LayerBlendMode.Saturation?c.glsl`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:f===a.LayerBlendMode.Color?c.glsl`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:f===a.LayerBlendMode.Luminosity?c.glsl`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:f===a.LayerBlendMode.Exclusion?c.glsl`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:f===a.LayerBlendMode.Reflect?c.glsl`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:f===a.LayerBlendMode.ColorDodge?c.glsl`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:f===a.LayerBlendMode.ColorBurn?c.glsl`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:f===a.LayerBlendMode.Overlay?c.glsl`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:f===a.LayerBlendMode.SoftLight?c.glsl`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:f===a.LayerBlendMode.HardLight?c.glsl`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:f===a.LayerBlendMode.VividLight?c.glsl`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:c.glsl``}
    }
  `)}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/rasterUtils":function(){define("exports ../../chunks/vec2f64 ./contextUtils ./enums ./Texture ./TextureDescriptor".split(" "),function(b,a,c,d,f,n){b.createColormapTexture=function(k,g){const q=new n.TextureDescriptor;q.internalFormat=d.PixelFormat.RGBA;q.width=g.length/4;q.height=1;q.samplingMode=d.TextureSamplingMode.NEAREST;q.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE;return new f.Texture(k,q,g)};b.createRasterTexture=
function(k,g,q="nearest",e=!1){const m=(e=!(e&&"u8"===g.pixelType))?d.PixelType.FLOAT:d.PixelType.UNSIGNED_BYTE,l=null==g.pixels||0===g.pixels.length?null:e?g.getAsRGBAFloat():g.getAsRGBA(),w=k.capabilities.textureFloat?.textureFloatLinear,v=new n.TextureDescriptor;v.width=g.width;v.height=g.height;v.internalFormat=k.type===c.ContextType.WEBGL2&&e?d.SizedPixelFormat.RGBA32F:d.PixelFormat.RGBA;v.samplingMode=!w||"bilinear"!==q&&"cubic"!==q?d.TextureSamplingMode.NEAREST:d.TextureSamplingMode.LINEAR;
v.dataType=m;v.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE;return new f.Texture(k,v,l)};b.createTransformTexture=function(k,g){const {spacing:q,offsets:e,coefficients:m,size:[l,w]}=g;var v=1<q[0];g=new n.TextureDescriptor;g.width=v?4*l:l;g.height=w;g.internalFormat=k.type===c.ContextType.WEBGL2?d.SizedPixelFormat.RGBA32F:d.PixelFormat.RGBA;g.dataType=d.PixelType.FLOAT;g.samplingMode=d.TextureSamplingMode.NEAREST;g.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE;const x=new Float32Array(v?l*w*16:2*e.length);
if(v&&null!=m)for(let p=0,h=0;p<m.length;p++)x[h++]=m[p],2===p%3&&(x[h++]=1);else for(v=0;v<w;v++)for(let p=0;p<l;p++){const h=4*(v*l+p),t=2*(p*w+v);x[h]=e[t];x[h+1]=e[t+1];x[h+3]=-1===e[t]?0:1}return new f.Texture(k,g,x)};b.getBasicGridUniforms=function(k,g){return{u_scale:k,u_offset:g}};b.getColormapUniforms=function(k,g){return{u_colormapOffset:g||0,u_colormapMaxIndex:k?k.length/4-1:0}};b.getCommonUniforms=function(k,g,q,e=1,m=!0){return{u_flipY:m,u_applyTransform:!!k,u_opacity:e,u_transformSpacing:k?
k.spacing:a.ZEROS,u_transformGridSize:k?k.size:a.ZEROS,u_targetImageSize:g,u_srcImageSize:q}};b.getShadedReliefUniforms=function(k){return{u_hillshadeType:k.hillshadeType,u_sinZcosAs:k.sinZcosAs,u_sinZsinAs:k.sinZsinAs,u_cosZs:k.cosZs,u_weights:k.weights,u_factor:k.factor,u_minValue:k.minValue,u_maxValue:k.maxValue}};b.getStretchUniforms=function(k){return{u_bandCount:k.bandCount,u_minOutput:k.outMin,u_maxOutput:k.outMax,u_minCutOff:k.minCutOff,u_maxCutOff:k.maxCutOff,u_factor:k.factor,u_useGamma:k.useGamma,
u_gamma:k.gamma,u_gammaCorrection:k.gammaCorrection}};b.getUniformLocationInfos=function(k,g){k=k.gl;g=g.glName;const q=new Map;if(null==g)return q;const e=k.getProgramParameter(g,k.ACTIVE_UNIFORMS);let m;for(let l=0;l<e;l++)(m=k.getActiveUniform(g,l))&&q.set(m.name,{location:k.getUniformLocation(g,m.name),info:m});return q};b.setTextures=function(k,g,q,e){q.length===e.length&&(e.some(m=>null==m)||q.some(m=>null==m)||q.forEach((m,l)=>{g.setUniform1i(m,l);k.bindTexture(e[l],l)}))};b.setUniforms=function(k,
g,q){Object.keys(q).forEach(e=>{var m=g.get(e)||g.get(e+"[0]");if(m){var l=q[e];if(null!==m&&null!=l)switch({info:m}=m,m.type){case d.UniformType.FLOAT:1<m.size?k.setUniform1fv(e,l):k.setUniform1f(e,l);break;case d.UniformType.FLOAT_VEC2:k.setUniform2fv(e,l);break;case d.UniformType.FLOAT_VEC3:k.setUniform3fv(e,l);break;case d.UniformType.FLOAT_VEC4:k.setUniform4fv(e,l);break;case d.UniformType.FLOAT_MAT3:k.setUniformMatrix3fv(e,l);break;case d.UniformType.FLOAT_MAT4:k.setUniformMatrix4fv(e,l);break;
case d.UniformType.INT:1<m.size?k.setUniform1iv(e,l):k.setUniform1i(e,l);break;case d.UniformType.BOOL:k.setUniform1i(e,l?1:0);break;case d.UniformType.INT_VEC2:case d.UniformType.BOOL_VEC2:k.setUniform2iv(e,l);break;case d.UniformType.INT_VEC3:case d.UniformType.BOOL_VEC3:k.setUniform3iv(e,l);break;case d.UniformType.INT_VEC4:case d.UniformType.BOOL_VEC4:k.setUniform4iv(e,l)}}})};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TilePerLayerInfo":function(){define("exports ../../../core/maybe ../../../core/ObjectPool ../../../core/PooledArray ./terrainUtils ./tileUtils".split(" "),
function(b,a,c,d,f,n){class k{constructor(){this.waitingAgents=new d;this.requestAbort=this.requestPromise=this.loadingAgent=this._upsampleInfo=null;this.pendingUpdates=0}static acquire(e){const m=g.acquire();m._init(e);return m}release(){this.dispose();q.delete(this);g.release(this)}dispose(){this.loadingAgent=a.disposeMaybe(this.loadingAgent);this.abortRequest();this._unsetUpsampleInfo();this.pendingUpdates=0;this._data=f.releaseTileData(this._data)}static prune(){g.prune(0)}_init(e){this.waitingAgents.clear();
this._data=f.releaseTileData(this._data);this.dataInvalidated=this.dataMissing=!1;this._unsetUpsampleInfo();this.abortRequest();this.loadingAgent=null;this.pendingUpdates=0;this._pool=e;this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0;this.dataMissing=!1;this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=a.abortMaybe(this.requestAbort);this.requestPromise=null}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){null!=this._upsampleInfo&&(this._upsampleInfo.tile.unrefMapData(),
this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(e,m){if(e===m||null==m)this._unsetUpsampleInfo();else{if(null==this._upsampleInfo)this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===m)return;this._upsampleInfo.tile.unrefMapData()}m.refMapData();n.computeUpsampleInfo(e,m,this._upsampleInfo)}}get data(){return this._data}set data(e){f.releaseTileData(this._data);this._data=e}}const g=new c(k,null,()=>{}),q=new Map;b.TilePerLayerInfo=k;b.printAllocations=
function(){0<q.size&&(console.log(`${q.size} live TilePerLayerInfo allocations:`),q.forEach(e=>console.log(e,"\n")))};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TileTexture":function(){define(function(){class b{constructor(a,c){this._texture=a;this._cache=c;this.type="tile-texture";this._refCount=1}retain(){++this._refCount}release(){--this._refCount;0===this._refCount&&(this._cache?this._cache.put(`${this._texture.descriptor.width} ${this._texture.descriptor.pixelFormat}`,
this):this.dispose())}dispose(){this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}get usedMemory(){return this._texture.gpuMemoryUsage}}return b})},"esri/views/3d/terrain/TileUpdate":function(){define(["exports"],function(b){b.TileUpdate=void 0;var a=b.TileUpdate||(b.TileUpdate={});a[a.NONE=0]="NONE";a[a.SPLIT=1]="SPLIT";a[a.ELEVATION=2]="ELEVATION";a[a.MERGE=4]="MERGE";a[a.RENDERDATA=8]="RENDERDATA";
a[a.GEOMETRY=16]="GEOMETRY";a[a.TEXTURE_NOFADING=32]="TEXTURE_NOFADING";a[a.TEXTURE_FADING=64]="TEXTURE_FADING";Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TileOverlayData":function(){define(["../../../chunks/vec4f64"],function(b){class a{constructor(){this._scales=b.fromValues(-1,-1,-1,-1);this._offsets=b.fromValues(-1,-1,-1,-1)}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1;this._offsets[0]=this._offsets[1]=this._offsets[2]=
this._offsets[3]=-1}setScale(c,d,f){this._scales[2*c]=d;this._scales[2*c+1]=f}setOffset(c,d,f){this._offsets[2*c]=d;this._offsets[2*c+1]=f}get scales(){return this._scales}get offsets(){return this._offsets}}return a})},"esri/views/3d/webgl-engine/shaders/TerrainTechnique":function(){define("require exports ../../../ViewingMode ../../../../chunks/Terrain.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/basicInterfaces ../lib/Program ../lib/StencilUtils ../lib/VertexAttribute ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l){class w extends n.ShaderTechnique{constructor(){super(...arguments);this.useStencil=!1}initializeConfiguration(x,p){p.spherical=x.viewingMode===c.ViewingMode.Global}initializeProgram(x){return new g.Program(x.rctx,w.shader.get().build(this.configuration),v)}initializePipeline(){this._stencilPipelineState=this._createPipeline(!0);return this._createPipeline(!1)}_createPipeline(x){const p=this.configuration,h=p.backfaceCullingEnabled&&!p.renderOccluded;return l.makePipelineState({blending:p.renderOccluded?
l.simpleBlendingParams(m.BlendFactor.ONE,m.BlendFactor.ONE_MINUS_SRC_ALPHA):null,culling:h?l.backFaceCullingParams:null,depthTest:p.renderOccluded?null:{func:m.CompareFunction.LESS},depthWrite:p.renderOccluded?null:l.defaultDepthWriteParams,colorWrite:l.defaultColorWriteParams,stencilTest:x?q.renderWhenBitIsNotSet(k.StencilBits.IntegratedMeshMaskExcluded):null})}getPipeline(){return this.useStencil?this._stencilPipelineState:super.getPipeline()}}w.shader=new f.ReloadableShaderModule(d.Terrain,()=>
new Promise((x,p)=>b(["../core/shaderLibrary/terrain/Terrain.glsl"],x,p)));const v=new Map([[e.VertexAttribute.POSITION,0],[e.VertexAttribute.UV0,1],[e.VertexAttribute.NORMALCOMPRESSED,2]]);a.TerrainTechnique=w;a.terrainVertexAttributeLocations=v;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Terrain.glsl":function(){define("exports ./mat4 ./mat4f64 ./vec3 ./vec3f64 ../views/3d/terrain/OverlayContent ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTangent.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/Overlay.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/TerrainTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4DrawUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A,C,E,B,D,F,K,L){function G(R){const X=new K.ShaderBuilder,{vertex:U,fragment:M,varyings:V}=X;X.include(l.PositionAttribute);X.include(m.NormalAttribute,R);X.include(w.TextureCoordinateAttribute,R);var Y=()=>{X.include(u.NormalUtils,R);U.code.add(D.glsl`vec3 getNormal() {
float z = 1.0 - abs(normalCompressed.x) - abs(normalCompressed.y);
vec3 n = vec3(normalCompressed + vec2(normalCompressed.x >= 0.0 ? 1.0 : -1.0,
normalCompressed.y >= 0.0 ? 1.0 : -1.0) * min(z, 0.0), z);
return normalize(n);
}`)};E.addProjViewLocalOrigin(U,R);X.include(e.Transform,R);const W=R.overlayMode!==A.OverlayMode.Disabled;var H=W&&R.invisible;switch(R.output){case g.ShaderOutput.Color:X.include(C.TerrainTexture,R);X.include(t.EvaluateSceneLighting,R);W&&X.include(A.OverlayTerrain,{...R,pbrMode:R.pbrMode===y.PBRMode.Terrain?y.PBRMode.TerrainWithWater:y.PBRMode.Water});(H=R.overlayMode===A.OverlayMode.EnabledWithWater)&&X.include(v.VertexTangent,R);V.add("vnormal","vec3");V.add("vpos","vec3");V.add("vup","vec3");
Y();R.screenSizePerspective&&E.addViewNormal(U);(Y=R.receiveShadows&&!R.renderOccluded)&&X.include(k.ForwardLinearDepth,R);R.screenSizePerspective&&(V.add("screenSizeDistanceToCamera","float"),V.add("screenSizeCosAngle","float"));U.code.add(D.glsl`
        void main(void) {
          //Position
          vpos = position;
          vec3 positionWorld = position + localOrigin;
          gl_Position = transformPosition(proj, view, vpos);

          //Normal
          vnormal = getNormal();

          //Up
          vup = getLocalUp(position, localOrigin);

          ${H?D.glsl`forwardVertexTangent(vnormal);`:D.glsl``}

          //Texture UV
          vec2 uv = getUV0();
          forwardTextureCoordinatesWithTransform(uv);
          ${W?D.glsl`setOverlayVTC(uv);`:""}
          ${R.tileBorders?D.glsl`forwardTextureCoordinates();`:""}

          ${R.screenSizePerspective?D.glsl`
          vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
          screenSizeDistanceToCamera = length(viewPos);
          vec3 viewSpaceNormal = (viewNormal * vec4(normalize(positionWorld), 1.0)).xyz;
          screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}

          ${Y?D.glsl`forwardLinearDepth();`:""}

        }
      `);X.include(q.SliceDraw,R);X.include(t.EvaluateSceneLighting,R);X.include(h.EvaluateAmbientOcclusion,R);X.include(z.ReadShadowMapDraw,R);E.addCameraPosition(M,R);t.addAmbientBoostFactor(M);t.addLightingGlobalFactor(M);M.uniforms.add(U.uniforms.get("localOrigin"),new B.Float3PassUniform("viewDirection",(S,I)=>d.normalize(J,d.set(J,I.camera.viewMatrix[12],I.camera.viewMatrix[13],I.camera.viewMatrix[14]))));H&&M.uniforms.add(new L.Texture2DPassUniform("ovWaterTex",(S,I)=>I.overlay?.getTexture(n.OverlayContent.WaterNormal)),
new F.Matrix4DrawUniform("view",(S,I)=>a.translate(P,I.camera.viewMatrix,S.origin)));M.code.add(D.glsl`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`);r.addMainLightDirection(M);r.addMainLightIntensity(M);M.code.add(D.glsl`
        void main() {
          vec3 normal = normalize(vnormal);
          float vndl = dot(normal, mainLightDirection);

          float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));
          float shadow = ${R.receiveShadows&&!R.renderOccluded?"readShadowMap(vpos, linearDepth)":R.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

          float ssao = evaluateAmbientOcclusionInverse();
          vec4 tileColor = getTileColor();

          ${W?D.glsl`
              vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
              vec4 overlayColor = overlayOpacity * overlayColorOpaque;
              ${R.invisible?D.glsl`if (overlayColor.a == 0.0) { discard; }`:""}
              vec4 groundColor = tileColor;
              tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}

          // If combined alpha is 0 we can discard pixel. The performance impact by having a discard here
          // is neglectable because terrain typically renders first into the framebuffer.
          if(tileColor.a <= 0.0) {
            discard;
          }

          bool sliced = rejectBySlice(vpos);
          if (sliced) {
            tileColor *= sliceOpacity;
          }

          vec3 albedo = tileColor.rgb;

          // heuristic shading function used in the old terrain, now used to add ambient lighting

          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

          ${R.pbrMode===y.PBRMode.Terrain||R.pbrMode===y.PBRMode.TerrainWithWater?D.glsl`fragColor = vec4(evaluateTerrainLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight, normalize(vpos - cameraPosition), vup), tileColor.a);`:D.glsl`fragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);`}
          ${H?D.glsl`
              vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
                vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
                vec4 viewPosition = view*vec4(vpos, 1.0);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + localOrigin);
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                float opacity = sliced ? sliceOpacity : 1.0;
                // un-gamma the ground color to mix in linear space
                fragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w) * opacity;
              }`:""}
          ${R.screenSizePerspective?D.glsl`
            float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
            if (perspectiveScale <= 0.25) {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
            }
            else if (perspectiveScale <= 0.5) {
              fragColor = mix(fragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
            }
            else if (perspectiveScale >= 0.99) {
              fragColor = mix(fragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
            }
            else {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
            }`:""}
          ${R.visualizeNormals?R.spherical?D.glsl`
                  vec3 localUp = normalize(vpos + localOrigin);
                  vec3 right = normalize(cross(vec3(0.0, 0.0, 1.0), localUp));
                  vec3 forward = normalize(cross(localUp, right));
                  mat3 tbn = mat3(right, forward, localUp);
                  vec3 tNormal = normalize(normal * tbn);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:D.glsl`
                  vec3 tNormal = normalize(normal);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:""}
          ${R.tileBorders?D.glsl`
              vec2 dVuv = fwidth(vuv0);
              vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv0, 1.0 - vuv0));
              float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
          fragColor = highlightSlice(fragColor, vpos);
        }
      `);break;case g.ShaderOutput.Depth:H&&X.include(A.OverlayTerrain,R);X.include(x.OutputDepth,R);k.addLinearDepth(X);k.addNearFar(X);U.code.add(D.glsl`
              void main(void) {
                ${H?D.glsl`setOverlayVTC(getUV0());`:""}
                gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
              }
          `);M.code.add(D.glsl`
              void main() {
                ${H?D.glsl`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
                outputDepth(linearDepth);
              }
          `);break;case g.ShaderOutput.Shadow:case g.ShaderOutput.ShadowHighlight:case g.ShaderOutput.ShadowExcludeHighlight:X.include(x.OutputDepth,R);k.addLinearDepth(X);k.addNearFar(X);U.code.add(D.glsl`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`);M.code.add(D.glsl`void main() {
outputDepth(linearDepth);
}`);break;case g.ShaderOutput.Normal:H&&X.include(A.OverlayTerrain,R);V.add("vnormal","vec3");E.addViewNormal(U);Y();U.code.add(D.glsl`
            void main(void) {
              ${H?D.glsl`setOverlayVTC(getUV0());`:""}
              gl_Position = transformPosition(proj, view, position);
              vnormal = normalize((viewNormal * vec4(getNormal(), 1.0)).xyz);
            }
        `);M.code.add(D.glsl`
            void main() {
              ${H?D.glsl`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
              vec3 normal = normalize(vnormal);
              if (gl_FrontFacing == false) {
                normal = -normal;
              }
              fragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);
            }
        `);break;case g.ShaderOutput.Highlight:W&&X.include(A.OverlayTerrain,R),U.code.add(D.glsl`
          void main() {
            ${W?D.glsl`setOverlayVTC(getUV0());`:""}
            gl_Position = transformPosition(proj, view, position);
          }
        `),X.include(p.OutputHighlight,R),M.code.add(D.glsl`
          void main() {
            ${W?D.glsl`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
            outputHighlight();
          }
        `)}R.output===g.ShaderOutput.ObjectAndLayerIdColor&&(W?(X.include(A.OverlayTerrain,{...R,pbrMode:y.PBRMode.Disabled}),U.code.add(D.glsl`void main(void) {
gl_Position = transformPosition(proj, view, position);
setOverlayVTC(getUV0());
}`),M.code.add(D.glsl`void main() {
fragColor = getOverlayColorTexel(vtcOverlay);
}`)):(U.code.add(D.glsl`void main(void) {}`),M.code.add(D.glsl`void main() {
fragColor = vec4(0.0);
}`)));return X}class O extends C.OverlayTerrainPassParameters{}const P=c.create(),J=f.create();c=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:O,build:G},Symbol.toStringTag,{value:"Module"}));b.Terrain=c;b.TerrainPassParameters=O;b.build=G})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTangent.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(b,a){b.VertexTangent=function(c,d){c.varyings.add("tbnTangent","vec3");c.varyings.add("tbnBiTangent",
"vec3");d.spherical?c.vertex.code.add(a.glsl`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):c.vertex.code.add(a.glsl`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`);c.fragment.code.add(a.glsl`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/TerrainTexture.glsl":function(){define("exports ../shading/ReadShadowMap.glsl ./BackgroundGrid.glsl ./TileBlendInput ../../shaderModules/interfaces ../../shaderModules/Uniform".split(" "),function(b,a,c,d,f,n){class k extends a.ReadShadowMapPassParameters{constructor(){super(...arguments);this.overlayOpacity=1}}class g extends n.Uniform{constructor(l){super(l,"float")}}class q extends n.Uniform{constructor(l){super(l,
"vec3")}}class e extends n.Uniform{constructor(l){super(l,"vec4")}}class m extends n.Uniform{constructor(l){super(l,"sampler2D")}}b.Float3Uniform=q;b.OverlayTerrainPassParameters=k;b.TerrainTexture=function(l,w){const {vertex:v,fragment:x,varyings:p}=l;p.add("vtc","vec2");v.uniforms.add(new e("texOffsetAndScale"));x.uniforms.add(new m("tex"));x.uniforms.add(new q("textureOpacities"));if(l=w.textureFadingEnabled&&!w.renderOccluded)v.uniforms.add(new e("nextTexOffsetAndScale")),p.add("nvtc","vec2"),
x.uniforms.add(new m("texNext")),x.uniforms.add(new q("nextTexOpacities")),x.uniforms.add(new g("fadeFactor"));const h=w.tileBlendInput===d.TileBlendInput.ColorComposite;(w=w.tileBlendInput===d.TileBlendInput.GridComposite)&&x.include(c.BackgroundGrid);h&&x.uniforms.add(new q("backgroundColor"));v.code.add(f.glsl`
  void forwardTextureCoordinatesWithTransform(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${l?f.glsl`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:f.glsl``}
  }`);x.code.add(f.glsl`
    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${w||h?f.glsl`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = vec4(${h?f.glsl`backgroundColor`:f.glsl`gridColor(uv)`} * opacities.y, opacities.y);
              vec4 layer = color * opacities.z;
              return (bg * (1.0 - layer.a) + layer) * opacities.x;`:f.glsl`return color;`}
    }`);l?x.code.add(f.glsl`vec4 getTileColor() {
vec4 color = getColor(texture(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):x.code.add(f.glsl`vec4 getTileColor() {
return getColor(texture(tex, vtc), vtc, textureOpacities);
}`)};b.Texture2DUniform=m;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/TileBlendInput":function(){define(["exports"],function(b){b.TileBlendInput=void 0;var a=b.TileBlendInput||(b.TileBlendInput={});a[a.LayerOnly=0]="LayerOnly";a[a.ColorComposite=1]="ColorComposite";a[a.GridComposite=2]="GridComposite";a[a.COUNT=3]="COUNT";Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/ScaleRangeQueries":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/ObjectPool ../../../core/PooledArray ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec4 ../../../chunks/vec4f64".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l){class w{constructor(){this.extent=l.create();this.maxLevel=this.minLevel=0;this.callback=null}}b.ScaleRangeQueries=class extends c{constructor(){super(...arguments);this._queries=new f({initialSize:10});this._queriesInvPtr=0;this._queryQueue=new f({initialSize:30});this._queryPool=new d(w)}queryVisibleLevelRange(v,x,p,h){const t=this._queryPool.acquire();m.copy(t.extent,v);t.minLevel=null==x?-Number.MAX_VALUE:x;t.maxLevel=null==p?Number.MAX_VALUE:p;t.callback=h;this._queryQueue.push(t);
this.notifyChange("updating")}get updating(){return 0!==this._queryQueue.length}prepare(){for(;this._queries.length<this._queries.data.length&&0<this._queryQueue.length;){const v=this._queryQueue.pop();this._queries.push(v)}this._queriesInvPtr=this._queries.length}process(){for(let v=0;v<this._queries.length;v++){const x=this._queries.data[v];this._queryPool.release(x);x.callback(v>=this._queriesInvPtr);x.callback=null}this._queries.clear();this.notifyChange("updating")}queriesForTile(v){const x=
v.level;let p=0;for(;p<this._queriesInvPtr;){const h=this._queries.data[p],t=h.extent;x>=h.minLevel&&x<=h.maxLevel&&t[0]<=v.extent[2]&&t[2]>=v.extent[0]&&t[1]<=v.extent[3]&&t[3]>=v.extent[1]?(this._queries.swapElements(p,this._queriesInvPtr-1),this._queriesInvPtr--):p++}}};a.__decorate([n.property()],b.ScaleRangeQueries.prototype,"updating",null);b.ScaleRangeQueries=a.__decorate([e.subclass("esri.views.3d.terrain.ScaleRangeQueries")],b.ScaleRangeQueries);Object.defineProperty(b,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/terrain/SphericalPatch":function(){define("exports ../../../core/mathUtils ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projection/lonLatToSphericalPCPF ../../../geometry/support/DoubleArray ../../../geometry/support/frustum ../../../chunks/sphere ./interfaces ./ITile ./PatchGeometryFactory ./terrainUtils ./Tile ./tileUtils".split(" "),function(b,a,c,d,f,n,k,g,q,e,m,l,w,v){function x(z,A,C,E,B,D){z=E-z;A=B-A;C=D-C;return z*z+A*A+C*C}class p extends w.Tile{constructor(z,
A,C,E,B){super();this._convexHull=Array(24);this._boundingSphere=g.create();this._baseUsedMemory=1816;this.init(z,A,C,E,B)}init(z,A,C,E,B){super.init(z,A,C,E,B);A=this.ellipsoid.radius;C=this.extentInRadians[0];E=this.extentInRadians[1];B=this.extentInRadians[2];const D=this.extentInRadians[3],F=a.lerp(E,D,.5),K=a.lerp(C,B,.5);this._edgeLen=(B-C)*Math.cos(0===z?0:Math.min(Math.abs(E),Math.abs(D)))*A;this._edgeLen2=this._edgeLen*this._edgeLen;this._curvatureHeight=A-Math.sqrt(A*A-this._edgeLen2/4);
f.lonLatToSphericalPCPF(this.centerAtSeaLevel,K,F,this.ellipsoid.radius);c.normalize(this.up,this.centerAtSeaLevel);this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateBoundingVolumes();const z=this._center;if(0===this.lij[0])c.set(z[w.CenterPosition.MIDDLE],0,0,0),c.set(z[w.CenterPosition.TOP],0,0,0),c.set(z[w.CenterPosition.BOTTOM],0,0,0),z[w.CenterPosition.MIDDLE][3]=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();const D=z[w.CenterPosition.MIDDLE],F=this.convexHull;
var A=0;for(let K=0;8>K;++K){var C=Math,E=C.max;var B=3*K;B=x(D[0],D[1],D[2],F[B],F[B+1],F[B+2]);A=E.call(C,A,B)}z[w.CenterPosition.MIDDLE][3]=Math.sqrt(A)}}_calculateFrustumVisibilityStatus(z){if(!k.intersectsSphere(z,this._boundingSphere))return e.TileFrustumVisibility.OUTSIDE;if(10>this.lij[0])return e.TileFrustumVisibility.INTERSECTS;const A=this.convexHull,C=this.surface.view.state.camera.near;let E=!0;for(let D=0;D<k.NumPlanes;D++){var B=z[D];const F=B[0],K=B[1],L=B[2];B=B[3]-(D===k.PlaneIndex.NEAR?
C:0);let G=!1;for(let O=0;8>O;++O){const P=3*O;if(0>F*A[P]+K*A[P+1]+L*A[P+2]+B){if(G=!0,!E)break}else E=!1}if(!G)return e.TileFrustumVisibility.OUTSIDE}return E?e.TileFrustumVisibility.INSIDE:e.TileFrustumVisibility.INTERSECTS}computeElevationBounds(){super.computeElevationBounds();this._updateBoundingVolumes()}createGeometry(){m.createSphericalGlobePatch(this.renderData,this._getPatchType());this._updateBoundingVolumes();this.setMemoryDirty()}_updateBoundingVolumes(){this._updateConvexHull();this._updateBoundingSphere();
l.enableTerrainInternalChecks&&this._checkBVs()}_updateBoundingSphere(){const z=this._boundingSphere;var A=this.elevationBounds,C=this.ellipsoid.radius,E=A[1];if(0===this.level)c.set(z,0,0,0),z[3]=C+E;else{E=this.extentInRadians;var B=.5*(E[0]+E[2]),D=E[3];t(u,B,E[1],C);t(y,B,D,C);c.add(z,u,y);c.scale(z,z,(C+.5*(A[0]+A[1]))/c.len(z));A=this.convexHull;C=0;for(E=0;8>E;++E){B=z[0]-A[3*E];D=z[1]-A[3*E+1];const F=z[2]-A[3*E+2];C=Math.max(C,Math.sqrt(B*B+D*D+F*F))}z[3]=C+2}}_updateConvexHull(){var z=this.extentInRadians,
A=this.ellipsoid.radius;if(0!==this.level){var C=this.elevationBounds,E=this._getPatchType(),B=this.surface.isWebMercator,D=B&&E===q.PatchType.HAS_NORTH_POLE,F=(E=B&&E===q.PatchType.HAS_SOUTH_POLE)||D;B=Math.PI/2;var K=z[0],L=z[2];E=E?-B:z[1];var G=D?B:z[3],O=.5*(K+L);z=C[0];var P=A+(F?Math.min(0,z-1):z);z=d.create();D=d.create();B=d.create();var J=d.create();t(z,K,E,P);t(D,K,G,P);t(B,L,G,P);t(J,L,E,P);K=(V,Y)=>{for(let W=0;3>W;++W)this._convexHull[3*Y+W]=V[W]};K(z,0);K(D,1);K(B,2);K(J,3);C=C[1];
var R=A+(F?Math.max(0,C+1):C),X=d.create();A=d.create();C=d.create();t(A,O,G,P);t(C,O,E,P);c.add(X,A,C);c.normalize(X,X);var U=d.create(),M=d.create();E=(V,Y)=>{c.sub(M,V,Y);c.normalize(M,M);Y=-c.dot(V,U)/c.dot(M,U);l.internalAssert(0<=Y);c.scale(M,M,Y);c.add(V,V,M)};2**this.lij[0]>2*this.lij[1]?(A=d.create(),c.cross(A,r,C),c.normalize(A,A),c.cross(U,C,A),c.normalize(U,U),l.internalAssert(l.almostEquals(c.dot(U,C)/c.len(C),0)),E(z,D),E(J,B),K(z,0),K(J,3)):2**this.lij[0]!==2*this.lij[1]&&(C=d.create(),
c.cross(C,r,A),c.normalize(C,C),c.cross(U,C,A),c.normalize(U,U),E(D,z),E(B,J),K(D,1),K(B,2));A=(V,Y)=>{const W=R/c.dot(Y,X);for(let H=0;3>H;++H)this._convexHull[3*V+H]=Y[H]*W};A(4,z);A(5,D);A(6,B);A(7,J)}}_getPatchType(){const z=this.lij[1],A=z===(1<<this.level)-1;return 0===z?A?q.PatchType.HAS_BOTH_POLES:q.PatchType.HAS_NORTH_POLE:A?q.PatchType.HAS_SOUTH_POLE:q.PatchType.REGULAR}intersectsRay(z,A,C,E){var B=this._boundingSphere;C=B[3]+C;var D=B[0]-z[0];E=B[1]-z[1];z=B[2]-z[2];B=(D*A[0]+E*A[1]+z*
A[2])/(A[0]*A[0]+A[1]*A[1]+A[2]*A[2]);D=A[0]*B-D;E=A[1]*B-E;A=A[2]*B-z;return D*D+E*E+A*A<C*C}getDefaultVerticesPerSide(){return this.level<h.length?h[this.level]+1:2}updateCornerElevations(){m.updateCornerSpherical(this.renderData);this._updateBoundingVolumes()}updateEdgeElevations(){m.updateEdgesAndCornersSpherical(this.renderData);this._updateBoundingVolumes()}_checkBVs(){if(l.enableTerrainInternalChecks&&!(2>=this.level)){var z=this._boundingSphere,A=z[3],C=d.create(),E=this.ellipsoid.radius,
B=this.elevationBounds;B[1]-B[0];var D=E+B[0],F=this._center[w.CenterPosition.MIDDLE][3],K=this.convexHull,L=(ia,la)=>{for(let oa=0;3>oa;++oa)ia[oa]=K[3*la+oa]},G=d.create(),O=d.create(),P=d.create(),J=d.create(),R=d.create(),X=(ia,la,oa,na)=>{L(O,ia);L(P,la);L(J,oa);c.sub(O,O,P);c.sub(J,J,P);c.cross(G,O,J);c.normalize(G,G);var ra=c.dot(G,P);L(R,na);const ta=c.dot(G,R);ra=Math.abs(ta-ra);l.internalAssert(l.almostEquals(ra,0),`Non coplanar ${ia},${la},${oa},${na} diff = ${ra}`)};X(0,1,2,3);X(4,5,6,
7);X(0,1,4,5);X(1,2,5,6);X(2,3,6,7);X(3,0,7,4);var U=n.newDoubleArray(24),M=d.create(),V=d.create(),Y=d.create(),W=d.create();X=(ia,la,oa,na)=>{L(M,la);L(V,oa);L(Y,na);c.sub(M,M,V);c.normalize(M,M);c.sub(Y,Y,V);c.normalize(Y,Y);c.cross(W,M,Y);c.normalize(W,W);la=c.dot(W,V);ia*=4;for(oa=0;3>oa;++oa)U[ia+oa]=W[oa];U[ia+3]=la};X(0,0,1,2);X(1,1,0,4);X(2,1,5,2);X(3,3,2,6);X(4,4,0,3);X(5,4,6,5);var H=(ia,la,oa,na)=>{ia*=4;return U[ia]*la+U[ia+1]*oa+U[ia+2]*na-U[ia+3]},S=(ia,la,oa,na)=>-1<=H(ia,la,oa,na),
I=2**this.lij[0]>2*this.lij[1];X=(ia,la,oa)=>Math.sqrt(x(ia,la,oa,z[0],z[1],z[2]))<A;var Q=this.extentInRadians,N=.5*(Q[0]+Q[2]),T=Q[1],aa=Q[3];Q=d.create();var Z=d.create();t(Q,N,aa,D);t(Z,N,T,D);D=I?"Upper":"Lower";I=!0;for(N=0;6>N;++N){for(T=0;8>T;++T)aa=3*T,aa=-1<=H(N,K[aa],K[aa+1],K[aa+2]),I&&(I=aa),l.internalAssert(aa,`Tile[${this.lij}] Convex hull point ${T} outside of plane ${N}`);l.internalAssert(S(N,Z[0],Z[1],Z[2]),`Tile[${this.lij}] (${D}) bottom mid outside of plane ${N}`);l.internalAssert(S(N,
Q[0],Q[1],Q[2]),`Tile[${this.lij}] (${D}) top mid outside of plane ${N}`)}l.internalAssert(I,"Not all convex hull points are inside  convex hull polyhedron");l.internalAssert(X(Z[0],Z[1],Z[2]),`Tile[${this.lij}] (${D}) bottom mid outside of bounding sphere`);l.internalAssert(X(Q[0],Q[1],Q[2]),`Tile[${this.lij}] (${D}) top mid outside of bounding sphere`);for(S=0;8>S;++S)Q=3*S,Q=X(K[Q],K[Q+1],K[Q+2]),l.internalAssert(Q,`Tile[${this.lij}] Convex hull point ${S} outside of bounding sphere`);for(X=0;6>
X;++X)for(S=0;8>S;++S)Q=3*S,-1<=H(X,K[Q],K[Q+1],K[Q+2])||console.error(`Tile[${this.lij}] Convex hull point ${S} outside of plane ${X}`);X=this.extentInRadians;X=Math.round(Math.max(X[2]-X[0],X[3]-X[1])*E);if(N=this.renderData){var {geometry:da,localOrigin:fa}=N;if(S=da.vertexAttributes?.position){Q=S.count;Z=d.create();D=da.numVerticesPerSide-2;I=D*D;N=N.geometryState.neighborData;T=N.edgeResolutions.reduce((ia,la)=>ia+la+1,0);for(let ia=0;ia<Q;++ia){const la=ia<I,oa=!la&&ia<I+T;let na=!1;aa=-1;
if(oa){var ka=I;for(var ha=0;4>ha;++ha){var ba=N.edgeResolutions[ha];if(ia===ka||ia===ka+ba-1){na=!0;break}ka+=ba;if(ia<ka){aa=ha;break}}}aa=oa?N.edgePeerNeighbors[aa]:null;const ra=oa&&aa&&0<v.compareTilesByLij(this,aa);S.getVec(ia,C);c.add(Z,C,fa);aa=c.len(Z)-E;ka=0;ha=!1;ba=B[0]-aa;const ta=aa-B[1],ma=1<ba,pa=1<ta;var ea=ma||pa;const ja=()=>{const qa=oa&&!na;return`Tile[${this.lij}].vertex[${ia}]:${la?"internal":qa?"edge":na?"corner":"pole"}`+(ma?"(below)":pa?"(above)":"")+(ra?"(Neighbor)":"")};
var ca=c.dist(Z,z);ca>=A+0&&(ca-=A,ea||(console.error(`${ja()} is out of the bounding sphere by ${ca.toFixed(0)} / ${A.toFixed(0)}`+"[tol\x3d0]"+` h=${aa.toFixed(0)} / [${B[0].toFixed(0)}..${B[1].toFixed(0)}] (${(ca/A).toFixed(0)})`),ha=!0));for(ea=0;6>ea;++ea)if(!(-1<=H(ea,Z[0],Z[1],Z[2]))){ca=H(ea,Z[0],Z[1],Z[2]);const qa=ia%D,ua=(ia-qa)/D;0===ea&&ba||5===ea&&ta||(console.error(`${ja()} (${qa},${ua})|${D}] is out of the bounding trapezoid plane ${ea}`+` h=${Math.round(aa)} / [${Math.round(B[0])}..${Math.round(B[1])}] dist=${Math.round(ca)}`+
` radii = ${Math.round(A)}/${Math.round(F)}} : maxL = ${X}`),++ka)}if(ha||0<ka)break}}}}}get convexHull(){return this._convexHull}}const h=[128,64,64,32,16,8,8,4],t=(z,A,C,E)=>{const B=Math.sin(A),D=Math.cos(C);C=Math.sin(C);z[0]=E*D*Math.cos(A);z[1]=E*D*B;z[2]=E*C},r=[0,0,1],u=d.create(),y=d.create();b.SphericalPatch=p;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/lonLatToSphericalPCPF":function(){define(["exports"],function(b){b.lonLatToSphericalPCPF=
function(a,c,d,f){const n=Math.cos(d);a[0]=Math.cos(c)*n*f;a[1]=Math.sin(c)*n*f;a[2]=Math.sin(d)*f};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/SplitLimits":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass".split(" "),function(b,a,c,d,f,n,k,g){b.SplitLimits=
class extends c{constructor(){super(...arguments);this.angledSplitBias=this.maxLod=this.relativeHeightLimit=this.relativeWidthLimit=this.fovY=this.fovX=0;this.aboveGround=!0}};a.__decorate([d.property()],b.SplitLimits.prototype,"fovX",void 0);a.__decorate([d.property()],b.SplitLimits.prototype,"fovY",void 0);a.__decorate([d.property()],b.SplitLimits.prototype,"relativeWidthLimit",void 0);a.__decorate([d.property()],b.SplitLimits.prototype,"relativeHeightLimit",void 0);a.__decorate([d.property()],
b.SplitLimits.prototype,"maxLod",void 0);a.__decorate([d.property()],b.SplitLimits.prototype,"angledSplitBias",void 0);a.__decorate([d.property()],b.SplitLimits.prototype,"aboveGround",void 0);a.__decorate([d.property()],b.SplitLimits.prototype,"frustum",void 0);b.SplitLimits=a.__decorate([g.subclass("esri.views.3d.terrain.SplitLimits")],b.SplitLimits);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TerrainRenderer":function(){define("exports ../../../chunks/tslib.es6 ../../../Color ../../../core/has ../../../core/maybe ../../../core/MemCachePool ../../../core/ObjectPool ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/buffer/BufferView ../../ViewingMode ./interfaces ./LayerClass ./OverlayContent ./OverlayRenderer ./PatchRenderData ./RenderOrder ./TerrainAttributesCache ./terrainUtils ./TileRenderer ./TileUpdate ./tileUtils ../webgl-engine/collections/Component/ComponentIntersectionData ../webgl-engine/core/shaderLibrary/ShaderOutput ../../../chunks/Terrain.glsl ../webgl-engine/core/shaderLibrary/terrain/TileBlendInput ../webgl-engine/effects/RenderPlugin ../webgl-engine/lib/Attribute ../webgl-engine/lib/basicInterfaces ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/Intersector ../webgl-engine/lib/IntersectorInterfaces ../webgl-engine/lib/Material ../webgl-engine/lib/RenderSlot ../webgl-engine/lib/screenSizePerspectiveUtils ../webgl-engine/lib/VertexAttribute ../webgl-engine/lib/verticalOffsetUtils ../webgl-engine/materials/DrawParameters ../webgl-engine/materials/internal/MaterialUtil ../webgl-engine/shaders/TerrainTechnique ../webgl-engine/shaders/TerrainTechniqueConfiguration ../../webgl/enums".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A,C,E,B,D,F,K,L,G,O,P,J,R,X,U,M,V,Y,W,H,S,I,Q,N,T,aa,Z){const da=p.create();b.TransparencyMode=void 0;(function(ea){ea[ea.Opaque=0]="Opaque";ea[ea.Semitransparent=1]="Semitransparent";ea[ea.TransparentWithDraped=2]="TransparentWithDraped";ea[ea.Empty=3]="Empty"})(b.TransparencyMode||(b.TransparencyMode={}));b.TerrainRenderer=class extends J.SyncPrepareRenderPlugin{get _isGlobal(){return this._stage.viewingMode===t.ViewingMode.Global}get _techniques(){return this._context.techniqueRepository}get _rctx(){return this._context.renderContext.rctx}constructor(ea,
ca,ia,la,oa){super({});this._overlayRenderer=ea;this._stage=ca;this._allTiles=ia;this._ellipsoidRadius=la;this.type=V.IntersectorType.TERRAIN;this.isGround=!0;this._tileSize=256;this._techniqueConfiguration=new aa.TerrainTechniqueConfiguration;this._passParameters=new O.TerrainPassParameters;this._renderDataPool=new k(A.PatchRenderData);this._visiblePatchesByOrigin=new Map;this._allPatchesByOrigin=new Map;this._patchSortingDirty=this._patchesByOriginDirty=!0;this._tileIterator=new K.IteratorPreorder;
this._transparencyState=b.TransparencyMode.Opaque;this._castShadows=!1;this._tileRenderer=this._emptyTex=null;this._stencilEnabledLayerExtents=[];this._numOriginsRendered=this._numTilesCulled=this._numTilesRendered=0;this.renderOccludedFlags=Y.RenderOccludedFlag.Occlude;this.produces=new Map([[W.RenderSlot.OPAQUE_TERRAIN,()=>this._produces()],[W.RenderSlot.TRANSPARENT_TERRAIN,()=>this._produces()],[W.RenderSlot.OCCLUDED_TERRAIN,()=>this._produces()]]);this._tileTextureCache=new n.MemCachePool((na,
ra)=>oa.newCache(na,ra),"TileTexture");this.tileGeometryCache=new E.TerrainAttributesCache(oa)}normalizeCtorArgs(){return{}}initialize(){this._stage.addRenderPlugin(this)}destroy(){this._stage.removeRenderPlugin(this);this._tileTextureCache.destroy();this.tileGeometryCache.destroy()}_produces(){return this.visible&&!!this._rootTiles&&!this.renderingDisabled}consumes(){return this._overlayRenderer.hasWater?J.ConsumesDepth:J.ConsumesNone}set renderingDisabled(ea){this._set("renderingDisabled",!!ea);
this.setDirty()}set visible(ea){this._set("visible",!!ea);this.setDirty()}set transparency(ea){this._transparencyState!==ea&&(this._techniqueConfiguration.invisible=ea===b.TransparencyMode.TransparentWithDraped||ea===b.TransparencyMode.Empty,this._transparencyState=ea,this.setNeedsRender())}get transparency(){return this._transparencyState}get renderPatchBorders(){return!!this._techniqueConfiguration.tileBorders}set renderPatchBorders(ea){this._techniqueConfiguration.tileBorders!==ea&&(this._techniqueConfiguration.tileBorders=
ea,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get visualizeNormals(){return!!this._techniqueConfiguration.visualizeNormals}set visualizeNormals(ea){this._techniqueConfiguration.visualizeNormals!==ea&&(this._techniqueConfiguration.visualizeNormals=ea,this.setNeedsRender(),this.notifyChange("visualizeNormals"))}get cullBackFaces(){return this._techniqueConfiguration.backfaceCullingEnabled}set cullBackFaces(ea){this._techniqueConfiguration.backfaceCullingEnabled!==ea&&(this._techniqueConfiguration.backfaceCullingEnabled=
ea,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(ea){this._set("renderOrder",ea);this._setSortingDirty()}get layerUid(){return I.terrainId}get slicePlaneEnabled(){return this._techniqueConfiguration.hasSlicePlane}set slicePlaneEnabled(ea){this._techniqueConfiguration.hasSlicePlane!==ea&&(this._techniqueConfiguration.hasSlicePlane=ea,this.setNeedsRender())}set textureFadingEnabled(ea){this._techniqueConfiguration.textureFadingEnabled!==ea&&(this._techniqueConfiguration.textureFadingEnabled=
ea,this.setNeedsRender())}set pbrMode(ea){this._techniqueConfiguration.pbrMode!==ea&&(this._techniqueConfiguration.pbrMode=ea,this.setNeedsRender())}setDebugScreenSizePerspective(ea){this._techniqueConfiguration.screenSizePerspective!==ea&&(this._techniqueConfiguration.screenSizePerspective=ea,this.setNeedsRender())}setRootTiles(ea){this._rootTiles=ea;this.setDirty()}setRenderOccludedOverlay(ea){this.renderOccludedFlags=ea?z.overlayRenderOccludedFlag:Y.RenderOccludedFlag.Occlude;this.setNeedsRender()}setStencilEnabledLayerExtents(ea){this._stencilEnabledLayerExtents=
ea;this._setSortingDirty()}setTileSize(ea){this._tileSize=ea;null!=this._tileRenderer&&(this._tileRenderer.tileSize=ea);this.setDirty()}_prepareTileForLoading(ea){ea.renderData||(ea.renderData=this._renderDataPool.acquire(),ea.renderData.init(ea),ea.renderData.localOrigin=this._getLocalOriginOfTile(ea))}loadTile(ea){this._prepareTileForLoading(ea);this.updateTileGeometryState(ea);this.updateTileTexture(ea,F.TileUpdate.TEXTURE_FADING)}updateTileTexture(ea,ca){null!=this._tileRenderer&&(this._tileRenderer.updateTileTexture(ea,
ca===F.TileUpdate.TEXTURE_FADING?r.TextureUpdate.FADING:r.TextureUpdate.UNFADED),this.setNeedsRender(),ea.resetPendingUpdate(ca))}updateTileGeometryState(ea){for(const ca of ea.layerInfo[u.LayerClass.ELEVATION])ca.pendingUpdates&=~F.TileUpdate.GEOMETRY;ea.resetPendingUpdate(F.TileUpdate.GEOMETRY);(ea=ea.renderData.updateGeometryState())&&this.setDirty();return ea}updateGeometryIfNeeded(ea){ea.isLoaded&&ea.renderData.updateGeometryIfNeeded(this._rctx)}unloadTile(ea){const ca=ea.renderData;ca&&(ca.releaseGeometry(),
this._renderDataPool.release(ca),ca.clear(),ea.renderData=null,ea.setMemoryDirty(),this.setDirty())}_getLocalOriginOfTile(ea){const ca=Math.max(0,7*Math.floor((ea.level-3)/7));if(this._isGlobal&&0===ca)return v.ZEROS;for(;ea.parent&&ea.level>ca;)ea=ea.parent;return ea.centerAtSeaLevel}getStats(){return{numTilesRendered:this._numTilesRendered,numTilesCulled:this._numTilesCulled,numOriginsRendered:this._numOriginsRendered}}set wireframe(ea){this._get("wireframe")!==ea&&(this._set("wireframe",ea),this.setNeedsRender())}setDirty(ea=
X.RenderRequestType.UPDATE){this._patchesByOriginDirty=!0;this._context.requestRender(ea)}_setSortingDirty(ea=X.RenderRequestType.UPDATE){this._patchSortingDirty=!0;this._context.requestRender(ea)}setNeedsRender(ea=X.RenderRequestType.UPDATE){this._context.requestRender(ea)}initializeRenderContext(ea){this._context=ea;this._tileRenderer=new D.TileRenderer(this._rctx,this._tileSize,this._techniques,this._tileTextureCache);this.updateTileBackground();this._emptyTex=U.createEmptyTexture(this._rctx)}uninitializeRenderContext(){this._emptyTex=
f.disposeMaybe(this._emptyTex);this._tileRenderer=f.disposeMaybe(this._tileRenderer)}intersect(ea,ca,ia,la){if(!(!this._rootTiles||ea.options.selectOpaqueTerrainOnly&&ea.options.selectionMode&&this.transparency!==b.TransparencyMode.Opaque)){var oa=fa,na=ka;w.subtract(oa,la,ia);w.set(na,1/oa[0],1/oa[1],1/oa[2]);var ra=ea.results.min,ta=ea.results.max,ma=ea.results.ground,pa=ea.options.store===V.StoreResults.MIN,ja=!!ea.results.ground.target,qa=I.getVerticalOffsetTerrain(ea.verticalOffset),ua=ea.tolerance,
wa,za=pa&&null!=ra.dist?ra.dist:Infinity,Aa=Da=>{var Ha=Da.renderData;if(Ha?.vao){var Ka=Ha.geometry;p.set(da,Ka.boundingBox);var La=Ha.localOrigin;null!=qa&&(qa.localOrigin=La,qa.applyToAabb(da));ha[0]=ia[0]-La[0];ha[1]=ia[1]-La[1];ha[2]=ia[2]-La[2];if(N.intersectAabbInvDirBefore(da,ha,na,ua,za)){var Na=(va,ya,Ea)=>{va.set(this.type,Da,ya,Ea,l.IDENTITY);za=pa&&null!=ra.dist?ra.dist:Infinity};Ha=(va,ya)=>{null!=ya&&0<=va&&(ea.options.backfacesTerrain||0>w.dot(ya,oa))&&(ea.options.invisibleTerrain||
!ea.options.selectionMode||null==ca||ca(ia,la,va))&&((null==ma.dist||va<ma.dist)&&Na(ma,va,ya),ea.options.isFiltered||(ea.options.store===V.StoreResults.ALL&&(null==wa?(wa=M.newIntersectorResult(ea.ray),Na(wa,va,ya),ea.results.all.push(wa)):va<wa.dist&&Na(wa,va,ya)),(null==ra.dist||va<ra.dist)&&Na(ra,va,ya),ea.options.store!==V.StoreResults.MIN&&(null==ta.dist||va>ta.dist)&&Na(ta,va,ya)))};var Ra=ba;w.subtract(Ra,la,La);La=Ka.indices;var Sa=Ka.vertexAttributes,sa=Sa.getField(S.VertexAttribute.POSITION,
h.BufferViewVec3f);Sa=new R.Vertices(sa.typedBuffer,3,Sa.stride/4);Ka=Ka.indexCount/3;!qa&&Ka>L.componentMinimalSizeForIntersectionData?(sa=Da.renderData,null==sa.intersectionData&&(sa.intersectionData=new L.ComponentIntersectionData(La,0,Ka,Sa)),sa.intersectionData.intersectRay({r0:ha,r1:Ra},Ha)):N.intersectTriangles(ha,Ra,0,Ka,La,Sa,null,qa,Ha)}}},Fa=this._rootTiles;null!=Fa&&(()=>{const Da=this._tileIterator;Da.reset(Fa);const Ha=ea.options.invisibleTerrain;for(let Ka=Da.next();Ka;Ka=Da.next())!(Ka.visible||
Ha&&Ka.intersectsClippingArea)||null==qa&&!Ka.intersectsRay(ia,oa,ua,za)||ja&&this._useStencilForTile(Ka)?Da.skipSubtree():Aa(Ka)})()}}processScaleRangeQueries(ea,ca){if(!ca.done)for(this._updatePatchGroups();ea.updating&&!ca.done;){ea.prepare();for(const ia of this._visiblePatchesByOrigin.values())for(const la of ia)null!=la.renderData?.textureReference&&ea.queriesForTile(la);ea.process();ca.madeProgress()}}prepareTechnique(ea){const ca=d("enable-feature:terrain-shadows")&&ea.bindParameters.shadowMap.enabled;
ca!==this._castShadows&&(this._castShadows=ca,this._patchesByOriginDirty=!0);if(ea.bindParameters.slot===W.RenderSlot.OCCLUDED_TERRAIN){if(0===(ea.renderOccludedMask&z.overlayRenderOccludedFlag))return null}else if(ea.bindParameters.slot!==(this.transparency===b.TransparencyMode.Opaque?W.RenderSlot.OPAQUE_TERRAIN:W.RenderSlot.TRANSPARENT_TERRAIN))return null;if(this.transparency===b.TransparencyMode.Empty)return null;switch(ea.output){case G.ShaderOutput.Color:return this._techniqueConfiguration.hasScreenSpaceReflections=
null!=ea.bindParameters.ssr.lastFrameColor,this._techniqueConfiguration.hasCloudsReflections=null!=ea.bindParameters.cloudsFade.data,this._techniqueConfiguration.receiveShadows=ea.bindParameters.shadowMap.ready,this._techniqueConfiguration.receiveAmbientOcclusion=null!=ea.bindParameters.ssao,this._techniqueConfiguration.overlayMode=this._overlayRenderer.mode,this._updateTechnique(G.ShaderOutput.Color,ea.bindParameters.slot===W.RenderSlot.OCCLUDED_TERRAIN);case G.ShaderOutput.Shadow:case G.ShaderOutput.ShadowExcludeHighlight:if(this._castShadows)return this._techniqueConfiguration.receiveShadows=
this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(G.ShaderOutput.Shadow,!1);break;case G.ShaderOutput.Depth:return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(G.ShaderOutput.Depth,!1);case G.ShaderOutput.Normal:return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(G.ShaderOutput.Normal,!1);case G.ShaderOutput.ObjectAndLayerIdColor:return this._updateTechnique(G.ShaderOutput.ObjectAndLayerIdColor,
!1);case G.ShaderOutput.Highlight:if(this._overlayRenderer.hasHighlights)return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(G.ShaderOutput.Highlight,!1)}return null}renderNode(ea,ca){this._updatePatchGroups();ca.useStencil=!1;switch(ea.output){case G.ShaderOutput.Color:this._renderMaterialPass(ea,ca,ea.bindParameters.slot===W.RenderSlot.OCCLUDED_TERRAIN?y.OverlayContent.Occluded:y.OverlayContent.Color);break;case G.ShaderOutput.Depth:case G.ShaderOutput.Normal:this._renderAuxiliaryPass(ea,
ca,y.OverlayContent.Color,this._visiblePatchesByOrigin);break;case G.ShaderOutput.Highlight:this._renderAuxiliaryPass(ea,ca,y.OverlayContent.Highlight,this._visiblePatchesByOrigin);break;case G.ShaderOutput.Shadow:case G.ShaderOutput.ShadowExcludeHighlight:this._renderAuxiliaryPass(ea,ca,null,this._allPatchesByOrigin);break;case G.ShaderOutput.ObjectAndLayerIdColor:this._renderAuxiliaryPass(ea,ca,y.OverlayContent.ObjectAndLayerIdColor,this._visiblePatchesByOrigin)}}updateTileBackground(ea){if(null!=
this._tileRenderer){var ca=this._tileRenderer;if(null!=ea){ea=c.toUnitRGBA(ea);var ia=v.fromValues(ea[0]||0,ea[1]||0,ea[2]||0)}ca.setBackground(ia);this._allTiles.forAll(la=>ca.updateTileTexture(la,r.TextureUpdate.FADING));this._techniqueConfiguration.tileBlendInput=ca.backgroundIsGrid?P.TileBlendInput.GridComposite:null!=ca.backgroundColor?P.TileBlendInput.ColorComposite:P.TileBlendInput.LayerOnly;this.setNeedsRender()}}_updatePatchGroups(){this._patchesByOriginDirty&&(this._rebuildPatchGroups(),
this._patchesByOriginDirty=!1,this._patchSortingDirty=!0);if(this._patchSortingDirty&&this.renderOrder!==C.RenderOrder.NONE){const ea=Array.from(this._visiblePatchesByOrigin.values()),ca=this._stencilEnabledLayerExtents;for(const ia of ea)K.sortTiles(this.renderOrder,ia,ca);ea.sort((ia,la)=>K.compareTiles(ia[0],la[0],this.renderOrder));this._visiblePatchesByOrigin=new Map(ea.map(ia=>[ia[0].renderData.localOrigin,ia]));this._patchSortingDirty=!1}}_rebuildPatchGroups(){const ea=this._rootTiles;if(null!=
ea){ea[0]?.surface.checkAllTilesWaterproofness();this._visiblePatchesByOrigin.clear();this._allPatchesByOrigin.clear();for(const ca of ea)this._rebuildPatchGroupsForRootTile(ca)}}_rebuildPatchGroupsForRootTile(ea){const ca=this._tileIterator;for(ca.resetOne(ea);!ca.done;){ea=ca.next();var ia=ea.renderData;if(ia){ia=ia.localOrigin;if(this._castShadows){var la=this._allPatchesByOrigin.get(ia);la||(la=[],this._allPatchesByOrigin.set(ia,la));la.push(ea)}ea.visible?(la=this._visiblePatchesByOrigin.get(ia),
la||(la=[],this._visiblePatchesByOrigin.set(ia,la)),la.push(ea),ca.skipSubtree()):(this._numTilesCulled++,ca.skipSubtree())}else this._numTilesCulled++}}_useStencilForTile(ea){for(const ca of this._stencilEnabledLayerExtents)if(ea.intersectsExtent(ca))return!0;return!1}_renderAuxiliaryPass(ea,ca,ia,la){const oa=ea.rctx;this._passParameters.overlayContent=ia;oa.bindTechnique(ca,this._passParameters,ea.bindParameters);const na=0<this._stencilEnabledLayerExtents.length;la.forEach(ra=>{ca.program.bindDraw(new Q.DrawParameters(ra[0].renderData.localOrigin),
ea.bindParameters,this._passParameters);for(let ta=0;ta<ra.length;ta++)this._renderPatch(ea,ca,ra[ta],Z.PrimitiveType.TRIANGLES,na,ia)});ea.rctx.bindVAO(null)}_renderMaterialPass(ea,ca,ia){var {rctx:la}=ea;this._passParameters.overlayContent=ia;la.bindTechnique(ca,this._passParameters,ea.bindParameters);this._numOriginsRendered=this._numTilesCulled=this._numTilesRendered=0;var oa=ea.bindParameters.camera;la=ca.program;this._techniqueConfiguration.screenSizePerspective&&this.pointsOfInterest&&H.getSettings(this._stage.viewingMode,
this._ellipsoidRadius).update({distance:this.pointsOfInterest.centerOnSurfaceFrequent.distance,fovY:oa.fovY});oa=0<this._stencilEnabledLayerExtents.length;const na=ia===y.OverlayContent.Occluded;na&&(la.bindTexture("tex",this._emptyTex),la.setUniform3fv("textureOpacities",v.ZEROS),la.setUniform4fv("texOffsetAndScale",x.ZEROS));var ra=null!=this._tileRenderer?.backgroundColor?this._tileRenderer.backgroundColor:v.ZEROS;this._techniqueConfiguration.tileBlendInput===P.TileBlendInput.ColorComposite&&la.setUniform3fv("backgroundColor",
ra);ra=this.wireframe?Z.PrimitiveType.LINES:Z.PrimitiveType.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&la.bindTexture("texNext",this._emptyTex);var ta=this._visiblePatchesByOrigin;for(const ma of ta.values()){ca.program.bindDraw(new Q.DrawParameters(ma[0].renderData.localOrigin),ea.bindParameters,this._passParameters);this._numOriginsRendered++;for(const pa of ma){ta=pa.renderData;const ja=ta.textureReference;if(null!=ja){if(!na){la.setUniform4fv("texOffsetAndScale",ja.offsetAndScale);
la.bindTexture("tex",ja.texture.texture);const qa=ta.textureFadeFactor,ua=1>qa?ta.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&null!=ua&&1>qa?(la.setUniform1f("fadeFactor",qa),la.setUniform4fv("nextTexOffsetAndScale",ua.offsetAndScale),la.setUniform3fv("nextTexOpacities",ua.opacities),la.bindTexture("texNext",ua.texture.texture)):la.setUniform1f("fadeFactor",1);ta.textureIsFading&&this.setNeedsRender();la.setUniform3fv("textureOpacities",ja.opacities)}this._renderPatch(ea,
ca,pa,ra,oa,ia);pa.renderOrder=this._numTilesRendered;this._numTilesRendered++}}}ea.rctx.bindVAO(null)}_renderPatch(ea,ca,ia,la,oa,na){const ra=ia.renderData,ta=ra.vao,ma=ta?.indexBuffer;if(null==ma)B.enableTerrainInternalChecks&&console.error("Rendered tile with no indices: ",ia.lij," : ",ra);else{var pa=ca.program;null==na||this._overlayRenderer.isEmpty||this._bindOverlayPatchData(pa,ra.overlay);oa&&(ca.useStencil=this._useStencilForTile(ia),ea.rctx.setPipelineState(ca.getPipeline()));ca=ra.geometry.indexCount;
ea.rctx.bindVAO(ta);pa.assertCompatibleVertexAttributeLocations(ta);ea.rctx.drawElements(la,ca,ma.indexType,0)}}_bindOverlayPatchData(ea,ca){ea.setUniform4fv("overlayTexOffset",ca.offsets);ea.setUniform4fv("overlayTexScale",ca.scales)}_updateTechnique(ea,ca){this._techniqueConfiguration.output=ea;this._techniqueConfiguration.renderOccluded=ca;return this._shaderTechnique=this._techniques.releaseAndAcquire(T.TerrainTechnique,this._techniqueConfiguration,this._shaderTechnique)}get test(){return{tileRenderer:this._tileRenderer}}};
a.__decorate([g.property({readOnly:!0})],b.TerrainRenderer.prototype,"_isGlobal",null);a.__decorate([g.property({value:!1})],b.TerrainRenderer.prototype,"renderingDisabled",null);a.__decorate([g.property({value:!0})],b.TerrainRenderer.prototype,"visible",null);a.__decorate([g.property()],b.TerrainRenderer.prototype,"renderPatchBorders",null);a.__decorate([g.property()],b.TerrainRenderer.prototype,"visualizeNormals",null);a.__decorate([g.property()],b.TerrainRenderer.prototype,"cullBackFaces",null);
a.__decorate([g.property({value:C.RenderOrder.FRONT_TO_BACK})],b.TerrainRenderer.prototype,"renderOrder",null);a.__decorate([g.property()],b.TerrainRenderer.prototype,"wireframe",null);b.TerrainRenderer=a.__decorate([m.subclass("esri.views.3d.terrain.TerrainRenderer")],b.TerrainRenderer);const fa=v.create(),ka=v.create(),ha=v.create(),ba=v.create();Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TerrainAttributesCache":function(){define(["exports","../../../core/MemCachePool",
"./TerrainAttributes"],function(b,a,c){class d{constructor(f){this._storage=new a.MemCachePool((n,k)=>f.newCache(n,k),"TileGeometry")}acquire(f){f=4*Math.ceil(f/4);const n=this._storage.pop(f.toString());if(n)return n;const k=c.terrainAttributesLayout.createBuffer(f);k.release=()=>this._release(k);return k}_release(f){this._storage.put(f.count.toString(),f)}clear(){this._storage.clear()}destroy(){this._storage.destroy()}}b.TerrainAttributesCache=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/terrain/TerrainAttributes":function(){define(["exports","../support/buffer/InterleavedLayout","../webgl-engine/lib/VertexAttribute"],function(b,a,c){a=a.newLayout().vec3f(c.VertexAttribute.POSITION).vec2i16(c.VertexAttribute.UV0).vec2i16(c.VertexAttribute.NORMALCOMPRESSED,{glNormalized:!0});b.terrainAttributesLayout=a;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TileRenderer":function(){define("exports ../../../core/maybe ../../../chunks/vec2 ../../../chunks/vec2f64 ../../../layers/support/layerUtils ../support/StreamDataLoader ./BlendLayersTechnique ./interfaces ./ITile ./LayerClass ./terrainUtils ./TextureFader ./TextureReference ./TileCompositor ./TileRenderInfo ./TileTexture ./TileUpdate ../webgl-engine/core/shaderLibrary/output/BlendOptions ../webgl-engine/core/shaderLibrary/terrain/TileBackground.glsl ../webgl-engine/lib/glUtil3D ../../webgl/enums ../../webgl/Texture ../../webgl/TextureDescriptor".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A){function C(J,R,X){G.layerIndex=R;G.vtlNeighborInfos.clear();const U=J.layerInfo[e.LayerClass.MAP][R];c.set(G.offset,0,0);G.tile=J;G.scale=1;G.sourceLod=J.lij;G.sourceLayerInfo=U;G.isVTLBackground=X;if(U.data)return X&&J.forEachLoadedNeighbor((V,Y)=>{if(V.level===J.level){var W=V.layerInfo[e.LayerClass.MAP][R];if(m.isVectorTilePerLayerInfo(W)&&U.data!==W.data){var H=G.vtlNeighborInfos.pushNew();H.offset=P[Y];H.sourceLod=V.lij;H.sourceLayerInfo=
W}}}),G;const M=U.upsampleInfo;return M?(X=M.tile.layerInfo[e.LayerClass.MAP][R],G.tile=M.tile,c.copy(G.offset,M.offset),G.scale=M.scale,G.sourceLod=M.tile.lij,G.sourceLayerInfo=X,G):X?G:null}function E(J){let R="normal"!==J.blendMode;f.isGroupLayer(J.parent)&&(R=E(J.parent)||R);return R}function B(J,R){f.isGroupLayer(J.parent)&&B(J.parent,R);const X=J.uid;if(null!=X&&""!==X){const U=K.get(X);U?U.start=R:K.set(X,new D(R,R,J.blendMode,J.opacity,r.BlendLayersOutput.Composite,1))}}class D{constructor(J,
R,X,U,M,V){this.start=J;this.end=R;this.blendMode=X;this.opacity=U;this.output=M;this.baseOpacity=V}}class F{constructor(J,R,X,U){this._rctx=J;this.tileSize=R;this._techniques=X;this._cache=U;this._passParameters=new k.BlendLayersPassParameters;this._backgroundColor=this._backgroundTexture=null;this._backgroundDirty=!1;this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy;this._composition=new v.TileCompositor(this._rctx,this._techniques);this._ensureBackgroundTexture(this.tileSize)}dispose(){this._composition=
a.disposeMaybe(this._composition);this._backgroundTexture=a.releaseMaybe(this._backgroundTexture)}get backgroundIsGrid(){return null==this._backgroundColor}get backgroundColor(){return this._backgroundColor}updateTileTexture(J,R){if(J.renderData){var X=J.surface,U=X.baseOpacity,M=0,V=0,Y=this.tileSize,W=!1,H=!1,S=X.view.state.contentPixelRatio,I=!1;K.clear();L.length=0;for(var Q=J.layerInfo[e.LayerClass.MAP],N=0,T=null;N<Q.length;N++){const fa=X.layerViewByIndex(N,e.LayerClass.MAP);var aa=fa.layer.opacity;
const ka=fa.fullOpacity;H=H||f.isBaseLayer(fa.layer);if(m.isBlendableLayerView(fa)){var Z="normal"!==fa.layer.blendMode;if(f.isGroupLayer(fa.layer.parent)){var da=fa.layer.parent.uid;null!=da&&""!==da&&(Z=E(fa.layer.parent)||Z)}Z&&(I=Z,W=!1)}if(0!==aa||I){if(++V,aa=m.isVectorTileLayerView(fa),Z=C(J,N,aa))Q[N].pendingUpdates&=~(h.TileUpdate.TEXTURE_NOFADING&h.TileUpdate.TEXTURE_FADING),f.isGroupLayer(fa.layer.parent)&&(da=fa.layer.parent.uid,null!=da&&""!==da&&B(fa.layer.parent,N)),aa?Y=Math.max(Y,
this.tileSize*S):1===U&&1===ka&&(fa.isOpaque||this._dataToTexture(Z)&&Z.sourceLayerInfo.data.descriptor.isOpaque)&&(W=!0),++M,null===T&&(T=N)}else Q[N].pendingUpdates&=~(h.TileUpdate.TEXTURE_NOFADING&h.TileUpdate.TEXTURE_FADING)}X=Y/this.tileSize;0===M||null===T?this._useBackgroundTexture(J,V):(1!==M||I||!this._useLayerTexture(J,T))&&this._composeMapLayers(J,R,N-1,H,Y,X,!W||I,K,I)}}_ensureBackgroundTexture(J){null==this._backgroundTexture&&(this._backgroundTexture=this._buildTexture(J,!1),this._backgroundDirty=
!0);this._backgroundDirty&&(this._composition.bind(J),this._passParameters.offset=d.ZEROS,this._passParameters.scale=1,this._passParameters.opacity=1,this.backgroundColor&&(this._passParameters.backgroundColor=this.backgroundColor),this._composition.drawBackground(this._passParameters,null!=this.backgroundColor),this._composition.copyFBOToTexture(this._backgroundTexture),this._composition.unbind(),this._backgroundDirty=!1);return this._backgroundTexture}_useBackgroundTexture(J,R){const X=this._ensureBackgroundTexture(this.tileSize);
let U=l.ActivationTime.Immediate;if(J.surface.view.layerViewManager.updating||0<R)U=l.ActivationTime.Delayed;R=J.renderData;null==R.textureReference&&(U=l.ActivationTime.Immediate);R.setTextureReference(new w.TextureReference(X,g.TextureUpdate.FADING,O,J.surface.baseOpacity,0,1),U)}_useLayerTexture(J,R){var X=J.surface.layerViewByIndex(R,e.LayerClass.MAP),U=f.isBaseLayer(X.layer);const M=U?J.surface.baseOpacity:1;U=U?1:J.surface.baseOpacity;X=X.fullOpacity;R=C(J,R,!1);return this._dataToTexture(R)?
(J.renderData.setTextureReference(new w.TextureReference(R.sourceLayerInfo.data,g.TextureUpdate.FADING,R,M,U,X)),!0):!1}_composeMapLayers(J,R,X,U,M,V,Y,W,H){this._composition.ensureBuffer(M);const S=J.surface.baseOpacity;let I=!1,Q=y.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,N=!1,T=0;for(let fa=X;0<=fa;fa--){X=J.surface.layerViewByIndex(fa,e.LayerClass.MAP);var aa=m.isVectorTileLayerView(X);aa=C(J,fa,aa);const ka=X.layer.opacity;if(!aa||0===ka&&!H)continue;const ha=!f.isBaseLayer(X.layer)&&!I;ha&&
(I=!0);let ba=!1;W.forEach(ca=>{ca.start===fa&&(ca.output=U?r.BlendLayersOutput.Composite:Y&&ha?this.backgroundIsGrid?r.BlendLayersOutput.GridComposite:r.BlendLayersOutput.ColorComposite:r.BlendLayersOutput.Composite,ca.baseOpacity=ha?S:1,L.push(ca),this._composition.openGroup(M),ba=!0)});this._passParameters.baseOpacity=ha&&!ba&&1>S?S:1;const ea=1>this._passParameters.baseOpacity?r.BaseOpacityMode.Required:r.BaseOpacityMode.NotRequired;var Z=0===T;Z=ba?r.BlendLayersOutput.GroupBackgroundComposite:
Y&&Z?this.backgroundIsGrid?r.BlendLayersOutput.GridComposite:r.BlendLayersOutput.ColorComposite:r.BlendLayersOutput.Composite;X=t.blendModeFromString[m.isBlendableLayerView(X)?X.layer.blendMode:"normal"];this._passParameters.opacity=ka;m.isVectorTileRenderInfo(aa)?N=this._composition.drawVectorData(this._passParameters,Z,M,X,ea,aa,V,this.tileSize,N):m.isImageryTileRenderInfo(aa)?(this._composition.drawImageryTileData(this._passParameters,Z,M,X,ea,aa),this._hasNearestInterpolation(aa)&&(Q=y.TextureSamplingMode.NEAREST)):
this._dataToTexture(aa)&&(this._passParameters.texture=aa.sourceLayerInfo.data.texture,this._passParameters.offset=aa.offset,this._passParameters.scale=aa.scale,this._composition.drawRasterData(this._passParameters,Z,M,X,ea));for(;0<L.length&&L[L.length-1].end===fa;)X=L.pop(),this._passParameters.baseOpacity=X.baseOpacity,aa=1>this._passParameters.baseOpacity?r.BaseOpacityMode.Required:r.BaseOpacityMode.NotRequired,this._passParameters.opacity=X.opacity,this._passParameters.offset=d.ZEROS,this._passParameters.scale=
1,this._composition.drawGroup(this._passParameters,X.output,M,t.blendModeFromString[X.blendMode],aa);T++}J=J.renderData;const da=H||I&&1>S;H=J.ensureTexture(M,da,()=>this._buildTexture(M,da,Q));this._composition.copyFBOToTexture(H);this._composition.unbind();J.setTextureReference(new w.TextureReference(H,R,O,I?1:S,0,1))}_hasNearestInterpolation(J){J=J.sourceLayerInfo.data;return J.source?"nearest"===J.interpolation:!1}_dataToTexture(J){if(m.isRasterTileRenderInfo(J)){const R=J.sourceLayerInfo;R.data=
this._buildTexture(R.data,!0);J.tile.setMemoryDirty()}return m.isTextureTileRenderInfo(J)}setBackground(J){this._backgroundColor!==J&&(this._backgroundColor=J,this._backgroundDirty=!0)}_buildTexture(J,R,X=y.TextureSamplingMode.LINEAR_MIPMAP_LINEAR){if(null==J)return null;const U=new A.TextureDescriptor;U.wrapMode=y.TextureWrapMode.CLAMP_TO_EDGE;U.samplingMode=X;U.maxAnisotropy=this._maxAnisotropy;U.preMultiplyAlpha=!0;U.flipped=!0;U.hasMipmap=!0;R||(U.pixelFormat=y.PixelFormat.RGB);R=this._rctx;let M;
if("number"===typeof J)U.width=U.height=J,(M=this._cache.pop(`${J} ${U.pixelFormat}`))?M.retain():M=new p(new z.Texture(R,U),this._cache);else if(n.isImageWithType(J))U.isOpaque=J.isOpaque,U.isOpaque&&(U.pixelFormat=y.PixelFormat.RGB),(M=this._cache.pop(`${J} ${U.pixelFormat}`))?(M.retain(),M.texture.setData(J.image)):M=new p(new z.Texture(R,U,J.image),this._cache),J.release();else try{U.width=J.width,U.height=J.height,M=new p(new z.Texture(R,U,J))}catch(V){M=new p(u.createEmptyTexture(R)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}J=
R.bindTexture(M.texture,z.Texture.TEXTURE_UNIT_FOR_UPDATES);M.generateMipmap();R.bindTexture(J,z.Texture.TEXTURE_UNIT_FOR_UPDATES);return M}get test(){return{backgroundTexture:this._backgroundTexture}}}const K=new Map,L=[],G=new x.TileRenderInfo,O={offset:[0,0],scale:1},P=[];P[q.NeighborIndex.NORTH]=[0,-1];P[q.NeighborIndex.NORTH_EAST]=[-1,-1];P[q.NeighborIndex.EAST]=[-1,0];P[q.NeighborIndex.SOUTH_EAST]=[-1,1];P[q.NeighborIndex.SOUTH]=[0,1];P[q.NeighborIndex.SOUTH_WEST]=[1,1];P[q.NeighborIndex.WEST]=
[1,0];P[q.NeighborIndex.NORTH_WEST]=[1,-1];b.GroupInfo=D;b.TileRenderer=F;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/BlendLayersTechnique":function(){define("require exports ../../../chunks/tslib.es6 ../../../chunks/vec3f64 ./TileBlendTechniqueConfiguration ../webgl-engine/core/shaderLibrary/terrain/TileComposite.glsl ../../../chunks/BlendLayers.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v){class x extends n.TileCompositePassParameters{constructor(){super(...arguments);this.baseOpacity=this.opacity=1;this.fboTexture=this.texture=null;this.backgroundColor=d.ZEROS}}class p extends q.ShaderTechnique{initializeProgram(t){return new l.Program(t.rctx,p.shader.get().build(this.configuration),m.Default3D)}initializePipeline(){return v.makePipelineState({blending:v.simpleBlendingParams(w.BlendFactor.ONE,w.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:v.defaultColorWriteParams})}}
p.shader=new g.ReloadableShaderModule(k.BlendLayers,()=>new Promise((t,r)=>b(["../webgl-engine/core/shaderLibrary/util/BlendLayers.glsl"],t,r)));class h extends f.TileBlendTechniqueConfiguration{constructor(){super(...arguments);this.background=k.BackgroundMode.BelowLayer}}c.__decorate([e.parameter()],h.prototype,"background",void 0);a.BlendLayersPassParameters=x;a.BlendLayersTechnique=p;a.BlendLayersTechniqueConfiguration=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TileBlendTechniqueConfiguration":function(){define(["exports",
"../../../chunks/tslib.es6","./BlendModeTechniqueConfiguration","../webgl-engine/core/shaderLibrary/terrain/TileBackground.glsl","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],function(b,a,c,d,f){class n extends c.BlendModeTechniqueConfiguration{constructor(){super(...arguments);this.output=d.BlendLayersOutput.Composite;this.baseOpacityMode=d.BaseOpacityMode.NotRequired;this.premultipliedSource=d.PremultipliedAlphaSource.Off}}a.__decorate([f.parameter({count:d.BlendLayersOutput.COUNT})],
n.prototype,"output",void 0);a.__decorate([f.parameter({count:d.BaseOpacityMode.COUNT})],n.prototype,"baseOpacityMode",void 0);a.__decorate([f.parameter()],n.prototype,"premultipliedSource",void 0);b.TileBlendTechniqueConfiguration=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/BlendModeTechniqueConfiguration":function(){define(["exports","../../../chunks/tslib.es6","../webgl-engine/core/shaderLibrary/output/BlendOptions","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],
function(b,a,c,d){class f extends d.ShaderTechniqueConfiguration{constructor(){super(...arguments);this.blendMode=c.LayerBlendMode.Normal}}a.__decorate([d.parameter({count:c.LayerBlendMode.COUNT})],f.prototype,"blendMode",void 0);b.BlendModeTechniqueConfiguration=f;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/BlendLayers.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/terrain/BackgroundGrid.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/TileBackground.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/TileComposite.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(b,a,c,d,f,n,k,g,q){function e(l){const w=new g.ShaderBuilder;w.include(d.TileComposite);if(l.background===b.BackgroundMode.Only)return(l=l.output===c.BlendLayersOutput.ColorComposite)?w.fragment.uniforms.add(new f.Float3PassUniform("backgroundColor",v=>v.backgroundColor)):w.fragment.include(a.BackgroundGrid),w.fragment.code.add(k.glsl`
    void main() {
      fragColor = vec4(${l?k.glsl`backgroundColor`:k.glsl`gridColor(uv)`}, 1.0);
    }
  `),w;w.include(c.TileBackground,l);w.fragment.uniforms.add(new q.Texture2DPassUniform("tex",v=>v.texture));w.fragment.uniforms.add(new n.FloatPassUniform("opacity",v=>v.opacity));w.fragment.code.add(k.glsl`void main() {
vec4 bgColor = getBackground(uv);
fragColor = blendLayers(bgColor, texture(tex, uv), opacity);
}`);return w}b.BackgroundMode=void 0;(function(l){l[l.BelowLayer=0]="BelowLayer";l[l.Only=1]="Only";l[l.COUNT=2]="COUNT"})(b.BackgroundMode||(b.BackgroundMode={}));const m=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return b.BackgroundMode},build:e},Symbol.toStringTag,{value:"Module"}));b.BlendLayers=m;b.build=e})},"esri/views/3d/terrain/TextureReference":function(){define(["exports","../../../chunks/vec3f64","../../../chunks/vec4f64"],function(b,a,c){class d{constructor(f,
n,k,g,q,e){this.texture=f;this.type=n;f.retain();this.offsetAndScale=c.fromValues(k.offset[0],k.offset[1],k.scale,k.scale);this.opacities=a.fromValues(g,q,e)}destroy(){this.texture.release()}}b.TextureReference=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TileCompositor":function(){define("exports ../../../core/Logger ../../../core/maybe ../../../chunks/vec2f64 ../../2d/engine/imagery/enums ../../2d/engine/vectorTiles/VectorTileRendererHelper3D ./BlendLayersTechnique ./LayerClass ./RasterColorizerTechnique ./support/MultiSizeFramebuffer ../webgl-engine/core/shaderLibrary/output/BlendOptions ../webgl-engine/core/shaderLibrary/terrain/TileBackground.glsl ../../../chunks/BlendLayers.glsl ../webgl-engine/lib/BindParameters ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../../webgl/enums ../../webgl/Texture ../../webgl/Util".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r){const u=a.getLogger("esri.views.3d.terrain");class y{constructor(z,A){this._rctx=z;this._techniqueRepository=A;this._fbos=[];this._vectorTileHelper=new n.VectorTileRendererHelper3D;this._bindParameters=new v.BindParameters(null,null);this._blendLayersTechniqueConfig=new k.BlendLayersTechniqueConfiguration;this._current=0;this._lastUsedIds=[];this._lastCreatedBufferId=0;this._onHoldIds=[];this._vaoQuad=p.createQuadVAO(this._rctx,x.Pos2Tex)}dispose(){this._fbos.forEach(c.disposeMaybe);
this._fbos=null;this._vtFBO=c.disposeMaybe(this._vtFBO);this._vaoQuad=c.disposeMaybe(this._vaoQuad);this._vectorTileHelper=c.disposeMaybe(this._vectorTileHelper);this._backgroundTechnique=c.releaseMaybe(this._backgroundTechnique);this._applyOpacityTechnique=c.releaseMaybe(this._applyOpacityTechnique);this._blendLayersTechnique=c.releaseMaybe(this._blendLayersTechnique)}_getBlendLayersTechnique(z,A,C,E=l.PremultipliedAlphaSource.Off,B=w.BackgroundMode.BelowLayer){this._blendLayersTechniqueConfig.output=
A;this._blendLayersTechniqueConfig.blendMode=z;this._blendLayersTechniqueConfig.baseOpacityMode=C;this._blendLayersTechniqueConfig.premultipliedSource=E;this._blendLayersTechniqueConfig.background=B;return this._blendLayersTechnique=this._techniqueRepository.releaseAndAcquire(k.BlendLayersTechnique,this._blendLayersTechniqueConfig,this._blendLayersTechnique)}drawBackground(z,A){A=this._getBlendLayersTechnique(m.LayerBlendMode.Normal,A?l.BlendLayersOutput.ColorComposite:l.BlendLayersOutput.GridComposite,
l.BaseOpacityMode.NotRequired,l.PremultipliedAlphaSource.Off,w.BackgroundMode.Only);z=this._rctx.bindTechnique(A,z,this._bindParameters);this._render(z)}_render(z){this._rctx.bindVAO(this._vaoQuad);z.assertCompatibleVertexAttributeLocations(this._vaoQuad);this._rctx.drawArrays(h.PrimitiveType.TRIANGLE_STRIP,0,r.vertexCount(this._vaoQuad,"geometry"))}drawGroup(z,A,C,E,B,D=l.PremultipliedAlphaSource.On){A===l.BlendLayersOutput.Composite&&(z.fboTexture=this._fbos[this.getLastOnHoldId()].get(C).colorTexture);
z.texture=this.currentFBO(C).colorTexture;this.closeGroup(C);A=this._getBlendLayersTechnique(E,A,B,D);z=this._rctx.bindTechnique(A,z,this._bindParameters);this._render(z)}drawRasterData(z,A,C,E,B,D=l.PremultipliedAlphaSource.Off){null!=z.texture&&(z.fboTexture=A===l.BlendLayersOutput.GroupBackgroundComposite||E===m.LayerBlendMode.Normal&&B===l.BaseOpacityMode.NotRequired&&D===l.PremultipliedAlphaSource.Off?null:this.switch(C).colorTexture,A=this._getBlendLayersTechnique(E,A,B,D),z=this._rctx.bindTechnique(A,
z,this._bindParameters),this._render(z))}drawImageryTileData(z,A,C,E,B,D){var F=D.sourceLayerInfo.data;F.source&&(D.tile.surface.layerViewByIndex(D.layerIndex,g.LayerClass.MAP).ensureSymbolizerParameters(F),F.bind(this._rctx)&&(z.fboTexture=E===m.LayerBlendMode.Normal&&B===l.BaseOpacityMode.NotRequired?null:this.switch(C).colorTexture,A=this._getRasterColorizerTechnique(F,A,E,B),F.opacity=z.opacity,F=F.getUniforms(),F.scale=D.scale,F.offset=D.offset,F.backgroundColor=z.backgroundColor,F.fboTexture=
z.fboTexture,F.baseOpacity=z.baseOpacity,z=this._rctx.bindTechnique(A,F,null),this._render(z)))}_getRasterColorizerTechnique(z,A,C,E){const B=z.symbolizerParameters,D=["stretch","lut","hillshade"].indexOf(B.type);null==this._rasterColorizerConfig&&(this._rasterColorizerConfig=new q.RasterColorizerTechniqueConfiguration,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float"));this._rasterColorizerConfig.output=A;this._rasterColorizerConfig.blendMode=C;
this._rasterColorizerConfig.baseOpacityMode=E;this._rasterColorizerConfig.colorizerType=D;this._rasterColorizerConfig.applyColormap=!!B.colormap;this._rasterColorizerConfig.requireBilinearWithNN=z.isBilinearWithStretchColorRamp;this._rasterColorizerConfig.stretchType=z.hasStretchTypeNone()?f.RasterColorizerStretchType.Noop:f.RasterColorizerStretchType.PerBand;return this._rasterColorizerTechnique=this._techniqueRepository.releaseAndAcquire(q.RasterColorizerTechnique,this._rasterColorizerConfig,this._rasterColorizerTechnique)}drawVectorData(z,
A,C,E,B,D,F,K,L){const G=this._rctx,O=D.sourceLayerInfo.data,P=D.tile.surface.layerViewByIndex(D.layerIndex,g.LayerClass.MAP),J=B===l.BaseOpacityMode.Required||1>z.opacity||E!==m.LayerBlendMode.Normal||A!==l.BlendLayersOutput.Composite,R=J?l.PremultipliedAlphaSource.On:l.PremultipliedAlphaSource.Off;var X=this._getBlendLayersTechnique(E,A,B,R);G.setPipelineState(X.getPipeline());let U=X=null;J?(U=this.currentFBO(C),null==this._vtFBO&&(this._vtFBO=new e.MultiSizeFramebuffer(this._rctx)),X=this._vtFBO.get(C),
G.bindFramebuffer(X),this._clearCurrentFBO()):L&&G.clearSafe(h.ClearBufferBit.DEPTH_BUFFER_BIT);try{this._vectorTileHelper.renderBackground(G,D.sourceLod,P.painter,P.layer.styleRepository,P.schemaHelper,Math.round(1/D.scale),D.offset,K,F,P.contentZoom),O&&this._vectorTileHelper.renderContent(G,D.sourceLod,O,D.vtlNeighborInfos,P.painter,P.layer.styleRepository,P.schemaHelper,Math.round(1/D.scale),D.offset,K,F,P.contentZoom)}catch(M){u.warnOnce("A render call containing vector tiles did not resolve correctly.",
M)}return null!=X?(G.bindFramebuffer(U),z.texture=X.colorTexture,z.offset=d.ZEROS,z.scale=1,this.drawRasterData(z,A,C,E,B,R),L):!0}copyFBOToTexture(z){const A=this._rctx,C=A.bindTexture(z.texture,t.Texture.TEXTURE_UNIT_FOR_UPDATES),E=z.descriptor;A.gl.copyTexImage2D(h.TextureType.TEXTURE_2D,0,E.pixelFormat,0,0,E.width,E.height,0);z.generateMipmap();A.bindTexture(C,t.Texture.TEXTURE_UNIT_FOR_UPDATES)}_clearCurrentFBO(){this._rctx.setStencilWriteMask(255);this._rctx.setClearColor(0,0,0,0);this._rctx.setClearDepth(1);
this._rctx.setClearStencil(0);this._rctx.clearSafe(h.ClearBufferBit.COLOR_BUFFER_BIT|h.ClearBufferBit.DEPTH_BUFFER_BIT|h.ClearBufferBit.STENCIL_BUFFER_BIT)}_initFBO(z,A,C){this._rctx.bindFramebuffer(z);C&&(this._rctx.setViewport(0,0,A,A),this._clearCurrentFBO())}ensureBuffer(z){this._lastUsedIds.length=0;this._lastUsedIds.push(1);this._lastCreatedBufferId=1;this._onHoldIds.length=0;this.bind(z)}bind(z,A=0,C=!0){this._current=A;if(A>=this._fbos.length)for(let E=this._fbos.length;E<=A;E++)this._fbos.push(new e.MultiSizeFramebuffer(this._rctx));
this._initFBO(this._fbos[A].get(z),z,C)}_bindNextFreeBuffer(z){0<this._lastUsedIds.length?this.bind(z,this._lastUsedIds.pop()):(this._lastCreatedBufferId++,this.bind(z,this._lastCreatedBufferId))}openGroup(z){this._onHoldIds.push(this._current);this._bindNextFreeBuffer(z)}switch(z){const A=this.currentFBO(z),C=this._current;this._bindNextFreeBuffer(z);this._lastUsedIds.push(C);return A}getLastOnHoldId(){return this._onHoldIds[this._onHoldIds.length-1]}closeGroup(z){const A=this._current;this._bindNextFreeBuffer(z);
this._lastUsedIds.push(A);this._lastUsedIds.push(this._onHoldIds.pop())}unbind(){this._rctx.bindFramebuffer(null)}currentFBO(z){return this._fbos[this._current].get(z)}}b.TileCompositor=y;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/VectorTileRendererHelper3D":function(){define("exports ../../../../geometry ../../../../Viewpoint ../../tiling/TileInfoView ../../tiling/TileKey ../../tiling/TileQueue ../../tiling/TileStrategy ../../ViewState ./style/StyleDefinition ../webgl/RenderableTile ../../../webgl/enums ../../../../geometry/Point".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l){class w{constructor(){this._renderParams={context:null,drawPhase:1,state:new g({viewpoint:new c({targetGeometry:new l(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,allowDelayedRender:!1,deltaTime:-1,timeline:null,time:0,hasClipping:!1,
blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1,highlightGradient:null,stencilSymbols:!0,is3D:!0,backgroundColor:null};this._backgroundTile=new e.RenderableTile(new f(0,0,0,0),0,0,0,512,512,4096,4096)}dispose(){this._renderParams=null}renderBackground(v,x,p,h,t,r,u,y,z,A){const C=this._backgroundTile;this._updateRenderParams(v,x,C,p,t,r,u,y,z,A);this._renderParams.stencilSymbols=!1;p.drawBackground(this._renderParams,C,h)}renderContent(v,x,p,h,t,r,u,y,z,A,C,E){this._stencilSymbols(v,
x,p,h,t,r,u,Math.round(1/y),z,A,C,E);let B=1;p.stencilRef=B++;v.setStencilFunction(m.CompareFunction.EQUAL,p.stencilRef,255);this._render(v,x,p,t,r,u,y,z,A,C,E);h.forAll(D=>{D.sourceLayerInfo.data.stencilRef=B++;this._renderSymbols(v,D.sourceLod,D.sourceLayerInfo.data,t,r,u,Math.round(1/y),D.offset,A,C,E)})}_stencilSymbols(v,x,p,h,t,r,u,y,z,A,C,E){let B=1;p.stencilRef=B++;v.setDepthTestEnabled(!1);v.setDepthWriteEnabled(!1);v.setStencilTestEnabled(!0);v.setBlendingEnabled(!1);v.setColorMask(!1,!1,
!1,!1);v.setStencilOp(m.StencilOperation.KEEP,m.StencilOperation.KEEP,m.StencilOperation.REPLACE);v.setStencilWriteMask(255);v.setStencilFunction(m.CompareFunction.ALWAYS,p.stencilRef,255);this._stencilTileSymbols(v,x,p,t,r,u,y,z,A,C,E);for(const D of h.toArray()){const {sourceLod:F,offset:K,sourceLayerInfo:L}=D;L.data.stencilRef=B++;v.setStencilFunction(m.CompareFunction.ALWAYS,L.data.stencilRef,255);this._stencilTileSymbols(v,F,L.data,t,r,u,y,K,A,C,E)}v.setStencilWriteMask(0);v.setBlendingEnabled(!0);
v.setDepthTestEnabled(!0);v.setColorMask(!0,!0,!0,!0)}_renderSymbols(v,x,p,h,t,r,u,y,z,A,C){v.setStencilFunction(m.CompareFunction.EQUAL,p.stencilRef,255);this._render(v,x,p,h,t,r,u,y,z,A,C,q.StyleLayerType.SYMBOL)}_render(v,x,p,h,t,r,u,y,z,A,C,E){this._updateRenderParams(v,x,p,h,r,u,y,z,A,C);this._renderParams.stencilSymbols=!1;h.drawTile(this._renderParams,p,t,E)}_stencilTileSymbols(v,x,p,h,t,r,u,y,z,A,C){this._updateRenderParams(v,x,p,h,r,u,y,z,A,C);this._renderParams.stencilSymbols=!0;p.triangleCount=
0;h.drawSymbols(this._renderParams,p,t)}_updateRenderParams(v,x,p,h,t,r,u,y,z,A){"type"in p&&"vector-tile"===p.type&&!p.stage&&p.attachWithContext(v);const C=x[0]-t.getLevelShift(x[0]),E=this._renderParams;E.context=v;E.painter=h;E.glyphMosaic=h.glyphMosaic;E.spriteMosaic=h.spriteMosaic;E.pixelRatio=z*A;E.displayLevel=C;E.requiredLevel=C;v=t.getScale(x[0]);const [B,D]=t.getOffset(x,r*v);x=.125*r*v/y;p=p.transforms.dvs;p[0]=x;p[4]=-x;p[6]=-1-B-u[0]*r*2;p[7]=1+D+(1-u[1])*r*2-2;E.state.size[0]=y/A;E.state.size[1]=
y/A;E.state.pixelRatio=A}}b.VectorTileRendererHelper3D=w;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/tiling/TileInfoView":function(){define(["../../../geometry/support/spatialReferenceUtils","./LODInfo","./TileCoverage","./TileKey","./TileSpan"],function(b,a,c,d,f){const n=new d("0/0/0/0");class k{static create(e,m){e[1]>m[1]&&([e,m]=[m,e]);const [l,w]=e,[v,x]=m;e=v-l;m=x-w;m=0!==m?e/m:0;const p=(Math.ceil(w)-w)*m,h=(Math.floor(w)-w)*m;return new k(l,Math.floor(w),
Math.ceil(x),m,0>e?p:h,0>e?h:p,0>e?v:l,0>e?l:v)}constructor(e,m,l,w,v,x,p,h){this.x=e;this.ymin=m;this.ymax=l;this.invM=w;this.leftAdjust=v;this.rightAdjust=x;this.leftBound=p;this.rightBound=h}incrRow(){this.x+=this.invM}getLeftCol(){return Math.max(this.x+this.leftAdjust,this.leftBound)}getRightCol(){return Math.min(this.x+this.rightAdjust,this.rightBound)}}const g=[[0,0],[0,0],[0,0],[0,0]];class q{constructor(e,m=null,l=e.lods[0].level,w=e.lods[e.lods.length-1].level){this.tileInfo=e;this.fullExtent=
m;this.scales=[];this._infoByScale={};this._infoByLevel={};const v=e.lods.filter(p=>p.level>=l&&p.level<=w);this.minScale=v[0].scale;this.maxScale=v[v.length-1].scale;const x=this._lodInfos=v.map(p=>a.create(e,p,m));v.forEach((p,h)=>{this._infoByLevel[p.level]=x[h];this._infoByScale[p.scale]=x[h];this.scales[h]=p.scale},this);this._wrap=e.isWrappable}get spatialReference(){return this.tileInfo.spatialReference}getLODInfoAt(e){return this._infoByLevel["number"===typeof e?e:e.level]}getTileBounds(e,
m,l=!1){n.set(m);return(m=this._infoByLevel[n.level])?m.getTileBounds(e,n,l):e}getTileCoords(e,m,l=!1){n.set(m);return(m=this._infoByLevel[n.level])?m.getTileCoords(e,n,l):e}getTileCoverage(e,m=192,l=!0,w="closest"){if(!l&&(e.scale>this.minScale||e.scale<this.maxScale))return null;l="closest"===w?this.getClosestInfoForScale(e.scale):this.getSmallestInfoForScale(e.scale);w=c.pool.acquire(l);const v=this._wrap;var x=Infinity;let p=-Infinity;const h=w.spans;g[0][0]=g[0][1]=g[1][1]=g[3][0]=-m;g[1][0]=
g[2][0]=e.size[0]+m;g[2][1]=g[3][1]=e.size[1]+m;for(t of g)e.toMap(t,t),t[0]=l.getColumnForX(t[0]),t[1]=l.getRowForY(t[1]);e=[];var t=3;for(m=0;4>m;m++)g[m][1]===g[t][1]?t=m:(t=k.create(g[m],g[t]),x=Math.min(t.ymin,x),p=Math.max(t.ymax,p),void 0===e[t.ymin]&&(e[t.ymin]=[]),e[t.ymin].push(t),t=m);if(null==x||null==p||100<p-x)return null;for(m=[];x<p;){null!=e[x]&&(m=m.concat(e[x]));t=Infinity;var r=-Infinity;for(var u=m.length-1;0<=u;u--){var y=m[u];t=Math.min(t,y.getLeftCol());r=Math.max(r,y.getRightCol())}t=
Math.floor(t);r=Math.floor(r);if(x>=l.first[1]&&x<=l.last[1])if(v)if(l.size[0]<l.worldSize[0])for(u=Math.floor(r/l.worldSize[0]),y=Math.floor(t/l.worldSize[0]);y<=u;y++)h.push(new f(x,Math.max(l.getFirstColumnForWorld(y),t),Math.min(l.getLastColumnForWorld(y),r)));else h.push(new f(x,t,r));else t>l.last[0]||r<l.first[0]||(t=Math.max(t,l.first[0]),r=Math.min(r,l.last[0]),h.push(new f(x,t,r)));x+=1;for(t=m.length-1;0<=t;t--)r=m[t],r.ymax>=x?r.incrRow():m.splice(t,1)}return w}getTileParentId(e){n.set(e);
e=this._lodInfos.indexOf(this._infoByLevel[n.level])-1;if(0>e)return null;this._getTileIdAtLOD(n,this._lodInfos[e],n);return n.id}getTileResolution(e){return(e=this._infoByLevel["object"===typeof e?e.level:e])?e.resolution:-1}getTileScale(e){return(e=this._infoByLevel[e.level])?e.scale:-1}intersects(e,m){n.set(m);m=this._infoByLevel[n.level];const l=e.lodInfo;if(l.resolution>m.resolution){this._getTileIdAtLOD(n,l,n);var w=l.denormalizeCol(n.col,n.world);for(var v of e.spans)if(v.row===n.row&&v.colFrom<=
w&&v.colTo>=w)return!0}if(l.resolution<m.resolution){const [p,h,t,r]=e.spans.reduce((u,y)=>{u[0]=Math.min(u[0],y.row);u[1]=Math.max(u[1],y.row);u[2]=Math.min(u[2],y.colFrom);u[3]=Math.max(u[3],y.colTo);return u},[Infinity,-Infinity,Infinity,-Infinity]);w=m.denormalizeCol(n.col,n.world);e=l.getColumnForX(m.getXForColumn(w));v=l.getRowForY(m.getYForRow(n.row));w=l.getColumnForX(m.getXForColumn(w+1))-1;m=l.getRowForY(m.getYForRow(n.row+1))-1;return!(e>r||w<t||v>h||m<p)}const x=l.denormalizeCol(n.col,
n.world);return e.spans.some(p=>p.row===n.row&&p.colFrom<=x&&p.colTo>=x)}normalizeBounds(e,m,l){e[0]=m[0];e[1]=m[1];e[2]=m[2];e[3]=m[3];this._wrap&&(m=b.getInfo(this.tileInfo.spatialReference),l=-l*(m.valid[1]-m.valid[0]),e[0]+=l,e[2]+=l);return e}getSmallestInfoForScale(e){const m=this.scales;if(this._infoByScale[e])return this._infoByScale[e];if(e>m[0])return this._infoByScale[m[0]];for(let l=1;l<m.length-1;l++)if(e>m[l]+1E-6)return this._infoByScale[m[l-1]];return this._infoByScale[m[m.length-
1]]}getClosestInfoForScale(e){const m=this.scales;if(this._infoByScale[e])return this._infoByScale[e];e=m.reduce((l,w)=>Math.abs(w-e)<Math.abs(l-e)?w:l,m[0]);return this._infoByScale[e]}scaleToLevel(e){const m=this.scales;if(this._infoByScale[e])return this._infoByScale[e].level;for(let l=m.length-1;0<=l;l--)if(e<m[l])return l===m.length-1?this._infoByScale[m[m.length-1]].level:this._infoByScale[m[l]].level+(m[l]-e)/(m[l]-m[l+1]);return this._infoByScale[m[0]].level}scaleToZoom(e){return this.tileInfo.scaleToZoom(e)}_getTileIdAtLOD(e,
m,l){const w=this._infoByLevel[l.level];e.set(l);if(m.resolution<w.resolution)return null;if(m.resolution===w.resolution)return e;e.level=m.level;e.col=Math.floor(l.col*w.resolution/m.resolution+.01);e.row=Math.floor(l.row*w.resolution/m.resolution+.01);return e}}return q})},"esri/views/2d/tiling/LODInfo":function(){define(["../../../geometry/support/spatialReferenceUtils","./TileKey"],function(b,a){function c(n,k,g){n[0]=k;n[1]=g;return n}const d=new a("0/0/0/0");class f{static create(n,k,g=null){var q=
b.getInfo(n.spatialReference);const e=k.origin||[n.origin.x,n.origin.y],m=[n.size[0]*k.resolution,n.size[1]*k.resolution],l=[-Infinity,-Infinity],w=[Infinity,Infinity],v=[Infinity,Infinity];null!=g&&(c(l,Math.max(0,Math.floor((g.xmin-e[0])/m[0])),Math.max(0,Math.floor((e[1]-g.ymax)/m[1]))),c(w,Math.max(0,Math.floor((g.xmax-e[0])/m[0])),Math.max(0,Math.floor((e[1]-g.ymin)/m[1]))),c(v,w[0]-l[0]+1,w[1]-l[1]+1));const {cols:x,rows:p}=k;!g&&x&&p&&(c(l,x[0],p[0]),c(w,x[1],p[1]),c(v,x[1]-x[0]+1,p[1]-p[0]+
1));let h;n.isWrappable?(n=[Math.ceil(Math.round((q.valid[1]-q.valid[0])/k.resolution)/n.size[0]),v[1]],q=[Math.floor((q.origin[0]-e[0])/m[0]),l[1]],g=[n[0]+q[0]-1,w[1]],h=!0):(q=l,g=w,n=v,h=!1);return new f(k.level,k.resolution,k.scale,e,l,w,v,m,q,g,n,h)}constructor(n,k,g,q,e,m,l,w,v,x,p,h){this.level=n;this.resolution=k;this.scale=g;this.origin=q;this.first=e;this.last=m;this.size=l;this.norm=w;this.worldStart=v;this.worldEnd=x;this.worldSize=p;this.wrap=h}normalizeCol(n){if(!this.wrap)return n;
const k=this.worldSize[0];return 0>n?k-1-Math.abs((n+1)%k):n%k}denormalizeCol(n,k){return this.wrap?this.worldSize[0]*k+n:n}getWorldForColumn(n){return this.wrap?Math.floor(n/this.worldSize[0]):0}getFirstColumnForWorld(n){return n*this.worldSize[0]+this.first[0]}getLastColumnForWorld(n){return n*this.worldSize[0]+this.first[0]+this.size[0]-1}getColumnForX(n){return(n-this.origin[0])/this.norm[0]}getXForColumn(n){return this.origin[0]+n*this.norm[0]}getRowForY(n){return(this.origin[1]-n)/this.norm[1]}getYForRow(n){return this.origin[1]-
n*this.norm[1]}getTileBounds(n,k,g=!1){d.set(k);var q=g?d.col:this.denormalizeCol(d.col,d.world),e=d.row;k=this.getXForColumn(q);g=this.getYForRow(e+1);q=this.getXForColumn(q+1);e=this.getYForRow(e);n[0]=k;n[1]=g;n[2]=q;n[3]=e;return n}getTileCoords(n,k,g=!1){d.set(k);k=g?d.col:this.denormalizeCol(d.col,d.world);Array.isArray(n)?c(n,this.getXForColumn(k),this.getYForRow(d.row)):(n.x=this.getXForColumn(k),n.y=this.getYForRow(d.row));return n}}return f})},"esri/views/2d/tiling/TileCoverage":function(){define(["../../../core/ObjectPool"],
function(b){class a{constructor(){this.spans=[]}acquire(c){this.lodInfo=c}release(){this.lodInfo=null;this.spans.length=0}forEach(c,d){const {spans:f,lodInfo:n}=this,{level:k}=n;if(0!==f.length)for(const {row:g,colFrom:q,colTo:e}of f)for(let m=q;m<=e;m++)c.call(d,k,g,n.normalizeCol(m),n.getWorldForColumn(m))}}a.pool=new b(a);return a})},"esri/views/2d/tiling/TileSpan":function(){define(function(){class b{constructor(a,c,d){this.row=a;this.colFrom=c;this.colTo=d}}return b})},"esri/views/2d/tiling/TileQueue":function(){define("../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec2 ../../support/QueueProcessor".split(" "),
function(b,a,c,d,f,n,k,g,q,e){function m(p,h){p.length=0;h.forEach(t=>p.push(t));return p}const l=new Set,w=[],v=new Map,x=[0,0];a=class extends a{constructor(p){super(p);this._keyToItem=new Map;this.concurrency=6;this.strategy="scale-first";this.tileInfoView=null}initialize(){const {concurrency:p,process:h,strategy:t}=this;this._queue=new e.QueueProcessor({concurrency:p,process:(r,u)=>{r=this._keyToItem.get(r);return h(r,{signal:u})},peeker:"scale-first"===t?r=>this._peekByScaleFirst(r):r=>this._peekByCenterFirst(r)})}destroy(){this.clear();
this._queue=c.destroyMaybe(this._queue)}get length(){return this._queue?this._queue.length:0}get onGoingCount(){return this._keyToItem.size}abort(p){this._queue.abort("string"===typeof p?p:p.id)}clear(){this._queue.clear();this._keyToItem.clear()}has(p){return"string"===typeof p?this._keyToItem.has(p):this._keyToItem.has(p.id)}isOngoing(p){p="string"===typeof p?p:p.id;return this.has(p)&&this._queue.isOngoing(p)}pause(){this._queue.pause()}push(p){const h=p.key.id;if(this._queue.has(h))return this._queue.get(h);
const t=this._queue.push(h),r=()=>{this._keyToItem.delete(h)};this._keyToItem.set(h,p);t.then(r,r);return t}reset(){this._queue.reset()}resume(){this._queue.resume()}_peekByScaleFirst(p){if(!this.state)return p.values().next().value;const h=this.tileInfoView;let t=Number.NEGATIVE_INFINITY,r=Number.POSITIVE_INFINITY;p.forEach(C=>{C=this._keyToItem.get(C);const E=this.tileInfoView.getTileScale(C.key);v.has(E)||(v.set(E,[]),t=Math.max(E,t),r=Math.min(E,r));v.get(E).push(C.key);l.add(E)});let u=this.state.scale;
v.has(u)||(m(w,l),w.sort((C,E)=>C-E),u=w.reduce((C,E)=>Math.abs(E-u)<Math.abs(C-u)?E:C,w[0]));u=Math.min(u,t);u=Math.max(u,r);p=v.get(u);const y=h.getClosestInfoForScale(u),z=y.getColumnForX(this.state.center[0]),A=y.getRowForY(this.state.center[1]);p.sort((C,E)=>{const B=y.denormalizeCol(C.col,C.world),D=y.denormalizeCol(E.col,E.world);return Math.sqrt((z-B)*(z-B)+(A-C.row)*(A-C.row))-Math.sqrt((z-D)*(z-D)+(A-E.row)*(A-E.row))});l.clear();v.clear();return p[0].id}_peekByCenterFirst(p){if(!this.state)return p.values().next().value;
const h=this.tileInfoView,t=this.state.center;let r=Number.POSITIVE_INFINITY,u;p.forEach(y=>{y=this._keyToItem.get(y);h.getTileCoords(x,y.key);const z=q.distance(x,t);z<r&&(r=z,u=y.key)});return u.id}};b.__decorate([d.property({constructOnly:!0})],a.prototype,"concurrency",void 0);b.__decorate([d.property({constructOnly:!0})],a.prototype,"process",void 0);b.__decorate([d.property()],a.prototype,"state",void 0);b.__decorate([d.property({constructOnly:!0})],a.prototype,"strategy",void 0);b.__decorate([d.property({constructOnly:!0})],
a.prototype,"tileInfoView",void 0);return a=b.__decorate([g.subclass("esri.views.2d.tiling.TileQueue")],a)})},"esri/views/support/QueueProcessor":function(){define("exports ../../core/maybe ../../core/promiseUtils ../../core/Queue ../../core/ReactiveMap ../../core/scheduling ../../core/signal".split(" "),function(b,a,c,d,f,n,k){class g{constructor(e,m){this.item=e;this.controller=m;this.promise=null}}class q{constructor(e){this._task=this._schedule=null;this._deferreds=new f;this._controllers=new f;
this._processingItems=new f;this._pausedSignal=k.signal(!1);this.concurrency=1;e.concurrency&&(this.concurrency=e.concurrency);this._queue=new d(e.peeker);this.process=e.process;const m=e.scheduler;e.priority&&m&&(this._task=m.registerTask(e.priority,this))}destroy(){this.clear();this._schedule=a.removeMaybe(this._schedule);this._task=a.removeMaybe(this._task)}get updating(){return!!this._task?.updating||this.running}get length(){return this._processingItems.size+this._queue.length}abort(e){(e=this._controllers.get(e))&&
e.abort()}clear(){this._queue.clear();const e=[];this._controllers.forEach(m=>e.push(m));this._controllers.clear();e.forEach(m=>m.abort());this._processingItems.clear();this._cancelNext()}forEach(e){this._deferreds.forEach((m,l)=>e(l))}get(e){return(e=this._deferreds.get(e))?e.promise:void 0}isOngoing(e){return this._processingItems.has(e)}has(e){return this._deferreds.has(e)}pause(){this._pausedSignal.value||(this._pausedSignal.value=!0,this._cancelNext())}push(e,m){const l=this.get(e);if(l)return l;
const w=new AbortController;let v=null;m&&(v=c.onAbort(m,()=>w.abort()));const x=()=>{p.remove();null!=v&&v.remove();this._deferreds.delete(e);this._controllers.delete(e);this._queue.remove(e);this._processingItems.delete(e);this._scheduleNext()},p=c.onAbortOrThrow(w.signal,()=>{const t=this._processingItems.get(e);t&&t.controller.abort();x();h.reject(c.createAbortError())}),h=c.createResolver();this._deferreds.set(e,h);this._controllers.set(e,w);h.promise.then(x,x);this._queue.push(e);this._scheduleNext();
return h.promise}last(){return this._queue.last()}peek(){return this._queue.peek()}popLast(){return this._queue.popLast()}reset(){const e=[];this._processingItems.forEach(m=>e.push(m));this._processingItems.clear();for(const m of e)this._queue.push(m.item),m.controller.abort();this._scheduleNext()}resume(){this._pausedSignal.value&&(this._pausedSignal.value=!1,this._scheduleNext())}takeAll(){const e=[];for(;this._queue.length;)e.push(this._queue.pop());this.clear();return e}get running(){return!this._pausedSignal.value&&
0<this._queue.length&&this._processingItems.size<this.concurrency}runTask(e){for(;!e.done&&0<this._queue.length&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop()),e.madeProgress()}_scheduleNext(){this._task||this._pausedSignal.value||this._schedule||(this._schedule=n.schedule(()=>{this._schedule=null;this._next()}))}_next(){for(;0<this._queue.length&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())}_cancelNext(){this._schedule&&(this._schedule.remove(),
this._schedule=null)}_processResult(e,m){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).resolve(m))}_processError(e,m){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).reject(m))}_canProcessFulfillment(e){return this._deferreds.get(e.item)&&this._processingItems.get(e.item)===e?!0:!1}_process(e){if(null!=e){var m=new AbortController,l=new g(e,m);this._processingItems.set(e,l);try{var w=this.process(e,m.signal)}catch(v){this._processError(l,
v)}c.isPromiseLike(w)?(l.promise=w,w.then(v=>this._processResult(l,v),v=>this._processError(l,v))):this._processResult(l,w)}}get test(){return{update:e=>this.runTask(e)}}}b.QueueProcessor=q;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/core/ReactiveMap":function(){define(["./accessorSupport/tracking","./accessorSupport/tracking/SimpleObservable"],function(b,a){class c{constructor(){this._map=new Map;this._observable=new a.SimpleObservable}get size(){b.trackAccess(this._observable);
return this._map.size}clear(){0<this._map.size&&(this._map.clear(),this._observable.notify())}delete(d){(d=this._map.delete(d))&&this._observable.notify();return d}entries(){b.trackAccess(this._observable);return this._map.entries()}forEach(d,f){b.trackAccess(this._observable);this._map.forEach((n,k)=>d.call(f,n,k,this),f)}get(d){b.trackAccess(this._observable);return this._map.get(d)}has(d){b.trackAccess(this._observable);return this._map.has(d)}keys(){b.trackAccess(this._observable);return this._map.keys()}set(d,
f){this._map.set(d,f);this._observable.notify();return this}values(){b.trackAccess(this._observable);return this._map.values()}[Symbol.iterator](){b.trackAccess(this._observable);return this._map[Symbol.iterator]()}get [Symbol.toStringTag](){return this._map[Symbol.toStringTag]}}return c})},"esri/views/2d/tiling/TileStrategy":function(){define(["../../../geometry/support/aaBoundingRect","./TileCache","./TileCoverage","./TileKey"],function(b,a,c,d){const f=new d(0,0,0,0),n=new Map,k=[],g=[];class q{constructor(e){this._previousScale=
Number.POSITIVE_INFINITY;this.cachePolicy="keep";this.coveragePolicy="closest";this.resampling=!0;this.tileIndex=new Map;this.tiles=[];this.buffer=192;this.acquireTile=e.acquireTile;this.releaseTile=e.releaseTile;this.tileInfoView=e.tileInfoView;null!=e.resampling&&(this.resampling=e.resampling);e.cachePolicy&&(this.cachePolicy=e.cachePolicy);e.coveragePolicy&&(this.coveragePolicy=e.coveragePolicy);null!=e.buffer&&(this.buffer=e.buffer);e.cacheSize&&(this._tileCache=new a(e.cacheSize,this.tileInfoView,
m=>{this.releaseTile(m)}))}destroy(){this.tileIndex.clear()}update(e){const {resampling:m,tileIndex:l}=this,{scale:w,center:v,resolution:x}=e.state,{minScale:p,maxScale:h}=this.tileInfoView,t=!e.stationary&&w>this._previousScale;this._previousScale=w;if(!m&&(w>p||w<h))this.tiles.length=0,this.clear();else if(e=this.tileInfoView.getTileCoverage(e.state,this.buffer,this.resampling,this.coveragePolicy)){var {spans:r,lodInfo:u}=e,{level:y}=u;this.tiles.length=0;l.forEach(E=>E.visible=!0);var z=0,A=0;
if(0<r.length)for(const {row:E,colFrom:B,colTo:D}of r)for(var C=B;C<=D;C++){z++;const F=f.set(y,E,u.normalizeCol(C),u.getWorldForColumn(C)).id;let K=l.get(F);if(K)K.isReady?(n.set(F,K),A++):t||this._addParentTile(F,n);else{if(this._tileCache?.has(F)){if(K=this._tileCache.pop(F),this.tileIndex.set(F,K),K.isReady){n.set(F,K);A++;continue}}else K=this.acquireTile(f),this.tileIndex.set(F,K);t||this._addParentTile(F,n)}}z=A===z;for(const [E,B]of l)n.has(E)||(f.set(E),A=this.tileInfoView.intersects(e,f),
C="purge"===this.cachePolicy?f.level!==y:f.level>y,!A||!t&&z?!C&&A||k.push(B):B.isReady?C&&"purge"===this.cachePolicy&&this._hasReadyAncestor(f,y)?k.push(B):g.push(B):C&&k.push(B));for(const E of g)E.isReady&&n.set(E.key.id,E);for(const E of k)this._tileCache?this._tileCache.add(E):this.releaseTile(E),l.delete(E.key.id);for(const E of n.values())this.tiles.push(E);for(const E of l.values())n.has(E.key.id)||(E.visible=!1);this._tileCache?.prune(y,v,x);c.pool.release(e);g.length=0;k.length=0;n.clear()}else this.tiles.length=
0,this.clear()}clear(){const {tileIndex:e}=this;for(const m of e.values())this.releaseTile(m);e.clear()}refresh(e){for(const m of this.tileIndex.values())this.tiles.includes(m)?e(m):k.push(m);for(const m of k)this.releaseTile(m),this.tileIndex.delete(m.key.id);this._tileCache?.clear()}updateCacheSize(e){this._tileCache&&(this._tileCache.maxSize=e)}_addParentTile(e,m){let l=null;for(;;){e=this.tileInfoView.getTileParentId(e);if(!e)break;if(this.tileIndex.has(e)){if(l=this.tileIndex.get(e),l?.isReady){m.has(l.key.id)||
m.set(l.key.id,l);break}}else if(this._tileCache?.has(e)&&(l=this._tileCache.pop(e),this.tileIndex.set(e,l),l?.isReady)){m.has(l.key.id)||m.set(l.key.id,l);break}}}_hasReadyAncestor(e,m){const l=b.create();this.tileInfoView.getTileBounds(l,e,!0);for(const w of this.tileIndex.values())if(w.isReady&&w.key.level>=m&&w.key.level<e.level){const v=b.create();this.tileInfoView.getTileBounds(v,w.key,!0);if(b.contains(v,l))return!0}return!1}}return q})},"esri/views/2d/tiling/TileCache":function(){define(["../../../chunks/vec2"],
function(b){class a{constructor(c,d,f){this.maxSize=c;this._tileInfoView=d;this._removedFunc=f;this._tilePerId=new Map;this._tileKeysPerLevel=[]}clear(){this._tilePerId.clear();this._tileKeysPerLevel=[]}has(c){return this._tilePerId.has(c)}get(c){return this._tilePerId.get(c)}pop(c){const d=this._tilePerId.get(c);if(d){var f=this._tileKeysPerLevel[d.key.level];this._tilePerId["delete"](c);for(let n=0;n<f.length;n++)if(f[n].id===c){f.splice(n,1);break}d.visible=!0;return d}}add(c){c.visible=!1;const d=
c.key,f=d.id;this._tilePerId.has(f)||(this._tilePerId.set(f,c),c=d.level,this._tileKeysPerLevel[c]||(this._tileKeysPerLevel[c]=[]),this._tileKeysPerLevel[c].push(d))}prune(c,d,f){let n=this._tilePerId.size;if(!(n<=this.maxSize)){for(var k=this._tileKeysPerLevel.length-1;n>this.maxSize&&0<=k;)k!==c&&(n=this._pruneAroundCenterTile(n,d,f,k)),k--;n>this.maxSize&&(n=this._pruneAroundCenterTile(n,d,f,c))}}_pruneAroundCenterTile(c,d,f,n){n=this._tileKeysPerLevel[n];if(!n||0===n.length)return c;const {size:k,
origin:g}=this._tileInfoView.tileInfo,q=f*k[0],e=f*k[1],m=[0,0],l=[0,0];for(n.sort((w,v)=>{m[0]=g.x+q*(w.col+.5);m[1]=g.y-e*(w.row+.5);l[0]=g.x+q*(v.col+.5);l[1]=g.y-e*(v.row+.5);return b.squaredDistance(m,d)-b.squaredDistance(l,d)});0<n.length&&(f=n.pop(),this._removeTile(f.id),c--,c!==this.maxSize););return c}_removeTile(c){const d=this._tilePerId.get(c);this._removedFunc&&d&&this._removedFunc(d);this._tilePerId["delete"](c)}}return a})},"esri/views/2d/ViewState":function(){define("../../chunks/tslib.es6 ../../geometry ../../Viewpoint ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../chunks/common ../../chunks/mat2d ../../chunks/mat2df32 ../../chunks/mat2df64 ../../chunks/mat3 ../../chunks/mat3f32 ../../chunks/vec2 ../../chunks/vec2f32 ../../chunks/vec2f64 ../../core/libs/gl-matrix-2/types/vec2 ../../geometry/support/normalizeUtils ./viewpointUtils ../../geometry/Extent ../../geometry/Point".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A){var C;const E=[0,0];a=C=class extends d.JSONSupport{constructor(B){super(B);this._viewpoint2D={center:t.create(),rotation:0,scale:0,spatialReference:void 0};this.center=[0,0];this.extent=new z;this.id=0;this.inverseTransform=w.create();this.scale=this.rotation=this.resolution=0;this.transform=w.create();this.transformNoRotation=w.create();this.displayMat3=x.create();this.displayViewMat3=x.create();this.viewMat3=x.create();this.viewMat2d=l.create();
this.worldScreenWidth=0;this.size=[0,0]}set pixelRatio(B){this._set("pixelRatio",B);this._update()}set size(B){this._set("size",B);this._update()}set viewpoint(B){if(B){const D=this._viewpoint2D,F=B.targetGeometry;D.center[0]=F.x;D.center[1]=F.y;D.rotation=B.rotation;D.scale=B.scale;D.spatialReference=F.spatialReference}this._update()}copy(B){const D=this.size,F=this.viewpoint;F&&D?(this.viewpoint=y.copy(F,B.viewpoint),this._set("size",p.copy(D,B.size))):(this.viewpoint=B.viewpoint.clone(),this._set("size",
[B.size[0],B.size[1]]));this._set("pixelRatio",B.pixelRatio);return this}clone(){return new C({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(B,D,F){if(r.isVec2(D))return p.transformMat2d(B,D,this.inverseTransform);E[0]=D;E[1]=F;return p.transformMat2d(B,E,this.inverseTransform)}toScreen(B,D,F){if(r.isVec2(D))return p.transformMat2d(B,D,this.transform);E[0]=D;E[1]=F;return p.transformMat2d(B,E,this.transform)}toScreenNoRotation(B,D,F){if(r.isVec2(D))return p.transformMat2d(B,
D,this.transformNoRotation);E[0]=D;E[1]=F;return p.transformMat2d(B,E,this.transformNoRotation)}toScreenClosest(B,D,F){r.isVec2(D)?(E[0]=D[0],E[1]=D[1]):(E[0]=D,E[1]=F);[D]=E;const {center:K,extent:L,spatialReference:G,transform:O}=this;if(D<L.xmin||D>L.xmax)E[0]=u.getClosestDenormalizedXToReference(D,K[0],G);return p.transformMat2d(B,E,O)}getScreenTransform(B,D){const {center:F}=this._viewpoint2D,K=this._get("pixelRatio")||1,L=this._get("size");y.getMatrix(B,F,L,D,0,K);return B}_update(){const {center:B,
spatialReference:D,scale:F,rotation:K}=this._viewpoint2D,L=this._get("pixelRatio")||1,G=this._get("size"),O=new c({targetGeometry:new A(B[0],B[1],D),scale:F,rotation:K});this._set("viewpoint",O);if(G&&D&&F){this.resolution=y.getResolution(O);this.rotation=K;this.scale=F;this.spatialReference=D;p.copy(this.center,B);v.set(this.displayMat3,0!==G[0]?2/G[0]:0,0,0,0,0!==G[1]?-2/G[1]:0,0,-1,1,1);var P=v.identity(this.viewMat3),J=h.fromValues(G[0]/2,G[1]/2),R=h.fromValues(-G[0]/2,-G[1]/2),X=e.toRadian(K);
v.translate(P,P,J);v.rotate(P,P,X);v.translate(P,P,R);v.multiply(this.displayViewMat3,this.displayMat3,P);P=m.fromTranslation(this.viewMat2d,J);m.rotate(P,P,X);m.translate(P,P,R);y.getExtent(this.extent,O,G);y.getTransform(this.transform,O,G,L);m.invert(this.inverseTransform,this.transform);y.getTransformNoRotation(this.transformNoRotation,O,G,L);this.worldScreenWidth=y.getWorldScreenWidth(this.spatialReference,this.resolution);this._set("id",this.id+1);return this}}};b.__decorate([f.property({readOnly:!0})],
a.prototype,"id",void 0);b.__decorate([f.property({value:1,json:{write:!0}})],a.prototype,"pixelRatio",null);b.__decorate([f.property({json:{write:!0}})],a.prototype,"size",null);b.__decorate([f.property()],a.prototype,"spatialReference",void 0);b.__decorate([f.property({type:c,json:{write:!0}})],a.prototype,"viewpoint",null);return a=C=b.__decorate([q.subclass("esri.views.2d.ViewState")],a)})},"esri/chunks/mat2d":function(){define(["exports","./common"],function(b,a){function c(C,E){C[0]=E[0];C[1]=
E[1];C[2]=E[2];C[3]=E[3];C[4]=E[4];C[5]=E[5];return C}function d(C){C[0]=1;C[1]=0;C[2]=0;C[3]=1;C[4]=0;C[5]=0;return C}function f(C,E,B,D,F,K,L){C[0]=E;C[1]=B;C[2]=D;C[3]=F;C[4]=K;C[5]=L;return C}function n(C,E){const B=E[0],D=E[1],F=E[2],K=E[3],L=E[4];E=E[5];let G=B*K-D*F;if(!G)return null;G=1/G;C[0]=K*G;C[1]=-D*G;C[2]=-F*G;C[3]=B*G;C[4]=(F*E-K*L)*G;C[5]=(D*L-B*E)*G;return C}function k(C){return C[0]*C[3]-C[1]*C[2]}function g(C,E,B){const D=E[0],F=E[1],K=E[2],L=E[3],G=E[4];E=E[5];const O=B[0],P=
B[1],J=B[2],R=B[3],X=B[4];B=B[5];C[0]=D*O+K*P;C[1]=F*O+L*P;C[2]=D*J+K*R;C[3]=F*J+L*R;C[4]=D*X+K*B+G;C[5]=F*X+L*B+E;return C}function q(C,E,B){const D=E[0],F=E[1],K=E[2],L=E[3],G=E[4];E=E[5];const O=Math.sin(B);B=Math.cos(B);C[0]=D*B+K*O;C[1]=F*B+L*O;C[2]=D*-O+K*B;C[3]=F*-O+L*B;C[4]=G;C[5]=E;return C}function e(C,E,B){const D=E[1],F=E[2],K=E[3],L=E[4],G=E[5],O=B[0];B=B[1];C[0]=E[0]*O;C[1]=D*O;C[2]=F*B;C[3]=K*B;C[4]=L;C[5]=G;return C}function m(C,E,B){const D=E[0],F=E[1],K=E[2],L=E[3],G=E[4];E=E[5];
const O=B[0];B=B[1];C[0]=D;C[1]=F;C[2]=K;C[3]=L;C[4]=D*O+K*B+G;C[5]=F*O+L*B+E;return C}function l(C,E){const B=Math.sin(E);E=Math.cos(E);C[0]=E;C[1]=B;C[2]=-B;C[3]=E;C[4]=0;C[5]=0;return C}function w(C,E){C[0]=E[0];C[1]=0;C[2]=0;C[3]=E[1];C[4]=0;C[5]=0;return C}function v(C,E){C[0]=1;C[1]=0;C[2]=0;C[3]=1;C[4]=E[0];C[5]=E[1];return C}function x(C){return"mat2d("+C[0]+", "+C[1]+", "+C[2]+", "+C[3]+", "+C[4]+", "+C[5]+")"}function p(C){return Math.sqrt(C[0]**2+C[1]**2+C[2]**2+C[3]**2+C[4]**2+C[5]**2+
1)}function h(C,E,B){C[0]=E[0]+B[0];C[1]=E[1]+B[1];C[2]=E[2]+B[2];C[3]=E[3]+B[3];C[4]=E[4]+B[4];C[5]=E[5]+B[5];return C}function t(C,E,B){C[0]=E[0]-B[0];C[1]=E[1]-B[1];C[2]=E[2]-B[2];C[3]=E[3]-B[3];C[4]=E[4]-B[4];C[5]=E[5]-B[5];return C}function r(C,E,B){C[0]=E[0]*B;C[1]=E[1]*B;C[2]=E[2]*B;C[3]=E[3]*B;C[4]=E[4]*B;C[5]=E[5]*B;return C}function u(C,E,B,D){C[0]=E[0]+B[0]*D;C[1]=E[1]+B[1]*D;C[2]=E[2]+B[2]*D;C[3]=E[3]+B[3]*D;C[4]=E[4]+B[4]*D;C[5]=E[5]+B[5]*D;return C}function y(C,E){return C[0]===E[0]&&
C[1]===E[1]&&C[2]===E[2]&&C[3]===E[3]&&C[4]===E[4]&&C[5]===E[5]}function z(C,E){const B=C[0],D=C[1],F=C[2],K=C[3],L=C[4];C=C[5];const G=E[0],O=E[1],P=E[2],J=E[3],R=E[4];E=E[5];const X=a.getEpsilon();return Math.abs(B-G)<=X*Math.max(1,Math.abs(B),Math.abs(G))&&Math.abs(D-O)<=X*Math.max(1,Math.abs(D),Math.abs(O))&&Math.abs(F-P)<=X*Math.max(1,Math.abs(F),Math.abs(P))&&Math.abs(K-J)<=X*Math.max(1,Math.abs(K),Math.abs(J))&&Math.abs(L-R)<=X*Math.max(1,Math.abs(L),Math.abs(R))&&Math.abs(C-E)<=X*Math.max(1,
Math.abs(C),Math.abs(E))}const A=Object.freeze(Object.defineProperty({__proto__:null,add:h,copy:c,determinant:k,equals:z,exactEquals:y,frob:p,fromRotation:l,fromScaling:w,fromTranslation:v,identity:d,invert:n,mul:g,multiply:g,multiplyScalar:r,multiplyScalarAndAdd:u,rotate:q,scale:e,set:f,str:x,sub:t,subtract:t,translate:m},Symbol.toStringTag,{value:"Module"}));b.add=h;b.copy=c;b.determinant=k;b.equals=z;b.exactEquals=y;b.frob=p;b.fromRotation=l;b.fromScaling=w;b.fromTranslation=v;b.identity=d;b.invert=
n;b.mat2d=A;b.mul=g;b.multiply=g;b.multiplyScalar=r;b.multiplyScalarAndAdd=u;b.rotate=q;b.scale=e;b.set=f;b.str=x;b.sub=t;b.subtract=t;b.translate=m})},"esri/chunks/mat2df32":function(){define(["exports"],function(b){function a(){const q=new Float32Array(6);q[0]=1;q[3]=1;return q}function c(q){const e=new Float32Array(6);e[0]=q[0];e[1]=q[1];e[2]=q[2];e[3]=q[3];e[4]=q[4];e[5]=q[5];return e}function d(q,e,m,l,w,v){const x=new Float32Array(6);x[0]=q;x[1]=e;x[2]=m;x[3]=l;x[4]=w;x[5]=v;return x}function f(q,
e){return new Float32Array(q,e,6)}function n(q,e,m,l){const w=e[l];e=e[l+1];q[l]=m[0]*w+m[2]*e+m[4];q[l+1]=m[1]*w+m[3]*e+m[5]}function k(q,e,m,l=0,w=0,v=2){for(w=w||e.length/v;l<w;l++)n(q,e,m,l*v)}const g=Object.freeze(Object.defineProperty({__proto__:null,clone:c,create:a,createView:f,fromValues:d,transform:n,transformMany:k},Symbol.toStringTag,{value:"Module"}));b.clone=c;b.create=a;b.createView=f;b.fromValues=d;b.mat2df32=g;b.transform=n;b.transformMany=k})},"esri/chunks/mat2df64":function(){define(["exports"],
function(b){function a(){return[1,0,0,1,0,0]}function c(k){return[k[0],k[1],k[2],k[3],k[4],k[5]]}function d(k,g,q,e,m,l){return[k,g,q,e,m,l]}function f(k,g){return new Float64Array(k,g,6)}const n=Object.freeze(Object.defineProperty({__proto__:null,clone:c,create:a,createView:f,fromValues:d},Symbol.toStringTag,{value:"Module"}));b.clone=c;b.create=a;b.createView=f;b.fromValues=d;b.mat2df64=n})},"esri/core/libs/gl-matrix-2/types/vec2":function(){define(["exports"],function(b){function a(d){return d instanceof
Float32Array&&2<=d.length}function c(d){return Array.isArray(d)&&2<=d.length}b.isVec2=function(d){return a(d)||c(d)};b.isVec2f32=a;b.isVec2f64=c;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/viewpointUtils":function(){define("exports ../../Viewpoint ../../core/Collection ../../core/unitUtils ../../chunks/common ../../chunks/mat2d ../../chunks/mat2df64 ../../chunks/vec2 ../../chunks/vec2f64 ../../geometry/Extent ../../geometry/Geometry ../../geometry/Point ../../geometry/projection ../../geometry/SpatialReference ../../geometry/support/normalizeUtils ../../geometry/support/spatialReferenceUtils".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p){function h(I,Q){return Q.type?g.set(I,Q.x,Q.y):g.copy(I,Q)}function t(I,Q){return Math.max(I.width/Math.max(1,Q[0]),I.height/Math.max(1,Q[1]))*E(I.spatialReference)}async function r(I,Q,N,T){if(!I||Array.isArray(I)&&!I.length)return null;c.isCollection(I)&&(I=I.toArray());if(Array.isArray(I)&&I.length&&"object"===typeof I[0]){var aa=I.every(ba=>"attributes"in ba);var Z=I.some(ba=>!ba.geometry),da=I;if(aa&&Z&&Q&&Q.allLayerViews){aa=new Map;for(var fa of I)I=
fa.layer,Z=aa.get(I)||[],da=fa.attributes[I.objectIdField],null!=da&&Z.push(da),aa.set(I,Z);const ba=[];aa.forEach((ea,ca)=>{const ia=Q.allLayerViews.find(la=>la.layer.id===ca.id);if(ia&&"queryFeatures"in ia){const la=ca.createQuery();la.objectIds=ea;la.returnGeometry=!0;ba.push(ia.queryFeatures(la))}});fa=await Promise.all(ba);I=[];for(var ka of fa)if(ka&&ka.features&&ka.features.length)for(var ha of ka.features)null!=ha.geometry&&I.push(ha.geometry);da=I}for(const ba of da)T=await r(ba,Q,N,T);return T}if(Array.isArray(I)&&
2===I.length&&"number"===typeof I[0]&&"number"===typeof I[1])aa=new l(I);else if(I instanceof m)aa=I;else if("geometry"in I)if(I.geometry)aa=I.geometry;else if(I.layer){const ba=I.layer;(ka=Q.allLayerViews.find(ea=>ea.layer.id===ba.id))&&"queryFeatures"in ka&&(ha=ba.createQuery(),ha.objectIds=[I.attributes[ba.objectIdField]],ha.returnGeometry=!0,aa=(await ka.queryFeatures(ha))?.features?.[0]?.geometry)}if(null==aa)return null;switch(aa.type){case "point":ka=new e({xmin:aa.x,ymin:aa.y,xmax:aa.x,ymax:aa.y,
spatialReference:aa.spatialReference});break;case "extent":case "multipoint":case "polygon":case "polyline":ka=x.getDenormalizedExtent(aa);break;default:ka=aa.extent}if(!ka)return null;w.isLoaded()||w.canProjectWithoutEngine(ka.spatialReference,N)||await w.load();N=w.project(ka,N);return N?T=T?T.union(N):N:null}function u(I){if(I&&(!Array.isArray(I)||"number"!==typeof I[0])&&("object"===typeof I||Array.isArray(I)&&"object"===typeof I[0])){if("layer"in I&&null!=I.layer?.minScale&&null!=I.layer.maxScale){var Q=
I.layer;return{min:Q.minScale,max:Q.maxScale}}if(Array.isArray(I)&&I.length&&I.every(N=>"layer"in N)){let N=Q=0;for(const T of I)I=T.layer,I?.minScale&&I.maxScale&&(Q=I.minScale<Q?I.minScale:Q,N=I.maxScale>N?I.maxScale:N);return Q&&N?{min:Q,max:N}:null}}}function y(I,Q){return p.equals(I.wkid?I:I.spatialReference||v.WGS84,Q)?I:w.project(I,Q)}function z(I,Q){const N=I.targetGeometry,T=Q.targetGeometry;N.x=T.x;N.y=T.y;N.spatialReference=T.spatialReference;I.scale=Q.scale;I.rotation=Q.rotation;return I}
function A(I,Q,N){return N?g.set(I,.5*(Q[0]-N.right+N.left),.5*(Q[1]-N.bottom+N.top)):g.scale(I,Q,.5)}function C(I){var Q=I.scale;I=I.targetGeometry;I=null!=I&&p.isValid(I.spatialReference)?1/(39.37*d.getMetersPerUnitForSR(I.spatialReference)*96):1;return Q*I}function E(I){return p.isValid(I)?39.37*d.getMetersPerUnitForSR(I)*96:1}function B(I){return(I=p.getInfo(I))?I.valid[1]-I.valid[0]:0}const D=180/Math.PI,F=function(){const I=q.create();return function(Q,N,T){const aa=N.targetGeometry;h(I,aa);
N=.5*C(N);Q.xmin=I[0]-N*T[0];Q.ymin=I[1]-N*T[1];Q.xmax=I[0]+N*T[0];Q.ymax=I[1]+N*T[1];Q.spatialReference=aa.spatialReference;return Q}}(),K=function(){const I=q.create();return function(Q,N,T){return g.sub(Q,g.scale(Q,N,.5),A(I,N,T))}}(),L=function(){const I=k.create(),Q=q.create();return function(N,T,aa,Z){const da=C(T);T=f.toRadian(T.rotation)||0;g.set(Q,da,da);n.fromScaling(I,Q);n.rotate(I,I,T);n.translate(I,I,K(Q,aa,Z));n.translate(I,I,[0,Z.top-Z.bottom]);return g.set(N,I[4],I[5])}}(),G=function(){const I=
q.create(),Q=q.create(),N=q.create();return function(T,aa,Z,da,fa,ka){g.negate(I,aa);g.scale(Q,Z,.5*ka);g.set(N,1/da*ka,-1/da*ka);n.fromTranslation(T,Q);fa&&n.rotate(T,T,fa);n.scale(T,T,N);n.translate(T,T,I);return T}}(),O=function(){const I=q.create();return function(Q,N,T,aa){const Z=C(N),da=f.toRadian(N.rotation)||0;h(I,N.targetGeometry);return G(Q,I,T,Z,da,aa)}}(),P=function(){const I=q.create();return function(Q,N,T,aa){const Z=C(N);h(I,N.targetGeometry);return G(Q,I,T,Z,0,aa)}}(),J=function(){const I=
q.create(),Q=q.create(),N=[0,0,0];return function(T,aa,Z){g.subtract(I,T,aa);g.normalize(I,I);g.subtract(Q,T,Z);g.normalize(Q,Q);g.cross(N,I,Q);T=Math.acos(g.dot(I,Q)/(g.length(I)*g.length(Q)))*D;0>N[2]&&(T=-T);isNaN(T)&&(T=0);return T}}(),R=function(){const I=q.create();return function(Q,N,T,aa){const Z=Q.targetGeometry;z(Q,N);L(I,N,T,aa);Z.x+=I[0];Z.y+=I[1];return Q}}(),X=function(){return function(I,Q,N){z(I,Q);Q=I.targetGeometry;Q.x=N.x;Q.y=N.y;Q.spatialReference=N.spatialReference;return I}}(),
U=function(){const I=q.create();return function(Q,N,T,aa,Z){Z||(Z="center");g.sub(I,T,aa);g.scale(I,I,.5);T=I[0];aa=I[1];switch(Z){case "center":g.set(I,0,0);break;case "left":g.set(I,-T,0);break;case "top":g.set(I,0,aa);break;case "right":g.set(I,T,0);break;case "bottom":g.set(I,0,-aa);break;case "top-left":g.set(I,-T,aa);break;case "bottom-left":g.set(I,-T,-aa);break;case "top-right":g.set(I,T,aa);break;case "bottom-right":g.set(I,T,-aa)}S(Q,N,I);return Q}}(),M=function(){const I=q.create();return function(Q,
N,T,aa,Z){z(Q,N);isNaN(T)||0===T||(W(I,aa,N,Z),Q.scale=N.scale*T,H(I,I,Q,Z),S(Q,Q,g.set(I,I[0]-aa[0],aa[1]-I[1])));return Q}}(),V=function(){const I=q.create();return function(Q,N,T,aa,Z,da){z(Q,N);isNaN(T)||0===T||(W(I,Z,N,da),Q.scale=N.scale*T,Q.rotation+=aa,H(I,I,Q,da),S(Q,Q,g.set(I,I[0]-Z[0],Z[1]-I[1])));return Q}}(),Y=function(){const I=q.create(),Q=q.create();return function(N,T,aa,Z,da,fa,ka){K(Q,fa,ka);g.add(I,da,Q);return Z?V(N,T,aa,Z,I,fa):M(N,T,aa,I,fa)}}(),W=function(){const I=k.create();
return function(Q,N,T,aa){var Z=g.transformMat2d;O(I,T,aa,1);T=n.invert(I,I);return Z.call(g,Q,N,T)}}(),H=function(){const I=k.create();return function(Q,N,T,aa){return g.transformMat2d(Q,N,O(I,T,aa,1))}}(),S=function(){const I=q.create(),Q=k.create();return function(N,T,aa){z(N,T);const Z=C(T),da=N.targetGeometry;n.fromRotation(Q,f.toRadian(T.rotation)||0);n.scale(Q,Q,q.fromValues(Z,Z));g.transformMat2d(I,aa,Q);da.x+=I[0];da.y+=I[1];return N}}();b.addPadding=R;b.angleBetween=J;b.centerAt=X;b.copy=
z;b.create=async function(I,Q){if(!I||!Q)return new a({targetGeometry:new l,scale:0,rotation:0});let N=Q.spatialReference;const {constraints:T,padding:aa,viewpoint:Z,size:da}=Q,fa=[aa?da[0]-aa.left-aa.right:da[0],aa?da[1]-aa.top-aa.bottom:da[1]];let ka=null;I instanceof a?ka=I:I.viewpoint?ka=I.viewpoint:I.target&&"esri.Viewpoint"===I.target.declaredClass&&(ka=I.target);let ha=null;if(ka?.targetGeometry)ha=ka.targetGeometry;else if(I instanceof e)ha=I;else if(I||I&&("center"in I||"extent"in I||"target"in
I))ha=await r(I.center,Q,N)||await r(I.extent,Q,N)||await r(I.target,Q,N)||await r(I,Q,N);!ha&&Z?.targetGeometry?ha=Z.targetGeometry:!ha&&Q.extent&&(ha=Q.extent);if(!N){var ba=Q.spatialReference||Q.extent||ha;N=ba.wkid?ba:ba.spatialReference||v.WGS84}w.isLoaded()||p.equals(ha.spatialReference,N)||w.canProjectWithoutEngine(ha.spatialReference,N)||await w.load();ba=y("center"in ha?ha.center:ha,N);!1!==Q.pickClosestTarget&&"point"===ba.type&&"point"===Z.targetGeometry?.type&&(ba.x=x.getClosestDenormalizedXToReference(ba.x,
Z.targetGeometry.x,ba.spatialReference));var ea=0;null!=ka?.targetGeometry&&"point"===ka.targetGeometry.type?ea=ka.scale:"scale"in I&&I.scale?ea=I.scale:"zoom"in I&&-1!==I.zoom&&T&&T.effectiveLODs?ea=T.zoomToScale(I.zoom):Array.isArray(ha)||"point"===ha.type||"extent"===ha.type&&0===ha.width&&0===ha.height?(ea=y(Q.extent,N),ea=null!=ea?t(ea,fa):Q.extent?t(Q.extent,fa):Z.scale):ea=t(y(ha.extent,N),fa);if(Q=u(I.target??I))Q.min&&Q.min<ea?ea=Q.min:Q.max&&Q.max>ea&&(ea=Q.max);Q=0;ka?Q=ka.rotation:I.hasOwnProperty("rotation")?
Q=I.rotation:Z&&(Q=Z.rotation);I=new a({targetGeometry:ba,scale:ea,rotation:Q});T&&(I=T.fit(I),T.constrainByGeometry(I),T.rotationEnabled||(I.rotation=Z.rotation));return I};b.extentToScale=t;b.getAnchor=A;b.getExtent=F;b.getMatrix=G;b.getPaddingMapTranslation=L;b.getPaddingScreenTranslation=K;b.getResolution=C;b.getResolutionToScaleFactor=E;b.getTransform=O;b.getTransformNoRotation=P;b.getWorldScreenWidth=function(I,Q){return Math.round(B(I)/Q)};b.getWorldWidth=B;b.padAndScaleAndRotateBy=Y;b.resize=
U;b.rotateBy=function(I,Q,N){z(I,Q);I.rotation+=N;return I};b.rotateTo=function(I,Q,N){z(I,Q);I.rotation=N;return I};b.scaleAndRotateBy=V;b.scaleTo=function(I,Q,N){z(I,Q);I.scale=N;return I};b.setExtent=function(I,Q,N,T,aa){X(I,Q,N.center);I.scale=t(N,T);aa?.constraints?.constrain(I);return I};b.toMap=W;b.toScreen=H;b.translateBy=S;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/style/StyleDefinition":function(){define(["exports","../../../../../symbols/cim/enums"],
function(b,a){b.StyleLayerType=void 0;(function(d){d[d.BACKGROUND=0]="BACKGROUND";d[d.FILL=1]="FILL";d[d.LINE=2]="LINE";d[d.SYMBOL=3]="SYMBOL";d[d.CIRCLE=4]="CIRCLE"})(b.StyleLayerType||(b.StyleLayerType={}));b.Visibility=void 0;(function(d){d[d.VISIBLE=0]="VISIBLE";d[d.NONE=1]="NONE"})(b.Visibility||(b.Visibility={}));b.SymbolPlacement=void 0;(function(d){d[d.POINT=0]="POINT";d[d.LINE=1]="LINE";d[d.LINE_CENTER=2]="LINE_CENTER"})(b.SymbolPlacement||(b.SymbolPlacement={}));b.RotationAlignment=void 0;
(function(d){d[d.MAP=0]="MAP";d[d.VIEWPORT=1]="VIEWPORT";d[d.AUTO=2]="AUTO"})(b.RotationAlignment||(b.RotationAlignment={}));b.TextJustification=void 0;(function(d){d[d.AUTO=0]="AUTO";d[d.LEFT=1]="LEFT";d[d.CENTER=2]="CENTER";d[d.RIGHT=3]="RIGHT"})(b.TextJustification||(b.TextJustification={}));b.SymbolAnchor=void 0;(function(d){d[d.CENTER=0]="CENTER";d[d.LEFT=1]="LEFT";d[d.RIGHT=2]="RIGHT";d[d.TOP=3]="TOP";d[d.BOTTOM=4]="BOTTOM";d[d.TOP_LEFT=5]="TOP_LEFT";d[d.TOP_RIGHT=6]="TOP_RIGHT";d[d.BOTTOM_LEFT=
7]="BOTTOM_LEFT";d[d.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"})(b.SymbolAnchor||(b.SymbolAnchor={}));b.TextTransform=void 0;(function(d){d[d.NONE=0]="NONE";d[d.UPPERCASE=1]="UPPERCASE";d[d.LOWERCASE=2]="LOWERCASE"})(b.TextTransform||(b.TextTransform={}));b.TranslateAnchor=void 0;(function(d){d[d.MAP=0]="MAP";d[d.VIEWPORT=1]="VIEWPORT"})(b.TranslateAnchor||(b.TranslateAnchor={}));b.TextWritingMode=void 0;(function(d){d[d.HORIZONTAL=0]="HORIZONTAL";d[d.VERTICAL=1]="VERTICAL"})(b.TextWritingMode||(b.TextWritingMode=
{}));class c{}c.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:b.Visibility.VISIBLE}};c.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:b.Visibility.VISIBLE}};c.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:b.Visibility.VISIBLE},"line-cap":{type:"enum",values:["butt","round","square"],default:a.CapType.BUTT},"line-join":{type:"enum",values:["bevel","round","miter"],default:a.JoinType.MITER},"line-miter-limit":{type:"number",
default:2},"line-round-limit":{type:"number",default:1.05}};c.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:b.Visibility.VISIBLE},"symbol-avoid-edges":{type:"boolean",default:!1},"symbol-placement":{type:"enum",values:["point","line","line-center"],default:b.SymbolPlacement.POINT},"symbol-sort-key":{type:"number",default:-1},"symbol-spacing":{type:"number",minimum:1,default:250},"icon-allow-overlap":{type:"boolean",default:!1},"icon-anchor":{type:"enum",values:"center left right top bottom top-left top-right bottom-left bottom-right".split(" "),
default:b.SymbolAnchor.CENTER},"icon-ignore-placement":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"icon-optional":{type:"boolean",default:!1},"icon-padding":{type:"number",minimum:0,default:2},"icon-rotate":{type:"number",default:0},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:b.RotationAlignment.AUTO},"icon-size":{type:"number",minimum:0,
default:1},"text-allow-overlap":{type:"boolean",default:!1},"text-anchor":{type:"enum",values:"center left right top bottom top-left top-right bottom-left bottom-right".split(" "),default:b.SymbolAnchor.CENTER},"text-field":{type:"string"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-ignore-placement":{type:"boolean",default:!1},"text-justify":{type:"enum",values:["auto","left","center","right"],default:b.TextJustification.CENTER},"text-keep-upright":{type:"boolean",
default:!0},"text-letter-spacing":{type:"number",default:0},"text-line-height":{type:"number",default:1.2},"text-max-angle":{type:"number",minimum:0,default:45},"text-max-width":{type:"number",minimum:0,default:10},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-optional":{type:"boolean",default:!1},"text-padding":{type:"number",minimum:0,default:2},"text-rotate":{type:"number",default:0},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:b.RotationAlignment.AUTO},
"text-size":{type:"number",minimum:0,default:16},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:b.TextTransform.NONE},"text-writing-mode":{type:"array",value:"enum",values:["horizontal","vertical"],default:[b.TextWritingMode.HORIZONTAL]}};c.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:b.Visibility.VISIBLE}};c.backgroundPaintDefinition={"background-color":{type:"color",default:[0,0,0,1]},"background-opacity":{type:"number",minimum:0,
maximum:1,default:1},"background-pattern":{type:"string"}};c.fillPaintDefinition={"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-pattern":{type:"string"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:b.TranslateAnchor.MAP}};c.linePaintDefinition=
{"line-blur":{type:"number",minimum:0,default:0},"line-color":{type:"color",default:[0,0,0,1]},"line-dasharray":{type:"array",value:"number",default:[]},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-pattern":{type:"string"},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:b.TranslateAnchor.MAP},
"line-width":{type:"number",minimum:0,default:1}};c.symbolPaintDefinition={"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:b.TranslateAnchor.MAP},
"text-color":{type:"color",default:[0,0,0,1]},"text-halo-blur":{type:"number",minimum:0,default:0},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:b.TranslateAnchor.MAP}};c.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,
default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}};c.circlePaintDefinition={"circle-blur":{type:"number",minimum:0,default:0},"circle-color":{type:"color",default:[0,
0,0,1]},"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:b.TranslateAnchor.MAP}};b.StyleDefinition=c;Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/enums":function(){define(["exports"],function(b){b.CapType=void 0;(function(a){a[a.BUTT=0]="BUTT";a[a.ROUND=1]="ROUND";a[a.SQUARE=2]="SQUARE";a[a.UNKNOWN=4]="UNKNOWN"})(b.CapType||(b.CapType={}));b.JoinType=void 0;(function(a){a[a.BEVEL=0]="BEVEL";a[a.ROUND=1]="ROUND";a[a.MITER=2]="MITER";a[a.UNKNOWN=4]="UNKNOWN"})(b.JoinType||(b.JoinType={}));b.Alignment=void 0;(function(a){a[a.SCREEN=0]="SCREEN";a[a.MAP=1]="MAP"})(b.Alignment||(b.Alignment=
{}));b.ExternalColorMixMode=void 0;(function(a){a[a.Tint=0]="Tint";a[a.Ignore=1]="Ignore";a[a.Multiply=99]="Multiply"})(b.ExternalColorMixMode||(b.ExternalColorMixMode={}));b.ExtremityPlacement=void 0;(function(a){a.Both="Both";a.JustBegin="JustBegin";a.JustEnd="JustEnd";a.None="None"})(b.ExtremityPlacement||(b.ExtremityPlacement={}));b.FillMode=void 0;(function(a){a[a.Mosaic=0]="Mosaic";a[a.Centered=1]="Centered"})(b.FillMode||(b.FillMode={}));b.FontEffects=void 0;(function(a){a[a.Normal=0]="Normal";
a[a.Superscript=1]="Superscript";a[a.Subscript=2]="Subscript"})(b.FontEffects||(b.FontEffects={}));b.FontEncoding=void 0;(function(a){a[a.MSSymbol=0]="MSSymbol";a[a.Unicode=1]="Unicode"})(b.FontEncoding||(b.FontEncoding={}));b.FontType=void 0;(function(a){a[a.Unspecified=0]="Unspecified";a[a.TrueType=1]="TrueType";a[a.PSOpenType=2]="PSOpenType";a[a.TTOpenType=3]="TTOpenType";a[a.Type1=4]="Type1"})(b.FontType||(b.FontType={}));b.AngleAlignment=void 0;(function(a){a[a.Display=0]="Display";a[a.Map=1]=
"Map"})(b.AngleAlignment||(b.AngleAlignment={}));b.AnimatedSymbolRepeatType=void 0;(function(a){a.None="None";a.Loop="Loop";a.Oscillate="Oscillate"})(b.AnimatedSymbolRepeatType||(b.AnimatedSymbolRepeatType={}));b.DominantSizeAxis=void 0;(function(a){a[a.Z=0]="Z";a[a.X=1]="X";a[a.Y=2]="Y"})(b.DominantSizeAxis||(b.DominantSizeAxis={}));b.RotationOrder=void 0;(function(a){a[a.XYZ=0]="XYZ";a[a.ZXY=1]="ZXY";a[a.YXZ=2]="YXZ"})(b.RotationOrder||(b.RotationOrder={}));b.BalloonCalloutStyle=void 0;(function(a){a[a.Rectangle=
0]="Rectangle";a[a.RoundedRectangle=1]="RoundedRectangle";a[a.Oval=2]="Oval"})(b.BalloonCalloutStyle||(b.BalloonCalloutStyle={}));b.BlendingMode=void 0;(function(a){a[a.None=0]="None";a[a.Alpha=1]="Alpha";a[a.Screen=2]="Screen";a[a.Multiply=3]="Multiply";a[a.Add=4]="Add"})(b.BlendingMode||(b.BlendingMode={}));b.BlockProgression=void 0;(function(a){a[a.TTB=0]="TTB";a[a.RTL=1]="RTL";a[a.BTT=2]="BTT"})(b.BlockProgression||(b.BlockProgression={}));b.BillBoardMode=void 0;(function(a){a[a.None=0]="None";
a[a.SignPost=1]="SignPost";a[a.FaceNearPlane=2]="FaceNearPlane"})(b.BillBoardMode||(b.BillBoardMode={}));b.CGAAttributeType=void 0;(function(a){a[a.Float=0]="Float";a[a.String=1]="String";a[a.Boolean=2]="Boolean"})(b.CGAAttributeType||(b.CGAAttributeType={}));b.ClippingType=void 0;(function(a){a[a.Intersect=0]="Intersect";a[a.Subtract=1]="Subtract"})(b.ClippingType||(b.ClippingType={}));b.GeometricEffectArrowType=void 0;(function(a){a.OpenEnded="OpenEnded";a.Block="Block";a.Crossed="Crossed"})(b.GeometricEffectArrowType||
(b.GeometricEffectArrowType={}));b.GeometricEffectControlMeasureLineRule=void 0;(function(a){a.FullGeometry="FullGeometry";a.PerpendicularFromFirstSegment="PerpendicularFromFirstSegment";a.ReversedFirstSegment="ReversedFirstSegment";a.PerpendicularToSecondSegment="PerpendicularToSecondSegment";a.SecondSegmentWithTicks="SecondSegmentWithTicks";a.DoublePerpendicular="DoublePerpendicular";a.OppositeToFirstSegment="OppositeToFirstSegment";a.TriplePerpendicular="TriplePerpendicular";a.HalfCircleFirstSegment=
"HalfCircleFirstSegment";a.HalfCircleSecondSegment="HalfCircleSecondSegment";a.HalfCircleExtended="HalfCircleExtended";a.OpenCircle="OpenCircle";a.CoverageEdgesWithTicks="CoverageEdgesWithTicks";a.GapExtentWithDoubleTicks="GapExtentWithDoubleTicks";a.GapExtentMidline="GapExtentMidline";a.Chevron="Chevron";a.PerpendicularWithArc="PerpendicularWithArc";a.ClosedHalfCircle="ClosedHalfCircle";a.TripleParallelExtended="TripleParallelExtended";a.ParallelWithTicks="ParallelWithTicks";a.Parallel="Parallel";
a.PerpendicularToFirstSegment="PerpendicularToFirstSegment";a.ParallelOffset="ParallelOffset";a.OffsetOpposite="OffsetOpposite";a.OffsetSame="OffsetSame";a.CircleWithArc="CircleWithArc";a.DoubleJog="DoubleJog";a.PerpendicularOffset="PerpendicularOffset";a.LineExcludingLastSegment="LineExcludingLastSegment";a.MultivertexArrow="MultivertexArrow";a.CrossedArrow="CrossedArrow";a.ChevronArrow="ChevronArrow";a.ChevronArrowOffset="ChevronArrowOffset";a.PartialFirstSegment="PartialFirstSegment";a.Arch="Arch";
a.CurvedParallelTicks="CurvedParallelTicks";a.Arc90Degrees="Arc90Degrees"})(b.GeometricEffectControlMeasureLineRule||(b.GeometricEffectControlMeasureLineRule={}));b.GeometricEffectDonutMethod=void 0;(function(a){a.Mitered="Mitered";a.Bevelled="Bevelled";a.Rounded="Rounded";a.Square="Square";a.TrueBuffer="TrueBuffer"})(b.GeometricEffectDonutMethod||(b.GeometricEffectDonutMethod={}));b.GeometricEffectEnclosingPolygonMethod=void 0;(function(a){a.ClosePath="ClosePath";a.ConvexHull="ConvexHull";a.RectangularBox=
"RectangularBox"})(b.GeometricEffectEnclosingPolygonMethod||(b.GeometricEffectEnclosingPolygonMethod={}));b.GeometricEffectExtensionOrigin=void 0;(function(a){a.BeginningOfLine="BeginningOfLine";a.EndOfLine="EndOfLine"})(b.GeometricEffectExtensionOrigin||(b.GeometricEffectExtensionOrigin={}));b.GeometricEffectOffsetMethod=void 0;(function(a){a.Mitered="Mitered";a.Bevelled="Bevelled";a.Rounded="Rounded";a.Square="Square"})(b.GeometricEffectOffsetMethod||(b.GeometricEffectOffsetMethod={}));b.GeometricEffectOffsetOption=
void 0;(function(a){a.Fast="Fast";a.Accurate="Accurate"})(b.GeometricEffectOffsetOption||(b.GeometricEffectOffsetOption={}));b.GeometricEffectOffsetTangentMethod=void 0;(function(a){a.BeginningOfLine="BeginningOfLine";a.EndOfLine="EndOfLine"})(b.GeometricEffectOffsetTangentMethod||(b.GeometricEffectOffsetTangentMethod={}));b.GeometricEffectWaveform=void 0;(function(a){a.Sinus="Sinus";a.Square="Square";a.Triangle="Triangle";a.Random="Random"})(b.GeometricEffectWaveform||(b.GeometricEffectWaveform=
{}));b.GlyphHinting=void 0;(function(a){a[a.None=0]="None";a[a.Default=1]="Default";a[a.Force=2]="Force"})(b.GlyphHinting||(b.GlyphHinting={}));b.GradientAlignment=void 0;(function(a){a[a.Buffered=0]="Buffered";a[a.Left=1]="Left";a[a.Right=2]="Right";a[a.AlongLine=3]="AlongLine"})(b.GradientAlignment||(b.GradientAlignment={}));b.GradientFillMethod=void 0;(function(a){a[a.Linear=0]="Linear";a[a.Rectangular=1]="Rectangular";a[a.Circular=2]="Circular";a[a.Buffered=3]="Buffered"})(b.GradientFillMethod||
(b.GradientFillMethod={}));b.GradientStrokeType=void 0;(function(a){a[a.Discrete=0]="Discrete";a[a.Continuous=1]="Continuous"})(b.GradientStrokeType||(b.GradientStrokeType={}));b.GradientStrokeMethod=void 0;(function(a){a[a.AcrossLine=0]="AcrossLine";a[a.AloneLine=1]="AloneLine"})(b.GradientStrokeMethod||(b.GradientStrokeMethod={}));b.HorizontalAlignment=void 0;(function(a){a[a.Left=0]="Left";a[a.Right=1]="Right";a[a.Center=2]="Center";a[a.Justify=3]="Justify"})(b.HorizontalAlignment||(b.HorizontalAlignment=
{}));b.LeaderLineStyle=void 0;(function(a){a[a.Base=0]="Base";a[a.MidPoint=1]="MidPoint";a[a.ThreePoint=2]="ThreePoint";a[a.FourPoint=3]="FourPoint";a[a.Underline=4]="Underline";a[a.CircularCW=5]="CircularCW";a[a.CircularCCW=6]="CircularCCW"})(b.LeaderLineStyle||(b.LeaderLineStyle={}));b.LineCapStyle=void 0;(function(a){a.Butt="Butt";a.Round="Round";a.Square="Square"})(b.LineCapStyle||(b.LineCapStyle={}));b.LineDashEnding=void 0;(function(a){a.NoConstraint="NoConstraint";a.HalfPattern="HalfPattern";
a.HalfGap="HalfGap";a.FullPattern="FullPattern";a.FullGap="FullGap";a.Custom="Custom"})(b.LineDashEnding||(b.LineDashEnding={}));b.LineDecorationStyle=void 0;(function(a){a[a.None=-1]="None";a[a.Custom=0]="Custom";a[a.Circle=1]="Circle";a[a.OpenArrow=2]="OpenArrow";a[a.ClosedArrow=3]="ClosedArrow";a[a.Diamond=4]="Diamond"})(b.LineDecorationStyle||(b.LineDecorationStyle={}));b.LineGapType=void 0;(function(a){a[a.ExtraLeading=0]="ExtraLeading";a[a.Multiple=1]="Multiple";a[a.Exact=2]="Exact"})(b.LineGapType||
(b.LineGapType={}));b.LineJoinStyle=void 0;(function(a){a.Bevel="Bevel";a.Round="Round";a.Miter="Miter"})(b.LineJoinStyle||(b.LineJoinStyle={}));b.ExpressionReturnType=void 0;(function(a){a[a.Default=0]="Default";a[a.String=1]="String";a[a.Numeric=2]="Numeric"})(b.ExpressionReturnType||(b.ExpressionReturnType={}));b.MarkerPlacementType=void 0;(function(a){a[a.InsidePolygon=0]="InsidePolygon";a[a.PolygonCenter=1]="PolygonCenter";a[a.RandomlyInsidePolygon=2]="RandomlyInsidePolygon"})(b.MarkerPlacementType||
(b.MarkerPlacementType={}));b.MaterialMode=void 0;(function(a){a[a.Tint=0]="Tint";a[a.Replace=1]="Replace";a[a.Multiply=2]="Multiply"})(b.MaterialMode||(b.MaterialMode={}));b.PlacementClip=void 0;(function(a){a[a.ClipAtBoundary=0]="ClipAtBoundary";a[a.RemoveIfCenterOutsideBoundary=1]="RemoveIfCenterOutsideBoundary";a[a.DoNotTouchBoundary=2]="DoNotTouchBoundary";a[a.DoNotClip=3]="DoNotClip"})(b.PlacementClip||(b.PlacementClip={}));b.PlacementEndings=void 0;(function(a){a.NoConstraint="NoConstraint";
a.WithMarkers="WithMarkers";a.WithFullGap="WithFullGap";a.WithHalfGap="WithHalfGap";a.Custom="Custom"})(b.PlacementEndings||(b.PlacementEndings={}));b.PlacementGridType=void 0;(function(a){a.Fixed="Fixed";a.Random="Random";a.RandomFixedQuantity="RandomFixedQuantity"})(b.PlacementGridType||(b.PlacementGridType={}));b.PlacementOnLineRelativeTo=void 0;(function(a){a.LineMiddle="LineMiddle";a.LineBeginning="LineBeginning";a.LineEnd="LineEnd";a.SegmentMidpoint="SegmentMidpoint"})(b.PlacementOnLineRelativeTo||
(b.PlacementOnLineRelativeTo={}));b.PlacementPolygonCenterMethod=void 0;(function(a){a.OnPolygon="OnPolygon";a.CenterOfMass="CenterOfMass";a.BoundingBoxCenter="BoundingBoxCenter"})(b.PlacementPolygonCenterMethod||(b.PlacementPolygonCenterMethod={}));b.PlacementRandomlyAlongLineRandomization=void 0;(function(a){a[a.Low=0]="Low";a[a.Medium=1]="Medium";a[a.High=2]="High"})(b.PlacementRandomlyAlongLineRandomization||(b.PlacementRandomlyAlongLineRandomization={}));b.PlacementStepPosition=void 0;(function(a){a[a.MarkerCenter=
0]="MarkerCenter";a[a.MarkerBounds=1]="MarkerBounds"})(b.PlacementStepPosition||(b.PlacementStepPosition={}));b.PointSymbolCalloutScale=void 0;(function(a){a[a.None=0]="None";a[a.PropUniform=1]="PropUniform";a[a.PropNonuniform=2]="PropNonuniform";a[a.DifUniform=3]="DifUniform";a[a.DifNonuniform=4]="DifNonuniform"})(b.PointSymbolCalloutScale||(b.PointSymbolCalloutScale={}));b.Simple3DLineStyle=void 0;(function(a){a.Tube="Tube";a.Strip="Strip";a.Wall="Wall"})(b.Simple3DLineStyle||(b.Simple3DLineStyle=
{}));b.SizeVariationMethod=void 0;(function(a){a[a.Random=0]="Random";a[a.Increasing=1]="Increasing";a[a.Decreasing=2]="Decreasing";a[a.IncreasingThenDecreasing=3]="IncreasingThenDecreasing"})(b.SizeVariationMethod||(b.SizeVariationMethod={}));b.SymbolUnits=void 0;(function(a){a[a.Relative=0]="Relative";a[a.Absolute=1]="Absolute"})(b.SymbolUnits||(b.SymbolUnits={}));b.TextCase=void 0;(function(a){a[a.Normal=0]="Normal";a[a.LowerCase=1]="LowerCase";a[a.Allcaps=2]="Allcaps"})(b.TextCase||(b.TextCase=
{}));b.TextReadingDirection=void 0;(function(a){a[a.LTR=0]="LTR";a[a.RTL=1]="RTL"})(b.TextReadingDirection||(b.TextReadingDirection={}));b.TextureFilter=void 0;(function(a){a.Draft="Draft";a.Picture="Picture";a.Text="Text"})(b.TextureFilter||(b.TextureFilter={}));b.VerticalAlignment=void 0;(function(a){a[a.Top=0]="Top";a[a.Center=1]="Center";a[a.Baseline=2]="Baseline";a[a.Bottom=3]="Bottom"})(b.VerticalAlignment||(b.VerticalAlignment={}));b.VerticalGlyphOrientation=void 0;(function(a){a[a.Right=0]=
"Right";a[a.Upright=1]="Upright"})(b.VerticalGlyphOrientation||(b.VerticalGlyphOrientation={}));b.WaterbodySize=void 0;(function(a){a[a.Small=0]="Small";a[a.Medium=1]="Medium";a[a.Large=2]="Large"})(b.WaterbodySize||(b.WaterbodySize={}));b.WaveStrength=void 0;(function(a){a[a.Calm=0]="Calm";a[a.Rippled=1]="Rippled";a[a.Slight=2]="Slight";a[a.Moderate=3]="Moderate"})(b.WaveStrength||(b.WaveStrength={}));Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/RenderableTile":function(){define(["exports",
"../../../../chunks/mat3f32","./TiledDisplayObject"],function(b,a,c){class d extends c.TiledDisplayObject{_createTransforms(){return{dvs:a.create(),tileMat3:a.create()}}}b.RenderableTile=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/RasterColorizerTechnique":function(){define("require exports ../../../chunks/tslib.es6 ../../2d/engine/imagery/enums ./TileBlendTechniqueConfiguration ../../../chunks/RasterColorizer.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w){class v extends g.ShaderTechnique{initializeProgram(p){return new m.Program(p.rctx,v.shader.get().build(this.configuration),e.Default3D)}initializePipeline(){return w.makePipelineState({blending:w.simpleBlendingParams(l.BlendFactor.ONE,l.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:w.defaultColorWriteParams})}}v.shader=new k.ReloadableShaderModule(n.RasterColorizer,()=>new Promise((p,h)=>b(["../webgl-engine/core/shaderLibrary/raster/RasterColorizer.glsl"],p,h)));
class x extends f.TileBlendTechniqueConfiguration{constructor(){super(...arguments);this.colorizerType=d.RasterColorizerType.Stretch;this.stretchType=d.RasterColorizerStretchType.Noop;this.applyColormap=!0;this.requireBilinearWithNN=!1}}c.__decorate([q.parameter({count:d.RasterColorizerType.COUNT})],x.prototype,"colorizerType",void 0);c.__decorate([q.parameter({count:d.RasterColorizerStretchType.COUNT})],x.prototype,"stretchType",void 0);c.__decorate([q.parameter()],x.prototype,"applyColormap",void 0);
c.__decorate([q.parameter()],x.prototype,"requireBilinearWithNN",void 0);a.RasterColorizerTechnique=v;a.RasterColorizerTechniqueConfiguration=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/support/MultiSizeFramebuffer":function(){define(["exports","../../../webgl/enums","../../../webgl/FramebufferObject","../../../webgl/RenderbufferDescriptor","../../../webgl/TextureDescriptor"],function(b,a,c,d,f){class n{constructor(k){this._rctx=k;this._fbos=new Map}get(k){return this._getPool(k)}dispose(){this._fbos.forEach(k=>
k.dispose());this._fbos.clear()}_getPool(k){var g=this._fbos.get(k);if(g)return g;g=new c.FramebufferObject(this._rctx,new f.TextureDescriptor(k),new d.RenderbufferDescriptor(a.RenderbufferFormat.DEPTH24_STENCIL8,k));this._fbos.set(k,g);return g}}b.MultiSizeFramebuffer=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TileRenderInfo":function(){define(["exports","../../../core/PooledArray"],function(b,a){class c{constructor(){this.sourceLod=[0,0,0];this.offset=
[0,0];this.scale=1;this.layerIndex=0;this.isVTLBackground=!1;this.vtlNeighborInfos=new a({allocator:f=>f||new d})}}class d{constructor(){this.sourceLayerInfo=null;this.sourceLod=[0,0,0];this.offset=[-1,0]}}b.TileRenderInfo=c;b.VTLNeighhborInfo=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/ComponentIntersectionData":function(){define(["exports","../../../../../core/mathUtils","../../../../../chunks/vec3f64","../../../../../geometry/support/aaBoundingBox",
"../../materials/internal/MaterialUtil"],function(b,a,c,d,f){function n(h,t,r){let u=0,y=Infinity;for(let A=0;3>A;++A){var z=h[A];if(t[A]<z){if(1E-6>=r[A])return!1;u=Math.max(u,(z-t[A])/r[A])}else-1E-6>=r[A]&&(y=Math.min(y,(z-t[A])/r[A]));if(u>y)return!1;z=h[A+3];if(t[A]>z){if(-1E-6<=r[A])return!1;u=Math.max(u,(z-t[A])/r[A])}else 1E-6<=r[A]&&(y=Math.min(y,(z-t[A])/r[A]));if(u>y)return!1}return!0}function k(h,t,r,u,y,z){let A=u;for(;r<A;){var C=h[r];t[6*C+y+3]<=z?++r:(--A,h[r]=h[A],h[A]=C)}C=r;for(A=
u;C<A;)u=h[A-1],t[6*u+y]>=z?--A:(h[A-1]=h[C],h[C]=u,++C);return{next:r,mid:C}}function g(h,t,r,u){if(u<=r)return d.fromValues(NaN,NaN,NaN,NaN,NaN,NaN);var y=6*h[r];for(var z=0;3>z;++z)x[z]=t[y+0+z],p[z]=t[y+3+z];for(r+=1;r<u;++r)for(y=6*h[r],z=0;3>z;++z)x[z]=Math.min(x[z],t[y+0+z]),p[z]=Math.max(p[z],t[y+3+z]);return d.fromValues(x[0],x[1],x[2],p[0],p[1],p[2])}function q(h){var t=h[3]-h[0];const r=h[4]-h[1],u=h[5]-h[2];t=t>r?t>u?0:r>u?1:2:r>u?1:u>t?2:0;return{axis:t,midValue:(h[t]+h[t+3])/2}}function e(h,
t,r,u,y){r-=t;const z=new Float32Array(6*r);for(let C=0;C<r;++C){var A=3*(C+t);const E=h[A]*y,B=h[A+1]*y;A=h[A+2]*y;for(let D=0;3>D;++D){const F=u[E+D],K=u[B+D],L=u[A+D];z[6*C+D]=Math.min(F,K,L);z[6*C+3+D]=Math.max(F,K,L)}}return z}function m(h,t,r,u){const y=u-r;var z=0;for(var A=r;A<u;++A)for(var C=0;3>C;++C)z=Math.max(t[3*A+C],z);u=65535>=z?new Uint16Array(3*y):new Uint32Array(3*y);for(z=0;z<y;++z)for(A=3*(h[z]+r),C=0;3>C;++C)u[3*z+C]=t[A+C];return u}class l{constructor(h,t,r,u,y){this.aabb=h;
this.axis=t;this.d=r;this.midStartIndex=u;this.rightStartIndex=y}}class w{constructor(h,t,r,u){this.globalTriangleVertexIndices=h;this.firstTriangleIndex=t;this.positions=u;this._rayDirection=c.create();this.bspNodeTree=[];const y=r-t,z=65535>=y?new Uint16Array(y):new Uint32Array(y);this.indices=z;for(let B=0;B<y;++B)z[B]=B;const A=e(h,t,r,u.data,u.stride),C=a.clamp(Math.log2(y/40),2,10),E=(B,D,F)=>{var K=g(z,A,B,D);const L=D-B;if(40>=L)return B=new l(K,void 0,0,B,D),this.bspNodeTree.push(B),B;const {axis:G,
midValue:O}=q(K),P=k(z,A,B,D,G,O),J=(R,X)=>{if(!(F>C)){var U=X-R;if(!(40>U||U>=.8*L))return E(R,X,F+1)}};K=new l(K,G,O,P.next,P.mid);this.bspNodeTree.push(K);K.leftNode=J(B,P.next);K.rightNode=J(P.mid,D);return K};E(0,y,0);this.triangleVertexIndices=m(z,h,t,r)}intersectRayTriangleRange(h,t){if(!(h>=t)){var r=this.triangleVertexIndices,u=this.positions.data,y=this.positions.stride,z=this._rayOrigin,A=z[0],C=z[1];z=z[2];var E=this._rayDirection,B=E[0],D=E[1];E=E[2];for(let Y=h,W=3*h;Y<t;++Y){var F=
r[W++]*y,K=u[F++],L=u[F++],G=u[F];F=r[W++]*y;var O=u[F++],P=u[F++],J=u[F];F=r[W++]*y;var R=u[F++],X=u[F++];O-=K;P-=L;J-=G;R-=K;X-=L;F=u[F]-G;var U=D*F-X*E,M=E*R-F*B;const H=B*X-R*D;var V=O*U+P*M+J*H;if(!(Math.abs(V)<=Number.EPSILON)){K=A-K;L=C-L;G=z-G;U=K*U+L*M+G*H;if(0<V){if(0>U||U>V)continue}else if(0<U||U<V)continue;M=L*J-P*G;G=G*O-J*K;L=K*P-O*L;K=B*M+D*G+E*L;if(0<V){if(0>K||U+K>V)continue}else if(0<K||U+K<V)continue;G=(R*M+X*G+F*L)/V;0<=G&&(V=this.indices[Y]+this.firstTriangleIndex,O=f.computeNormal(O,
P,J,R,X,F,v),this._callback(G,O,V,!1))}}w.numFacesTested+=t-h}}intersectRay(h,t){w.numFacesTested=0;var r=c.fromValues(h.r0[0],h.r0[1],h.r0[2]),u=c.fromValues(h.r1[0],h.r1[1],h.r1[2]);h=u[0]-r[0];const y=u[1]-r[1];u=u[2]-r[2];1E-6>h*h+y*y+u*u||(this._rayOrigin=r,r=this._rayDirection,r[0]=h,r[1]=y,r[2]=u,r=this.triangleVertexIndices.length/3,this._callback=t,this.intersectRayBSP(this.bspNodeTree[0],0,r))}intersectRayBSP(h,t,r){const u=this._rayOrigin,y=this._rayDirection;if(n(h.aabb,u,y)){var z=h.axis,
A=h.d;if(u[z]<A||0>y[z]){const C=h.midStartIndex;if(t<C){const E=h.leftNode;void 0!==E?this.intersectRayBSP(E,t,C):this.intersectRayTriangleRange(t,C)}}this.intersectRayTriangleRange(h.midStartIndex,h.rightStartIndex);if(u[z]>A||0<y[z])t=h.rightStartIndex,t<r&&(h=h.rightNode,void 0!==h?this.intersectRayBSP(h,t,r):this.intersectRayTriangleRange(t,r))}}get estimatedMemoryUsage(){return this.triangleVertexIndices.byteLength+this.indices.byteLength}}w.numFacesTested=0;const v=c.create(),x=[Infinity,Infinity,
Infinity],p=[-Infinity,-Infinity,-Infinity];b.ComponentIntersectionData=w;b.componentMinimalSizeForIntersectionData=200;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/TerrainTechniqueConfiguration":function(){define("exports ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderLibrary/terrain/Overlay.glsl ../core/shaderLibrary/terrain/TileBlendInput ../core/shaderTechnique/ShaderTechniqueConfiguration ../materials/DefaultTechniqueConfiguration".split(" "),
function(b,a,c,d,f,n,k,g,q,e){class m extends e.DefaultTechniqueConfiguration{constructor(){super(...arguments);this.output=c.ShaderOutput.Color;this.overlayMode=k.OverlayMode.Disabled;this.tileBlendInput=g.TileBlendInput.LayerOnly;this.receiveAmbientOcclusion=this.screenSizePerspective=this.visualizeNormals=this.tileBorders=this.invisible=this.hasCloudsReflections=this.hasScreenSpaceReflections=this.renderOccluded=this.textureFadingEnabled=this.backfaceCullingEnabled=this.hasSlicePlane=this.receiveShadows=
this.doublePrecisionRequiresObfuscation=this.spherical=!1;this.pbrMode=n.PBRMode.Terrain}}a.__decorate([q.parameter({count:c.ShaderOutput.COUNT})],m.prototype,"output",void 0);a.__decorate([q.parameter({count:k.OverlayMode.COUNT})],m.prototype,"overlayMode",void 0);a.__decorate([q.parameter({count:g.TileBlendInput.COUNT})],m.prototype,"tileBlendInput",void 0);a.__decorate([q.parameter()],m.prototype,"spherical",void 0);a.__decorate([q.parameter()],m.prototype,"doublePrecisionRequiresObfuscation",
void 0);a.__decorate([q.parameter()],m.prototype,"receiveShadows",void 0);a.__decorate([q.parameter()],m.prototype,"hasSlicePlane",void 0);a.__decorate([q.parameter()],m.prototype,"backfaceCullingEnabled",void 0);a.__decorate([q.parameter()],m.prototype,"textureFadingEnabled",void 0);a.__decorate([q.parameter()],m.prototype,"renderOccluded",void 0);a.__decorate([q.parameter()],m.prototype,"hasScreenSpaceReflections",void 0);a.__decorate([q.parameter()],m.prototype,"hasCloudsReflections",void 0);a.__decorate([q.parameter()],
m.prototype,"invisible",void 0);a.__decorate([q.parameter()],m.prototype,"tileBorders",void 0);a.__decorate([q.parameter()],m.prototype,"visualizeNormals",void 0);a.__decorate([q.parameter()],m.prototype,"screenSizePerspective",void 0);a.__decorate([q.parameter()],m.prototype,"receiveAmbientOcclusion",void 0);a.__decorate([q.parameter({count:n.PBRMode.COUNT})],m.prototype,"pbrMode",void 0);a.__decorate([q.parameter({constValue:d.NormalType.Compressed})],m.prototype,"normalType",void 0);a.__decorate([q.parameter({constValue:f.TextureCoordinateAttributeType.Compressed})],
m.prototype,"textureCoordinateType",void 0);a.__decorate([q.parameter({constValue:!1})],m.prototype,"highStepCount",void 0);a.__decorate([q.parameter({constValue:!1})],m.prototype,"useCustomDTRExponentForWater",void 0);a.__decorate([q.parameter({constValue:!1})],m.prototype,"useFillLights",void 0);a.__decorate([q.parameter({constValue:!0})],m.prototype,"hasColorTexture",void 0);b.TerrainTechniqueConfiguration=m;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TerrainSurfacePerformanceInfo":function(){define(function(){class b{constructor(){this.numMerged=
this.numSplit=this.numRendered=this.numVisible=this.numLeaves=this.numNodes=0;this.numRenderedPerLevel=[];this.numLoadedPerLevel=[]}}return b})},"esri/views/3d/terrain/TilingSchemeLogic":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../geometry/projection ../../../geometry/support/aaBoundingRect ../../../geometry/support/spatialReferenceUtils ../../../layers/support/layerUtils ../../ViewingMode ./terrainUtils ./TilingScheme".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p){b.TilingSchemeLogic=class extends c{constructor(h){super(h)}initialize(){this.addHandles([this.layers.on("change",()=>this._update()),d.watch(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme())]);this._update();this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._waitTask=null;this.layers.destroy()}_update(){this._waitTask=null;if(!this.tilingSchemeLocked){var h;this.layers.some(r=>!w.isTiledLayer(r)||r.isRejected()?!1:
r.isFulfilled()&&null==x.getTiledLayerInfo(r,this.viewSpatialReference,this.viewingMode)?!1:(h=r,"vector-tile"!==r?.type&&!x.isProjectableRasterLayer(r)));if(h)if(h.isResolved()){var t=x.getTiledLayerInfo(h,this.viewSpatialReference,this.viewingMode);null!=t&&(t=new p.TilingScheme(t.tileInfo),this._lockTilingScheme(t))}else this._updateWhen(h)}}_updateWhen(h){const t=h.when().catch(()=>{}).then(()=>{t!==this._waitTask||this.destroyed||this._update()});this._waitTask=t}_lockTilingScheme(h){if(this.viewingMode===
v.ViewingMode.Global){const t=h.levels.length-1;h.spatialReference.isWebMercator?h=p.TilingScheme.makeWebMercatorAuxiliarySphere(t):e.canProjectToWGS84ComparableLonLat(h.spatialReference)&&(h=p.TilingScheme.makeGCSWithTileSize(h.spatialReference,h.pixelSize,t))}this.tilingSchemeLocked=!0;this.tilingScheme=h;this.extentHelper.tilingScheme=this.tilingScheme;this._updateTiledLayerExtent();this.removeAllHandles();this.addHandles(d.watch(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",
this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===v.ViewingMode.Global){var h=this.extentHelper.viewSpatialReference;const t=e.canProjectToWGS84ComparableLonLat(h)||l.isMars(h)||l.isMoon(h);h.isWebMercator?this.tilingScheme=p.TilingScheme.WebMercatorAuxiliarySphere:t&&(this.tilingScheme=p.TilingScheme.makeGCSWithTileSize(h,256));this._set("extent",this.extentHelper.layerViewsExtent)}else h=this.extentHelper.layerViewsExtent,null==h||m.equals(h,this.extent)||(this.tilingScheme=
p.TilingScheme.fromExtent(h,this.extentHelper.viewSpatialReference),this._set("extent",h))}get test(){return{lockTilingScheme:h=>this._lockTilingScheme(h),done:!this._waitTask}}};a.__decorate([f.property()],b.TilingSchemeLogic.prototype,"tilingScheme",void 0);a.__decorate([f.property({readOnly:!0})],b.TilingSchemeLogic.prototype,"extent",void 0);a.__decorate([f.property({value:!1})],b.TilingSchemeLogic.prototype,"tilingSchemeLocked",void 0);a.__decorate([f.property({constructOnly:!0})],b.TilingSchemeLogic.prototype,
"viewSpatialReference",void 0);a.__decorate([f.property({constructOnly:!0})],b.TilingSchemeLogic.prototype,"layers",void 0);a.__decorate([f.property({constructOnly:!0})],b.TilingSchemeLogic.prototype,"extentHelper",void 0);a.__decorate([f.property({constructOnly:!0})],b.TilingSchemeLogic.prototype,"viewingMode",void 0);b.TilingSchemeLogic=a.__decorate([q.subclass("esri.views.3d.terrain.TilingSchemeLogic")],b.TilingSchemeLogic);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/UpsampleInfo":function(){define(["exports",
"../../../chunks/vec2f64"],function(b,a){class c{constructor(){this.offset=a.create();this.scale=0;this.tile=null}init(d,f,n,k){this.tile=d;this.offset[0]=f;this.offset[1]=n;this.scale=k}dispose(){this.tile=null;this.offset[0]=0;this.scale=this.offset[1]=0}}b.UpsampleInfo=c;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/Stage":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/PooledArray ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../state/helpers/SceneIntersectionHelper ./lib/ChangeSet ./lib/UpdatePolicy ./lib/WebGLLayer ./parts/Model ./parts/RenderView ../../support/Scheduler".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h){b.Stage=class extends c{constructor(t){super(t);this._model=new x.Model;this._layers=new d;this._asyncChangeSet=new l.ChangeSet;this._syncChangeSet=new l.ChangeSet;this._layerSyncSet=new Set}initialize(){this._set("renderView",new p.RenderView(this));this._frameTask=this.view.resourceController.scheduler.registerTask(h.TaskPriority.STAGE,this);this.addHandles(this._frameTask)}get viewingMode(){return this.view.state.viewingMode}get updating(){return this.running||
this.renderView.updating||this._frameTask.updating}get renderer(){return this.renderView?.renderer}add(t){this._model.add(t);v.isWebGLLayer(t)&&this._addLayer(t);this.renderView.requestRender()}remove(t){null!=t&&!this.destroyed&&this._model.remove(t)&&(v.isWebGLLayer(t)&&this._removeLayer(t),this.renderView.requestRender())}addMany(t){null!=t&&(this._model.addMany(t),this.renderView.requestRender())}removeMany(t){null!=t&&(this._model?.removeMany(t),this.renderView?.requestRender())}forEachOfType(t,
r){this._model.forEachOfType(t,r)}handleEvent(t,r){this.destroyed||(this._model.dirtySet[t](r),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty||!this._asyncChangeSet.empty}runTask(t){this._frameTask.processQueue(t);this._commit(t)}_commit(t){const r=this._model.dirtySet;this._asyncChangeSet.empty||t.done||(this.renderer.modify(this._asyncChangeSet,t),this.renderView.requestRender(),t.madeProgress());this._layers.forAll(u=>{if(!t.done){var y=this._layerSyncSet.has(u.id)||
u.updatePolicy===w.UpdatePolicy.SYNC,z=y?this._syncChangeSet:this._asyncChangeSet;r.commitLayer(u.id,z);this._layerSyncSet.delete(u.id);z.empty||(this.renderer.modify(z,y?h.noBudget:t),this.renderView.requestRender(),t.madeProgress())}});this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,h.noBudget),this.renderView.requestRender(),t.madeProgress());this._layers.forAll(u=>{t.done||this._layerSyncSet.has(u.id)||u.updatePolicy!==w.UpdatePolicy.ASYNC||(r.commitLayer(u.id,this._asyncChangeSet),
this._asyncChangeSet.empty||(this.renderer.modify(this._asyncChangeSet,t),this.renderView.requestRender(),t.madeProgress()))});this._layerSyncSet.clear();this.notifyChange("running")}commitSyncLayers(){const t=this._model.dirtySet;this._layers.forAll(r=>{this._layerSyncSet.has(r.id)||r.updatePolicy===w.UpdatePolicy.SYNC?(t.commitLayer(r.id,this._syncChangeSet),this._layerSyncSet.delete(r.id)):t.commitSyncUpdates(r.id,this._syncChangeSet)});for(const r of this._layerSyncSet)t.commitLayer(r,this._syncChangeSet);
this._layerSyncSet.clear();this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,h.noBudget),this.renderView.requestRender())}_commitLayer(t){this._model.dirtySet.commitLayer(t.id,this._syncChangeSet);this._layerSyncSet.delete(t.id);this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,h.noBudget),this.renderView.requestRender())}schedule(t,r){return this._frameTask.schedule(t,r)}reschedule(t,r){return this._frameTask.reschedule(t,r)}syncLayer(t){this._layerSyncSet.add(t);
this.renderView.requestRender()}getObject(t){return this._model.getObject(t)}get layers(){return this._layers}_addLayer(t){this._layers.includes(t)||this._layers.push(t)}_removeLayer(t){this._commitLayer(t);null!=this._layers.removeUnordered(t)&&(this._model.dirtySet.getResidentRenderGeometries(t.id,this._syncChangeSet.removes),this.renderer.modify(this._syncChangeSet,h.noBudget))}addRenderPlugin(t,r){r=this.renderer.renderPlugins.add(t,r);const u=()=>{m.isIntersectionHandler(t)&&this.view.sceneIntersectionHelper.addIntersectionHandler(t)};
if(f.isPromiseLike(r))return r.then(u);u()}removeRenderPlugin(t){this.destroyed||(m.isIntersectionHandler(t)&&this.view.sceneIntersectionHelper.removeIntersectionHandler(t),this.renderer.renderPlugins.remove(t))}get performanceInfo(){return this._model.getStats()}get test(){const t=this;return{getCount(r){return t._model.test.content.filter(u=>u.type===r).length},model:t._model}}};b.Stage.DebugSettings={endFrameContentValidation:!1};a.__decorate([n.property({constructOnly:!0})],b.Stage.prototype,
"view",void 0);a.__decorate([n.property({constructOnly:!0})],b.Stage.prototype,"options",void 0);a.__decorate([n.property({readOnly:!0})],b.Stage.prototype,"viewingMode",null);a.__decorate([n.property({constructOnly:!0})],b.Stage.prototype,"container",void 0);a.__decorate([n.property({readOnly:!0})],b.Stage.prototype,"updating",null);a.__decorate([n.property({constructOnly:!0})],b.Stage.prototype,"_model",void 0);a.__decorate([n.property({autoDestroy:!0})],b.Stage.prototype,"renderView",void 0);a.__decorate([n.property({readOnly:!0})],
b.Stage.prototype,"renderer",null);a.__decorate([n.property({readOnly:!0})],b.Stage.prototype,"running",null);b.Stage=a.__decorate([e.subclass("esri.views.3d.webgl-engine.Stage")],b.Stage);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/parts/Model":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4f64 ../lib/ContentObjectType ../lib/GridLocalOriginFactory ../lib/ModelDirtySet ../lib/RenderGeometry ../lib/Util ../lib/WebGLLayer".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x){b.Model=class extends c{constructor(){super(...arguments);this.dirtySet=new l({model:this});this._content=new Map;this._originFactory=new m.GridLocalOriginFactory(null)}getObject(h){return this._content.get(h)}add(h){const t=h.id;v.assert(!this._content.has(t),"Model/Stage already contains object to be added");this._content.set(t,h);x.isWebGLLayer(h)&&this.dirtySet.layerAdded(h)}remove(h){if(!this._content.has(h.id))return!1;this._content.delete(h.id);x.isWebGLLayer(h)&&
this.dirtySet.layerRemoved(h);return!0}addMany(h){for(const t of h)t&&(v.assert(!this._content.has(t.id),"Model/Stage already contains object to be added"),this._content.set(t.id,t))}removeMany(h){for(const t of h)t&&(v.assert(this._content.has(t.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(t.id))}has(h){return this._content.has(h.id)}forEachOfType(h,t){this._content.forEach(r=>{r.type===h&&t(r)})}getRenderGeometry(h,t){const r=new w.RenderGeometry(t,{castShadow:h.castShadow,
objectShaderTransformation:h.shaderTransformation});r.transformation=h.getCombinedStaticTransformation(t,p);({localOrigin:h}=t);r.localOrigin=null!=h?h:this._originFactory.getOrigin(r.boundingSphere);return r}updateRenderGeometryTransformation(h,t,r){if(null==h)return!1;r.transformation=h.getCombinedStaticTransformation(t,p);h=this._originFactory.getOrigin(r.boundingSphere);return r.localOrigin!==h}getStats(){const h={},t=Array.from(this._content.values());for(let r=0;r<e.ContentObjectType.COUNT;++r)h[r]=
t.filter(u=>u.type===r).length;return{contentTypes:h,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){return{content:Array.from(this._content.values())}}};a.__decorate([d.property({constructOnly:!0})],b.Model.prototype,"dirtySet",void 0);b.Model=a.__decorate([g.subclass("esri.views.3d.webgl-engine.parts.Model")],b.Model);const p=q.create();Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ModelDirtySet":function(){define("../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/MapUtils ../../../../core/uid ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ./ModelDirtyTypes ./Util".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m){class l{constructor(w,v,x,p){this.operation=w;this.geometry=v;this.states=x;this.sync=p}}a=class extends a{constructor(w){super(w);this._residentGeomRecords=new Map;this._dirtyGeomRecords=new Map;this.dirty=!1}commitLayer(w,v){const x=this._dirtyGeomRecords.get(w);x&&(x.forEach((p,h)=>{const t=this._ensureGeomRecord(w,h);p.forEach(({geometry:r,operation:u,states:y},z)=>{let A=!1;if(u===e.DirtyOperation.UPDATE){const C=t.get(z);if(C){if(y&e.DirtyState.TRANSFORMATION){const E=
this.model.getObject(h);this.model.updateRenderGeometryTransformation(E,r,C)&&(A=!0)}A||v.updates.push({renderGeometry:C,updateType:y})}else m.assert(!1,"ModelDirtySet.commitLayer: invalid update")}if(u===e.DirtyOperation.REMOVE||A)(y=t.get(z))?(v.removes.push(y),t.delete(z)):u===e.DirtyOperation.REMOVE&&m.assert(!1,"ModelDirtySet.commitLayer: invalid remove");if(u===e.DirtyOperation.ADD||A)u=this.model.getObject(h),null!=u&&(r=this.model.getRenderGeometry(u,r),v.adds.push(r),t.set(z,r))});0===t.size&&
this._residentGeomRecords.get(w).delete(h)}),0===this._residentGeomRecords.get(w).size&&this._residentGeomRecords.delete(w),this._dirtyGeomRecords.delete(w),this.dirty=this._hasDirtyGeometryRecords)}commitSyncUpdates(w,v){const x=this._dirtyGeomRecords.get(w);x&&x.forEach((p,h)=>{const t=this._ensureGeomRecord(w,h);p.forEach(({geometry:r,operation:u,states:y,sync:z},A)=>{let C=!1;u===e.DirtyOperation.UPDATE&&z&&((u=t.get(A))?(y&e.DirtyState.TRANSFORMATION&&(z=this.model.getObject(h),this.model.updateRenderGeometryTransformation(z,
r,u)&&(C=!0)),C||v.updates.push({renderGeometry:u,updateType:y})):m.assert(!1,"ModelDirtySet.commitSyncUpdates: invalid update"))})})}getResidentRenderGeometries(w,v){(w=this._residentGeomRecords.get(w))&&w.forEach(x=>x.forEach(p=>v.push(p)))}_objectStateChanged(w,v){for(const x of v.geometries)this._updateOrCreateDirtyRecord(v,x,null,e.DirtyOperation.UPDATE,w)}visibilityChanged(w){this._objectStateChanged(e.DirtyState.VISIBILITY,w)}highlightChanged(w){this._objectStateChanged(e.DirtyState.HIGHLIGHT,
w)}occlusionChanged(w){this._objectStateChanged(e.DirtyState.OCCLUDEE,w)}attributesChanged({object:w,geometry:v,sync:x}){this._updateOrCreateDirtyRecord(w,v,null,e.DirtyOperation.UPDATE,e.DirtyState.GEOMETRY,x)}layerAdded(w){w.objects.forAll(v=>this._layerObjectAdded(w,v))}layerRemoved(w){w.objects.forAll(v=>this._layerObjectRemoved(w,v))}layerObjectAdded(w){this._layerObjectAdded(w.layer,w.object)}_layerObjectAdded(w,v){w=w.id;for(const x of v.geometries)this._geometryAdded(v,x,w)}layerObjectRemoved(w){this._layerObjectRemoved(w.layer,
w.object)}layerObjectsAdded(w){for(const v of w.objects)this._layerObjectAdded(w.layer,v)}layerObjectsRemoved(w){for(const v of w.objects)this._layerObjectRemoved(w.layer,v)}_layerObjectRemoved(w,v){w=w.id;for(const x of v.geometries)this._geometryRemoved(v,x,w)}transformationChanged(w){const v=this._getParentLayerId(w);this._ensureGeomRecord(v,w.id).forEach(x=>{this._updateOrCreateDirtyRecord(w,x.geometry,v,e.DirtyOperation.UPDATE,e.DirtyState.TRANSFORMATION)})}shaderTransformationChanged(w){const v=
this._getParentLayerId(w);this._ensureGeomRecord(v,w.id).forEach(x=>{x.objectShaderTransformationChanged(w.shaderTransformation)})}geometryAdded(w){this._geometryAdded(w.object,w.geometry)}_geometryAdded(w,v,x=null){this._updateOrCreateDirtyRecord(w,v,x,e.DirtyOperation.ADD)}geometryRemoved(w){this._geometryRemoved(w.object,w.geometry)}_geometryRemoved(w,v,x=null){this._updateOrCreateDirtyRecord(w,v,x,e.DirtyOperation.REMOVE)}_updateOrCreateDirtyRecord(w,v,x,p,h=e.DirtyState.NONE,t=!1){x=x??this._getParentLayerId(w);
const r=v.id;w=this._ensureDirtyRecord(x,w.id);(x=w.get(r))?(v=x.operation,v===e.DirtyOperation.REMOVE&&p===e.DirtyOperation.ADD&&x.states!==e.DirtyState.NONE?x.operation=e.DirtyOperation.UPDATE:v===e.DirtyOperation.REMOVE&&p===e.DirtyOperation.ADD||v===e.DirtyOperation.ADD&&p===e.DirtyOperation.REMOVE?w.delete(r):(v!==e.DirtyOperation.UPDATE||p!==e.DirtyOperation.REMOVE&&p!==e.DirtyOperation.UPDATE?m.assert((v===e.DirtyOperation.REMOVE||v===e.DirtyOperation.ADD)&&p===e.DirtyOperation.UPDATE,"ModelDirtySet.objectGeometryAdded: inconsistent state"):
x.operation=p,x.states|=h),x.sync=x.sync||t):w.set(r,new l(p,v,h,t));this.dirty=this._hasDirtyGeometryRecords}_ensureGeomRecord(w,v){let x=this._residentGeomRecords.get(w);x||(x=new Map,this._residentGeomRecords.set(w,x));w=x.get(v);w||(w=new Map,x.set(v,w));return w}get _hasDirtyGeometryRecords(){return c.someMap(this._dirtyGeomRecords,w=>c.someMap(w,v=>v&&0<v.size))}_ensureDirtyRecord(w,v){let x=this._dirtyGeomRecords.get(w);x||(x=new Map,this._dirtyGeomRecords.set(w,x));w=x.get(v);w||(w=new Map,
x.set(v,w));return w}_getParentLayerId(w){return w.parentLayer?w.parentLayer.id:d.NullUID}formatDebugInfo(){const w=["ADD","UPD",void 0,"REM"];let v="";this._dirtyGeomRecords.forEach((x,p)=>{x.forEach((h,t)=>{0<v.length&&(v+="\n");v+=p+"."+t;const r=[];h.forEach(u=>{const y=u.operation;r[y]||(r[y]=[]);r[y].push(u.geometry.id)});for(h=0;h<r.length;h++)if(r[h])for(v+=" "+w[h-1]+": ",t=0;t<r[h].length;t++)v+=r[h][t]+", "})});return v}get test(){const w=this;return{get residentLayerCount(){return w._residentGeomRecords.size},
get residentObjectCount(){return Array.from(w._residentGeomRecords.values()).reduce((v,x)=>v+x.size,0)},commit:v=>w._dirtyGeomRecords.forEach((x,p)=>w.commitLayer(p,v))}}};b.__decorate([f.property({constructOnly:!0})],a.prototype,"model",void 0);b.__decorate([f.property()],a.prototype,"dirty",void 0);return a=b.__decorate([q.subclass("esri.views.3d.webgl-engine.lib.ModelDirtySet")],a)})},"esri/views/3d/webgl-engine/parts/RenderView":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/has ../../../../core/Logger ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/scheduling ../../../../core/time ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../collections/Component/ComponentObjectCollection ../core/shaderTechnique/ShaderTechniqueRepository ../lib/basicInterfaces ../lib/CompositingHelper ../lib/depthRangeUtils ../lib/GLMaterialRepository ../lib/MagnifierHelper ../lib/Material ../lib/ObjectAndLayerIdRenderHelper ../lib/Renderer ../lib/RenderingContext ../lib/TextureRepository ../materials/markerTextureRepository ../materials/stippleTextureRepository ../materials/internal/WaterTextureRepository ./contextCache ./requireUtils ./ScreenshotManager ./testUtils ../../../support/RenderState ../../../webgl/contextUtils ../../../webgl/capabilities/isWebGL2Context".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A,C,E,B,D,F,K,L,G,O,P,J,R,X){b.RenderView=class extends c{constructor(M){super({});this.events=new d;this.waterTextureRepository=new K.WaterTextureRepository;this._magnifierHelper=new y.MagnifierHelper;this.objectAndLayerIdRenderHelper=f("enable-feature:objectAndLayerId-rendering")?new A.ObjectAndLayerIdRenderHelper:null;this._idleSuspend=this._needsRender=this._needsUpdate=!0;this._needsWaterReflectionUpdate=!1;this._lastAnimationUpdate=0;this._container=
M.container;this._viewingMode=M.viewingMode;this._initializeContext(M);this.addHandles([g.watch(()=>this.waterTextureRepository?.updating,()=>this.requestRender(),g.initial),g.watch(()=>M.view.qualityProfile,Y=>this.renderer?.updateRenderFeatures(Y),g.syncAndInitial),this._magnifierHelper.events.on("request-render",()=>this.requestRender())]);const {memoryController:V}=M.view.resourceController;this.stippleTextureRepository=F.createStippleTextureRepository(this._rctx,V);this.markerTextureRepository=
D.createMarkerTextureRepository(this._rctx,V);this._shaderTechniqueRepository=new p.ShaderTechniqueRepository({rctx:this._rctx,viewingMode:M.viewingMode,stippleTextureRepository:this.stippleTextureRepository,waterTextureRepository:this.waterTextureRepository,markerTextureRepository:this.markerTextureRepository});this._textureRepository=new B.TextureRepository(M,this._shaderTechniqueRepository,this._rctx);this.addHandles(this._textureRepository.events.on("changed",Y=>this.requestRender(Y)));this._materialRepository=
new u.GLMaterialRepository(this._textureRepository,this._shaderTechniqueRepository,()=>this.requestRender(),()=>this.requestRender());this._compositingHelper=new t(this._rctx,this._shaderTechniqueRepository);this.renderer=new C.Renderer(M,this._materialRepository,this._textureRepository,this._shaderTechniqueRepository,this._rctx,this._compositingHelper,this._magnifierHelper,Y=>this.requestRender(Y));this._screenshotManager=new O.ScreenshotManager(this._rctx,{renderScene:(Y,W,H,S,I)=>this.renderer.render(Y,
W,H,S,I),requestRenderScene:Y=>this.requestRender(Y),prepareOverlay:()=>M.options.screenshot.prepareOverlay(),renderOverlay:(Y,W,H)=>M.options.screenshot.renderOverlay(Y,W,H)},Y=>this.events.emit("force-camera-for-screenshot",Y));this._registerFrameTask(M)}normalizeCtorArgs(){return{}}destroy(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas);this._frameTask=k.removeMaybe(this._frameTask);this._shaderTechniqueRepository=k.destroyMaybe(this._shaderTechniqueRepository)}requestRender(M=
h.RenderRequestType.UPDATE){this._needsRender=!0;M===h.RenderRequestType.UPDATE&&(this._needsUpdate=!0)}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this.renderer.updating||this._textureRepository.updating||this.waterTextureRepository.updating||this._magnifierHelper.updating}get textureRepository(){return this._textureRepository}get compositingHelper(){return this._compositingHelper}set magnifier(M){this._magnifierHelper.magnifier=M}setIdleSuspend(M){this._idleSuspend!==
M&&(this._idleSuspend=M,this.requestRender())}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}get canvas(){return this._canvas}takeScreenshot(M){return this._screenshotManager.takeScreenshot(M).then(V=>V[0])}takeScreenshotWithOID(M){M.objectAndLayerIdColor=!0;return this._screenshotManager.takeScreenshot(M)}getAlpha(){return!!this._rctx.contextAttributes.alpha}getMinimalDepthForArea(M,V,Y,W,H,S=H){S=W.constrainWindowSize(V,Y,H*W.pixelRatio,S*W.pixelRatio);
const I=this._ensureDepthBuffer(S);this.renderer.readDepthPixels(W,S,I);H=Number.MAX_VALUE;for(let Q=0;Q<S[2]*S[3];Q++){const N=r.textureToDepth(4*Q,I,W.nearFar);H>N&&N!==W.nearFar[0]&&N!==W.nearFar[1]&&(H=N)}M&&(M=M.pickDepth(V*W.pixelRatio,Y*W.pixelRatio,W),null!=M&&H>M&&M!==W.nearFar[0]&&M!==W.nearFar[1]&&(H=M));return H===Number.MAX_VALUE?void 0:H}_ensureDepthBuffer(M){M=4*M[2]*M[3];if(null==this._tmpDepthBuffer||this._tmpDepthBuffer.byteLength<M)this._tmpDepthBuffer=new Uint8Array(M);return this._tmpDepthBuffer}async reloadShaders(){G.removeLoadedShaderModules();
await this._shaderTechniqueRepository.reloadAll();this.requestRender()}_registerFrameTask(M){const V=M.view.state;let Y=!1,W=h.RenderRequestType.BACKGROUND,H=!1;this._frameTask=q.addFrameTask({preRender:({time:S})=>{Y=this.updating;W=this._needsUpdate?h.RenderRequestType.UPDATE:h.RenderRequestType.BACKGROUND;M.commitSyncLayers();var I=e.Milliseconds(S-this._lastAnimationUpdate);if(I>this.renderer.animationTimestep||null!=V.forcedAnimationTime||Y||this._needsRender)I=e.Milliseconds(I/this.renderer.animationTimeDilation),
I=new z.UpdateParameters(V.camera,I,V.forcedAnimationTime),this.renderer.updateAnimation(I)&&this.requestRender(h.RenderRequestType.BACKGROUND),this._lastAnimationUpdate=S},render:({time:S})=>{if((this._needsRender||!this._idleSuspend||!this.renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&0<V.camera.fullWidth&&0<V.camera.fullHeight){const I=this._needsUpdate&&this._idleSuspend&&this.renderer.isCameraFinal;this._needsWaterReflectionUpdate=this._needsUpdate=this._needsRender=!1;this.renderer.render(null,
null,V,h.Decorations.ON,S);H=!0;I&&this.renderer.hasReflections&&(this.requestRender(h.RenderRequestType.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:({time:S})=>{const I=new O.ScreenshotContext(V,this.renderer.hasSlicePlane||this._magnifierHelper.enabled||this.renderer.hasDecorations||this.renderer.hasHighlights,this.renderer.fboCache);this._textureRepository.update();this._screenshotManager.update(I,S)},finish:()=>{H&&(this.renderer.finish(V.mode===J.RenderState.IDLE?W:h.RenderRequestType.UPDATE),
H=!1)}})}_initializeContext(M){const V=M.options;this._canvas=V.canvas;this._canvas||(this._canvas=document.createElement("canvas"));this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const Y=R.createContextForView("3d",this._canvas,{alpha:V.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:V.stencil??!0,powerPreference:"high-performance",preserveDrawingBuffer:V.preserveDrawingBuffer??!1});null!=Y&&X(Y)?(this._rctx=this._newRenderingContext(Y,M),this._loadShaderOnlyExtensions(),
!V.alpha&&this._rctx.contextAttributes.alpha&&n.getLogger(this).error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&11<=f("safari")&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)):n.getLogger(this).error("A WebGL2 context could not be created.")}_newRenderingContext(M,V){const Y={disabledExtensions:V.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:V.options.debugWebGLExtensions||
{},maxAnisotropy:8},W=(H,S)=>V.view.resourceController.memoryController.newCache(H,S);if(P.contextCache.enabled){let H=U.get(M);if(H)return H.configure(Y),H.newCache=W,H.ref(),H;H=new E.RenderingContext(M,Y,W);U.set(M,H);H.ref();return H}return new E.RenderingContext(M,Y,W)}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("textureFloat")}getObjectAndLayerIdColor(M){return null!=this.objectAndLayerIdRenderHelper?this.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor(M):null}get componentObjectCollection(){null==
this._componentObjectCollection&&(this._componentObjectCollection=new x.ComponentObjectCollection(this.renderer.renderPassManager,this._viewingMode));return this._componentObjectCollection}set componentObjectCollection(M){this._componentObjectCollection=M}};a.__decorate([m.property({type:Boolean,readOnly:!0})],b.RenderView.prototype,"updating",null);a.__decorate([m.property({autoDestroy:!0})],b.RenderView.prototype,"_rctx",void 0);a.__decorate([m.property({autoDestroy:!0})],b.RenderView.prototype,
"_container",void 0);a.__decorate([m.property({autoDestroy:!0})],b.RenderView.prototype,"_canvas",void 0);a.__decorate([m.property({autoDestroy:!0})],b.RenderView.prototype,"stippleTextureRepository",void 0);a.__decorate([m.property({autoDestroy:!0})],b.RenderView.prototype,"markerTextureRepository",void 0);a.__decorate([m.property({autoDestroy:!0})],b.RenderView.prototype,"waterTextureRepository",void 0);a.__decorate([m.property({autoDestroy:!0})],b.RenderView.prototype,"_magnifierHelper",void 0);
a.__decorate([m.property({readOnly:!0})],b.RenderView.prototype,"objectAndLayerIdRenderHelper",void 0);a.__decorate([m.property({autoDestroy:!0})],b.RenderView.prototype,"_textureRepository",void 0);a.__decorate([m.property({autoDestroy:!0,readOnly:!0})],b.RenderView.prototype,"renderer",void 0);a.__decorate([m.property({autoDestroy:!0})],b.RenderView.prototype,"_screenshotManager",void 0);a.__decorate([m.property()],b.RenderView.prototype,"componentObjectCollection",null);a.__decorate([m.property({autoDestroy:!0})],
b.RenderView.prototype,"_componentObjectCollection",void 0);a.__decorate([m.property()],b.RenderView.prototype,"_needsUpdate",void 0);a.__decorate([m.property()],b.RenderView.prototype,"_needsWaterReflectionUpdate",void 0);b.RenderView=a.__decorate([v.subclass("esri.views.3d.webgl-engine.parts.RenderView")],b.RenderView);const U=L.getContextCache();Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/ComponentObjectCollection":function(){define("exports ../../../../../core/has ../../../../../core/Logger ../../../../../core/PooledArray ../../../../../core/typedArrayUtil ../../../../../chunks/mat3 ../../../../../chunks/mat3f32 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/Indices ../../../../../chunks/vec32 ../../../../../chunks/vec33 ../../../../ViewingMode ../../../layers/support/symbolColorUtils ../../../support/orientedBoundingBox ../../../support/buffer/glUtil ../../../support/buffer/InterleavedLayout ./ComponentData ./ComponentObject ./IntersectionGeometry ./Renderable ./RenderGeometry ./RenderSubmitSystem ./SourceGeometry ./UniformComponentParameters ./Material/ComponentMaterial ./Material/ComponentTechnique ./Material/shader/ComponentData.glsl ../../lib/ComponentUtils ../../lib/Util ../../lib/VertexAttribute ../../lib/verticalOffsetUtils ../../lib/edgeRendering/bufferLayouts ../../lib/edgeRendering/edgeProcessing ../../lib/TextureBackedBuffer/BufferManager ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A,C,E,B,D,F,K,L,G,O,P,J,R,X,U,M){function V(N,T){return N===T?B.ComponentParameterSummary.All:0===N?B.ComponentParameterSummary.None:B.ComponentParameterSummary.Some}const Y=c.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");class W{constructor(N,T){this._renderManager=N;this._viewingMode=T;this._objects=[new d,new d];this._renderSubmit=new A.RenderSubmitSystem(this);this._renderManager.register(this._renderSubmit);
this._hasObjectAndLayerId=a("enable-feature:objectAndLayerId-rendering");this._componentBufferManager=new R.BufferManager(N.rctx,2+(this._hasObjectAndLayerId?1:0))}destroy(){L.assert(0===this._objects[r.State.Hidden].length&&0===this._objects[r.State.Visible].length,"ObjectCollection should be empty upon disposal");this._componentBufferManager.destroy();const N=this._objects.flatMap(T=>T.toArray());for(const T of N)T?.destroy()}createObject(N){const T=new r.ComponentObject;T.toMapSpace=N.toMapSpace;
T.transform=N.transform;T.obb=x.clone(N.obb);T.components=new t(this._componentBufferManager,e.compactIndices(N.geometry.componentOffsets));T.renderable=this._createRenderable(N,T.components);T.intersectionGeometry=new u(N.geometry.positionData,T.components);this._objects[T.visible].push(T);return T}destroyObject(N){this._objects[N.visible].removeUnordered(N);N.destroy();this._notifyDirty()}setObjectVisibility(N,T){T!==N.visible&&(this._objects[N.visible].removeUnordered(N),this._objects[T].push(N),
N.visible=T,this._notifyDirty())}preSubmit(N){const T=N.camera.eye;this.visibleObjects.forAll(aa=>aa.renderable.meta.cameraDepthSquared=g.squaredDistance(T,aa.obb.center))}getMaterial(N){return N.renderable.material}updateMaterial(N,T){N=N.renderable.material;T(N);N.dirty&&this._notifyDirty()}setAllComponentVisibilities(N,T){N.components.visibility.reset(T);N.components.visibilityDirty();this._notifyDirty()}forEachVisibleComponent(N,T){return N.components.visibility.forEachComponent(T)}getComponentCount(N){const T=
N.components.visibility.componentCount();return{visible:T,invisible:N.components.count-T}}setComponentData(N,T){const aa=N.renderable.material,Z=N.components;var da=Z.materialDataBuffer;const fa=Z.materialDataIndices,ka=new E.UniformComponentParameters;da=da.textureBuffer;const ha=new Uint8Array(4),ba=new Uint32Array(ha.buffer);let ea=0,ca=0,ia=0,la=Z.verticalOffsets,oa=Infinity,na=-Infinity,ra=!1,ta=!1,ma=0;for(let pa=0;pa<Z.count;pa++){T(pa,ka);ea+=+(1>ka.externalColor[3]);ca+=+(ka.externalColorMixMode===
v.ColorMixModeEnum.Replace&&1===ka.externalColor[3]);ia+=+ka.castShadows;v.encodeSymbolColor(ka.externalColor,ka.externalColorMixMode,ha);ha[2]=ha[2]&254|+ka.castShadows;da.setData(fa[pa],0,ha[0],ha[1],ha[2],ha[3]);ra||(ra=0<pa&&ma!==ba[0]);ma=ba[0];ta||(ta=0!==ka.elevationOffset);ta&&null==la&&(la=Array(pa).fill(0));null!=la&&(la[pa]=ka.elevationOffset);oa=Math.min(oa,ka.elevationOffset);na=Math.max(na,ka.elevationOffset);F.encodeElevationOffset(ka.elevationOffset,ha);da.setData(fa[pa],1,ha[0],ha[1],
ha[2],ha[3]);const ja=ka.objectAndLayerIdColor;null!=ja&&da.setData(fa[pa],2,ja[0],ja[1],ja[2],ja[3]);ka.pickable!==K.getVisibility(Z.pickability,pa)&&(Z.pickability=K.updateVisibilityWithCount(Z.pickability,Z.count,pa,ka.pickable))}Z.verticalOffsets=ta?la:null;N.offsetObb=ta?x.computeOffsetObb(N.obb,oa,na,this._viewingMode,null!=N.offsetObb?N.offsetObb:x.clone(N.obb)):null;ra||ta||this._hasObjectAndLayerId?(aa.componentParameters=new B.ComponentParametersVarying,aa.componentParameters.castShadows=
V(ia,Z.count),aa.componentParameters.transparent=V(ea,Z.count),aa.componentParameters.opaqueOverride=V(ca,Z.count),aa.componentParameters.texture=da,da.updateTexture()):(aa.componentParameters=new B.ComponentParametersUniform,aa.componentParameters.castShadows=ka.castShadows?B.ComponentParameterSummary.All:B.ComponentParameterSummary.None,aa.componentParameters.externalColor=ka.externalColor,aa.componentParameters.externalColorMixMode=ka.externalColorMixMode);this._notifyDirty()}getComponentAabb(N,
T,aa,Z=!1){N.intersectionGeometry.getComponentAabb(T,aa);const da=N.components.verticalOffsets;if(Z||null==da)return aa;T=da[T];if(this._viewingMode===w.ViewingMode.Local||0===T)return aa[2]+=T,aa[5]+=T,aa;T=O.getVerticalOffsetI3S(T);T.localOrigin=N.transform.position;return T.applyToAabb(aa)}getComponentObb(N){return N.obb}getObjectTransform(N){return N.transform}getComponentPositions(N,T,aa){return N.intersectionGeometry.getComponentPositions(T,aa)}intersect(N,T,aa,Z,da,fa){null!=da&&(da.localOrigin=
N.transform.position);const ka=n.invert(S,N.transform.rotationScale);g.sub(I,T,N.transform.position);g.sub(Q,aa,N.transform.position);g.transformMat3(I,I,ka);g.transformMat3(Q,Q,ka);T=n.transpose(S,ka);return N.intersectionGeometry.intersect(I,Q,Z,T,da,N.components.verticalOffsets,fa)}addEdges(N,T,aa,Z){const {indices:da,positions:fa}=N.intersectionGeometry,ka=N.components.offsets;return T.addComponentObject(N,N.transform,{center:N.obb.center,radius:x.radius(N.obb)},fa,da,ka,aa,Z)}async extractEdgeInformation(N,
T,aa){var Z=N.components.visibility;if(Z.allInvisible())return{buffer:J.extractComponentsEdgeLocationsLayout.createBuffer(0),origin:[0,0,0]};const {indices:da,positions:fa}=N.intersectionGeometry,ka=N.components.offsets,ha=P.EdgeInputBufferLayout.createBuffer(fa.length/3);l.copy(ha.position.typedBuffer,fa,ha.position.typedBufferStride,3);m.transformMat3View(ha.position,ha.position,N.transform.rotationScale);this._setComponentIndices(ha.componentIndex,da,ka);Z=this._computeVisibilityIndices(da,Z,ka,
ha.count);N=q.clone(N.transform.position);T=await T.extractComponentsEdgeLocations({indices:Z,indicesLength:Z.length,skipDeduplicate:!0,data:ha,writerSettings:{reducedPrecision:!1,variants:0}},aa);return{origin:N,buffer:T}}_setComponentIndices(N,T,aa){let Z=0;for(let fa=0;fa<aa.length-1;fa++){var da=aa[fa];const ka=aa[fa+1];for(;da<ka;da++)N.set(T?T[da]:da,Z);Z++}}_computeVisibilityIndices(N,T,aa,Z){if(N&&T.allVisible())return N;let da=0;T.forEachComponentRange((ha,ba)=>{da+=aa[ba]-aa[ha];return!0});
const fa=f.isArray(N)?Array(da):2===N?.BYTES_PER_ELEMENT||65536>=Z?new Uint16Array(da):new Uint32Array(da);let ka=0;T.forEachComponentRange((ha,ba)=>{ha=aa[ha];for(ba=aa[ba];ha<ba;ha++)fa[ka++]=N?N[ha]:ha;return!0});return fa}addComponentHighlight(N,T){N=N.components;null==N.highlightCounts&&(N.highlightCounts=new Uint32Array(N.count+1));0===N.highlightCounts[T]++&&(N.highlightsDirty(),this._notifyDirty());N.highlightCounts[N.count]++}removeComponentHighlight(N,T){N=N.components;if(null==N.highlightCounts)Y.warn("Removing non-existing highlight.");
else{var aa=N.highlightCounts[T],Z=N.highlightCounts[N.count];0===aa?Y.warn("Removing non-existing highlight."):1<aa?(N.highlightCounts[T]=aa-1,N.highlightCounts[N.count]=Z-1):(N.highlightCounts[T]=0,N.highlightsDirty(),this._notifyDirty(),1===Z?N.highlightCounts=null:N.highlightCounts[N.count]=Z-1)}}clearHighlights(N){N=N.components;null!=N.highlightCounts&&(N.highlightCounts=null,N.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(N){return N.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._objects[r.State.Visible]}_createRenderable(N,
T){var aa=this._renderManager.rctx;const Z=N.geometry;var da=Z.vertices.layoutParameters;const fa=X.BufferObject.createVertex(aa,U.Usage.STATIC_DRAW,Z.vertices.data),ka=Z.indices?X.BufferObject.createIndex(aa,U.Usage.STATIC_DRAW,Z.indices):null,ha=p.glLayout(C.createVertexBufferLayout(da)),ba=new Uint16Array(Z.vertices.count);for(let ca=0;ca<T.count;ca++){var ea=T.offsets[ca];const ia=T.offsets[ca+1],la=T.materialDataIndices[ca];if(null!=Z.indices)for(;ea<ia;ea++)ba[Z.indices[ea]]=la;else for(;ea<
ia;ea++)ba[ea]=la}T=X.BufferObject.createVertex(aa,U.Usage.STATIC_DRAW,ba.buffer);N=new B.ComponentMaterial(N.transform,N.toMapSpace);aa=new M.VertexArrayObject(aa,D.attributeLocations,{data:ha,componentIndices:H},{data:fa,componentIndices:T},ka);da=new z.RenderGeometry(aa,U.PrimitiveType.TRIANGLES,da,null!=ka);return new y.Renderable(N,da,{cameraDepthSquared:.5,gpuMemoryEstimate:fa.byteLength+T.byteLength+(null!=ka?ka.byteLength:0)})}_notifyDirty(){this._renderManager.notifyDirty()}}const H=p.glLayout(h.newLayout().u16(G.VertexAttribute.COMPONENTINDEX)),
S=k.create(),I=q.create(),Q=q.create();b.ComponentObjectCollection=W;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/ComponentData":function(){define(["./IndexRange/ComponentRangeRunLengthEncoded"],function(b){function a(d,f,n){const k=[],g=[];let q=n.length,e=n.length;f.forEachComponent(m=>{0<d[m]?(q!==m-1&&(k.length&&k.push(n[q+1]-k[k.length-1]),k.push(n[m])),q=m):(e!==m-1&&(g.length&&g.push(n[e+1]-g[g.length-1]),g.push(n[m])),e=
m);return!0});k.length&&k.push(n[q+1]-k[k.length-1]);g.length&&g.push(n[e+1]-g[g.length-1]);return{highlightRanges:k,defaultRanges:g}}class c{constructor(d,f){this.offsets=f;this.cachedDefaultRanges=this.cachedHighlightRanges=this.cachedGeometryRanges=this.verticalOffsets=this.highlightCounts=this.pickability=null;f=this.count;this.visibility=new b.ComponentRangeRunLengthEncoded(f);this.materialDataBuffer=d.getBuffer(f);this.materialDataIndices=new Uint16Array(f);for(d=0;d<f;d++)this.materialDataIndices[d]=
this.materialDataBuffer.acquireIndex()}destroy(){for(let d=0;d<this.count;d++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[d])}get count(){return this.offsets.length-1}get geometryRanges(){null==this.cachedGeometryRanges&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets));return this.cachedGeometryRanges}get highlightRanges(){if(null==this.highlightCounts)return null;this._updateCachedHighlightRanges();return this.cachedHighlightRanges}get defaultShadowMapRanges(){if(null==
this.highlightCounts)return this.geometryRanges;this._updateCachedHighlightRanges();return this.cachedDefaultRanges}highlightsDirty(){this.cachedDefaultRanges=this.cachedHighlightRanges=null}visibilityDirty(){this.cachedGeometryRanges=null;this.highlightsDirty()}_updateCachedHighlightRanges(){if((null==this.cachedHighlightRanges||null==this.cachedDefaultRanges)&&null!=this.highlightCounts){const {highlightRanges:d,defaultRanges:f}=a(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=
d;this.cachedDefaultRanges=f}}}return c})},"esri/views/3d/webgl-engine/collections/Component/IndexRange/ComponentRangeRunLengthEncoded":function(){define(["exports"],function(b){class a{constructor(c){this._totalCount=c;this._indexRanges=[0,c]}allVisible(){return this.componentCount()===this._totalCount}allInvisible(){return 0===this._indexRanges.length}componentCount(){const c=this._indexRanges;let d=0;for(let f=0;f<c.length;f+=2)d+=c[f+1];return d}reset(c){if("all"===c||c.length===this._totalCount)this._indexRanges=
[0,this._totalCount];else{{const n=[];if(0!==c.length){var d=c[0],f=1;for(let k=1;k<c.length;k++){const g=c[k];d+f===g?f+=1:(n.push(d),n.push(f),d=g,f=1)}n.push(d);n.push(f)}c=n}this._indexRanges=c}}forEachComponent(c){const d=this._indexRanges;for(let n=0;n<d.length;n+=2){var f=d[n];const k=f+d[n+1];for(;f<k;f++)if(!c(f))return!1}return!0}forEachComponentRange(c){const d=this._indexRanges;for(let f=0;f<d.length;f+=2){const n=d[f];if(!c(n,n+d[f+1]))return!1}return!0}computeOffsetRanges(c){const d=
Array(this._indexRanges.length),f=this._indexRanges;for(let k=0;k<f.length;k+=2){var n=f[k];const g=c[n];n=c[n+f[k+1]];d[k]=g;d[k+1]=n-g}return d}}b.ComponentRangeRunLengthEncoded=a;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/ComponentObject":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/Accessor ../../../../../core/maybe ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass".split(" "),
function(b,a,c,d,f,n,k,g,q){b.ComponentObject=class extends c{constructor(){super(...arguments);this.visible=b.State.Hidden}destroy(){this.intersectionGeometry=d.destroyMaybe(this.intersectionGeometry)}};a.__decorate([f.property({autoDestroy:!0})],b.ComponentObject.prototype,"renderable",void 0);a.__decorate([f.property({autoDestroy:!0})],b.ComponentObject.prototype,"components",void 0);b.ComponentObject=a.__decorate([q.subclass("esri.views.3d.webgl-engine.collections.Component.ComponentObject")],
b.ComponentObject);b.State=void 0;(function(e){e[e.Hidden=0]="Hidden";e[e.Visible=1]="Visible"})(b.State||(b.State={}));Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/IntersectionGeometry":function(){define("../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/aaBoundingBox ../../../../../geometry/support/FloatArray ../../../../../geometry/support/Indices ./ComponentIntersectionData ../../lib/Attribute ../../lib/ComponentUtils ../../materials/internal/MaterialUtil".split(" "),
function(b,a,c,d,f,n,k,g,q){class e{constructor(w,v){this._components=v;this._indices=w.indices?f.compactIndices(w.indices):f.getContinuousIndexArray(w.positions.length/3);this._positions=w.positions;this._componentIntersectionData=Array(v.count)}destroy(){this._indices=this._positions=null;this._componentIntersectionData.length=0;this._perComponentAabbs=null}getComponentAabb(w,v){this._perComponentAabbs||(this._perComponentAabbs=this._computePerComponentAabbs());for(let x=0;6>x;x++)v[x]=this._perComponentAabbs[6*
w+x];return v}getComponentPositions(w,v){v.indices=this._indices;v.data=this._positions;v.stride=3;v.startIndex=this._components.offsets[w];v.endIndex=this._components.offsets[w+1]}intersect(w,v,x,p,h,t,r){const u=new k.Vertices(this._positions,3),y=this._indices,z=this._components.offsets,A=q.computeInvDir(w,v,m),C=w[2],E=v[2];this._components.visibility.forEachComponent(B=>{if(!g.getVisibility(this._components.pickability,B))return!0;var D=this.getComponentAabb(B,l);if(null!=t){var F=t[B];null!=
h?h.componentOffset=F:(w[2]=C-F,v[2]=E-F)}null!=h&&h.applyToAabb(D);if(!q.intersectAabbInvDir(D,w,A,x))return!0;D=z[B]/3;F=z[B+1]/3;const K=(L,G,O)=>r(B,L,b.transformMat3(G,G,p),O);null==h&&F-D>n.componentMinimalSizeForIntersectionData?(null==this._componentIntersectionData[B]&&(this._componentIntersectionData[B]=new n.ComponentIntersectionData(this._indices,D,F,u)),this._componentIntersectionData[B].intersectRay({r0:w,r1:v},K)):q.intersectTriangles(w,v,D,F,y,u,void 0,h,K);return!0})}_computePerComponentAabbs(){const w=
this._components.count,v=d.newFloatArray(6*w),x=this._indices,p=this._positions,h=this._components.offsets;let t=0;for(let y=0;y<w;y++){var r=h[y];const z=h[y+1];let A=Infinity,C=Infinity,E=Infinity,B=-Infinity,D=-Infinity,F=-Infinity;for(;r<z;r++){var u=3*x[r];const K=p[u],L=p[u+1];u=p[u+2];A=Math.min(A,K);C=Math.min(C,L);E=Math.min(E,u);B=Math.max(B,K);D=Math.max(D,L);F=Math.max(F,u)}v[t++]=A;v[t++]=C;v[t++]=E;v[t++]=B;v[t++]=D;v[t++]=F}return v}get positions(){return this._positions}get indices(){return this._indices}}
const m=a.create(),l=c.create();return e})},"esri/views/3d/webgl-engine/lib/ComponentUtils":function(){define(["exports","../../../../core/arrayUtils"],function(b,a){function c(d=!0){return{isVisibleBit:!d,data:new Uint32Array(0)}}b.defaultVisibilities=c;b.getVisibility=function(d,f){if(null==d)return!0;const {isVisibleBit:n,data:k}=d,g=8*k.BYTES_PER_ELEMENT;return f<k.length*g?(d=f/g|0,0!==(k[d]&1<<f-d*g)===n):!d.isVisibleBit};b.updateVisibilityWithCount=function(d,f,n,k){if(n>=f)return d;null==
d&&(d=c());let g=d.data;const q=8*g.BYTES_PER_ELEMENT,e=n/q|0,m=n-q*e,l=g;k=k===d.isVisibleBit;n<l.length*q||!k||(n=Math.max(e+1,Math.ceil(l.length*a.ReallocGrowthFactor)),n=Math.min(n,((f-1)/q|0)+1),g=new Uint32Array(n),g.set(l));e<g.length&&(g[e]=g[e]&~(1<<m)|(k?1:0)<<m);d.data=g;return d};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/Renderable":function(){define(["exports"],function(b){class a{constructor(c,d,f){this.material=
c;this.geometry=d;this.meta=f}destroy(){this.material.dispose();this.geometry.dispose()}}b.Renderable=a;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/RenderGeometry":function(){define(["exports"],function(b){class a{constructor(c,d,f,n){this.vao=c;this.primitiveType=d;this.parameters=f;this.indexed=n}dispose(){this.vao.dispose()}}b.RenderGeometry=a;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/RenderSubmitSystem":function(){define(["exports",
"./DepthRange"],function(b,a){class c{constructor(d){this._objects=d}submit(d,f){this._objects.preSubmit(f);this._objects.visibleObjects.forAll(n=>n.renderable.material.submit(d,f,n))}queryShadowCasterDepthRange(d){return this._objects.visibleObjects.length?a.computeDepthRange(d,this._objects.visibleObjects):null}}b.RenderSubmitSystem=c;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/DepthRange":function(){define("exports ../../../../../core/PooledArray ../../../../../chunks/mat3 ../../../../../chunks/mat3f64 ../../../../../chunks/quat ../../../../../chunks/quatf64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/plane ../../../support/orientedBoundingBox ../../lib/depthRange".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m){function l(K,L,G){return k.set(K,L.data[G],L.data[G+1],L.data[G+2])}function w(K,L){K.push(L[0]);K.push(L[1]);K.push(L[2])}function v(K,L,G,O){f.conjugate(A,K.quaternion);k.sub(C,L,K.center);k.transformQuat(C,C,A);const P=8*((C[0]<-K.halfSize[0]?-1:C[0]>K.halfSize[0]?1:0)+3*(C[1]<-K.halfSize[1]?-1:C[1]>K.halfSize[1]?1:0)+9*(C[2]<-K.halfSize[2]?-1:C[2]>K.halfSize[2]?1:0)+13);L=y[P];if(0===L)return L;c.fromQuat(z,K.quaternion);c.scale(z,z,K.halfSize);const J=(R,X)=>{X=
y[P+X+1];k.set(R,((X&1)<<1)-1,(X&2)-1,((X&4)>>1)-1);k.transformMat3(R,R,z);return k.add(R,K.center,R)};G.length=0;w(G,J(E,0));w(G,J(B,1));w(G,J(C,2));w(G,J(D,3));O(G);if(1===L)return L;G.length=0;w(G,E);w(G,D);w(G,J(C,4));w(G,J(F,5));O(G);if(2===L)return L;G.length=0;w(G,E);w(G,F);w(G,J(C,6));w(G,B);O(G);return L}const x=new a({allocator:K=>K||{near:Infinity,far:-Infinity,mask:0,object:null},deallocator:K=>{K.object=null;return K}}),p=m.empty(),h=g.create(),t=g.create(),r=new a({deallocator:null}),
u=new a({deallocator:null}),y=(()=>{const K=Array(216);let L=0;const G=O=>{for(let P=0;P<O.length;P++)K[L+P]=O[P];L+=8};G([3,0,6,2,3,1,5,4]);G([2,0,2,3,1,5,4,0]);G([3,1,0,2,3,7,5,4]);G([2,0,1,3,2,6,4,0]);G([1,0,1,3,2,0,0,0]);G([2,1,5,7,3,2,0,0]);G([3,2,0,1,3,7,6,4]);G([2,2,0,1,3,7,6,0]);G([3,3,0,1,5,7,6,2]);G([2,0,1,5,4,6,2,0]);G([1,0,1,5,4,0,0,0]);G([2,1,3,7,5,4,0,0]);G([1,0,2,6,4,0,0,0]);G([0,0,0,0,0,0,0,0]);G([1,1,3,7,5,0,0,0]);G([2,2,3,7,6,4,0,0]);G([1,2,3,7,6,0,0,0]);G([2,3,1,5,7,6,2,0]);G([3,
4,0,1,5,7,6,2]);G([2,5,7,6,4,0,1,0]);G([3,5,0,1,3,7,6,4]);G([2,4,5,7,6,2,0,0]);G([1,4,5,7,6,0,0,0]);G([2,5,1,3,7,6,4,0]);G([3,6,0,2,3,7,5,4]);G([2,6,2,3,7,5,4,0]);G([3,7,6,2,3,1,5,4]);return K})(),z=d.create(),A=n.create(),C=g.create(),E=g.create(),B=g.create(),D=g.create(),F=g.create();b.computeDepthRange=function(K,L){const G=m.empty(),{eye:O,frustum:P,viewForward:J}=K;L.forAll(R=>{var X=null!=R.offsetObb?R.offsetObb:R.obb;const U=k.dot(k.sub(C,X.center,O),J),M=e.projectedRadius(X,J);if(!m.within(G,
U-M)||!m.within(G,U+M)){a:{var V=0;for(let Y=0;4>Y;Y++){const W=e.intersectPlane(X,P[Y]);if(0<W){X=-1;break a}0===W&&(V|=1<<Y)}X=V}-1!==X&&(0===X?(p.far=U+M,p.near=U-M,m.union(G,p)):(V=x.pushNew(),V.near=U-M,V.far=U+M,V.mask=X,V.object=R))}});for(K=0;K<x.length;K++){const R=x.data[K];m.within(G,R.near)&&m.within(G,R.far)||(p.far=R.far,p.near=Infinity,0===v(null!=R.object.offsetObb?R.object.offsetObb:R.object.obb,O,r,X=>{var U=u;for(var M=0;4>M&&0<X.length;M++){if(0===(R.mask&1<<M))continue;var V=
P[M],Y=X,W=U;W.length=0;const H=Y.length-3;l(h,Y,H);const S=q.signedDistance(V,h);0>=S&&(W.push(h[0]),W.push(h[1]),W.push(h[2]));let I=0,Q=S;for(I;I<H;I+=3){l(t,Y,I);const N=q.signedDistance(V,t);0>Q*N&&(k.lerp(h,t,h,N/(N-Q)),w(W,h));0>=N&&w(W,t);Q=N;k.copy(h,t)}0>Q*S&&(l(t,Y,H),k.lerp(h,t,h,S/(S-Q)),w(W,h));V=X;X=U;U=V}for(U=0;U<X.length;U+=3)k.set(h,X.data[U],X.data[U+1],X.data[U+2]),M=k.dot(k.sub(h,h,O),J),p.near=Math.min(p.near,M)})&&(p.near=0),m.union(G,p))}x.length=0;return G};Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/depthRange":function(){define(["exports"],function(b){function a(f,n){return{near:f,far:n}}function c(f,n,k){f.near=n;f.far=k;return f}class d{constructor(){this.near=Number.MAX_VALUE;this.far=-Number.MAX_VALUE}}b.DepthRange=d;b.create=a;b.empty=function(f){return f?c(f,Infinity,-Infinity):a(Infinity,-Infinity)};b.set=c;b.union=function(f,n){null!=n&&(f.near=Math.min(f.near,n.near),f.far=Math.max(f.far,n.far))};b.within=function(f,
n){return f.near<=n&&n<=f.far};b.zero={near:0,far:0};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/SourceGeometry":function(){define(["exports","../../../support/buffer/InterleavedLayout","../../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl","../../lib/VertexAttribute"],function(b,a,c,d){b.createVertexBufferLayout=function(f){const n=a.newLayout().vec3f(d.VertexAttribute.POSITION);f.normals&&n.vec2i16(d.VertexAttribute.NORMALCOMPRESSED,
{glNormalized:!0});f.textureCoordinates===c.TextureCoordinateAttributeType.Default?n.vec2f(d.VertexAttribute.UV0):f.textureCoordinates===c.TextureCoordinateAttributeType.Atlas&&(n.vec2f(d.VertexAttribute.UV0),n.vec4u16(d.VertexAttribute.UVREGION,{glNormalized:!0}));f.colors&&n.vec4u8(d.VertexAttribute.COLOR,{glNormalized:!0});return n};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/UniformComponentParameters":function(){define(["exports",
"../../../../../chunks/vec4f64","../../../layers/support/symbolColorUtils"],function(b,a,c){class d{constructor(){this.externalColor=a.create();this.externalColorMixMode=c.ColorMixModeEnum.Multiply;this.pickable=this.castShadows=!0;this.elevationOffset=0}}b.UniformComponentParameters=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/Material/ComponentMaterial":function(){define("exports ../../../../../../chunks/tslib.es6 ../../../../../../core/maybe ../../../../../../chunks/mat3 ../../../../../../chunks/mat3f32 ../../../../../../chunks/mat3f64 ../../../../../../chunks/vec3 ../../../../../../chunks/vec3f64 ../../../../../../chunks/vec4 ../../../../../../chunks/vec4f64 ../../../../layers/support/symbolColorUtils ../../../../terrain/OverlayContent ./ComponentTechnique ./ComponentTechniqueConfiguration ./shader/ComponentData.glsl ./shader/VertexDiscardByOpacity.glsl ../../../core/material/MaterialBase ../../../core/renderPasses/AllRenderPasses ../../../core/shaderLibrary/ShaderOutput ../../../core/shaderLibrary/attributes/NormalAttribute.glsl ../../../core/shaderLibrary/shading/Normals.glsl ../../../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../../../core/shaderLibrary/util/AlphaCutoff ../../../core/shaderLibrary/util/EllipsoidMode ../../../core/util/TwoVectorPosition ../../../lib/basicInterfaces ../../../lib/TransparencyPassType ../../../materials/pbrUtils".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A,C,E,B,D,F){class K extends h.MaterialBase{constructor(J,R){super();this.toMapSpace=R;this.baseColor=e.fromValues(1,1,1,1);this.hasParametersFromSource=this.usePBR=!1;this.mrrFactors=g.fromArray(F.defaultAdvancedMRRFactors);this.emissiveFactor=g.fromValues(0,0,0);this.normalTexture=this.occlusionTexture=this.emissionTexture=this.metallicRoughnessTexture=this.baseColorTexture=null;this.objectOpacity=1;this.commonMaterialParameters=new G;this.componentParameters=
new O;this.textureAlphaCutoff=A.defaultMaskAlphaCutoff;this.alphaDiscardMode=B.AlphaDiscardMode.Opaque;this.polygonOffsetEnabled=this.isIntegratedMesh=!1;this.ellipsoidMode=C.EllipsoidMode.Earth;this.hasOccludees=!1;this._techniqueConfiguration=new v.ComponentTechniqueConfiguration;R=new E.TwoVectorPosition(J.position);const X=f.clone(J.rotationScale);d.invert(X,X);this.transformNormalGlobalFromModel=n.clone(d.transpose(X,X));this.transformWorldFromModelTL=R.low;this.transformWorldFromModelTH=R.high;
this.transformWorldFromModelRS=J.rotationScale}dispose(){this._technique=c.releaseMaybe(this._technique);this.normalTexture=this.occlusionTexture=this.emissionTexture=this.metallicRoughnessTexture=this.baseColorTexture=null}get texture(){return null!=this.baseColorTexture?this.baseColorTexture.glTexture:null}get textureMetallicRoughness(){return null!=this.metallicRoughnessTexture?this.metallicRoughnessTexture.glTexture:null}get textureEmissive(){return null!=this.emissionTexture?this.emissionTexture.glTexture:
null}get textureOcclusion(){return null!=this.occlusionTexture?this.occlusionTexture.glTexture:null}get textureNormal(){return null!=this.normalTexture?this.normalTexture.glTexture:null}prepareTechnique(J,R,X,U){const M=this._techniqueConfiguration;M.hasVertexColors=U.colors;M.hasNormals=U.normals;M.textureCoordinateType=U.textureCoordinates;M.hasMetallicRoughnessTexture=null!=this.metallicRoughnessTexture;M.hasEmissionTexture=null!=this.emissionTexture;M.hasOcclusionTexture=null!=this.occlusionTexture;
M.hasNormalTexture=null!=this.normalTexture;M.transparencyPassType=R.identifier===t.RenderPassIdentifier.Material&&null!=X.transparencyPassType?X.transparencyPassType:D.TransparencyPassType.NONE;M.multipassEnabled=R.identifier===t.RenderPassIdentifier.Material&&X.multipassEnabled;M.cullAboveGround=R.identifier===t.RenderPassIdentifier.Material?X.multipassTerrain.cullAboveGround:!1;M.ellipsoidMode=this.ellipsoidMode;M.componentData=this.componentParameters.type;M.cullFace=this.commonMaterialParameters.cullFace;
M.doubleSidedMode=this.commonMaterialParameters.doubleSided?y.NormalsDoubleSidedMode.View:y.NormalsDoubleSidedMode.None;M.hasColorTexture=null!=this.baseColorTexture;U=this._computeWhichMaterialPass();M.blendingEnabled=U===L.Transparent||U===L.OpaqueAndTransparent;M.alphaDiscardMode=this.alphaDiscardMode;M.integratedMeshMode=this.isIntegratedMesh?null!=X.overlay?.getTexture(l.OverlayContent.ColorNoRasterImage)?null!=X.overlay?.getTexture(l.OverlayContent.WaterNormal)?v.IntegratedMeshMode.ColorOverlayWithWater:
v.IntegratedMeshMode.ColorOverlay:v.IntegratedMeshMode.NoOverlay:v.IntegratedMeshMode.None;M.hasPolygonOffset=this.polygonOffsetEnabled;M.pbrMode=M.integratedMeshMode===v.IntegratedMeshMode.ColorOverlayWithWater?z.PBRMode.WaterOnIntegratedMesh:this.usePBR?this.hasParametersFromSource?z.PBRMode.Schematic:z.PBRMode.Normal:z.PBRMode.Disabled;M.normalType=M.integratedMeshMode===v.IntegratedMeshMode.None?M.hasNormals?u.NormalType.Compressed:u.NormalType.ScreenDerivative:u.NormalType.Ground;M.hasSlicePlane=
null!=X.slicePlane&&this.commonMaterialParameters.hasSlicePlane;if(R.identifier===t.RenderPassIdentifier.ShadowMap)M.output=r.ShaderOutput.Shadow,M.vertexDiscardMode=p.VertexDiscardMode.None;else if(R.identifier===t.RenderPassIdentifier.Highlight)M.output=r.ShaderOutput.Highlight,M.vertexDiscardMode=p.VertexDiscardMode.None;else{M.vertexDiscardMode=U===L.OpaqueAndTransparent?R.transparent?p.VertexDiscardMode.Opaque:p.VertexDiscardMode.Transparent:p.VertexDiscardMode.None;M.output=R.output;M.receiveAmbientOcclusion=
!1;M.receiveShadows=!1;switch(R.output){case r.ShaderOutput.Color:M.receiveAmbientOcclusion=null!=X.ssao;M.hasOccludees=X.hasOccludees;M.receiveShadows=X.shadowMap.ready;M.hasScreenSpaceReflections=null!=X.ssr.lastFrameColor;M.hasCloudsReflections=null!=X.cloudsFade.data;break;case r.ShaderOutput.Alpha:M.hasOccludees=X.hasOccludees;break;case r.ShaderOutput.ObjectAndLayerIdColor:M.objectAndLayerIdColor=!0}M.snowCover=this.hasSnowCover(X)}this._technique=J.releaseAndAcquire(w.ComponentTechnique,M,
this._technique);this._setClean();return this._technique}hasSnowCover(J){return null!=J.weather&&J.weatherVisible&&"snowy"===J.weather.type&&"enabled"===J.weather.snowCover}submit(J,R,X){if(0!==this.objectOpacity){var U=X.renderable.geometry,M=X.components;X=X.renderable.meta.cameraDepthSquared;var V=M.geometryRanges,Y=M.highlightRanges;M=M.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case L.Opaque:J.materialOpaque.submitDraw(this,U,V,X);break;case L.Transparent:J.materialTransparent.submitDraw(this,
U,V,X);break;case L.OpaqueAndTransparent:J.materialOpaque.submitDraw(this,U,V,X);J.materialTransparent.submitDraw(this,U,V,X);break;case L.IntegratedMesh:J.materialIntegratedMesh.submitDraw(this,U,V,X),null!=R.overlay?.getTexture(l.OverlayContent.Highlight)&&J.highlightIntegratedMesh.submitDraw(this,U,V,X)}(R=this.componentParameters.castShadows!==b.ComponentParameterSummary.None)&&J.shadowMap.submitDraw(this,U,V,X);null!=Y&&(J.highlight.submitDraw(this,U,Y,X),R&&J.highlightShadowMap.submitDraw(this,
U,Y,X));R&&null!=M&&J.defaultShadowMap.submitDraw(this,U,M,X)}}_computeWhichMaterialPass(){return this.isIntegratedMesh?L.IntegratedMesh:1>this.objectOpacity?L.Transparent:this.componentParameters.opaqueOverride===b.ComponentParameterSummary.All?L.Opaque:1>this.baseColor[3]||this.alphaDiscardMode===B.AlphaDiscardMode.Blend||this.alphaDiscardMode===B.AlphaDiscardMode.MaskBlend?L.Transparent:this.componentParameters.transparent===b.ComponentParameterSummary.None?L.Opaque:this.componentParameters.transparent===
b.ComponentParameterSummary.All?L.Transparent:L.OpaqueAndTransparent}}a.__decorate([h.parameter({vectorOps:q.vec4})],K.prototype,"baseColor",void 0);a.__decorate([h.parameter()],K.prototype,"usePBR",void 0);a.__decorate([h.parameter()],K.prototype,"hasParametersFromSource",void 0);a.__decorate([h.parameter({vectorOps:k.vec3})],K.prototype,"mrrFactors",void 0);a.__decorate([h.parameter({vectorOps:k.vec3})],K.prototype,"emissiveFactor",void 0);a.__decorate([h.parameter({dispose:!0})],K.prototype,"baseColorTexture",
void 0);a.__decorate([h.parameter({dispose:!0})],K.prototype,"metallicRoughnessTexture",void 0);a.__decorate([h.parameter({dispose:!0})],K.prototype,"emissionTexture",void 0);a.__decorate([h.parameter({dispose:!0})],K.prototype,"occlusionTexture",void 0);a.__decorate([h.parameter({dispose:!0})],K.prototype,"normalTexture",void 0);a.__decorate([h.parameter()],K.prototype,"objectOpacity",void 0);a.__decorate([h.parameterBlock()],K.prototype,"commonMaterialParameters",void 0);a.__decorate([h.parameterBlock()],
K.prototype,"componentParameters",void 0);a.__decorate([h.parameter()],K.prototype,"textureAlphaCutoff",void 0);a.__decorate([h.parameter()],K.prototype,"alphaDiscardMode",void 0);a.__decorate([h.parameter()],K.prototype,"isIntegratedMesh",void 0);a.__decorate([h.parameter()],K.prototype,"polygonOffsetEnabled",void 0);a.__decorate([h.parameter()],K.prototype,"ellipsoidMode",void 0);a.__decorate([h.parameter()],K.prototype,"hasOccludees",void 0);var L;(function(J){J[J.Opaque=0]="Opaque";J[J.Transparent=
1]="Transparent";J[J.OpaqueAndTransparent=2]="OpaqueAndTransparent";J[J.IntegratedMesh=3]="IntegratedMesh"})(L||(L={}));class G extends h.MaterialParameterBlock{constructor(){super(...arguments);this.doubleSided=!1;this.cullFace=B.CullFaceOptions.Back;this.hasSlicePlane=!0}}a.__decorate([h.parameter()],G.prototype,"doubleSided",void 0);a.__decorate([h.parameter()],G.prototype,"cullFace",void 0);a.__decorate([h.parameter()],G.prototype,"hasSlicePlane",void 0);class O extends h.MaterialParameterBlock{constructor(){super(...arguments);
this.externalColor=e.fromValues(1,1,1,1);this.externalColorMixMode=m.ColorMixModeEnum.Multiply;this.castShadows=b.ComponentParameterSummary.All}get transparent(){return 1>this.externalColor[3]?b.ComponentParameterSummary.All:b.ComponentParameterSummary.None}get opaqueOverride(){return this.externalColorMixMode===m.ColorMixModeEnum.Replace&&1===this.externalColor[3]?b.ComponentParameterSummary.All:b.ComponentParameterSummary.None}get visible(){return 0<this.externalColor[3]?b.ComponentParameterSummary.All:
b.ComponentParameterSummary.None}get type(){return x.ComponentDataType.Uniform}}a.__decorate([h.parameter({vectorOps:q.vec4})],O.prototype,"externalColor",void 0);a.__decorate([h.parameter()],O.prototype,"externalColorMixMode",void 0);a.__decorate([h.parameter()],O.prototype,"castShadows",void 0);b.ComponentParameterSummary=void 0;(function(J){J[J.All=0]="All";J[J.Some=1]="Some";J[J.None=2]="None"})(b.ComponentParameterSummary||(b.ComponentParameterSummary={}));class P extends h.MaterialParameterBlock{constructor(){super(...arguments);
this.texture=null;this.castShadows=this.opaqueOverride=this.transparent=b.ComponentParameterSummary.None}get type(){return x.ComponentDataType.Varying}}a.__decorate([h.parameter()],P.prototype,"texture",void 0);a.__decorate([h.parameter()],P.prototype,"transparent",void 0);a.__decorate([h.parameter()],P.prototype,"opaqueOverride",void 0);a.__decorate([h.parameter()],P.prototype,"castShadows",void 0);b.CommonMaterialParameters=G;b.ComponentMaterial=K;b.ComponentParametersUniform=O;b.ComponentParametersVarying=
P;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/Material/ComponentTechnique":function(){define("require exports ../../../../../ViewingMode ./ComponentTechniqueConfiguration ../../../../../../chunks/ComponentShader.glsl ../../../core/shaderLibrary/ShaderOutput ../../../core/shaderTechnique/ReloadableShaderModule ../../../core/shaderTechnique/ShaderTechnique ../../../lib/basicInterfaces ../../../lib/OrderIndependentTransparency ../../../lib/Program ../../../lib/StencilUtils ../../../lib/TransparencyPassType ../../../lib/VertexAttribute ../../../../../webgl/renderState".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x){class p extends g.ShaderTechnique{initializeConfiguration(t,r){r.spherical=t.viewingMode===c.ViewingMode.Global;r.doublePrecisionRequiresObfuscation=t.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(t){return new m.Program(t.rctx,p.shader.get().build(this.configuration),h)}_setPipelineState(t){const r=this.configuration,u=r.integratedMeshMode!==d.IntegratedMeshMode.None,y=t===w.TransparencyPassType.NONE,z=t===w.TransparencyPassType.FrontFace;
return x.makePipelineState({blending:r.output!==n.ShaderOutput.Color&&r.output!==n.ShaderOutput.Alpha||!r.blendingEnabled?null:y?e.blendingDefault:e.oitBlending(t),culling:x.cullingParams(r.cullFace),depthTest:{func:e.oitDepthTest(t)},depthWrite:y||z?x.defaultDepthWriteParams:null,colorWrite:x.defaultColorWriteParams,stencilWrite:u||r.hasOccludees?l.stencilWriteMaskOn:null,stencilTest:u?l.replaceBitWhenDepthTestPasses(q.StencilBits.IntegratedMeshMaskExcluded):r.hasOccludees?l.stencilBaseAllZerosParams:
null,polygonOffset:y||z?r.hasPolygonOffset?{factor:2,units:2}:null:e.OITPolygonOffset})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}p.shader=new k.ReloadableShaderModule(f.ComponentShader,()=>new Promise((t,r)=>b(["./shader/ComponentShader.glsl"],t,r)));const h=new Map([[v.VertexAttribute.POSITION,0],[v.VertexAttribute.NORMAL,1],[v.VertexAttribute.NORMALCOMPRESSED,1],[v.VertexAttribute.COLOR,2],[v.VertexAttribute.UV0,3],[v.VertexAttribute.UVREGION,
4],[v.VertexAttribute.COMPONENTINDEX,5]]);a.ComponentTechnique=p;a.attributeLocations=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/Material/ComponentTechniqueConfiguration":function(){define("exports ../../../../../../chunks/tslib.es6 ./shader/ComponentData.glsl ./shader/VertexDiscardByOpacity.glsl ../../../core/shaderLibrary/ShaderOutput ../../../core/shaderLibrary/attributes/NormalAttribute.glsl ../../../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../../../core/shaderLibrary/shading/Normals.glsl ../../../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../../../core/shaderLibrary/util/EllipsoidMode ../../../core/shaderTechnique/BindType ../../../core/shaderTechnique/ShaderTechniqueConfiguration ../../../lib/basicInterfaces ../../../lib/TransparencyPassType".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v){b.IntegratedMeshMode=void 0;(function(p){p[p.None=0]="None";p[p.NoOverlay=1]="NoOverlay";p[p.ColorOverlay=2]="ColorOverlay";p[p.ColorOverlayWithWater=3]="ColorOverlayWithWater";p[p.COUNT=4]="COUNT"})(b.IntegratedMeshMode||(b.IntegratedMeshMode={}));class x extends l.ShaderTechniqueConfiguration{constructor(){super(...arguments);this.output=f.ShaderOutput.Color;this.textureCoordinateType=k.TextureCoordinateAttributeType.None;this.componentData=c.ComponentDataType.Uniform;
this.cullFace=w.CullFaceOptions.Back;this.vertexDiscardMode=d.VertexDiscardMode.None;this.doubleSidedMode=g.NormalsDoubleSidedMode.WindingOrder;this.alphaDiscardMode=w.AlphaDiscardMode.Opaque;this.integratedMeshMode=b.IntegratedMeshMode.None;this.transparencyPassType=v.TransparencyPassType.NONE;this.ellipsoidMode=e.EllipsoidMode.Earth;this.pbrMode=q.PBRMode.Disabled;this.normalType=n.NormalType.Attribute;this.hasColorTexture=this.hasSlicePlane=this.hasNormals=this.hasVertexColors=this.doublePrecisionRequiresObfuscation=
this.spherical=!1;this.blendingEnabled=this.receiveShadows=this.receiveAmbientOcclusion=!0;this.cullAboveGround=this.multipassEnabled=this.hasOccludees=this.hasNormalTexture=this.hasOcclusionTexture=this.hasEmissionTexture=this.hasMetallicRoughnessTexture=this.hasPolygonOffset=this.hasScreenSpaceReflections=!1;this.hasCloudsReflections=!0;this.objectAndLayerIdColor=this.snowCover=!1}}a.__decorate([l.parameter({count:f.ShaderOutput.COUNT})],x.prototype,"output",void 0);a.__decorate([l.parameter({count:k.TextureCoordinateAttributeType.COUNT})],
x.prototype,"textureCoordinateType",void 0);a.__decorate([l.parameter({count:c.ComponentDataType.COUNT})],x.prototype,"componentData",void 0);a.__decorate([l.parameter({count:w.CullFaceOptions.COUNT})],x.prototype,"cullFace",void 0);a.__decorate([l.parameter({count:d.VertexDiscardMode.COUNT})],x.prototype,"vertexDiscardMode",void 0);a.__decorate([l.parameter({count:g.NormalsDoubleSidedMode.COUNT})],x.prototype,"doubleSidedMode",void 0);a.__decorate([l.parameter({count:w.AlphaDiscardMode.COUNT})],
x.prototype,"alphaDiscardMode",void 0);a.__decorate([l.parameter({count:b.IntegratedMeshMode.COUNT})],x.prototype,"integratedMeshMode",void 0);a.__decorate([l.parameter({count:v.TransparencyPassType.COUNT})],x.prototype,"transparencyPassType",void 0);a.__decorate([l.parameter({count:e.EllipsoidMode.COUNT})],x.prototype,"ellipsoidMode",void 0);a.__decorate([l.parameter({count:q.PBRMode.COUNT})],x.prototype,"pbrMode",void 0);a.__decorate([l.parameter({count:n.NormalType.COUNT})],x.prototype,"normalType",
void 0);a.__decorate([l.parameter()],x.prototype,"spherical",void 0);a.__decorate([l.parameter()],x.prototype,"doublePrecisionRequiresObfuscation",void 0);a.__decorate([l.parameter()],x.prototype,"hasVertexColors",void 0);a.__decorate([l.parameter()],x.prototype,"hasNormals",void 0);a.__decorate([l.parameter()],x.prototype,"hasSlicePlane",void 0);a.__decorate([l.parameter()],x.prototype,"hasColorTexture",void 0);a.__decorate([l.parameter()],x.prototype,"receiveAmbientOcclusion",void 0);a.__decorate([l.parameter()],
x.prototype,"receiveShadows",void 0);a.__decorate([l.parameter()],x.prototype,"blendingEnabled",void 0);a.__decorate([l.parameter()],x.prototype,"hasScreenSpaceReflections",void 0);a.__decorate([l.parameter()],x.prototype,"hasPolygonOffset",void 0);a.__decorate([l.parameter()],x.prototype,"hasMetallicRoughnessTexture",void 0);a.__decorate([l.parameter()],x.prototype,"hasEmissionTexture",void 0);a.__decorate([l.parameter()],x.prototype,"hasOcclusionTexture",void 0);a.__decorate([l.parameter()],x.prototype,
"hasNormalTexture",void 0);a.__decorate([l.parameter()],x.prototype,"hasOccludees",void 0);a.__decorate([l.parameter()],x.prototype,"multipassEnabled",void 0);a.__decorate([l.parameter()],x.prototype,"cullAboveGround",void 0);a.__decorate([l.parameter()],x.prototype,"hasCloudsReflections",void 0);a.__decorate([l.parameter()],x.prototype,"snowCover",void 0);a.__decorate([l.parameter()],x.prototype,"objectAndLayerIdColor",void 0);a.__decorate([l.parameter({constValue:!1})],x.prototype,"occlusionPass",
void 0);a.__decorate([l.parameter({constValue:m.BindType.Draw})],x.prototype,"pbrTextureBindType",void 0);a.__decorate([l.parameter({constValue:!0})],x.prototype,"hasSliceHighlight",void 0);a.__decorate([l.parameter({constValue:!1})],x.prototype,"hasSliceInVertexProgram",void 0);a.__decorate([l.parameter({constValue:!1})],x.prototype,"useCustomDTRExponentForWater",void 0);a.__decorate([l.parameter({constValue:!1})],x.prototype,"hasVertexTangents",void 0);a.__decorate([l.parameter({constValue:!0})],
x.prototype,"supportsTextureAtlas",void 0);a.__decorate([l.parameter({constValue:!1})],x.prototype,"highStepCount",void 0);a.__decorate([l.parameter({constValue:!1})],x.prototype,"instancedDoublePrecision",void 0);a.__decorate([l.parameter({constValue:!1})],x.prototype,"hasModelTransformation",void 0);a.__decorate([l.parameter({constValue:!0})],x.prototype,"useFillLights",void 0);a.__decorate([l.parameter({constValue:!1})],x.prototype,"objectAndLayerIdColorInstanced",void 0);b.ComponentTechniqueConfiguration=
x;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/ComponentData.glsl":function(){define("exports ../../../../../../../core/compilerUtils ../../../../../../../core/floatRGBA ../../../../../../../core/has ./DecodeSymbolColor.glsl ../../../../core/shaderLibrary/ShaderOutput ../../../../core/shaderLibrary/util/RgbaFloatEncoding.glsl ../../../../core/shaderModules/Float4DrawUniform ../../../../core/shaderModules/IntegerDrawUniform ../../../../core/shaderModules/interfaces ../../../../core/shaderModules/Texture2DDrawUniform ../../../../lib/VertexAttribute".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l){function w(p,h){const {vertex:t,fragment:r}=p;t.include(k.RgbaFloatEncoding);t.uniforms.add(new m.Texture2DDrawUniform("componentColorTex",u=>u.componentParameters.texture.texture));p.attributes.add(l.VertexAttribute.COMPONENTINDEX,"float");p.varyings.add("vExternalColorMixMode","mediump float");p.varyings.add("vExternalColor","vec4");(h=h.output===n.ShaderOutput.ObjectAndLayerIdColor)&&p.varyings.add("vObjectAndLayerIdColor","vec4");p.include(f.DecodeSymbolColor);
t.constants.add("elevationScale","float",2*x);t.constants.add("stride","float",d("enable-feature:objectAndLayerId-rendering")?3:2);t.code.add(e.glsl`vec2 getComponentTextureCoordinates(float componentIndex, float typeOffset) {
float index = componentIndex * stride + typeOffset;
float texSize = float(textureSize(componentColorTex, 0).x);
float coordX = mod(index, texSize);
float coordY = floor(index / texSize);
return vec2(coordX, coordY) + 0.5;
}`);t.code.add(e.glsl`
  vec4 _readComponentColor() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 0.0);

    return texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
   }

   float readElevationOffset() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 1.0);

    vec4 encodedElevation = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
    return (rgba2float(encodedElevation) - 0.5) * elevationScale;
  }

  ${h?e.glsl`
          void forwardObjectAndLayerIdColor() {
            vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 2.0);

            vObjectAndLayerIdColor = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
          }`:e.glsl`void forwardObjectAndLayerIdColor() {}`}

  vec4 forwardExternalColor(out bool castShadows) {
    vec4 componentColor = _readComponentColor() * 255.0;

    float shadowFlag = mod(componentColor.b * 255.0, 2.0);
    componentColor.b -= shadowFlag;
    castShadows = shadowFlag >= 1.0;

    int decodedColorMixMode;
    vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;
    vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts

    return vExternalColor;
  }
`);r.code.add(e.glsl`
  void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
    externalColor = vExternalColor;
    externalColorMixMode = int(vExternalColorMixMode);
  }

  void outputObjectAndLayerIdColor() {
     ${h?e.glsl`fragColor = vObjectAndLayerIdColor;`:""}
  }
`)}function v(p){const {vertex:h,fragment:t}=p;h.uniforms.add(new g.Float4DrawUniform("externalColor",r=>r.componentParameters.externalColor));t.uniforms.add(new q.IntegerDrawUniform("externalColorMixMode",r=>r.componentParameters.externalColorMixMode));p.varyings.add("vExternalColor","vec4");h.code.add(e.glsl`float readElevationOffset() {
return 0.0;
}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`);t.code.add(e.glsl`void readExternalColor(out vec4 color, out int colorMixMode) {
color = vExternalColor;
colorMixMode = externalColorMixMode;
}`)}b.ComponentDataType=void 0;(function(p){p[p.Uniform=0]="Uniform";p[p.Varying=1]="Varying";p[p.COUNT=2]="COUNT"})(b.ComponentDataType||(b.ComponentDataType={}));const x=2**32/1E4;b.ComponentData=function(p,h){switch(h.componentData){case b.ComponentDataType.Varying:return w(p,h);case b.ComponentDataType.Uniform:return v(p);case b.ComponentDataType.COUNT:break;default:a.neverReached(h.componentData)}};b.encodeElevationOffset=function(p,h){c.packFloatRGBA(p/x*.5+.5,h)};b.maxElevationOffset=x;Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/IntegerDrawUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(b,a,c){class d extends a.Uniform{constructor(f,n){super(f,"int",c.BindType.Draw,(k,g,q)=>k.setUniform1i(f,n(g,q)))}}b.IntegerDrawUniform=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/VertexDiscardByOpacity.glsl":function(){define(["exports",
"../../../../../../../core/compilerUtils","../../../../core/shaderModules/interfaces"],function(b,a,c){b.VertexDiscardMode=void 0;(function(d){d[d.None=0]="None";d[d.Transparent=1]="Transparent";d[d.Opaque=2]="Opaque";d[d.COUNT=3]="COUNT"})(b.VertexDiscardMode||(b.VertexDiscardMode={}));b.VertexDiscardByOpacity=function(d,f){d=d.vertex;d.code.add(c.glsl`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`);switch(f.vertexDiscardMode){case b.VertexDiscardMode.None:d.code.add(c.glsl`#define vertexDiscardByOpacity(_opacity_) {}`);
break;case b.VertexDiscardMode.Opaque:d.code.add(c.glsl`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case b.VertexDiscardMode.Transparent:d.code.add(c.glsl`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case b.VertexDiscardMode.COUNT:break;default:a.neverReached(f.vertexDiscardMode)}};Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/EllipsoidMode":function(){define(["exports","../../../../../../geometry/support/spatialReferenceUtils"],function(b,a){b.EllipsoidMode=void 0;(function(c){c[c.Earth=1]="Earth";c[c.Mars=2]="Mars";c[c.Moon=3]="Moon";c[c.COUNT=4]="COUNT"})(b.EllipsoidMode||(b.EllipsoidMode={}));b.getEllipsoidMode=function(c){return c&&a.isMars(c)?b.EllipsoidMode.Mars:c&&a.isMoon(c)?b.EllipsoidMode.Moon:b.EllipsoidMode.Earth};Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/chunks/ComponentShader.glsl":function(){define("exports ../geometry/support/Ellipsoid ../views/3d/terrain/OverlayContent ../views/3d/webgl-engine/collections/Component/Material/ComponentTechniqueConfiguration ../views/3d/webgl-engine/collections/Component/Material/shader/ComponentData.glsl ../views/3d/webgl-engine/collections/Component/Material/shader/VertexDiscardByOpacity.glsl ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeMaterialColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeShadingNormal.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadBaseColorTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/Overlay.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/EllipsoidMode ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/TransparencyPassType".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A,C,E,B,D,F,K,L,G,O,P,J){function R(U){const M=new O.ShaderBuilder;M.include(v.VertexPosition,U);M.include(w.VertexNormal,U);M.include(l.VertexColor,U);M.include(m.TextureCoordinateAttribute,U);M.include(k.ForwardLinearDepth,U);M.include(f.ComponentData,U);M.include(K.DiscardOrAdjustAlphaDraw,U);M.include(q.SlicePass,U);M.include(E.ReadBaseColorTexture,U);M.include(n.VertexDiscardByOpacity,U);const {vertex:V,fragment:Y}=M;if(U.pbrMode===C.PBRMode.Normal||
U.pbrMode===C.PBRMode.Schematic)M.include(C.PhysicallyBasedRenderingParameters,U),U.hasNormalTexture&&M.include(r.ComputeNormalTexture,U);const W=U.output===g.ShaderOutput.Shadow||U.output===g.ShaderOutput.ShadowHighlight||U.output===g.ShaderOutput.ShadowExcludeHighlight;W&&U.componentData===f.ComponentDataType.Varying?V.code.add(G.glsl`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):V.code.add(G.glsl`#define discardShadows(castShadows) {}`);
const H=U.integratedMeshMode===d.IntegratedMeshMode.ColorOverlay||U.integratedMeshMode===d.IntegratedMeshMode.ColorOverlayWithWater,S=H&&U.output===g.ShaderOutput.Color&&U.pbrMode===C.PBRMode.WaterOnIntegratedMesh;H&&(M.include(y.EvaluateSceneLighting,U),M.include(D.OverlayIM,U),U.spherical?V.code.add(G.glsl`
      const float invEllipsoidRadius = ${G.glsl.float(1/(U.ellipsoidMode===L.EllipsoidMode.Earth?a.earth.radius:U.ellipsoidMode===L.EllipsoidMode.Mars?a.mars.radius:a.moon.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):V.code.add(G.glsl`vec2 projectOverlay(vec3 pos) { return pos.xy; }`));S&&(M.varyings.add("tbnTangent","vec3"),M.varyings.add("tbnBiTangent","vec3"),M.varyings.add("groundNormal","vec3"));V.code.add(G.glsl`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      ${U.output===g.ShaderOutput.ObjectAndLayerIdColor?G.glsl`externalColor.a = 1.0;`:""}

      if (externalColor.a < ${G.glsl.float(F.symbolAlphaCutoff)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${U.output===g.ShaderOutput.ObjectAndLayerIdColor?G.glsl`forwardObjectAndLayerIdColor();`:""}
      ${S?U.spherical?G.glsl`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:G.glsl`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${H?G.glsl`setOverlayVTC(projectOverlay(position));`:""}
    }
  `);U.output===g.ShaderOutput.Alpha&&(Y.include(h.ReadLinearDepth),M.include(A.multipassTerrainTest,U),M.include(t.ComputeMaterialColor,U),H&&Y.uniforms.add(new P.Texture2DPassUniform("ovColorTex",(I,Q)=>D.getIMColorTexture(I,Q))),Y.code.add(G.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${U.multipassEnabled?G.glsl`terrainDepthTest(vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${H?G.glsl`
                vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);
                materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        fragColor = vec4(materialColor.a);
      }
    `));U.output===g.ShaderOutput.Color&&(Y.include(h.ReadLinearDepth),M.include(A.multipassTerrainTest,U),M.include(t.ComputeMaterialColor,U),M.include(u.ComputeShadingNormal,U),M.include(y.EvaluateSceneLighting,U),U.receiveShadows?(M.include(B.ReadShadowMapPass,U),Y.code.add(G.glsl`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):Y.code.add(G.glsl`float evaluateShadow() { return 0.0; }`),H&&Y.uniforms.add(new P.Texture2DPassUniform("ovColorTex",(I,Q)=>D.getIMColorTexture(I,Q))),Y.code.add(G.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${U.multipassEnabled?G.glsl`terrainDepthTest(vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${H?G.glsl`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),U.pbrMode===C.PBRMode.Normal||U.pbrMode===C.PBRMode.Schematic?(z.addMainLightIntensity(Y),Y.code.add(G.glsl`
        ${U.pbrMode===C.PBRMode.Normal?G.glsl`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * mainLightIntensity[2];
      `),U.hasNormalTexture?Y.code.add(G.glsl`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):Y.code.add(G.glsl`vec3 shadingNormal = normalVertex;`),Y.code.add(G.glsl`${U.spherical?G.glsl`vec3 normalGround = normalize(positionWorld());`:G.glsl`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),Y.code.add(G.glsl`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * evaluateAmbientOcclusionInverse();

        ${U.snowCover?G.glsl`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);

                shadingNormal = mix(shadingNormal, surfaceNormal, snow);
                ssao = mix(ssao, 0.0, snow);
                mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                emission = mix(emission, vec3(0.0), snow);`:""}

        ${H?G.glsl` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(U.receiveShadows?Y.code.add(G.glsl`float shadow = evaluateShadow();`):U.spherical?(y.addLightingGlobalFactor(Y),Y.code.add(G.glsl`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):Y.code.add(G.glsl`float shadow = 0.0;`),S&&Y.uniforms.add(new P.Texture2DPassUniform("ovNormalTex",(I,Q)=>Q.overlay?.getTexture(c.OverlayContent.WaterNormal))),U.snowCover&&Y.code.add(G.glsl`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`),Y.code.add(G.glsl`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${H?G.glsl` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${S?G.glsl`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),Y.code.add(G.glsl`
        fragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${U.transparencyPassType===J.TransparencyPassType.Color?"fragColor \x3d premultiplyAlpha(fragColor);":""}
      }
    `));if(U.output===g.ShaderOutput.Depth||W)M.include(x.OutputDepth,U),Y.code.add(G.glsl`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`);U.output===g.ShaderOutput.Normal&&(M.include(u.ComputeShadingNormal,U),Y.code.add(G.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material to influence ambient occlusion,
        // see the ssao fragment shader
        float alpha = ${U.normalType===e.NormalType.Ground?"0.0":"1.0"};
        fragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `));U.output===g.ShaderOutput.ObjectAndLayerIdColor&&M.fragment.code.add(G.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${H?G.glsl`fragColor = getOverlayColorTexel(vtcOverlay);`:"outputObjectAndLayerIdColor();"}
      }
    `);U.output===g.ShaderOutput.Highlight&&(M.include(p.OutputHighlight),Y.code.add(G.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${H?G.glsl`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  fragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `));return M}const X=Object.freeze(Object.defineProperty({__proto__:null,build:R},Symbol.toStringTag,{value:"Module"}));b.ComponentShader=X;b.build=R})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeMaterialColor.glsl":function(){define("exports ../attributes/VertexColor.glsl ../util/MixExternalColor.glsl ../../shaderModules/Float4DrawUniform ../../shaderModules/FloatDrawUniform ../../shaderModules/interfaces".split(" "),function(b,a,c,d,f,n){b.ComputeMaterialColor=function(k,
g){k.include(a.VertexColor,g);k.fragment.include(c.MixExternalColor);k=k.fragment;k.uniforms.add(new d.Float4DrawUniform("baseColor",q=>q.baseColor));k.uniforms.add(new f.FloatDrawUniform("objectOpacity",q=>q.objectOpacity));g.hasVertexColors?k.code.add(n.glsl`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):k.code.add(n.glsl`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`);k.code.add(n.glsl`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeShadingNormal.glsl":function(){define("exports ../../../../../../core/compilerUtils ../attributes/NormalAttribute.glsl ../attributes/VertexNormal.glsl ../attributes/VertexPosition.glsl ./Normals.glsl ../../shaderModules/interfaces".split(" "),function(b,a,c,d,f,n,k){b.ComputeShadingNormal=function(g,q){const e=g.fragment;switch(q.doubleSidedMode){case n.NormalsDoubleSidedMode.None:e.code.add(k.glsl`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case n.NormalsDoubleSidedMode.View:g.include(f.VertexPosition,q);e.code.add(k.glsl`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case n.NormalsDoubleSidedMode.WindingOrder:e.code.add(k.glsl`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:a.neverReached(q.doubleSidedMode);case n.NormalsDoubleSidedMode.COUNT:}switch(q.normalType){case c.NormalType.Attribute:case c.NormalType.Compressed:g.include(d.VertexNormal,q);e.code.add(k.glsl`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case c.NormalType.ScreenDerivative:g.include(f.VertexPosition,q);e.code.add(k.glsl`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case c.NormalType.Ground:q.spherical?(g.include(f.VertexPosition,q),e.code.add(k.glsl`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):e.code.add(k.glsl`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`);e.code.add(k.glsl`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:a.neverReached(q.normalType);case c.NormalType.COUNT:}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ReadBaseColorTexture.glsl":function(){define("exports ../ShaderOutput ../attributes/TextureCoordinateAttribute.glsl ../attributes/VertexTextureCoordinates.glsl ../util/TextureAtlasLookup.glsl ../../shaderModules/interfaces ../../shaderModules/Texture2DDrawUniform ../../../lib/basicInterfaces".split(" "),function(b,
a,c,d,f,n,k,g){b.ReadBaseColorTexture=function(q,e){const m=q.fragment;!e.hasColorTexture||e.output!==a.ShaderOutput.Color&&e.alphaDiscardMode===g.AlphaDiscardMode.Opaque?m.code.add(n.glsl`vec4 readBaseColorTexture() { return vec4(1.0); }`):(q.include(d.VertexTextureCoordinates,e),e=e.textureCoordinateType===c.TextureCoordinateAttributeType.Atlas,m.uniforms.add(new k.Texture2DDrawUniform("baseColorTexture",l=>l.texture)),e?(q.include(f.TextureAtlasLookup),m.code.add(n.glsl`vec4 readBaseColorTexture() {
return textureAtlasLookup(baseColorTexture, vuv0, vuvRegion);
}`)):m.code.add(n.glsl`vec4 readBaseColorTexture() {
return texture(baseColorTexture, vuv0);
}`))};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/material/MaterialBase":function(){define(["exports","../shaderModules/interfaces"],function(b,a){class c extends a.NoParameters{constructor(){super(...arguments);this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1;if(null!=this._parameterBlocks)for(const f of this._parameterBlocks)this[f]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(null==
this._parameterBlocks)return!1;for(const f of this._parameterBlocks)if(this[f].dirty)return!0;return!1}}class d{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}}b.MaterialBase=c;b.MaterialParameterBlock=d;b.parameter=function(f={}){return(n,k)=>{const g=n._parameterCount??0;n._parameterCount=g+1;if(f.vectorOps){const q=f.vectorOps;Object.defineProperty(n,k,{get(){return this[g]},set(e){const m=this[g];if(null==m)this[g]=e;else{if(q.equals(m,
e))return;q.copy(m,e)}this._setDirty()}})}else Object.defineProperty(n,k,{get(){return this[g]},set(q){this[g]!==q&&(f.dispose&&this[g]&&this[g].dispose(),this[g]=q,this._setDirty())}})}};b.parameterBlock=function(){return(f,n)=>{const k=f._parameterCount??0;f._parameterCount=k+1;f._parameterBlocks=f._parameterBlocks||[];f._parameterBlocks.push(k);Object.defineProperty(f,n,{get(){return this[k]},set(g){this[k]!==g&&(this[k]=g,this._setDirty())}})}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/core/util/TwoVectorPosition":function(){define(["exports","../../../../../chunks/vec3","../../../../../chunks/vec3f32","../../../../../chunks/vec3f64"],function(b,a,c,d){class f{constructor(k){this._low=d.create();this._high=d.create();k&&this.set(k)}get low(){return this._low}get high(){return this._high}set(k){a.copy(this._low,a.copy(n,k));k=a.sub(n,k,this._low);a.copy(this._high,k)}get(k){return a.add(k,this._low,this._high)}getLowScaled(k){return a.scale(k,this._low,
1)}}const n=c.create();b.TwoVectorPosition=f;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/bufferLayouts":function(){define(["exports","../../../support/buffer/glUtil","../../../support/buffer/InterleavedLayout","../VertexAttribute"],function(b,a,c,d){const f=c.newLayout().vec3f(d.VertexAttribute.POSITION).u16(d.VertexAttribute.COMPONENTINDEX),n=c.newLayout().vec2u8(d.VertexAttribute.SIDENESS);a=a.glLayout(n);const k=c.newLayout().vec3f(d.VertexAttribute.POSITION0).vec3f(d.VertexAttribute.POSITION1).vec3f(d.VertexAttribute.NORMAL).u16(d.VertexAttribute.COMPONENTINDEX).u8(d.VertexAttribute.VARIANTOFFSET,
{glNormalized:!0}).u8(d.VertexAttribute.VARIANTSTROKE).u8(d.VertexAttribute.VARIANTEXTENSION,{glNormalized:!0});c=c.newLayout().vec3f(d.VertexAttribute.POSITION0).vec3f(d.VertexAttribute.POSITION1).vec3f(d.VertexAttribute.NORMALA).vec3f(d.VertexAttribute.NORMALB).u16(d.VertexAttribute.COMPONENTINDEX).u8(d.VertexAttribute.VARIANTOFFSET,{glNormalized:!0}).u8(d.VertexAttribute.VARIANTSTROKE).u8(d.VertexAttribute.VARIANTEXTENSION,{glNormalized:!0});d=new Map([[d.VertexAttribute.POSITION0,0],[d.VertexAttribute.POSITION1,
1],[d.VertexAttribute.COMPONENTINDEX,2],[d.VertexAttribute.VARIANTOFFSET,3],[d.VertexAttribute.VARIANTSTROKE,4],[d.VertexAttribute.VARIANTEXTENSION,5],[d.VertexAttribute.NORMAL,6],[d.VertexAttribute.NORMALA,6],[d.VertexAttribute.NORMALB,7],[d.VertexAttribute.SIDENESS,8]]);b.EdgeInputBufferLayout=f;b.EdgeShaderAttributeLocations=d;b.RegularEdgeInstancesLayout=k;b.SilhouetteEdgeInstancesLayout=c;b.VertexLayout=n;b.glVertexLayout=a;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgeProcessing":function(){define("exports ../../../../../geometry/support/meshUtils/deduplicate ../../../support/meshProcessing ../../../support/buffer/InterleavedLayout ../VertexAttribute ./bufferLayouts ./edgeBufferWriters ./edgePreprocessing".split(" "),
function(b,a,c,d,f,n,k,g){function q(w,v,x,p){if(v)return v=c.computeNeighbors(x,p,w.count),new e(x,p,v,w);w=a.deduplicate(w.buffer,w.stride/4,{originalIndices:x,originalIndicesLength:p});p=c.computeNeighbors(w.indices,p,w.uniqueCount);return{faces:w.indices,facesLength:w.indices.length,neighbors:p,vertices:n.EdgeInputBufferLayout.createView(w.buffer)}}class e{constructor(w,v,x,p){this.faces=w;this.facesLength=v;this.neighbors=x;this.vertices=p}}const m=new k.RegularEdgeBufferWriter,l=new k.SilhouetteEdgeBufferWriter;
k=d.newLayout().vec3f(f.VertexAttribute.POSITION0).vec3f(f.VertexAttribute.POSITION1);d=d.newLayout().vec3f(f.VertexAttribute.POSITION0).vec3f(f.VertexAttribute.POSITION1).u16(f.VertexAttribute.COMPONENTINDEX);b.extract=function(w){const v=q(w.data,w.skipDeduplicate,w.indices,w.indicesLength);m.updateSettings(w.writerSettings);l.updateSettings(w.writerSettings);return g.extractEdges(v,m,l)};b.extractComponentsEdgeLocationsLayout=d;b.extractEdgeInformation=q;b.extractEdgeLocationsLayout=k;Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/meshProcessing":function(){define(["exports"],function(b){b.computeNeighbors=function(a,c,d){c/=3;const f=new Uint32Array(d+1),n=new Uint32Array(d+1);var k=(p,h)=>{p<h?f[p+1]++:n[h+1]++};for(var g=0;g<c;g++){var q=a[3*g],e=a[3*g+1],m=a[3*g+2];k(q,e);k(e,m);k(m,q)}g=k=0;for(q=0;q<d;q++)e=f[q+1],m=n[q+1],f[q+1]=k,n[q+1]=g,k+=e,g+=m;const l=new Uint32Array(6*c),w=f[d];k=(p,h,t)=>{p<h?(p=f[p+1]++,l[2*p]=h,l[2*p+1]=t):(h=n[h+1]++,l[2*w+2*h]=
p,l[2*w+2*h+1]=t)};for(g=0;g<c;g++)q=a[3*g],e=a[3*g+1],m=a[3*g+2],k(q,e,g),k(e,m,g),k(m,q,g);k=(p,h)=>{const t=2*p;p=h-p;for(h=1;h<p;h++){const r=l[t+2*h],u=l[t+2*h+1];let y=h-1;for(y;0<=y&&l[t+2*y]>r;y--)l[t+2*y+2]=l[t+2*y],l[t+2*y+3]=l[t+2*y+1];l[t+2*y+2]=r;l[t+2*y+3]=u}};for(g=0;g<d;g++)k(f[g],f[g+1]),k(w+n[g],w+n[g+1]);const v=new Int32Array(3*c),x=(p,h)=>p===a[3*h]?0:p===a[3*h+1]?1:p===a[3*h+2]?2:-1;c=(p,h)=>{p=x(p,h);v[3*h+p]=-1};k=(p,h,t,r)=>{p=x(p,h);v[3*h+p]=r;t=x(t,r);v[3*r+t]=h};for(g=
0;g<d;g++){q=f[g];e=f[g+1];m=n[g];const p=n[g+1];for(;q<e&&m<p;){const h=l[2*q],t=l[2*w+2*m];h===t?(k(g,l[2*q+1],t,l[2*w+2*m+1]),q++,m++):h<t?(c(g,l[2*q+1]),q++):(c(t,l[2*w+2*m+1]),m++)}for(;q<e;)c(g,l[2*q+1]),q++;for(;m<p;)c(l[2*w+2*m],l[2*w+2*m+1]),m++}return v};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgeBufferWriters":function(){define("exports ../../../../../core/RandomLCG ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../support/buffer/glUtil ./bufferLayouts".split(" "),
function(b,a,c,d,f,n){function k(t){const r=m;r[0]=t.position0[0];r[1]=t.position0[1];r[2]=t.position0[2];r[3]=t.position1[0];r[4]=t.position1[1];r[5]=t.position1[2];w[0]=5381;for(t=0;t<l.length;t++)w[0]=31*w[0]+l[t];return w[0]}function g(t){const r=m;r[0]=q(t.position0[0]);r[1]=q(t.position0[1]);r[2]=q(t.position0[2]);r[3]=q(t.position1[0]);r[4]=q(t.position1[1]);r[5]=q(t.position1[2]);w[0]=5381;for(t=0;t<l.length;t++)w[0]=31*w[0]+l[t];return w[0]}function q(t){return Math.round(1E4*t)/1E4}class e{updateSettings(t){this.settings=
t;this._edgeHashFunction=t.reducedPrecision?g:k}write(t,r,u){var y=this._edgeHashFunction(u);h.seed=y;y=h.getIntRange(0,255);const z=h.getIntRange(0,this.settings.variants-1);var A=h.getFloat();A=-(1-Math.min(A/.7,1))+Math.max(0,A-.7)/(1-.7);A=255*(Math.abs(A)**1.2*(0>A?-1:1)*.5+.5);t.position0.setVec(r,u.position0);t.position1.setVec(r,u.position1);t.componentIndex.set(r,u.componentIndex);t.variantOffset.set(r,y);t.variantStroke.set(r,z);t.variantExtension.set(r,A)}trim(t,r){return t.slice(0,r)}}
const m=new Float32Array(6),l=new Uint32Array(m.buffer),w=new Uint32Array(1);class v{constructor(){this._commonWriter=new e}updateSettings(t){this._commonWriter.updateSettings(t)}allocate(t){return n.RegularEdgeInstancesLayout.createBuffer(t)}write(t,r,u){this._commonWriter.write(t,r,u);c.add(p,u.faceNormal0,u.faceNormal1);c.normalize(p,p);t.normal.setVec(r,p)}trim(t,r){return this._commonWriter.trim(t,r)}}v.Layout=n.RegularEdgeInstancesLayout;v.glLayout=f.glLayout(n.RegularEdgeInstancesLayout,1);
class x{constructor(){this._commonWriter=new e}updateSettings(t){this._commonWriter.updateSettings(t)}allocate(t){return n.SilhouetteEdgeInstancesLayout.createBuffer(t)}write(t,r,u){this._commonWriter.write(t,r,u);t.normalA.setVec(r,u.faceNormal0);t.normalB.setVec(r,u.faceNormal1)}trim(t,r){return this._commonWriter.trim(t,r)}}x.Layout=n.SilhouetteEdgeInstancesLayout;x.glLayout=f.glLayout(n.SilhouetteEdgeInstancesLayout,1);const p=d.create(),h=new a;b.CommonBufferWriter=e;b.RegularEdgeBufferWriter=
v;b.SilhouetteEdgeBufferWriter=x;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgePreprocessing":function(){define(["exports","../../../../../core/arrayUtils","../../../../../core/mathUtils","../../../../../chunks/vec3","../../../../../chunks/vec3f64"],function(b,a,c,d,f){function n(l,w){const v=c.acosClamped(l.cosAngle),x=q.fwd,p=q.ortho;d.direction(x,l.position1,l.position0);l=0<d.dot(d.cross(p,l.faceNormal0,l.faceNormal1),x)?-1:1;
return v*l>w}function k(l){const w=l.faces.length/3,v=l.faces;l=l.neighbors;var x=0;for(var p=0;p<w;p++){var h=l[3*p+1],t=l[3*p+2],r=v[3*p],u=v[3*p+1],y=v[3*p+2];x+=-1===l[3*p]||r<u?1:0;x+=-1===h||u<y?1:0;x+=-1===t||y<r?1:0}x=new Int32Array(4*x);p=0;for(h=0;h<w;h++){t=l[3*h];r=l[3*h+1];u=l[3*h+2];y=v[3*h];const z=v[3*h+1],A=v[3*h+2];if(-1===t||y<z)x[p++]=y,x[p++]=z,x[p++]=h,x[p++]=t;if(-1===r||z<A)x[p++]=z,x[p++]=A,x[p++]=h,x[p++]=r;if(-1===u||A<y)x[p++]=A,x[p++]=y,x[p++]=h,x[p++]=u}return x}function g(l){const w=
l.faces.length/3,v=l.vertices.position;l=l.faces;const x=e.v0,p=e.v1,h=e.v2,t=new Float32Array(3*w);for(let r=0;r<w;r++){const u=l[3*r+1],y=l[3*r+2];v.getVec(l[3*r],x);v.getVec(u,p);v.getVec(y,h);d.subtract(p,p,x);d.subtract(h,h,x);d.cross(x,p,h);d.normalize(x,x);t[3*r]=x[0];t[3*r+1]=x[1];t[3*r+2]=x[2]}return t}b.EdgeType=void 0;(function(l){l[l.SOLID=0]="SOLID";l[l.SKETCH=1]="SKETCH"})(b.EdgeType||(b.EdgeType={}));const q={edge:{position0:f.create(),position1:f.create(),faceNormal0:f.create(),faceNormal1:f.create(),
componentIndex:0,cosAngle:0},ortho:f.create(),fwd:f.create()},e={v0:f.create(),v1:f.create(),v2:f.create()},m={anglePlanar:4,angleSignificantEdge:35};b.extractEdges=function(l,w,v,x=m){const p=l.vertices.position;var h=l.vertices.componentIndex,t=c.deg2rad(x.anglePlanar);x=c.deg2rad(x.angleSignificantEdge);const r=Math.cos(x),u=Math.cos(t),y=q.edge,z=y.position0,A=y.position1,C=y.faceNormal0,E=y.faceNormal1,B=g(l),D=k(l),F=D.length/4;l=w.allocate(F);x=0;const K=v.allocate(F);let L=0,G=0,O=0;const P=
a.range(0,F),J=new Float32Array(F);J.forEach((M,V,Y)=>{p.getVec(D[4*V],z);p.getVec(D[4*V+1],A);Y[V]=d.distance(z,A)});P.sort((M,V)=>J[V]-J[M]);const R=[],X=[];for(let M=0;M<F;M++){var U=P[M];const V=J[U],Y=D[4*U],W=D[4*U+1],H=D[4*U+2];U=D[4*U+3];const S=-1===U;p.getVec(Y,z);p.getVec(W,A);if(S)d.set(C,B[3*H],B[3*H+1],B[3*H+2]),d.copy(E,C),y.componentIndex=h.get(Y),y.cosAngle=d.dot(C,E);else{d.set(C,B[3*H],B[3*H+1],B[3*H+2]);d.set(E,B[3*U],B[3*U+1],B[3*U+2]);y.componentIndex=h.get(Y);y.cosAngle=d.dot(C,
E);if(y.cosAngle>u)continue;-.9999>y.cosAngle&&d.copy(E,C)}G+=V;O++;S||y.cosAngle<r?(w.write(l,x++,y),R.push(V)):n(y,t)&&(v.write(K,L++,y),X.push(V))}h=new Float32Array(R.reverse());t=new Float32Array(X.reverse());return{regular:{instancesData:w.trim(l,x),lodInfo:{lengths:h}},silhouette:{instancesData:v.trim(K,L),lodInfo:{lengths:t}},averageEdgeLength:G/O}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/BufferManager":function(){define(["exports",
"./ManagedTextureBackedBuffer"],function(b,a){class c{constructor(d,f=1){this._rctx=d;this._fieldCount=f;this._buffers=[]}garbageCollect(){this._buffers=this._buffers.filter(d=>0===d.activeCount?(d.dispose(),!1):!0)}destroy(){this._buffers.forEach(d=>d.dispose());this._buffers=[]}getBuffer(d){for(const f of this._buffers)if(f.availableCount>=d)return f;if(d>a.maxIndexCount)return null;d=new a.ManagedTextureBackedBuffer(this._rctx,this._fieldCount);this._buffers.push(d);return d}updateTextures(){for(const d of this._buffers)d.textureBuffer.updateTexture()}}
b.BufferManager=c;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/ManagedTextureBackedBuffer":function(){define(["exports","./SimpleIndexManager","./TextureBackedBuffer"],function(b,a,c){class d{constructor(f,n=1){this.textureBuffer=new c.TextureBackedBuffer(f,n);this._indexManager=new a.SimpleIndexManager(65536)}dispose(){this.textureBuffer.dispose();this.textureBuffer=void 0}get availableCount(){return this._indexManager.availableCount}get activeCount(){return this._indexManager.activeCount}acquireIndex(){const f=
this._indexManager.acquire();this.textureBuffer.resizeToFit(f);return f}releaseIndex(f){this._indexManager.release(f)}}b.ManagedTextureBackedBuffer=d;b.maxIndexCount=65536;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/SimpleIndexManager":function(){define(["exports"],function(b){class a{constructor(c){this._maxCount=c;this._nextIndex=0;this._recycledIndices=[]}get activeCount(){return this._nextIndex-this._recycledIndices.length}get availableCount(){return this._recycledIndices.length+
this._maxCount-this._nextIndex}acquire(){if(0<this._recycledIndices.length)return this._recycledIndices.pop();if(this.availableCount)return this._nextIndex++}release(c){this._recycledIndices.push(c)}}b.SimpleIndexManager=a;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/TextureBackedBuffer":function(){define(["exports","../../../../../geometry/support/buffer/BufferView","../../../../webgl/enums","../../../../webgl/Texture","../../../../webgl/TextureDescriptor"],
function(b,a,c,d,f){class n{constructor(k,g=1){this._rctx=k;this._fieldCount=g;this.textureWidth=4096;this._dirty=!0;k=new f.TextureDescriptor(this.textureWidth,1);k.samplingMode=c.TextureSamplingMode.NEAREST;k.wrapMode=c.TextureWrapMode.CLAMP_TO_EDGE;this._texture=new d.Texture(this._rctx,k);this._data=new a.BufferViewVec4u8(new ArrayBuffer(4*this.textureWidth))}dispose(){this._texture.dispose();this._data=this._texture=void 0}setData(k,g,q,e,m,l){k=k*this._fieldCount+g;this._dirty=!0;this._data.set(k,
0,q);this._data.set(k,1,e);this._data.set(k,2,m);this._data.set(k,3,l)}setDataElement(k,g,q,e){k=k*this._fieldCount+g;this._dirty=!0;this._data.set(k,q,e)}getDataElement(k,g,q){k=k*this._fieldCount+g;this._dirty=!0;return this._data.get(k,q)}resizeToFit(k){k=(k+1)*this._fieldCount;k>this._data.count&&(k=new a.BufferViewVec4u8(new ArrayBuffer(Math.ceil(k/this.textureWidth)*this.textureWidth*4)),k.typedBuffer.set(this._data.typedBuffer),this._data=k)}updateTexture(){if(this._dirty){var k=this._texture.descriptor.width;
this._data.count>k*this._texture.descriptor.height&&this._texture.resize(k,this._data.count/k);this._texture.setData(this._data.typedBuffer);this._dirty=!1}}get texture(){return this._texture}}b.TextureBackedBuffer=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/CompositingHelper":function(){define("../../../../chunks/Compositing.glsl ../shaders/CompositingTechnique ../shaders/CompositingTechniqueConfiguration ../../../../chunks/HUDCompositing.glsl ../shaders/HUDCompositingTechnique ../../../../chunks/OITCompositing.glsl ../shaders/OITCompositingTechnique".split(" "),
function(b,a,c,d,f,n,k){class g{constructor(q,e){this._rctx=q;this._techniqueRepository=e;this._configuration=new c.CompositingTechniqueConfiguration;this._passParameters=new b.CompositingPassParameters;this._oitParameters=new n.OITCompositingPassParameters;this._hudParameters=new d.HUDCompositingPassParameters}compositeOIT(q,e,m,l){this._oitParameters.colorTexture=e;this._oitParameters.alphaTexture=m;this._oitParameters.frontFaceTexture=l;e=this._techniqueRepository.acquire(k.OITCompositingTechnique);
this._rctx.bindTechnique(e,this._oitParameters,q);this._rctx.screen.draw();e.release()}compositeHUD(q,e){this._hudParameters.texture=e;e=this._techniqueRepository.acquire(f.HUDCompositingTechnique);this._rctx.bindTechnique(e,this._hudParameters,q);this._rctx.screen.draw();e.release()}composite(q,e,m=c.AlphaMode.None,l=1){this._configuration.alphaMode=m;this._configuration.hasOpacityFactor=1!==l;this._passParameters.texture=e;this._passParameters.opacity=l;e=this._techniqueRepository.acquire(a.CompositingTechnique,
this._configuration);this._rctx.bindTechnique(e,this._passParameters,q);this._rctx.screen.draw();e.release()}}return g})},"esri/chunks/Compositing.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),function(b,
a,c,d,f,n){function k(e){const m=new f.ShaderBuilder;m.include(a.ScreenSpacePass);m.fragment.uniforms.add(new n.Texture2DPassUniform("tex",l=>l.texture));e.hasOpacityFactor&&m.fragment.uniforms.add(new c.FloatPassUniform("opacity",l=>l.opacity));m.fragment.code.add(d.glsl`
    void main() {
      fragColor = texture(tex, uv) ${e.hasOpacityFactor?"* opacity":""};
    }`);return m}class g extends d.NoParameters{constructor(){super(...arguments);this.opacity=1}}const q=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:g,build:k},Symbol.toStringTag,{value:"Module"}));b.Compositing=q;b.CompositingPassParameters=g;b.build=k})},"esri/views/3d/webgl-engine/shaders/CompositingTechnique":function(){define("require exports ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/Compositing.glsl ./CompositingTechniqueConfiguration ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(b,a,c,d,f,n,k,g,q,e){class m extends d.ShaderTechnique{initializeProgram(l){return new n.Program(l.rctx,m.shader.get().build(this.configuration),f.Default3D)}initializePipeline(){switch(this.configuration.alphaMode){case g.AlphaMode.None:return e.makePipelineState({colorWrite:e.defaultColorWriteParams});case g.AlphaMode.Alpha:return e.makePipelineState({blending:e.separateBlendingParams(q.BlendFactor.SRC_ALPHA,q.BlendFactor.ONE,q.BlendFactor.ONE_MINUS_SRC_ALPHA,q.BlendFactor.ONE_MINUS_SRC_ALPHA),
colorWrite:e.defaultColorWriteParams});case g.AlphaMode.PremultipliedAlpha:case g.AlphaMode.COUNT:return e.makePipelineState({blending:e.simpleBlendingParams(q.BlendFactor.ONE,q.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:e.defaultColorWriteParams})}}}m.shader=new c.ReloadableShaderModule(k.Compositing,()=>new Promise((l,w)=>b(["./Compositing.glsl"],l,w)));a.CompositingTechnique=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/CompositingTechniqueConfiguration":function(){define(["exports",
"../../../../chunks/tslib.es6","../core/shaderTechnique/ShaderTechniqueConfiguration"],function(b,a,c){b.AlphaMode=void 0;(function(f){f[f.None=0]="None";f[f.Alpha=1]="Alpha";f[f.PremultipliedAlpha=2]="PremultipliedAlpha";f[f.COUNT=3]="COUNT"})(b.AlphaMode||(b.AlphaMode={}));class d extends c.ShaderTechniqueConfiguration{constructor(){super(...arguments);this.alphaMode=b.AlphaMode.None;this.hasOpacityFactor=!1}}a.__decorate([c.parameter({count:b.AlphaMode.COUNT})],d.prototype,"alphaMode",void 0);
a.__decorate([c.parameter()],d.prototype,"hasOpacityFactor",void 0);b.CompositingTechniqueConfiguration=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/HUDCompositing.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder","../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform"],function(b,a,c,d,
f){function n(){const q=new d.ShaderBuilder;q.include(a.ScreenSpacePass);q.fragment.uniforms.add(new f.Texture2DPassUniform("tex",e=>e.texture));q.fragment.code.add(c.glsl`void main() {
fragColor = vec4(1.0 - texture(tex, uv).a);
}`);return q}class k extends c.NoParameters{}const g=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:k,build:n},Symbol.toStringTag,{value:"Module"}));b.HUDCompositing=g;b.HUDCompositingPassParameters=k;b.build=n})},"esri/views/3d/webgl-engine/shaders/HUDCompositingTechnique":function(){define("require exports ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/HUDCompositing.glsl ../../../webgl/renderState".split(" "),
function(b,a,c,d,f,n,k,g){class q extends d.ShaderTechnique{initializeProgram(e){return new n.Program(e.rctx,q.shader.get().build(),f.Default3D)}initializePipeline(){return g.makePipelineState({colorWrite:{r:!1,g:!0,b:!1,a:!1}})}}q.shader=new c.ReloadableShaderModule(k.HUDCompositing,()=>new Promise((e,m)=>b(["./HUDCompositing.glsl"],e,m)));a.HUDCompositingTechnique=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/OITCompositing.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl",
"../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder","../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform"],function(b,a,c,d,f){function n(){const q=new d.ShaderBuilder;q.include(a.ScreenSpacePass);q.fragment.uniforms.add(new f.Texture2DPassUniform("colorTexture",e=>e.colorTexture),new f.Texture2DPassUniform("alphaTexture",e=>e.alphaTexture),new f.Texture2DPassUniform("frontFaceTexture",e=>e.frontFaceTexture));q.fragment.code.add(c.glsl`void main() {
vec4 srcColor = texture(colorTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
float srcAlpha = texture(alphaTexture, uv).r;
vec4 frontFace = texture(frontFaceTexture, uv);
fragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`);return q}class k extends c.NoParameters{}const g=Object.freeze(Object.defineProperty({__proto__:null,OITCompositingPassParameters:k,build:n},Symbol.toStringTag,{value:"Module"}));b.OITCompositing=g;b.OITCompositingPassParameters=k;b.build=n})},"esri/views/3d/webgl-engine/shaders/OITCompositingTechnique":function(){define("require exports ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/OITCompositing.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(b,a,c,d,f,n,k,g,q){class e extends d.ShaderTechnique{initializeProgram(m){return new n.Program(m.rctx,e.shader.get().build(),f.Default3D)}initializePipeline(){return q.makePipelineState({blending:q.separateBlendingParams(g.BlendFactor.SRC_ALPHA,g.BlendFactor.ONE,g.BlendFactor.ONE_MINUS_SRC_ALPHA,g.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:q.defaultColorWriteParams})}}e.shader=new c.ReloadableShaderModule(k.OITCompositing,()=>new Promise((m,l)=>b(["./OITCompositing.glsl"],m,l)));a.OITCompositingTechnique=
e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/depthRangeUtils":function(){define("exports ../../../../core/floatRGBA ../../../../core/PooledArray ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/support/frustum ../../../../chunks/sphere ../../support/mathUtils ./depthRange ./Octree ./Util".split(" "),function(b,a,c,d,f,n,k,g,q,e,m,l,w,v){function x(G,
O){if(O.visible){var P=l.empty(),J=O.getSpatialQueryAccelerator();J?p(P,G,J):h(P,G,O.objects);return P}}function p(G,O,P){var J=O.eye;const R=O.viewForward,X=O.frustum,U=V=>V.visible;var M=P.objectCount;500>M?(l.set(D,O.near,Math.min(G.near,O.far)),P.forEachInDepthRange(J,R,w.DepthOrder.FRONT_TO_BACK,D,(V,Y)=>{t(G,O,V);D.far=G.near;Y.setRange(D)},X,U),l.set(D,Math.max(G.far,O.near),O.far),P.forEachInDepthRange(J,R,w.DepthOrder.BACK_TO_FRONT,D,(V,Y)=>{t(G,O,V);D.near=G.far;Y.setRange(D)},X,U)):(M=
Math.max(Math.min(M,500),Math.ceil(.1*M)),J=P.findClosest(R,w.DepthOrder.FRONT_TO_BACK,X,U,M),P=P.findClosest(R,w.DepthOrder.BACK_TO_FRONT,X,U,M),J&&P&&(u(G,O,J.boundingVolumeWorldSpace.bounds),u(G,O,P.boundingVolumeWorldSpace.bounds)))}function h(G,O,P){F.clear();P.forAll(J=>{J.visible&&0!==J.geometries.length&&F.add(J)});F.empty||(F.sort(O),l.set(D,O.near,Math.min(G.near,O.far)),F.forEachInDepthRange(D,w.DepthOrder.FRONT_TO_BACK,(J,R)=>{R<G.near&&t(G,O,J)}),l.set(D,Math.max(G.far,O.near),O.far),
F.forEachInDepthRange(D,w.DepthOrder.BACK_TO_FRONT,(J,R,X)=>{G.far=Math.max(G.far,X)}))}function t(G,O,P){if(P.visible&&q.intersectsSphere(O.frustum,P.boundingVolumeWorldSpace.bounds)){var J=P.transformation,R=B;P.geometries.forEach(X=>{d.multiply(R,J,X.transformation);const U=m.maxScale(R);r(G,O,X.boundingInfo,R,U)})}}function r(G,O,P,J,R){if(null!=P){n.transformMat4(E,P.center,J);var {eye:X,viewForward:U}=O,M=U[0]*(E[0]-X[0])+U[1]*(E[1]-X[1])+U[2]*(E[2]-X[2]);E[3]=P.radius*R;if(!(M-E[3]>G.near&&
M+E[3]<G.far)&&q.intersectsSphere(O.frustum,E))if(100<P.radius&&P.getChildren())for(const V of P.getChildren())r(G,O,V,J,R);else L.unionDepthRangeWithAABB(G,O.viewProjectionMatrix,J,P.bbMin,P.bbMax)}}function u(G,O,P){var J=O.eye;O=O.viewForward;J=(P[0]-J[0])*O[0]+(P[1]-J[1])*O[1]+(P[2]-J[2])*O[2];G.near=Math.min(G.near,J-P[3]);G.far=Math.max(G.far,J+P[3])}class y{constructor(){this._items=new c({allocator:G=>G||{object:null,distance:0,near:0,far:0},deallocator:G=>{G.object=null;G.distance=0;G.near=
0;G.far=0;return G}})}get length(){return this._items.length}get empty(){return 0===this._items.length}clear(){this._items.clear()}add(G){this._items.pushNew().object=G}sort(G){const O=G.eye,P=G.viewForward;this._items.forAll(J=>{const R=J.object.boundingVolumeWorldSpace.bounds,X=(R[0]-O[0])*P[0]+(R[1]-O[1])*P[1]+(R[2]-O[2])*P[2];J.distance=X;J.near=X-R[3];J.far=X+R[3]});this._items.sort((J,R)=>J.distance-R.distance)}forEachInDepthRange(G,O,P){if(O===w.DepthOrder.FRONT_TO_BACK)for(O=0;O<this._items.length;++O){var J=
this._items.data[O];J.far<G.near||J.near>G.far||P(J.object,J.near,J.far)}else for(O=this._items.length-1;0<=O;--O)J=this._items.data[O],J.far<G.near||J.near>G.far||P(J.object,J.near,J.far)}}class z{constructor(){this._view=f.create();this._viewProj=f.create();this._frustum=q.create();this._geometries=[];this._near=[];this._far=[];this._nearCandidates=[];this._farCandidates=[];this._looseRange={near:0,far:0}}compute(G,O){this._reset();d.copy(this._view,G.viewMatrix);d.multiply(this._viewProj,G.projectionMatrix,
this._view);q.copy(this._frustum,G.frustum);G=this._view;const P=G[2],J=G[6],R=G[10],X=G[14];O.forAll(V=>V.forEachGeometry(Y=>{if(Y.visible&&Y.castShadow){var W=Y.boundingSphere,H=P*W[0]+J*W[1]+R*W[2]+X,S=H-W[3];W=H+W[3];this._geometries.push(Y);this._near.push(-W);this._far.push(-S)}}));O=new l.DepthRange;if(0===this._geometries.length)return O;for(G=0;G<this._geometries.length;++G)this._near[G]>O.far&&(O.far=this._near[G]),2<this._near[G]&&this._far[G]<O.near&&(O.near=this._far[G]);G=this._looseRange;
G.near=Math.max(.5*O.near,2);G.far=2*O.far;var U=0;let M=0;for(let V=0;V<this._geometries.length;++V)this._near[V]<O.near&&(this._near[V]>=G.near?O.near=this._near[V]:this._nearCandidates[U++]=V),this._far[V]>O.far&&(this._far[V]<=G.far?O.far=this._far[V]:this._farCandidates[M++]=V);if(0===this._nearCandidates.length&&0===this._farCandidates.length)return O;this._nearCandidates.sort((V,Y)=>this._near[V]<this._near[Y]?-1:this._near[V]>this._near[Y]?1:0);this._farCandidates.sort((V,Y)=>this._far[V]<
this._far[Y]?1:this._far[V]>this._far[Y]?-1:0);for(G=0;G<this._nearCandidates.length;++G)U=this._nearCandidates[G],this._near[U]<O.near&&(U=this._geometries[U],this._includeNearBoundingInfoRec(U.boundingInfo,U.shaderTransformation,O));for(G=0;G<this._farCandidates.length;++G)U=this._farCandidates[G],this._far[U]>O.far&&(U=this._geometries[U],this._includeFarBoundingInfoRec(U.boundingInfo,U.shaderTransformation,O));this._reset();return O}_reset(){this._geometries.length=0;this._near.length=0;this._far.length=
0;this._nearCandidates.length=0;this._farCandidates.length=0}_includeNearBoundingInfoRec(G,O,P){if(null!=G){n.transformMat4(E,G.center,O);var J=m.maxScale(O),R=E[0],X=E[1],U=E[2];J*=G.radius;var M=this._frustum;if(!(M[0][0]*R+M[0][1]*X+M[0][2]*U+M[0][3]>J||M[1][0]*R+M[1][1]*X+M[1][2]*U+M[1][3]>J||M[2][0]*R+M[2][1]*X+M[2][2]*U+M[2][3]>J||M[3][0]*R+M[3][1]*X+M[3][2]*U+M[3][3]>J||(R=this._view[2]*R+this._view[6]*X+this._view[10]*U+this._view[14],X=R+J,2>-(R-J)||-X>=P.near)))if(-X>this._looseRange.near)P.near=
-X;else{if(100<J&&(J=G.getChildren(),void 0!==J)){for(const V of J)this._includeNearBoundingInfoRec(V,O,P);return}L.unionDepthRangeWithAABB(P,this._viewProj,O,G.bbMin,G.bbMax)}}}_includeFarBoundingInfoRec(G,O,P){if(null!=G){var J=G.radius;n.transformMat4(E,G.center,O);var R=m.maxScale(O),X=E[0],U=E[1],M=E[2];J*=R;R=this._frustum;if(!(R[0][0]*X+R[0][1]*U+R[0][2]*M+R[0][3]>J||R[1][0]*X+R[1][1]*U+R[1][2]*M+R[1][3]>J||R[2][0]*X+R[2][1]*U+R[2][2]*M+R[2][3]>J||R[3][0]*X+R[3][1]*U+R[3][2]*M+R[3][3]>J||(X=
this._view[2]*X+this._view[6]*U+this._view[10]*M+this._view[14]-J,-X<=P.far)))if(-X<this._looseRange.far)P.far=-X;else{if(100<J&&(J=G.getChildren(),void 0!==J)){for(const V of J)this._includeFarBoundingInfoRec(V,O,P);return}L.unionDepthRangeWithAABB(P,this._viewProj,O,G.bbMin,G.bbMax)}}}}class A{constructor(){this._modelViewProj=f.create();this._clipPosition=[g.create(),g.create(),g.create(),g.create(),g.create(),g.create(),g.create(),g.create()]}unionDepthRangeWithAABB(G,O,P,J,R){var X=this._modelViewProj;
d.multiply(X,O,P);O=!1;for(P=0;8>P;++P){const U=this._clipPosition[P],M=0===P||3===P||4===P||7===P?J[0]:R[0],V=0===P||1===P||4===P||5===P?J[1]:R[1],Y=4>P?J[2]:R[2];U[0]=X[0]*M+X[4]*V+X[8]*Y+X[12];U[1]=X[1]*M+X[5]*V+X[9]*Y+X[13];U[2]=X[2]*M+X[6]*V+X[10]*Y+X[14];U[3]=X[3]*M+X[7]*V+X[11]*Y+X[15]}for(J=0;12>J;++J){R=this._clipTriangle(this._clipPosition[C[J][0]],this._clipPosition[C[J][1]],this._clipPosition[C[J][2]]);X=!0;for(P=0;P<R.length;++P)if(2<=R[P][3]){X=!1;break}if(!X)for(O=!0,X=0;X<R.length;++X)P=
R[X][3],Number.isFinite(P)&&(G.near=Math.min(P,G.near),G.far=Math.max(P,G.far))}return O}_inside(G,O){if(0===O)return G[0]>=-G[3];if(1===O)return G[1]>=-G[3];if(2===O)return G[0]<=G[3];if(3===O)return G[1]<=G[3];v.assert(!1)}_intersect(G,O,P){let J=0;0===P?J=(-G[3]-G[0])/(O[0]-G[0]+O[3]-G[3]):1===P?J=(-G[3]-G[1])/(O[1]-G[1]+O[3]-G[3]):2===P?J=(G[3]-G[0])/(O[0]-G[0]-O[3]+G[3]):3===P&&(J=(G[3]-G[1])/(O[1]-G[1]-O[3]+G[3]));return k.lerp(g.create(),G,O,J)}_clipTriangle(G,O,P){G=[G,O,P];for(O=0;4>O;++O){P=
G;G=[];for(let J=0;J<P.length;++J){const R=P[J],X=P[(J+1)%P.length];this._inside(X,O)?(this._inside(R,O)||G.push(this._intersect(R,X,O)),G.push(X)):this._inside(R,O)&&G.push(this._intersect(R,X,O))}}return G}}const C=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],E=e.create(),B=f.create(),D=l.empty(),F=new y,K=new z,L=new A;b.DepthRangeFromRenderGeometries=z;b.depthRangeFromLayer=x;b.depthRangeFromScene=function(G,O,P){let J=0;if(!O.some(X=>{J+=X.numGeometries;
return 1E4<=J}))return K.compute(G,O);const R=l.empty();P.forAll(X=>l.union(R,x(G,X)));return R};b.textureToDepth=function(G,O,P){return a.unpackFloatRGBA(O,G)*(P[1]-P[0])+P[0]};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/MagnifierHelper":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/asyncUtils ../../../../core/Evented ../../../../core/mathUtils ../../../../core/reactiveUtils ../../../../core/screenUtils ../../../../core/urlUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../support/requestImageUtils ./DefaultVertexBufferLayouts ./glUtil3D ./Program ./VertexAttribute ../shaders/Magnifier.glsl ../../../magnifier/resources ../../../webgl/enums ../../../webgl/renderState ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A,C,E){b.MagnifierHelper=class extends c{constructor(){super(...arguments);this._resources=this._imageLoadTask=this._imageSources=this._magnifier=null;this._passParameters=new u.MagnifierPassParameters;this.events=new f;this.attributeLocations=new Map([[r.VertexAttribute.POSITION,0]]);this._tmpScreenPoint=g.createScreenPointArray();this._tmpRenderPoint=g.createRenderScreenPointArray()}get updating(){return null==this._imageSources&&null!=this._imageLoadTask&&
!this._imageLoadTask.task.finished}get magnifier(){return this._magnifier}set magnifier(B){B!==this._magnifier&&(this.removeAllHandles(),this._magnifier=B,B=()=>{this._updateResourceLoading();this.events.emit("request-render")},null!=this._magnifier&&this.addHandles(k.watch(()=>this._magnifier?.version,B)),B())}get enabled(){return null!=this._validMagnifier}get _validMagnifier(){return null!=this._magnifier&&this._magnifier.visible&&null!=this._magnifier.position&&0<this._magnifier.size?this._magnifier:
null}get _factor(){return null!=this._magnifier?this._magnifier.factor||1:1}destroy(){this._magnifier=null;null!=this._imageLoadTask&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null);this._disposeResources()}render(B,D){const F=this._validMagnifier;if(null!=F){var K=Math.ceil(D.camera.pixelRatio*F.size);this._updateResources(B,K);if(null!=this._resources){var L=this._passParameters.textures;K=Math.ceil(1/this._factor*K);L.input.resize(K,K);g.screenPointObjectToArray(F.position,this._tmpScreenPoint);
var G=D.camera.screenToRender(this._tmpScreenPoint,this._tmpRenderPoint),O=D.camera.fullHeight,P=.5*K,J=.5*K;G[0]=n.clamp(G[0],P,D.camera.fullWidth-P-1);G[1]=n.clamp(G[1],J,O-J-1);O=Math.floor(G[0]-P);G=Math.floor(G[1]-J);J=this._resources.program;J.bindTexture("textureInput",L.input);B.gl.copyTexImage2D(L.input.descriptor.target,0,L.input.descriptor.pixelFormat,O,G,K,K,0);this._passParameters.magnifier=F;B.useProgram(J);J.bindPass(this._passParameters,D);B.bindVAO(this._resources.vao);B.setPipelineState(this._resources.pipelineState);
B.drawArrays(z.PrimitiveType.TRIANGLE_STRIP,0,4)}}}_updateResourceLoading(){const B=this._validMagnifier;if(null!=B){var D=B.maskUrl,F=B.overlayUrl;null==this._imageLoadTask||this._imageLoadTask.maskUrl===D&&this._imageLoadTask.overlayUrl===F||(this._imageLoadTask.task.abort(),this._imageSources=this._imageLoadTask=null);null==this._imageSources&&null==this._imageLoadTask&&(this._imageLoadTask={maskUrl:D,overlayUrl:F,task:d.createTask(async K=>{const L=null==D||null==F?y.loadMagnifierResources(K):
null,G=null!=D?x.requestImage(D,{signal:K}):L.then(O=>O.mask);K=null!=F?x.requestImage(F,{signal:K}):L.then(O=>O.overlay);this._imageSources={mask:await G,overlay:await K};this._disposeResources();this.events.emit("request-render")})},this._imageLoadTask.task.promise.then(()=>this.notifyChange("updating"),()=>this.notifyChange("updating")))}}_updateResources(B,D){this.enabled?null!=this._resources?this._passParameters.textures.size!==D&&(B=this._createTextureResources(B,D),null==B?this._disposeResources():
(this._disposeTextureResources(this._passParameters.textures),this._passParameters.textures=B)):(D=this._createTextureResources(B,D),null!=D&&(this._resources={program:this._createProgram(B),vao:h.createQuadVAO(B,p.Pos2,this.attributeLocations,0,1),pipelineState:A.makePipelineState({blending:A.simpleBlendingParams(z.BlendFactor.ONE,z.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:A.defaultColorWriteParams})},this._passParameters.textures=D)):this._disposeResources()}_disposeResources(){null!=
this._resources&&(this._disposeTextureResources(this._passParameters.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)}_disposeTextureResources(B){B.mask.dispose();B.overlay.dispose();B.input.dispose()}_createTextureResources(B,D){if(null==this._imageSources)return null;this._imageSources.overlay.width=D;this._imageSources.overlay.height=D;this._imageSources.mask.width=D;this._imageSources.mask.height=D;const F=new E.TextureDescriptor;F.internalFormat=
z.PixelFormat.RGBA;F.wrapMode=z.TextureWrapMode.CLAMP_TO_EDGE;F.flipped=!0;F.preMultiplyAlpha=!q.isSVG(this._imageSources.overlay.src)||!B.driverTest.svgPremultipliesAlpha.result;const K=new C.Texture(B,F,this._imageSources.overlay);F.pixelFormat=F.internalFormat=z.PixelFormat.ALPHA;F.preMultiplyAlpha=!1;const L=new C.Texture(B,F,this._imageSources.mask);F.pixelFormat=F.internalFormat=z.PixelFormat.RGBA;F.flipped=!1;return{input:new C.Texture(B,F),mask:L,overlay:K,size:D}}_createProgram(B){return new t.Program(B,
u.build(),this.attributeLocations)}};a.__decorate([e.property()],b.MagnifierHelper.prototype,"_imageSources",void 0);a.__decorate([e.property()],b.MagnifierHelper.prototype,"_imageLoadTask",void 0);a.__decorate([e.property({readOnly:!0})],b.MagnifierHelper.prototype,"updating",null);b.MagnifierHelper=a.__decorate([v.subclass("esri/views/3d/webgl-engine/lib/MagnifierHelper")],b.MagnifierHelper);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/Magnifier.glsl":function(){define("exports ../../../../core/screenUtils ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../core/shaderModules/BooleanPassUniform ../core/shaderModules/Float4PassUniform ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder ../core/shaderModules/Texture2DPassUniform ../lib/VertexAttribute".split(" "),
function(b,a,c,d,f,n,k,g,q,e){class m{}class l extends k.NoParameters{constructor(){super(...arguments);this.textures=new m}}const w=a.createScreenPointArray(),v=a.createRenderScreenPointArray(),x=d.create();b.MagnifierPassParameters=l;b.TextureResources=m;b.build=function(){const p=new g.ShaderBuilder;p.attributes.add(e.VertexAttribute.POSITION,"vec2");p.vertex.uniforms.add(new n.Float4PassUniform("drawPosition",(h,t)=>{var r=t.camera.pixelRatio;const u=h.magnifier.offset.x*r,y=h.magnifier.offset.y*
r;a.screenPointObjectToArray(h.magnifier.position,w);const z=t.camera.screenToRender(w,v);h=Math.ceil(r*h.magnifier.size);r=t.camera.fullWidth;t=t.camera.fullHeight;return c.set(x,-1+(z[0]+u)/r*2,-1+(z[1]-y)/t*2,h/r*2,h/t*2)}));p.varyings.add("vUV","vec2");p.vertex.code.add(k.glsl`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`);p.fragment.uniforms.add(new q.Texture2DPassUniform("textureInput",h=>h.textures.input));p.fragment.uniforms.add(new q.Texture2DPassUniform("textureMask",h=>h.textures.mask));p.fragment.uniforms.add(new q.Texture2DPassUniform("textureOverlay",h=>h.textures.overlay));p.fragment.uniforms.add(new f.BooleanPassUniform("maskEnabled",h=>h.magnifier.maskEnabled));p.fragment.uniforms.add(new f.BooleanPassUniform("overlayEnabled",h=>h.magnifier.overlayEnabled));p.fragment.code.add(k.glsl`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture(textureMask, vUV).a : 1.0;
vec4 inputColor = texture(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture(textureOverlay, vUV) : vec4(0);
fragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`);return p};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/magnifier/resources":function(){define(["require","exports","../../core/promiseUtils","../../support/requestImageUtils"],function(b,a,c,d){const f=n=>Object.freeze(Object.defineProperty({__proto__:null,default:n},Symbol.toStringTag,{value:"Module"}));a.loadMagnifierResources=async function(n){var k=new Promise((q,e)=>b(["./mask-svg"],m=>q(f(m)),e)),g=new Promise((q,e)=>b(["./overlay-svg"],m=>q(f(m)),e));k=d.requestImage((await k).default,
{signal:n});g=d.requestImage((await g).default,{signal:n});g={mask:await k,overlay:await g};c.throwIfAborted(n);return g};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ObjectAndLayerIdRenderHelper":function(){define(["exports","../../../../core/Logger","../../../../chunks/vec4f64","../../../../geometry/support/buffer/BufferView"],function(b,a,c,d){class f{constructor(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper";
this.colorZero=new d.BufferViewVec4u8(new ArrayBuffer(4));this._uidToRenderColor=new Map;this._colorToUID=new Map;this._layerUidToGraphicsUidToObjectId=new Map;this._layerUidToId=new Map;this._layerUidToPopupEnabled=new Map}setUidToObjectAndLayerId(n,k,g,q,e,m=null,l=null,w=null){n&&k&&g&&q&&(this._layerUidToId.set(q,g),this._layerUidToPopupEnabled.set(q,e),e&&(g=this._layerUidToGraphicsUidToObjectId.get(q),g||(g=new Map,this._layerUidToGraphicsUidToObjectId.set(q,g)),g.set(k,{objectId:n,attributeNodeId:m,
attributeIndex:l,subLayerId:w})))}getObjectAndLayerIdColor(n){n=this.getObjectAndLayerIdColorArray(n);return c.fromValues(n.get(0,1),n.get(0,2),n.get(0,3),255)}getObjectAndLayerIdColorArray(n){if(!n.layerUid||!n.graphicUid)return this.colorZero;var k=this._layerUidToPopupEnabled.get(n.layerUid);if(void 0===k)return a.getLogger(this).warn("popupEnabled is undefined for layerUid "+n.layerUid),this.colorZero;if(!1===k)return this.colorZero;let g=this._uidToRenderColor.get(n.layerUid);g||(g=new Map,this._uidToRenderColor.set(n.layerUid,
g));k=g.get(n.graphicUid);if(!k){for(;!k;){const q=Math.floor(16777214*Math.random())+1;this._colorToUID.has(q)||(k=q)}if(16777215<k)throw Error("Object ID Overflow");g.set(n.graphicUid,k);this._colorToUID.set(k,n)}n=new ArrayBuffer(4);(new DataView(n)).setUint32(0,k,!1);return new d.BufferViewVec4u8(n)}getColorToObjectAndLayerIdMapping(){const n=new Map;for(const [g,q]of this._colorToUID.entries()){var k=this._layerUidToGraphicsUidToObjectId.get(q.layerUid);let e=null;k?(e=k.get(q.graphicUid))||
a.getLogger(this).warn("getColorMapping: no entry found for graphicsId "+q.graphicUid):a.getLogger(this).warn("getColorMapping: no entry found for layerUid "+q.layerUid);(k=this._layerUidToId.get(q.layerUid))||a.getLogger(this).warn("no layerId found for uid "+q.layerUid);e&&k&&n.set(g,e.attributeNodeId?{type:"object-and-layer-and-i3s-id",oid:e.objectId,lid:k,attrId:e.attributeNodeId,attrIdx:e.attributeIndex,subLayerId:e.subLayerId}:{type:"object-and-layer-id",oid:e.objectId,lid:k})}return n}}b.ObjectAndLayerIdRenderHelper=
f;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Renderer":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/colorUtils ../../../../core/has ../../../../core/maybe ../../../../core/PooledArray ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../chunks/boundedPlane ../../support/debugFlags ../../terrain/TerrainRenderer ../core/FBOCache ../core/renderPasses/RenderPassManager ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/hud/HUDRenderStyle ../effects/RenderPluginInput ../effects/RenderPluginManager ../effects/blit/Blit ../effects/highlight/Highlight ../effects/highlight/ShadowHighlight ../effects/smaa/SMAA ../effects/ssao/SSAO ./AnimationTimeStep ./basicInterfaces ./BoundingInfo ./depthRange ./depthRangeUtils ./Material ./OffscreenRendering ./RenderContext ./rendererUtils ./RenderFeature ./RenderSlot ./ShadowAccumulator ./ShadowMap ./SliceHelper ./TransparencyPassType ./edgeRendering/EdgeView ./edgeRendering/interfaces ../materials/renderers/MergedRenderer ../shaders/CompositingTechniqueConfiguration ../statistics/RendererPerformanceInfo ../../../support/RenderState ../../../webgl/enums".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A,C,E,B,D,F,K,L,G,O,P,J,R,X,U,M,V,Y,W,H,S,I,Q,N,T,aa,Z,da,fa,ka){function ha(na){return ra=>na.immediate.schedule(ra)}b.Renderer=class extends c{get _bindParameters(){return this._renderContext.bindParameters}updateRenderFeatures(na=null,ra=!n("disable-feature:high-quality-idle")){this._renderStateFeatures=Y.setupFeatureDefaults(ra,na);this.notifyChange("_renderStateFeatures");this._renderPlugins.renderFeatureChanged();this._requestRender()}isFeatureEnabled(na,
ra=this._state){return this._renderStateFeatures.get(ra,na)??!1}setFeatureEnabled(na,ra,ta){this._renderStateFeatures.set(ra,na,ta);this.notifyChange("_renderStateFeatures");this._requestRender()}get _highQualityTransparency(){return this._highQualityTransparencyEnabled||this.isFeatureEnabled(Y.RenderFeature.HighQualityTransparency)}get hasReflections(){return this.hasWater&&(this._ssrEnabled||this.isFeatureEnabled(Y.RenderFeature.WaterReflection))}get hasDecorations(){return this._materialRenderersHas.decorations||
this._renderPlugins.hasDecorations}get hasHighlights(){return this._materialRenderersHas.highlights||this._renderPlugins.produces(W.RenderSlot.OPAQUE_MATERIAL,z.ShaderOutput.Highlight)||this._renderPlugins.produces(W.RenderSlot.DRAPED_MATERIAL,z.ShaderOutput.Highlight)}get hasShadowHighlights(){return this._materialRenderersHas.highlights||this._renderPlugins.produces(W.RenderSlot.OPAQUE_MATERIAL,z.ShaderOutput.ShadowHighlight)}get _magnifierEnabled(){return this._bindParameters.decorations===O.Decorations.ON&&
this._magnifierHelper.enabled}get fullResolutionAtmosphere(){return this._stage.view.qualitySettings.highResolutionAtmosphere||this.isFeatureEnabled(Y.RenderFeature.HighResolutionAtmosphere)}get hasWater(){return this._materialRenderersHas.water||this._hasOverlayWater}constructor(na,ra,ta,ma,pa,ja,qa,ua){super({});this._stage=na;this._techniqueRepository=ma;this._rctx=pa;this._compositingHelper=ja;this._magnifierHelper=qa;this._requestRender=ua;this._materialRenderers=new g;this._needsTransparentPass=
!1;this._materialRenderersHas={hudElements:!1,highlights:!1,water:!1,decorations:!1,occludees:!1};this._hasOverlayWater=!1;this.renderOverlay=wa=>{};this._isRendering=!1;this._backgroundColor=p.fromValues(0,0,0,1);this._sliceHelper=new I;this._state=fa.RenderState.IDLE;this._highQualityTransparencyEnabled=!0;this._terrainTransparency=r.TransparencyMode.Opaque;this._hasAnimations=this._ssrEnabled=!1;this._animationTimestep=new G.AnimationTimeStep;this._renderHiddenTransparentEdges=()=>{};this._pluginInput=
new C.RenderPluginInput;this._releaseGeometryLinearDepth=wa=>wa?.release();this._geometryLinearDepthFormat=u.DepthFormat.DEPTH16_BUFFER;this.fboCache=new u.FBOCache(pa);this._renderStateFeatures=Y.setupFeatureDefaults(!n("disable-feature:high-quality-idle"),na.view.qualityProfile);this._offscreen=new U.OffscreenRendering(this.fboCache,this._compositingHelper);this.performanceInfo=new da.RendererPerformanceInfo(this._rctx);this._shadowMap=new S.ShadowMap(this.fboCache,na.viewingMode);this._highlight=
new D.Highlight({view:na.view});this._shadowHighlight=new F.ShadowHighlight({view:na.view,viewingMode:na.viewingMode});this._shadowAccumulator=new H.ShadowAccumulator(this.fboCache,ma,na,wa=>{const za=this.shadowsEnabled;this._shadowMap.enabled=!0;this._prepare(wa.camera,wa.contentCamera);this._renderPlugins.prepareRender();this._shadowMap.enabled=za},(wa,za,Aa)=>{wa.shadowMap.start(wa.camera,za,Aa,!0,this._stage.view.qualitySettings.maximumPixelRatio);this._renderShadowCascades(z.ShaderOutput.Shadow,
wa.shadowMap);wa.shadowMap.finish();wa.camera.setGLViewport(this._rctx);this._prepare(wa.camera,wa.contentCamera)},ua);this._ssao=new L.SSAO({view:this._stage.view});this._renderContext=new M.RenderContext(this._rctx,this._offscreen,this._shadowMap,this._sliceHelper);this._renderPlugins=new E.RenderPluginManager({renderContext:this._renderContext,techniqueRepository:ma,textureRepository:ta,materialRepository:ra,requestRender:ua,controller:na,fbos:this.fboCache,isFeatureEnabled:wa=>this.isFeatureEnabled(wa)});
this.renderPassManager=new y.RenderPassManager;this._renderPlugins.add(this.renderPassManager);this._smaa=new K.SMAA({view:this._stage.view});this._renderPlugins.add(this._smaa);this._blit=new B.Blit({opacity:1,alphaMode:Z.AlphaMode.None});this._renderPlugins.add(this._blit);this._renderPlugins.add(this._ssao);this._renderPlugins.add(this._highlight);this._renderPlugins.add(this._shadowHighlight);this.addHandles([q.watch(()=>this._stage.view.state.camera,()=>ua(),q.syncAndInitial),q.watch(()=>t.debugFlags.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,
wa=>{this._renderHiddenTransparentEdges=wa?()=>this._renderEdges(T.Transparency.TRANSPARENT):()=>{};ua()},q.initial),q.watch(()=>this._stage.view.environment.background?.color,wa=>{wa=wa?f.unitRGBAFromColor(wa):p.ZEROS;x.set(this._backgroundColor,wa[0]*wa[3],wa[1]*wa[3],wa[2]*wa[3],wa[3]);ua()},q.syncAndInitial)])}normalizeCtorArgs(){return{}}destroy(){this._smaa.destroy();this._blit.destroy();this._gpuTimerHandle=k.removeMaybe(this._gpuTimerHandle);this._materialRenderers.forAll(na=>na.dispose());
this._materialRenderers.clear();this._offscreen.dispose();this._shadowMap.dispose();this._ssao.destroy();this._highlight.dispose();this._shadowHighlight.destroy();this._shadowAccumulator.dispose();this._edgeView=k.destroyMaybe(this._edgeView);this.renderPassManager.dispose();this._releaseFBOs();this._disposeOffscreenBuffers();this.fboCache.destroy();P.BoundingInfo.prune()}_releaseFBOs(){this._bindParameters.ssr.lastFrameColor=k.releaseMaybe(this._bindParameters.ssr.lastFrameColor);this._bindParameters.multipassTerrain.linearDepth=
k.releaseMaybe(this._bindParameters.multipassTerrain.linearDepth);this._bindParameters.multipassGeometry.linearDepth=k.releaseMaybe(this._bindParameters.multipassGeometry.linearDepth)}_disposeOffscreenBuffers(){this._offscreen.dispose();this._disposeBindBuffers()}_disposeBindBuffers(){this._shadowMap.disposeOffscreenBuffers();this._bindParameters.linearDepth=k.releaseMaybe(this._bindParameters.linearDepth);this._bindParameters.hudVisibility=k.releaseMaybe(this._bindParameters.hudVisibility)}get updating(){return this._smaa.updating||
null!=this._edgeView&&this._edgeView.updating||this._shadowAccumulator.running||this._renderPlugins.updating||!this.isCameraFinal}ensureEdgeView(){null==this._edgeView&&(this._edgeView=new N.EdgeView({rctx:this._rctx,renderSR:this._stage.view.renderSpatialReference,viewingMode:this._stage.viewingMode,techniqueRepository:this._techniqueRepository,setNeedsRender:()=>this._requestRender(),schedule:ha(this._stage.view.resourceController)}),this.addHandles(q.watch(()=>this._edgeView?.updating,()=>this._requestRender(),
q.sync)),this._requestRender());return this._edgeView}get edgeView(){return this._edgeView}get isCameraFinal(){return w.equals(this._bindParameters.ssr.reprojectionMatrix,v.IDENTITY)}set _reprojectionMatrix(na){d.update(this._bindParameters.ssr.reprojectionMatrix,na)&&this.notifyChange("isCameraFinal")}get shadowsEnabled(){return!!this._shadowMap?.enabled}setParameters(na){const {_shadowMap:ra,_bindParameters:ta}=this;void 0!==na.qualitySettings?.reflections&&this._ssrEnabled!==na.qualitySettings.reflections&&
(this._ssrEnabled=na.qualitySettings.reflections,this._requestRender());void 0!==na.shadowMap&&this._shadowMap.enabled!==na.shadowMap&&(this._shadowMap.enabled=na.shadowMap,this._requestRender());void 0!==na.shadowMapMaxCascades&&ra.maxCascades!==na.shadowMapMaxCascades&&(ra.maxCascades=na.shadowMapMaxCascades,this._requestRender());if(null!=na.environment){null!=na.environment.weather&&(this._bindParameters.weather=na.environment.weather,this._bindParameters.weatherVisible=!!na.weatherVisible);const ma=
"virtual"!==na.environment.lighting.type;ta.enableFillLights!==ma&&(ta.enableFillLights=ma,this._requestRender())}void 0!==na.highQualityTransparency&&this._highQualityTransparencyEnabled!==na.highQualityTransparency&&(this._highQualityTransparencyEnabled=na.highQualityTransparency,this._requestRender());void 0!==na.hasOverlayWater&&this._hasOverlayWater!==na.hasOverlayWater&&(this._hasOverlayWater=na.hasOverlayWater,this._requestRender());void 0!==na.slicePlane&&this._sliceHelper.plane!==na.slicePlane&&
(this._sliceHelper.plane=na.slicePlane,this._requestRender());void 0!==na.terrainTransparency&&this._terrainTransparency!==na.terrainTransparency&&(this._terrainTransparency=na.terrainTransparency,this._requestRender());void 0!==na.shadowCastOptions&&this._shadowAccumulator.setOptions(na.shadowCastOptions)}get hasSlicePlane(){return!!this._sliceHelper.plane}get renderPlugins(){return this._renderPlugins}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlend.result}get _oitEnabled(){return this._highQualityTransparency&&
this._hasOITSupport}modify(na,ra){this._isRendering&&console.warn("Renderer.modify called while rendering");const {adds:ta,removes:ma,updates:pa}=na;if(0!==ta.length||0!==ma.length||0!==pa.length){var ja=!1;V.splitRenderGeometryChangeSetByMaterial(na).forEach((qa,ua)=>{if(!ra.done){var wa=this._materialRenderers.find(za=>za.material===ua);null==wa&&0<qa.adds.length&&(wa=new aa.MergedRenderer({material:ua}),wa.initializeRenderContext(this._renderPlugins._context),this._materialRenderers.push(wa));
wa&&(wa.modify(qa),wa.isEmpty&&(ja=!0));qa.removes.forEach(za=>na.removes.removeUnordered(za));qa.adds.forEach(za=>na.adds.removeUnordered(za));qa.updates.forEach(za=>na.updates.removeUnordered(za));ra.madeProgress()}});ja&&this._materialRenderers.filterInPlace(qa=>qa.isEmpty?(qa.dispose(),!1):!0);this._updateHasFlags();this._requestRender()}}_updateHasFlags(){const na=this._materialRenderersHas;na.decorations=!1;na.highlights=!1;na.hudElements=!1;na.water=!1;na.occludees=!1;this._materialRenderers.forAll(ra=>
{na.highlights||(na.highlights=ra.hasHighlights);na.occludees||(na.occludees=ra.hasOccludees);na.water||(na.water=ra.hasWater);na.decorations||(na.decorations=ra.isDecoration);na.hudElements||(na.hudElements=ra.material.produces(W.RenderSlot.LINE_CALLOUTS_HUD_DEPTH,z.ShaderOutput.Color)||ra.material.produces(W.RenderSlot.HUD_MATERIAL,z.ShaderOutput.Color)||ra.material.produces(W.RenderSlot.LABEL_MATERIAL,z.ShaderOutput.Color))});this._bindParameters.hasOccludees=na.occludees}updateAnimation(na){const ra=
this._hasAnimations;this._hasAnimations=!1;this._materialRenderers.forAll(ta=>this._hasAnimations=ta.updateAnimation(na)||this._hasAnimations);this._hasAnimations=this._renderPlugins.updateAnimation(na)||this._hasAnimations;this._hasAnimations!==ra&&(this._gpuTimerHandle=ra?k.removeMaybe(this._gpuTimerHandle):this.performanceInfo.enableGPUPerformanceInfo());return this._hasAnimations}get animationTimestep(){return this._animationTimestep.value}get animationTimeDilation(){return this._animationTimestep.timeDilation}resetAnimation(){this._animationTimestep.clear()}tick(){this.fboCache.clean()}render(na,
ra,ta,ma,pa){const ja=null!=na;this._isRendering=!0;this.performanceInfo.startFrame();this.fboCache.frame();this._disposeBindBuffers();var qa=this._offscreen;const {camera:ua,contentCamera:wa,mode:za,alignPixelEnabled:Aa}=ta;this._state=za;this._bindParameters.overlay=this.renderOverlay(pa);this.performanceInfo.advance(da.PerformanceCategory.OVERLAY);this._renderContext.time=pa;this._bindParameters.transparencyPassType=Q.TransparencyPassType.NONE;this._bindParameters.alignPixelEnabled=Aa;this._bindParameters.decorations=
ma;ta=h.create(this._sliceHelper.plane);ma===O.Decorations.OFF&&(this._sliceHelper.plane=null);ua.setGLViewport(this._rctx);ma=qa.initializeFrame(ua,this._backgroundColor,ja);this.hasReflections?this._bindParameters.ssr.lastFrameColor=ma:ma?.release();this._prepare(ua,wa);this._renderPlugins.prepareRender();this.performanceInfo.advance(da.PerformanceCategory.PREPARE);const Fa=this._computeDepthRange(ua);this._renderShadowMap(ua,this._bindParameters.lighting.mainLight.direction,Fa);this.performanceInfo.advance(da.PerformanceCategory.SHADOW_MAP);
this._ensureBindParameters(ua,wa);const Da=this._renderPlugins.produces(W.RenderSlot.OPAQUE_TERRAIN)&&(this._terrainTransparency===r.TransparencyMode.Semitransparent||this._terrainTransparency===r.TransparencyMode.TransparentWithDraped);ma=this._highQualityTransparency&&Da;const Ha=this._needsTransparentPass||this._renderPlugins.produces(W.RenderSlot.TRANSPARENT_MATERIAL);this._prepareShaders(ma,Ha);this._renderLinearDepth();this.performanceInfo.advance(da.PerformanceCategory.LINEAR_DEPTH);this._renderShadowAccumulation(Fa,
ua,wa);this.performanceInfo.advance(da.PerformanceCategory.ACCUMULATED_SHADOWS);this._ensureBindParametersSSR(pa);this._renderSSAO();this.performanceInfo.advance(da.PerformanceCategory.SSAO);this._renderContext.output=z.ShaderOutput.Color;qa.bindFbo();this._renderOpaqueGeometry();this._renderPlugins.render(W.RenderSlot.ENVIRONMENT_OPAQUE);this.performanceInfo.advance(da.PerformanceCategory.OPAQUE);this._renderTerrainLinearDepth(ma);this._setMultipassTerrain(ma);this._renderEdges(T.Transparency.OPAQUE);
this.performanceInfo.advance(da.PerformanceCategory.OPAQUE_EDGES);qa.bindFbo();this._renderPlugins.render(W.RenderSlot.VOXEL);this.performanceInfo.advance(da.PerformanceCategory.VOXEL);this._renderHiddenTransparentEdges();Ha&&(this._oitEnabled?this._renderOITPass(ba.Geometry):this._renderTransparentMaterial());this.performanceInfo.advance(da.PerformanceCategory.TRANSPARENT);pa=this._renderGeometryLinearDepth(ma);this._renderHUDVisibility(pa);ma||this._renderInternalSlot(W.RenderSlot.LINE_CALLOUTS);
this.performanceInfo.advance(da.PerformanceCategory.HUD_VISIBILITY);this._renderObjectAndLayerIdColor(ra);this.performanceInfo.advance(da.PerformanceCategory.OBJECT_AND_LAYER_ID_COLOR);this._renderEdges(T.Transparency.TRANSPARENT,pa);this._releaseGeometryLinearDepth(pa);this.performanceInfo.advance(da.PerformanceCategory.TRANSPARENT_EDGES);(ra=Da?this._renderTransparentTerrain():null)&&this._bindParameters.hudVisibility&&(ma?this._renderLineCallouts(A.HUDRenderStyle.Occluded):qa.compositeToHUDVisibility(this._bindParameters,
ra.colorTexture),this._renderHUD(A.HUDRenderStyle.Occluded,qa.color),this.performanceInfo.advance(da.PerformanceCategory.HUD_OCCLUDED));this.performanceInfo.advance(da.PerformanceCategory.TRANSPARENT_TERRAIN);this._setTerrainCulling(!1);ra&&(qa.compositeToFramebuffer(this._bindParameters,ra.colorTexture,Z.AlphaMode.PremultipliedAlpha,1),ra.release(),ma&&(this._renderEdges(T.Transparency.OPAQUE),this.performanceInfo.advance(da.PerformanceCategory.OPAQUE_EDGES),Ha&&(this._oitEnabled?this._renderOITPass(ba.Geometry):
this._renderTransparentMaterial()),this.performanceInfo.advance(da.PerformanceCategory.TRANSPARENT),this._renderEdges(T.Transparency.TRANSPARENT),this.performanceInfo.advance(da.PerformanceCategory.TRANSPARENT_EDGES)));this._bindParameters.ssao=k.releaseMaybe(this._bindParameters.ssao);ma&&this._renderLineCallouts(A.HUDRenderStyle.NotOccluded);this._setMultipassEnabled(!1);this._shadowAccumulator.render(this._bindParameters);qa.bindFbo();this._renderInternalSlot(W.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL);
this._renderPlugins.render(W.RenderSlot.ENVIRONMENT_TRANSPARENT);this.performanceInfo.advance(da.PerformanceCategory.ENVIRONMENT);this._renderLaserlines();this.performanceInfo.advance(da.PerformanceCategory.LASER_LINES);this._renderOccluded();this.performanceInfo.advance(da.PerformanceCategory.OCCLUDED);qa=this._magnifierEnabled&&null==na?this.fboCache.acquire(u.ColorFormat.RGBA,this._offscreen.width,this._offscreen.height):null;ra=this._renderComposite(qa??na,this._offscreen.color)??na;this.performanceInfo.advance(da.PerformanceCategory.ANTIALIASING);
this._renderHUD(A.HUDRenderStyle.NotOccluded,ra);this.performanceInfo.advance(da.PerformanceCategory.HUD);this._renderHighlights(ra,this._bindParameters);this.performanceInfo.advance(da.PerformanceCategory.HIGHLIGHTS);this._magnifierEnabled&&this._magnifierHelper.render(this._rctx,this._bindParameters);ra!==na&&(this._rctx.bindFramebuffer(na?.fbo),this._compositingHelper.composite(this._bindParameters,qa?.colorTexture,Z.AlphaMode.None));qa!==na&&qa?.release();if(this.onPostRender)this.onPostRender();
this._releaseFBOs();this._offscreen.releaseBuffers();this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera);this._sliceHelper.plane=ta;this._isRendering=!1;this.performanceInfo.finishFrame();ja&&(this._releaseFBOs(),this._disposeOffscreenBuffers())}_prepareShaders(na,ra){this._renderContext.output=z.ShaderOutput.Color;this._prepareOpaqueGeometrySlots();this._setMultipassTerrain(na);this._renderPlugins.prepare(W.RenderSlot.TRANSPARENT_TERRAIN);this._setMultipassTerrain(!1);na||this._prepareInternalSlots(this._materialRenderers,
W.RenderSlot.LINE_CALLOUTS);ra&&this._prepareTransparencySlots();this._prepareInternalSlots(this._materialRenderers,W.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL);this._renderPlugins.prepare(W.RenderSlot.ENVIRONMENT_TRANSPARENT);this._renderPlugins.prepare(W.RenderSlot.LASERLINES);this._rctx.gl.flush()}_renderObjectAndLayerIdColor(na){if(null!=na&&n("enable-feature:objectAndLayerId-rendering")){var ra=this._renderContext.output;this._rctx.bindFramebuffer(na.fbo);this._offscreen.renderToFBO(()=>
this._renderAllGeometry(z.ShaderOutput.ObjectAndLayerIdColor),[0,0,0,0],!0,!0);this._rctx.bindFramebuffer(na.fbo);this._offscreen.renderToFBO(()=>{this._bindParameters.hudRenderStyle=A.HUDRenderStyle.NotOccluded;this._renderInternalSlot(W.RenderSlot.HUD_MATERIAL)},void 0,!0,!0);this._renderContext.output=ra}}finish(na){this._hasAnimations||this._animationTimestep.clear();var ra=this.performanceInfo.gpuSamplingEnabled;if((na=na===O.RenderRequestType.BACKGROUND)||ra){const ta=na?this.performanceInfo.elapsedTime:
0;ra=ra?this.performanceInfo.totalGPUTimeSampler.last:this._rctx.gl.getError();this._animationTimestep.frame(Math.max(ta,ra),na)}}readDepthPixels(na,ra,ta){var ma=this._bindParameters.linearDepth?.fbo;ma?.colorTexture?ma.readPixels(ra[0],ra[1],ra[2],ra[3],ka.PixelFormat.RGBA,ka.PixelType.UNSIGNED_BYTE,ta):(ma=this.fboCache.acquire(u.ColorFormat.RGBA,this._offscreen.width,this._offscreen.height).acquireDepth(u.DepthFormat.DEPTH16_BUFFER),this._rctx.bindFramebuffer(ma.fbo),this._ensureBindParameters(na,
na),this._bindParameters.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(ka.ClearBufferBit.COLOR_BUFFER_BIT|ka.ClearBufferBit.DEPTH_BUFFER_BIT|ka.ClearBufferBit.STENCIL_BUFFER_BIT),this._renderAllGeometry(z.ShaderOutput.Depth),ma.fbo.readPixels(ra[0],ra[1],ra[2],ra[3],ka.PixelFormat.RGBA,ka.PixelType.UNSIGNED_BYTE,ta),ma.release())}readHUDVisibility(na,ra,ta,ma,pa){this._bindParameters.hudVisibility?.fbo.readPixels(na,ra,ta,ma,ka.PixelFormat.RGBA,ka.PixelType.UNSIGNED_BYTE,
pa)}readAccumulatedShadow(na){return this._shadowAccumulator.readAccumulatedShadow(na[0],na[1])}_setMultipassTerrain(na){this._setMultipassEnabled(na);this._setTerrainCulling(na)}_setMultipassEnabled(na){this._bindParameters.multipassEnabled=na}_setTerrainCulling(na){this._bindParameters.multipassTerrain.cullAboveGround=na}_renderEdges(na,ra){const ta=this._edgeView;if(ta?.shouldRender()){const {width:ma,height:pa,depth:ja}=this._offscreen,qa=this.fboCache.acquire(u.ColorFormat.RGBA,ma,pa);this._offscreen.renderToTargets(()=>
ta.render(this._bindParameters,na),qa,ra??ja,ea);this._offscreen.compositeToFramebuffer(this._bindParameters,qa.colorTexture,Z.AlphaMode.Alpha,1);qa.release()}}_renderShadowMap(na,ra,ta){const ma=this._shadowMap;ma.enabled&&(ma.start(na,ra,ta,this.isFeatureEnabled(Y.RenderFeature.HighResolutionShadows),this._stage.view.qualitySettings.maximumPixelRatio),this._shadowHighlight.updateParameters(na,ra),this._needsShadowHighlight?(this._renderShadowCascades(z.ShaderOutput.ShadowHighlight,this._shadowMap),
ma.moveSnapshot(S.SnapshotSlot.Highlight),ma.clear(),this._renderShadowCascades(z.ShaderOutput.ShadowExcludeHighlight,this._shadowMap),ma.copySnapshot(S.SnapshotSlot.Default),this._renderShadowCascades(z.ShaderOutput.ShadowHighlight,this._shadowMap)):this._renderShadowCascades(z.ShaderOutput.Shadow),ma.finish(),na.setGLViewport(this._rctx))}_renderShadowCascades(na,ra=this._shadowMap){for(const ta of ra.cascades)ta.camera.setGLViewport(this._rctx),this._prepare(ta.camera,ta.camera),this._renderAllGeometry(na)}get _needsLinearDepth(){return this._renderPlugins.consumes(z.ShaderOutput.Depth)||
this.hasReflections||this._needsShadowHighlight||this._needsShadowCast}_renderLinearDepth(){this._needsLinearDepth?(this._bindParameters.linearDepth=this._offscreen.renderToCachedFBO(this._bindParameters.linearDepth,()=>this._renderAllGeometry(z.ShaderOutput.Depth),[0,0,0,0],u.ColorFormat.RGBA,u.DepthFormat.DEPTH_STENCIL_BUFFER),this._bindParameters.linearDepth.releaseDepth(),this._offscreen.bindFbo()):this._bindParameters.linearDepth=k.releaseMaybe(this._bindParameters.linearDepth)}_renderTerrainLinearDepth(na){na?
(na=this._renderContext.output,this._renderContext.output=z.ShaderOutput.Depth,this._bindParameters.multipassTerrain.linearDepth=this._offscreen.renderToCachedFBO(this._bindParameters.multipassTerrain.linearDepth,()=>this._renderTransparentTerrain(),[-1E10,-1E10,-1E10,1]),this._bindParameters.multipassTerrain.linearDepth.releaseDepth(),this._renderContext.output=na):this._bindParameters.multipassTerrain.linearDepth=k.releaseMaybe(this._bindParameters.multipassTerrain.linearDepth)}_renderGeometryLinearDepth(na){if(na)return na=
this._renderContext.output,this._bindParameters.multipassGeometry.linearDepth=this._offscreen.renderToCachedFBO(this._bindParameters.multipassGeometry.linearDepth,()=>this._renderOpaqueGeometryAndTransparentMaterial(z.ShaderOutput.Depth),[1,1,1,1],u.ColorFormat.RGBA,this._geometryLinearDepthFormat),this._renderContext.output=na,this._bindParameters.multipassGeometry.linearDepth.detachDepth();this._bindParameters.multipassGeometry.linearDepth=k.releaseMaybe(this._bindParameters.multipassGeometry.linearDepth)}get _needsDepthRange(){return this._shadowMap.enabled||
this._needsShadowCast}_computeDepthRange(na){if(!this._needsDepthRange)return J.zero;const ra=R.depthRangeFromScene(na,this._materialRenderers,this._stage.layers);J.union(ra,this._renderPlugins.queryDepthRange(na));ra.near=Math.max(na.near,ra.near);ra.far=Math.min(na.far,ra.far);return ra}_renderAllGeometry(na){this._renderContext.output=na;this._renderPlugins.prepare(W.RenderSlot.TRANSPARENT_TERRAIN);this._renderOpaqueGeometryAndTransparentMaterial(na);this._renderTransparentTerrain()}_renderOpaqueGeometryAndTransparentMaterial(na){this._renderContext.output=
na;this._renderPlugins.prepare(W.RenderSlot.TRANSPARENT_MATERIAL);this._renderOpaqueGeometry();this._renderTransparentMaterial()}_renderSSAO(){if(this._renderPlugins.produces(W.RenderSlot.SSAO)){var na=this._offscreen.renderToCachedFBO(null,()=>this._renderAllGeometry(z.ShaderOutput.Normal),[0,0,0,0],u.ColorFormat.RGBA4,u.DepthFormat.DEPTH24_BUFFER);na.releaseDepth();this._offscreen.bindFbo();this._pluginInput.normal=na;this._bindParameters.ssao=this._renderPlugins.render(W.RenderSlot.SSAO,this._pluginInput);
na.release()}}_prepareOpaqueGeometrySlots(){this._renderPlugins.prepare(W.RenderSlot.INTEGRATED_MESH);this._renderPlugins.prepare(W.RenderSlot.OPAQUE_TERRAIN);this._renderPlugins.prepare(W.RenderSlot.OPAQUE_MATERIAL);this._renderPlugins.prepare(W.RenderSlot.ENVIRONMENT_OPAQUE);this._prepareInternalSlots(this._materialRenderers,W.RenderSlot.OPAQUE_MATERIAL)}_renderOpaqueGeometry(){this._renderPlugins.render(W.RenderSlot.INTEGRATED_MESH);this._renderPlugins.render(W.RenderSlot.OPAQUE_TERRAIN);this._renderInternalSlot(W.RenderSlot.OPAQUE_MATERIAL);
this._renderPlugins.render(W.RenderSlot.OPAQUE_MATERIAL)}_renderTransparentMaterial(){this._renderInternalSlot(W.RenderSlot.TRANSPARENT_MATERIAL);this._renderPlugins.render(W.RenderSlot.TRANSPARENT_MATERIAL)}_renderTransparentTerrain(){if(this._renderPlugins.produces(W.RenderSlot.TRANSPARENT_TERRAIN)){var na=()=>this._renderPlugins.render(W.RenderSlot.TRANSPARENT_TERRAIN,null);if(this._renderContext.output!==z.ShaderOutput.Color)na();else{var {width:ra,height:ta,depth:ma}=this._offscreen,pa=this.fboCache.acquire(u.ColorFormat.RGBA,
ra,ta);this._offscreen.renderToTargets(na,pa,ma,[0,0,0,0]);return pa}}}_renderHUDVisibility(na){this._shouldRenderInternalSlot(this._materialRenderers,W.RenderSlot.OCCLUSION_PIXELS)?(this._bindParameters.hudVisibility=this._offscreen.renderHUDVisibility(this._bindParameters.hudVisibility,()=>this._renderInternalSlot(W.RenderSlot.OCCLUSION_PIXELS),na),this._offscreen.bindFbo()):this._bindParameters.hudVisibility=k.releaseMaybe(this._bindParameters.hudVisibility)}_renderLineCallouts(na){this._bindParameters.hudRenderStyle=
na;if(na===A.HUDRenderStyle.Occluded){const {width:ra,height:ta,color:ma}=this._offscreen;na=this.fboCache.acquireDepth(u.DepthFormat.DEPTH16_BUFFER,ra,ta);this._offscreen.renderToTargets(()=>this._renderInternalSlot(W.RenderSlot.LINE_CALLOUTS),ma,na,void 0,!0,!0);na.release()}else this._renderInternalSlot(W.RenderSlot.LINE_CALLOUTS)}_renderLaserlines(){this._renderPlugins.render(W.RenderSlot.LASERLINES);if(this._renderPlugins.produces(W.RenderSlot.LASERLINES_CONTRAST_CONTROL)){const na=this._offscreen,
{width:ra,height:ta,depth:ma}=na,pa=this.fboCache.acquire(u.ColorFormat.RGBA,ra,ta);na.renderToTargets(()=>this._renderPlugins.render(W.RenderSlot.LASERLINES_CONTRAST_CONTROL),pa,ma,ea);na.compositeToFramebuffer(this._bindParameters,pa.colorTexture,Z.AlphaMode.PremultipliedAlpha,1);pa.release()}}_renderHUD(na,ra){if(this._materialRenderersHas.hudElements)if(this._oitEnabled){const ta=this._renderOITPass(ba.HUD,na);this._rctx.bindFramebuffer(ra?.fbo);this._compositingHelper.composite(this._bindParameters,
ta.colorTexture,Z.AlphaMode.PremultipliedAlpha);ta.release()}else if(na===A.HUDRenderStyle.Occluded){const {width:ta,height:ma,color:pa}=this._offscreen;ra=this.fboCache.acquireDepth(u.DepthFormat.DEPTH16_BUFFER,ta,ma);this._offscreen.renderToTargets(()=>this._renderHUDElements(na),pa,ra,void 0,!0,!0);ra.release()}else this._rctx.bindFramebuffer(null),ra?.acquireDepth(u.DepthFormat.DEPTH16_BUFFER),this._rctx.bindFramebuffer(ra?.fbo),this._renderHUDElements(na),ra?.releaseDepth()}_renderHUDElements(na){this._bindParameters.hudRenderStyle=
na;this._prepareInternalSlots(this._materialRenderers,W.RenderSlot.LINE_CALLOUTS_HUD_DEPTH,W.RenderSlot.HUD_MATERIAL,W.RenderSlot.LABEL_MATERIAL);this._renderInternalSlot(W.RenderSlot.LINE_CALLOUTS_HUD_DEPTH);this._renderInternalSlot(W.RenderSlot.HUD_MATERIAL);this._renderInternalSlot(W.RenderSlot.LABEL_MATERIAL)}get _needsShadowHighlight(){return this._shadowMap.enabled&&this._renderPlugins.produces(W.RenderSlot.SHADOW_HIGHLIGHT)&&this.hasShadowHighlights}_renderHighlights(na,ra){this.hasHighlights&&
ra.decorations!==O.Decorations.OFF&&(ra=this._offscreen.renderToCachedFBO(null,()=>{this._renderAllGeometry(z.ShaderOutput.Highlight);this._rctx.clearSafe(ka.ClearBufferBit.DEPTH_BUFFER_BIT);this._renderHUDElements(A.HUDRenderStyle.Both)},[0,0,0,0],u.ColorFormat.RGBA4,u.DepthFormat.DEPTH_STENCIL_BUFFER),ra.releaseDepth(),this._needsShadowHighlight&&(this._pluginInput.highlight=ra,this._renderPlugins.render(W.RenderSlot.SHADOW_HIGHLIGHT,this._pluginInput,na)),this._renderPlugins.produces(W.RenderSlot.HIGHLIGHT)&&
(this._pluginInput.composite=null,this._pluginInput.normal=null,this._pluginInput.highlight=ra,this._renderPlugins.render(W.RenderSlot.HIGHLIGHT,this._pluginInput,na)),ra.release())}get _needsShadowCast(){return this._shadowAccumulator.isAccumulating}_renderShadowAccumulation(na,ra,ta){this._needsShadowCast&&this._bindParameters.linearDepth?.colorTexture&&this._shadowAccumulator.renderAccumulation(this._bindParameters.linearDepth,na,ra,ta)}_prepareTransparencySlots(){this._renderContext.output=z.ShaderOutput.Alpha;
this._bindParameters.transparencyPassType=Q.TransparencyPassType.Alpha;this._prepareInternalSlots(this._materialRenderers,W.RenderSlot.TRANSPARENT_MATERIAL);this._renderPlugins.prepare(W.RenderSlot.TRANSPARENT_MATERIAL);this._renderContext.output=z.ShaderOutput.Color;this._bindParameters.transparencyPassType=Q.TransparencyPassType.Color;this._prepareInternalSlots(this._materialRenderers,W.RenderSlot.TRANSPARENT_MATERIAL);this._renderPlugins.prepare(W.RenderSlot.TRANSPARENT_MATERIAL);this._bindParameters.transparencyPassType=
Q.TransparencyPassType.FrontFace;this._prepareInternalSlots(this._materialRenderers,W.RenderSlot.TRANSPARENT_MATERIAL);this._renderPlugins.prepare(W.RenderSlot.TRANSPARENT_MATERIAL);this._bindParameters.transparencyPassType=Q.TransparencyPassType.NONE}_renderOITPass(na,ra=A.HUDRenderStyle.Both){var ta=na===ba.HUD;na=ta?this.fboCache.acquire(u.ColorFormat.RGBA,this._offscreen.width,this._offscreen.height):null;const ma=ta?()=>this._renderHUDElements(ra):()=>this._renderTransparentMaterial(),pa=this._renderContext.output;
this._renderContext.output=z.ShaderOutput.Alpha;this._bindParameters.transparencyPassType=Q.TransparencyPassType.Alpha;const ja=this._offscreen.renderOITPass(ma,Q.TransparencyPassType.Alpha,ta);this._renderContext.output=z.ShaderOutput.Color;this._bindParameters.transparencyPassType=Q.TransparencyPassType.Color;const qa=this._offscreen.renderOITPass(ma,Q.TransparencyPassType.Color,ta);this._bindParameters.transparencyPassType=Q.TransparencyPassType.FrontFace;ta=this._offscreen.renderOITPass(ma,Q.TransparencyPassType.FrontFace,
ta);this._offscreen.compositeTransparentOntoOpaque(this._bindParameters,qa,ja,ta,na);na?.releaseDepth();ta.release();qa.release();ja.release();this._bindParameters.transparencyPassType=Q.TransparencyPassType.NONE;this._renderContext.output=pa;return na}_renderOccluded(){let na=0;ca.clear();this._materialRenderers.forAll(ja=>{ja.material&&ja.material.isVisible()&&ja.material.parameters.renderOccluded===X.RenderOccludedFlag.OccludeAndTransparentStencil&&(na|=ja.material.parameters.renderOccluded,ca.push(ja))});
const ra=this._offscreen,ta=(ja,qa,ua,wa,za)=>{if(0!==(na&qa)){var {width:Aa,height:Fa,depth:Da}=ra;qa=this.fboCache.acquire(u.ColorFormat.RGBA,Aa,Fa);ra.renderToTargets(ua,qa,Da,[0,0,0,0],wa,za);ra.compositeToFramebuffer(this._bindParameters,qa.colorTexture,Z.AlphaMode.PremultipliedAlpha,ja);qa.release()}};0!==ca.length&&(this._prepareInternalSlots(ca,W.RenderSlot.OCCLUDER_MATERIAL,W.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL),this._renderInternalSlot(W.RenderSlot.OCCLUDER_MATERIAL,ca),ta(.5,X.RenderOccludedFlag.OccludeAndTransparentStencil,
()=>this._renderInternalSlot(W.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL,ca),!1,!1));ca.clear();this._materialRenderers.forAll(ja=>{ja.material&&ja.material.isVisible()&&(ja.material.parameters.renderOccluded===X.RenderOccludedFlag.OccludeAndTransparent||ja.material.parameters.renderOccluded===X.RenderOccludedFlag.Transparent||ja.material.parameters.renderOccluded===X.RenderOccludedFlag.Opaque)&&(na|=ja.material.parameters.renderOccluded,ca.push(ja))});const ma=this._renderPlugins.renderOccludedFlags;
if(na|=ma){var pa=ja=>{this._renderContext.renderOccludedMask=ja;this._prepareInternalSlots(ca,W.RenderSlot.OPAQUE_MATERIAL,W.RenderSlot.TRANSPARENT_MATERIAL,W.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL);ma>X.RenderOccludedFlag.Occlude&&this._renderPlugins.render(W.RenderSlot.OCCLUDED_TERRAIN);this._renderInternalSlot(W.RenderSlot.OPAQUE_MATERIAL,ca);this._renderInternalSlot(W.RenderSlot.TRANSPARENT_MATERIAL,ca);this._renderInternalSlot(W.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,
ca);this._renderContext.resetRenderOccludedMask()};this._renderContext.output=z.ShaderOutput.Color;ta(.5,X.RenderOccludedFlag.OccludeAndTransparent,()=>pa(X.RenderOccludedFlag.OccludeAndTransparent),!0,O.StencilBits.OutlineVisualElementMask);ta(.5,X.RenderOccludedFlag.Transparent,()=>pa(X.RenderOccludedFlag.Transparent),!0,O.StencilBits.OutlineVisualElementMask);ta(1,X.RenderOccludedFlag.Opaque,()=>pa(X.RenderOccludedFlag.Opaque),!0,O.StencilBits.OutlineVisualElementMask);ca.clear()}}_renderComposite(na,
ra){this._renderPlugins.consumes(z.ShaderOutput.CompositeColor)&&(this._pluginInput.composite=ra);ra=null;const ta=this._renderPlugins.produces(W.RenderSlot.COMPOSITE);ta&&(ra=this._renderPlugins.renderComposition(W.RenderSlot.COMPOSITE,this._pluginInput),this._pluginInput.composite=ra);const ma=this._renderPlugins.produces(W.RenderSlot.ANTIALIASING);na=this._renderPlugins.render(ma?W.RenderSlot.ANTIALIASING:W.RenderSlot.BLIT,this._pluginInput,na);ta&&ra?.release();return na}_prepare(na,ra){this._needsTransparentPass=
this._materialRenderers.some(ta=>ta.material.produces(W.RenderSlot.TRANSPARENT_MATERIAL,z.ShaderOutput.Color));this._bindParameters.camera=na;this._bindParameters.contentCamera=ra}_ensureBindParameters(na,ra){this._bindParameters.camera=na;this._bindParameters.contentCamera=ra;na=this._renderContext.offscreenRenderingHelper;this._bindParameters.mainColor=na.colorTexture;this._bindParameters.mainDepth=na.depthTexture}_ensureBindParametersSSR(na){if(this._bindParameters.ssr.lastFrameColor){null==this._ssrEnableTime&&
(this._ssrEnableTime=na);this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=v.IDENTITY:(w.invert(la,this._bindParameters.camera.viewMatrix),w.invert(ia,this._bindParameters.camera.projectionMatrix),w.multiply(oa,la,ia),w.multiply(oa,this._renderContext.lastFrameCamera.viewMatrix,oa),w.multiply(oa,this._renderContext.lastFrameCamera.projectionMatrix,oa),this._reprojectionMatrix=oa);const ra=this._stage.view.qualitySettings.fadeDuration;this._bindParameters.ssr.fadeFactor=
0<ra?Math.min(ra,na-this._ssrEnableTime)/ra:1;1>this._bindParameters.ssr.fadeFactor&&this._requestRender()}else this._reprojectionMatrix=v.IDENTITY,this._ssrEnableTime=null}_shouldRenderInternalSlot(na,ra){this._bindParameters.slot=ra;return na.some(ta=>null!=ta.prepareTechnique(this._renderContext))}_prepareInternalSlots(na,...ra){for(const ta of ra)this._bindParameters.slot=ta,na.forAll(ma=>null!=ma.prepareTechnique(this._renderContext))}_renderInternalSlot(na,ra=this._materialRenderers){this._bindParameters.slot=
na;ra.forAll(ta=>{const ma=ta.prepareTechnique(this._renderContext);ma&&ta.renderNode(this._renderContext,ma)})}get memoryInfo(){return{fbos:this.fboCache.usedMemory,vaos:this._materialRenderers.reduce((na,ra)=>na+ra.usedMemory,0),plugins:this._renderPlugins.usedMemory}}getMemoryForMaterial(na){return null==na?0:this._materialRenderers.find(ra=>ra.material===na)?.usedMemory??0}get usedMemory(){return this.fboCache.usedMemory+(this.edgeView?.usedMemory??0)+this._renderPlugins.usedMemory}get test(){const na=
this;return{offscreen:this._offscreen,shadowMap:this._shadowMap,highlight:this._highlight,lighting:this._bindParameters.lighting,materialRenderers:this._materialRenderers,shadowAccumulator:this._shadowAccumulator,weatherIsFading:this._bindParameters.cloudsFade.isFading,resetRenderStateFeatures:()=>{na._renderStateFeatures=Y.setupFeatureDefaults();this._renderPlugins.renderFeatureChanged();this._requestRender()},releaseGeometryLinearDepth(ra){na._releaseGeometryLinearDepth=ra??(ta=>ta?.release());
na._geometryLinearDepthFormat=ra?u.DepthFormat.DEPTH_STENCIL_TEXTURE:u.DepthFormat.DEPTH16_BUFFER},getFramebufferTexture:ra=>{switch(ra){case b.FramebufferId.Color:return na._offscreen.colorTexture;case b.FramebufferId.LinearDepth:return na._bindParameters.linearDepth?.colorTexture;case b.FramebufferId.ShadowMap:return na._shadowMap.depthTexture;case b.FramebufferId.HudVisibility:return na._bindParameters.hudVisibility?.colorTexture}}}}};a.__decorate([e.property()],b.Renderer.prototype,"_renderPlugins",
void 0);a.__decorate([e.property()],b.Renderer.prototype,"_shadowAccumulator",void 0);a.__decorate([e.property()],b.Renderer.prototype,"_state",void 0);a.__decorate([e.property()],b.Renderer.prototype,"_renderStateFeatures",void 0);a.__decorate([e.property({readOnly:!0})],b.Renderer.prototype,"fullResolutionAtmosphere",null);a.__decorate([e.property()],b.Renderer.prototype,"_smaa",void 0);a.__decorate([e.property()],b.Renderer.prototype,"_blit",void 0);a.__decorate([e.property({autoDestroy:!0})],
b.Renderer.prototype,"_edgeView",void 0);a.__decorate([e.property()],b.Renderer.prototype,"updating",null);a.__decorate([e.property()],b.Renderer.prototype,"isCameraFinal",null);b.Renderer=a.__decorate([l.subclass("esri.views.3d.webgl-engine.lib.Renderer")],b.Renderer);var ba;(function(na){na[na.Geometry=0]="Geometry";na[na.HUD=1]="HUD"})(ba||(ba={}));b.FramebufferId=void 0;(function(na){na[na.Color=0]="Color";na[na.LinearDepth=1]="LinearDepth";na[na.ShadowMap=2]="ShadowMap";na[na.HudVisibility=3]=
"HudVisibility"})(b.FramebufferId||(b.FramebufferId={}));const ea=[0,0,0,0],ca=new g,ia=v.create(),la=v.create(),oa=v.create();Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/renderPasses/RenderPassManager":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/mat3 ../../../../../chunks/mat3f64 ../../../../../chunks/mat4 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ./AllRenderPasses ./RenderPass ../shaderLibrary/ShaderOutput ../util/TwoVectorPosition ../../effects/RenderPlugin ../../lib/depthRange ../../lib/RenderSlot".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u){b.RenderPassManager=class extends t.SyncPreparesRenderPlugin{constructor(){super({});this._passes=null;this.produces=new Map([[u.RenderSlot.OPAQUE_MATERIAL,C=>this._produces(C)],[u.RenderSlot.TRANSPARENT_MATERIAL,C=>this._passes&&0<this._passes.materialTransparent.count?this._produces(C):!1],[u.RenderSlot.INTEGRATED_MESH,C=>this._produces(C)]]);this._materialPassParameters=new v.MaterialPassParameters;this._shadowPassParameters=new v.ShadowMapPassParameters;
this._highlightPassParameters=new v.HighlightPassParameters;this._systems=new Set}initializeRenderContext(C){this._context=C;const E=C.renderContext.rctx;C=C.techniqueRepository;this._passes={materialOpaque:new x.RenderPass(E,C),materialTransparent:new x.RenderPass(E,C,x.RenderPassSorting.BackToFront),materialIntegratedMesh:new x.RenderPass(E,C),shadowMap:new x.RenderPass(E,C),highlight:new x.RenderPass(E,C),highlightIntegratedMesh:new x.RenderPass(E,C),highlightShadowMap:new x.RenderPass(E,C),defaultShadowMap:new x.RenderPass(E,
C)}}get rctx(){return this._context.renderContext.rctx}uninitializeRenderContext(){}dispose(){this._context=null;this._systems.clear()}register(C){this._systems.add(C)}_produces(C){return 0===this._systems.size||null===this._passes?!1:C===p.ShaderOutput.Highlight?0<this._passes.highlight.count||0<this._passes.highlightIntegratedMesh.count:C===p.ShaderOutput.ShadowHighlight?0<this._passes.highlight.count:!0}prepareRender(C){if(0!==this._systems.size&&null!==this._passes){for(const E of Object.values(this._passes))E.prepareSubmit();
this._systems.forEach(E=>E.submit(this._passes,C.bindParameters));for(const E of Object.values(this._passes))E.finishSubmit();this._context.techniqueRepository.frameUpdate()}}prepareTechniques(C){if(0===this._systems.size)return null;const E=C.bindParameters;this._updateParameters(E.camera,C.output===p.ShaderOutput.Shadow||C.output===p.ShaderOutput.ShadowHighlight||C.output===p.ShaderOutput.ShadowExcludeHighlight?this._shadowPassParameters:C.output===p.ShaderOutput.Highlight?this._highlightPassParameters:
this._materialPassParameters,E.slot===u.RenderSlot.TRANSPARENT_MATERIAL);this._materialPassParameters.output=C.output;return this._invoke(C,(B,D)=>B.prepare(D,C.bindParameters))}renderNode(C,E){this._invoke(C,(B,D)=>B.dispatch(D,C.bindParameters,E))}_invoke(C,E){if(null===this._passes)return null;switch(C.bindParameters.slot){case u.RenderSlot.OPAQUE_MATERIAL:switch(C.output){case p.ShaderOutput.Color:case p.ShaderOutput.Depth:case p.ShaderOutput.Normal:case p.ShaderOutput.ObjectAndLayerIdColor:return E(this._passes.materialOpaque,
this._materialPassParameters);case p.ShaderOutput.Highlight:return E(this._passes.highlight,this._highlightPassParameters);case p.ShaderOutput.Shadow:return E(this._passes.shadowMap,this._shadowPassParameters);case p.ShaderOutput.ShadowHighlight:return E(this._passes.highlightShadowMap,this._shadowPassParameters);case p.ShaderOutput.ShadowExcludeHighlight:return E(this._passes.defaultShadowMap,this._shadowPassParameters)}break;case u.RenderSlot.TRANSPARENT_MATERIAL:switch(C.output){case p.ShaderOutput.Color:case p.ShaderOutput.Alpha:case p.ShaderOutput.Depth:case p.ShaderOutput.Normal:case p.ShaderOutput.ObjectAndLayerIdColor:return E(this._passes.materialTransparent,
this._materialPassParameters)}break;case u.RenderSlot.INTEGRATED_MESH:switch(C.output){case p.ShaderOutput.Color:case p.ShaderOutput.Depth:case p.ShaderOutput.Normal:case p.ShaderOutput.ObjectAndLayerIdColor:return E(this._passes.materialIntegratedMesh,this._materialPassParameters);case p.ShaderOutput.Highlight:return E(this._passes.highlightIntegratedMesh,this._highlightPassParameters)}}return null}notifyDirty(){this._context.requestRender()}queryDepthRange(C){const E=new r.DepthRange;this._systems.forEach(B=>
r.union(E,B.queryShadowCasterDepthRange(C)));return E}_updateParameters(C,E,B){const D=C.viewInverseTransposeMatrix;l.set(y,D[3],D[7],D[11]);A.set(y);l.copy(E.transformWorldFromViewTH,A.high);l.copy(E.transformWorldFromViewTL,A.low);l.copy(E.slicePlaneLocalOrigin,y);q.fromMat4(E.transformViewFromCameraRelativeRS,C.viewMatrix);m.copy(E.transformProjFromView,C.projectionMatrix);E.identifier===v.RenderPassIdentifier.Material&&(this._materialPassParameters.transparent=B,q.transpose(z,E.transformViewFromCameraRelativeRS),
q.invert(E.transformNormalViewFromGlobal,z))}};b.RenderPassManager=a.__decorate([g.subclass("esri.views.3d.webgl-engine.core.renderPasses.RenderPassManager")],b.RenderPassManager);const y=w.create(),z=e.create(),A=new h.TwoVectorPosition;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/renderPasses/RenderPass":function(){define(["exports","../../../../../core/PooledArray","../../lib/TransparencyPassType","../../../../webgl/enums"],function(b,a,c,d){b.RenderPassSorting=
void 0;(function(k){k[k.FrontToBack=0]="FrontToBack";k[k.BackToFront=1]="BackToFront"})(b.RenderPassSorting||(b.RenderPassSorting={}));class f{constructor(k,g,q=b.RenderPassSorting.FrontToBack){this._rctx=k;this._techniqueRepository=g;this._sorting=q;this._draws=new a({initialSize:32,allocator:e=>e||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}});this._previouslyBoundDraw=new Map}submitDraw(k,g,q,e){const m=this._draws.pushNew();m.geometry=g;
m.geometryRanges=q;m.material=k;m.depthSquaredHint=e;m.indexType=(g.indexed?g.vao.indexBuffer.indexType:null)??0}prepare(k,g){return this._draws.map(q=>q.material.prepareTechnique(this._techniqueRepository,k,g,q.geometry.parameters))}dispatch(k,g,q){const e=this._rctx;this._previouslyBoundDraw.clear();let m=null;const l=this._draws.length;for(let x=0;x<l;x++){var w=q[x];if(w!==m||w.configuration.transparencyPassType!==c.TransparencyPassType.NONE)e.bindTechnique(w,k,g),m=w;var v=this._draws.data[x];
const p=v.geometry;e.bindVAO(p.vao);this._previouslyBoundDraw.get(w)!==v.material&&(w.program.bindDraw(v.material,g,k),this._previouslyBoundDraw.set(w,v.material));w=v.geometryRanges;const h=w.length;if(0!==v.indexType){const t=n.get(v.indexType);for(let r=0;r<h;r+=2)e.drawElements(p.primitiveType,w[r+1],v.indexType,w[r]*t)}else for(v=0;v<h;v+=2)e.drawArrays(p.primitiveType,w[v],w[v+1])}}prepareSubmit(){this._draws.clear()}finishSubmit(){const k=this._sorting===b.RenderPassSorting.FrontToBack?1:-1;
this._draws.sort((g,q)=>{const e=k*(g.depthSquaredHint-q.depthSquaredHint);return 0!==e?e:g.geometry.vao.byteSize-q.geometry.vao.byteSize})}get count(){return this._draws.length}}const n=new Map;n.set(d.DataType.UNSIGNED_BYTE,1);n.set(d.DataType.UNSIGNED_SHORT,2);n.set(d.DataType.UNSIGNED_INT,4);b.RenderPass=f;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/RenderPluginInput":function(){define(["exports"],function(b){class a{constructor(c=null,d=
null,f=null){this.composite=c;this.normal=d;this.highlight=f}}b.RenderPluginInput=a;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/RenderPluginManager":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/PooledArray ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../core/shaderLibrary/ShaderOutput ../lib/basicInterfaces ../lib/depthRange ../lib/Material ../lib/RenderSlot".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x){b.RenderPluginManager=class extends c{constructor(p){super({});this._context=p;this._renderPlugins=new d;this._slots=[];for(p=0;p<x.RenderSlot.MAX_SLOTS;++p)this._slots[p]=[]}normalizeCtorArgs(){return{}}add(p,h){const t=()=>{if(h?.aborted)throw p.uninitializeRenderContext(),f.createAbortError();this._renderPlugins.push(p);p.produces.forEach((u,y)=>{this._slots[y].push(p)});this._context.requestRender();this.notifyChange("updating")},r=p.initializeRenderContext(this._context,
h);if(f.isPromiseLike(r))return r.then(t);t()}remove(p){if(null!=this._renderPlugins.removeUnordered(p)){for(let h=0;h<this._slots.length;++h)this._slots[h]=this._slots[h].filter(t=>t!==p);p.uninitializeRenderContext();this._context.requestRender();this.notifyChange("updating")}}prepareRender(){this._renderPlugins.forAll(p=>{p.prepareRender&&p.prepareRender(this._context.renderContext)})}updateAnimation(p){let h=!1;this._renderPlugins.forAll(t=>{t.updateAnimation&&(h=t.updateAnimation(p)||h)});return h}renderFeatureChanged(){this._renderPlugins.forAll(p=>
{p.renderFeatureChanged&&p.renderFeatureChanged()})}prepare(p){this._context.renderContext.bindParameters.slot=p;this._slots[p].forEach(h=>{const t=h.produces.get(p);t&&t(m.ShaderOutput.Color)&&("prepareTechnique"in h&&h.prepareTechnique(this._context.renderContext),"prepareTechniques"in h&&h.prepareTechniques(this._context.renderContext))})}_getRenderables(p){this._context.renderContext.bindParameters.slot=p;const h=new Map;this._slots[p].forEach(t=>{var r=t.produces.get(p);!r||!r(m.ShaderOutput.Color)||
t.isDecoration&&this._context.renderContext.bindParameters.decorations===l.Decorations.OFF||("prepareTechnique"in t?(r=t.prepareTechnique(this._context.renderContext),null!=r&&h.set(t,r)):"prepareTechniques"in t?(r=t.prepareTechniques(this._context.renderContext),null!=r&&h.set(t,r)):h.set(t,null))});return h}render(p,h=null,t=null){this._getRenderables(p).forEach((r,u)=>t=u.renderNode(this._context.renderContext,r,h,t));return t}renderComposition(p,h){let t=null;this._getRenderables(p).forEach((r,
u)=>{r=u.renderNode(this._context.renderContext,r,h,null);t?.release();t=r;h.composite=t});return t}queryDepthRange(p){const h=new w.DepthRange;this._renderPlugins.forAll(t=>{t=t.queryDepthRange?.(p);w.union(h,t)});return h}get updating(){return this._renderPlugins.some(p=>p.running)}produces(p,h=m.ShaderOutput.Color){return this._slots[p].some(t=>(t=t.produces.get(p))?t(h):!1)}consumes(p){return this._renderPlugins.some(h=>h.consumes().required.includes(p))}get hasDecorations(){return this._renderPlugins.some(p=>
p.isDecoration)}get renderOccludedFlags(){return this._renderPlugins.reduce((p,h)=>p|h.renderOccludedFlags,v.RenderOccludedFlag.None)}get usedMemory(){return this._renderPlugins.reduce((p,h)=>p+(h.usedMemory??0),0)}};a.__decorate([n.property({readOnly:!0})],b.RenderPluginManager.prototype,"updating",null);b.RenderPluginManager=a.__decorate([e.subclass("esri.views.3d.webgl-engine.lib.RenderPluginManager")],b.RenderPluginManager);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/blit/Blit":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../RenderPlugin ../../lib/RenderSlot ../../../../../chunks/Compositing.glsl ../../shaders/CompositingTechnique ../../shaders/CompositingTechniqueConfiguration".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l){b.Blit=class extends g.SyncRenderPlugin{constructor(w){super(w);this._context=null;this.opacity=1;this.alphaMode=l.AlphaMode.None;this._blitConfiguration=new l.CompositingTechniqueConfiguration;this._blitParameters=new e.CompositingPassParameters;this.produces=new Map([[q.RenderSlot.BLIT,()=>null!=this._context]])}consumes(){return g.ConsumesCompositeColor}initializeRenderContext(w){this._context=w}uninitializeRenderContext(){this._context=null}destroy(){}renderNode(w,
v,x,p){v=x?.composite?.colorTexture;if(!this._context||!v)return p;x=this._context.techniqueRepository.acquire(m.CompositingTechnique,this._blitConfiguration);if(!x?.compiled)return this._context.requestRender(),p;w.rctx.bindFramebuffer(p?.fbo);this._blitParameters.texture=v;this._blitParameters.opacity=this.opacity;w.rctx.bindTechnique(x,this._blitParameters,w.bindParameters);w.rctx.screen.draw();x.release();return p}};a.__decorate([c.property()],b.Blit.prototype,"_context",void 0);a.__decorate([c.property()],
b.Blit.prototype,"opacity",void 0);a.__decorate([c.property()],b.Blit.prototype,"alphaMode",void 0);b.Blit=a.__decorate([k.subclass("esri.views.3d.webgl-engine.effects.blit.Blit")],b.Blit);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/highlight/Highlight":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/colorUtils ../../../../../core/has ../../../../../core/maybe ../../../../../core/reactiveUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec2 ../../core/FBOCache ../RenderPlugin ./HighlightApplyTechnique ./HighlightBlurTechnique ./HighlightDefaults ./HighlightDownsampleTechnique ./HighlightPassParameters ../../lib/DefaultVertexAttributeLocations ../../lib/DefaultVertexBufferLayouts ../../lib/RenderSlot ../../lib/VertexArrayObject ../../../../../chunks/HighlightBlur.glsl ../../../../../chunks/HighlightDownsample.glsl ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/Util".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A,C,E,B,D){b.Highlight=class extends w.SyncRenderPlugin{constructor(F){super(F);this._context=null;this._passParameters=new t.HighlightPassParameters;this._downsampleDrawParameters=new C.HighlightDownsampleDrawParameters;this._blurDrawParameters=new A.HighlightBlurDrawParameters;this._blurColorFormat=d("mac")?l.ColorFormat.RGBA:l.ColorFormat.RGBA4;this._grid={coverage:null,vao:null,verticalCellCount:0,horizontalCellCount:0,viewportWidth:0,viewportHeight:0};
this.produces=new Map([[y.RenderSlot.HIGHLIGHT,()=>!0]])}consumes(){return w.ConsumesHighlight}initializeRenderContext(F){this._context=F;null==this._blurTechnique&&(this._blurTechnique=this._context.techniqueRepository.acquire(x.HighlightBlurTechnique));null==this._downsampleTechnique&&(this._downsampleTechnique=this._context.techniqueRepository.acquire(h.HighlightDownsampleTechnique));null==this._applyTechnique&&(this._applyTechnique=this._context.techniqueRepository.acquire(v.HighlightApplyTechnique));
this.addHandles([n.watch(()=>this.view.highlightOptions.color,K=>{this._passParameters.color=c.unitRGBAFromColor(K??p.defaultColor);this.view.highlightOptions.haloColor||(this._passParameters.haloColor=this._passParameters.color);this._context.requestRender()},n.syncAndInitial),n.watch(()=>this.view.highlightOptions.haloColor,K=>{this._passParameters.haloColor=null!=K?c.unitRGBAFromColor(K):this._passParameters.color;this._context.requestRender()},n.syncAndInitial),n.watch(()=>this.view.highlightOptions.haloOpacity,
K=>{this._passParameters.haloOpacity=K??p.defaultHaloOpacity;this._passParameters.haloOpacityOccluded=.25*this._passParameters.haloOpacity;this._context.requestRender()},n.syncAndInitial),n.watch(()=>this.view.highlightOptions.fillOpacity,K=>{this._passParameters.fillOpacity=K??p.defaultFillOpacity;this._passParameters.fillOpacityOccluded=.25*this._passParameters.fillOpacity;this._context.requestRender()},n.syncAndInitial)])}uninitializeRenderContext(){this._context=null}dispose(){this._blurTechnique=
f.releaseMaybe(this._blurTechnique);this._downsampleTechnique=f.releaseMaybe(this._downsampleTechnique);this._applyTechnique=f.releaseMaybe(this._applyTechnique);this._grid.coverage=f.releaseMaybe(this._grid.coverage);this._grid.vao=f.disposeMaybe(this._grid.vao)}renderNode(F,K,L,G){L=L?.highlight?.colorTexture;if(this._context&&L)if(this._blurTechnique.compiled&&this._downsampleTechnique.compiled&&this._applyTechnique.compiled){K=F.bindParameters.camera;var O=K.pixelRatio,P=Math.ceil(K.fullWidth/
O);O=Math.ceil(K.fullHeight/O);var J=this._context.fbos,R=J.rctx;this._gridUpdateResources(L);this._gridComputeCoverage(L,F.bindParameters);this._passParameters.highlightTexture=L;this._passParameters.coverageTexture=this._grid.coverage?.colorTexture;var {width:X,height:U}=L.descriptor;m.set(this._passParameters.coverageRounding,X/(Math.ceil(X/C.gridCellPixelSize)*C.gridCellPixelSize),U/(Math.ceil(U/C.gridCellPixelSize)*C.gridCellPixelSize));var M=R.bindTechnique(this._blurTechnique,this._passParameters,
F.bindParameters),V=this._grid.vao;R.bindVAO(V);var Y=J.acquire(this._blurColorFormat,P,O);R.bindFramebuffer(Y.fbo);R.setViewport(0,0,P,O);R.clear(B.ClearBufferBit.COLOR_BUFFER_BIT);this._blurDrawParameters.blurInputTexture=L;m.set(this._blurDrawParameters.blurSize,1/P,0);M.bindDraw(this._blurDrawParameters,F.bindParameters,this._passParameters);R.drawArrays(this._blurTechnique.primitiveType,0,D.vertexCount(V,"geometry"));L=J.acquire(this._blurColorFormat,P,O);R.bindFramebuffer(L.fbo);R.clear(B.ClearBufferBit.COLOR_BUFFER_BIT);
this._blurDrawParameters.blurInputTexture=Y.colorTexture;m.set(this._blurDrawParameters.blurSize,0,1/O);M.bindDraw(this._blurDrawParameters,F.bindParameters,this._passParameters);R.drawArrays(this._blurTechnique.primitiveType,0,D.vertexCount(V,"geometry"));R.bindFramebuffer(G?.fbo);R.setViewport4fv(K.fullViewport);this._passParameters.blurTexture=L.colorTexture;R.bindTechnique(this._applyTechnique,this._passParameters,F.bindParameters);R.drawArrays(this._applyTechnique.primitiveType,0,D.vertexCount(V,
"geometry"));L.release();Y.release()}else this._context.requestRender()}_gridUpdateResources(F){if(this._context){var K=this._context.fbos.rctx,L=this._grid,G=Math.ceil(F.descriptor.height/C.gridCellPixelSize),O=Math.ceil(F.descriptor.width/C.gridCellPixelSize);if(!L.vao||L.verticalCellCount!==G||L.horizontalCellCount!==O){L.verticalCellCount=G;L.horizontalCellCount=O;F=G+1;var P=O+1;G=1/G;O=1/O;var J=new Float32Array(24*F*P),R=0;for(let X=0;X<F;X++)for(let U=0;U<P;U++)J[R++]=(U-.5)*O*2-1,J[R++]=
(X-.5)*G*2-1,J[R++]=U*O,J[R++]=X*G,J[R++]=(U+.5)*O*2-1,J[R++]=(X-.5)*G*2-1,J[R++]=U*O,J[R++]=X*G,J[R++]=(U-.5)*O*2-1,J[R++]=(X+.5)*G*2-1,J[R++]=U*O,J[R++]=X*G,J[R++]=(U-.5)*O*2-1,J[R++]=(X+.5)*G*2-1,J[R++]=U*O,J[R++]=X*G,J[R++]=(U+.5)*O*2-1,J[R++]=(X-.5)*G*2-1,J[R++]=U*O,J[R++]=X*G,J[R++]=(U+.5)*O*2-1,J[R++]=(X+.5)*G*2-1,J[R++]=U*O,J[R++]=X*G;L.vao?.dispose();L.vao=new z.VertexArrayObject(K,r.Default3D,{geometry:u.Pos2Tex},{geometry:E.BufferObject.createVertex(K,B.Usage.STATIC_DRAW,J)})}}}_gridComputeCoverage(F,
K){if(this._context){var L=this._context.fbos.rctx,G=this._grid,O=F.descriptor,P=Math.ceil(O.width/C.gridCellPixelSize);O=Math.ceil(O.height/C.gridCellPixelSize);G.coverage?.release();G.coverage=this._context.fbos.acquire(l.ColorFormat.RG,P,O);this._downsampleDrawParameters.input=F;L.bindFramebuffer(G.coverage.fbo);L.bindTechnique(this._downsampleTechnique,this._passParameters,K).bindDraw(this._downsampleDrawParameters,K,this._passParameters);L.setViewport(0,0,P,O);L.screen.draw()}}get test(){return{coverage:this._grid.coverage}}};
a.__decorate([k.property()],b.Highlight.prototype,"_context",void 0);a.__decorate([k.property()],b.Highlight.prototype,"view",void 0);b.Highlight=a.__decorate([e.subclass("esri.views.3d.webgl-engine.effects.highlight.Highlight")],b.Highlight);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/highlight/HighlightApplyTechnique":function(){define("require exports ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../lib/DefaultVertexAttributeLocations ../../lib/Program ../../../../../chunks/HighlightApply.glsl ../../../../webgl/enums ../../../../webgl/renderState".split(" "),
function(b,a,c,d,f,n,k,g,q){class e extends d.ShaderTechnique{initializeProgram(m){return new n.Program(m.rctx,e.shader.get().build(),f.Default3D)}initializePipeline(){return q.makePipelineState({blending:q.separateBlendingParams(g.BlendFactor.SRC_ALPHA,g.BlendFactor.ONE,g.BlendFactor.ONE_MINUS_SRC_ALPHA,g.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:q.defaultColorWriteParams})}}e.shader=new c.ReloadableShaderModule(k.HighlightApply,()=>new Promise((m,l)=>b(["../../shaders/HighlightApply.glsl"],m,
l)));a.HighlightApplyTechnique=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/HighlightApply.glsl":function(){define("exports ./vec4 ./vec4f64 ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute ./HighlightDownsample.glsl".split(" "),
function(b,a,c,d,f,n,k,g,q,e){function m(){const w=new k.ShaderBuilder,{vertex:v,fragment:x}=w,p=v.code,h=x.code;w.attributes.add(q.VertexAttribute.POSITION,"vec2");w.varyings.add("uv","vec2");w.attributes.add(q.VertexAttribute.UV0,"vec2");v.uniforms.add(new g.Texture2DPassUniform("coverageTex",t=>t.coverageTexture),new d.Float2PassUniform("coverageRounding",t=>t.coverageRounding));p.add(n.glsl`void main() {
vec4 cov = texture(coverageTex, uv0 * coverageRounding);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`);x.uniforms.add(new g.Texture2DPassUniform("tex",t=>t.blurTexture),new g.Texture2DPassUniform("highlightTexture",t=>t.highlightTexture),new f.Float4PassUniform("uColor",t=>t.color),new f.Float4PassUniform("haloColor",t=>t.haloColor),new f.Float4PassUniform("opacities",t=>a.set(l,t.haloOpacity,t.haloOpacityOccluded,t.fillOpacity,t.fillOpacityOccluded)));x.constants.add("outlineSize","float",e.outlineSize);x.constants.add("blurSize","float",e.blurSize);h.add(n.glsl`void main() {
vec4 blurredHighlightValue = texture(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture(highlightTexture, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float inner = 1.0 - (outlineSize - blurSize) / outlineSize;
float outlineFactor = smoothstep(0.0, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
fragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`);return w}const l=c.create();c=Object.freeze(Object.defineProperty({__proto__:null,build:m},Symbol.toStringTag,{value:"Module"}));b.HighlightApply=c;b.build=m})},"esri/chunks/HighlightDownsample.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder","../views/3d/webgl-engine/core/shaderModules/Texture2DDrawUniform"],function(b,a,c,d,
f){function n(){const q=new d.ShaderBuilder,{outputs:e,fragment:m}=q;q.include(a.ScreenSpacePass);m.uniforms.add(new f.Texture2DDrawUniform("textureInput",l=>l.input));m.constants.add("outlineSize","int",5);e.add("fragGrid","vec2");m.code.add(c.glsl`
    void main() {
      float red = 0.0;
      float green = 1.0;
      int cellSize = ${c.glsl.int(32)};
      vec2 texelSize = 1.0 / vec2(textureSize(textureInput, 0));
      vec2 offset = floor(gl_FragCoord.xy) * vec2(float(cellSize));

      for(int x = -outlineSize; x < cellSize + outlineSize; x += 2) {
        for(int y = -outlineSize; y < cellSize + outlineSize; y += 2) {
          vec2 coord = (offset + vec2(float(x), float(y))) * texelSize;
          vec4 value = texture(textureInput, coord);
          float mx = floor(max(value.g, value.b));

          red = max(red, ceil(value.r));
          green = min(green, mx);
          if(red == 1.0 && green == 0.0) {
            fragGrid = vec2(red, green);
            return;
          }
        }
      }
      fragGrid = vec2(red, green);
    }`);return q}class k extends c.NoParameters{}const g=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:k,blurSize:.4,build:n,gridCellPixelSize:32,outlineSize:9},Symbol.toStringTag,{value:"Module"}));b.HighlightDownsample=g;b.HighlightDownsampleDrawParameters=k;b.blurSize=.4;b.build=n;b.gridCellPixelSize=32;b.outlineSize=9})},"esri/views/3d/webgl-engine/effects/highlight/HighlightBlurTechnique":function(){define("require exports ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../lib/DefaultVertexAttributeLocations ../../lib/Program ../../../../../chunks/HighlightBlur.glsl ../../../../webgl/renderState".split(" "),
function(b,a,c,d,f,n,k,g){class q extends d.ShaderTechnique{initializeProgram(e){return new n.Program(e.rctx,q.shader.get().build(),f.Default3D)}initializePipeline(){return g.makePipelineState({colorWrite:g.defaultColorWriteParams})}}q.shader=new c.ReloadableShaderModule(k.HighlightBlur,()=>new Promise((e,m)=>b(["../../shaders/HighlightBlur.glsl"],e,m)));a.HighlightBlurTechnique=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/HighlightBlur.glsl":function(){define("exports ./vec2f64 ../views/3d/webgl-engine/core/shaderModules/Float2DrawUniform ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DDrawUniform ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(b,a,c,d,f,n,k,g,q){function e(){const w=new n.ShaderBuilder,{attributes:v,varyings:x,vertex:p,fragment:h}=w;v.add(q.VertexAttribute.POSITION,"vec2");v.add(q.VertexAttribute.UV0,"vec2");x.add("blurCoordinate","vec3");p.uniforms.add(new g.Texture2DPassUniform("coverageTex",t=>t.coverageTexture),new d.Float2PassUniform("coverageRounding",t=>t.coverageRounding));p.code.add(f.glsl`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture(coverageTex, uv0 * coverageRounding);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), cov.g);
}`);h.uniforms.add(new c.Float2DrawUniform("blurSize",t=>t.blurSize),new k.Texture2DDrawUniform("tex",t=>t.blurInputTexture));h.code.add(f.glsl`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture(tex, uv);
if (blurCoordinate.z == 1.0) {
fragColor = center;
} else {
vec4 sum = center * 0.204164;
sum += texture(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture(tex, uv - blurSize * 3.294215) * 0.093913;
fragColor = sum;
}
}`);return w}class m extends f.NoParameters{constructor(){super(...arguments);this.blurSize=a.create()}}const l=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:m,build:e},Symbol.toStringTag,{value:"Module"}));b.HighlightBlur=l;b.HighlightBlurDrawParameters=m;b.build=e})},"esri/views/3d/webgl-engine/effects/highlight/HighlightDownsampleTechnique":function(){define("require exports ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../lib/DefaultVertexAttributeLocations ../../lib/Program ../../../../../chunks/HighlightDownsample.glsl ../../../../webgl/renderState".split(" "),
function(b,a,c,d,f,n,k,g){class q extends d.ShaderTechnique{initializeProgram(e){return new n.Program(e.rctx,q.shader.get().build(),f.Default3D)}initializePipeline(){return g.makePipelineState({colorWrite:g.defaultColorWriteParams})}}q.shader=new c.ReloadableShaderModule(k.HighlightDownsample,()=>new Promise((e,m)=>b(["../../shaders/HighlightDownsample.glsl"],e,m)));a.HighlightDownsampleTechnique=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/highlight/HighlightPassParameters":function(){define(["exports",
"../../../../../chunks/vec2f64","../../../../../chunks/vec4f64","../../core/shaderModules/interfaces"],function(b,a,c,d){class f extends d.NoParameters{constructor(){super(...arguments);this.color=c.fromValues(1,0,1,1);this.haloColor=c.fromValues(1,0,1,1);this.haloOpacity=1;this.haloOpacityOccluded=.25;this.fillOpacity=.2;this.fillOpacityOccluded=.05;this.coverageRounding=a.fromValues(1,1)}}b.HighlightPassParameters=f;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/highlight/ShadowHighlight":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/colorUtils ../../../../../core/mathUtils ../../../../../core/reactiveUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../ViewingMode ../../core/shaderLibrary/shading/ReadShadowMap.glsl ../RenderPlugin ./HighlightDefaults ./ShadowHighlightTechnique ../../lib/RenderSlot".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t){b.ShadowHighlight=class extends x.SyncRenderPlugin{constructor(u){super(u);this._maxOpacity=1;this._passParameters=new h.ShadowHighlightPassParameters;this._drawParameters=new v.ReadShadowMapDrawParameters;this._shadowDifference=.2;this._context=null;this.produces=new Map([[t.RenderSlot.SHADOW_HIGHLIGHT,()=>this._isVisible]])}consumes(){return x.ConsumesHighlight}initializeRenderContext(u){this._context=u;this.addHandles([f.watch(()=>this.view.highlightOptions.shadowOpacity,
y=>{this._passParameters.shadowOpacity=y??p.defaultShadowOpacity;this._updateOccludedShadowOpacity();this._updateMaxOpacity()},f.syncAndInitial),f.watch(()=>this.view.highlightOptions.shadowDifference,y=>{this._shadowDifference=y??p.defaultShadowDifference;this._updateOccludedShadowOpacity();this._updateMaxOpacity()},f.syncAndInitial),f.watch(()=>this.view.highlightOptions.shadowColor,y=>{this._passParameters.shadowColor=c.unitRGBAFromColor(y??p.defaultShadowColor);this._updateMaxOpacity()},f.syncAndInitial)])}_updateOccludedShadowOpacity(){this._passParameters.occludedShadowOpacity=
this._passParameters.shadowOpacity*(1-this._shadowDifference)}_updateMaxOpacity(){this._maxOpacity=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity)*this._passParameters.shadowColor[3]}uninitializeRenderContext(){this._context=null}enable(){this._context&&null==this._technique&&(this._technique=this._context.techniqueRepository.acquire(h.ShadowHighlightTechnique))}renderNode(u,y,z,A){y=z?.highlight?.colorTexture;if(this._context&&z&&y&&this._isVisible)if(this._technique?.compiled){if(z=
u.bindParameters,z.shadowMap.enabled&&z.linearDepth){u=u.rctx;var C=this._technique;this._passParameters.highlight=y;this._drawParameters.origin=z.camera.center;u.bindFramebuffer(A?.fbo);u.bindTechnique(C,this._passParameters,z).bindDraw(this._drawParameters,z,this._passParameters);u.screen.draw()}}else this._context.requestRender()}updateParameters(u,y){this._passParameters.opacityElevation=1-d.smoothstep(4E4,5E4,u.relativeElevation);u=this.viewingMode===w.ViewingMode.Global?m.normalize(r,u.center):
m.set(r,0,0,1);y=m.dot(u,y);this._passParameters.dayNightTerminator=d.smoothstep(0,1,d.clamp(30*y,0,1));this._isVisible&&this.enable()}get _isVisible(){const {opacityElevation:u,dayNightTerminator:y}=this._passParameters;return.001953125<=this._maxOpacity*u*y}};a.__decorate([n.property()],b.ShadowHighlight.prototype,"_context",void 0);a.__decorate([n.property()],b.ShadowHighlight.prototype,"view",void 0);a.__decorate([n.property()],b.ShadowHighlight.prototype,"viewingMode",void 0);b.ShadowHighlight=
a.__decorate([e.subclass("esri.views.3d.webgl-engine.effects.highlight.ShadowHighlight")],b.ShadowHighlight);const r=l.create();Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/highlight/ShadowHighlightTechnique":function(){define("require exports ../../../../../chunks/vec4f64 ../../core/shaderLibrary/shading/ReadShadowMap.glsl ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../lib/DefaultVertexAttributeLocations ../../lib/Program ../../shaders/ShadowConfiguration ../../../../../chunks/ShadowHighlight.glsl ../../../../webgl/enums ../../../../webgl/renderState".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l){class w extends d.ReadShadowMapPassParameters{constructor(){super(...arguments);this.shadowColor=c.fromValues(1,0,1,1);this.shadowOpacity=.2;this.occludedShadowOpacity=.1;this.dayNightTerminator=this.opacityElevation=1}}class v extends n.ShaderTechnique{constructor(x){super(x,new q.ShadowConfiguration,()=>this.destroy())}initializeProgram(x){return new g.Program(x.rctx,v.shader.get().build(this.configuration),k.Default3D)}initializePipeline(){return l.makePipelineState({blending:l.separateBlendingParams(m.BlendFactor.SRC_ALPHA,
m.BlendFactor.ONE,m.BlendFactor.ONE_MINUS_SRC_ALPHA,m.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:l.defaultColorWriteParams,depthTest:null,depthWrite:null})}get primitiveType(){return m.PrimitiveType.TRIANGLE_STRIP}}v.shader=new f.ReloadableShaderModule(e.ShadowHighlight,()=>new Promise((x,p)=>b(["../../shaders/ShadowHighlight.glsl"],x,p)));a.ShadowHighlightPassParameters=w;a.ShadowHighlightTechnique=v;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/ShadowConfiguration":function(){define(["exports",
"../../../../chunks/tslib.es6","../core/shaderTechnique/ShaderTechniqueConfiguration"],function(b,a,c){class d extends c.ShaderTechniqueConfiguration{constructor(){super(...arguments);this.receiveShadows=!0}}a.__decorate([c.parameter()],d.prototype,"receiveShadows",void 0);b.ShadowConfiguration=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/ShadowHighlight.glsl":function(){define("exports ./mat4 ./mat4f64 ./vec3 ./vec3f64 ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/ShadowMap".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u){function y(C){const E=new t.ShaderBuilder;E.include(q.ReadShadowMapDraw,C);E.include(e.CameraSpace);E.include(n.ScreenSpacePass);C=E.fragment;C.include(m.RgbaFloatEncoding);C.include(g.ReadLinearDepth);C.uniforms.add(new r.Texture2DPassUniform("defaultDepthTex",(B,D)=>D.shadowMap.getSnapshot(u.SnapshotSlot.Default)),new r.Texture2DPassUniform("highlightDepthTex",(B,D)=>D.shadowMap.getSnapshot(u.SnapshotSlot.Highlight)),new r.Texture2DPassUniform("depthMap",
(B,D)=>D.linearDepth?.colorTexture),new r.Texture2DPassUniform("highlightTexture",B=>B.highlight),new v.Float4PassUniform("uColor",B=>B.shadowColor),new l.Float2PassUniform("nearFar",(B,D)=>D.camera.nearFar),new x.FloatPassUniform("opacity",B=>B.shadowOpacity),new x.FloatPassUniform("occludedOpacity",B=>B.occludedShadowOpacity),new x.FloatPassUniform("terminationFactor",B=>B.opacityElevation*B.dayNightTerminator),new w.Float3PassUniform("lightingMainDirectionView",(B,D)=>d.normalize(A,d.transformMat4(A,
D.lighting.mainLight.direction,D.camera.viewInverseTransposeMatrix))),new h.Matrix4PassUniform("inverseViewMatrix",(B,D)=>a.invert(z,a.translate(z,D.camera.viewMatrix,D.camera.center))));C.constants.add("unoccludedHighlightFlag","vec4",k.unoccludedHighlightFlag);C.code.add(p.glsl`
    vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, ivec2 iuv) {
      float leftPixelDepth = linearDepthFromRGBA(texelFetch(depthMap, iuv + ivec2(-1, 0), 0), nearFar);
      float rightPixelDepth = linearDepthFromRGBA(texelFetch(depthMap, iuv + ivec2(1, 0), 0), nearFar);
      float bottomPixelDepth = linearDepthFromRGBA(texelFetch(depthMap, iuv + ivec2(0, -1), 0), nearFar);
      float topPixelDepth = linearDepthFromRGBA(texelFetch(depthMap, iuv + ivec2(0, 1), 0), nearFar);

      bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
      bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);

      vec3 fragCoordHorizontal = pickLeft
                                  ? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
                                  : vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
      vec3 fragCoordVertical = pickBottom
                                  ? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
                                  : vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);

      vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
      vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);

      vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
      // Flip normal depending on triangle winding order for consistency
      return pickLeft == pickBottom ? normal : -normal;
    }

    void main(void) {
      vec4 highlightInfo = texture(highlightTexture, uv);
      float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
      if (visiblyHighlighted > ${p.glsl.float(.99999)}) {
        discard;
      }

      ivec2 iuv = ivec2(uv * vec2(textureSize(depthMap, 0)));
      float depth = rgba2float(texelFetch(depthMap, iuv, 0));
      // 0.0 is the clear value of depthMap, which means nothing has been drawn there and we should discard
      if (depth == 0.0) {
        discard;
      }

      float currentPixelDepth = linearDepthFromFloat(depth, nearFar);

      if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
        discard;
      }

      vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
      vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;

      mat4 shadowMatrix;
      float linearDepth = -currentPixelDepth;
      int i = chooseCascade(linearDepth, shadowMatrix);

      if (i >= numCascades) {
        discard;
      }

      vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);

      // vertex completely outside? -> no shadow
      if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
        discard;
      }

      ivec2 texSize = textureSize(highlightDepthTex, 0);
      ivec2 uvShadow = ivec2(cascadeCoordinates(i, texSize, lvpos) * vec2(texSize));

      float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
      bool shadowHighlight = depthHighlight < lvpos.z;

      if (!shadowHighlight) {
        discard;
      }

      float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
      bool shadowDefault = depthDefault < lvpos.z;

      vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, iuv);
      bool shaded = dot(normal, lightingMainDirectionView) < ${p.glsl.float(.025)};

      float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
      fragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
    }
  `);return E}const z=c.create(),A=f.create();c=Object.freeze(Object.defineProperty({__proto__:null,build:y},Symbol.toStringTag,{value:"Module"}));b.ShadowHighlight=c;b.build=y})},"esri/views/3d/webgl-engine/effects/smaa/SMAA":function(){define("require exports ../../../../../chunks/tslib.es6 ../../../../../core/maybe ../../../../../core/promiseUtils ../../../../../core/reactiveUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../support/requestImageUtils ../../core/FBOCache ../RenderPlugin ./SMAABlendWeightsTechnique ./SMAABlurTechnique ./SMAAEdgeDetectTechnique ./SMAAPassParameters ../../lib/RenderFeature ../../lib/RenderSlot ../../../../webgl/enums ../../../../webgl/Texture ../../../../webgl/TextureDescriptor".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A){function C(E,B,D,F){const K=new A.TextureDescriptor;K.pixelFormat=D;K.wrapMode=y.TextureWrapMode.CLAMP_TO_EDGE;K.width=F.width;K.height=F.height;K.samplingMode=B;return new z.Texture(E,K,F)}a.SMAA=class extends v.SyncRenderPlugin{constructor(E){super(E);this._searchTexture=this._areaTexture=this._context=null;this._isEnabled=!1;this._smaaParameters=new t.SMAAPassParameters;this.produces=new Map([[u.RenderSlot.ANTIALIASING,()=>this._isEnabled&&
null!=this._context]])}consumes(){return v.ConsumesCompositeColor}get updating(){return null!=this._abortController}initializeRenderContext(E){this._context=E;this.addHandles([n.watch(()=>this.view.qualitySettings.antialiasingEnabled,B=>B||this._context?.isFeatureEnabled(r.RenderFeature.Antialiasing)?this.enable():this.disable(),n.syncAndInitial)])}renderFeatureChanged(){this.view.qualitySettings.antialiasingEnabled||this._context?.isFeatureEnabled(r.RenderFeature.Antialiasing)?this.enable():this.disable()}uninitializeRenderContext(){this.disable();
this._context=null}enable(){if(!this._isEnabled&&this._context&&!this._abortController)if(null==this._edgeTechnique&&(this._edgeTechnique=this._context.techniqueRepository.acquire(h.SMAAEdgeDetectTechnique)),null==this._blendTechnique&&(this._blendTechnique=this._context.techniqueRepository.acquire(x.SMAABlendWeightsTechnique)),null==this._blurTechnique&&(this._blurTechnique=this._context.techniqueRepository.acquire(p.SMAABlurTechnique)),this._areaTexture&&this._searchTexture)this._isEnabled=!0;else{this._abortController=
new AbortController;var E=this._abortController.signal;(new Promise((B,D)=>b(["./SMAAData"],B,D))).then(B=>this._loadTextures(this._context,B,E)).then(()=>{this._context?.requestRender();this._abortController=null}).catch(B=>{f.isAbortError(B)||this._disposeTextures()})}}_loadTextures(E,B,D){f.throwIfAborted(D);return E?Promise.all([l.requestImage(B.areaTexture).then(F=>C(E.fbos.rctx,y.TextureSamplingMode.LINEAR,y.PixelFormat.RGB,F)),l.requestImage(B.searchTexure).then(F=>C(E.fbos.rctx,y.TextureSamplingMode.NEAREST,
y.PixelFormat.LUMINANCE,F))]).then(([F,K])=>{f.isAborted(D)?(F.dispose(),K.dispose(),f.throwIfAborted(D)):(this._areaTexture=F,this._searchTexture=K,this._isEnabled=!0)}):Promise.reject()}_disposeTextures(){this._areaTexture=d.disposeMaybe(this._areaTexture);this._searchTexture=d.disposeMaybe(this._searchTexture)}disable(){this._abortController=d.abortMaybe(this._abortController);this._isEnabled=!1}destroy(){this.disable();this._disposeTextures()}renderNode(E,B,D,F){B=D?.composite?.colorTexture;if(!(this._isEnabled&&
this._context&&D&&B))return F;if(!(this._edgeTechnique?.compiled&&this._blendTechnique?.compiled&&this._blurTechnique?.compiled))return this._context.requestRender(),F;D=B.descriptor.width;const K=B.descriptor.height,L=this._context.fbos;E=E.rctx;E.setViewport(0,0,D,K);const G=L.acquire(w.ColorFormat.RG,D,K);E.bindFramebuffer(G.fbo);E.setClearColor(0,0,0,1);E.clear(y.ClearBufferBit.COLOR_BUFFER_BIT);this._smaaParameters.color=B;E.bindTechnique(this._edgeTechnique,this._smaaParameters);E.screen.draw();
B=L.acquire(w.ColorFormat.RGBA,D,K);E.bindFramebuffer(B.fbo);E.setClearColor(0,0,1,1);E.clear(y.ClearBufferBit.COLOR_BUFFER_BIT);this._smaaParameters.inputTexture=G.colorTexture;this._smaaParameters.areaTexture=this._areaTexture;this._smaaParameters.searchTexture=this._searchTexture;E.bindTechnique(this._blendTechnique,this._smaaParameters);E.screen.draw();E.bindFramebuffer(F?.fbo);G.release();E.setClearColor(0,1,0,1);E.clear(y.ClearBufferBit.COLOR_BUFFER_BIT);this._smaaParameters.inputTexture=B.colorTexture;
E.bindTechnique(this._blurTechnique,this._smaaParameters);E.screen.draw();B.release();return F}};c.__decorate([k.property()],a.SMAA.prototype,"view",void 0);c.__decorate([k.property()],a.SMAA.prototype,"_context",void 0);c.__decorate([k.property()],a.SMAA.prototype,"_abortController",void 0);c.__decorate([k.property({readOnly:!0})],a.SMAA.prototype,"updating",null);a.SMAA=c.__decorate([m.subclass("esri.views.3d.webgl-engine.effects.smaa.SMAA")],a.SMAA);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/effects/smaa/SMAABlendWeightsTechnique":function(){define("require exports ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../lib/DefaultVertexAttributeLocations ../../lib/Program ../../../../../chunks/BlendWeights.glsl ../../../../webgl/renderState".split(" "),function(b,a,c,d,f,n,k,g){class q extends d.ShaderTechnique{initializeProgram(e){return new n.Program(e.rctx,q.shader.get().build(),f.Default3D)}initializePipeline(){return g.makePipelineState({colorWrite:g.defaultColorWriteParams})}}
q.shader=new c.ReloadableShaderModule(k.BlendWeights,()=>new Promise((e,m)=>b(["../../shaders/BlendWeights.glsl"],e,m)));a.SMAABlendWeightsTechnique=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/BlendWeights.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder","../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform"],
function(b,a,c,d,f){function n(){const q=new d.ShaderBuilder;q.include(a.ScreenSpacePass);q.fragment.uniforms.add(new f.Texture2DPassUniform("edgesTexture",e=>e.inputTexture));q.fragment.uniforms.add(new f.Texture2DPassUniform("areaTexture",e=>e.areaTexture));q.fragment.uniforms.add(new f.Texture2DPassUniform("searchTexture",e=>e.searchTexture));q.fragment.code.add(c.glsl`
      #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
      #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

      vec4 sampleLevelZeroOffset(sampler2D tex, vec2 coord, vec2 offset, vec2 resolution) {
        return texture(tex, coord + offset.x * resolution, 0.0);
      }

      float searchLength(sampler2D searchTex, vec2 e, float bias, float scale) {
        e.r = bias + e.r * scale;
        return 255.0 * texture( searchTex, e, 0.0 ).r;
      }

      float searchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${c.glsl.int(k.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 2.0, 0.0 ) * resolution;
          if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x += 0.25 * resolution.x;
        texcoord.x += resolution.x;
        texcoord.x += 2.0 * resolution.x;
        texcoord.x -= resolution.x * searchLength(searchTex, e, 0.0, 0.5);
        return texcoord.x;
      }

      float searchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${c.glsl.int(k.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 2.0, 0.0 ) * resolution;
          if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x -= 0.25 * resolution.x;
        texcoord.x -= resolution.x;
        texcoord.x -= 2.0 * resolution.x;
        texcoord.x += resolution.x * searchLength( searchTex, e, 0.5, 0.5 );
        return texcoord.x;
      }

      float searchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${c.glsl.int(k.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 0.0, 2.0 ) * resolution;
          if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y -= 0.25 * resolution.y;
        texcoord.y -= resolution.y;
        texcoord.y -= 2.0 * resolution.y;
        texcoord.y += resolution.y * searchLength( searchTex, e.gr, 0.0, 0.5 );
        return texcoord.y;
      }

      float searchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${c.glsl.int(k.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 0.0, 2.0 ) * resolution;
          if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y += 0.25 * resolution.y;
        texcoord.y += resolution.y;
        texcoord.y += 2.0 * resolution.y;
        texcoord.y -= resolution.y * searchLength( searchTex, e.gr, 0.5, 0.5 );
        return texcoord.y;
      }

      vec2 getArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
        vec2 texcoord = float( ${c.glsl.int(k.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
        texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
        texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
        return texture( areaTex, texcoord, 0.0 ).rg;
      }

      void main() {
        vec2 size = vec2(textureSize(edgesTexture, 0));
        vec2 resolution = 1.0 / size;
        vec2 pixelCoord = uv * size;
        vec4 offsets[2];
        offsets[0] = uv.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
        offsets[1] = uv.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
        vec4 maxOffset = vec4( offsets[0].xz, offsets[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${c.glsl.int(k.maxSearchSteps)} );

        ivec4 subsampleIndices = ivec4(0.0);
        vec4 weights = vec4(0.0);
        vec2 e = texture( edgesTexture, uv ).rg;
        if ( e.g > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.x = searchXLeft( edgesTexture, searchTexture, offsets[0].xy, maxOffset.x, resolution );
          coords.y = offsets[1].y;
          d.x = coords.x;
          float e1 = texture( edgesTexture, coords, 0.0 ).r;
          coords.x = searchXRight( edgesTexture, searchTexture, offsets[0].zw, maxOffset.y, resolution );
          d.y = coords.x;
          d = d * size.x - pixelCoord.x;
          vec2 sqrt_d = sqrt( abs(d) );
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2( 1.0, 0.0 ), resolution).r;
          weights.rg = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.y ) );
        }

        if ( e.r > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.y = searchYUp( edgesTexture, searchTexture, offsets[1].xy, maxOffset.z, resolution );
          coords.x = offsets[0].x;
          d.x = coords.y;
          float e1 = texture( edgesTexture, coords, 0.0 ).g;
          coords.y = searchYDown( edgesTexture, searchTexture, offsets[1].zw, maxOffset.w, resolution );
          d.y = coords.y;
          d = d * size.y - pixelCoord.y;
          vec2 sqrt_d = sqrt(abs(d));
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2(0.0, 1.0), resolution).g;
          weights.ba = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.x ) );

          // for some reason the following lines are necessary to prevent
          // texture lookup precision issues on some Intel integrated graphics chips
          vec4 dbg = (offsets[0] + offsets[1] + maxOffset + coords.xyyx);
          weights.r += 0.00000001 * dot(vec4(0, 1, 0, 1), dbg);
        }
        fragColor = weights;
      }
    `);return q}const k={maxSearchSteps:8,maxDistanceAreaTex:16},g=Object.freeze(Object.defineProperty({__proto__:null,build:n},Symbol.toStringTag,{value:"Module"}));b.BlendWeights=g;b.build=n})},"esri/views/3d/webgl-engine/effects/smaa/SMAABlurTechnique":function(){define("require exports ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../lib/DefaultVertexAttributeLocations ../../lib/Program ../../../../../chunks/Blur.glsl ../../../../webgl/renderState".split(" "),
function(b,a,c,d,f,n,k,g){class q extends d.ShaderTechnique{initializeProgram(e){return new n.Program(e.rctx,q.shader.get().build(),f.Default3D)}initializePipeline(){return g.makePipelineState({colorWrite:g.defaultColorWriteParams})}}q.shader=new c.ReloadableShaderModule(k.Blur,()=>new Promise((e,m)=>b(["../../shaders/Blur.glsl"],e,m)));a.SMAABlurTechnique=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Blur.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl",
"../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder","../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform"],function(b,a,c,d,f){function n(){const g=new d.ShaderBuilder;g.include(a.ScreenSpacePass);g.fragment.uniforms.add(new f.Texture2DPassUniform("blendWeightsTexture",q=>q.inputTexture),new f.Texture2DPassUniform("colorTexture",q=>q.color));g.fragment.code.add(c.glsl`void main() {
vec2 resolution = 1.0 / vec2(textureSize(colorTexture, 0));
vec4 offsets = vec4(uv.x + resolution.x, uv.y, uv.x, uv.y - resolution.y);
vec4 a;
a.rb = texture(blendWeightsTexture, uv).rb;
a.g = texture(blendWeightsTexture, offsets.zw).g;
a.a = texture(blendWeightsTexture, offsets.xy).a;
if ( dot(a, vec4(1.0)) < 1e-5 ) {
fragColor = texture( colorTexture, uv, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture( colorTexture, uv, 0.0 );
vec4 Cop = texture( colorTexture, uv + sign( offset ) * resolution.xy, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
fragColor = mix(C, Cop, s);
}
}`);return g}const k=Object.freeze(Object.defineProperty({__proto__:null,build:n},Symbol.toStringTag,{value:"Module"}));b.Blur=k;b.build=n})},"esri/views/3d/webgl-engine/effects/smaa/SMAAEdgeDetectTechnique":function(){define("require exports ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../lib/DefaultVertexAttributeLocations ../../lib/Program ../../../../../chunks/EdgeDetect.glsl ../../../../webgl/renderState".split(" "),function(b,a,c,d,f,n,k,g){class q extends d.ShaderTechnique{initializeProgram(e){return new n.Program(e.rctx,
q.shader.get().build(),f.Default3D)}initializePipeline(){return g.makePipelineState({colorWrite:g.defaultColorWriteParams})}}q.shader=new c.ReloadableShaderModule(k.EdgeDetect,()=>new Promise((e,m)=>b(["../../shaders/EdgeDetect.glsl"],e,m)));a.SMAAEdgeDetectTechnique=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/EdgeDetect.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl","../views/3d/webgl-engine/core/shaderModules/interfaces",
"../views/3d/webgl-engine/core/shaderModules/ShaderBuilder","../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform"],function(b,a,c,d,f){function n(){const q=new d.ShaderBuilder;q.include(a.ScreenSpacePass);q.fragment.uniforms.add(new f.Texture2DPassUniform("colorTexture",e=>e.color));q.outputs.add("fragEdges","vec2");q.fragment.code.add(c.glsl`
    float absMax3(vec3 v) {
      vec3 t = abs(v);
      return max(max(t.r, t.g), t.b);
    }

    void main() {
      vec2 resolution = 1.0 / vec2(textureSize(colorTexture, 0));
      vec4 offsets[3];
      offsets[0] = vec4(uv.x - resolution.x, uv.y, uv.x, uv.y + resolution.y);
      offsets[1] = vec4(uv.x + resolution.x, uv.y, uv.x, uv.y - resolution.y);
      offsets[2] = vec4(uv.x - 2.0 * resolution.x, uv.y, uv.x, uv.y + 2.0 * resolution.y);

      // Calculate color deltas:
      vec4 delta;
      vec3 C = texture(colorTexture, uv).rgb;

      vec3 Cleft = texture(colorTexture, offsets[0].xy).rgb;
      delta.x = absMax3(C - Cleft);

      vec3 Ctop = texture(colorTexture, offsets[0].zw).rgb;
      delta.y = absMax3(C - Ctop);

      vec2 edges = step(vec2(${c.glsl.float(k.threshold)}), delta.xy);

      // discard if there is no edge:
      if (dot(edges, vec2(1.0)) == 0.0) {
        discard;
      }

      // Calculate right and bottom deltas:
      vec3 Cright = texture(colorTexture, offsets[1].xy).rgb;
      delta.z = absMax3(C - Cright);

      vec3 Cbottom  = texture(colorTexture, offsets[1].zw).rgb;
      delta.w = absMax3(C - Cbottom);

      // Calculate the maximum delta in the direct neighborhood:
      float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w);

      // Calculate left-left and top-top deltas:
      vec3 Cleftleft  = texture(colorTexture, offsets[2].xy).rgb;
      delta.z = absMax3(C - Cleftleft);

      vec3 Ctoptop = texture(colorTexture, offsets[2].zw).rgb;
      delta.w = absMax3(C - Ctoptop);

      // Calculate the final maximum delta:
      maxDelta = max(max(maxDelta, delta.z), delta.w);

      // Local contrast adaptation in action:
      edges *= step(maxDelta, float(${c.glsl.float(k.localConstrastAdaption)}) * delta.xy);

      fragEdges = edges;
    }
  `);return q}const k={threshold:.05,localConstrastAdaption:2},g=Object.freeze(Object.defineProperty({__proto__:null,build:n},Symbol.toStringTag,{value:"Module"}));b.EdgeDetect=g;b.build=n})},"esri/views/3d/webgl-engine/effects/smaa/SMAAPassParameters":function(){define(["exports","../../core/shaderModules/interfaces"],function(b,a){class c extends a.NoParameters{}b.SMAAPassParameters=c;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/AnimationTimeStep":function(){define(["exports",
"../../../../core/has","../../../../core/mathUtils","../../../../core/time"],function(b,a,c,d){class f{constructor(){this._step=g;this._dilation=1;this._firstIdleTime=d.Milliseconds(0)}frame(e,m){m?0===this._firstIdleTime&&(this._firstIdleTime=d.Milliseconds(performance.now())):this._firstIdleTime=d.Milliseconds(0);if(a("disable-feature:high-quality-idle"))this._dilation=1;else{m=m?performance.now()-this._firstIdleTime:0;if(m>=n+k){this._step=d.Milliseconds(Infinity);this._dilation=1;return}this._dilation=
m>=n?10:1}e=c.clamp(e/.5,g,q);this._step=Infinity===this._step?d.Milliseconds(e):d.Milliseconds(.9*this._step+e*(1-.9))}get value(){return this._step}get timeDilation(){return this._dilation}clear(){this._step=this._firstIdleTime=d.Milliseconds(0)}}const n=d.Milliseconds(12E4),k=d.Milliseconds(1E4),g=d.Milliseconds(1E3),q=d.Milliseconds(1E3/30);b.AnimationTimeStep=f;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/OffscreenRendering":function(){define("exports ../../../../core/has ../../../../core/maybe ../core/FBOCache ./TransparencyPassType ../../../webgl/enums ../../../webgl/FramebufferObject".split(" "),
function(b,a,c,d,f,n,k){class g{constructor(e,m){this._fbos=e;this.compositingHelper=m;this._height=this._width=4}dispose(){this._color=c.releaseMaybe(this._color);this.releaseBuffers()}get framebuffer(){this.color.detachDepth();this.color.attachDepth(this.depth);return this.color.fbo}get colorTexture(){return this.color.colorTexture}get depthTexture(){return this.depth.attachment}initializeFrame(e,m,l){this._fbos.interactive=!l;l=this._fbos.rctx;this._width=e.fullWidth;this._height=e.fullHeight;
k.ensureAttachmentMaxSize(this,l.parameters.maxTextureSize);e=this._color;this._color=null;this.releaseBuffers();this.bindFbo();l.setClearStencil(0);l.setClearColor(m[0],m[1],m[2],m[3]);l.clearSafe(n.ClearBufferBit.COLOR_BUFFER_BIT|n.ClearBufferBit.DEPTH_BUFFER_BIT|n.ClearBufferBit.STENCIL_BUFFER_BIT);return e}releaseBuffers(){this._color?.detachDepth();this._depth=c.releaseMaybe(this._depth)}renderHUDVisibility(e,m,l){if(e?.fbo.width!==this._width||e?.fbo.height!==this._height)e?.release(),e=this._fbos.acquire(d.ColorFormat.RGBA4,
this._width,this._height);e.attachDepth(l||this.depth);this._fbos.rctx.bindFramebuffer(e.fbo);this.renderToFBO(m,q);e.detachDepth();return e}compositeToHUDVisibility(e,m){this._fbos.rctx.bindFramebuffer(e.hudVisibility?.fbo);this.compositingHelper.compositeHUD(e,m)}renderOITPass(e,m,l){let w,v;switch(m){case f.TransparencyPassType.Color:w=this._fbos.acquire(d.ColorFormat.RGBA16F,this._width,this._height);v=[0,0,0,0];break;case f.TransparencyPassType.Alpha:w=this._fbos.acquire(d.ColorFormat.R16F,this._width,
this._height);v=[1,1,1,1];break;case f.TransparencyPassType.FrontFace:w=this._fbos.acquire(d.ColorFormat.RGBA,this._width,this._height),v=[0,0,0,0]}l?(w.acquireDepth(d.DepthFormat.DEPTH16_BUFFER),this._fbos.rctx.bindFramebuffer(w.fbo),this.renderToFBO(e,v,!0,!0),w.releaseDepth()):(w.attachDepth(this.depth),this._fbos.rctx.bindFramebuffer(w.fbo),this.renderToFBO(e,v),w.detachDepth());return w}compositeToFramebuffer(e,m,l,w){this.bindFbo();this.compositingHelper.composite(e,m,l,w)}compositeTransparentOntoOpaque(e,
m,l,w,v){v?(this._fbos.rctx.bindFramebuffer(v.fbo),this._fbos.rctx.setClearColor(0,0,0,1E-13),this._fbos.rctx.clearSafe(n.ClearBufferBit.COLOR_BUFFER_BIT)):this.bindFbo();this.compositingHelper.compositeOIT(e,m.colorTexture,l.colorTexture,w.colorTexture)}renderDepthDetached(e){this._bindTarget(this.color);e();this._bindTarget(this.color,this.depth)}renderToCachedFBO(e,m,l,w=d.ColorFormat.RGBA,v=d.DepthFormat.DEPTH16_BUFFER,x=this._width,p=this._height,h=null){if(e?.fbo.width!==x||e?.fbo.height!==
p)e=c.releaseMaybe(e);e=e??this._fbos.acquire(w,x,p);null!=v&&e.acquireDepth(v);h?.forEach(t=>{e.acquireColor(t.format,t.attachment)});this._fbos.rctx.bindFramebuffer(e.fbo);this.renderToFBO(m,l,!0,!0);return e}renderToFBO(e,m,l=!1,w=!1){const v=this._fbos.rctx;let x=0;m&&(v.setClearColor(m[0],m[1],m[2],Math.max(1E-13,m[3])),x|=n.ClearBufferBit.COLOR_BUFFER_BIT);l&&(x|=n.ClearBufferBit.DEPTH_BUFFER_BIT);!1===w?w=0:(!0===w&&(w=255),x|=n.ClearBufferBit.STENCIL_BUFFER_BIT);x&&v.clearSafe(x,w);e();v.gl.flush()}renderToTargets(e,
m,l,w,v=!1,x=!1){this._bindTarget(m,l);this.renderToFBO(e,w,v,x);m.detachDepth()}bindFbo(){this._bindTarget(this.color,this.depth)}_bindTarget(e,m){e.detachDepth();e.attachDepth(m);this._fbos.rctx.bindFramebuffer(e.fbo)}get width(){return this._width}get height(){return this._height}get color(){this._color||(this._color=this._fbos.acquire(d.ColorFormat.RGBA,this._width,this._height));return this._color}get depth(){this._depth||(this._depth=this._fbos.acquireDepth(d.DepthFormat.DEPTH_STENCIL_TEXTURE,
this._width,this._height));return this._depth}}const q=[0,1,0,1];b.OffscreenRendering=g;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ShadowAccumulator":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../core/shaderLibrary/shading/ReadShadowMap.glsl ./BindParameters ./depthRange ./glUtil3D ./ShadowCastRenderer ./ShadowMap ../../../../chunks/ShadowCastAccumulate.glsl ../shaders/ShadowCastAccumulateTechnique ../../../support/Scheduler ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/TextureDescriptor ../../../webgl/Util".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A,C,E,B){b.ShadowAccumulator=class extends c{constructor(F,K,L,G,O,P){super({});this.fbos=F;this._stage=L;this._prepareForShadowMapPass=G;this._renderToShadowMap=O;this._requestRender=P;this._sampleCount=this._progress=0;this._passParameters=new v.ReadShadowMapPassParameters;this._cachedLightDirections=[];this._depthRange=p.zero;this._cameraForcedForScreenshot=this._previewing=!1;this._shadowAccumulatorKey="shadowAccumulator";this._rctx=F.rctx;
this._bindParameters=new x.BindParameters(new r.ShadowMap(F,L.viewingMode),null);this._bindParameters.shadowMap.enabled=!0;this._vao=h.createQuadVAO(this._rctx);this._accumulationRenderer=new t.ShadowCastRenderer(K,this._rctx,this,P);this.addHandles([this._stage.view.resourceController.scheduler.registerTask(z.TaskPriority.SHADOW_ACCUMULATOR,this),k.watch(()=>L.renderView,J=>{this.removeHandles("renderView");null!=J&&this.addHandles(J.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=
!0),"renderView")},k.syncAndInitial),k.watch(()=>this._previewing,()=>this._requestRenderIfEnabled(),k.sync)],this._shadowAccumulatorKey)}normalizeCtorArgs(){return{}}dispose(){this._disable();this.removeHandles(this._shadowAccumulatorKey);this._accumulationRenderer=n.disposeMaybe(this._accumulationRenderer);this._bindParameters.shadowMap.dispose();this._fbo=n.disposeMaybe(this._fbo);this._vao=n.disposeMaybe(this._vao);this._accumulationTechniqueCached=n.releaseMaybe(this._accumulationTechniqueCached);
this._sampleCount=this._cachedLightDirections.length=0}get computedSamples(){return this._progress}get shadowCastTexture(){return this._fbo?.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get _accumulationTechnique(){null==this._accumulationTechniqueCached&&(this._accumulationTechniqueCached=new y.ShadowCastAccumulateTechnique({rctx:this._rctx,viewingMode:this._stage.viewingMode}));return this._accumulationTechniqueCached}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&
!this._previewing}get _isPreviewing(){return this._isActive&&this._previewing}get _isActive(){return null!=this._fbo&&0<this._sampleCount}get canAccumulate(){return null!==this._bindParameters.linearDepth?.colorTexture&&this._depthRange!==p.zero&&this._opacityFromElevation>t.shadowCastDisabledElevationThreshold}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(F){const K=this._cachedLightDirections;if(!d.equals(K,
F,l.equals)){var L=Math.min(u.ShadowCastMaxSamples,F.length);this._sampleCount=K.length=L;for(let G=0;G<L;++G)K[G]=l.copy(K[G]??w.create(),F[G]);this._invalidate()}}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(F){this._accumulationRenderer.opacityFromElevation=F}get running(){return this._isRefining&&this.canAccumulate&&0<this._progress}runTask(F){for(this._prepareForShadowMapPass(this._bindParameters);!F.done&&!this._isDoneAccumulating;)this._accumulateShadow(),
F.madeProgress();this._requestRender()}renderAccumulation(F,K,L,G){this._depthRange=K;this._updateCamera(L);this._bindParameters.contentCamera=G;this._bindParameters.linearDepth=F;this._passParameters.origin=this._bindParameters.camera.center;this.notifyChange("canAccumulate");if(this.isAccumulating&&this.canAccumulate){(this._previewing||0===this._progress||this._cameraForcedForScreenshot)&&this._clear();F=this._cameraForcedForScreenshot?this._sampleCount:Math.min(6,this._sampleCount-this._progress);
for(K=0;K<F;++K)this._accumulateShadow();this._cameraForcedForScreenshot=!1;this._requestRender()}}render(F){this._accumulationRenderer.render(F)}setOptions(F){void 0!==F.enabled&&F.enabled!==(null!=this._fbo)&&(F.enabled?this._enable():this._disable());void 0!==F.previewing&&(this._previewing=F.previewing);void 0!==F.lightDirections&&(this._lightDirections=F.lightDirections);this._accumulationRenderer.setOptions(F)}readAccumulatedShadow(F,K){if(!this._isActive||!this._fbo||1>this._progress||0>F||
F>=this._fbo.width||0>K||K>=this._fbo.height)return 0;this._fbo.readPixels(F,K,1,1,A.PixelFormat.RED,A.PixelType.UNSIGNED_BYTE,D);return D[0]/this._progress}_enable(){this._progress=0;const F=new E.TextureDescriptor;F.pixelFormat=A.PixelFormat.RED;F.internalFormat=A.SizedPixelFormat.R8;F.wrapMode=A.TextureWrapMode.CLAMP_TO_EDGE;this._fbo=new C.FramebufferObject(this._rctx,F)}_disable(){this._fbo=n.disposeMaybe(this._fbo)}_invalidate(){this._progress=0;this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo);
this._rctx.setClearColor(0,0,0,0);this._rctx.clearSafe(A.ClearBufferBit.COLOR_BUFFER_BIT);this._progress=0}_accumulateShadow(){this._renderToShadowMap(this._bindParameters,this._lightDirections[this._progress++],this._depthRange);const F=this._accumulationTechnique;this._rctx.bindFramebuffer(this._fbo);this._rctx.bindTechnique(F,this._passParameters,this._bindParameters);this._rctx.bindVAO(this._vao);this._rctx.drawArrays(F.primitiveType,0,B.vertexCount(this._vao,"geometry"))}_updateCamera(F){!F.equals(this._bindParameters.camera)&&
this._fbo&&(this._bindParameters.camera.copyFrom(F),this._fbo.resize(F.fullWidth,F.fullHeight),this._opacityFromElevation=1-f.smoothstep(t.shadowCastDisableElevationMin,t.shadowCastDisableElevationMax,F.relativeElevation))}_requestRenderIfEnabled(){this._fbo&&this._requestRender()}get test(){const F=this;return{lightDirections:this._lightDirections,get isDone(){return F._isDoneAccumulating},get isActive(){return F._isActive}}}};a.__decorate([g.property()],b.ShadowAccumulator.prototype,"_progress",
void 0);a.__decorate([g.property()],b.ShadowAccumulator.prototype,"_sampleCount",void 0);a.__decorate([g.property()],b.ShadowAccumulator.prototype,"_fbo",void 0);a.__decorate([g.property()],b.ShadowAccumulator.prototype,"_depthRange",void 0);a.__decorate([g.property()],b.ShadowAccumulator.prototype,"_previewing",void 0);a.__decorate([g.property()],b.ShadowAccumulator.prototype,"_accumulationRenderer",void 0);a.__decorate([g.property()],b.ShadowAccumulator.prototype,"_isRefining",null);a.__decorate([g.property()],
b.ShadowAccumulator.prototype,"_isActive",null);a.__decorate([g.property()],b.ShadowAccumulator.prototype,"canAccumulate",null);a.__decorate([g.property()],b.ShadowAccumulator.prototype,"_isDoneAccumulating",null);a.__decorate([g.property()],b.ShadowAccumulator.prototype,"_opacityFromElevation",null);a.__decorate([g.property()],b.ShadowAccumulator.prototype,"running",null);b.ShadowAccumulator=a.__decorate([m.subclass("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],b.ShadowAccumulator);const D=
new Uint8Array(1);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ShadowCastRenderer":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec4 ./glUtil3D ../../../../chunks/ShadowCastVisualize.glsl ../shaders/ShadowCastVisualizeTechnique ../shaders/ShadowCastVisualizeTechniqueConfiguration ../../../webgl/Util".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x){const p=1/512;b.ShadowCastRenderer=class extends c{constructor(h,t,r,u){super({});this._techniqueRepository=h;this._rctx=t;this._data=r;this._requestRender=u;this._passParameters=new l.ShadowCastVisualizePassParameters(this._data);this._techniqueConfig=new v.ShadowCastVisualizeTechniqueConfiguration;this._enabled=!1;this._vao=m.createQuadVAO(t)}normalizeCtorArgs(){return{}}dispose(){this._stop();this._vao=d.disposeMaybe(this._vao);this._techniqueRepository.release(this._technique);
this._technique=null}get _visualizeShadowCastTechnique(){return this._technique=this._techniqueRepository.releaseAndAcquire(w.ShadowCastVisualizeTechnique,this._techniqueConfig,this._technique)}render(h){if(this._showVisualization){this._passParameters.sampleScale=1/this._data.computedSamples;var t=this._visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao);this._rctx.bindTechnique(t,this._passParameters,h);this._rctx.drawArrays(t.primitiveType,0,x.vertexCount(this._vao,"geometry"))}}setOptions(h){void 0!==
h.enabled&&this._setEnabled(h.enabled);void 0!==h.color&&this._setColor(h.color);void 0!==h.threshold&&(this._threshold=h.threshold);void 0!==h.visualization&&(this._visualization=h.visualization);void 0!==h.bandSize&&(this._bandSize=h.bandSize);void 0!==h.bandsEnabled&&(this._bandsEnabled=h.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(h){this._passParameters.opacityFromElevation!==h&&(this._passParameters.opacityFromElevation=
h,this.notifyChange("opacityFromElevation"))}get _showVisualization(){return this._enabled&&0<this._data.computedSamples&&this.opacityFromElevation>p}get _threshold(){return this._passParameters.threshold}set _threshold(h){this._threshold!==h&&(this._passParameters.threshold=h,this._requestRenderIfRunning())}get _visualization(){return this._techniqueConfig.visualization}set _visualization(h){h!==this._visualization&&(this._techniqueConfig.visualization=h,this._techniqueRepository.release(this._technique),
this._technique=null,this._requestRenderIfRunning())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(h){h!==this._bandSize&&(this._passParameters.bandSize=h,this._requestRenderIfRunning())}get _bandsEnabled(){return this._techniqueConfig.bandsEnabled}set _bandsEnabled(h){h!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=h,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}_setColor(h){e.exactEquals(h,this._passParameters.color)||
(e.copy(this._passParameters.color,h),this._requestRenderIfRunning())}_setEnabled(h){h!==this._enabled&&(h?this._start():this._stop())}_requestRenderIfRunning(){this._enabled&&this._requestRender()}_start(){this._enabled=!0;this._requestRender()}_stop(){this._enabled=!1;this._requestRender()}};a.__decorate([f.property()],b.ShadowCastRenderer.prototype,"opacityFromElevation",null);b.ShadowCastRenderer=a.__decorate([q.subclass("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],b.ShadowCastRenderer);
b.shadowCastDisableElevationMax=5E4;b.shadowCastDisableElevationMin=4E4;b.shadowCastDisabledElevationThreshold=p;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/ShadowCastVisualize.glsl":function(){define("exports ./vec4f64 ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ./ShadowCastAccumulate.glsl ../views/3d/webgl-engine/shaders/ShadowCastVisualizeTechniqueConfiguration".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w){function v(t){const r=new e.ShaderBuilder,u=r.fragment;u.include(n.RgbaFloatEncoding);u.include(d.ReadLinearDepth);r.include(f.CameraSpace);r.include(c.ScreenSpacePass);const {visualization:y,bandsEnabled:z}=t;u.constants.add("inverseSampleValue","float",l.ShadowCastMaxSamples);u.uniforms.add(new m.Texture2DPassUniform("shadowCastMap",C=>C.shadowCastMap),new g.FloatPassUniform("sampleScale",C=>C.sampleScale),new g.FloatPassUniform("opacityFromElevation",C=>C.opacityFromElevation),
new k.Float4PassUniform("uColor",C=>C.color));t=y===w.ShadowCastVisualization.Gradient;const A=y===w.ShadowCastVisualization.Threshold;t&&z?u.uniforms.add(new g.FloatPassUniform("bandSize",C=>C.bandSize)):A&&u.uniforms.add(new g.FloatPassUniform("threshold",C=>C.threshold));u.code.add(q.glsl`
      void main(void) {
        float record = texture(shadowCastMap, uv).r;
        float pixelSamples = record * inverseSampleValue;
        if (pixelSamples < 1.0) {
          discard;
        }

        float strength = pixelSamples * sampleScale;

        ${A?q.glsl`
            if (strength <= threshold) {
              discard;
            }`:""}

        ${t&&z?q.glsl`strength = ceil(strength / bandSize) * bandSize;`:""}

        fragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${t?q.glsl`* strength`:""});
      }
    `);return r}class x extends q.NoParameters{constructor(t){super();this._data=t;this.sampleScale=0;this.opacityFromElevation=1;this.color=a.clone(p);this.bandSize=.1;this.threshold=.5}get shadowCastMap(){return this._data.shadowCastTexture}}const p=a.fromValues(.01,0,.25,1),h=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:x,build:v},Symbol.toStringTag,{value:"Module"}));b.ShadowCastVisualize=h;b.ShadowCastVisualizePassParameters=x;b.build=v})},"esri/chunks/ShadowCastAccumulate.glsl":function(){define("exports ./mat4 ./mat4f64 ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w){function v(h){const t=new l.ShaderBuilder,r=t.fragment;r.include(g.RgbaFloatEncoding);r.include(f.ReadLinearDepth);t.include(k.CameraSpace);t.include(d.ScreenSpacePass);t.include(n.ReadShadowMapPass,h);r.uniforms.add(new w.Texture2DPassUniform("depthMap",(u,y)=>y.linearDepth?.colorTexture),new m.Matrix4PassUniform("inverseViewMatrix",(u,y)=>a.invert(p,a.translate(p,y.camera.viewMatrix,y.camera.center))),new q.Float2PassUniform("nearFar",(u,y)=>y.camera.nearFar));
r.constants.add("sampleValue","float",x);t.outputs.add("sampleCount","float");r.code.add(e.glsl`void main(void) {
float depth = rgba2float(texture(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
ivec2 texSize = textureSize(shadowMapTex, 0);
ivec2 uvShadow = ivec2(cascadeCoordinates(i, texSize, lvpos) * vec2(texSize));
float depthShadow = readShadowMapDepth(uvShadow, shadowMapTex);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
sampleCount = sampleValue;
}`);return t}const x=1/255,p=c.create();c=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastMaxSamples:255,build:v},Symbol.toStringTag,{value:"Module"}));b.ShadowCastAccumulate=c;b.ShadowCastMaxSamples=255;b.build=v})},"esri/views/3d/webgl-engine/shaders/ShadowCastVisualizeTechniqueConfiguration":function(){define(["exports","../../../../chunks/tslib.es6","../core/shaderTechnique/ShaderTechniqueConfiguration"],function(b,a,c){b.ShadowCastVisualization=void 0;(function(f){f[f.Gradient=
0]="Gradient";f[f.Threshold=1]="Threshold";f[f.COUNT=2]="COUNT"})(b.ShadowCastVisualization||(b.ShadowCastVisualization={}));class d extends c.ShaderTechniqueConfiguration{constructor(){super(...arguments);this.visualization=b.ShadowCastVisualization.Gradient;this.bandsEnabled=!1}}a.__decorate([c.parameter({count:b.ShadowCastVisualization.COUNT})],d.prototype,"visualization",void 0);a.__decorate([c.parameter()],d.prototype,"bandsEnabled",void 0);b.ShadowCastVisualizeTechniqueConfiguration=d;Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/ShadowCastVisualizeTechnique":function(){define("require exports ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../../../../chunks/ShadowCastVisualize.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),function(b,a,c,d,f,n,k,g,q,e){class m extends d.ShaderTechnique{constructor(l,w){super(l,
w,()=>this.destroy())}initializeProgram(l){return new k.Program(l.rctx,m.shader.get().build(this.configuration),f.Default3D)}initializePipeline(){return e.makePipelineState({blending:n.blendingDefault,colorWrite:e.defaultColorWriteParams,depthTest:null,depthWrite:null})}get primitiveType(){return q.PrimitiveType.TRIANGLE_STRIP}}m.shader=new c.ReloadableShaderModule(g.ShadowCastVisualize,()=>new Promise((l,w)=>b(["./ShadowCastVisualize.glsl"],l,w)));a.ShadowCastVisualizeTechnique=m;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/ShadowCastAccumulateTechnique":function(){define("require exports ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/ShadowCastAccumulate.glsl ./ShadowConfiguration ../../../webgl/enums ../../../webgl/renderState".split(" "),function(b,a,c,d,f,n,k,g,q,e){class m extends d.ShaderTechnique{constructor(l){super(l,new g.ShadowConfiguration,
()=>this.destroy())}initializeProgram(l){return new n.Program(l.rctx,m.shader.get().build(this.configuration),f.Default3D)}initializePipeline(){return e.makePipelineState({blending:e.separateBlendingParams(q.BlendFactor.ONE,q.BlendFactor.ONE,q.BlendFactor.ONE,q.BlendFactor.ONE),colorWrite:e.defaultColorWriteParams,depthTest:null,depthWrite:null})}get primitiveType(){return q.PrimitiveType.TRIANGLE_STRIP}}m.shader=new c.ReloadableShaderModule(k.ShadowCastAccumulate,()=>new Promise((l,w)=>b(["./ShadowCastAccumulate.glsl"],
l,w)));a.ShadowCastAccumulateTechnique=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/SliceHelper":function(){define(["../../../../chunks/boundedPlane"],function(b){const a=b.create();class c{constructor(){this._plane=b.create()}get isEnabled(){return!b.equals(this.plane,a)}get plane(){return this._plane}set plane(d){b.copy(d||a,this._plane)}}return c})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeView":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/Accessor ../../../../../core/arrayUtils ../../../../../core/Logger ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/mat3 ../../../../../chunks/mat3f64 ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../core/support/UpdatingHandles ../../../../../chunks/sphere ../../../../../chunks/vec33 ../../../../ViewingMode ../../collections/Component/Material/shader/ComponentData.glsl ../../core/util/TwoVectorPosition ../Attribute ../GridLocalOriginFactory ../localOriginHelper ../LocalOriginManager ../Object3D ../VertexArrayObject ../VertexAttribute ./bufferLayouts ./edgeBufferWriters ./edgePreprocessing ./EdgeRenderer ./EdgeShaderParameters ./EdgeWorkerHandle ./interfaces ./strokes ./util ../TextureBackedBuffer/BufferManager ../../shaders/sources/edgeRenderer/EdgeUtil.glsl ../../../../webgl/BufferObject ../../../../webgl/enums".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A,C,E,B,D,F,K,L,G,O,P,J,R,X,U,M,V,Y,W,H){function S(ca){null!=ca&&(ca.vao.vertexBuffers.instances.dispose(),ca.vao.disposeVAOOnly(),ca.vao=null)}function I(ca){let ia=null,la=null;for(let oa=0;oa<ca.geometries.length;oa++){const na=ca.geometries[oa];if(na.material.supportsEdges){if(!ia)ia=na.transformation;else if(!d.equals(ia,na.transformation))return!1;if(!la&&null!=na.localOrigin)la=na;else if(null!=la?.localOrigin&&null!=na.localOrigin&&la.localOrigin.id!==
na.localOrigin.id)return!1}}return!0}function Q(ca,ia,la){ia*=la;la=d.binaryIndexOf(ca,ia,!0);return-1===la?ia<ca[0]?ca.length:0:ca.length-la}b.EdgeView=class extends c{constructor(ca){super(ca);this._updatingHandles=new h.UpdatingHandles;this._perObjectData=new Map;this._perObjectDataEvictionCache=new Set;this._renderers=new Map;this._gpuMemoryUsage=0;this._workerAbort=new AbortController;this._tmpModelPosition=p.create();this._localOrigins=new B.LocalOriginManager(new C.GridLocalOriginFactory(ca.renderSR))}initialize(){this._worker=
new R.EdgeWorkerHandle(this.schedule);this._componentColorManager=new V.BufferManager(this.rctx,3);const ca=L.VertexLayout.createBuffer(4);for(let ia=0;4>ia;ia++)ca.sideness.set(ia,0,0===ia||3===ia?0:1),ca.sideness.set(ia,1,0===ia||1===ia?0:1);this._verticesBufferObject=W.BufferObject.createVertex(this.rctx,H.Usage.STATIC_DRAW,ca.buffer)}destroy(){this.destroyed||(this._perObjectData.forEach(ca=>this._discardObjectEntry(ca)),this._perObjectData.clear(),this._strokesTexture=k.disposeMaybe(this._strokesTexture),
this._componentColorManager=k.destroyMaybe(this._componentColorManager),this._workerAbort.abort(),this._worker.destroy(),this._verticesBufferObject=k.disposeMaybe(this._verticesBufferObject),this._renderers.clear(),this._updatingHandles.destroy(),this._set("schedule",ea))}get updating(){return this._updatingHandles.updating}get usedMemory(){return this._gpuMemoryUsage}shouldRender(){return 0<this._renderers.size}async addComponentObject(ca,ia,la,oa,na,ra,ta,ma){if(this.hasObject(ca))return this.getObjectMemoryUsage(ca);
let pa;la=new N(new Promise(ja=>pa=ja),la.center,la.radius);this._perObjectData.set(ca,la);ca=await this._updatingHandles.addPromise(this._addComponentGeometry(ia,la,oa,na,ra,ta,ma));this.setNeedsRender();pa();return ca}async addOrUpdateObject3D(ca,ia,la,oa){if(this.destroyed)f.getLogger(this).warn("Attempt to add an object to a destroyed instance");else{var na=this._perObjectData.get(ca);0<na?.renderables.length&&this._perObjectDataEvictionCache.add(na);var ra,ta=ca.boundingVolumeWorldSpace.bounds;
ta=new N(new Promise(pa=>ra=pa),t.getCenter(ta),t.getRadius(ta));this._perObjectData.set(ca,ta);var ma=[];if(la.mergeGeometries&&1<ca.geometries.length&&I(ca))ma.push(this._addObjectMergedGeometries(ca,ta,ia,la,oa));else for(let pa=0;pa<ca.geometries.length;pa++){const ja=ca.geometries[pa];ja.material.supportsEdges&&ma.push(this._addGeometry(ca,ta,ja,ia[0],la,oa))}await this._updatingHandles.addPromise(Promise.all(ma));this._perObjectDataEvictionCache.delete(ta);this._discardObjectEntry(na);this.setNeedsRender();
ra()}}fastUpdateObject3DEdgesTransform(ca){if(this.destroyed)return!1;var ia=this._perObjectData.get(ca);if(!ia)return!1;var {geometries:la}=ca;({renderables:ia}=ia);if(0===la.length||0===ia.length)return!0;if(1<ia.length)return!1;[ia]=ia;var oa=ia.transform;if(!(oa instanceof Z))return!1;[la]=la;if(la.localOrigin!==oa.origin.origin)return!1;oa=v.create();ca=this._computeModelTransformWithLocalOrigin(ca,la,oa);ia.transform=new Z(oa,ca);this.setNeedsRender();return!0}_discardObjectEntry(ca){ca&&(ca.renderables.length&&
(ca.renderables.forEach(ia=>this._removeRenderable(ia)),this.setNeedsRender()),ca.loaded=null)}hasObject(ca){return this._perObjectData.has(ca)}async updateAllComponentOpacities(ca,ia){ca=await this._updatingHandles.addPromise(this._getObjectEntry(ca));if(null!=ca){var la=ia instanceof Array?oa=>ia[oa]:()=>ia;ca.renderables.forEach(oa=>{const na=oa.components.meta.length;for(let ra=0;ra<na;ra++){const ta=la(ra),ma=oa.components.meta[ra],pa=ma.index;ma.material.opacity=ta;oa.components.buffer.textureBuffer.setDataElement(pa,
1,3,255*ta)}this._updateTransparency(oa)});this.setNeedsRender()}}async getObjectMemoryUsage(ca){ca=await this._getObjectEntry(ca);return null!=ca?ca.renderables.reduce((ia,la)=>ia+la.statistics.gpuMemoryUsage,0):0}async updateAllComponentMaterials(ca,ia,la,oa){const na=ca instanceof D.Object3D,ra=!!la.hasSlicePlane,ta=M.determineRendererType(ia),ma=P.EdgeRenderer.getKey(ta,ra,na);ca=await this._updatingHandles.addPromise(this._getObjectEntry(ca));null!=ca&&(ca.renderables.forEach(pa=>{if(ma!==pa.rendererKey){var ja=
this._renderers.get(pa.rendererKey);const qa=this._acquireRenderer(ta,ra,na);ja.removeRenderable(pa);--ja.refCount;pa.rendererKey=ma;qa.addRenderable(pa)}for(ja=0;ja<ia.length;ja++)pa.components.meta[ja].material=ia[ja];oa&&this._updateComponentBuffer(pa.components);this._updateTransparency(pa)}),this.setNeedsRender())}async updateAllVerticalOffsets(ca,ia){ca=await this._updatingHandles.addPromise(this._getObjectEntry(ca));null!=ca&&(ca.renderables.forEach(la=>{const oa=la.components.meta;for(let na=
0;na<oa.length;na++)la.components.meta[na].verticalOffset=ia?.[na]??0;this._updateComponentBuffer(la.components)}),this.setNeedsRender())}async updateObjectVisibility(ca,ia){ca=await this._updatingHandles.addPromise(this._getObjectEntry(ca));null!=ca&&(ca.renderables.forEach(la=>la.visible=ia),this.setNeedsRender())}removeObject(ca){const ia=this._perObjectData.get(ca);ia&&(this._perObjectData.delete(ca),this._discardObjectEntry(ia))}async _getObjectEntry(ca){ca=this._perObjectData.get(ca);if(!ca)throw Error("no object");
await ca.loaded;return null==ca.loaded?null:ca}render(ca,ia){if(null!=this._componentColorManager){this._localOrigins.updateViewMatrices(ca.camera.viewMatrix);var la=ca.camera.viewInverseTransposeMatrix,oa=p.create(),na=new z.TwoVectorPosition,ra=0,ta=0;this._renderers.forEach(pa=>{if(0===pa.refCount)this._renderers.delete(pa.key),pa.dispose();else{var ja=!0,qa=!0;pa.forEachRenderable(ua=>{ua.visible&&(ra+=ua.statistics.averageEdgeLength,ta++,ja&&ua.regular&&(pa.updateTechnique(ca,!1),ja=!1),qa&&
ua.silhouette&&(pa.updateTechnique(ca,!0),qa=!1))},ia)}});this._componentColorManager.garbageCollect();this._componentColorManager.updateTextures();if(0!==ta){var ma=new J.EdgePassParameters(40*ra/ta,ia);x.set(oa,la[3],la[7],la[11]);na.set(oa);x.copy(ma.transformWorldFromViewTH,na.high);x.copy(ma.transformWorldFromViewTL,na.low);l.fromMat4(ma.transformViewFromCameraRelativeRS,ca.camera.viewMatrix);l.transpose(ba,ma.transformViewFromCameraRelativeRS);l.invert(ma.transformNormalViewFromGlobal,ba);ma.transformProjFromView=
ca.camera.projectionMatrix;this._updateObjectCameraDistances(ca);this._renderers.forEach(pa=>{this._renderRegularEdges(pa,ca,ma);this._renderSilhouetteEdges(pa,ca,ma)})}}}_updateTransparency(ca){const ia=M.determineEdgeTransparency(ca.components.meta),la=M.determineObjectTransparency(ca.components.meta);if(ia!==ca.edgeTransparency||la!==ca.objectTransparency)ca.edgeTransparency=ia,ca.objectTransparency=la,this._renderers.get(ca.rendererKey).setRenderablesDirty()}_computeModelTransformWithLocalOrigin(ca,
ia,la){ca.getCombinedShaderTransformation(ia,la);ca=null!=ia.localOrigin?this._localOrigins.register(ia.localOrigin):this._localOrigins.acquire(x.set(this._tmpModelPosition,la[12],la[13],la[14]));ia.localOrigin=ca.origin;E.applyToModelMatrix(ca.origin.vec3,la);return ca}_updateComponentBuffer(ca){const {meta:ia,buffer:la}=ca;ca=new Uint8Array(4);for(let na=0;na<ia.length;na++){var oa=ia[na].material;const ra=ia[na].index,ta=n.clamp(Math.round(oa.size*P.lineWidthFractionFactor),0,255),ma=n.clamp(oa.extensionLength,
-P.extensionLengthOffset,255-P.extensionLengthOffset)+P.extensionLengthOffset,pa="solid"===oa.type?O.EdgeType.SOLID:O.EdgeType.SKETCH,ja=255*oa.opacity;oa=oa.color;la.textureBuffer.setData(ra,0,255*oa[0],255*oa[1],255*oa[2],255*oa[3]);la.textureBuffer.setData(ra,1,ta,ma,pa,ja);y.encodeElevationOffset(ia[na].verticalOffset,ca);la.textureBuffer.setData(ra,2,ca[0],ca[1],ca[2],ca[3])}}_createComponentBuffers(ca){if(null==this._componentColorManager)return null;const ia=[],la=this._componentColorManager.getBuffer(ca.length);
for(let oa=0;oa<ca.length;oa++){const na=ca[oa],ra=la.acquireIndex();ia.push({index:ra,verticalOffset:0,material:na})}ca=new T(la,ia);this._updateComponentBuffer(ca);return ca}_extractEdges(ca,ia,la,oa,na,ra=na.length){return this._worker.process({data:ia,indices:na,indicesLength:ra,writerSettings:ca,skipDeduplicate:la},this._workerAbort.signal,oa)}_createRenderable(ca,ia,la,oa,na){var ra=ma=>null!=this._verticesBufferObject?new aa(new F.VertexArrayObject(this.rctx,L.EdgeShaderAttributeLocations,
{vertices:L.glVertexLayout,instances:ma===Y.EdgeSilhouette.REGULAR?G.RegularEdgeBufferWriter.glLayout:G.SilhouetteEdgeBufferWriter.glLayout},{vertices:this._verticesBufferObject,instances:W.BufferObject.createVertex(this.rctx,H.Usage.STATIC_DRAW,ma===Y.EdgeSilhouette.REGULAR?ca.regular.instancesData.buffer:ca.silhouette.instancesData.buffer)}),ma===Y.EdgeSilhouette.REGULAR?ca.regular.lodInfo:ca.silhouette.lodInfo):null;const ta=0<ca.regular.lodInfo.lengths.length?ra(Y.EdgeSilhouette.REGULAR):null;
ra=0<ca.silhouette.lodInfo.lengths.length?ra(Y.EdgeSilhouette.SILHOUETTE):null;return new da(ta,ra,{gpuMemoryUsage:(ta?.vao.usedMemory??0)+(ra?.vao.usedMemory??0),externalMemoryUsage:na,averageEdgeLength:ca.averageEdgeLength},la,M.determineEdgeTransparency(ia.meta),M.determineObjectTransparency(ia.meta),ia,oa)}async _addGeometry(ca,ia,la,oa,na,ra){if(!(0>=la.edgeIndicesLength)){var ta=la.attributes.get(K.VertexAttribute.POSITION),ma=v.create();ca=this._computeModelTransformWithLocalOrigin(ca,la,ma);
ta=new ha(ta,ma,ca);return this._addPositionData(ia,ta,la.edgeIndicesLength,oa,na,ra)}}async _addPositionData(ca,ia,la,oa,na,ra=!1){if(null!=ca.loaded){var ta=this._createComponentBuffers([oa]);if(null!=ta){oa=this._acquireRenderer(oa.type,!!na.hasSlicePlane,!0);var {modelTransform:ma,origin:pa}=ia;na=ia.position.indices;ia=ia.position;var ja=ia.data.length/ia.size,qa=L.EdgeInputBufferLayout.createBuffer(ja);for(let ua=0;ua<ja;ua++)qa.position.set(ua,0,ia.data[ua*ia.size]),qa.position.set(ua,1,ia.data[ua*
ia.size+1]),qa.position.set(ua,2,ia.data[ua*ia.size+2]);M.fillComponenBufferIndices(ta.meta,[0,qa.componentIndex.count],qa.componentIndex);la=await this._updatingHandles.addPromise(this._extractEdges(oa.writerSettings,qa,!1,ra,na,la));null!=ca.loaded&&(ta=this._createRenderable(la,ta,new Z(ma,pa),oa.key,!1),ca.renderables.push(ta),oa.addRenderable(ta),this._gpuMemoryUsage+=ta.statistics.gpuMemoryUsage)}}}async _addComponentGeometry(ca,ia,la,oa,na,ra,ta){if(null==ia.loaded)return 0;const ma=this._createComponentBuffers(ra);
if(null==ma)return 0;ra=M.determineRendererType(ra);ta=this._acquireRenderer(ra,ta.hasSlicePlane||!1,!1);ra=L.EdgeInputBufferLayout.createBuffer(la.length/3);r.copy(ra.position.typedBuffer,la,ra.position.typedBufferStride,3);M.fillComponenBufferIndices(ma.meta,na,ra.componentIndex,oa);la=await this._updatingHandles.addPromise(this._extractEdges(ta.writerSettings,ra,!0,!1,oa));if(null==ia.loaded)return 0;ca=this._createRenderable(la,ma,ca,ta.key,!0);ia.renderables.push(ca);ta.addRenderable(ca);return ca.statistics.gpuMemoryUsage}async _addObjectMergedGeometries(ca,
ia,la,oa,na){const ra=new Map;let ta=0,ma=null,pa=0;var ja=ca.geometries.filter(Aa=>{if(0>=Aa.edgeIndicesLength||!Aa.material.supportsEdges)return!1;!ma&&Aa.localOrigin&&(ma=Aa);const Fa=Aa.attributes.get(K.VertexAttribute.POSITION);pa+=Fa.data.length/Fa.size;ta+=Aa.edgeIndicesLength;return!0});if(0!==ja.length){var qa=65536<=pa?Uint32Array:Uint16Array,ua=ta?new qa(ta):null,wa=[],za=0;ja.forEach(Aa=>{var Fa=Aa.attributes.get(K.VertexAttribute.POSITION);const Da=Fa.indices;let Ha=ra.get(Fa.data);if(null==
Ha){Ha=wa.length/3;for(let Ka=0;Ka<Fa.data.length;Ka+=Fa.size)wa.push(Fa.data[Ka]),wa.push(Fa.data[Ka+1]),wa.push(Fa.data[Ka+2]);ra.set(Fa.data,Ha)}for(Fa=0;Fa<Aa.edgeIndicesLength;Fa++)ua[za++]=Ha+Da[Fa]});qa=ma||ca.geometries[0];ja=v.create();qa=this._computeModelTransformWithLocalOrigin(ca,qa,ja);for(let Aa=0;Aa<ca.geometries.length;Aa++)ca.geometries[Aa].localOrigin=qa.origin;ca=new ha(new A.Attribute(wa,ua,3),ja,qa);await this._updatingHandles.addPromise(this._addPositionData(ia,ca,ua.length,
la[0],oa,na))}}_acquireRenderer(ca,ia,la){const oa=P.EdgeRenderer.getKey(ca,ia,la);let na=this._renderers.get(oa);null==this._strokesTexture&&(this._strokesTexture=U.generateStrokesTexture(this.rctx));na||(na=new P.EdgeRenderer(this.rctx,this.techniqueRepository,{type:ca,hasSlicePlane:ia,strokesTexture:this._strokesTexture,legacy:la,spherical:this.viewingMode===u.ViewingMode.Global}),this._renderers.set(oa,na));++na.refCount;return na}_removeRenderable(ca){S(ca.regular);S(ca.silhouette);const ia=
this._renderers.get(ca.rendererKey);if(ia){ia.removeRenderable(ca);--ia.refCount;"origin"in ca.transform&&this._localOrigins.release(ca.transform.origin);this._gpuMemoryUsage-=ca.statistics.externalMemoryUsage?0:ca.statistics.gpuMemoryUsage;for(const la of ca.components.meta)ca.components.buffer.releaseIndex(la.index)}}_updateObjectCameraDistances(ca){const ia=ca.camera.eye,la=ca.camera.viewForward,oa=p.create();ca=na=>{x.sub(oa,na.center,ia);const ra=x.dot(oa,la),ta=na.radius,ma=ra<-ta?Infinity:
ra<ta?0:ra-ta;na.renderables.forEach(pa=>pa.distanceToCamera=ma)};this._perObjectData.forEach(ca);this._perObjectDataEvictionCache.forEach(ca)}_renderRegularEdges(ca,ia,la){const oa=ca.bindRegularEdges(la,ia),na=ia.camera.perScreenPixelRatio;ca.forEachRenderable(ra=>{if(null!=ra.regular&&ra.visible){var ta=Q(ra.regular.lod.lengths,ra.distanceToCamera,na);ca.renderRegularEdges(oa,ra,la,ia,ta)}},la.transparency)}_renderSilhouetteEdges(ca,ia,la){const oa=ca.bindSilhouetteEdges(la,ia),na=ia.camera.perScreenPixelRatio;
ca.forEachRenderable(ra=>{if(null!=ra.silhouette&&ra.visible){var ta=Q(ra.silhouette.lod.lengths,ra.distanceToCamera,na);ca.renderSilhouetteEdges(oa,ra,la,ia,ta)}},la.transparency)}get test(){return{hasRenderedPrimitives:ca=>{let ia=!1;const la=ca.perScreenPixelRatio,oa=(na,ra)=>na.forEachRenderable(ta=>{ta.visible&&!ia&&(null!=ta.regular&&(ia=0<Q(ta.regular.lod.lengths,ta.distanceToCamera,la)),ia||null==ta.silhouette||(ia=0<Q(ta.silhouette.lod.lengths,ta.distanceToCamera,la)))},ra);this._renderers.forEach(na=>
{ia||(oa(na,X.Transparency.OPAQUE),oa(na,X.Transparency.TRANSPARENT))});return ia},getObjectData:ca=>this._perObjectData.get(ca)}}};a.__decorate([g.property({constructOnly:!0})],b.EdgeView.prototype,"rctx",void 0);a.__decorate([g.property({constructOnly:!0})],b.EdgeView.prototype,"renderSR",void 0);a.__decorate([g.property({constructOnly:!0})],b.EdgeView.prototype,"viewingMode",void 0);a.__decorate([g.property({constructOnly:!0})],b.EdgeView.prototype,"techniqueRepository",void 0);a.__decorate([g.property({constructOnly:!0})],
b.EdgeView.prototype,"setNeedsRender",void 0);a.__decorate([g.property({constructOnly:!0})],b.EdgeView.prototype,"schedule",void 0);a.__decorate([g.property({readOnly:!0})],b.EdgeView.prototype,"_updatingHandles",void 0);a.__decorate([g.property({readOnly:!0})],b.EdgeView.prototype,"updating",null);b.EdgeView=a.__decorate([m.subclass("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],b.EdgeView);class N{constructor(ca,ia,la){this.center=ia;this.radius=la;this.renderables=[];this.loaded=ca;
this.loaded.then(()=>{null!=this.loaded&&(this.loaded=!0)})}}class T{constructor(ca,ia){this.buffer=ca;this.meta=ia}}class aa{constructor(ca,ia){this.vao=ca;this.lod=ia}}class Z{constructor(ca,ia){this.modelMatrix=ca;this.origin=ia}}class da{constructor(ca,ia,la,oa,na,ra,ta,ma){this.regular=ca;this.silhouette=ia;this.statistics=la;this.transform=oa;this.edgeTransparency=na;this.objectTransparency=ra;this.components=ta;this.rendererKey=ma;this.distanceToCamera=0;this.visible=!0}}class fa extends da{}
class ka extends da{}class ha{constructor(ca,ia,la){this.position=ca;this.modelTransform=ia;this.origin=la}}const ba=w.create(),ea=()=>Promise.reject();b.LegacyTransform=Z;b.RegularRenderable=fa;b.Renderable=da;b.SilhouetteRenderable=ka;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/localOriginHelper":function(){define(["exports"],function(b){b.applyToModelMatrix=function(a,c){const d=-a[0],f=-a[1];a=-a[2];const n=c[3],k=c[7],g=c[11],q=c[15];c[0]+=
n*d;c[1]+=n*f;c[2]+=n*a;c[4]+=k*d;c[5]+=k*f;c[6]+=k*a;c[8]+=g*d;c[9]+=g*f;c[10]+=g*a;c[12]+=q*d;c[13]+=q*f;c[14]+=q*a};b.applyToViewMatrix=function(a,c){const d=a[0],f=a[1];a=a[2];c[12]+=d*c[0]+f*c[4]+a*c[8];c[13]+=d*c[1]+f*c[5]+a*c[9];c[14]+=d*c[2]+f*c[6]+a*c[10];c[14]+=d*c[3]+f*c[7]+a*c[11]};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/LocalOriginManager":function(){define(["exports","../../../../chunks/mat4","../../../../chunks/mat4f64","./localOriginHelper"],
function(b,a,c,d){class f{constructor(k){this._factory=k;this._originData=new Map}acquire(k){return this.register(this._factory.getOrigin(k))}register(k){k=this._originData.get(k.id)||new n(k);k.refCount++;this._originData.has(k.origin.id)||this._originData.set(k.origin.id,k);return k}release(k){k.refCount--;0===k.refCount&&this._originData.delete(k.origin.id)}updateViewMatrices(k){this._originData.forEach(g=>{a.copy(g.viewMatrix,k);d.applyToViewMatrix(g.origin.vec3,g.viewMatrix)})}}class n{constructor(k){this.origin=
k;this.refCount=0;this.viewMatrix=c.create()}}b.LocalOriginManager=f;b.OriginData=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeRenderer":function(){define("exports ../../../../../core/maybe ../../../../../core/PooledArray ../../../../../chunks/mat3 ../../../../../chunks/mat3f32 ../../../../../chunks/vec3 ../../../support/debugFlags ../../core/util/TwoVectorPosition ./EdgeShaderParameters ./EdgeShaderTechnique ./EdgeShaderTechniqueConfiguration ./interfaces ../../shaders/sources/edgeRenderer/EdgeUtil.glsl ../../../../webgl/enums".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v){const x={type:"uber",hasSlicePlane:!1,strokesTexture:null,legacy:!0,spherical:!0},p={solid:w.EdgeUtilMode.SOLID,sketch:w.EdgeUtilMode.SKETCH,uber:w.EdgeUtilMode.MIXED};class h{constructor(r,u,y){this._rctx=r;this._shaderTechniqueRepository=u;this._configuration=new m.EdgeShaderTechniqueConfiguration;this.refCount=0;this._renderables=new Set;this._sortedRenderables={[l.Transparency.TRANSPARENT]:{[l.Transparency.TRANSPARENT]:new c,[l.Transparency.OPAQUE]:new c},
[l.Transparency.OPAQUE]:{[l.Transparency.TRANSPARENT]:new c,[l.Transparency.OPAQUE]:new c}};this._renderablesDirty=!1;this._drawParameters=new q.EdgeDrawParameters;this._settings={...x,...y};this.key=h.getKey(this._settings.type,this._settings.hasSlicePlane,this._settings.legacy);this.writerSettings={variants:this._settings.strokesTexture.variants,reducedPrecision:k.debugFlags.TESTS_DISABLE_OPTIMIZATIONS};this._configuration.legacy=this._settings.legacy;this._configuration.mode=p[this._settings.type];
this._configuration.silhouette=!1;this._configuration.antialiasing=!!this._rctx.capabilities.blendMinMax;this._configuration.hasSlicePlane=this._settings.hasSlicePlane;this._configuration.doublePrecisionRequiresObfuscation=r.driverTest.doublePrecisionRequiresObfuscation.result;this._configuration.spherical=y.spherical}dispose(){this._technique=a.releaseMaybe(this._technique)}addRenderable(r){this._renderables.add(r);this._renderablesDirty=!0}removeRenderable(r){this._renderables.delete(r);this._renderablesDirty=
!0}setRenderablesDirty(){this._renderablesDirty=!0}forEachRenderable(r,u){this._renderablesDirty&&this._sortRenderables();u=this._sortedRenderables[u];u[l.Transparency.TRANSPARENT].forAll(r);u[l.Transparency.OPAQUE].forAll(r)}updateTechnique(r,u){this._configuration.multipassEnabled=!!r.multipassEnabled;this._configuration.cullAboveGround=!!r.multipassTerrain.cullAboveGround;this._configuration.silhouette=u;return this._technique=this._shaderTechniqueRepository.releaseAndAcquire(e.EdgeShaderTechnique,
this._configuration,this._technique)}bindRegularEdges(r,u){this._lastOriginId=null;return this._rctx.bindTechnique(this.updateTechnique(u,!1),r,u)}bindSilhouetteEdges(r,u){this._lastOriginId=null;return this._rctx.bindTechnique(this.updateTechnique(u,!0),r,u)}renderRegularEdges(r,u,y,z,A){this._render(r,u,u.regular.vao,y,z,A)}renderSilhouetteEdges(r,u,y,z,A){this._render(r,u,u.silhouette.vao,y,z,A)}_render(r,u,y,z,A,C){0<C&&(this._bindDraw(r,u,z,A),this._rctx.bindVAO(y),this._rctx.drawArraysInstanced(v.PrimitiveType.TRIANGLE_FAN,
0,4,C))}_bindDraw(r,u,y,z){this._drawParameters.componentDataTexture=u.components.buffer.textureBuffer.texture;this._drawParameters.strokesTexture=this._settings.strokesTexture;if("origin"in u.transform)this._lastOriginId!==u.transform.origin.origin.id&&(r.setUniformMatrix4fv("localView",u.transform.origin.viewMatrix),this._lastOriginId=u.transform.origin.origin.id),r.setUniformMatrix4fv("model",u.transform.modelMatrix),this._drawParameters.slicePlaneLocalOrigin=u.transform.origin.origin.vec3;else{const A=
new g.TwoVectorPosition(u.transform.position),C=d.transpose(t,d.invert(t,u.transform.rotationScale));this._drawParameters.transformWorldFromModelTL=A.low;this._drawParameters.transformWorldFromModelTH=A.high;this._drawParameters.transformWorldFromModelRS=u.transform.rotationScale;this._drawParameters.transformNormalGlobalFromModel=C;u=z.camera.viewInverseTransposeMatrix;n.set(this._drawParameters.slicePlaneLocalOrigin,u[3],u[7],u[11])}r.bindDraw(this._drawParameters,z,y)}_sortRenderables(){this._renderablesDirty=
!1;this._sortedRenderables[l.Transparency.TRANSPARENT][l.Transparency.TRANSPARENT].clear();this._sortedRenderables[l.Transparency.TRANSPARENT][l.Transparency.OPAQUE].clear();this._sortedRenderables[l.Transparency.OPAQUE][l.Transparency.TRANSPARENT].clear();this._sortedRenderables[l.Transparency.OPAQUE][l.Transparency.OPAQUE].clear();this._renderables.forEach(u=>{u.objectTransparency!==l.Transparency.INVISIBLE&&u.edgeTransparency!==l.Transparency.INVISIBLE&&this._sortedRenderables[u.objectTransparency][u.edgeTransparency].push(u)});
const r=(u,y)=>"origin"in u.transform?"origin"in y.transform?u.transform.origin.origin.id<y.transform.origin.origin.id?-1:u.transform.origin.origin.id>y.transform.origin.origin.id?1:0:1:0;this._sortedRenderables[l.Transparency.TRANSPARENT][l.Transparency.TRANSPARENT].sort(r);this._sortedRenderables[l.Transparency.TRANSPARENT][l.Transparency.OPAQUE].sort(r);this._sortedRenderables[l.Transparency.OPAQUE][l.Transparency.TRANSPARENT].sort(r);this._sortedRenderables[l.Transparency.OPAQUE][l.Transparency.OPAQUE].sort(r)}static getKey(r,
u,y){return`edges-t:${r}:${u}:${y}`}}const t=f.create();b.EdgeRenderer=h;b.extensionLengthOffset=128;b.lineWidthFractionFactor=8;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeShaderParameters":function(){define(["exports","../../../../../chunks/mat3f64","../../../../../chunks/vec3f64","../../core/shaderLibrary/attributes/VertexPosition.glsl"],function(b,a,c,d){class f extends d.VertexPositionPassParameters{constructor(k,g){super();
this.distanceFalloffFactor=k;this.transparency=g;this.transformNormalViewFromGlobal=a.create()}}class n extends d.VertexPositionDrawParameters{constructor(){super(...arguments);this.transformNormalViewFromGlobal=a.create();this.slicePlaneLocalOrigin=c.create();this.transformNormalGlobalFromModel=a.create()}}b.EdgeDrawParameters=n;b.EdgePassParameters=f;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeShaderTechnique":function(){define("require exports ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../Program ./bufferLayouts ../../../../../chunks/EdgeShader.glsl ../../../../webgl/enums ../../../../webgl/renderState".split(" "),
function(b,a,c,d,f,n,k,g,q){class e extends d.ShaderTechnique{initializeProgram(m){return new f.Program(m.rctx,e.shader.get().build(this.configuration),n.EdgeShaderAttributeLocations)}initializePipeline(m){return m.blendMinMax?q.makePipelineState({blending:q.separateBlendingParams(g.BlendFactor.ONE,g.BlendFactor.ONE,g.BlendFactor.ZERO,g.BlendFactor.ONE,g.BlendOperation.ADD,m.blendMinMax.MAX),depthTest:{func:g.CompareFunction.LEQUAL},colorWrite:q.defaultColorWriteParams}):q.makePipelineState({depthTest:{func:g.CompareFunction.LEQUAL},
depthWrite:q.defaultDepthWriteParams,colorWrite:q.defaultColorWriteParams})}}e.shader=new c.ReloadableShaderModule(k.EdgeShader,()=>new Promise((m,l)=>b(["../../shaders/sources/edgeRenderer/EdgeShader.glsl"],m,l)));a.EdgeShaderTechnique=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/EdgeShader.glsl":function(){define("exports ./vec2 ./vec2f64 ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Uniform ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/shaders/sources/edgeRenderer/AdjustProjectedPosition.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardByCoverage.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardNonSilhouetteEdges.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/EdgeUtil.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/LineAmplitude.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/LineOffset.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/UnpackAttributes.glsl".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r){function u(A){const C=new e.ShaderBuilder,{vertex:E,fragment:B}=C;A.legacy&&E.uniforms.add(new z("model"),new z("localView"));C.include(w.AdjustProjectedPosition,A);C.include(p.EdgeUtil,A);C.include(h.LineAmplitude,A);C.include(r.UnpackAttributes,A);C.include(t.LineOffset,A);C.include(d.SliceDraw,A);C.include(x.DiscardNonSilhouetteEdges,A);C.include(v.DiscardByCoverage,A);C.include(f.multipassTerrainTest,A);C.varyings.add("vColor","vec4");C.varyings.add("vRadius",
"float");C.varyings.add("vPosition","vec3");C.varyings.add("vWorldPosition","vec3");A.multipassEnabled&&C.varyings.add("vViewPos","vec3");C.varyings.add("vLineLengthPixels","float");C.varyings.add("vSizeFalloffFactor","float");E.uniforms.add(new n.Float2PassUniform("pixelToNDC",(D,F)=>a.set(y,2/F.camera.fullViewport[2],2/F.camera.fullViewport[3])),new k.Float4PassUniform("viewport",(D,F)=>F.camera.fullViewport),new g.FloatPassUniform("pixelRatio",(D,F)=>F.camera.pixelRatio));C.attributes.add(l.VertexAttribute.POSITION0,
"vec3");C.attributes.add(l.VertexAttribute.POSITION1,"vec3");C.attributes.add(l.VertexAttribute.VARIANTOFFSET,"float");C.attributes.add(l.VertexAttribute.VARIANTSTROKE,"float");C.attributes.add(l.VertexAttribute.VARIANTEXTENSION,"float");E.code.add(q.glsl`
    const float opaqueCutoff = 1.0 / 255.0;

    void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
      vec2 sideness = unpackedAttributes.sideness;
      vec2 sidenessNorm = unpackedAttributes.sidenessNorm;

      vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;

      vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
      ${A.multipassEnabled?"vViewPos \x3d viewPos;":""}

      vec4 projPosV0 = projFromViewPosition(viewPosV0);
      vec4 projPosV1 = projFromViewPosition(viewPosV1);
      vec4 projPos = projFromViewPosition(viewPos);

      vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
      vec2 ndcToPixel = viewport.zw * 0.5;
      vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * ndcToPixel;
      float lineLengthPixels = length(screenSpaceLinePixels);

      float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
      vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;

      float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * pixelRatio;
      float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;

      float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
      float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * pixelRatio;

      vSizeFalloffFactor = falloffFactor;

      float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
      float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;

      ${A.antialiasing?q.glsl`
        const float aaPaddingPixels = 1.0;

        // Line size with padding
        float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
        float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;`:q.glsl`
        float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;
        float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;`}

      // Half line width in NDC including padding for anti aliasing
      vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * pixelToNDC;
      vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * pixelToNDC;
      vec2 extensionLengthNDC = extensionLengthPixels * pixelToNDC;

      // Compute screen space position of vertex, offsetting for line size and end caps
      vec2 ndcOffset = (
          screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
        + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
      );

      projPos.xy += ndcOffset * projPos.w;
      projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;

      projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));

      // Line length with end caps
      float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;

      float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;

      // Position in pixels with origin at first vertex of line segment
      vPosition = vec3(
        halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
        pixelPositionAlongLine,
        pixelPositionAlongLine / extendedLineLengthPixels
      );

      // The line width radius in pixels
      vRadius = lineWidthPixels * 0.5;
      vLineLengthPixels = extendedLineLengthPixels;

      // discard short edges below a certain length threshold
      ${A.mode===p.EdgeUtilMode.SKETCH?q.glsl`
        if (lineLengthPixels <= 3.0) {
          gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
          return;
        }`:A.mode===p.EdgeUtilMode.MIXED?q.glsl`
        if (lineLengthPixels <= 3.0 && unpackedAttributes.type <= 0.0) {
           gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
           return;
        }`:""}
      gl_Position = projPos;
    }

    void main() {
      ComponentData component = readComponentData();
      UnpackedAttributes unpackedAttributes = unpackAttributes(component);

      vec3 worldPosV0, worldPosV1, viewPosV0, viewPosV1;
      worldAndViewFromModelPosition(position0, component.verticalOffset, worldPosV0, viewPosV0);
      worldAndViewFromModelPosition(position1, component.verticalOffset, worldPosV1, viewPosV1);

      // Component color
      vColor = component.color;

      // Discard fully transparent edges
      if (vColor.a < opaqueCutoff) {
        gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
        return;
      }

      if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {
        return;
      }

      // General geometric computation for all types of edges
      calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);

      // Specific computation for different edge styles
      calculateStyleOutputs(unpackedAttributes);
    }
  `);B.code.add(q.glsl`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float positionX = position.x - calculateLineOffset();

      if (radius < 1.0) {
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);
        return vec2(0.5 - min(coverageX, coverageY), 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${A.multipassEnabled?"terrainDepthTest(vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      fragColor = vec4(vColor.rgb, vColor.a * coverage);
    }
  `);return C}const y=c.create();class z extends m.Uniform{constructor(A){super(A,"mat4")}}c=Object.freeze(Object.defineProperty({__proto__:null,build:u},Symbol.toStringTag,{value:"Module"}));b.EdgeShader=c;b.build=u})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/AdjustProjectedPosition.glsl":function(){define("exports ../../../../../../chunks/vec2f64 ../../../core/shaderLibrary/util/IsNaN.glsl ../../../core/shaderModules/Float2PassUniform ../../../core/shaderModules/interfaces ../../../core/shaderModules/Matrix3PassUniform ../../../core/shaderModules/Matrix4PassUniform".split(" "),
function(b,a,c,d,f,n,k){const g=a.fromValues(.5,-4E-4);b.AdjustProjectedPosition=function(q,e){q=q.vertex;q.include(c.IsNaN);q.constants.add("depthBias","vec2",g);q.uniforms.add(new d.Float2PassUniform("inverseViewport",(m,l)=>l.inverseViewport));e.legacy?(q.uniforms.add(new k.Matrix4PassUniform("proj",(m,l)=>l.camera.projectionMatrix)),q.code.add(f.glsl`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = proj * localView * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)):(q.uniforms.add(new n.Matrix3PassUniform("transformNormalViewFromGlobal",m=>m.transformNormalViewFromGlobal),new k.Matrix4PassUniform("transformProjFromView",m=>m.transformProjFromView)),q.code.add(f.glsl`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = transformProjFromView * vec4(transformNormalViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`));q.code.add(f.glsl`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = depthBias.y;
return sqrt(max(projPos.z,0.0)) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/IsNaN.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(b,a){b.IsNaN=function(c){const d=a.glsl`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;c.code.add(d)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardByCoverage.glsl":function(){define(["exports","../../../core/shaderModules/interfaces"],function(b,a){b.DiscardByCoverage=function(c,d){c=c.fragment;c.constants.add("coverageTestThreshold","float",.01);d.antialiasing?c.code.add(a.glsl`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`):c.code.add(a.glsl`#define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? coverageTestThreshold : 0.75; if (coverage < coverageLimit) discard; }`)};
Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardNonSilhouetteEdges.glsl":function(){define(["exports","../../../core/shaderModules/interfaces"],function(b,a){b.DiscardNonSilhouetteEdges=function(c,d){c=c.vertex;d.silhouette?(c.code.add(a.glsl`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),d.legacy?c.code.add(a.glsl`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 viewNormalA = _modelToViewNormal(normalA);
vec3 viewNormalB = _modelToViewNormal(normalB);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`):c.code.add(a.glsl`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 worldNormalA = _modelToWorldNormal(normalA);
vec3 worldNormalB = _modelToWorldNormal(normalB);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):c.code.add(a.glsl`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
return false;
}`)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/EdgeUtil.glsl":function(){define("exports ../../../collections/Component/Material/shader/ComponentData.glsl ../../../core/shaderLibrary/util/DoublePrecision.glsl ../../../core/shaderLibrary/util/RgbaFloatEncoding.glsl ../../../core/shaderModules/Float3DrawUniform ../../../core/shaderModules/Float3PassUniform ../../../core/shaderModules/FloatPassUniform ../../../core/shaderModules/interfaces ../../../core/shaderModules/Matrix3DrawUniform ../../../core/shaderModules/Matrix3PassUniform ../../../core/shaderModules/Matrix4PassUniform ../../../core/shaderModules/Texture2DDrawUniform ../../../lib/VertexAttribute".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w){b.EdgeUtilMode=void 0;(function(v){v[v.SOLID=0]="SOLID";v[v.SKETCH=1]="SKETCH";v[v.MIXED=2]="MIXED";v[v.COUNT=3]="COUNT"})(b.EdgeUtilMode||(b.EdgeUtilMode={}));b.EdgeSilhouette=void 0;(function(v){v[v.REGULAR=0]="REGULAR";v[v.SILHOUETTE=1]="SILHOUETTE"})(b.EdgeSilhouette||(b.EdgeSilhouette={}));b.EdgeUtil=function(v,x){const p=v.vertex;p.include(d.RgbaFloatEncoding);p.uniforms.add(new k.FloatPassUniform("distanceFalloffFactor",h=>h.distanceFalloffFactor));p.code.add(g.glsl`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`);p.uniforms.add(new l.Texture2DDrawUniform("componentDataTex",h=>h.componentDataTexture));v.attributes.add(w.VertexAttribute.COMPONENTINDEX,"float");p.constants.add("componentColorFieldOffset","float",0);p.constants.add("componentOtherFieldOffset","float",1);p.constants.add("componentVerticalOffsetFieldOffset","float",2);p.constants.add("componentFieldCount","float",3);p.constants.add("lineWidthFractionFactor","float",8);p.constants.add("extensionLengthOffset","float",128);p.constants.add("verticalOffsetScale",
"float",2*a.maxElevationOffset);p.code.add(g.glsl`vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
float fieldIndex = componentFieldCount * componentIndex + fieldOffset;
float texSize = float(textureSize(componentDataTex, 0).x);
float colIndex = mod(fieldIndex, texSize);
float rowIndex = floor(fieldIndex / texSize);
return vec2(colIndex, rowIndex) + 0.5;
}
struct ComponentData {
vec4 color;
float lineWidth;
float extensionLength;
float type;
float verticalOffset;
};
ComponentData readComponentData() {
vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);
vec4 colorValue = texelFetch(componentDataTex, ivec2(colorIndex), 0);
vec4 otherValue = texelFetch(componentDataTex, ivec2(otherIndex), 0);
float verticalOffset = (rgba2float(texelFetch(componentDataTex, ivec2(verticalOffsetIndex), 0)) - 0.5) * verticalOffsetScale;
return ComponentData(
vec4(colorValue.rgb, colorValue.a * otherValue.w),
otherValue.x * (255.0 / lineWidthFractionFactor),
otherValue.y * 255.0 - extensionLengthOffset,
-(otherValue.z * 255.0) + 0.5,
verticalOffset
);
}`);x.legacy?p.code.add(g.glsl`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(p.uniforms.add(new q.Matrix3DrawUniform("transformNormalGlobalFromModel",h=>h.transformNormalGlobalFromModel)),p.code.add(g.glsl`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`));x.silhouette?(v.attributes.add(w.VertexAttribute.NORMALA,"vec3"),v.attributes.add(w.VertexAttribute.NORMALB,"vec3"),p.code.add(g.glsl`vec3 worldNormal() {
return _modelToWorldNormal(normalize(normalA + normalB));
}`)):(v.attributes.add(w.VertexAttribute.NORMAL,"vec3"),p.code.add(g.glsl`vec3 worldNormal() {
return _modelToWorldNormal(normal);
}`));x.legacy?p.code.add(g.glsl`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(p.include(c.DoublePrecision,x),p.uniforms.add(new e.Matrix3PassUniform("transformViewFromCameraRelativeRS",h=>h.transformViewFromCameraRelativeRS),new q.Matrix3DrawUniform("transformWorldFromModelRS",h=>h.transformWorldFromModelRS),new f.Float3DrawUniform("transformWorldFromModelTL",h=>h.transformWorldFromModelTL),new f.Float3DrawUniform("transformWorldFromModelTH",h=>h.transformWorldFromModelTH),new n.Float3PassUniform("transformWorldFromViewTL",h=>h.transformWorldFromViewTL),new n.Float3PassUniform("transformWorldFromViewTH",
h=>h.transformWorldFromViewTH)),p.code.add(g.glsl`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${x.spherical?g.glsl`normalize(transformWorldFromModelTL + rotatedModelPosition);`:g.glsl`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `));p.uniforms.add(new m.Matrix4PassUniform("transformProjFromView",(h,t)=>t.camera.projectionMatrix));p.code.add(g.glsl`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`);p.code.add(g.glsl`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)};b.usesSketchLogic=function(v){return v.mode===b.EdgeUtilMode.SKETCH||v.mode===b.EdgeUtilMode.MIXED};b.usesSolidLogic=function(v){return v.mode===b.EdgeUtilMode.SOLID||v.mode===b.EdgeUtilMode.MIXED};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/LineAmplitude.glsl":function(){define(["exports","../../../core/shaderModules/FloatDrawUniform","../../../core/shaderModules/interfaces","./EdgeUtil.glsl","./UnpackAttributes.glsl"],
function(b,a,c,d,f){b.LineAmplitude=function(n,k){const g=n.vertex;n.include(f.UnpackAttributes,k);switch(k.mode){case d.EdgeUtilMode.SOLID:g.code.add(c.glsl`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case d.EdgeUtilMode.SKETCH:g.uniforms.add(new a.FloatDrawUniform("strokesAmplitude",q=>q.strokesTexture.amplitude));g.code.add(c.glsl`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return strokesAmplitude;
}`);break;case d.EdgeUtilMode.MIXED:g.uniforms.add(new a.FloatDrawUniform("strokesAmplitude",q=>q.strokesTexture.amplitude)),g.code.add(c.glsl`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return strokesAmplitude;
}
else {
return 0.0;
}
}`)}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/UnpackAttributes.glsl":function(){define(["exports","../../../../../../core/compilerUtils","../../../core/shaderModules/interfaces","../../../lib/VertexAttribute","./EdgeUtil.glsl"],function(b,a,c,d,f){b.UnpackAttributes=function(n,k){const g=n.vertex;n.attributes.add(d.VertexAttribute.SIDENESS,"vec2");k.mode===f.EdgeUtilMode.MIXED?g.code.add(c.glsl`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`):g.code.add(c.glsl`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`);switch(k.mode){case f.EdgeUtilMode.MIXED:g.code.add(c.glsl`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case f.EdgeUtilMode.SKETCH:g.code.add(c.glsl`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case f.EdgeUtilMode.SOLID:g.code.add(c.glsl`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case f.EdgeUtilMode.COUNT:break;default:a.neverReached(k.mode)}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/LineOffset.glsl":function(){define("exports ../../../core/shaderLibrary/util/RgbaFloatEncoding.glsl ../../../core/shaderModules/FloatDrawUniform ../../../core/shaderModules/interfaces ../../../core/shaderModules/Texture2DDrawUniform ./EdgeUtil.glsl ./UnpackAttributes.glsl".split(" "),function(b,a,c,d,f,n,
k){class g extends d.NoParameters{}b.LineOffset=function(q,e){q.include(k.UnpackAttributes,e);const {vertex:m,fragment:l}=q;n.usesSketchLogic(e)&&(m.uniforms.add(new f.Texture2DDrawUniform("strokesTexture",w=>w.strokesTexture.texture)),m.uniforms.add(new c.FloatDrawUniform("strokesLog2Resolution",w=>Math.log2(w.strokesTexture.resolution)),new c.FloatDrawUniform("strokeVariants",w=>w.strokesTexture.variants)),q.varyings.add("vStrokeUV","vec2"),l.uniforms.add(new f.Texture2DDrawUniform("strokesTexture",
w=>w.strokesTexture.texture),new c.FloatDrawUniform("strokesNormalizationScale",w=>w.strokesTexture.normalizationScale)),m.code.add(d.glsl`void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
float lineIndex = clamp(ceil(log2(lineLength)), 0.0, strokesLog2Resolution);
vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * strokeVariants + variantStroke + 0.5) / vec2(textureSize(strokesTexture, 0));
vStrokeUV.x += variantOffset;
}`),q.fragment.include(a.RgbaFloatEncoding),l.code.add(d.glsl`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture(strokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * strokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture(strokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`));switch(e.mode){case n.EdgeUtilMode.SOLID:m.code.add(d.glsl`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`);l.code.add(d.glsl`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case n.EdgeUtilMode.SKETCH:m.code.add(d.glsl`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`);l.code.add(d.glsl`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case n.EdgeUtilMode.MIXED:q.varyings.add("vType","float"),m.code.add(d.glsl`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),l.code.add(d.glsl`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}};b.LineOffsetDrawParameters=g;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeShaderTechniqueConfiguration":function(){define(["exports","../../../../../chunks/tslib.es6","../../core/shaderTechnique/ShaderTechniqueConfiguration","../../materials/DefaultTechniqueConfiguration","../../shaders/sources/edgeRenderer/EdgeUtil.glsl"],function(b,a,c,d,f){class n extends d.DefaultTechniqueConfiguration{constructor(){super(...arguments);
this.mode=f.EdgeUtilMode.SOLID;this.spherical=this.cullAboveGround=this.multipassEnabled=this.doublePrecisionRequiresObfuscation=this.antialiasing=this.legacy=this.silhouette=this.hasSlicePlane=!1}}a.__decorate([c.parameter({count:f.EdgeUtilMode.COUNT})],n.prototype,"mode",void 0);a.__decorate([c.parameter()],n.prototype,"hasSlicePlane",void 0);a.__decorate([c.parameter()],n.prototype,"silhouette",void 0);a.__decorate([c.parameter()],n.prototype,"legacy",void 0);a.__decorate([c.parameter()],n.prototype,
"antialiasing",void 0);a.__decorate([c.parameter()],n.prototype,"doublePrecisionRequiresObfuscation",void 0);a.__decorate([c.parameter()],n.prototype,"multipassEnabled",void 0);a.__decorate([c.parameter()],n.prototype,"cullAboveGround",void 0);a.__decorate([c.parameter()],n.prototype,"spherical",void 0);a.__decorate([c.parameter({constValue:!1})],n.prototype,"occlusionPass",void 0);b.EdgeShaderTechniqueConfiguration=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeWorkerHandle":function(){define(["exports",
"../../../../../core/typedArrayUtil","../../../../../core/workers/WorkerHandle","../../../support/buffer/workerHelper","./edgeProcessing"],function(b,a,c,d,f){class n extends c.WorkerHandle{constructor(g){super("EdgeProcessingWorker","extract",{extract:q=>[q.dataBuffer],extractComponentsEdgeLocations:q=>[q.dataBuffer],extractEdgeLocations:q=>[q.dataBuffer]},g)}async process(g,q,e){if(e)return f.extract(g);g=await this.invoke(new k(g),q);return this._unpackOutput(g)}async extractEdgeLocations(g,q){g=
await this.invokeMethod("extractEdgeLocations",new k(g),q);return d.unpackInterleavedBuffer(g)}async extractComponentsEdgeLocations(g,q){g=await this.invokeMethod("extractComponentsEdgeLocations",new k(g),q);return d.unpackInterleavedBuffer(g)}_unpackOutput(g){return{regular:{instancesData:d.unpackInterleavedBuffer(g.regular.instancesData),lodInfo:{lengths:new Float32Array(g.regular.lodInfo.lengths)}},silhouette:{instancesData:d.unpackInterleavedBuffer(g.silhouette.instancesData),lodInfo:{lengths:new Float32Array(g.silhouette.lodInfo.lengths)}},
averageEdgeLength:g.averageEdgeLength}}}class k{constructor(g){this.dataBuffer=g.data.buffer;this.writerSettings=g.writerSettings;this.skipDeduplicate=g.skipDeduplicate;this.indices=a.isArray(g.indices)?g.indices:g.indices.buffer;this.indicesType=a.isArray(g.indices)?"Array":a.isUint32Array(g.indices)?"Uint32Array":"Uint16Array";this.indicesLength=g.indicesLength}}b.EdgeWorkerHandle=n;b.PackedInput=k;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/buffer/workerHelper":function(){define(["exports",
"./InterleavedLayout"],function(b,a){b.packInterleavedBuffer=function(c,d){d.push(c.buffer);return{buffer:c.buffer,layout:new a.PackedLayout(c.layout)}};b.unpackInterleavedBuffer=function(c){return(new a.InterleavedLayout(c.layout)).createView(c.buffer)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/strokes":function(){define(["exports","../../../../../core/floatRGBA","../../../../../core/maybe","../../../../webgl/Texture","../../../../webgl/TextureDescriptor"],
function(b,a,c,d,f){function n(e,m){if(!e)return null;var l=e.length/2;const w=.1*l;l=Array(l);let v=0;m=m===k.PRESSURE;for(let x=0;x<e.length;x+=2){const p=(e[x]+e[x+1])/2;m?l[v++]=Math.min(w,1-.5*(1-p)):l[v++]=Math.min(w,.5*p)}return l}var k;(function(e){e[e.DISTANCE=0]="DISTANCE";e[e.PRESSURE=1]="PRESSURE"})(k||(k={}));class g{constructor(e,m,l,w,v){this.resolution=e;this.normalizationScale=m;this.amplitude=l;this.variants=w;this.texture=v}dispose(){this.texture=c.disposeMaybe(this.texture)}}const q=
{amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,
-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,
.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,
-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,
.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,
.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,
.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,
-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,
-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,
1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,
.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,
-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,
.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,
.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,
.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,
.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,
4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,
3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,
1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-7.6E-4,2.7E-4,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],
pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,
.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,
.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,
.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,
2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,
-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,
.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,
2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,
.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,
.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,
.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,
-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,
.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,
.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,
-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,
.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,
.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,
.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,
.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,
6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,
.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,
-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,
3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,
.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,
.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,
.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};b.StrokesTexture=g;b.generateStrokesTexture=function(e){const m=q.resolution;var l=m/2;const w=new Uint8Array(4*
m*m),v=4*m*l;l=q.amplitude;const x=2*l,p=4*m,h=Math.log2(m)+1,t=q.strokes.length;let r=(h-1)*t*p;for(const {distance:u,pressure:y}of q.strokes){let z=u,A=y,C=r;for(let E=0;E<h;E++){0!==E&&(z=n(z,k.DISTANCE),A=n(A,k.PRESSURE));for(let B=0;B<q.resolution;B++){const D=A?A[B%A.length]:1;a.packFloatRGBA((z?z[B%z.length]/x:0)+.5,w,C);a.packFloatRGBA(D,w,C+v);C+=4}C-=p*(t+1)}r+=p}e=new d.Texture(e,new f.TextureDescriptor(m),w);return new g(m,x,l,t,e)};b.strokesDefinition=q;Object.defineProperty(b,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/util":function(){define(["exports","./interfaces"],function(b,a){b.determineEdgeTransparency=function(c){let d=a.Transparency.INVISIBLE;for(const {material:f}of c)if(0<f.size*f.color[3]*f.opacity){if(1>f.color[3]*f.opacity)return a.Transparency.TRANSPARENT;d=a.Transparency.OPAQUE}return d};b.determineObjectTransparency=function(c){let d=a.Transparency.INVISIBLE;for(const {material:f}of c)if(0<f.size*f.color[3]*f.opacity){switch(f.objectTransparency){case a.Transparency.TRANSPARENT:case a.Transparency.INVISIBLE:return a.Transparency.TRANSPARENT;
case a.Transparency.OPAQUE:if(1>f.opacity)return a.Transparency.TRANSPARENT}d=a.Transparency.OPAQUE}return d};b.determineRendererType=function(c){let d=null;for(const f of c)if(c=f.type,0<f.size*f.color[3])if(null==d)d=c;else if(d!==c)return"uber";return null!=d?d:"uber"};b.fillComponenBufferIndices=function(c,d,f,n){for(let g=0;g<c.length;g++){const q=c[g].index;var k=d[g];const e=d[g+1];if(n)for(;k<e;k++)f.set(n[k],q);else for(;k<e;k++)f.set(k,q)}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/statistics/RendererPerformanceInfo":function(){define(["exports","../../../../core/maybe","../../../../core/PerformanceSampler","../../../../core/time","../../../webgl/TimerPool"],function(b,a,c,d,f){b.PerformanceCategory=void 0;(function(k){k.OVERLAY="overlay";k.PREPARE="prepare";k.SHADOW_MAP="shadow map";k.LINEAR_DEPTH="linear depth";k.ACCUMULATED_SHADOWS="accumulated shadows";k.OBJECT_AND_LAYER_ID_COLOR="object/layer id color";k.SSAO="SSAO";k.OPAQUE="opaque";k.OPAQUE_EDGES=
"opaque edges";k.VOXEL="voxel";k.TRANSPARENT="transparent";k.TRANSPARENT_EDGES="transparent edges";k.HUD_VISIBILITY="HUD visibility";k.TRANSPARENT_TERRAIN="transparent terrain";k.ENVIRONMENT="environment";k.LASER_LINES="laser lines";k.OCCLUDED="occluded";k.ANTIALIASING="antialiasing";k.HIGHLIGHTS="highlights";k.HUD="HUD";k.HUD_OCCLUDED="HUD occluded";k.FINISH="finish"})(b.PerformanceCategory||(b.PerformanceCategory={}));class n{constructor(k){this._rctx=k;this._startTimeStampCPU=d.Milliseconds(0);
this._lastTimeStampCPU=d.Milliseconds(0);this._totalCPUTime=new c("Total");this._cpuTimeSamplers=new Map(Object.values(b.PerformanceCategory).map(g=>[g,new c(g)]));this._enableGPUTimer=0;this._totalGPUTime=new c("GPU");this._gpuTimeSamplers=new Map(Object.values(b.PerformanceCategory).map(g=>[g,new c(g)]));this._totalTime=d.Milliseconds(0);this._totalFrameCount=0}get totalCPUTimeSampler(){return this._totalCPUTime}get cpuTimeSamplers(){return Array.from(this._cpuTimeSamplers.values())}get totalGPUTimeSampler(){return this._totalGPUTime}get gpuTimeSamplers(){return Array.from(this._gpuTimeSamplers.values())}get gpuSamplingEnabled(){return null!=
this._gpuTimerPool}get totalTime(){return this._totalTime}get totalFrameCount(){return this._totalFrameCount}get elapsedTime(){return d.Milliseconds(performance.now()-this._startTimeStampCPU)}enableGPUPerformanceInfo(){if(null==this._gpuTimerPool){const g=[...Object.values(b.PerformanceCategory),"Total"];this._gpuTimerPool=f.createElapsedTimerPool(this._rctx,g)}if(null==this._gpuTimerPool)return{hasGPUTimerSupport:!1,remove:()=>{}};++this._enableGPUTimer;let k=!1;return{hasGPUTimerSupport:!0,remove:()=>
{k||(k=!0,--this._enableGPUTimer,0===this._enableGPUTimer&&(this._gpuTimerPool=a.disposeMaybe(this._gpuTimerPool)))}}}startFrame(){this._startTimeStampCPU=this._lastTimeStampCPU=d.Milliseconds(performance.now());this._gpuTimerPool&&this._gpuTimerPool.start()}advance(k){var g=d.Milliseconds(performance.now());this._cpuTimeSamplers.get(k).record(g-this._lastTimeStampCPU);this._lastTimeStampCPU=g;this._gpuTimerPool&&(g=this._gpuTimerPool.stop(k),this._gpuTimeSamplers.get(k).record(g),this._gpuTimerPool.start())}finishFrame(){if(this._gpuTimerPool){var k=
this._gpuTimerPool.stop(b.PerformanceCategory.FINISH);this._gpuTimeSamplers.get(b.PerformanceCategory.FINISH).record(k);this._rctx.gl.flush()}k=d.Milliseconds(performance.now()-this._startTimeStampCPU);this._totalTime=d.Milliseconds(this._totalTime+k);this._totalCPUTime.record(k);this._gpuTimerPool&&this._totalGPUTime.record(this.gpuTimeSamplers.reduce((g,q)=>g+(q.last||0),0));++this._totalFrameCount}}b.RendererPerformanceInfo=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/TimerPool":function(){define(["exports",
"./capabilities/DisjointTimerQuery"],function(b,a){class c{constructor(d,f){this._timer=d;this._queryPool=[];this._queryResults=new Map;this._currentQuery=null;f.forEach(n=>{const k=this._timer.createQuery(),g=this._timer.createQuery();this._queryPool.push(k,g);this._queryResults.set(n,null)})}start(){a.hasRunningElapsedTimer||(this._currentQuery=this._queryPool.pop(),null!=this._currentQuery&&(this._timer.disjoint(),this._timer.beginTimeElapsed(this._currentQuery)))}stop(d){if(this._timer.disjoint()||
null==this._currentQuery||!this._queryResults.has(d))return this.abort(),null;this._timer.endTimeElapsed();const f=this._queryResults.get(d);if(null==f)return this._queryResults.set(d,this._currentQuery),this._currentQuery=null;if(!this._timer.resultAvailable(f))return this._queryPool.unshift(this._currentQuery),this._currentQuery=null;const n=this._timer.getResult(f)/1E6;this._queryPool.unshift(f);this._queryResults.set(d,this._currentQuery);this._currentQuery=null;return n}abort(){null!=this._currentQuery&&
(this._timer.deleteQuery(this._currentQuery),this._queryPool.unshift(this._timer.createQuery()),this._currentQuery=null)}dispose(){null!=this._currentQuery&&this._timer.deleteQuery(this._currentQuery);this._queryPool.forEach(d=>{this._timer.deleteQuery(d)});this._queryResults.forEach(d=>{null!=d&&this._timer.deleteQuery(d)})}}b.createElapsedTimerPool=function(d,f){d=d.capabilities.disjointTimerQuery;return null==d?null:new c(d,f)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/DisjointTimerQuery":function(){define(["exports",
"./isWebGL2Context"],function(b,a){class c{constructor(d,f,n,k,g,q,e,m,l){this.createQuery=d;this.deleteQuery=f;this.resultAvailable=n;this.getResult=k;this.disjoint=g;this.beginTimeElapsed=q;this.endTimeElapsed=e;this.createTimestamp=m;this.timestampBits=l}}b.hasRunningElapsedTimer=!1;b.DisjointTimerQuery=c;b.createDisjointTimerQuery=function(d,f){if(f.disjointTimerQuery)return null;let n=d.getExtension("EXT_disjoint_timer_query_webgl2");return n&&a(d)?new c(()=>d.createQuery(),k=>{d.deleteQuery(k);
b.hasRunningElapsedTimer=!1},k=>d.getQueryParameter(k,d.QUERY_RESULT_AVAILABLE),k=>d.getQueryParameter(k,d.QUERY_RESULT),()=>d.getParameter(n.GPU_DISJOINT_EXT),k=>{b.hasRunningElapsedTimer||(b.hasRunningElapsedTimer=!0,d.beginQuery(n.TIME_ELAPSED_EXT,k))},()=>{d.endQuery(n.TIME_ELAPSED_EXT);b.hasRunningElapsedTimer=!1},k=>n.queryCounterEXT(k,n.TIMESTAMP_EXT),()=>d.getQuery(n.TIMESTAMP_EXT,n.QUERY_COUNTER_BITS_EXT)):(n=d.getExtension("EXT_disjoint_timer_query"))?new c(()=>n.createQueryEXT(),k=>{n.deleteQueryEXT(k);
b.hasRunningElapsedTimer=!1},k=>n.getQueryObjectEXT(k,n.QUERY_RESULT_AVAILABLE_EXT),k=>n.getQueryObjectEXT(k,n.QUERY_RESULT_EXT),()=>d.getParameter(n.GPU_DISJOINT_EXT),k=>{b.hasRunningElapsedTimer||(b.hasRunningElapsedTimer=!0,n.beginQueryEXT(n.TIME_ELAPSED_EXT,k))},()=>{n.endQueryEXT(n.TIME_ELAPSED_EXT);b.hasRunningElapsedTimer=!1},k=>n.queryCounterEXT(k,n.TIMESTAMP_EXT),()=>n.getQueryEXT(n.TIMESTAMP_EXT,n.QUERY_COUNTER_BITS_EXT)):null};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/views/webgl/capabilities/isWebGL2Context":function(){define(function(){return function(b){return window.WebGL2RenderingContext&&b instanceof window.WebGL2RenderingContext}})},"esri/views/3d/webgl-engine/lib/RenderingContext":function(){define(["exports","../effects/ScreenSpaceGeometry","../../../webgl/AppleAmdDriverHelper","../../../webgl/RenderingContext"],function(b,a,c,d){class f extends d.RenderingContext{constructor(n,k,g){super(n,k);this.gl=n;this.newCache=g;this._appleAmdDriverHelper=
null;this._refCount=1;this.screen=new a.ScreenSpaceGeometry(this)}destroy(){0<--this._refCount||this.dispose()}ref(){++this._refCount}dispose(){super.dispose();this._appleAmdDriverHelper?.dispose();this.screen.destroy()}bindTechnique(n,k,g,q){this.useProgram(n.program);this.setPipelineState(n.getPipeline(!!q));n.program.bindPass(k,g);return n.program}runAppleAmdDriverHelper(){this.driverTest.drawArraysRequiresIndicesTypeReset.result&&(this._appleAmdDriverHelper??(this._appleAmdDriverHelper=new c.AppleAmdDriverHelper(this)),
this._appleAmdDriverHelper.run())}get test(){return{cachedWebGLObjects:this.programCache.test.cachedWebGLProgramObjects+this.screen.test.cachedWebGLObjects+(this._appleAmdDriverHelper?.test.cachedWebGLObjects??0)}}}b.RenderingContext=f;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/ScreenSpaceGeometry":function(){define(["exports","../../../../core/maybe","../lib/glUtil3D","../../../webgl/enums"],function(b,a,c,d){class f{constructor(n){this._rctx=
n;this._vao=c.createScreenSizeTriangleVAO(n)}destroy(){this._vao=a.disposeMaybe(this._vao)}draw(){null!=this._vao&&(this._rctx.bindVAO(this._vao),this._rctx.drawArrays(d.PrimitiveType.TRIANGLES,0,3))}get test(){return{cachedWebGLObjects:(null!=this._vao?.glName?1:0)+(null!=this._vao?.indexBuffer?.glName?1:0)+(null!=this._vao?.vertexBuffers.geometry?1:0)}}}b.ScreenSpaceGeometry=f;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/AppleAmdDriverHelper":function(){define(["exports",
"./BufferObject","./enums"],function(b,a,c){class d{constructor(f){this._rctx=f;this._indexBuffer=this._createIndexbuffer();this._program=this._createHelperProgram()}static getShaderSources(){return{vertex:"#version 300 es\n    precision highp float;\n\n    void main(void) {\n      gl_Position \x3d vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);\n    }",fragment:"#version 300 es\n    precision highp float;\n\n    out vec4 fragColor;\n\n    void main(void) {\n      fragColor \x3d vec4(0.0, 0.0, 0.0, 1.0);\n    }"}}_createHelperProgram(){const f=
d.getShaderSources();return this._rctx.programCache.acquire(f.vertex,f.fragment,new Map([]))}_createIndexbuffer(){return a.BufferObject.createIndex(this._rctx,c.Usage.STATIC_DRAW,new Uint32Array([0]))}run(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,c.BufferType.ELEMENT_ARRAY_BUFFER),this._rctx.drawElements(c.PrimitiveType.POINTS,1,c.DataType.UNSIGNED_INT,0))}dispose(){this._program.dispose();this._indexBuffer.dispose()}get test(){return{cachedWebGLObjects:this._indexBuffer?.glName?
1:0}}}b.AppleAmdDriverHelper=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/RenderingContext":function(){define("exports ../../core/maybe ../../core/promiseUtils ../../core/time ./checkWebGLError ./ContextState ./contextUtils ./enums ./InstanceCounter ./Parameters ./ProgramCache ./renderState ./Texture ./Util ./WebGLDriverTest ./capabilities/Capabilities ./capabilities/isWebGL2Context".split(" "),function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h){function t(u,y,z,A){y?
A!==y&&u.bindBuffer(z,y.glName):u.bindBuffer(z,null);return y}function r(u,y){switch(u){case g.PrimitiveType.POINTS:return 2*y;case g.PrimitiveType.TRIANGLES:return y/3;case g.PrimitiveType.TRIANGLE_STRIP:return y-2;case g.PrimitiveType.TRIANGLE_FAN:return y-2;default:return 0}}b.RenderingContext=class{constructor(u,y){this.gl=u;this.instanceCounter=new q.InstanceCounter;this.programCache=new m.ProgramCache(this);this._state=new n.ContextState;this._numOfTriangles=this._numOfDrawCalls=0;this.type=
h(u)?k.ContextType.WEBGL2:k.ContextType.WEBGL1;this._loadExtensions();this.configure(y)}get gl2(){return this.type===k.ContextType.WEBGL1?null:this.gl}configure(u){this._capabilities=new p.Capabilities(this.gl,u);this._parameters=new e.Parameters(this.gl,this._capabilities,u);w.Texture.TEXTURE_UNIT_FOR_UPDATES=this._parameters.maxTextureImageUnits-1;u=this.gl.getParameter(this.gl.VIEWPORT);this._state=new n.ContextState;this._state.viewport={x:u[0],y:u[1],width:u[2],height:u[3]};this._stateTracker=
new l.StateTracker({setBlending:y=>{y?(this.setBlendingEnabled(!0),this.setBlendEquationSeparate(y.opRgb,y.opAlpha),this.setBlendFunctionSeparate(y.srcRgb,y.dstRgb,y.srcAlpha,y.dstAlpha),y=y.color,this.setBlendColor(y.r,y.g,y.b,y.a)):this.setBlendingEnabled(!1)},setCulling:y=>{y?(this.setFaceCullingEnabled(!0),this.setCullFace(y.face),this.setFrontFace(y.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:y=>{y?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(y.factor,y.units)):this.setPolygonOffsetFillEnabled(!1)},
setDepthTest:y=>{y?(this.setDepthTestEnabled(!0),this.setDepthFunction(y.func)):this.setDepthTestEnabled(!1)},setStencilTest:y=>{if(y){this.setStencilTestEnabled(!0);const z=y.function;this.setStencilFunction(z.func,z.ref,z.mask);y=y.operation;this.setStencilOp(y.fail,y.zFail,y.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:y=>{y?(this.setDepthWriteEnabled(!0),this.setDepthRange(y.zNear,y.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:y=>{y?this.setColorMask(y.r,y.g,y.b,y.a):this.setColorMask(!1,
!1,!1,!1)},setStencilWrite:y=>{y?this.setStencilWriteMask(y.mask):this.setStencilWriteMask(0)},setDrawBuffers:y=>{const {drawBuffers:z}=this._capabilities;y?z?.drawBuffers(y.buffers):({drawFramebuffer:y}=this._state,null===y||0===y.colorAttachments.length?z?.drawBuffers([g.SpecialDrawBuffers.BACK]):z?.drawBuffers([g.ColorAttachment.COLOR_ATTACHMENT0]))}});this.enforceState();a.disposeMaybe(this._driverTest);this._driverTest=new x.WebGLDriverTest(this)}dispose(){a.disposeMaybe(this._driverTest);this.programCache.dispose();
this.bindVAO(null);this.unbindBuffer(g.BufferType.ARRAY_BUFFER);this.unbindBuffer(g.BufferType.ELEMENT_ARRAY_BUFFER);this.type===k.ContextType.WEBGL2&&(this.unbindBuffer(g.BufferType.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(g.BufferType.PIXEL_PACK_BUFFER),this.unbindBuffer(g.BufferType.PIXEL_UNPACK_BUFFER),this.unbindBuffer(g.BufferType.COPY_READ_BUFFER),this.unbindBuffer(g.BufferType.COPY_WRITE_BUFFER));this._state.textureUnitMap.length=0;f.webglDebugEnabled()&&
console.log(this.instanceCounter.resourceInformation)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}setPipelineState(u){this._stateTracker.setPipeline(u)}setBlendingEnabled(u){this._state.blend!==u&&(!0===u?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=u,this._stateTracker.invalidateBlending())}externalProgramUpdate(){this._state.program?.stop();this._state.program=null}externalTextureUnitUpdate(u,
y){for(let z=0;z<u.length;++z)this._state.textureUnitMap[u[z]]=null;0<=y&&(this._state.activeTexture=y)}externalVertexArrayObjectUpdate(){const u=this.capabilities.vao;u&&(u.bindVertexArray(null),this._state.vertexArrayObject=null);this._state.vertexBuffer=null;this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(u,y,z,A){if(u!==this._state.blendColor.r||y!==this._state.blendColor.g||z!==this._state.blendColor.b||
A!==this._state.blendColor.a)this.gl.blendColor(u,y,z,A),this._state.blendColor.r=u,this._state.blendColor.g=y,this._state.blendColor.b=z,this._state.blendColor.a=A,this._stateTracker.invalidateBlending()}setBlendFunction(u,y){if(u!==this._state.blendFunction.srcRGB||y!==this._state.blendFunction.dstRGB)this.gl.blendFunc(u,y),this._state.blendFunction.srcRGB=u,this._state.blendFunction.srcAlpha=u,this._state.blendFunction.dstRGB=y,this._state.blendFunction.dstAlpha=y,this._stateTracker.invalidateBlending()}setBlendFunctionSeparate(u,
y,z,A){if(this._state.blendFunction.srcRGB!==u||this._state.blendFunction.srcAlpha!==z||this._state.blendFunction.dstRGB!==y||this._state.blendFunction.dstAlpha!==A)this.gl.blendFuncSeparate(u,y,z,A),this._state.blendFunction.srcRGB=u,this._state.blendFunction.srcAlpha=z,this._state.blendFunction.dstRGB=y,this._state.blendFunction.dstAlpha=A,this._stateTracker.invalidateBlending()}setBlendEquation(u){this._state.blendEquation.mode!==u&&(this.gl.blendEquation(u),this._state.blendEquation.mode=u,this._state.blendEquation.modeAlpha=
u,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(u,y){if(this._state.blendEquation.mode!==u||this._state.blendEquation.modeAlpha!==y)this.gl.blendEquationSeparate(u,y),this._state.blendEquation.mode=u,this._state.blendEquation.modeAlpha=y,this._stateTracker.invalidateBlending()}setColorMask(u,y,z,A){if(this._state.colorMask.r!==u||this._state.colorMask.g!==y||this._state.colorMask.b!==z||this._state.colorMask.a!==A)this.gl.colorMask(u,y,z,A),this._state.colorMask.r=u,this._state.colorMask.g=
y,this._state.colorMask.b=z,this._state.colorMask.a=A,this._stateTracker.invalidateColorWrite()}setClearColor(u,y,z,A){if(this._state.clearColor.r!==u||this._state.clearColor.g!==y||this._state.clearColor.b!==z||this._state.clearColor.a!==A)this.gl.clearColor(u,y,z,A),this._state.clearColor.r=u,this._state.clearColor.g=y,this._state.clearColor.b=z,this._state.clearColor.a=A}setFaceCullingEnabled(u){this._state.faceCulling!==u&&(!0===u?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),
this._state.faceCulling=u,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(u){this._state.polygonOffsetFill!==u&&(!0===u?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=u,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(u,y){if(this._state.polygonOffset[0]!==u||this._state.polygonOffset[1]!==y)this._state.polygonOffset[0]=u,this._state.polygonOffset[1]=y,this.gl.polygonOffset(u,y),this._stateTracker.invalidatePolygonOffset()}setCullFace(u){this._state.cullFace!==
u&&(this.gl.cullFace(u),this._state.cullFace=u,this._stateTracker.invalidateCulling())}setFrontFace(u){this._state.frontFace!==u&&(this.gl.frontFace(u),this._state.frontFace=u,this._stateTracker.invalidateCulling())}setScissorTestEnabled(u){this._state.scissorTest!==u&&(!0===u?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=u)}setScissorRect(u,y,z,A){if(this._state.scissorRect.x!==u||this._state.scissorRect.y!==y||this._state.scissorRect.width!==
z||this._state.scissorRect.height!==A)this.gl.scissor(u,y,z,A),this._state.scissorRect.x=u,this._state.scissorRect.y=y,this._state.scissorRect.width=z,this._state.scissorRect.height=A}setDepthTestEnabled(u){this._state.depthTest!==u&&(!0===u?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=u,this._stateTracker.invalidateDepthTest())}setClearDepth(u){this._state.clearDepth!==u&&(this.gl.clearDepth(u),this._state.clearDepth=u)}setDepthFunction(u){this._state.depthFunction!==
u&&(this.gl.depthFunc(u),this._state.depthFunction=u,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(u){this._state.depthWrite!==u&&(this.gl.depthMask(u),this._state.depthWrite=u,this._stateTracker.invalidateDepthWrite())}setDepthRange(u,y){if(this._state.depthRange.zNear!==u||this._state.depthRange.zFar!==y)this.gl.depthRange(u,y),this._state.depthRange.zNear=u,this._state.depthRange.zFar=y,this._stateTracker.invalidateDepthWrite()}setStencilTestEnabled(u){this._state.stencilTest!==
u&&(!0===u?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=u,this._stateTracker.invalidateStencilTest())}setClearStencil(u){u!==this._state.clearStencil&&(this.gl.clearStencil(u),this._state.clearStencil=u)}setStencilFunction(u,y,z){if(this._state.stencilFunction.func!==u||this._state.stencilFunction.ref!==y||this._state.stencilFunction.mask!==z)this.gl.stencilFunc(u,y,z),this._state.stencilFunction.face=g.Face.FRONT_AND_BACK,this._state.stencilFunction.func=
u,this._state.stencilFunction.ref=y,this._state.stencilFunction.mask=z,this._stateTracker.invalidateStencilTest()}setStencilFunctionSeparate(u,y,z,A){if(this._state.stencilFunction.face!==u||this._state.stencilFunction.func!==y||this._state.stencilFunction.ref!==z||this._state.stencilFunction.mask!==A)this.gl.stencilFuncSeparate(u,y,z,A),this._state.stencilFunction.face=u,this._state.stencilFunction.func=y,this._state.stencilFunction.ref=z,this._state.stencilFunction.mask=A,this._stateTracker.invalidateStencilTest()}setStencilWriteMask(u){this._state.stencilWriteMask!==
u&&(this.gl.stencilMask(u),this._state.stencilWriteMask=u,this._stateTracker.invalidateStencilWrite())}setStencilOp(u,y,z){if(this._state.stencilOperation.face!==g.Face.FRONT_AND_BACK||this._state.stencilOperation.fail!==u||this._state.stencilOperation.zFail!==y||this._state.stencilOperation.zPass!==z)this.gl.stencilOp(u,y,z),this._state.stencilOperation.face=g.Face.FRONT_AND_BACK,this._state.stencilOperation.fail=u,this._state.stencilOperation.zFail=y,this._state.stencilOperation.zPass=z,this._stateTracker.invalidateStencilTest()}setStencilOpSeparate(u,
y,z,A){if(this._state.stencilOperation.face!==u||this._state.stencilOperation.fail!==y||this._state.stencilOperation.zFail!==z||this._state.stencilOperation.zPass!==A)this.gl.stencilOpSeparate(u,y,z,A),this._state.stencilOperation.face=u,this._state.stencilOperation.fail=y,this._state.stencilOperation.zFail=z,this._state.stencilOperation.zPass=A,this._stateTracker.invalidateStencilTest()}setActiveTexture(u,y=!1){const z=this._state.activeTexture;0<=u&&(y||u!==this._state.activeTexture)&&(this.gl.activeTexture(g.baseTextureUnit+
u),this._state.activeTexture=u);return z}clear(u){u&&this.gl.clear(u)}clearSafe(u,y=255){u&&(u&g.ClearBufferBit.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),u&g.ClearBufferBit.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),u&g.ClearBufferBit.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(y),this.gl.clear(u))}drawArrays(u,y,z){f.webglDebugEnabled()&&(this._numOfDrawCalls++,this._numOfTriangles+=r(u,z));this.gl.drawArrays(u,y,z);f.checkWebGLError(this.gl)}drawArraysInstanced(u,y,z,A){this.gl2?.drawArraysInstanced(u,
y,z,A);f.checkWebGLError(this.gl)}drawElements(u,y,z,A){f.webglDebugEnabled()&&(this._numOfDrawCalls++,this._numOfTriangles+=r(u,y));this.gl.drawElements(u,y,z,A);if(f.webglDebugEnabled()){const C=v.getErrorString(this);if(C){const E=this.getBoundVAO(),B=E?.indexBuffer,D=B?.size??0,F=A+y;console.error(`drawElements: ${C}${D<F?`. Buffer is too small. Attempted to draw index ${F} of ${D}`:""}`,{args:{mode:u,count:y,type:z,offset:A},vao:{indexBuffer:B,vertexBuffers:E?.vertexBuffers}})}}}logInfo(){f.webglDebugEnabled()&&
console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){f.webglDebugEnabled()&&(this._numOfTriangles=this._numOfDrawCalls=0)}get capabilities(){return this._capabilities}setViewport(u,y,z,A){z=Math.max(Math.round(z),1);A=Math.max(Math.round(A),1);const C=this._state.viewport;if(C.x!==u||C.y!==y||C.width!==z||C.height!==A)C.x=u,C.y=y,C.width=z,C.height=A,this.gl.viewport(u,y,z,A)}setViewport4fv(u){this.setViewport(u[0],u[1],u[2],u[3])}getViewport(){const u=
this._state.viewport;return{x:u.x,y:u.y,width:u.width,height:u.height}}useProgram(u){this._state.program!==u&&(this._state.program?.stop(),this._state.program=u,this.gl.useProgram(u?.glName??null))}bindTexture(u,y,z=!1){(y>=this.parameters.maxTextureImageUnits||0>y)&&console.error("Input texture unit is out of range of available units!");const A=this._state.textureUnitMap[y];if(null==u?.glName)return null!=A&&(this.setActiveTexture(y,z),this.gl.bindTexture(A.descriptor.target,null)),this._state.textureUnitMap[y]=
null,A;if(!z&&A===u)return u.isDirty&&(this.setActiveTexture(y,z),u.applyChanges()),A;this.setActiveTexture(y,z);this.gl.bindTexture(u.descriptor.target,u.glName);u.applyChanges();this._state.textureUnitMap[y]=u;return A}unbindTexture(u){if(null!=u)for(let y=0;y<this.parameters.maxTextureImageUnits;y++)this._state.textureUnitMap[y]===u&&(this.bindTexture(null,y),this._state.textureUnitMap[y]=null)}bindFramebuffer(u,y=!1){if(y||this._state.readFramebuffer!==u||this._state.drawFramebuffer!==u)this._stateTracker.invalidateDrawBuffers(),
null==u?(this.gl.bindFramebuffer(g.FramebufferTarget.FRAMEBUFFER,null),this._state.readFramebuffer=null,this._state.drawFramebuffer=null):(u.initializeAndBind(g.FramebufferTarget.FRAMEBUFFER),this._state.readFramebuffer=u,this._state.drawFramebuffer=u)}bindFramebufferSeparate(u,y,z=!1){const A=y===g.FramebufferTarget.READ_FRAMEBUFFER,C=A?this._state.readFramebuffer:this._state.drawFramebuffer;if(z||C!==u)null==u?this.gl.bindFramebuffer(y,null):u.initializeAndBind(y),A?this._state.readFramebuffer=
u??null:this._state.drawFramebuffer=u??null}blitFramebuffer(u,y,z=0,A=0,C=u.width,E=u.height,B=0,D=0,F=y.width,K=y.height,L=g.ClearBufferBit.COLOR_BUFFER_BIT,G=g.TextureSamplingMode.NEAREST){this.bindFramebufferSeparate(u,g.FramebufferTarget.READ_FRAMEBUFFER);this.bindFramebufferSeparate(y,g.FramebufferTarget.DRAW_FRAMEBUFFER);this.gl.blitFramebuffer(z,A,C,E,B,D,F,K,L,G)}bindBuffer(u,y){if(u)switch(y??(y=u.bufferType),y){case g.BufferType.ARRAY_BUFFER:this._state.vertexBuffer=t(this.gl,u,y,this._state.vertexBuffer);
break;case g.BufferType.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=t(this.gl,u,y,this._state.indexBuffer);break;case g.BufferType.UNIFORM_BUFFER:this._state.uniformBuffer=t(this.gl,u,y,this._state.uniformBuffer);break;case g.BufferType.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=t(this.gl,u,y,this._state.pixelPackBuffer);break;case g.BufferType.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=t(this.gl,u,y,this._state.pixelUnpackBuffer);break;case g.BufferType.COPY_READ_BUFFER:this._state.copyReadBuffer=
t(this.gl,u,y,this._state.copyReadBuffer);break;case g.BufferType.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=t(this.gl,u,y,this._state.copyWriteBuffer)}}bindRenderbuffer(u){const y=this.gl;u||(y.bindRenderbuffer(y.RENDERBUFFER,null),this._state.renderbuffer=null);this._state.renderbuffer!==u&&(y.bindRenderbuffer(y.RENDERBUFFER,u.glName),this._state.renderbuffer=u)}_getBufferBinding(u,y){if(y>=this.parameters.maxUniformBufferBindings||0>y)return console.error("Uniform buffer binding point is out of range!"),
null;u=this._state.uniformBufferBindingPoints;let z=u[y];null==z&&(z={buffer:null,offset:0,size:0},u[y]=z);return z}bindBufferBase(u,y,z){const A=this._getBufferBinding(u,y);null==A||A.buffer===z&&0===A.offset&&0===A.size||(this.gl.bindBufferBase(u,y,z?z.glName:null),A.buffer=z,A.offset=0,A.size=0)}bindBufferRange(u,y,z,A,C){const E=this._getBufferBinding(u,y);null==E||E.buffer===z&&E.offset===A&&E.size===C||(0!==A%this._parameters.uniformBufferOffsetAlignment?console.error("Uniform buffer binding offset is not a multiple of the context offset alignment"):
(this.gl.bindBufferRange(u,y,z.glName,A,C),E.buffer=z,E.offset=A,E.size=C))}bindUBO(u,y,z,A){null==y?this.bindBufferBase(g.BufferType.UNIFORM_BUFFER,u,null):(f.webglDebugEnabled()&&(A??y.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),y.initialize(),void 0!==z&&void 0!==A?this.bindBufferRange(g.BufferType.UNIFORM_BUFFER,u,y.buffer,z,A):this.bindBufferBase(g.BufferType.UNIFORM_BUFFER,u,y.buffer))}unbindUBO(u){for(let y=
0,z=this._state.uniformBufferBindingPoints.length;y<z;y++){const A=this._state.uniformBufferBindingPoints[y];null!=A&&A.buffer===u.buffer&&this.bindBufferBase(g.BufferType.UNIFORM_BUFFER,y,null)}}unbindBuffer(u){switch(u){case g.BufferType.ARRAY_BUFFER:this._state.vertexBuffer=t(this.gl,null,u,this._state.vertexBuffer);break;case g.BufferType.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=t(this.gl,null,u,this._state.indexBuffer);break;case g.BufferType.UNIFORM_BUFFER:this._state.uniformBuffer=t(this.gl,
null,u,this._state.uniformBuffer);break;case g.BufferType.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=t(this.gl,null,u,this._state.pixelPackBuffer);break;case g.BufferType.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=t(this.gl,null,u,this._state.pixelUnpackBuffer);break;case g.BufferType.COPY_READ_BUFFER:this._state.copyReadBuffer=t(this.gl,null,u,this._state.copyReadBuffer);break;case g.BufferType.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=t(this.gl,null,u,this._state.copyWriteBuffer)}}bindVAO(u=
null){null==u?this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null):this._state.vertexArrayObject!==u&&(u.bind(),this._state.vertexArrayObject=u)}async clientWaitAsync(u=d.Milliseconds(10)){const y=this.gl,z=y.fenceSync(g.SyncCondition.SYNC_GPU_COMMANDS_COMPLETE,0);if(!z)throw Error("Client wait failed, could not create sync object");this.instanceCounter.increment(g.ResourceType.Sync,z);y.flush();let A;do await c.after(u),A=y.clientWaitSync(z,0,
0);while(A===g.ClientWaitSyncStatus.TIMEOUT_EXPIRED);this.instanceCounter.decrement(g.ResourceType.Sync,z);y.deleteSync(z);if(A===g.ClientWaitSyncStatus.WAIT_FAILED)throw Error("Client wait failed");}getBoundFramebufferObject(u=g.FramebufferTarget.FRAMEBUFFER){return u===g.FramebufferTarget.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null);this.bindVAO(null);this.bindFramebuffer(null,!0);this.unbindBuffer(g.BufferType.ARRAY_BUFFER);
this.unbindBuffer(g.BufferType.ELEMENT_ARRAY_BUFFER);this.type===k.ContextType.WEBGL2&&(this.unbindBuffer(g.BufferType.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(g.BufferType.PIXEL_PACK_BUFFER),this.unbindBuffer(g.BufferType.PIXEL_UNPACK_BUFFER),this.unbindBuffer(g.BufferType.COPY_READ_BUFFER),this.unbindBuffer(g.BufferType.COPY_WRITE_BUFFER));for(let u=0;u<this.parameters.maxTextureImageUnits;++u)this.bindTexture(null,u);this.setBlendingEnabled(!1);this.setBlendFunction(g.BlendFactor.ONE,
g.BlendFactor.ZERO);this.setBlendEquation(g.BlendOperation.ADD);this.setBlendColor(0,0,0,0);this.setFaceCullingEnabled(!1);this.setCullFace(g.Face.BACK);this.setFrontFace(g.CullMode.CCW);this.setPolygonOffsetFillEnabled(!1);this.setPolygonOffset(0,0);this.setScissorTestEnabled(!1);this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height);this.setDepthTestEnabled(!1);this.setDepthFunction(g.CompareFunction.LESS);this.setDepthRange(0,1);this.setStencilTestEnabled(!1);this.setStencilFunction(g.CompareFunction.ALWAYS,
0,0);this.setStencilOp(g.StencilOperation.KEEP,g.StencilOperation.KEEP,g.StencilOperation.KEEP);this.setClearColor(0,0,0,0);this.setClearDepth(1);this.setClearStencil(0);this.setColorMask(!0,!0,!0,!0);this.setStencilWriteMask(4294967295);this.setDepthWriteEnabled(!0);this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){var u=this.capabilities.vao;u&&u.bindVertexArray(null);const {gl:y,gl2:z}=this;for(var A=0;A<this.parameters.maxVertexAttributes;A++)y.disableVertexAttribArray(A);
this._state.vertexBuffer?y.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):y.bindBuffer(g.BufferType.ARRAY_BUFFER,null);this._state.indexBuffer?y.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):y.bindBuffer(g.BufferType.ELEMENT_ARRAY_BUFFER,null);if(null!=z){this._state.uniformBuffer?z.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):z.bindBuffer(g.BufferType.UNIFORM_BUFFER,null);for(A=0;A<this._parameters.maxUniformBufferBindings;A++){const C=
this._state.uniformBufferBindingPoints[A];if(null!=C){const {buffer:E,offset:B,size:D}=C;null!==E?0===B&&0===D?z.bindBufferBase(g.BufferType.UNIFORM_BUFFER,A,E.glName):z.bindBufferRange(g.BufferType.UNIFORM_BUFFER,A,E.glName,B,D):z.bindBufferBase(g.BufferType.UNIFORM_BUFFER,A,null)}}this._state.pixelPackBuffer?z.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):z.bindBuffer(g.BufferType.PIXEL_PACK_BUFFER,null);this._state.pixelUnpackBuffer?z.bindBuffer(this._state.pixelUnpackBuffer.bufferType,
this._state.pixelUnpackBuffer.glName):z.bindBuffer(g.BufferType.PIXEL_UNPACK_BUFFER,null);this._state.copyReadBuffer?z.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):z.bindBuffer(g.BufferType.COPY_READ_BUFFER,null);this._state.copyWriteBuffer?z.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):z.bindBuffer(g.BufferType.COPY_WRITE_BUFFER,null);z.bindFramebuffer(g.FramebufferTarget.READ_FRAMEBUFFER,null);z.readBuffer(z.BACK);this._state.readFramebuffer&&
(z.bindFramebuffer(g.FramebufferTarget.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),z.readBuffer(g.ColorAttachment.COLOR_ATTACHMENT0));z.bindFramebuffer(g.FramebufferTarget.DRAW_FRAMEBUFFER,this._state.drawFramebuffer?.glName??null)}else this._state.readFramebuffer=this._state.drawFramebuffer,y.bindFramebuffer(g.FramebufferTarget.FRAMEBUFFER,this._state.drawFramebuffer?.glName??null);if(u&&this._state.vertexArrayObject){if(u=this._state.vertexArrayObject)this._state.vertexArrayObject.unbind(),
this._state.vertexArrayObject=null;this.bindVAO(u)}y.useProgram(this._state.program?.glName??null);y.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a);y.bindRenderbuffer(y.RENDERBUFFER,this._state.renderbuffer?this._state.renderbuffer.glName:null);!0===this._state.blend?y.enable(this.gl.BLEND):y.disable(this.gl.BLEND);y.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha);y.blendFuncSeparate(this._state.blendFunction.srcRGB,
this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha);y.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a);y.clearDepth(this._state.clearDepth);y.clearStencil(this._state.clearStencil);y.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a);y.cullFace(this._state.cullFace);y.depthFunc(this._state.depthFunction);y.depthRange(this._state.depthRange.zNear,
this._state.depthRange.zFar);!0===this._state.depthTest?y.enable(y.DEPTH_TEST):y.disable(y.DEPTH_TEST);y.depthMask(this._state.depthWrite);y.frontFace(this._state.frontFace);y.lineWidth(1);!0===this._state.faceCulling?y.enable(y.CULL_FACE):y.disable(y.CULL_FACE);y.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]);!0===this._state.polygonOffsetFill?y.enable(y.POLYGON_OFFSET_FILL):y.disable(y.POLYGON_OFFSET_FILL);y.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,
this._state.scissorRect.height);!0===this._state.scissorTest?y.enable(y.SCISSOR_TEST):y.disable(y.SCISSOR_TEST);y.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask);y.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass);!0===this._state.stencilTest?y.enable(y.STENCIL_TEST):y.disable(y.STENCIL_TEST);y.stencilMask(this._state.stencilWriteMask);
for(u=0;u<this.parameters.maxTextureImageUnits;u++)y.activeTexture(g.baseTextureUnit+u),y.bindTexture(g.TextureType.TEXTURE_2D,null),y.bindTexture(g.TextureType.TEXTURE_CUBE_MAP,null),this.type===k.ContextType.WEBGL2&&(y.bindTexture(g.TextureType.TEXTURE_3D,null),y.bindTexture(g.TextureType.TEXTURE_2D_ARRAY,null)),A=this._state.textureUnitMap[u],null!=A&&y.bindTexture(A.descriptor.target,A.glName);y.activeTexture(g.baseTextureUnit+this._state.activeTexture);u=this._state.viewport;y.viewport(u.x,u.y,
u.width,u.height);this.resetInfo()}_loadExtensions(){this.type===k.ContextType.WEBGL1&&this.gl.getExtension("OES_element_index_uint");this.gl.getExtension("KHR_parallel_shader_compile")}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/ContextState":function(){define(["exports","./enums"],function(b,a){class c{constructor(){this.blend=!1;this.blendColor={r:0,g:0,b:0,a:0};this.blendFunction={srcRGB:a.BlendFactor.ONE,dstRGB:a.BlendFactor.ZERO,srcAlpha:a.BlendFactor.ONE,
dstAlpha:a.BlendFactor.ZERO};this.blendEquation={mode:a.BlendOperation.ADD,modeAlpha:a.BlendOperation.ADD};this.colorMask={r:!0,g:!0,b:!0,a:!0};this.faceCulling=!1;this.cullFace=a.Face.BACK;this.frontFace=a.CullMode.CCW;this.scissorTest=!1;this.scissorRect={x:0,y:0,width:0,height:0};this.depthTest=!1;this.depthFunction=a.CompareFunction.LESS;this.clearDepth=1;this.depthWrite=!0;this.depthRange={zNear:0,zFar:1};this.viewport=null;this.polygonOffsetFill=this.stencilTest=!1;this.polygonOffset=[0,0];
this.stencilFunction={face:a.Face.FRONT_AND_BACK,func:a.CompareFunction.ALWAYS,ref:0,mask:1};this.clearStencil=0;this.stencilWriteMask=1;this.stencilOperation={face:a.Face.FRONT_AND_BACK,fail:a.StencilOperation.KEEP,zFail:a.StencilOperation.KEEP,zPass:a.StencilOperation.KEEP};this.clearColor={r:0,g:0,b:0,a:0};this.copyWriteBuffer=this.copyReadBuffer=this.pixelUnpackBuffer=this.pixelPackBuffer=this.uniformBuffer=this.indexBuffer=this.vertexBuffer=this.program=null;this.uniformBufferBindingPoints=[];
this.renderbuffer=this.drawFramebuffer=this.readFramebuffer=null;this.activeTexture=0;this.textureUnitMap=[];this.vertexArrayObject=null}}b.ContextState=c;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/InstanceCounter":function(){define(["exports","../support/AllocationTracer","./enums"],function(b,a,c){const d={RECORD_ALLOCATIONS:!1};class f{constructor(){this._current=[];for(this._allocations=new a.AllocationTracer(d.RECORD_ALLOCATIONS);this._current.length<c.ResourceType.COUNT;)this._current.push(0)}increment(n,
k,g=1){this._current[n]+=g;this._allocations.add(k)}decrement(n,k,g=1){this._current[n]-=g;this._allocations.remove(k)}get current(){return this._current}get total(){return this.current.reduce((n,k,g)=>n+(g<c.ResourceType.UNCOUNTED?k:0),0)}get resourceInformation(){let n="";if(0<this.total){n+="Live objects:\n";for(let k=0;k<c.ResourceType.COUNT;++k){const g=this._current[k];0<g&&(n+=`${c.ResourceType[k]}: ${g}\n`)}}return n+=this._allocations.information}}b.InstanceCounter=f;b.test=d;Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/views/support/AllocationTracer":function(){define(["exports"],function(b){class a{constructor(c){this._allocations=new Map;c?Error.stackTraceLimit=Infinity:(this.add=()=>{},this.remove=()=>{})}add(c){this._allocations.set(c,Error().stack)}remove(c){this._allocations.delete(c)}get information(){let c="";if(0<this._allocations.size){c+=`${this._allocations.size} live object allocations:\n`;const d=new Map;this._allocations.forEach(f=>{d.set(f,(d.get(f)??
0)+1)});d.forEach((f,n)=>{n=n.split("\n");n.shift();n.shift();c+=`${f}: ${n.shift()}\n`;n.forEach(k=>c+=`   ${k}\n`)})}return c}}b.AllocationTracer=a;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Parameters":function(){define(["exports","./capabilities/isWebGL2Context"],function(b,a){class c{constructor(d,f,n){f=f.textureFilterAnisotropic;n=n.maxAnisotropy??Infinity;this.versionString=d.getParameter(d.VERSION);this.maxVertexTextureImageUnits=d.getParameter(d.MAX_VERTEX_TEXTURE_IMAGE_UNITS);
this.maxVertexAttributes=d.getParameter(d.MAX_VERTEX_ATTRIBS);this.maxMaxAnisotropy=f?Math.min(d.getParameter(f.MAX_TEXTURE_MAX_ANISOTROPY),n):1;this.maxTextureImageUnits=d.getParameter(d.MAX_TEXTURE_IMAGE_UNITS);this.maxTextureSize=d.getParameter(d.MAX_TEXTURE_SIZE);this.maxRenderbufferSize=d.getParameter(d.MAX_RENDERBUFFER_SIZE);this.maxViewportDims=d.getParameter(d.MAX_VIEWPORT_DIMS);a(d)?(this.maxUniformBufferBindings=d.getParameter(d.MAX_UNIFORM_BUFFER_BINDINGS),this.maxVertexUniformBlocks=d.getParameter(d.MAX_VERTEX_UNIFORM_BLOCKS),
this.maxFragmentUniformBlocks=d.getParameter(d.MAX_FRAGMENT_UNIFORM_BLOCKS),this.maxUniformBlockSize=d.getParameter(d.MAX_UNIFORM_BLOCK_SIZE),this.uniformBufferOffsetAlignment=d.getParameter(d.UNIFORM_BUFFER_OFFSET_ALIGNMENT),this.maxArrayTextureLayers=d.getParameter(d.MAX_ARRAY_TEXTURE_LAYERS),this.maxSamples=d.getParameter(d.MAX_SAMPLES)):(this.maxUniformBlockSize=this.maxFragmentUniformBlocks=this.maxVertexUniformBlocks=this.maxUniformBufferBindings=0,this.maxSamples=this.maxArrayTextureLayers=
this.uniformBufferOffsetAlignment=1)}}b.Parameters=c;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/ProgramCache":function(){define(["exports","../../core/NestedMap","./Program"],function(b,a,c){class d{constructor(f){this._rctx=f;this._store=new a.NestedMap}dispose(){this._store.forEach(f=>f.forEach(n=>n.dispose()));this._store.clear()}acquire(f,n,k,g){const q=this._store.get(f,n);if(null!=q)return q.ref(),q;k=new c.Program(this._rctx,f,n,k,g);k.ref();this._store.set(f,
n,k);return k}get test(){let f=0;this._store.forEach(n=>n.forEach(k=>f+=k.hasGLName?2:1));return{cachedWebGLProgramObjects:f}}}b.ProgramCache=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Program":function(){define("exports ../../core/arrayUtils ../../core/has ./checkWebGLError ./contextUtils ./enums ./ShaderTranspiler".split(" "),function(b,a,c,d,f,n,k){function g(w,v,x){w=w.gl;const p=w.createShader(v);w.shaderSource(p,x);w.compileShader(p);d.webglValidateShadersEnabled()&&
!w.getShaderParameter(p,w.COMPILE_STATUS)&&(console.error("Compile error in ".concat(v===n.ShaderType.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(w.getShaderInfoLog(p)),console.error(q(x)));return p}function q(w){let v=2;return w.replaceAll("\n",()=>{var x=v++;x=1E3<=x?x.toString():("  "+x).slice(-3);return"\n"+x+":"})}function e(w,v,x){const p=w.get(v);return p?a.update(p,x):(w.set(v,Array.from(x)),!0)}class m{constructor(w,v,x,p,h=new Map){this._context=w;this._locations=p;this._uniformBlockBindings=
h;this._refCount=1;this._compiled=!1;this._linesOfCode=0;this._nameToUniformLocation=new Map;this._nameToUniform1=new Map;this._nameToUniform1v=new Map;this._nameToUniform2=new Map;this._nameToUniform3=new Map;this._nameToUniform4=new Map;this._nameToUniformMatrix3=new Map;this._nameToUniformMatrix4=new Map;w||console.error("RenderingContext isn't initialized!");0===v.length&&console.error("Shaders source should not be empty!");this._context.type===f.ContextType.WEBGL2&&(v=k.transpileShader(v,n.ShaderType.VERTEX_SHADER),
x=k.transpileShader(x,n.ShaderType.FRAGMENT_SHADER));this._vShader=g(this._context,n.ShaderType.VERTEX_SHADER,v);this._fShader=g(this._context,n.ShaderType.FRAGMENT_SHADER,x);l.enabled&&(this._linesOfCode=v.match(/\n/g).length+x.match(/\n/g).length+2,this._context.instanceCounter.increment(n.ResourceType.LinesOfCode,this._vShader,this._linesOfCode));this._vShader&&this._fShader||console.error("Error loading shaders!");this._context.instanceCounter.increment(n.ResourceType.Shader,this);d.webglValidateShadersEnabled()&&
(this.vertexShader=v,this.fragmentShader=x);const t=this._context.gl,r=t.createProgram();t.attachShader(r,this._vShader);t.attachShader(r,this._fShader);this._locations.forEach((u,y)=>t.bindAttribLocation(r,u,y));t.linkProgram(r);d.webglValidateShadersEnabled()&&!t.getProgramParameter(r,t.LINK_STATUS)&&console.error("Could not link shader\n"+`validated: ${t.getProgramParameter(r,t.VALIDATE_STATUS)}`+`, gl error ${t.getError()}`+`, vertex: ${t.getShaderParameter(this._vShader,t.COMPILE_STATUS)}`+`, fragment: ${t.getShaderParameter(this._fShader,
t.COMPILE_STATUS)}`+`, info log: ${t.getProgramInfoLog(r)}`+`, vertex source: ${this.vertexShader}`+`, fragment source: ${this.fragmentShader}`);if(this._context.type===f.ContextType.WEBGL2)for(const [u,y]of this._uniformBlockBindings)w=t.getUniformBlockIndex(r,u),4294967295>w&&t.uniformBlockBinding(r,w,y);this._glName=r;this._context.instanceCounter.increment(n.ResourceType.Program,this)}get glName(){return this._glName}get hasGLName(){return null!=this._glName}get compiled(){if(this._compiled)return!0;
const w=this._context.gl.getExtension("KHR_parallel_shader_compile");return null==w||null==this.glName?this._compiled=!0:this._compiled=!!this._context.gl.getProgramParameter(this.glName,w.COMPLETION_STATUS_KHR)}dispose(){if(!(0<--this._refCount)){var w=this._context.gl,v=this._context.instanceCounter;this._nameToUniformLocation.forEach(x=>x&&v.decrement(n.ResourceType.Uniform,x));this._nameToUniformLocation.clear();this._vShader&&(0<this._linesOfCode&&(v.decrement(n.ResourceType.LinesOfCode,this._vShader,
this._linesOfCode),this._linesOfCode=0),w.deleteShader(this._vShader),this._vShader=null,v.decrement(n.ResourceType.Shader,this));this._fShader&&(w.deleteShader(this._fShader),this._fShader=null);this._glName&&(w.deleteProgram(this._glName),this._glName=null,v.decrement(n.ResourceType.Program,this))}}ref(){++this._refCount}_getUniformLocation(w){var v=this._nameToUniformLocation.get(w);return void 0!==v?v:this.glName?(v=this._context.gl.getUniformLocation(this.glName,w),this._nameToUniformLocation.set(w,
v),v&&this._context.instanceCounter.increment(n.ResourceType.Uniform,v),v):null}hasUniform(w){return null!=this._getUniformLocation(w)}setUniform1i(w,v){const x=this._nameToUniform1.get(w);if(void 0===x||v!==x)this._context.gl.uniform1i(this._getUniformLocation(w),v),this._nameToUniform1.set(w,v)}setUniform1iv(w,v){e(this._nameToUniform1v,w,v)&&this._context.gl.uniform1iv(this._getUniformLocation(w),v)}setUniform2iv(w,v){e(this._nameToUniform2,w,v)&&this._context.gl.uniform2iv(this._getUniformLocation(w),
v)}setUniform3iv(w,v){e(this._nameToUniform3,w,v)&&this._context.gl.uniform3iv(this._getUniformLocation(w),v)}setUniform4iv(w,v){e(this._nameToUniform4,w,v)&&this._context.gl.uniform4iv(this._getUniformLocation(w),v)}setUniform1f(w,v){const x=this._nameToUniform1.get(w);if(void 0===x||v!==x)this._context.gl.uniform1f(this._getUniformLocation(w),v),this._nameToUniform1.set(w,v)}setUniform1fv(w,v){e(this._nameToUniform1v,w,v)&&this._context.gl.uniform1fv(this._getUniformLocation(w),v)}setUniform2f(w,
v,x){const p=this._nameToUniform2.get(w);if(void 0===p)this._context.gl.uniform2f(this._getUniformLocation(w),v,x),this._nameToUniform2.set(w,[v,x]);else if(v!==p[0]||x!==p[1])this._context.gl.uniform2f(this._getUniformLocation(w),v,x),p[0]=v,p[1]=x}setUniform2fv(w,v){e(this._nameToUniform2,w,v)&&this._context.gl.uniform2fv(this._getUniformLocation(w),v)}setUniform3f(w,v,x,p){const h=this._nameToUniform3.get(w);if(void 0===h)this._context.gl.uniform3f(this._getUniformLocation(w),v,x,p),this._nameToUniform3.set(w,
[v,x,p]);else if(v!==h[0]||x!==h[1]||p!==h[2])this._context.gl.uniform3f(this._getUniformLocation(w),v,x,p),h[0]=v,h[1]=x,h[2]=p}setUniform3fv(w,v){e(this._nameToUniform3,w,v)&&this._context.gl.uniform3fv(this._getUniformLocation(w),v)}setUniform4f(w,v,x,p,h){const t=this._nameToUniform4.get(w);if(void 0===t)this._context.gl.uniform4f(this._getUniformLocation(w),v,x,p,h),this._nameToUniform4.set(w,[v,x,p,h]);else if(void 0===t||v!==t[0]||x!==t[1]||p!==t[2]||h!==t[3])this._context.gl.uniform4f(this._getUniformLocation(w),
v,x,p,h),t[0]=v,t[1]=x,t[2]=p,t[3]=h}setUniform4fv(w,v){e(this._nameToUniform4,w,v)&&this._context.gl.uniform4fv(this._getUniformLocation(w),v)}setUniformMatrix3fv(w,v,x=!1){e(this._nameToUniformMatrix3,w,v)&&this._context.gl.uniformMatrix3fv(this._getUniformLocation(w),x,v)}setUniformMatrix4fv(w,v,x=!1){e(this._nameToUniformMatrix4,w,v)&&this._context.gl.uniformMatrix4fv(this._getUniformLocation(w),x,v)}stop(){}}const l={enabled:!1};b.Program=m;b.test=l;Object.defineProperty(b,Symbol.toStringTag,
{value:"Module"})})},"esri/views/webgl/ShaderTranspiler":function(){define("exports ../../core/has ./enums ./reservedWordsGLSL3 ./testUtils ../../chunks/builtins".split(" "),function(b,a,c,d,f,n){function k(){function h(M){M.length&&L.push({type:v[B],data:M,position:P,line:G,column:O})}function t(){K=K.length?[]:K;if("/"===F&&"*"===D)return P=E+C-1,B=0,F=D,C+1;if("/"===F&&"/"===D)return P=E+C-1,B=1,F=D,C+1;if("#"===D)return B=2,P=E+C,C;if(/\s/.test(D))return B=9,P=E+C,C;J=/\d/.test(D);R=/[^\w_]/.test(D);
P=E+C;B=J?4:R?3:9999;return C}function r(){if(("\r"===D||"\n"===D)&&"\\"!==F)return h(K.join("")),B=999,C;K.push(D);F=D;return C+1}function u(){if("."===F&&/\d/.test(D))return B=5,C;if("/"===F&&"*"===D)return B=0,C;if("/"===F&&"/"===D)return B=1,C;if("."===D&&K.length){for(;y(K););B=5;return C}if(";"===D||")"===D||"("===D){if(K.length)for(;y(K););h(D);B=999;return C+1}var M=2===K.length&&"\x3d"!==D;if(/[\w_\d\s]/.test(D)||M){for(;y(K););B=999;return C}K.push(D);F=D;return C+1}function y(M){var V=
0;do{var Y=n.operators.indexOf(M.slice(0,M.length+V).join(""));var W=n.operators[Y];if(-1===Y){if(0<V--+M.length)continue;W=M.slice(0,1).join("")}h(W);P+=W.length;K=K.slice(W.length);return K.length}while(1)}function z(){if("."===D||/[eE]/.test(D))return K.push(D),B=5,F=D,C+1;if("x"===D&&1===K.length&&"0"===K[0])return B=11,K.push(D),F=D,C+1;if(/[^\d]/.test(D))return h(K.join("")),B=999,C;K.push(D);F=D;return C+1}function A(){"f"===D&&(K.push(D),F=D,C+=1);if(/[eE]/.test(D)||"-"===D&&/[eE]/.test(F))return K.push(D),
F=D,C+1;if(/[^\d]/.test(D))return h(K.join("")),B=999,C;K.push(D);F=D;return C+1}var C=0,E=0,B=999,D,F,K=[],L=[],G=1,O=0,P=0,J=!1,R=!1,X="",U;return function(M){L=[];if(null!==M){M=M.replace?M.replace(/\r\n/g,"\n"):M;C=0;X+=M;for(U=X.length;D=X[C],C<U;){M=C;switch(B){case 0:"/"===D&&"*"===F?(K.push(D),h(K.join("")),B=999):(K.push(D),F=D);C+=1;break;case 1:C=r();break;case 2:C=r();break;case 3:C=u();break;case 4:C=z();break;case 11:/[^a-fA-F0-9]/.test(D)?(h(K.join("")),B=999):(K.push(D),F=D,C+=1);
break;case 5:C=A();break;case 9999:if(/[^\d\w_]/.test(D)){var V=K.join("");B=-1<n.literals.indexOf(V)?8:-1<n.builtins.indexOf(V)?7:6;h(K.join(""));B=999}else K.push(D),F=D,C+=1;break;case 9:/[^\s]/g.test(D)?(h(K.join("")),B=999):(K.push(D),F=D,C+=1);break;case 999:C=t()}if(M!==C)switch(X[M]){case "\n":O=0;++G;break;default:++O}}E+=C;X=X.slice(C);return L}K.length&&h(K.join(""));B=10;h("(eof)");return L}}function g(h){return h.map(t=>"eof"!==t.type?t.data:"").join("")}function q(h,t="100",r="300 es"){const u=
/^\s*#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const y of h)if("preprocessor"===y.type){const z=u.exec(y.data);if(z){h=z[1].replaceAll(/\s\s+/g," ");if(h===r)return h;if(h===t)return y.data="#version "+r,t;throw Error("unknown glsl version: "+h);}}h.splice(0,0,{type:"preprocessor",data:"#version "+r},{type:"whitespace",data:"\n"});return null}function e(h,t,r,u){u=u||r;for(const y of h)if("ident"===y.type&&y.data===r)return u in t?t[u]++:t[u]=0,e(h,t,u+"_"+t[u],u);return r}function m(h,t,r="afterVersion"){const u=
{data:"\n",type:"whitespace"},y=A=>A<h.length?/[^\r\n]$/.test(h[A].data):!1;let z=function(A){let C=-1,E=0,B=-1;for(let F=0;F<A.length;F++){var D=A[F];"preprocessor"===D.type&&(/#(if|ifdef|ifndef)\s+.+/.test(D.data)?++E:/#endif\s*.*/.test(D.data)&&--E);("afterVersion"===r||"afterPrecision"===r)&&"preprocessor"===D.type&&D.data.startsWith("#version")&&(B=Math.max(B,F));if("afterPrecision"===r&&"keyword"===D.type&&"precision"===D.data){a:{for(D=F;D<A.length;D++){const K=A[D];if("operator"===K.type&&
";"===K.data)break a}D=null}if(null===D)throw Error("precision statement not followed by any semicolons!");B=Math.max(B,D)}C<B&&0===E&&(C=F)}return C+1}(h);y(z-1)&&h.splice(z++,0,u);for(const A of t)h.splice(z++,0,A);y(z-1)&&y(z)&&h.splice(z,0,u)}function l(h,t,r,u="lowp"){m(h,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:u},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}
function w(h,t,r,u,y="lowp"){m(h,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"\x3d"},{type:"whitespace",data:" "},{type:"integer",data:u.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:y},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",
data:";"}],"afterPrecision")}var v="block-comment line-comment preprocessor operator integer float ident builtin keyword whitespace eof integer".split(" ");const x=new Set(["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"]),p=new Map;b.transpileShader=function(h,t){if(h.startsWith("#version 300"))return h;var r=f.shaderTranspiler.enableCache?p.get(h):null;if(null!=r)return r;r=k();var u=[];u=u.concat(r(h));r=u=u.concat(r(null));if("300 es"===q(r,
"100","300 es"))return h;var y=u=null;const z={},A={};for(let D=0;D<r.length;++D){const F=r[D];switch(F.type){case "keyword":t===c.ShaderType.VERTEX_SHADER&&"attribute"===F.data?F.data="in":"varying"===F.data&&(F.data=t===c.ShaderType.VERTEX_SHADER?"out":"in");break;case "builtin":/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(F.data.trim())&&(F.data=F.data.replaceAll(/(2D|Cube|EXT)/g,""));t===c.ShaderType.FRAGMENT_SHADER&&"gl_FragColor"===F.data&&(u||(u=e(r,z,"fragColor"),l(r,u,"vec4")),F.data=
u);if(t===c.ShaderType.FRAGMENT_SHADER&&"gl_FragData"===F.data){var C=void 0;let K=void 0;var E=r,B=D+1;let L=-1;for(;B<E.length;B++){const G=E[B];if("operator"===G.type&&("["===G.data&&(K=B),"]"===G.data)){C=B;break}"integer"===G.type&&(L=parseInt(G.data,10))}K&&C&&E.splice(K,C-K+1);E=L;C=e(r,z,"fragData");w(r,C,"vec4",E,"mediump");F.data=C}else t===c.ShaderType.FRAGMENT_SHADER&&"gl_FragDepthEXT"===F.data&&(y||(y=e(r,z,"gl_FragDepth")),F.data=y);break;case "ident":if(d.includes(F.data)){if(E=t===
c.ShaderType.VERTEX_SHADER)a:{for(E=D-1;0<=E;E--)if(C=r[E],"whitespace"!==C.type&&"block-comment"!==C.type)if("keyword"===C.type){if("attribute"===C.data||"in"===C.data){E=!0;break a}}else break;E=!1}if(E)throw Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");F.data in A||(A[F.data]=e(r,z,F.data));F.data=A[F.data]}}}for(t=r.length-1;0<=t;--t)u=r[t],"preprocessor"===u.type&&((y=u.data.match(/#extension\s+(.*):/))&&y[1]&&x.has(y[1].trim())&&(y=r[t+1],r.splice(t,
y&&"whitespace"===y.type?2:1)),(y=u.data.match(/#ifdef\s+(.*)/))&&y[1]&&x.has(y[1].trim())&&(u.data="#if 1"),(y=u.data.match(/#ifndef\s+(.*)/))&&y[1]&&x.has(y[1].trim())&&(u.data="#if 0"));r=g(r);f.shaderTranspiler.enableCache&&p.set(h,r);return r};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/reservedWordsGLSL3":function(){define(function(){return"layout centroid smooth case mat2x2 mat2x3 mat2x4 mat3x2 mat3x3 mat3x4 mat4x2 mat4x3 mat4x4 uint uvec2 uvec3 uvec4 samplerCubeShadow sampler2DArray sampler2DArrayShadow isampler2D isampler3D isamplerCube isampler2DArray usampler2D usampler3D usamplerCube usampler2DArray coherent restrict readonly writeonly resource atomic_uint noperspective patch sample subroutine common partition active filter image1D image2D image3D imageCube iimage1D iimage2D iimage3D iimageCube uimage1D uimage2D uimage3D uimageCube image1DArray image2DArray iimage1DArray iimage2DArray uimage1DArray uimage2DArray image1DShadow image2DShadow image1DArrayShadow image2DArrayShadow imageBuffer iimageBuffer uimageBuffer sampler1DArray sampler1DArrayShadow isampler1D isampler1DArray usampler1D usampler1DArray isampler2DRect usampler2DRect samplerBuffer isamplerBuffer usamplerBuffer sampler2DMS isampler2DMS usampler2DMS sampler2DMSArray isampler2DMSArray usampler2DMSArray trunc round roundEven isnan isinf floatBitsToInt floatBitsToUint intBitsToFloat uintBitsToFloat packSnorm2x16 unpackSnorm2x16 packUnorm2x16 unpackUnorm2x16 packHalf2x16 unpackHalf2x16 outerProduct transpose determinant inverse texture textureSize textureProj textureLod textureOffset texelFetch texelFetchOffset textureProjOffset textureLodOffset textureProjLod textureProjLodOffset textureGrad textureGradOffset textureProjGrad textureProjGradOffset".split(" ")})},
"esri/views/webgl/testUtils":function(){define(["exports"],function(b){b.shaderTranspiler={enableCache:!1};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/builtins":function(){define(["exports","./_commonjsHelpers"],function(b,a){var c={exports:{}};c.exports;(function(n){(function(k){k=k();void 0!==k&&(n.exports=k)})(function(){return"precision highp mediump lowp attribute const uniform varying break continue do for while if else in out inout float int void bool true false discard return mat2 mat3 mat4 vec2 vec3 vec4 ivec2 ivec3 ivec4 bvec2 bvec3 bvec4 sampler1D sampler2D sampler3D samplerCube sampler1DShadow sampler2DShadow struct asm class union enum typedef template this packed goto switch default inline noinline volatile public static extern external interface long short double half fixed unsigned input output hvec2 hvec3 hvec4 dvec2 dvec3 dvec4 fvec2 fvec3 fvec4 sampler2DRect sampler3DRect sampler2DRectShadow sizeof cast namespace using".split(" ")})})(c);
c=a.getDefaultExportFromCjs(c.exports);var d={exports:{}};d.exports;(function(n){(function(k){k=k();void 0!==k&&(n.exports=k)})(function(){return"\x3c\x3c\x3d \x3e\x3e\x3d ++ -- \x3c\x3c \x3e\x3e \x3c\x3d \x3e\x3d \x3d\x3d !\x3d \x26\x26 || +\x3d -\x3d *\x3d /\x3d %\x3d \x26\x3d ^^ ^\x3d |\x3d ( ) [ ] . ! ~ * / % + - \x3c \x3e \x26 ^ | ? : \x3d , ; { }".split(" ")})})(d);d=a.getDefaultExportFromCjs(d.exports);var f={exports:{}};f.exports;(function(n){(function(k){k=k();void 0!==k&&(n.exports=k)})(function(){return"abs acos all any asin atan ceil clamp cos cross dFdx dFdy degrees distance dot equal exp exp2 faceforward floor fract gl_BackColor gl_BackLightModelProduct gl_BackLightProduct gl_BackMaterial gl_BackSecondaryColor gl_ClipPlane gl_ClipVertex gl_Color gl_DepthRange gl_DepthRangeParameters gl_EyePlaneQ gl_EyePlaneR gl_EyePlaneS gl_EyePlaneT gl_Fog gl_FogCoord gl_FogFragCoord gl_FogParameters gl_FragColor gl_FragCoord gl_FragData gl_FragDepth gl_FragDepthEXT gl_FrontColor gl_FrontFacing gl_FrontLightModelProduct gl_FrontLightProduct gl_FrontMaterial gl_FrontSecondaryColor gl_LightModel gl_LightModelParameters gl_LightModelProducts gl_LightProducts gl_LightSource gl_LightSourceParameters gl_MaterialParameters gl_MaxClipPlanes gl_MaxCombinedTextureImageUnits gl_MaxDrawBuffers gl_MaxFragmentUniformComponents gl_MaxLights gl_MaxTextureCoords gl_MaxTextureImageUnits gl_MaxTextureUnits gl_MaxVaryingFloats gl_MaxVertexAttribs gl_MaxVertexTextureImageUnits gl_MaxVertexUniformComponents gl_ModelViewMatrix gl_ModelViewMatrixInverse gl_ModelViewMatrixInverseTranspose gl_ModelViewMatrixTranspose gl_ModelViewProjectionMatrix gl_ModelViewProjectionMatrixInverse gl_ModelViewProjectionMatrixInverseTranspose gl_ModelViewProjectionMatrixTranspose gl_MultiTexCoord0 gl_MultiTexCoord1 gl_MultiTexCoord2 gl_MultiTexCoord3 gl_MultiTexCoord4 gl_MultiTexCoord5 gl_MultiTexCoord6 gl_MultiTexCoord7 gl_Normal gl_NormalMatrix gl_NormalScale gl_ObjectPlaneQ gl_ObjectPlaneR gl_ObjectPlaneS gl_ObjectPlaneT gl_Point gl_PointCoord gl_PointParameters gl_PointSize gl_Position gl_ProjectionMatrix gl_ProjectionMatrixInverse gl_ProjectionMatrixInverseTranspose gl_ProjectionMatrixTranspose gl_SecondaryColor gl_TexCoord gl_TextureEnvColor gl_TextureMatrix gl_TextureMatrixInverse gl_TextureMatrixInverseTranspose gl_TextureMatrixTranspose gl_Vertex greaterThan greaterThanEqual inversesqrt length lessThan lessThanEqual log log2 matrixCompMult max min mix mod normalize not notEqual pow radians reflect refract sign sin smoothstep sqrt step tan texture2D texture2DLod texture2DProj texture2DProjLod textureCube textureCubeLod texture2DLodEXT texture2DProjLodEXT textureCubeLodEXT texture2DGradEXT texture2DProjGradEXT textureCubeGradEXT textureSize texelFetch".split(" ")})})(f);
a=a.getDefaultExportFromCjs(f.exports);b.builtins=a;b.literals=c;b.operators=d})},"esri/views/webgl/WebGLDriverTest":function(){define("exports ./testAppleAmdDrawArrays ./testDoublePrecisionArithmetic ./testFloatBufferBlend ./testSamplerPrecision ./testSVGPremultipliedAlpha".split(" "),function(b,a,c,d,f,n){class k{constructor(g){this.rctx=g;this.floatBufferBlend=new d.FloatBufferBlend(g);this.svgPremultipliesAlpha=new n.SVGPremultipliedAlpha(g);this.doublePrecisionRequiresObfuscation=new c.DoublePrecisionRequiresObfuscation(g);
this.ignoresSamplerPrecision=new f.IgnoresSamplerPrecision(g);this.drawArraysRequiresIndicesTypeReset=new a.DrawArraysRequiresIndicesTypeReset(g)}dispose(){this.ignoresSamplerPrecision.dispose();this.doublePrecisionRequiresObfuscation.dispose();this.svgPremultipliesAlpha.dispose();this.floatBufferBlend.dispose();this.drawArraysRequiresIndicesTypeReset.dispose()}}b.WebGLDriverTest=k;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testAppleAmdDrawArrays":function(){define("exports ../../core/has ../3d/webgl-engine/core/shaderModules/interfaces ./AppleAmdDriverHelper ./BufferObject ./contextUtils ./enums ./FramebufferObject ./TextureDescriptor ./WebGLDriverTestModule".split(" "),
function(b,a,c,d,f,n,k,g,q,e){class m extends e.WebGLDriverTestModule{constructor(l){super();this._rctx=l;this._helperProgram=null;this._rctx.type===n.ContextType.WEBGL2&&a("mac")&&a("chrome")&&(this._program=this._prepareProgram(),this._helperProgram=this._prepareHelperProgram())}dispose(){super.dispose();this._helperProgram?.dispose();this._helperProgram=null}_test(l){const w=this._rctx,v=w.getBoundFramebufferObject(),{x,y:p,width:h,height:t}=w.getViewport();w.resetState();var r=new q.TextureDescriptor(1);
r.wrapMode=k.TextureWrapMode.CLAMP_TO_EDGE;r.samplingMode=k.TextureSamplingMode.NEAREST;r=new g.FramebufferObject(w,r);const u=f.BufferObject.createIndex(this._rctx,k.Usage.STATIC_DRAW,new Uint8Array([0]));w.bindFramebuffer(r);w.setViewport(0,0,1,1);w.useProgram(this._helperProgram);w.bindBuffer(u,k.BufferType.ELEMENT_ARRAY_BUFFER);w.drawElements(k.PrimitiveType.POINTS,1,k.DataType.UNSIGNED_BYTE,0);w.useProgram(l);w.bindVAO(null);w.drawArrays(k.PrimitiveType.TRIANGLES,0,258);l=new Uint8Array(4);r.readPixels(0,
0,1,1,k.PixelFormat.RGBA,k.PixelType.UNSIGNED_BYTE,l);w.setViewport(x,p,h,t);w.bindFramebuffer(v);r.dispose();u.dispose();return 255===l[0]}_prepareProgram(){const l=`#version 300 es\n    precision highp float;\n\n    out float triangleId;\n\n    const vec3 triangleVertices[3] = vec3[3](vec3(-0.5, -0.5, 0.0), vec3(0.5, -0.5, 0.0), vec3(0.0, 0.5, 0.0));\n\n    void main(void) {\n      triangleId = floor(float(gl_VertexID)/3.0);\n\n      vec3 position = triangleVertices[gl_VertexID % 3];\n      float offset = triangleId / ${c.glsl.float(85)};\n      position.z = 0.5 - offset;\n\n      gl_Position = vec4(position, 1.0);\n    }\n    `,
w=`#version 300 es\n    precision highp float;\n\n    in float triangleId;\n\n    out vec4 fragColor;\n\n    void main(void) {\n      fragColor = triangleId == ${c.glsl.float(85)} ? vec4(0.0, 1.0, 0.0, 1.0) : vec4(1.0, 0.0, 0.0, 1.0);\n    }\n    `;return this._rctx.programCache.acquire(l,w,new Map([]))}_prepareHelperProgram(){const l=d.AppleAmdDriverHelper.getShaderSources();return this._rctx.programCache.acquire(l.vertex,l.fragment,new Map([]))}}b.DrawArraysRequiresIndicesTypeReset=m;Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/WebGLDriverTestModule":function(){define(["exports","../../core/maybe"],function(b,a){class c{constructor(){this._result=!1}dispose(){this._program=a.disposeMaybe(this._program)}get result(){null!=this._program&&(this._result=this._test(this._program),this.dispose());return this._result}}b.WebGLDriverTestModule=c;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testDoublePrecisionArithmetic":function(){define("exports ../../core/floatRGBA ../../core/has ../../core/maybe ../../chunks/vec3f64 ./BufferObject ./doublePrecisionUtils ./enums ./FramebufferObject ./TextureDescriptor ./VertexArrayObject ./VertexElementDescriptor ./WebGLDriverTestModule".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w){function v(p,h){return p.programCache.acquire(`\n\n  precision highp float;\n\n  attribute vec2 position;\n\n  uniform vec3 u_highA;\n  uniform vec3 u_lowA;\n  uniform vec3 u_highB;\n  uniform vec3 u_lowB;\n\n  varying vec4 v_color;\n\n  ${h?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}\n\n  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION\n\n  vec3 dpPlusFrc(vec3 a, vec3 b) {\n    return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n  }\n\n  vec3 dpMinusFrc(vec3 a, vec3 b) {\n    return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n  }\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = dpPlusFrc(hiA, hiB);\n    vec3 e = dpMinusFrc(t1, hiA);\n    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n    return t1 + t2;\n  }\n\n  #else\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = hiA + hiB;\n    vec3 e = t1 - hiA;\n    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n    return t1 + t2;\n  }\n\n  #endif\n\n  const float MAX_RGBA_FLOAT =\n    255.0 / 256.0 +\n    255.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n  vec4 float2rgba(const float value) {\n    // Make sure value is in the domain we can represent\n    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n    // Decompose value in 32bit fixed point parts represented as\n    // uint8 rgba components. Decomposition uses the fractional part after multiplying\n    // by a power of 256 (this removes the bits that are represented in the previous\n    // component) and then converts the fractional part to 8bits.\n    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n    // Convert uint8 values (from 0 to 255) to floating point representation for\n    // the shader\n    const float toU8AsFloat = 1.0 / 255.0;\n\n    return fixedPointU8 * toU8AsFloat;\n  }\n\n  void main() {\n    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);\n\n    v_color = float2rgba(val.z / 25.0);\n\n    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);\n  }\n  `,
"\n  precision highp float;\n\n  varying vec4 v_color;\n\n  void main() {\n    gl_FragColor \x3d v_color;\n  }\n  ",new Map([["position",0]]))}class x extends w.WebGLDriverTestModule{constructor(p){super();this._rctx=p;this._program=v(this._rctx,!1);this._obfuscated=v(this._rctx,!0)}dispose(){super.dispose();this._obfuscated=d.disposeMaybe(this._obfuscated)}_test(p){if(c("force-double-precision-obfuscation"))return!0;if(null==this._obfuscated)return!1;p=this._runProgram(p);const h=this._runProgram(this._obfuscated);
return 0!==p&&(0===h||5<p/h)}_runProgram(p){var h=this._rctx;h.resetState();var t=new e.TextureDescriptor(1);t.wrapMode=g.TextureWrapMode.CLAMP_TO_EDGE;t.samplingMode=g.TextureSamplingMode.NEAREST;t=new q.FramebufferObject(h,t);var r=n.BufferObject.createVertex(h,g.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1]));r=new m.VertexArrayObject(h,new Map([["position",0]]),{geometry:[new l.VertexElementDescriptor("position",2,g.DataType.UNSIGNED_SHORT,0,4)]},{geometry:r});const u=f.fromValues(5633261.287538229,
2626832.878767164,1434988.0495278358),y=f.fromValues(5633271.46742708,2626873.6381334523,1434963.231608387),z=new Float32Array(6);k.encodeDoubleArray(u,z,3);const A=new Float32Array(6);k.encodeDoubleArray(y,A,3);h.useProgram(p);p.setUniform3f("u_highA",z[0],z[2],z[4]);p.setUniform3f("u_lowA",z[1],z[3],z[5]);p.setUniform3f("u_highB",A[0],A[2],A[4]);p.setUniform3f("u_lowB",A[1],A[3],A[5]);h.bindFramebuffer(t);h.setViewport(0,0,1,1);h.bindVAO(r);h.drawArrays(g.PrimitiveType.TRIANGLE_STRIP,0,4);p=new Uint8Array(4);
t.readPixels(0,0,1,1,g.PixelFormat.RGBA,g.PixelType.UNSIGNED_BYTE,p);r.dispose();t.dispose();h=(u[2]-y[2])/25;p=a.unpackFloatRGBA(p);return Math.abs(h-p)}}b.DoublePrecisionRequiresObfuscation=x;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testFloatBufferBlend":function(){define("exports ../3d/webgl-engine/lib/OrderIndependentTransparency ./BufferObject ./contextUtils ./enums ./FramebufferObject ./renderState ./TextureDescriptor ./VertexArrayObject ./VertexElementDescriptor ./WebGLDriverTestModule".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m){class l extends m.WebGLDriverTestModule{constructor(w){super();this._rctx=w;w.gl&&(w.type===d.ContextType.WEBGL1?this._result=!(!w.capabilities.textureFloat?.textureFloat||!w.capabilities.colorBufferFloat?.textureFloat):w.capabilities.textureFloat?.textureFloat&&w.capabilities.colorBufferFloat?.textureFloat&&w.capabilities.colorBufferFloat?.floatBlend&&(this._program=w.programCache.acquire("\n    precision highp float;\n    attribute vec2 a_pos;\n\n    void main() {\n      gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n    }\n    ",
"\n     precision highp float;\n\n     void main() {\n      gl_FragColor \x3d vec4(0.5, 0.5, 0.5, 0.5);\n     }\n    ",new Map([["a_pos",0]]))))}_test(w){const v=this._rctx;var x=new g.TextureDescriptor(1);x.wrapMode=f.TextureWrapMode.CLAMP_TO_EDGE;x.dataType=f.PixelType.FLOAT;x.internalFormat=f.SizedPixelFormat.RGBA32F;x.samplingMode=f.TextureSamplingMode.NEAREST;x=new n.FramebufferObject(v,x);var p=c.BufferObject.createVertex(v,f.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1]));p=new q.VertexArrayObject(v,
new Map([["a_pos",0]]),{geometry:[new e.VertexElementDescriptor("a_pos",2,f.DataType.UNSIGNED_SHORT,0,4)]},{geometry:p});v.useProgram(w);w=v.getBoundFramebufferObject();const {x:h,y:t,width:r,height:u}=v.getViewport();v.bindFramebuffer(x);v.setViewport(0,0,1,1);v.bindVAO(p);v.drawArrays(f.PrimitiveType.TRIANGLE_STRIP,0,4);var y=k.makePipelineState({blending:a.blendingAlpha});v.setPipelineState(y);v.drawArrays(f.PrimitiveType.TRIANGLE_STRIP,0,4);y=v.gl.getError();v.setViewport(h,t,r,u);v.bindFramebuffer(w);
p.dispose();x.dispose();return 1282===y?(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1):!0}}b.FloatBufferBlend=l;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testSamplerPrecision":function(){define("exports ../../core/Logger ./BufferObject ./enums ./FramebufferObject ./Texture ./TextureDescriptor ./VertexArrayObject ./VertexElementDescriptor ./WebGLDriverTestModule".split(" "),function(b,
a,c,d,f,n,k,g,q,e){class m extends e.WebGLDriverTestModule{constructor(l){super();this._rctx=l;this._program=l.programCache.acquire("\n      precision highp float;\n      attribute vec2 a_pos;\n      uniform highp sampler2D u_texture;\n      varying vec4 v_color;\n\n      float getBit(in float bitset, in int bitIndex) {\n        float offset \x3d pow(2.0, float(bitIndex));\n        return mod(floor(bitset / offset), 2.0);\n      }\n\n      void main() {\n        vec4 value \x3d texture2D(u_texture, vec2(0.0));\n        float bit \x3d getBit(value.x * 255.0, 1);\n\n        v_color \x3d bit * vec4(1.0);\n        gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n      }\n      ",
"\n      precision highp float;\n      varying vec4 v_color;\n\n      void main() {\n        gl_FragColor \x3d v_color;\n      }\n      ",new Map([["a_pos",0]]))}_test(l){const w=this._rctx;var v=new k.TextureDescriptor(1);v.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE;v.samplingMode=d.TextureSamplingMode.NEAREST;const x=new f.FramebufferObject(w,v),p=new Uint8Array(4);var h=c.BufferObject.createVertex(w,d.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1]));h=new g.VertexArrayObject(w,new Map([["a_position",
0]]),{geometry:[new q.VertexElementDescriptor("a_position",2,d.DataType.SHORT,0,4)]},{geometry:h});w.useProgram(l);v=new n.Texture(w,v,new Uint8Array([2,255,0,0]));l.setUniform1i("u_texture",0);w.bindTexture(v,0);v=w.getBoundFramebufferObject();w.bindFramebuffer(x);w.useProgram(l);const {x:t,y:r,width:u,height:y}=w.getViewport();w.setViewport(0,0,1,1);w.bindVAO(h);w.drawArrays(d.PrimitiveType.TRIANGLE_STRIP,0,4);w.setViewport(t,r,u,y);x.readPixels(0,0,1,1,d.PixelFormat.RGBA,d.PixelType.UNSIGNED_BYTE,
p);h.dispose();x.dispose();(l=255!==p[0]||255!==p[1]||255!==p[2]||255!==p[3])&&a.getLogger("esri.views.webgl.testSamplerPrecision").warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${p[0]}.${p[1]}.${p[2]}.${p[3]}]`);w.bindFramebuffer(v);return l}}
b.IgnoresSamplerPrecision=m;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testSVGPremultipliedAlpha":function(){define("exports ../2d/engine/webgl/DefaultVertexAttributeLayouts ./BufferObject ./enums ./FramebufferObject ./Texture ./TextureDescriptor ./VertexArrayObject ./WebGLDriverTestModule".split(" "),function(b,a,c,d,f,n,k,g,q){class e extends q.WebGLDriverTestModule{constructor(l){super();this._rctx=l;this._program=l.programCache.acquire("\n    precision highp float;\n\n    attribute vec2 a_pos;\n    varying vec2 v_uv;\n\n    void main() {\n      v_uv \x3d a_pos;\n      gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n    }\n    ",
"\n    precision highp float;\n\n    varying vec2 v_uv;\n\n    uniform sampler2D u_texture;\n\n    void main() {\n      gl_FragColor \x3d texture2D(u_texture, v_uv);\n    }\n    ",new Map([["a_pos",0]]))}dispose(){super.dispose()}_test(l){const w=this._rctx;if(!w.gl)return l.dispose(),!0;var v=new k.TextureDescriptor(1);v.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE;v.samplingMode=d.TextureSamplingMode.NEAREST;v=new f.FramebufferObject(w,v);var x=c.BufferObject.createVertex(w,d.Usage.STATIC_DRAW,new Uint16Array([0,
0,1,0,0,1,1,1]));x=new g.VertexArrayObject(w,new Map([["a_pos",0]]),a.Pos2us,{geometry:x});var p=new k.TextureDescriptor;p.samplingMode=d.TextureSamplingMode.LINEAR;p.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE;p=new n.Texture(w,p,m);w.useProgram(l);w.bindTexture(p,0);l.setUniform1i("u_texture",0);l=w.getBoundFramebufferObject();const {x:h,y:t,width:r,height:u}=w.getViewport();w.bindFramebuffer(v);w.setViewport(0,0,1,1);w.setClearColor(0,0,0,0);w.setBlendingEnabled(!1);w.clearSafe(d.ClearBufferBit.COLOR_BUFFER_BIT);
w.bindVAO(x);w.drawArrays(d.PrimitiveType.TRIANGLE_STRIP,0,4);const y=new Uint8Array(4);v.readPixels(0,0,1,1,d.PixelFormat.RGBA,d.PixelType.UNSIGNED_BYTE,y);x.dispose();v.dispose();p.dispose();w.setViewport(h,t,r,u);w.bindFramebuffer(l);return 255!==y[0]}}const m=new Image;m.src="data:image/svg+xml,%3C%3Fxml version\x3d'1.0' encoding\x3d'UTF-8'%3F%3E%3Csvg width\x3d'5' height\x3d'5' version\x3d'1.1' viewBox\x3d'0 0 5 5' xmlns\x3d'http://www.w3.org/2000/svg'%3E%3Crect width\x3d'5' height\x3d'5' fill\x3d'%23f00' fill-opacity\x3d'.5'/%3E%3C/svg%3E%0A";
m.width=5;m.height=5;m.decode();b.SVGPremultipliedAlpha=e;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/DefaultVertexAttributeLayouts":function(){define(["exports","../../../webgl/enums","../../../webgl/VertexElementDescriptor"],function(b,a,c){const d={geometry:[new c.VertexElementDescriptor("a_pos",2,a.DataType.BYTE,0,2)]},f={geometry:[new c.VertexElementDescriptor("a_pos",2,a.DataType.BYTE,0,4),new c.VertexElementDescriptor("a_tex",2,a.DataType.BYTE,
2,4)]};a={geometry:[new c.VertexElementDescriptor("a_pos",2,a.DataType.UNSIGNED_SHORT,0,4)]};b.Pos2b=d;b.Pos2us=a;b.PosTex2b=f;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/Capabilities":function(){define("exports ./DisjointTimerQuery ./DrawBuffers ./load ./LoseContext ./VertexArrayObjects".split(" "),function(b,a,c,d,f,n){class k{constructor(g,q){this._gl=g;this._textureFloatLinear=this._depthTexture=this._textureNorm16=this._drawBuffers=this._loseContext=
this._minMaxBlending=this._colorBufferFloat=this._textureFloat=this._textureFilterAnisotropic=this._compressedTextureS3TC=this._compressedTextureETC=this._vertexArrayObject=null;this._disabledExtensions=q.disabledExtensions||{};this._debugWebGLExtensions=q.debugWebGLExtensions||{}}get drawBuffers(){this._drawBuffers||(this._drawBuffers=c.load(this._gl,this._disabledExtensions));return this._drawBuffers}get vao(){this._vertexArrayObject||(this._vertexArrayObject=n.load(this._gl,this._disabledExtensions));
return this._vertexArrayObject}get compressedTextureETC(){this._compressedTextureETC||(this._compressedTextureETC=d.loadCompressedTextureETC(this._gl,this._disabledExtensions));return this._compressedTextureETC}get compressedTextureS3TC(){this._compressedTextureS3TC||(this._compressedTextureS3TC=d.loadCompressedTextureS3TC(this._gl,this._disabledExtensions));return this._compressedTextureS3TC}get textureFilterAnisotropic(){this._textureFilterAnisotropic||(this._textureFilterAnisotropic=d.loadTextureFilterAnisotropicCapability(this._gl,
this._disabledExtensions));return this._textureFilterAnisotropic}get disjointTimerQuery(){this._disjointTimerQuery||(this._disjointTimerQuery=a.createDisjointTimerQuery(this._gl,this._disabledExtensions));return this._disjointTimerQuery}get textureFloat(){this._textureFloat||(this._textureFloat=d.loadTextureFloat(this._gl,this._disabledExtensions));return this._textureFloat}get colorBufferFloat(){this._colorBufferFloat||(this._colorBufferFloat=d.loadColorBufferFloat(this._gl,this._disabledExtensions));
return this._colorBufferFloat}get blendMinMax(){this._minMaxBlending||(this._minMaxBlending=d.loadMinMaxBlending(this._gl,this._disabledExtensions));return this._minMaxBlending}get depthTexture(){null===this._depthTexture&&(this._depthTexture=d.loadBooleanExtension(this._gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"]));return this._depthTexture}get loseContext(){this._loseContext||(this._loseContext=f.load(this._gl,this._debugWebGLExtensions));
return this._loseContext}get textureNorm16(){this._textureNorm16||(this._textureNorm16=d.loadTextureNorm16(this._gl,this._disabledExtensions));return this._textureNorm16}get textureFloatLinear(){null===this._textureFloatLinear&&(this._textureFloatLinear=d.loadBooleanExtension(this._gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"]));return this._textureFloatLinear}enable(g){return this[g]}}b.Capabilities=k;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/views/webgl/capabilities/DrawBuffers":function(){define(["exports","./isWebGL2Context"],function(b,a){b.load=function(c,d){return d.disjointTimerQuery?null:a(c)?{drawBuffers:c.drawBuffers.bind(c),MAX_DRAW_BUFFERS:c.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:c.MAX_COLOR_ATTACHMENTS}:d.drawBuffers?null:(c=c.getExtension("WEBGL_draw_buffers"))?{drawBuffers:c.drawBuffersWEBGL.bind(c),MAX_DRAW_BUFFERS:c.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:c.MAX_COLOR_ATTACHMENTS_WEBGL}:null};Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/load":function(){define(["exports","./isWebGL2Context"],function(b,a){b.loadBooleanExtension=function(c,d,f,n,k){if(n&&a(c))return!0;if(d[f])return!1;for(const g of k)if(c.getExtension(g))return!0;return!1};b.loadColorBufferFloat=function(c,d){if(a(c)){var f=!d.colorBufferHalfFloat&&c.getExtension("EXT_color_buffer_half_float")||!d.colorBufferFloat&&c.getExtension("EXT_color_buffer_float"),n=!d.colorBufferFloat&&c.getExtension("EXT_color_buffer_float");
d=!d.floatBlend&&!d.colorBufferFloat&&c.getExtension("EXT_float_blend");return f||n||d?{textureFloat:!!n,textureHalfFloat:!!f,floatBlend:!!d,R16F:c.R16F,RG16F:c.RG16F,RGBA16F:c.RGBA16F,R32F:c.R32F,RG32F:c.RG32F,RGBA32F:c.RGBA32F,R11F_G11F_B10F:c.R11F_G11F_B10F,RGB16F:c.RGB16F}:null}return c instanceof WebGLRenderingContext?(f=!d.colorBufferHalfFloat&&c.getExtension("EXT_color_buffer_half_float"),n=!d.colorBufferFloat&&c.getExtension("WEBGL_color_buffer_float"),c=!d.floatBlend&&!d.colorBufferFloat&&
c.getExtension("EXT_float_blend"),f||n||c?{textureFloat:!!n,textureHalfFloat:!!f,floatBlend:!!c,RGBA16F:f?f.RGBA16F_EXT:void 0,RGB16F:f?f.RGB16F_EXT:void 0,RGBA32F:n?n.RGBA32F_EXT:void 0}:null):null};b.loadCompressedTextureETC=function(c,d){return d.compressedTextureETC?null:(c=c.getExtension("WEBGL_compressed_texture_etc"))?{COMPRESSED_R11_EAC:c.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:c.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:c.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:c.COMPRESSED_SIGNED_RG11_EAC,
COMPRESSED_RGB8_ETC2:c.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:c.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:c.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:c.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:c.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:c.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null};b.loadCompressedTextureS3TC=function(c,d){return d.compressedTextureS3TC?null:(c=c.getExtension("WEBGL_compressed_texture_s3tc"))?
{COMPRESSED_RGB_S3TC_DXT1:c.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:c.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:c.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:c.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null};b.loadMinMaxBlending=function(c,d){return a(c)?{MIN:c.MIN,MAX:c.MAX}:d.blendMinMax?null:(c=c.getExtension("EXT_blend_minmax"))?{MIN:c.MIN_EXT,MAX:c.MAX_EXT}:null};b.loadTextureFilterAnisotropicCapability=function(c,d){return d.textureFilterAnisotropic?null:(c=c.getExtension("EXT_texture_filter_anisotropic")||
c.getExtension("MOZ_EXT_texture_filter_anisotropic")||c.getExtension("WEBKIT_EXT_texture_filter_anisotropic"))?{MAX_TEXTURE_MAX_ANISOTROPY:c.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:c.TEXTURE_MAX_ANISOTROPY_EXT}:null};b.loadTextureFloat=function(c,d){if(a(c))return{textureFloat:!0,textureFloatLinear:!d.textureFloatLinear&&!!c.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!0,HALF_FLOAT:c.HALF_FLOAT,R16F:c.R16F,RG16F:c.RG16F,RGBA16F:c.RGBA16F,R32F:c.R32F,
RG32F:c.RG32F,RGBA32F:c.RGBA32F,R11F_G11F_B10F:c.R11F_G11F_B10F,RGB16F:c.RGB16F};if(c instanceof WebGLRenderingContext){const f=!d.textureHalfFloat&&c.getExtension("OES_texture_half_float");return{textureFloat:!d.textureFloat&&!!c.getExtension("OES_texture_float"),textureFloatLinear:!d.textureFloatLinear&&!!c.getExtension("OES_texture_float_linear"),textureHalfFloat:!!f,textureHalfFloatLinear:!d.textureHalfFloatLinear&&!!c.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:f?f.HALF_FLOAT_OES:
void 0}}return null};b.loadTextureNorm16=function(c,d){return!a(c)||d.textureNorm16?null:(c=c.getExtension("EXT_texture_norm16"))?{R16:c.R16_EXT,RG16:c.RG16_EXT,RGB16:c.RGB16_EXT,RGBA16:c.RGBA16_EXT,R16_SNORM:c.R16_SNORM_EXT,RG16_SNORM:c.RG16_SNORM_EXT,RGB16_SNORM:c.RGB16_SNORM_EXT,RGBA16_SNORM:c.RGBA16_SNORM_EXT}:null};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/LoseContext":function(){define(["exports"],function(b){b.load=function(a,c){const d=
c.loseContext&&a.getExtension("WEBGL_lose_context");return d?{loseRenderingContext:()=>d.loseContext()}:null};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/VertexArrayObjects":function(){define(["exports","./isWebGL2Context"],function(b,a){b.load=function(c,d){return a(c)?{createVertexArray:c.createVertexArray.bind(c),deleteVertexArray:c.deleteVertexArray.bind(c),bindVertexArray:c.bindVertexArray.bind(c)}:d.vao?null:(c=c.getExtension("OES_vertex_array_object")||
c.getExtension("MOZ_OES_vertex_array_object")||c.getExtension("WEBKIT_OES_vertex_array_object"))?{createVertexArray:c.createVertexArrayOES.bind(c),deleteVertexArray:c.deleteVertexArrayOES.bind(c),bindVertexArray:c.bindVertexArrayOES.bind(c)}:null};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextureRepository":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ./basicInterfaces ./ContentObjectType ./ITexture ./TextureTechnique ./TextureTechniqueConfiguration ./Util ../../../support/Scheduler".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t){b.TextureRepository=class extends c{constructor(u,y,z){super({});this._stage=u;this._techniqueRepository=y;this._rctx=z;this._textures=new Map;this._loadingCount=0;this._frameUpdates=new Map;this.events=new d;this._frameTask=u.view.resourceController.scheduler.registerTask(t.TaskPriority.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}destroy(){this._frameTask.remove();this._stage.forEachOfType(w.ContentObjectType.Texture,u=>u.unload())}get updating(){return 0<
this._loadingCount||this._frameTask.updating}get textureTechnique(){null==this._textureTechnique&&(this._textureTechnique=this._techniqueRepository.acquire(x.TextureTechnique,new p.TextureTechniqueConfiguration));return this._textureTechnique}acquire(u){const y=this._textures.get(u);return y?(y.ref(),y.loadingPromise??y):this._createNewRef(u)}update(){let u=!1;this._frameUpdates.forEach(y=>{const z=y.texture.frameUpdate(y.previousToken);0<=z&&z!==y.previousToken&&(y.previousToken=z,u=!0)});u&&this.events.emit("changed",
l.RenderRequestType.BACKGROUND)}_createNewRef(u){const y=this._stage.getObject(u);if(null==y)return h.assert(void 0!==y),null;const z=y.events.on("unloaded",()=>{z.remove();this._onTextureUnloaded(u)}),A=new r(u,()=>{this._frameTask.schedule(()=>{A.isUnreferenced&&y.unload()})});this._textures.set(u,A);A.ref();if(y.glTexture)return this._updateGLTexture(A,y.glTexture),v.isFrameUpdateTexture(y)&&this._frameUpdates.set(u,{texture:y,previousToken:-1}),A;this._loadingCount++;A.loadingPromise=this._stage.schedule(()=>
{const C=y.load(this._rctx),E=D=>{this._loadingCount--;A.loadingPromise=null;this._updateGLTexture(A,D);v.isFrameUpdateTexture(y)&&this._frameUpdates.set(u,{texture:y,previousToken:-1});return A},B=D=>{this._loadingCount--;A.loadingPromise=null;n.isAbortError(D)||f.getLogger(this).error(D);return null};return n.isPromiseLike(C)?C.then(E,B):E(C)});return A.loadingPromise}_updateGLTexture(u,y){u.glTexture=y;this.events.emit("changed",l.RenderRequestType.UPDATE)}_onTextureUnloaded(u){this._textures.delete(u);
this._frameUpdates.delete(u)}};a.__decorate([k.property()],b.TextureRepository.prototype,"_loadingCount",void 0);a.__decorate([k.property()],b.TextureRepository.prototype,"_frameTask",void 0);a.__decorate([k.property()],b.TextureRepository.prototype,"updating",null);b.TextureRepository=a.__decorate([m.subclass("esri.views.3d.webgl-engine.lib.TextureRepository")],b.TextureRepository);class r{constructor(u,y){this.id=u;this._release=y;this._refCount=0}get isUnreferenced(){return 0===this._refCount}ref(){++this._refCount}release(){--this._refCount;
0<this._refCount||(0===this._refCount?this._release():(f.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository.RefCountedTextureImpl").error("Cannot dereference texture that has no references!"),this._refCount=0))}}Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ITexture":function(){define(["exports"],function(b){b.isFrameUpdateTexture=function(a){return!!a.frameUpdate};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/markerTextureRepository":function(){define(["exports",
"../../support/engineContent/marker","./ProceduralTextureRepository"],function(b,a,c){b.createMarkerTextureRepository=function(d,f){return new c.ProceduralTextureRepository(n=>a.createMarkerTexture(n,d),n=>n,f)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/internal/WaterTextureRepository":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../assets ../../../../../core/Accessor ../../../../../core/asyncUtils ../../../../../core/Logger ../../../../../core/maybe ../../../../../core/promiseUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../support/requestImageUtils ../../core/shaderModules/interfaces ../../lib/basicInterfaces ../../../../webgl/enums ../../../../webgl/Texture ../../../../webgl/TextureDescriptor".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r){b.WaterTextureRepository=class extends d{constructor(){super(...arguments);this._passParameters=new u;this._resourcesTask=null}get passParameters(){return this._passParameters}destroy(){this._resourcesTask=k.abortMaybe(this._resourcesTask);this._passParameters.waveNormal=k.disposeMaybe(this._passParameters.waveNormal);this._passParameters.wavePerturbation=k.disposeMaybe(this._passParameters.wavePerturbation)}get updating(){return!!this._resourcesTask&&
!this._resourcesTask.finished}ensureResources(y){this._resourcesTask||(this._resourcesTask=f.createTask(async z=>{await Promise.allSettled([this._loadImageResource(y,c.getAssetUrl("esri/images/materials/water/normals.jpg"),A=>this._passParameters.waveNormal=A,z),this._loadImageResource(y,c.getAssetUrl("esri/images/materials/water/perturbation.jpg"),A=>this._passParameters.wavePerturbation=A,z)])}));return this._resourcesTask.finished?p.ResourceState.LOADED:p.ResourceState.LOADING}async _loadImageResource(y,
z,A,C){try{const E=await v.requestImage(z,{signal:C});g.throwIfAborted(C);const B=new r.TextureDescriptor(E.width,E.height);B.pixelFormat=h.PixelFormat.RGB;B.samplingMode=h.TextureSamplingMode.LINEAR_MIPMAP_LINEAR;B.hasMipmap=!0;B.maxAnisotropy=8;A(new t.Texture(y,B,E))}catch(E){n.getLogger(this).error("Failed to load water material normal texture.",E)}}};a.__decorate([q.property()],b.WaterTextureRepository.prototype,"_resourcesTask",void 0);a.__decorate([q.property({type:Boolean,readOnly:!0})],b.WaterTextureRepository.prototype,
"updating",null);b.WaterTextureRepository=a.__decorate([w.subclass("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],b.WaterTextureRepository);class u extends x.NoParameters{}b.WaterTexturePassParameters=u;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/parts/contextCache":function(){define(["exports"],function(b){const a=new Map;b.getContextCache=function(){return a};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/parts/ScreenshotManager":function(){define("exports ../../../../core/promiseUtils ../../../../chunks/vec4f64 ../core/FBOCache ../lib/basicInterfaces ../../../support/RenderState ../../../support/screenshotUtils ../../../webgl/enums ../../../webgl/FramebufferObject ../../../../core/imageUtils".split(" "),function(b,a,c,d,f,n,k,g,q,e){class m{constructor(w,v,x){this.parameters=w;this.frameHasDecorations=v;this.fbos=x}}class l{constructor(w,v,x){this._rctx=w;this._renderFunctions=
v;this._forceCameraHook=x;this.supersample=!0;this._screenshotQueue=[]}destroy(){this._rctx=null}async takeScreenshot(w){await this._renderFunctions.prepareOverlay();this._renderFunctions.requestRenderScene(f.RenderRequestType.BACKGROUND);const v=a.createResolver();this._screenshotQueue.push({settings:w,resolver:v});return v.promise}update(w,v){for(const x of this._screenshotQueue){if(null==this._rctx){x.resolver.reject();continue}const p=this._renderScreenshot(w,{...x.settings,pixelRatio:x.settings.pixelRatio*
w.parameters.camera.pixelRatio},v);x.resolver(p)}this._screenshotQueue.length=0}_renderScreenshotOverlay(w,v,x){w.width=v.width;w.height=v.height;const p=w.getContext("2d"),h=x.pixelRatio;p.save();p.translate(0,v.height);p.scale(1,-1);x.region&&p.translate(-x.region.x,-x.region.y);p.scale(h,h);v=this._renderFunctions.renderOverlay(w,x.disableDecorations?f.Decorations.OFF:f.Decorations.ON,v);p.restore();return v}_readbackScreenshot(w,v){return w.resample?this._readbackScreenshotResampled({...w,resample:w.resample},
v):this._readbackScreenshotImmediate(w,v)}_readbackScreenshotResampled(w,v){const {framebufferWidth:x,framebufferHeight:p,region:h,resample:t}=w,r=this._ensureScreenshotEncodeCanvas();let u=e.createEmptyImageData(x,p,r);this._rctx.gl.readPixels(0,0,x,p,g.PixelFormat.RGBA,g.DataType.UNSIGNED_BYTE,new Uint8Array(u.data.buffer));v();u=this._renderScreenshotOverlay(r,u,{...w,region:void 0});w=e.createEmptyImageData(h.width,h.height,r);return k.resampleHermite(u,w,!0,t.region.x,p-(t.region.y+t.region.height),
t.region.width,t.region.height)}_readbackScreenshotImmediate(w,v){const {framebufferHeight:x,region:p}=w,h=this._ensureScreenshotEncodeCanvas(),t=e.createEmptyImageData(p.width,p.height,h);this._rctx.gl.readPixels(p.x,x-(p.y+p.height),p.width,p.height,g.PixelFormat.RGBA,g.DataType.UNSIGNED_BYTE,new Uint8Array(t.data.buffer));v();return this._renderScreenshotOverlay(h,t,w)}_renderScreenshot(w,v,x){var p=w.parameters.camera,h={width:v.framebufferWidth,height:v.framebufferHeight};q.ensureAttachmentMaxSize(h,
Math.min(this._rctx.parameters.maxTextureSize,this._rctx.parameters.maxRenderbufferSize));var t=!1,r=v.disableDecorations&&w.frameHasDecorations,u=v.ignorePadding&&p.pixelRatio!==v.pixelRatio;r=h.width!==p.fullWidth||h.height!==p.fullHeight||r||u||v.objectAndLayerIdColor;let y=null;v.objectAndLayerIdColor&&(y=w.fbos.acquire(d.ColorFormat.RGBA,h.width,h.height),y.acquireDepth(d.DepthFormat.DEPTH_STENCIL_BUFFER));let z=null;if(r){t=p.clone();if(v.ignorePadding){u=c.clone(t.padding);for(var A=0;4>A;A++)u[A]=
Math.round(u[A]/t.pixelRatio*v.pixelRatio);t.padding=u}t.fullWidth=h.width;t.fullHeight=h.height;t.pixelRatio=v.pixelRatio;u=p.fovX-t.fovX;A=p.fovY-t.fovY;0>u&&u<A?t.fovX=p.fovX:0>A&&A<u&&(t.fovY=p.fovY);p={camera:t,contentCamera:t,mode:n.RenderState.IDLE,alignPixelEnabled:!0,contentPixelRatio:t.pixelRatio};this._forceCameraHook(p);t=!0;z=w.fbos.acquire(d.ColorFormat.RGBA,h.width,h.height);this._renderFunctions.renderScene(z,y,p,v.disableDecorations?f.Decorations.OFF:f.Decorations.ON,x)}this._rctx.bindFramebuffer(z?.fbo);
x=this._readbackScreenshot(v,()=>{this._rctx.bindFramebuffer(null);z?.release()});h=null;v.objectAndLayerIdColor&&(this._rctx.bindFramebuffer(y?.fbo),h=this._readbackScreenshot(v,()=>{this._rctx.bindFramebuffer(null);y?.release()}),this._rctx.bindFramebuffer(null));if(r&&!this._rctx.contextAttributes.alpha)for(v=3;v<x.data.length;v+=4)x.data[v]=255;if(h&&!this._rctx.contextAttributes.alpha)for(v=3;v<h.data.length;v+=4)h.data[v]=255;t&&this._forceCameraHook(w.parameters);return[x,h]}_ensureScreenshotEncodeCanvas(){this._screenshotEncodeCanvas||
(this._screenshotEncodeCanvas=document.createElement("canvas"));return this._screenshotEncodeCanvas}}b.ScreenshotContext=m;b.ScreenshotManager=l;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/screenshotUtils":function(){define(["exports","../../core/has","../../core/mathUtils","../../core/imageUtils"],function(b,a,c,d){function f(p,h){const {format:t,quality:r,rotation:u,disableDecorations:y}=p||{};var z=e(p,h.padding);var A=h.width-z.left-z.right;h=h.height-z.top-
z.bottom;z={x:0,y:0,width:A,height:h};if(p?.area){null!=p.area.x&&(z.x=Math.floor(p.area.x));null!=p.area.y&&(z.y=Math.floor(p.area.y));var C=null!=p.area.width?Math.floor(p.area.width):null,E=null!=p.area.height?Math.floor(p.area.height):null;z.width=A-z.x;z.height=h-z.y;null!=C&&null!=E?(z.width=Math.min(z.width,C),z.height=Math.min(z.height,E)):null==C&&null!=E?(C=Math.min(z.width,C),z.height*=C/z.width,z.width=C):null!=C&&null==E&&(C=Math.min(z.height,E),z.width*=C/z.height,z.height=C)}z=q(z,
p);C=Math.floor(Math.max(z.x,0));E=Math.floor(Math.max(z.y,0));A={x:C,y:E,width:Math.floor(Math.min(z.width,A-C)),height:Math.floor(Math.min(z.height,h-E))};h=A.width/A.height;z=z.width/z.height;z!==h&&(z>h?(h=Math.floor(A.width/z),A={x:A.x,y:Math.floor(A.y+(A.height-h)/2),width:A.width,height:h}):(h=Math.floor(A.height*z),A={x:Math.floor(A.x+(A.width-h)/2),y:A.y,width:h,height:A.height}));const {width:B,height:D}=g(p,A);h=m(t);z=v[h];z=c.clamp(null!=r?r:z,0,100);return{format:h,quality:z,area:A,
width:B,height:D,rotation:u,disableDecorations:!!y,ignoreBackground:!!p?.ignoreBackground,ignorePadding:!!p?.ignorePadding}}function n(p,h){null==l&&(l=document.createElement("canvas"));var t=l;if(h.premultipliedAlpha){var r=p.data;const y=r.length;for(let z=0;z<y;z+=4){var u=r[z+3];255!==u&&0<u&&(u=255/u,r[z]*=u,r[z+1]*=u,r[z+2]*=u)}}t.width=p.width;t.height=p.height;r=t.getContext("2d",{willReadFrequently:!0});r.putImageData(p,0,0);h.flipY&&(r.save(),r.globalCompositeOperation="copy",r.scale(1,
-1),r.translate(0,-r.canvas.height),r.drawImage(r.canvas,0,0),r.restore());return{ctx:r,canvas:t}}function k(p,h){return p.toDataURL(w[h.format],h.quality/100)}function g(p,h){if(!p)return h;const t=p.width;p=p.height;if(null!=t&&null!=p)return{width:Math.floor(t),height:Math.floor(p)};if(null==t&&null==p)return h;h=h.width/h.height;return null==p?{width:Math.floor(t),height:Math.floor(t/h)}:{width:Math.floor(p*h),height:Math.floor(p)}}function q(p,h){if(null==h?.width||null==h.height)return p;h=
h.width/h.height;const t=p.width/p.height;if(t===h)return p;if(t<h)return h=Math.floor(p.height*h),p.x-=(h-p.width)/2,p.width=h,p;h=Math.floor(p.width/h);p.y-=(h-p.height)/2;p.height=h;return p}function e(p,h){return!h||p&&p.ignorePadding?x:h}function m(p){switch(p){case "png":case "jpg":case "jpeg":return p;case null:case void 0:return"png";default:return"png"}}let l=null;const w={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},v={png:100,jpg:98,jpeg:98},x={top:0,right:0,bottom:0,left:0};b.createEmptyImageData=
d.createEmptyImageData;b.completeUserSettings=f;b.encode=function(p,h,t){const {ctx:r,canvas:u}=n(p,t);p=r.getImageData(0,0,p.width,p.height);h=k(u,h);u.width=0;u.height=0;return{dataUrl:h,data:p}};b.encodeData=function(p,h){const {ctx:t,canvas:r}=n(p,h);p=t.getImageData(0,0,p.width,p.height);r.width=0;r.height=0;return p};b.getFormatAndQuality=function(p,h){p=m(p);const t=v[p];h=c.clamp(null!=h?h:t,0,100);return{format:p,quality:h}};b.getMaximumResolutionScale=function(p,h){return h/Math.max(p[0],
p[1])};b.resampleHermite=function(p,h,t,r=0,u=0,y=p.width-r,z=p.height-u,A=!1){const {data:C}=p,{width:E,height:B,data:D}=h;y/=E;z/=B;const F=Math.ceil(y/2),K=Math.ceil(z/2);p=p.width;for(let O=0;O<B;O++)for(let P=0;P<E;P++){const J=4*(P+(A?B-O-1:O)*E);let R=0,X=0,U=0,M=0,V=0,Y=0;const W=(O+.5)*z;for(let H=Math.floor(O*z);H<(O+1)*z;H++){var L=Math.abs(W-(H+.5))/K;const S=(P+.5)*y;L*=L;for(let I=Math.floor(P*y);I<(P+1)*y;I++){var G=Math.abs(S-(I+.5))/F;G=Math.sqrt(L+G*G);if(1<=G)continue;G=2*G*G*G-
3*G*G+1;const Q=4*(r+I+(u+H)*p);Y+=G*C[Q+3];X+=G;!t&&255>C[Q+3]&&(G=G*C[Q+3]/255);U+=G*C[Q];M+=G*C[Q+1];V+=G*C[Q+2];R+=G}}D[J]=U/R;D[J+1]=M/R;D[J+2]=V/R;D[J+3]=Y/X}return h};b.screenshotSuperSampleSettings=function(p,h,t){if(!h)return p;const {framebufferWidth:r,framebufferHeight:u,pixelRatio:y,region:z}=p;h=e(p,t);t=h.left+h.right;const A=h.top+h.bottom,C=r-t,E=u-A,B=Math.min(8,Math.min((2048-t)/C,(2048-A)/E));return 1.5>B?p:{...p,framebufferWidth:Math.round(C*B)+t,framebufferHeight:Math.round(E*
B)+A,pixelRatio:y*B,resample:{region:{x:Math.round((z.x-h.left)*B)+h.left,y:Math.round((z.y-h.top)*B)+h.top,width:Math.round(z.width*B),height:Math.round(z.height*B)},width:r,height:u}}};b.toDataUrl=k;b.toRenderSettings=function(p,h){const t=f(p,h),r=t.area,u=t.width/r.width,y=e(t,h.padding),z=y.left+y.right,A=y.top+y.bottom;return{framebufferWidth:Math.floor((h.width-z)*u+z),framebufferHeight:Math.floor((h.height-A)*u+A),region:{x:Math.floor(r.x*u)+y.left,y:Math.floor(r.y*u)+y.top,width:t.width,
height:t.height},format:t.format,quality:t.quality,rotation:t.rotation,pixelRatio:u,layers:p?.layers??[],disableDecorations:t.disableDecorations,ignoreBackground:t.ignoreBackground,ignorePadding:t.ignorePadding,objectAndLayerIdColor:!1}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/parts/testUtils":function(){define(["exports","./contextCache"],function(b,a){b.contextCache={enabled:!1,disposeContextCache:()=>{const c=a.getContextCache();c.forEach(d=>
d.dispose());c.clear()}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/intersectorUtilsConversions":function(){define("exports ../../../../chunks/mat4 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../chunks/sphere ../../layers/i3s/Intersector ../../terrain/Intersector ./intersectorUtils ./lodRendering/Intersector".split(" "),function(b,a,c,d,f,n,k,g,q){function e(h,t){return null==h?null:g.isObjectIntersectorResult(h)||
g.isHudIntersectorResult(h)?m(h.target?.object,t):n.isPclIntersectorResult(h)?(h=h.target.createGraphic(),{type:"graphic",graphic:h,layer:h.layer}):n.isVoxelIntersectorResult(h)?(h=h.target.createVoxelGraphic(),{type:"graphic",graphic:h,layer:h.layer}):k.isOverlayIntersectorResult(h)||q.isLodIntersectorResult(h)?m(h.target,t):n.isI3sIntersectorResult(h)?l(h.target,t):null}function m(h,t){if(null==h?.graphicUid)return null;const r=x(h,t);if(null==r)return null;if(r===t.graphics)return null==t.graphicsView||
"number"!==typeof h.graphicUid?null:t.graphicsView.getHit(h.graphicUid);t=t.allLayerViews.find(u=>u.layer===r);return!t||t.suspended||null==h.graphicUid?null:"getHit"in t?t.getHit(h.graphicUid):null}function l(h,t){const r=x(h,t);return null==r?null:(t=t.allLayerViews.find(u=>u.layer===r))&&!t.suspended&&"getGraphicFromIntersectorTarget"in t?v(t.getGraphicFromIntersectorTarget(h)):null}function w(h,t){const r=x(h,t);return null==r?null:(t=t.allLayerViews.find(u=>u.layer===r))&&!t.suspended&&"getAABBFromIntersectorTarget"in
t?t.getAABBFromIntersectorTarget(h):null}function v(h){return null!=h?{type:"graphic",graphic:h,layer:h.layer}:null}function x(h,t){return null==h?.layerUid?null:null!=t.graphicsView&&h.layerUid===t.graphicsView.processor.layer.id?t.graphics:t.map.findLayerByUid(h.layerUid)}const p=c.create();b.getIntersectedFeatureBSRadius=function(h,t){return g.isObjectIntersectorResult(h)||g.isHudIntersectorResult(h)?f.getRadius(h.target.object.boundingVolumeWorldSpace.bounds):q.isLodIntersectorResult(h)?(a.getScaling(p,
h.transformation),h.target.baseBoundingSphere.radius*Math.max(p[0],p[1],p[2])):n.isI3sIntersectorResult(h)?(h=w(h.target,t))?.5*d.diameter(h):null:null};b.hasLod=function(h){return g.isObjectIntersectorResult(h)||g.isHudIntersectorResult(h)?!1:q.isLodIntersectorResult(h)?1<h.target.numLodLevels:n.isI3sIntersectorResult(h)?!0:!1};b.toGraphic=function(h,t){h=e(h,t);return null!=h&&"graphic"===h.type?h.graphic:null};b.toHit=e;b.toOwner=function(h,t){return g.isObjectIntersectorResult(h)||g.isHudIntersectorResult(h)?
x(h.target?.object,t):k.isTerrainIntersectorResult(h)?t.map?.ground:n.isPclIntersectorResult(h)||n.isI3sIntersectorResult(h)||k.isOverlayIntersectorResult(h)||n.isVoxelIntersectorResult(h)?x(h.target,t):null};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/Intersector":function(){define(["exports","../../webgl-engine/lib/IntersectorInterfaces","../../webgl-engine/lib/IntersectorTarget","../../webgl-engine/lib/intersectorUtils"],function(b,a,c,d){class f extends c.Graphic3DTarget{constructor(g,
q,e,m){super(q,e);this.point=g;this.createGraphic=m}}class n extends c.LayerTarget{constructor(g,q,e,m,l){super(g);this.layerUid=g;this.sublayerUid=q;this.nodeIndex=e;this.componentIndex=m;this.triangleNr=l}}class k extends c.Graphic3DTarget{constructor(g,q,e){super(q,null);this.point=g;this.createVoxelGraphic=e}}b.I3sTarget=n;b.PclTarget=f;b.VoxelTarget=k;b.isI3sIntersectorResult=function(g){return d.isValidIntersectorResult(g)&&g.intersector===a.IntersectorType.I3S&&!!g.target};b.isPclIntersectorResult=
function(g){return d.isValidIntersectorResult(g)&&g.intersector===a.IntersectorType.PCL&&!!g.target};b.isVoxelIntersectorResult=function(g){return d.isValidIntersectorResult(g)&&g.intersector===a.IntersectorType.VOXEL&&!!g.target};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/hitTestSelectUtils":function(){define(["exports"],function(b){function a(c){return"graphic"===c?.type}b.filterGraphicHits=function(c){return c.filter(a)};b.findFirstGraphicHit=function(c){return c.find(a)??
null};b.hitTestSelectSimilarDistance=async function(c,d){if("2d"===c.type)return c.hitTest(d);c=await c.hitTest(d);if(0===c.results.length)return c;const f=1.05*(c.results[0].distance??0);d=c.results.findIndex(n=>(n.distance??0)>f);-1!==d&&(c.results=c.results.slice(0,d));return c};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/layerViewUtils":function(){define(["exports"],function(b){b.extractSafeScaleBounds=function(a){a=a.effectiveScaleRange;return{minScale:a?.minScale??
0,maxScale:a?.maxScale??0}};b.highlightsSupported=function(a){return a&&"function"===typeof a.highlight};b.isScaleRangeActive=function(a,c){return null!=a&&0<a||null!=c&&0<c};b.isSelectableLayerView2D=function(a){return null!=a&&"object"===typeof a&&"createQuery"in a&&"queryFeatures"in a&&"layer"in a&&"view"in a};b.occludeesSupported=function(a){return a&&"function"===typeof a.maskOccludee};b.scaleBoundsPredicate=function(a,c,d){return null==a||a>d&&(0===c||a<c)};Object.defineProperty(b,Symbol.toStringTag,
{value:"Module"})})},"esri/views/support/WebGLRequirements":function(){define(["exports","../../core/Error","../webgl/capabilities","../webgl/contextUtils"],function(b,a,c,d){b.check=function(f){const n=c.getWebGLCapabilities(f);if(!n.available)return"3d"===f?new a("webgl:required","WebGL2 is required but not supported.",Error().stack):new a("webgl:required","WebGL is required but not supported.",Error().stack);if("3d"===f&&n.majorPerformanceCaveat)return new a("webgl:major-performance-caveat-detected",
"Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.");if(!n.supportsHighPrecisionFragment)return new a("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported.");if(!n.supportsVertexShaderSamplers)return new a("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported.");if(n.type===d.ContextType.WEBGL1){if(!n.supportsElementIndexUint)return new a("webgl:element-index-uint-required",
"WebGL support for uint vertex indices is required but not supported.");if(!n.supportsStandardDerivatives)return new a("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported.");if(!n.supportsInstancedArrays)return new a("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported.")}return null};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities":function(){define(["exports",
"./contextUtils"],function(b,a){function c(l){switch(l){case a.ContextType.WEBGL1:return d();case a.ContextType.WEBGL2:return f()}}function d(){if(!k){{const l=new e,w=n(a.ContextType.WEBGL1,l);null!=w&&(l.supportsElementIndexUint=null!==w.getExtension("OES_element_index_uint"),l.supportsStandardDerivatives=null!==w.getExtension("OES_standard_derivatives"),l.supportsInstancedArrays=null!==w.getExtension("ANGLE_instanced_arrays"),l.supportsTextureFloat=null!==w.getExtension("OES_texture_float"),l.supportsTextureHalfFloat=
null!==w.getExtension("OES_texture_half_float"),l.supportsColorBufferFloat=null!==w.getExtension("WEBGL_color_buffer_float"),l.supportsColorBufferFloatBlend=null!==w.getExtension("EXT_float_blend"),l.supportsColorBufferHalfFloat=null!==w.getExtension("EXT_color_buffer_half_float"));k=l}}return k}function f(){if(!g){{const l=new m,w=n(a.ContextType.WEBGL2,l);null!=w&&(l.supportsColorBufferFloat=null!==w.getExtension("EXT_color_buffer_float"),l.supportsColorBufferFloatBlend=null!==w.getExtension("EXT_float_blend"),
l.supportsColorBufferHalfFloat=l.supportsColorBufferFloat||null!==w.getExtension("EXT_color_buffer_half_float"));g=l}}return g}function n(l,w){if(l===a.ContextType.WEBGL1&&"undefined"===typeof WebGLRenderingContext||l===a.ContextType.WEBGL2&&"undefined"===typeof WebGL2RenderingContext)return null;const v=document.createElement("canvas");if(!v)return null;let x=a.createContext(v,l,{failIfMajorPerformanceCaveat:!0});null==x&&(x=a.createContext(v,l),null!=x&&(w.majorPerformanceCaveat=!0));if(null==x)return x;
if(l===a.ContextType.WEBGL1){if(l=x.getParameter(x.VERSION)?.match(/^WebGL\s+([\d.]*)/))l=parseFloat(l[1]),w.available=.94<=l}else w.available=!0;w.maxTextureSize=x.getParameter(x.MAX_TEXTURE_SIZE);w.supportsVertexShaderSamplers=0<x.getParameter(x.MAX_VERTEX_TEXTURE_IMAGE_UNITS);if(l=x.getShaderPrecisionFormat(x.FRAGMENT_SHADER,x.HIGH_FLOAT))w.supportsHighPrecisionFragment=0<l.precision;return x}let k,g;class q{constructor(){this.majorPerformanceCaveat=this.available=!1;this.maxTextureSize=0;this.supportsColorBufferHalfFloat=
this.supportsColorBufferFloatBlend=this.supportsColorBufferFloat=this.supportsTextureHalfFloat=this.supportsTextureFloat=this.supportsInstancedArrays=this.supportsStandardDerivatives=this.supportsElementIndexUint=this.supportsHighPrecisionFragment=this.supportsVertexShaderSamplers=!1}}class e extends q{constructor(){super(...arguments);this.type=a.ContextType.WEBGL1}}class m extends q{constructor(){super(...arguments);this.type=a.ContextType.WEBGL2;this.supportsTextureHalfFloat=this.supportsTextureFloat=
this.supportsInstancedArrays=this.supportsStandardDerivatives=this.supportsElementIndexUint=!0}}b.getWebGL1Capabilities=d;b.getWebGL2Capabilities=f;b.getWebGLCapabilities=function(l){for(l=a.getContextTypes(l);1<l.length;){const w=c(l.shift());if(w.available)return w}return c(l.shift())};b.getWebGLVersionCapabilities=c;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/ui/DefaultUI":function(){define("../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/subclass ./Component ./UI ../../widgets/Attribution ../../widgets/Compass ../../widgets/NavigationToggle ../../widgets/Zoom".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v){a=class extends e{constructor(x){super(x);this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"};this.components=[];this._updateViewAwareWidgets=p=>{this.components.forEach(h=>{h=this._find(h)?.widget;void 0!==h?.view&&(h.view=p)})};this._componentsWatcher=(p,h)=>{this._removeComponents(h);this._addComponents(p);this._adjustPadding(p)}}initialize(){this.addHandles([d.watch(()=>this.components,this._componentsWatcher,
d.initial),d.watch(()=>this.view,this._updateViewAwareWidgets,d.initial)])}_add(x,p,h,t,r){let u=x;if("string"===typeof x&&this._defaultPositionLookup[x]){if(this._find(x))return;u=this._createComponent(x)}super._add(u,p,h,t,r)}_removeComponents(x){x.forEach(p=>{if(p=this._find(p))this.remove(p),p.destroy()})}_adjustPadding(x){x.includes("attribution")||this._isOverridden("padding")||({top:x}=this.padding,this.padding=x)}_addComponents(x){this.constructed&&x.forEach(p=>this.add(this._createComponent(p),
this._defaultPositionLookup[p]))}_createComponent(x){const p=this._createWidget(x);return new q({id:x,node:p})}_createWidget(x){const {view:p}=this;switch(x){case "attribution":return new m({view:p});case "compass":return new l({view:p});case "navigation-toggle":return new w({view:p});case "zoom":return new v({view:p})}}};b.__decorate([f.property()],a.prototype,"components",void 0);return a=b.__decorate([g.subclass("esri.views.ui.DefaultUI")],a)})},"esri/views/ui/Component":function(){define("../../chunks/tslib.es6 ../../core/Accessor ../../core/domUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),
function(b,a,c,d,f,n,k,g){a=class extends a{constructor(){super(...arguments);this.widget=null}destroy(){this.node=null;this.widget?.destroy()}get id(){return this._get("id")??this.widget?.id??this.node?.id}set id(q){this._set("id",q)}set node(q){const e=this._get("node");q!==e&&(q&&q.classList.add("esri-component"),e&&e.classList.remove("esri-component"),this._set("node",q))}castNode(q){this.widget?.destroy();if(!q)return this._set("widget",null),null;if("string"===typeof q||q&&"nodeType"in q)return this._set("widget",
null),c.byId(q);q&&"function"===typeof q.render&&!q.domNode&&(q.domNode=document.createElement("div"));this._set("widget",q);return q.domNode}};b.__decorate([d.property()],a.prototype,"id",null);b.__decorate([d.property()],a.prototype,"node",null);b.__decorate([f.cast("node")],a.prototype,"castNode",null);b.__decorate([d.property({readOnly:!0})],a.prototype,"widget",void 0);return a=b.__decorate([g.subclass("esri.views.ui.Component")],a)})},"esri/views/ui/UI":function(){define("../../chunks/tslib.es6 ../../intl ../../core/arrayUtils ../../core/domUtils ../../core/Evented ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/has ../../core/accessorSupport/decorators/subclass ../../support/themeUtils ./Component ../../widgets/support/widgetUtils ../../intl/locale".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v){function x(u){return 0===u?"0":`${u}px`}function p(u){const y="object"===typeof u&&null!==u&&Object.getPrototypeOf(u);return null!==y&&y!==Object.prototype||!("component"in u||"index"in u||"position"in u)?null:u}function h(u,{top:y,bottom:z,left:A,right:C}){u.style.top=y;u.style.bottom=z;u.style.left=A;u.style.right=C}const t={left:0,top:0,bottom:0,right:0},r={bottom:30,top:15,right:15,left:15};a=class extends f.EventedAccessor{constructor(u){super(u);this._cornerNameToContainerLookup=
{};this._positionNameToContainerLookup={};this._components=[];this._componentMap=new Map;this._locale=v.getLocale();this.view=null;this._applyViewPadding=()=>{const y=this.container;y&&h(y,this._toPixelPosition(this._getViewPadding()))};this._applyUIPadding=()=>{const y=this._innerContainer;y&&h(y,this._toPixelPosition(this.padding))};this._initContainers()}initialize(){this.addHandles([n.watch(()=>[this.view?.padding,this.container],this._applyViewPadding,n.initial),n.watch(()=>this.padding,this._applyUIPadding,
n.initial),n.watch(()=>[this.container,this._locale],([u,y])=>{u&&u.setAttribute("lang",y)},n.initial),v.onLocaleChange(u=>{this._locale=u})])}destroy(){this.container=null;for(const u of this._components)u.destroy();this._components.length=0;this._componentMap.clear()}set container(u){const y=this._get("container");u!==y&&(u&&(u.classList.add("esri-ui"),m.setCalciteThemeClass(u),this._attachContainers(u)),y&&(y.classList.remove("esri-ui"),h(y,{top:"",bottom:"",left:"",right:""}),d.empty(y)),this._set("container",
u))}get height(){const u=this.view?.height??0;if(0===u)return u;const y=this._getViewPadding(),{top:z,bottom:A}=y;return Math.max(u-z-A,0)}get padding(){return this._get("padding")}set padding(u){this._overrideIfSome("padding",u)}castPadding(u){return"number"===typeof u?{bottom:u,top:u,right:u,left:u}:{...r,...u}}get width(){const u=this.view?.width??0;if(0===u)return u;const y=this._getViewPadding(),{left:z,right:A}=y;return Math.max(u-z-A,0)}add(u,y){let z,A,C;if(Array.isArray(u))u.forEach(B=>this.add(B,
y));else{var E=p(u);E&&({index:z,position:y,component:u,key:A}=E);y&&"object"===typeof y&&({index:z,key:A,position:y,internal:C}=y);!u||y&&!this._isValidPosition(y)||this._add(u,y,z,A,C)}}remove(u,y){if(u){if(Array.isArray(u))return u.map(A=>this.remove(A,y));if((u=this._find(u))&&(!this._componentMap.has(u)||this._componentMap.get(u)?.key===y)){var z=this._components.indexOf(u);u.node.parentNode?.removeChild(u.node);this._componentMap.delete(u);return this._components.splice(z,1)[0]}}}empty(u,y=
{removeInternal:!1}){if(Array.isArray(u))for(const z of u)this.empty(z,y);else{u=Array.prototype.slice.call(this._positionNameToContainerLookup[u??"manual"].children).map(z=>this._findByNode(z)).filter(z=>null==z?!1:!(this._componentMap.get(z)?.internal??!1)||y.removeInternal);for(const z of u)this.remove(z)}}move(u,y){Array.isArray(u)&&u.forEach(C=>this.move(C,y));if(u){var z=p(u)||p(y);if(z){var A=z.index;y=z.position;u=z.component||u}(!y||this._isValidPosition(y))&&(u=this.remove(u))&&this.add(u,
{position:y,index:A})}}find(u){return u?(u=this._findById(u))&&(u.widget||u.node):null}getComponents(u,y={includeInternal:!1}){return u?Array.isArray(u)?u.flatMap(z=>this._getComponentsAtPosition(z,y)):this._getComponentsAtPosition(u,y):this._components.filter(z=>y.includeInternal||!(this._componentMap.get(z)?.internal??!1)).map(({widget:z,node:A})=>z??A)}getPosition(u){for(const y in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[y].contains(u))return y;return null}_add(u,
y,z,A,C){u instanceof l||(u=new l({node:u}));this._place({component:u,position:y,index:z});this._components.push(u);this._componentMap.set(u,{key:A,internal:C})}_find(u){return u?u instanceof l?this._findByComponent(u):"string"===typeof u?this._findById(u):this._findByNode(u.domNode||u):null}_getViewPadding(){return this.view?.padding??t}_attachContainers(u){u.appendChild(this._innerContainer);u.appendChild(this._manualContainer)}_initContainers(){var u=document.createElement("div");u.classList.add("esri-ui-inner-container",
"esri-ui-corner-container");const y=document.createElement("div");y.classList.add("esri-ui-inner-container","esri-ui-manual-container");const z=document.createElement("div");z.classList.add("esri-ui-top-left","esri-ui-corner");u.appendChild(z);const A=document.createElement("div");A.classList.add("esri-ui-top-right","esri-ui-corner");u.appendChild(A);const C=document.createElement("div");C.classList.add("esri-ui-bottom-left","esri-ui-corner");u.appendChild(C);const E=document.createElement("div");
E.classList.add("esri-ui-bottom-right","esri-ui-corner");u.appendChild(E);this._innerContainer=u;this._manualContainer=y;u=w.isRTL();this._cornerNameToContainerLookup={"top-left":z,"top-right":A,"bottom-left":C,"bottom-right":E,"top-leading":u?A:z,"top-trailing":u?z:A,"bottom-leading":u?E:C,"bottom-trailing":u?C:E};this._positionNameToContainerLookup={manual:y,...this._cornerNameToContainerLookup}}_isValidPosition(u){return!!this._positionNameToContainerLookup[u]}_place(u){var y=u.position??"manual";
const {component:z,index:A}=u;u=this._positionNameToContainerLookup[y];y=null!=A&&-1<A;var C=z.widget;C&&!C._started&&"function"===typeof C.postMixInProperties&&"function"===typeof C.buildRendering&&"function"===typeof C.postCreate&&"function"===typeof C.startup&&z.widget.startup();y?(y=Array.from(u.children),0===A?u.firstChild?d.insertBefore(z.node,u.firstChild):u.appendChild(z.node):A>=y.length?u.appendChild(z.node):d.insertBefore(z.node,y[A])):u.appendChild(z.node)}_toPixelPosition(u){return{top:x(u.top),
left:x(u.left),right:x(u.right),bottom:x(u.bottom)}}_findByComponent(u){return this._components.find(y=>y===u)??null}_findById(u){return this._components.find(({id:y})=>y===u)??null}_findByNode(u){return this._components.find(({node:y})=>y===u)??null}_getComponentsAtPosition(u,y){return Array.prototype.slice.call(this._positionNameToContainerLookup[u].children).map(z=>this._findByNode(z)).filter(c.isSome).filter(z=>y.includeInternal||!(this._componentMap.get(z)?.internal??!1)).map(({widget:z,node:A})=>
z??A)}};b.__decorate([k.property()],a.prototype,"_locale",void 0);b.__decorate([k.property()],a.prototype,"container",null);b.__decorate([k.property()],a.prototype,"height",null);b.__decorate([k.property({value:r})],a.prototype,"padding",null);b.__decorate([g.cast("padding")],a.prototype,"castPadding",null);b.__decorate([k.property()],a.prototype,"view",void 0);b.__decorate([k.property()],a.prototype,"width",null);return a=b.__decorate([e.subclass("esri.views.ui.UI")],a)})},"esri/widgets/Attribution":function(){define("../chunks/tslib.es6 ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ./Widget ./Attribution/AttributionViewModel ./support/globalCss ./support/legacyIcon ./support/decorators/accessibleHandler ./support/decorators/messageBundle ./support/jsxFactory ./support/widgetUtils".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x){var p=m.legacyIcon.description;d=class extends g{constructor(h,t){super(h,t);this._attributionTextOverflowed=this._isOpen=!1;this._prevSourceNodeHeight=0;this._resizeObserver=new ResizeObserver(r=>r.forEach(({target:u})=>this._checkSourceTextOverflow(u)));this.iconClass=p;this.icon=null;this.itemDelimiter=" | ";this.messages=null;this.viewModel=new q}initialize(){this.addHandles(a.on(()=>this.viewModel?.items,"change",()=>this.scheduleRender()))}destroy(){this._resizeObserver?.disconnect()}get _isInteractive(){return this._isOpen||
this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((h,t)=>{h.includes(t.text)||h.push(t.text);return h},[]).join(this.itemDelimiter)}get label(){return this.messages?.widgetLabel??""}set label(h){this._overrideIfSome("label",h)}get view(){return this.viewModel.view}set view(h){this.viewModel.view=h}render(){return v.tsx("div",{bind:this,class:this.classes("esri-attribution",e.globalCss.widget,{["esri-attribution--open"]:this._isOpen}),dir:"ltr",onclick:this._toggleState,
onkeydown:this._toggleState},this._renderSourcesNode(),this._renderPoweredBy())}_renderPoweredBy(){return v.tsx("div",{class:"esri-attribution__powered-by"},"Powered by"," ",v.tsx("a",{class:"esri-attribution__link",href:"http://www.esri.com/",rel:"noreferrer",target:"_blank"},"Esri"))}_renderSourcesNode(){const h=this._isOpen,t=this._isInteractive,r=t?0:void 0,{attributionText:u}=this;return v.tsx("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes("esri-attribution__sources",
{["esri-attribution__sources--open"]:h,[e.globalCss.interactive]:t}),innerHTML:u,tabIndex:r})}_afterSourcesNodeCreate(h){this._prevSourceNodeHeight=h.clientWidth;this._resizeObserver.observe(h)}_checkSourceTextOverflow(h){let t=!1;const {clientHeight:r,clientWidth:u,scrollWidth:y}=h;h=y>u;const z=this._attributionTextOverflowed!==h;this._attributionTextOverflowed=h;z&&(t=!0);this._isOpen&&(h=r<this._prevSourceNodeHeight,this._prevSourceNodeHeight=r,h&&(this._isOpen=!1,t=!0));t&&this.scheduleRender()}_toggleState(){this._isInteractive&&
(this._isOpen=!this._isOpen)}};b.__decorate([c.property()],d.prototype,"_isOpen",void 0);b.__decorate([c.property()],d.prototype,"_isInteractive",null);b.__decorate([c.property()],d.prototype,"_attributionTextOverflowed",void 0);b.__decorate([c.property()],d.prototype,"_prevSourceNodeHeight",void 0);b.__decorate([c.property({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],d.prototype,"attributionText",null);b.__decorate([c.property()],d.prototype,"iconClass",void 0);b.__decorate([c.property()],
d.prototype,"icon",void 0);b.__decorate([c.property()],d.prototype,"itemDelimiter",void 0);b.__decorate([c.property()],d.prototype,"label",null);b.__decorate([c.property(),w.messageBundle("esri/widgets/Attribution/t9n/Attribution")],d.prototype,"messages",void 0);b.__decorate([c.property()],d.prototype,"view",null);b.__decorate([c.property({type:q})],d.prototype,"viewModel",void 0);b.__decorate([l.accessibleHandler()],d.prototype,"_toggleState",null);return d=b.__decorate([k.subclass("esri.widgets.Attribution")],
d)})},"esri/widgets/Attribution/AttributionViewModel":function(){define("../../chunks/tslib.es6 ../../core/Accessor ../../core/asyncUtils ../../core/Collection ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../geometry/Extent ../../geometry/SpatialReference ../../geometry/support/contains ../../geometry/support/webMercatorUtils".split(" "),function(b,
a,c,d,f,n,k,g,q,e,m,l,w,v){function x(r,u){return r&&"copyright"in r&&(!u||"function"===typeof r.originOf&&"user"===r.originOf("copyright"))}function p(r,u){return r.length!==u.length||r.some((y,z)=>y.text!==u[z].text)}function h(r,u,y){y&&u&&(r.find(z=>z.layerView===u&&z.text===y)||r.push({text:y,layerView:u}))}const t=[];a=class extends a{constructor(r){super(r);this._clear=()=>{this._fetchedAttributionData.clear();this._pendingAttributions.clear();this.removeHandles("suspension");this.notifyChange("state")};
this._pendingAttributions=new Set;this._fetchedAttributionData=new Map;this.items=new d;this.view=null;this._allLayerViewsChange=u=>{this.removeHandles("suspension");const y=this.view?.allLayerViews;y&&this.addHandles(y.map(z=>f.watch(()=>[z.suspended,z.layer?.attributionVisible],()=>this._updateAttributionItems())).toArray(),"suspension");u?.removed&&u.removed.forEach(z=>{this._pendingAttributions.delete(z);this._fetchedAttributionData.delete(z)});this._updateAttributionItems()};this.addHandles([f.on(()=>
this.view?.allLayerViews,"change",u=>this._allLayerViewsChange(u),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),f.when(()=>!0===this.view?.stationary,()=>this._updateAttributionItems())])}destroy(){this.view=null;this._fetchedAttributionData.clear();this._pendingAttributions.clear();this.items.removeAll()}get state(){return this.view?.ready?0<this._pendingAttributions.size?"loading":"ready":"disabled"}_updateAttributionItems(){const r=this.view,u=r?.allLayerViews;t.length=
0;r&&u?(u.forEach(y=>{if(!y.suspended&&y.layer?.attributionVisible){var z=y.layer;if(x(z,"user"))h(t,y,z.copyright);else if(z.hasAttributionData)if(this._fetchedAttributionData.has(y)){var A=this._fetchedAttributionData.get(y);A?h(t,y,this._getDynamicAttribution(A,r,z)):x(z)&&h(t,y,z.copyright)}else this._fetchAttributionData(y);else(A="portalItem"in z?z.portalItem?.accessInformation:void 0)?h(t,y,A):h(t,y,z.copyright)}}),p(this.items,t)&&(this.items.removeAll(),this.items.addMany(t)),t.length=0,
this.notifyChange("state")):this._clear()}async _fetchAttributionData(r){if(!this._pendingAttributions.has(r)){this._pendingAttributions.add(r);var u=await c.result(r.layer.fetchAttributionData());this._pendingAttributions.has(r)&&(u=u.ok?this._createContributionIndex(u.value,"bing-maps"===r.layer.type):null,this._pendingAttributions.delete(r),this._fetchedAttributionData.set(r,u));this._updateAttributionItems()}}_createContributionIndex(r,u){r=r.contributors;const y={};if(!r)return y;for(let B=0;B<
r.length;B++){const D=r[B];var z=D.coverageAreas;if(!z)return;for(const F of z){var A=F.bbox,C=F.zoomMin-(u&&F.zoomMin?1:0);z=F.zoomMax-(u&&F.zoomMax?1:0);A=new m({xmin:A[1],ymin:A[0],xmax:A[3],ymax:A[2],spatialReference:l.WGS84});for(A={extent:v.geographicToWebMercator(A),attribution:D.attribution||"",score:null!=F.score?F.score:100,id:B};C<=z;C++){var E;y[E=C]??(y[E]=[]);y[C].push(A)}}}y.maxKey=Math.max.apply(null,Object.keys(y));return y}_getDynamicAttribution(r,u,y){const {extent:z,scale:A}=u;
y=y.tileInfo?.scaleToZoom(A)??0;y=Math.min(r.maxKey??0,Math.round(y));if(!z||null==y||-1>=y)return"";r=r[y];const C=v.project(z.center.clone().normalize(),u.spatialReference),E=new Set;return r?r.filter(B=>{const D=B.id;(B=!E.has(D)&&C&&B.extent&&w.extentContainsPoint(B.extent,C))&&E.add(D);return B}).sort((B,D)=>D.score-B.score||B.objectId-D.objectId).map(B=>B.attribution).join(", "):""}};b.__decorate([n.property({readOnly:!0,type:d})],a.prototype,"items",void 0);b.__decorate([n.property({readOnly:!0})],
a.prototype,"state",null);b.__decorate([n.property()],a.prototype,"view",void 0);return a=b.__decorate([e.subclass("esri.widgets.Attribution.AttributionViewModel")],a)})},"esri/widgets/support/globalCss":function(){define(["exports"],function(b){b.globalCss={anchor:"esri-widget__anchor",anchorDisabled:"esri-widget__anchor--disabled",button:"esri-button",buttonDisabled:"esri-button--disabled",buttonHalf:"esri-button--half",buttonSecondary:"esri-button--secondary",buttonSmall:"esri-button--small",buttonTertiary:"esri-button--tertiary",
buttonThird:"esri-button--third",disabled:"esri-disabled",disabledElement:"esri-disabled-element",empty:"esri-widget__content--empty",emptyIllustration:"esri-widget__content-illustration--empty",heading:"esri-widget__heading",hidden:"esri-hidden",input:"esri-input",interactive:"esri-interactive",loader:"esri-widget__loader",loaderAnimation:"esri-widget__loader-animation",loaderText:"esri-widget__loader-text",menu:"esri-menu",menuHeader:"esri-menu__header",menuItem:"esri-menu__list-item",menuItemActive:"esri-menu__list-item--active",
menuItemFocus:"esri-menu__list-item--focus",menuList:"esri-menu__list",noBookmarksIcon:"esri-widget__no-bookmark-icon",panel:"esri-widget--panel",panelHeightOnly:"esri-widget--panel-height-only",primaryTick:"primary-tick",primaryTickAmPm:"primary-tick__ampm",primaryTickLabel:"primary-tick__label",rotating:"esri-rotating",secondaryTick:"secondary-tick",select:"esri-select",table:"esri-widget__table",widget:"esri-widget",widgetButton:"esri-widget--button",widgetButtonActive:"esri-widget--button-active",
widgetDisabled:"esri-widget--disabled"};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Compass":function(){define("require ../chunks/tslib.es6 ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ./Widget ./Compass/CompassViewModel ./Compass/css ./support/componentsUtils ./support/globalCss ./support/widgetUtils ./support/decorators/messageBundle ./support/jsxFactory".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x){d=class extends g{constructor(p,h){super(p,h);this.iconClass=e.css.widgetIcon;this.messages=this.icon=null;this.viewModel=new q;this._reset=()=>{this.viewModel.reset()};this._toRotationTransform=t=>({transform:`rotateZ(${t.z}deg)`})}loadDependencies(){return m.loadCalciteComponents({button:()=>new Promise((p,h)=>b(["../chunks/calcite-button"],p,h)),icon:()=>new Promise((p,h)=>b(["../chunks/calcite-icon"],p,h))})}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(p){this.viewModel.goToOverride=
p}get label(){return this.messages?.widgetLabel??""}set label(p){this._overrideIfSome("label",p)}get view(){return this.viewModel.view}set view(p){this.viewModel.view=p}reset(){return this.viewModel.reset()}render(){const {orientation:p,state:h}=this.viewModel,t="rotation"===h?"arrow-up":"compass-needle",{messages:r}=this;return x.tsx("div",{class:this.classes(e.css.base,l.globalCss.widget)},x.tsx("calcite-button",{"aria-label":r.reset,class:l.globalCss.widgetButton,disabled:"disabled"===h,kind:"neutral",
onclick:this._reset,round:!0,scale:"s",title:r.reset},x.tsx("div",{"aria-hidden":"true",class:e.css.iconContainer,title:r.reset},x.tsx("calcite-icon",{icon:t,scale:"m",styles:this._toRotationTransform(p)}))))}};a.__decorate([c.property()],d.prototype,"goToOverride",null);a.__decorate([c.property()],d.prototype,"iconClass",void 0);a.__decorate([c.property()],d.prototype,"icon",void 0);a.__decorate([c.property()],d.prototype,"label",null);a.__decorate([c.property(),v.messageBundle("esri/widgets/Compass/t9n/Compass")],
d.prototype,"messages",void 0);a.__decorate([c.property()],d.prototype,"view",null);a.__decorate([c.property({type:q})],d.prototype,"viewModel",void 0);return d=a.__decorate([k.subclass("esri.widgets.Compass")],d)})},"esri/widgets/Compass/CompassViewModel":function(){define("../../chunks/tslib.es6 ../../core/Accessor ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ./utils ../support/GoTo".split(" "),
function(b,a,c,d,f,n,k,g,q,e){a=class extends e.GoToMixin(a){constructor(m){super(m);this.orientation={x:0,y:0,z:0};this.view=null;this._updateForCamera=this._updateForCamera.bind(this);this._updateForRotation=this._updateForRotation.bind(this);this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this.addHandles(c.watch(()=>this.view,this._updateRotationWatcher,c.initial))}destroy(){this.view=null}get canShowNorth(){return q.canShowNorth(this.view)}get state(){return!this.view?.ready||
"2d"===this.view.type&&!this.view.constraints.rotationEnabled?"disabled":this.canShowNorth?"compass":"rotation"}reset(){if(this.view?.ready){var m={};"2d"===this.view?.type?m.rotation=0:m.heading=0;this.callGoTo({target:m})}}_updateForRotation(m){void 0!==m&&null!==m&&(this.orientation={z:m})}_updateForCamera(m){m&&(this.orientation={x:0,y:0,z:-m.heading})}_updateRotationWatcher(m){this.removeAllHandles();m&&this.addHandles("2d"===m.type?c.watch(()=>m?.rotation,this._updateForRotation,c.initial):
c.watch(()=>m?.camera,this._updateForCamera,c.initial))}};b.__decorate([d.property({readOnly:!0})],a.prototype,"canShowNorth",null);b.__decorate([d.property()],a.prototype,"orientation",void 0);b.__decorate([d.property({readOnly:!0})],a.prototype,"state",null);b.__decorate([d.property()],a.prototype,"view",void 0);return a=b.__decorate([g.subclass("esri.widgets.CompassViewModel")],a)})},"esri/widgets/Compass/utils":function(){define(["exports"],function(b){b.canShowNorth=function(a){return a?.spatialReference?.isWebMercator||
a?.spatialReference?.isGeographic||!1};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/support/GoTo":function(){define("exports ../../chunks/tslib.es6 ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),function(b,a,c,d,f,n,k,g){b.GoToMixin=q=>{q=class extends q{constructor(...e){super(...e);this.view=this.goToOverride=null}callGoTo(e){const {view:m}=
this;c.assertIsSome(m);return this.goToOverride?this.goToOverride(m,e):m.goTo(e.target,e.options)}};a.__decorate([d.property()],q.prototype,"goToOverride",void 0);a.__decorate([d.property()],q.prototype,"view",void 0);return q=a.__decorate([g.subclass("esri.widgets.support.GoTo")],q)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Compass/css":function(){define(["exports","../support/legacyIcon"],function(b,a){b.css={base:"esri-compass",widgetIcon:a.legacyIcon.locateCircled,
iconContainer:"esri-compass__icon-container"};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/NavigationToggle":function(){define("../chunks/tslib.es6 ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ./Widget ./NavigationToggle/css ./NavigationToggle/NavigationToggleViewModel ./support/globalCss ./support/legacyIcon ./support/decorators/accessibleHandler ./support/decorators/messageBundle ./support/jsxFactory ./support/widgetUtils".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x){c=class extends k{constructor(p,h){super(p,h);this.iconClass=g.css.widgetIcon;this.messages=this.icon=null;this.viewModel=new q}get label(){return this.messages?.widgetLabel??""}set label(p){this._overrideIfSome("label",p)}set layout(p){"horizontal"!==p&&(p="vertical");this._set("layout",p)}get view(){return this.viewModel.view}set view(p){this.viewModel.view=p}toggle(){return this.viewModel.toggle()}render(){const p="disabled"===this.viewModel?.state;var h=
"pan"===this.viewModel?.navigationMode;const t={[g.css.activeButton]:h};h={[g.css.activeButton]:!h};const r=p?-1:0,u=this.messages.toggle;return v.tsx("div",{"aria-label":u,bind:this,class:this.classes(g.css.base,e.globalCss.widget,{[e.globalCss.disabled]:p,[g.css.isLayoutHorizontal]:"horizontal"===this.layout}),onclick:this._toggle,onkeydown:this._toggle,tabIndex:r,title:u},v.tsx("div",{class:this.classes(g.css.button,e.globalCss.widgetButton,g.css.panButton,t)},v.tsx("span",{class:m.legacyIcon.pan})),
v.tsx("div",{class:this.classes(g.css.button,e.globalCss.widgetButton,g.css.rotateButton,h)},v.tsx("span",{class:m.legacyIcon.rotate})))}_toggle(){this.toggle()}};b.__decorate([a.property()],c.prototype,"iconClass",void 0);b.__decorate([a.property()],c.prototype,"icon",void 0);b.__decorate([a.property()],c.prototype,"label",null);b.__decorate([a.property({value:"vertical"})],c.prototype,"layout",null);b.__decorate([a.property(),w.messageBundle("esri/widgets/NavigationToggle/t9n/NavigationToggle")],
c.prototype,"messages",void 0);b.__decorate([a.property()],c.prototype,"view",null);b.__decorate([a.property({type:q})],c.prototype,"viewModel",void 0);b.__decorate([l.accessibleHandler()],c.prototype,"_toggle",null);return c=b.__decorate([n.subclass("esri.widgets.NavigationToggle")],c)})},"esri/widgets/NavigationToggle/css":function(){define(["exports","../support/legacyIcon"],function(b,a){b.css={base:"esri-navigation-toggle",widgetIcon:a.legacyIcon.pan2,button:"esri-navigation-toggle__button",
activeButton:"esri-navigation-toggle__button--active",panButton:"esri-navigation-toggle__button--pan",rotateButton:"esri-navigation-toggle__button--rotate",isLayoutHorizontal:"esri-navigation-toggle--horizontal"};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/NavigationToggle/NavigationToggleViewModel":function(){define("../../chunks/tslib.es6 ../../core/Accessor ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),
function(b,a,c,d,f,n,k,g){a=class extends a{constructor(q){super(q);this.navigationMode="pan";this.view=null}initialize(){this.addHandles(c.when(()=>this.view?.inputManager,()=>this._setNavigationMode()))}destroy(){this.view=null}get state(){return this.view?.ready&&"3d"===this.view?.type?"ready":"disabled"}toggle(){"disabled"!==this.state&&(this.navigationMode="pan"!==this.navigationMode?"pan":"rotate",this._setNavigationMode())}_setNavigationMode(){const q=this.view?.inputManager;q&&(q.primaryDragAction=
"pan"===this.navigationMode?"pan":"rotate")}};b.__decorate([d.property({readOnly:!0})],a.prototype,"state",null);b.__decorate([d.property()],a.prototype,"navigationMode",void 0);b.__decorate([d.property()],a.prototype,"view",void 0);return a=b.__decorate([g.subclass("esri.widgets.NavigationToggleViewModel")],a)})},"esri/widgets/Zoom":function(){define("../chunks/tslib.es6 ../core/maybe ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ./Widget ./support/globalCss ./support/legacyIcon ./support/widgetUtils ./support/decorators/messageBundle ./support/jsxFactory ./Zoom/IconButton ./Zoom/ZoomViewModel".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x){var p=e.legacyIcon.zoomInMagnifyingGlass;d=class extends g{constructor(h,t){super(h,t);this.iconClass=p;this.messages=this.icon=null;this.viewModel=new x}initialize(){this._zoomInButton=new v({action:this.zoomIn.bind(this),iconClass:e.legacyIcon.plus});this._zoomOutButton=new v({action:this.zoomOut.bind(this),iconClass:e.legacyIcon.minus})}destroy(){this._zoomInButton=a.destroyMaybe(this._zoomInButton);this._zoomOutButton=a.destroyMaybe(this._zoomOutButton)}get label(){return this.messages?.widgetLabel??
""}set label(h){this._overrideIfSome("label",h)}set layout(h){"horizontal"!==h&&(h="vertical");this._set("layout",h)}set view(h){this.viewModel.view=h}get view(){return this.viewModel.view}render(){const h={["esri-zoom--horizontal"]:"horizontal"===this.layout},{canZoomIn:t,canZoomOut:r}=this.viewModel;this._zoomInButton.enabled=t;this._zoomOutButton.enabled=r;const {zoomIn:u,zoomOut:y}=this.messages;this._zoomInButton.title=u;this._zoomOutButton.title=y;return w.tsx("div",{class:this.classes("esri-zoom",
q.globalCss.widget,h)},this._zoomInButton.render(),this._zoomOutButton.render())}zoomIn(){return this.viewModel.zoomIn()}zoomOut(){return this.viewModel.zoomOut()}};b.__decorate([c.property()],d.prototype,"iconClass",void 0);b.__decorate([c.property()],d.prototype,"icon",void 0);b.__decorate([c.property()],d.prototype,"label",null);b.__decorate([c.property({value:"vertical"})],d.prototype,"layout",null);b.__decorate([c.property(),l.messageBundle("esri/widgets/Zoom/t9n/Zoom")],d.prototype,"messages",
void 0);b.__decorate([c.property()],d.prototype,"view",null);b.__decorate([c.property({type:x})],d.prototype,"viewModel",void 0);return d=b.__decorate([k.subclass("esri.widgets.Zoom")],d)})},"esri/widgets/Zoom/IconButton":function(){define("../../chunks/tslib.es6 ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../Widget ../Feature/resources ../support/globalCss ../support/legacyIcon ../support/decorators/accessibleHandler ../support/jsxFactory ../support/widgetUtils".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w){c=class extends k{constructor(){super(...arguments);this.enabled=!0;this.icon=this.iconClass=null;this.title=""}render(){const v=this.enabled?0:-1;return l.tsx("div",{bind:this,class:this.classes(q.globalCss.widgetButton,q.globalCss.widget,{[q.globalCss.disabled]:!this.enabled,[q.globalCss.interactive]:this.enabled}),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:v,title:this.title},l.tsx("span",{"aria-hidden":"true",class:this.classes(g.css.icon,
this.iconClass??""),role:"presentation"}),l.tsx("span",{class:e.legacyIcon.fontFallbackText},this.title))}_triggerAction(){this.action.call(this)}};b.__decorate([a.property()],c.prototype,"action",void 0);b.__decorate([a.property()],c.prototype,"enabled",void 0);b.__decorate([a.property()],c.prototype,"iconClass",void 0);b.__decorate([a.property()],c.prototype,"icon",void 0);b.__decorate([a.property()],c.prototype,"title",void 0);b.__decorate([m.accessibleHandler()],c.prototype,"_triggerAction",null);
return c=b.__decorate([n.subclass("esri.widgets.IconButton")],c)})},"esri/widgets/Feature/resources":function(){define(["exports"],function(b){b.css={base:"esri-feature",container:"esri-feature__size-container",title:"esri-feature__title",main:"esri-feature__main-container",btn:"esri-feature__button",icon:"esri-feature__icon",content:"esri-feature__content",contentNode:"esri-feature__content-node",contentNodeText:"esri-feature__content-node--text",contentElement:"esri-feature__content-element",text:"esri-feature__text",
lastEditedInfo:"esri-feature__last-edited-info",fields:"esri-feature__fields",fieldHeader:"esri-feature__field-header",fieldData:"esri-feature__field-data",fieldDataDate:"esri-feature__field-data--date",loadingSpinnerContainer:"esri-feature__loading-container",spinner:"esri-feature__loading-spinner"};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Zoom/ZoomViewModel":function(){define("../../chunks/tslib.es6 ../../core/Accessor ../../core/promiseUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ./ZoomConditions2D ./ZoomConditions3D".split(" "),
function(b,a,c,d,f,n,k,g,q,e){a=class extends a{constructor(m){super(m)}destroy(){this.view=null}get canZoomIn(){return null!=this._zoomConditions&&this._zoomConditions.canZoomIn}get canZoomOut(){return null!=this._zoomConditions&&this._zoomConditions?.canZoomOut}get state(){return this.view?.ready?"ready":"disabled"}set view(m){m?"2d"===m.type?this._zoomConditions=new q({view:m}):"3d"===m.type&&(this._zoomConditions=new e({view:m})):this._zoomConditions=null;this._set("view",m)}zoomIn(){if(this.canZoomIn){var m=
this.view;"2d"===m.type?m.mapViewNavigation.zoomIn():c.ignoreAbortErrors(m.goTo({zoomFactor:2}))}}zoomOut(){if(this.canZoomOut){var m=this.view;"2d"===m.type?m.mapViewNavigation.zoomOut():c.ignoreAbortErrors(m.goTo({zoomFactor:.5}))}}};b.__decorate([d.property()],a.prototype,"_zoomConditions",void 0);b.__decorate([d.property()],a.prototype,"canZoomIn",null);b.__decorate([d.property()],a.prototype,"canZoomOut",null);b.__decorate([d.property({readOnly:!0})],a.prototype,"state",null);b.__decorate([d.property()],
a.prototype,"view",null);return a=b.__decorate([g.subclass("esri.widgets.Zoom.ZoomViewModel")],a)})},"esri/widgets/Zoom/ZoomConditions2D":function(){define("../../chunks/tslib.es6 ../../core/Accessor ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),function(b,a,c,d,f,n,k){a=class extends a{get canZoomIn(){if(!this.view?.ready)return!1;const g=this.view?.constraints?.effectiveMaxScale;
return 0===g||this._scale>g}get canZoomOut(){var {view:g}=this;if(!g?.ready)return!1;g=g.constraints?.effectiveMinScale;return 0===g||this._scale<g}get _scale(){const g=this.view?.animation?.target;return(g&&"then"in g?void 0:g?.scale)??this.view?.scale??0}};b.__decorate([c.property({readOnly:!0})],a.prototype,"canZoomIn",null);b.__decorate([c.property({readOnly:!0})],a.prototype,"canZoomOut",null);b.__decorate([c.property()],a.prototype,"view",void 0);b.__decorate([c.property()],a.prototype,"_scale",
null);return a=b.__decorate([k.subclass("esri.widgets.Zoom.ZoomConditions2D")],a)})},"esri/widgets/Zoom/ZoomConditions3D":function(){define("../../chunks/tslib.es6 ../../core/Accessor ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),function(b,a,c,d,f,n,k){a=class extends a{get canZoomIn(){return!!this.view.ready}get canZoomOut(){return!!this.view.ready}};b.__decorate([c.property({readOnly:!0})],
a.prototype,"canZoomIn",null);b.__decorate([c.property({readOnly:!0})],a.prototype,"canZoomOut",null);b.__decorate([c.property()],a.prototype,"view",void 0);return a=b.__decorate([k.subclass("esri.widgets.Zoom.ZoomConditions3D")],a)})},"esri/views/ui/3d/DefaultUI3D":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../DefaultUI".split(" "),
function(b,a,c,d,f,n,k){c=class extends k{constructor(g){super(g);this.components=["attribution","zoom","navigation-toggle","compass"]}};b.__decorate([a.property()],c.prototype,"components",void 0);return c=b.__decorate([n.subclass("esri.views.ui.3d.DefaultUI3D")],c)})},"jimu/DataManager":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","./WidgetManager"],function(b,a,c,d){var f=null;var n=b(null,{constructor:function(){c.subscribe("publishData",a.hitch(this,this.onDataPublished));
c.subscribe("fetchData",a.hitch(this,this.onFetchData));c.subscribe("clearAllData",a.hitch(this,this.onClearAllData));c.subscribe("removeData",a.hitch(this,this.onRemoveData));c.subscribe("clearDataHistory",a.hitch(this,this.onClearDataHistory));this.widgetManager=d.getInstance()},_dataStore:{},onDataPublished:function(k,g,q,e){"undefined"===typeof e&&(e=!1);this._dataStore[g]?(this._dataStore[g].current=q,e&&(this._dataStore[g].history?this._dataStore[g].history.push(q):this._dataStore[g].history=
[q])):(this._dataStore[g]={current:q},e&&(this._dataStore[g].history=[q]))},onFetchData:function(k){var g;if(k)"framework"===k?this._dataStore[k]?c.publish("dataFetched","framework","framework",this._dataStore[k].current,this._dataStore[k].history):c.publish("noData","framework","framework"):(g=this.widgetManager.getWidgetById(k))?this._dataStore[k]?c.publish("dataFetched",g.name,k,this._dataStore[k].current,this._dataStore[k].history):c.publish("noData",g.name,k):c.publish("noData",void 0,k);else for(var q in this._dataStore)(g=
this.widgetManager.getWidgetById(q))&&c.publish("dataFetched",g.name,q,this._dataStore[q].current,this._dataStore[q].history)},onClearAllData:function(){this._dataStore={};c.publish("allDataCleared")},onRemoveData:function(k){delete this._dataStore[k];c.publish("dataRemoved",k)},onClearDataHistory:function(k){this._dataStore[k]&&(this._dataStore[k].history=[]);c.publish("dataHistoryCleared",k)}});n.getInstance=function(){null===f&&(f=new n);return f};return n})},"jimu/BaseWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dijit/_WidgetBase dijit/_TemplatedMixin jimu/utils ./PanelManager".split(" "),
function(b,a,c,d,f,n,k,g,q){return b([n,k],{type:"widget",id:void 0,label:void 0,icon:void 0,uri:void 0,position:{},config:void 0,openAtStart:!1,sceneView:null,appConfig:null,folderUrl:null,state:"closed",windowState:"normal",started:!1,name:"",baseClass:null,templateString:"\x3cdiv\x3e\x3c/div\x3e",moveTopOnActive:!0,constructor:function(){this.listenWidgetNames=[];this.listenWidgetIds=[];this.own(f.subscribe("publishData",a.hitch(this,this._onReceiveData)));this.own(f.subscribe("dataFetched",a.hitch(this,
this._onReceiveData)));this.own(f.subscribe("noData",a.hitch(this,this._onNoData)))},startup:function(){this.inherited(arguments);this.started=!0},onOpen:function(){},onClose:function(){},onNormalize:function(){},onMinimize:function(){},onMaximize:function(){},onActive:function(){},onDeActive:function(){},onSignIn:function(e){},onSignOut:function(){},onPositionChange:function(e){this.setPosition(e)},setPosition:function(e,m){this.position=e;var l=g.getPositionStyle(this.position);l.position="absolute";
m||(m="map"===e.relativeTo?this.sceneView.map.id:window.jimuConfig.layoutId);d.place(this.domNode,m);d.setStyle(this.domNode,l);this.started&&this.resize()},getPosition:function(){return this.position},getMarginBox:function(){return d.getMarginBox(this.domNode)},setState:function(e){this.state=e},setWindowState:function(e){this.windowState=e},resize:function(){},onConfigChanged:function(e){},onAppConfigChanged:function(e,m,l){},onAction:function(e,m){},getPanel:function(){if(!1===this.inPanel)return null;
if("widgetOnScreen"===this.gid||"widgetPool"===this.gid)return q.getInstance().getPanelById(this.id+"_panel");var e=q.getInstance().getPanelById(this.gid+"_panel");return e?e:q.getInstance().getPanelById(this.id+"_panel")},publishData:function(e,m){"undefined"===typeof m&&(m=!1);f.publish("publishData",this.name,this.id,e,m)},fetchData:function(e){e?f.publish("fetchData",e):0!==this.listenWidgetIds.length?c.forEach(this.listenWidgetIds,function(m){f.publish("fetchData",m)},this):f.publish("fetchData")},
fetchDataByName:function(e){e=this.widgetManager.getWidgetsByName(e);c.forEach(e,function(m){this.fetchData(m.id)},this)},openWidgetById:function(e){return this.widgetManager.triggerWidgetOpen(e)},_onReceiveData:function(e,m,l,w){if(m!==this.id&&!(0!==this.listenWidgetIds.length&&0>this.listenWidgetIds.indexOf(m)))this.onReceiveData(e,m,l,w)},onReceiveData:function(e,m,l,w){},_onNoData:function(e,m){if(!(0!==this.listenWidgetIds.length&&0>this.listenWidgetIds.indexOf(m)))this.onNoData(e,m)},onNoData:function(e,
m){}})})},"jimu/PanelManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/fx dojo/Deferred dojo/promise/all dojo/on dojo/topic dojo/when require ./utils ./WidgetManager".split(" "),function(b,a,c,d,f,n,k,g,q,e,m,l,w){var v=null;var x=b(null,{constructor:function(){this.panels=[];this.widgetManager=w.getInstance();g(window,"resize",a.hitch(this,this.onWindowResize));this.activePanel=null;q.subscribe("/dnd/move/start",a.hitch(this,this._onMoveStart));
q.subscribe("widgetActived",a.hitch(this,this._onWidgetActived))},showPanel:function(p){var h=new n,t=this.getPanelById(p.id+"_panel");t?("closed"===t.state&&this.openPanel(t),h.resolve(t)):k({Panel:this._loadPanelClass(p.panel.uri),nls:this._loadThemeI18N(p.panel.uri)}).then(a.hitch(this,function(r){var u=p.id+"_panel",y=this.getPanelById(u),z={label:p.label,config:p,uri:p.panel.uri,position:p.panel.position,sceneView:this.sceneView,widgetManager:this.widgetManager,panelManager:this,id:u,gid:p.gid,
nls:r.nls};a.mixin(z,p.panel.options);try{y=new r.Panel(z),console.log("panel ["+u+"] created.")}catch(A){console.log("create panel error: "+A+", panelId: "+u);h.reject(A);return}y.setPosition(p.panel.position);l.setVerticalCenter(y.domNode);this.openPanel(y);this.panels.push(y);g(y.domNode,"click",a.hitch(this,this._onPanelClick,y));h.resolve(y)}));return h},setSceneView:function(p){this.sceneView=p;g(this.sceneView,"resize",a.hitch(this,this.onMapResize))},closeOtherPanelsInTheSameGroup:function(p){if("string"===
typeof p&&(p=this.getPanelById(p),!p))return;for(var h=0;h<this.panels.length;h++)this.panels[h].gid===p.gid&&this.panels[h].id!==p.id&&this.closePanel(this.panels[h])},closeAllPanelsInGroup:function(p){for(var h=0;h<this.panels.length;h++)this.panels[h].gid===p&&this.closePanel(this.panels[h])},openPanel:function(p){var h=new n;if("string"===typeof p&&(p=this.getPanelById(p),!p))return h.reject(),h;if(!p.started)try{p.started=!0,p.startup()}catch(t){console.error("fail to startup panel "+p.id+". "+
t.stack)}if("opened"===p.state)return h.resolve(p),h;p.setState("opened");return this.playOpenPanelAnimation(p).then(a.hitch(this,function(){d.setStyle(p.domNode,"display","");p.onOpen();this._activePanel(p);return p}))},closePanel:function(p){var h=new n;return"string"===typeof p&&(p=this.getPanelById(p),!p)||"closed"===p.state?(h.resolve(),h):this.playClosePanelAnimation(p).then(function(){this.activePanel&&this.activePanel.id===p.id&&(this.activePanel.onDeActive(),this.activePanel=null);p.setState("closed");
p.onClose();p.domNode&&d.setStyle(p.domNode,"display","none")})},minimizePanel:function(p){if("string"===typeof p&&(p=this.getPanelById(p),!p))return;"closed"===p.state&&this.openPanel(p);p.setWindowState("minimized");try{p.onMinimize()}catch(h){console.log(console.error("fail to minimize panel "+p.id+". "+h.stack))}},maximizePanel:function(p){if("string"===typeof p&&(p=this.getPanelById(p),!p))return;"closed"===p.state&&this.openPanel(p);p.setWindowState("maximized");try{p.onMaximize()}catch(h){console.log(console.error("fail to maximize panel "+
p.id+". "+h.stack))}},normalizePanel:function(p){if("string"===typeof p&&(p=this.getPanelById(p),!p))return;"closed"===p.state&&this.openPanel(p);p.setWindowState("normal");try{p.onNormalize()}catch(h){console.log(console.error("fail to noralize panel "+p.id+". "+h.stack))}},changeWindowStateTo:function(p,h){if("string"===typeof p&&(p=this.getPanelById(p),!p))return;"normal"===h?this.normalizePanel(p):"minimized"===h?this.minimizePanel(p):"maximized"===h?this.maximizePanel(p):console.log("error state: "+
h)},getPanelById:function(p){for(var h=0;h<this.panels.length;h++)if(this.panels[h].id===p)return this.panels[h]},onWindowResize:function(){for(var p=0;p<this.panels.length;p++)"closed"!==this.panels[p].state&&"map"!==this.panels[p].position.relativeTo&&this.panels[p].resize()},onMapResize:function(){for(var p=0;p<this.panels.length;p++)"closed"!==this.panels[p].state&&"map"===this.panels[p].position.relativeTo&&this.panels[p].resize()},destroyPanel:function(p){if("string"===typeof p&&(p=this.getPanelById(p),
!p))return;if(p.domNode){"closed"!==p.state&&this.closePanel(p);this._removePanel(p);try{p.destroy()}catch(h){console.log(console.error("fail to destroy panel "+p.id+". "+h.stack))}}},destroyAllPanels:function(){var p=c.map(this.panels,function(h){return h.id});c.forEach(p,function(h){this.destroyPanel(h)},this);this.panels=[]},playOpenPanelAnimation:function(p){if("string"===typeof p&&(p=this.getPanelById(p),!p)||!p.openAnimation||0===p.animationDuration)return e();var h=new n;"string"===typeof p.openAnimation?
"fadeIn"===p.openAnimation?(d.setStyle(p.domNode,{opacity:0,display:""}),f.fadeIn({node:p.domNode,duration:p.animationDuration,onEnd:function(){h.resolve()}}).play()):h.resolve():h.resolve();return h},playClosePanelAnimation:function(p){if("string"===typeof p&&(p=this.getPanelById(p),!p)||!p.closeAnimation||0===p.animationDuration)return e();var h=new n;"string"===typeof p.closeAnimation&&("fadeOut"===p.closeAnimation?f.fadeOut({node:p.domNode,duration:p.animationDuration,onEnd:function(){h.resolve()}}).play():
h.resolve());return h},getPositionOnMobile:function(p){if("string"===typeof p&&(p=this.getPanelById(p),!p))return{};var h=d.getMarginBox(window.jimuConfig.layoutId),t=h.h/2;p.titleHeight||(p.titleHeight=35);return"maximized"===p.windowState?{left:0,right:0,top:0,bottom:0,width:"auto",height:"auto",contentHeight:h.h-p.titleHeight,borderRadiusStyle:{borderTopLeftRadius:0,borderTopRightRadius:0,borderBottomLeftRadius:0,borderBottomRightRadius:0}}:"minimized"===p.windowState?h.h>h.w?{left:0,right:0,top:"auto",
bottom:0,width:"auto",height:p.titleHeight,contentHeight:0,borderRadiusStyle:{borderTopLeftRadius:"4px",borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:0}}:{left:h.w-h.w/2,right:0,top:"auto",bottom:0,width:h.w/2,height:p.titleHeight,contentHeight:h.h,borderRadiusStyle:window.isRTL?{borderTopLeftRadius:0,borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:"4px"}:{borderTopLeftRadius:"4px",borderTopRightRadius:0,borderBottomLeftRadius:"4px",borderBottomRightRadius:0}}:
h.h>h.w?{left:0,right:0,top:t,bottom:0,width:"auto",height:"auto",contentHeight:h.h-t-p.titleHeight,borderRadiusStyle:{borderTopLeftRadius:"4px",borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:0}}:{left:h.w-h.w/2,right:0,top:0,bottom:0,width:h.w/2,height:"auto",contentHeight:h.h-t-p.titleHeight,borderRadiusStyle:window.isRTL?{borderTopLeftRadius:0,borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:"4px"}:{borderTopLeftRadius:"4px",borderTopRightRadius:0,
borderBottomLeftRadius:"4px",borderBottomRightRadius:0}}},_onPanelClick:function(p){this._activePanel(p)},_activePanel:function(p){if(this.activePanel){if(this.activePanel.id===p.id){this.activePanel.moveTopOnActive&&d.setStyle(this.activePanel.domNode,"zIndex",101);return}"active"===this.activePanel.state&&(this.activePanel.setState("opened"),d.setStyle(this.activePanel.domNode,"zIndex","undefined"!==typeof this.activePanel.position.zIndex?this.activePanel.position.zIndex:"auto"),this.activePanel.onDeActive())}var h=
this.widgetManager.activeWidget;h&&"active"===h.state&&h.getPanel()!==p&&(h.setState("opened"),!1===h.inPanel&&d.setStyle(h.domNode,"zIndex","undefined"!==typeof h.position.zIndex?h.position.zIndex:"auto"),h.onDeActive(),this.widgetManager.activeWidget=null);this.activePanel=p;"active"!==this.activePanel.state&&(this.activePanel.setState("active"),this.activePanel.moveTopOnActive&&d.setStyle(this.activePanel.domNode,"zIndex",101),this.activePanel.onActive())},_removePanel:function(p){var h=this.panels.indexOf(p);
-1<h&&this.panels.splice(h,1);this.activePanel&&this.activePanel.id===p.id&&(this.activePanel=null)},_onMoveStart:function(p){c.forEach(this.panels,function(h){h.domNode===p.node&&this._activePanel(h)},this)},_onWidgetActived:function(p){this.activePanel&&"active"===this.activePanel.state&&p.getPanel()!==this.activePanel&&(this.activePanel.setState("opened"),d.setStyle(this.activePanel.domNode,"zIndex","undefined"!==typeof this.activePanel.position.zIndex?this.activePanel.position.zIndex:"auto"),
this.activePanel.onDeActive(),this.activePanel=null)},_loadPanelClass:function(p){var h=new n;m([p],function(t){h.resolve(t)});return h},_loadThemeI18N:function(p){var h=new n;p.startWith("themes")?(p=p.split("/"),m(["dojo/i18n!"+(p[0]+"/"+p[1]+"/nls/strings")],function(t){h.resolve(t)})):h.resolve({});return h}});x.getInstance=function(){null===v&&(v=new x,window._panelManager=v);return v};return x})},"jimu/BaseWidgetFrame":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/html",
"dijit/_WidgetBase"],function(b,a,c,d){return b([d],{widget:null,baseClass:"jimu-widget-frame jimu-container",postCreate:function(){this.inherited(arguments);this.containerNode||(this.containerNode=this.domNode);this.widget&&this.setWidget(this.widget)},startup:function(){this.inherited(arguments);this.widget&&this.widget.startup()},resize:function(){this.widget&&"closed"!==this.widget.state&&a.isFunction(this.widget.resize)&&this.widget.resize()},setLoading:function(f){this.loading=f;this.loading.placeAt(this.containerNode)},
getWidget:function(){return this.widget},setWidget:function(f){this.widget=f;this.loading&&this.loading.destroy();c.place(f.domNode,this.containerNode);this.resize()},destroy:function(){if(this.widget&&this.widget.domNode)try{this.widget.destroy()}catch(f){console.error("destroy widget error. widget: ["+this.widget.uri+"], "+f.stack)}this.loading&&this.loading.domNode&&this.loading.destroy()}})})},"jimu/BaseWidgetPanel":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dijit/_WidgetBase dijit/_Container ./dijit/LoadingIndicator ./BaseWidgetFrame ./utils".split(" "),
function(b,a,c,d,f,n,k,g,q){return b([f,n],{baseClass:"jimu-panel jimu-container",started:!1,state:"closed",windowState:"normal",moveTopOnActive:!0,openAnimation:null,closeAnimation:null,animationDuration:0,startup:function(){this.inherited(arguments);this.loadAllWidgetsInOrder();this.started=!0},loadAllWidgetsInOrder:function(){var e=this.getAllWidgetConfigs();e=Array.isArray(this.config.widgets)?this.config.widgets:[this.config];c.forEach(e,function(m){if(!1!==m.visible){var l=new k;var w=this.createFrame(m);
this.addChild(w);w.setLoading(l);this.widgetManager.loadWidget(m).then(a.hitch(this,function(v){w.setWidget(v);v.startup()}))}},this)},getAllWidgetConfigs:function(){var e=[];return e=Array.isArray(this.config.widgets)?this.config.widgets:[this.config]},getWidgetById:function(e){for(var m=this.getChildren(),l=0;l<m.length;l++)if(m[l].getWidget()&&m[l].getWidget().id===e)return m[l].getWidget()},createFrame:function(e){return new g},setPosition:function(e,m){this.position=e;var l=q.getPositionStyle(this.position);
l.position="absolute";m||(m="map"===e.relativeTo?this.sceneView.map.id:window.jimuConfig.layoutId);this.started?this.resize():this.openAnimation&&(l.display="none");d.place(this.domNode,m);d.setStyle(this.domNode,l)},getPosition:function(){return this.position},setState:function(e){this.state=e},setWindowState:function(e){this.windowState=e},resize:function(){this.getChildren().forEach(function(e){e.resize()})},onPositionChange:function(e){this.setPosition(e)},onOpen:function(){c.forEach(this.getChildren(),
function(e){e.getWidget()&&this.widgetManager.openWidget(e.getWidget())},this)},onClose:function(){c.forEach(this.getChildren(),function(e){e.getWidget()&&this.widgetManager.closeWidget(e.getWidget())},this)},onMaximize:function(){c.forEach(this.getChildren(),function(e){e.getWidget()&&this.widgetManager.maximizeWidget(e.getWidget())},this)},onMinimize:function(){c.forEach(this.getChildren(),function(e){e.getWidget()&&this.widgetManager.minimizeWidget(e.getWidget())},this)},onNormalize:function(){c.forEach(this.getChildren(),
function(e){e.getWidget()&&this.widgetManager.normalizeWidget(e.getWidget())},this)},onActive:function(){},onDeActive:function(){},updateConfig:function(e){this._updateConfig(e)},reloadWidget:function(e){this.isWidgetInPanel(e)&&(this._updateConfig(e),this.getChildren().forEach(function(m){m.getWidget()&&m.getWidget().id===e.id&&(m.getWidget().destroy(),m.setLoading(new k),this.widgetManager.loadWidget(e).then(a.hitch(this,function(l){m.setWidget(l);l.startup();"closed"===this.state&&this.widgetManager.closeWidget(l)})))},
this))},isWidgetInPanel:function(e){return c.some(this.getAllWidgetConfigs(),function(m){if(e.id===m.id)return!0})?!0:!1},_updateConfig:function(e){if(Array.isArray(this.config.widgets)){for(var m=-1,l=0;l<this.config.widgets.length;l++)this.config.widgets[l].id===e.id&&(m=l);0<m&&(this.config.widgets[m]=e)}else this.config=e},destroy:function(){this.getChildren().forEach(function(e){try{e.domNode&&e.destroy()}catch(m){console.error("destroy widget frame error."+m.stack)}});this.inherited(arguments)}})})},
"dijit/_Container":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/dom-construct","dojo/_base/kernel"],function(b,a,c,d){return a("dijit._Container",null,{buildRendering:function(){this.inherited(arguments);this.containerNode||(this.containerNode=this.domNode)},addChild:function(f,n){var k=this.containerNode;if(0<n){for(k=k.firstChild;0<n;)1==k.nodeType&&n--,k=k.nextSibling;k?n="before":(k=this.containerNode,n="last")}c.place(f.domNode,k,n);this._started&&!f._started&&f.startup()},
removeChild:function(f){"number"==typeof f&&(f=this.getChildren()[f]);f&&(f=f.domNode)&&f.parentNode&&f.parentNode.removeChild(f)},hasChildren:function(){return 0<this.getChildren().length},_getSiblingOfChild:function(f,n){var k=this.getChildren();f=b.indexOf(k,f);return k[f+n]},getIndexOfChild:function(f){return b.indexOf(this.getChildren(),f)}})})},"jimu/dijit/LoadingIndicator":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dojo/dom-style","dojo/dom-construct"],function(b,a,c,d){return b(a,
{baseClass:"jimu-loading-indicator",declaredClass:"jimu.dijit.LoadingIndicator",hidden:!1,postCreate:function(){this.inherited(arguments);(this.hidden=!0===this.hidden)&&c.set(this.domNode,{display:"none"});c.set(this.domNode,{width:"100%",height:"100%"});d.place(' \x3cdiv class\x3d"loading-container"\x3e\x3cdiv data-dojo-attach-point\x3d"loadingNode" class\x3d"img-div"\x3e\x3c/div\x3e\x3c/div\x3e',this.domNode)},show:function(){this.domNode&&c.set(this.domNode,"display","block")},hide:function(){this.domNode&&
c.set(this.domNode,"display","none")}})})},"jimu/BaseWidgetSetting":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","dijit/_WidgetBase","dijit/_TemplatedMixin"],function(b,a,c,d,f){return b([d,f],{templateString:"\x3cdiv\x3e\x3c/div\x3e",postCreate:function(){this.own(c(window,"resize",a.hitch(this,this._onWindowResize)))},getConfig:function(){},resize:function(){},_onWindowResize:function(){this.resize()}})})},"jimu/PoolControllerMixin":function(){define(["dojo/_base/declare",
"dojo/_base/array","jimu/PanelManager"],function(b,a,c){return b(null,{constructor:function(){this.panelManager=c.getInstance()},postCreate:function(){this.controlledWidgets||(this.controlledWidgets="all");this.controlledGroups||(this.controlledGroups="all")},getOpenedIds:function(){},setOpenedIds:function(d){},getConfigById:function(d){for(var f=this.getAllConfigs(),n=0;n<f.length;n++)if(f[n].id===d)return f[n]},getAllConfigs:function(){var d=[];d=d.concat(this.getWidgetConfigs(),this.getGroupConfigs());
d=a.filter(d,function(f){return f.visible});return d.sort(function(f,n){return f.index-n.index})},getAllConfigsIncludeInvisible:function(){var d=[];d=d.concat(this.getWidgetConfigs(),this.getGroupConfigs());return d.sort(function(f,n){return f.index-n.index})},isControlled:function(d){return a.some(this.getAllConfigsIncludeInvisible(),function(f){return f.id===d})},widgetIsControlled:function(d){return a.some(this.getAllConfigsIncludeInvisible(),function(f){return f.id===d?!0:a.some(f.widgets,function(n){return n.id===
d})})},getGroupConfigs:function(){var d=[];if(!this.appConfig.widgetPool)return d;this.appConfig.widgetPool.groups&&a.forEach(this.appConfig.widgetPool.groups,function(f){this.controlledGroups&&(Array.isArray(this.controlledGroups)?-1<this.controlledGroups.indexOf(f.id)&&d.push(f):"all"===this.controlledGroups&&d.push(f))},this);return d},getWidgetConfigs:function(){var d=[];if(!this.appConfig.widgetPool)return d;this.appConfig.widgetPool.widgets&&a.forEach(this.appConfig.widgetPool.widgets,function(f){this.controlledWidgets&&
(Array.isArray(this.controlledWidgets)?-1<this.controlledWidgets.indexOf(f.id)&&d.push(f):"all"===this.controlledWidgets&&d.push(f))},this);return d}})})},"jimu/SpatialReference/utils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dojo/promise/all dojo/request esri/geometry/SpatialReference ./unitUtils".split(" "),function(b,a,c,d,f,n,k,g){var q=null,e=null,m=!1;b=b(null,function(){});var l=require.toUrl("jimu"),w=n(l+"/SpatialReference/wkidDetails.json",{handleAs:"json"}),
v=n(l+"/SpatialReference/transform.json",{handleAs:"json"});b.loadResource=function(){var x=new d;if(q&&e)return x.resolve(),x;f([w,v]).then(function(p){q=p[0];e=p[1];m=!0;x.resolve()},function(p){console.error(p);m=!1;x.reject(p)});return x};b.getAllCSUnits=function(){if(m){var x=[];c.forEach(q.wkids,a.hitch(this,function(p){p=this.getCSUnit(p);-1===c.indexOf(x,p)&&x.push(p)}));return x}};b.convertUnit=function(x,p,h){if(m)return g.convertUnit(x,p,h)};b.getUnitRate=function(x,p){if(m)return g.getUnitRate(x,
p)};b.isProjectUnit=function(x){if(m)return g.isProjectUnit(x)};b.isGeographicUnit=function(x){if(m)return g.isGeographicUnit(x)};b.getGeographicUnits=function(){if(m)return g.getGeographicUnits()};b.getProjectUnits=function(){if(m)return g.getProjectUnits()};b.getCSUnit=function(x){if(m){x=this.getCSStr(x);var p=0,h=0;p=x.lastIndexOf("UNIT");h=x.indexOf(",",p);return x.slice(p+6,h-1)}};b.isSameSR=function(x,p){if(m)return x=this.indexOfWkid(x),p=this.indexOfWkid(p),q.labels[x]===q.labels[p]};b.isValidWkid=
function(x){if(m)return-1<this.indexOfWkid(x)};b.getSRLabel=function(x){if(m&&this.isValidWkid(x))return x=this.indexOfWkid(x),q.labels[x]};b.indexOfWkid=function(x){if(m)return c.indexOf(q.wkids,x)};b.isWebMercator=function(x){return k.prototype._isWebMercator?k.prototype._isWebMercator.apply({wkid:parseInt(x,10)},[]):(new k(parseInt(x,10))).isWebMercator};b.standardizeWkid=function(x){return this.isWebMercator(x)?3857:parseInt(x,10)};b.isValidTfWkid=function(x){if(m)return-1<this.indexOfTfWkid(x)};
b.getTransformationLabel=function(x){if(m)return this.isValidTfWkid(x)?(x=this.indexOfTfWkid(x),e.labels[x]):""};b.indexOfTfWkid=function(x){if(m)return c.indexOf(e.tfWkids,x)};b.isGeographicCS=function(x){if(m)return this.isValidWkid(x)?q.details[this.indexOfWkid(x)].startWith("GEOGCS"):!1};b.isProjectedCS=function(x){if(m)return this.isValidWkid(x)?q.details[this.indexOfWkid(x)].startWith("PROJCS"):!1};b.getGeoCSByProj=function(x){if(m&&this.isProjectedCS(x))return x=this.getSpheroidStr(x),x=c.indexOf(q.details,
x),q.wkids[x]};b.getSpheroidStr=function(x){if(m){if(this.isGeographicCS(x))return q.details[this.indexOfWkid(x)];if(this.isProjectedCS(x)){x=q.details[this.indexOfWkid(x)];var p=x.indexOf("GEOGCS"),h=x.indexOf("PROJECTION")-1;return x.slice(p,h)}return null}};b.getCSStr=function(x){if(m)return q.details[this.indexOfWkid(x)]};b.isSameSpheroid=function(x,p){if(m)return x=this.getSpheroidStr(x),p=this.getSpheroidStr(p),x&&p&&x===p?!0:!1};return b})},"dojo/request":function(){define(["./request/default!"],
function(b){return b})},"dojo/request/default":function(){define(["exports","require","../has"],function(b,a,c){var d=c("config-requestProvider");if(c("host-browser")||c("host-webworker"))var f="./xhr";d||(d=f);b.getPlatformDefaultId=function(){return f};b.load=function(n,k,g,q){a(["platform"==n?f:d],function(e){g(e)})}})},"jimu/SpatialReference/unitUtils":function(){define(["dojo/_base/declare","dojo/_base/array"],function(b,a){var c="INCHES FOOT FOOT_US YARDS MILES NAUTICAL_MILES MILLIMETERS CENTIMETERS METER KILOMETERS DECIMETERS LINK_CLARKE FOOT_GOLD_COAST FOOT_CLARKE CHAIN_SEARS_1992_TRUNCATED YARD_INDIAN CHAIN_BENOIT_1895_B YARD_SEARS CHAIN_SEARS FOOT_SEARS YARD_INDIAN_1937 50_KILOMETERS 150_KILOMETERS".split(" "),
d="DECIMAL_DEGREES DEGREE_MINUTE_SECONDS DEGREE GRAD MGRS USNG".split(" "),f={INCHES:.0254,FOOT:.3048,FOOT_US:.3048006096012192,YARDS:.9144,MILES:1609.344,NAUTICAL_MILES:1852,MILLIMETERS:.001,CENTIMETERS:.01,METER:1,KILOMETERS:1E3,DECIMETERS:.1,LINK_CLARKE:.2011661949,FOOT_GOLD_COAST:.3047997101815088,FOOT_CLARKE:.304797265,CHAIN_SEARS_1922_TRUNCATED:20.116756,YARD_INDIAN:.9143985307444408,CHAIN_BENOIT_1895_B:20.11678249437587,YARD_SEARS:.9143984146160287,CHAIN_SEARS:20.11676512155263,FOOT_SEARS:.3047994715386762,
YARD_INDIAN_1937:.91439523,"50_KILOMETERS":5E4,"150_KILOMETERS":15E4,DEGREE:.0174532925199433,DECIMAL_DEGREES:.0174532925199433,MGRS:.0174532925199433,USNG:.0174532925199433,DEGREE_MINUTE_SECONDS:.0174532925199433,GRAD:.01570796326794897};b=b(null,function(){});b.convertUnit=function(n,k,g){return f[n.toUpperCase()]/f[k.toUpperCase()]*g};b.getUnitRate=function(n,k){return f[n.toUpperCase()]/f[k.toUpperCase()]};b.isProjectUnit=function(n){return-1<a.indexOf(c,n.toUpperCase())};b.isGeographicUnit=function(n){return-1<
a.indexOf(d,n.toUpperCase())};b.getGeographicUnits=function(){return d};b.getProjectUnits=function(){return c};return b})},"jimu/OnScreenWidgetPanel":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/on dojo/dnd/move dijit/_TemplatedMixin jimu/BaseWidgetPanel jimu/utils dojox/layout/ResizeHandle dojo/touch".split(" "),function(b,a,c,d,f,n,k,g,q){return b([k,n],{baseClass:"jimu-panel jimu-on-screen-widget-panel",_positionInfoBox:null,_originalBox:null,widgetIcon:null,_resizeOnOpen:!0,
templateString:'\x3cdiv data-dojo-attach-point\x3d"boxNode"\x3e\x3cdiv class\x3d"jimu-panel-title jimu-main-background" data-dojo-attach-point\x3d"titleNode"\x3e\x3cdiv class\x3d"title-label jimu-vcenter-text jimu-float-leading jimu-leading-padding1"data-dojo-attach-point\x3d"titleLabelNode"\x3e${label}\x3c/div\x3e\x3cdiv class\x3d"close-btn jimu-vcenter jimu-float-trailing" data-dojo-attach-point\x3d"closeNode"data-dojo-attach-event\x3d"onclick:_onCloseBtnClicked,press:_onCloseBtnClicked"\x3e\x3c/div\x3e\x3cdiv class\x3d"max-btn jimu-vcenter jimu-float-trailing" data-dojo-attach-point\x3d"maxNode"data-dojo-attach-event\x3d"onclick:_onMaxBtnClicked"\x3e\x3c/div\x3e\x3cdiv class\x3d"foldable-btn jimu-vcenter jimu-float-trailing" data-dojo-attach-point\x3d"foldableNode"data-dojo-attach-event\x3d"onclick:_onFoldableBtnClicked"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"jimu-panel-content" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\x3c/div\x3e',
postCreate:function(){this._originalBox={w:400,h:410}},startup:function(){this.inherited(arguments);this._normalizePositionObj(this.position);this._makeOriginalBox();this.makePositionInfoBox();this.makeMoveable(this._positionInfoBox.w,.25*this._positionInfoBox.w)},_onMaxBtnClicked:function(e){e.stopPropagation();this._getPositionInfo().isRunInMobile&&("maximized"===this.windowState?this.panelManager.normalizePanel(this):this.panelManager.maximizePanel(this),this._setMobilePosition())},_onFoldableBtnClicked:function(e){e.stopPropagation();
this._getPositionInfo().isRunInMobile&&("minimized"===this.windowState?(c.removeClass(this.foldableNode,"fold-up"),c.addClass(this.foldableNode,"fold-down"),this.panelManager.normalizePanel(this)):(c.removeClass(this.foldableNode,"fold-down"),c.addClass(this.foldableNode,"fold-up"),this.panelManager.minimizePanel(this)),this._setMobilePosition())},_onCloseBtnClicked:function(e){this.panelManager.closePanel(this);e.stopPropagation()},_normalizePositionObj:function(e){var m=this._getLayoutBox();e.left=
isFinite(e.left)?e.left:m.w-e.right;e.top=isFinite(e.top)?e.top:m.h-e.bottom;delete e.right;delete e.bottom;this.position=a.mixin(a.clone(this.position),e)},makePositionInfoBox:function(){this._positionInfoBox={w:this.position.width||400,h:this.position.height||410,l:this.position.left||0,t:this.position.top||0}},_makeOriginalBox:function(){this._originalBox={w:this.position.width||400,h:this.position.height||410,l:this.position.left||0,t:this.position.top||0}},makeResizable:function(){this.disableResizable();
this.resizeHandle=(new q({targetId:this,minWidth:this._originalBox.w,minHeight:this._originalBox.h,activeResize:!1})).placeAt(this.domNode);this.resizeHandle.startup()},disableResizable:function(){this.resizeHandle&&(this.resizeHandle.destroy(),this.resizeHandle=null)},makeMoveable:function(e,m){this.disableMoveable();var l=c.getMarginBox(jimuConfig.layoutId);l.l=l.l-e+m;l.w+=2*(e-m);this.moveable=new f.boxConstrainedMoveable(this.domNode,{box:l,handle:this.titleNode,within:!0});this.own(d(this.moveable,
"Moving",a.hitch(this,this.onMoving)));this.own(d(this.moveable,"MoveStop",a.hitch(this,this.onMoveStop)))},disableMoveable:function(){this.moveable&&(this.moveable.destroy(),this.moveable=null)},createHandleNode:function(){return this.titleNode},onOpen:function(){this._resizeOnOpen&&(this.resize(),this._resizeOnOpen=!1);this.inherited(arguments)},_switchToMobileUI:function(){c.removeClass(this.titleNode,"title-normal");c.addClass(this.titleNode,"title-full");c.setStyle(this.foldableNode,"display",
"block");c.setStyle(this.maxNode,"display","block");"normal"===this.windowState?(c.removeClass(this.foldableNode,"fold-up"),c.addClass(this.foldableNode,"fold-down")):(c.removeClass(this.foldableNode,"fold-down"),c.addClass(this.foldableNode,"fold-up"))},_switchToDesktopUI:function(){c.removeClass(this.titleNode,"title-full");c.addClass(this.titleNode,"title-normal");c.setStyle(this.foldableNode,"display","none");c.setStyle(this.maxNode,"display","none")},resize:function(e){var m=this._getPositionInfo(),
l={left:m.position.left,top:m.position.top,width:this._positionInfoBox.w,height:this._positionInfoBox.h};e&&(e.t=this.domNode.offsetTop,l.left=isFinite(e.l)?e.l:l.left,l.top=isFinite(e.t)?e.t:l.top,l.width=isFinite(e.w)?e.w:l.width,l.height=isFinite(e.h)?e.h:l.height,this._normalizePositionObj(a.clone(l)),this.makePositionInfoBox(),l.width=this._positionInfoBox.w,l.height=this._positionInfoBox.h);m.position=l;this._onResponsible(m);this.inherited(arguments)},_onResponsible:function(e){e.isRunInMobile?
(this._setMobilePosition(),this.disableMoveable(),this.disableResizable(),this._switchToMobileUI()):(this._setDesktopPosition(e.position),this.makeResizable(),this.makeMoveable(this._positionInfoBox.w,.25*this._positionInfoBox.w),this._switchToDesktopUI())},setPosition:function(e){this._normalizePositionObj(e);this.makePositionInfoBox();e=this._getPositionInfo();this._onResponsible(e)},destroy:function(){this.widgetIcon=null;this.inherited(arguments)},_getLayoutBox:function(){var e=jimuConfig.layoutId;
e="map"===this.position.relativeTo?jimuConfig.mapId:jimuConfig.layoutId;return c.getMarginBox(e)},_getPositionInfo:function(){var e={isRunInMobile:!1,position:{left:0,top:5}},m=this._getLayoutBox(),l=this._positionInfoBox.l;if(window.appInfo.isRunInMobile)return e.isRunInMobile=!0,e;e.position.left=window.isRTL?m.w-l:l;l=this._positionInfoBox.t;var w=m.h-l;l>=w?l>=this._positionInfoBox.h&&(e.position.top=this._positionInfoBox.t-this._positionInfoBox.h-40-3):w>=this._positionInfoBox.h&&(e.position.top=
this._positionInfoBox.t+40+3);!e.isRunInMobile&&e.position.left+this._positionInfoBox.w>m.w&&(e.position.left-=this._positionInfoBox.w);return e},_setMobilePosition:function(){c.place(this.domNode,jimuConfig.layoutId);var e=this.panelManager.getPositionOnMobile(this);this.position.zIndex&&(e.zIndex=this.position.zIndex);var m=g.getPositionStyle(e);a.mixin(m,e.borderRadiusStyle);c.setStyle(this.domNode,m)},_setDesktopPosition:function(e){c.place(this.domNode,jimuConfig.mapId);c.setStyle(this.domNode,
{left:e.left+"px",right:"auto",top:e.top+"px",width:(e.width||this.position.width||this._originalBox.w)+"px",height:(e.height||this.position.height||this._originalBox.h)+"px"})},onMoving:function(e){c.setStyle(e.node,"opacity",.9)},onMoveStop:function(e){c.setStyle(e.node,"opacity",1);e=c.getMarginBox(e.node);this._normalizePositionObj(a.clone({left:e.l,top:e.t,width:e.w,height:e.h}));this.makePositionInfoBox()}})})},"dojox/layout/ResizeHandle":function(){define("dojo/_base/kernel dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/event dojo/_base/fx dojo/_base/window dojo/fx dojo/dom dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/_base/declare dojo/touch dijit/_base/manager dijit/_Widget dijit/_TemplatedMixin".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h){b.experimental("dojox.layout.ResizeHandle");var t=w("dojox.layout._ResizeHelper",p,{show:function(){l.set(this.domNode,"display","")},hide:function(){l.set(this.domNode,"display","none")},resize:function(r){m.setMarginBox(this.domNode,r)}});return w("dojox.layout.ResizeHandle",[p,h],{targetId:"",targetContainer:null,resizeAxis:"xy",activeResize:!1,activeResizeClass:"dojoxResizeHandleClone",animateSizing:!0,animateMethod:"chain",animateDuration:225,minHeight:100,
minWidth:100,constrainMax:!1,maxHeight:0,maxWidth:0,fixedAspect:!1,intermediateChanges:!1,startTopic:"/dojo/resize/start",endTopic:"/dojo/resize/stop",templateString:'\x3cdiv dojoAttachPoint\x3d"resizeHandle" class\x3d"dojoxResizeHandle"\x3e\x3cdiv\x3e\x3c/div\x3e\x3c/div\x3e',postCreate:function(){this.connect(this.resizeHandle,v.press,"_beginSizing");this.activeResize?this.animateSizing=!1:(this._resizeHelper=x.byId("dojoxGlobalResizeHelper"),this._resizeHelper||(this._resizeHelper=(new t({id:"dojoxGlobalResizeHelper"})).placeAt(k.body()),
e.add(this._resizeHelper.domNode,this.activeResizeClass)));this.minSize||(this.minSize={w:this.minWidth,h:this.minHeight});this.constrainMax&&(this.maxSize={w:this.maxWidth,h:this.maxHeight});this._resizeX=this._resizeY=!1;var r=a.partial(e.add,this.resizeHandle);switch(this.resizeAxis.toLowerCase()){case "xy":this._resizeX=this._resizeY=!0;r("dojoxResizeNW");break;case "x":this._resizeX=!0;r("dojoxResizeW");break;case "y":this._resizeY=!0,r("dojoxResizeN")}},_beginSizing:function(r){if(!this._isSizing&&
(c.publish(this.startTopic,[this]),this.targetDomNode=(this.targetWidget=x.byId(this.targetId))?this.targetWidget.domNode:q.byId(this.targetId),this.targetContainer&&(this.targetDomNode=this.targetContainer),this.targetDomNode)){if(!this.activeResize){var u=m.position(this.targetDomNode,!0);this._resizeHelper.resize({l:u.x,t:u.y,w:u.w,h:u.h});this._resizeHelper.show();this.isLeftToRight()||(this._resizeHelper.startPosition={l:u.x,t:u.y})}this._isSizing=!0;this.startPoint={x:r.clientX,y:r.clientY};
u=l.getComputedStyle(this.targetDomNode);var y="border-model"===m.boxModel?{w:0,h:0}:m.getPadBorderExtents(this.targetDomNode,u),z=m.getMarginExtents(this.targetDomNode,u);this.startSize={w:l.get(this.targetDomNode,"width",u),h:l.get(this.targetDomNode,"height",u),pbw:y.w,pbh:y.h,mw:z.w,mh:z.h};this.isLeftToRight()||"absolute"!=l.get(this.targetDomNode,"position")||(u=m.position(this.targetDomNode,!0),this.startPosition={l:u.x,t:u.y});this._pconnects=[c.connect(k.doc,v.move,this,"_updateSizing"),
c.connect(k.doc,v.release,this,"_endSizing")];f.stop(r)}},_updateSizing:function(r){if(this.activeResize)this._changeSizing(r);else{var u=this._getNewCoords(r,"border",this._resizeHelper.startPosition);if(!1===u)return;this._resizeHelper.resize(u)}r.preventDefault()},_getNewCoords:function(r,u,y){try{if(!r.clientX||!r.clientY)return!1}catch(C){return!1}this._activeResizeLastEvent=r;var z=(this.isLeftToRight()?1:-1)*(this.startPoint.x-r.clientX),A=this.startPoint.y-r.clientY;r=this.startSize.w-(this._resizeX?
z:0);A=this._checkConstraints(r,this.startSize.h-(this._resizeY?A:0));(y=y||this.startPosition)&&this._resizeX&&(A.l=y.l+z,A.w!=r&&(A.l+=r-A.w),A.t=y.t);switch(u){case "margin":A.w+=this.startSize.mw,A.h+=this.startSize.mh;case "border":A.w+=this.startSize.pbw,A.h+=this.startSize.pbh}return A},_checkConstraints:function(r,u){if(this.minSize){var y=this.minSize;r<y.w&&(r=y.w);u<y.h&&(u=y.h)}this.constrainMax&&this.maxSize&&(y=this.maxSize,r>y.w&&(r=y.w),u>y.h&&(u=y.h));if(this.fixedAspect){y=this.startSize.w;
var z=this.startSize.h,A=y*u-z*r;0>A?r=u*y/z:0<A&&(u=r*z/y)}return{w:r,h:u}},_changeSizing:function(r){var u=this.targetWidget&&a.isFunction(this.targetWidget.resize),y=this._getNewCoords(r,u&&"margin");if(!1!==y&&(u?this.targetWidget.resize(y):this.animateSizing?g[this.animateMethod]([n.animateProperty({node:this.targetDomNode,properties:{width:{start:this.startSize.w,end:y.w}},duration:this.animateDuration}),n.animateProperty({node:this.targetDomNode,properties:{height:{start:this.startSize.h,end:y.h}},
duration:this.animateDuration})]).play():l.set(this.targetDomNode,{width:y.w+"px",height:y.h+"px"}),this.intermediateChanges))this.onResize(r)},_endSizing:function(r){d.forEach(this._pconnects,c.disconnect);var u=a.partial(c.publish,this.endTopic,[this]);this.activeResize?u():(this._resizeHelper.hide(),this._changeSizing(r),setTimeout(u,this.animateDuration+15));this._isSizing=!1;this.onResize(r)},onResize:function(r){}})})},"dojo/fx":function(){define("./_base/lang ./Evented ./_base/kernel ./_base/array ./aspect ./_base/fx ./dom ./dom-style ./dom-geometry ./ready require".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m){c.isAsync||e(0,function(){m(["./fx/Toggler"])});c=c.fx={};e={_fire:function(v,x){this[v]&&this[v].apply(this,x||[]);return this}};var l=function(v){this._index=-1;this._animations=v||[];this._current=this._onAnimateCtx=this._onEndCtx=null;this.duration=0;d.forEach(this._animations,function(x){x&&("undefined"!=typeof x.duration&&(this.duration+=x.duration),x.delay&&(this.duration+=x.delay))},this)};l.prototype=new a;b.extend(l,{_onAnimate:function(){this._fire("onAnimate",
arguments)},_onEnd:function(){this._onAnimateCtx.remove();this._onEndCtx.remove();this._onAnimateCtx=this._onEndCtx=null;this._index+1==this._animations.length?this._fire("onEnd"):(this._current=this._animations[++this._index],this._onAnimateCtx=f.after(this._current,"onAnimate",b.hitch(this,"_onAnimate"),!0),this._onEndCtx=f.after(this._current,"onEnd",b.hitch(this,"_onEnd"),!0),this._current.play(0,!0))},play:function(v,x){this._current||(this._current=this._animations[this._index=0]);if(!x&&"playing"==
this._current.status())return this;var p=f.after(this._current,"beforeBegin",b.hitch(this,function(){this._fire("beforeBegin")}),!0),h=f.after(this._current,"onBegin",b.hitch(this,function(r){this._fire("onBegin",arguments)}),!0),t=f.after(this._current,"onPlay",b.hitch(this,function(r){this._fire("onPlay",arguments);p.remove();h.remove();t.remove()}));this._onAnimateCtx&&this._onAnimateCtx.remove();this._onAnimateCtx=f.after(this._current,"onAnimate",b.hitch(this,"_onAnimate"),!0);this._onEndCtx&&
this._onEndCtx.remove();this._onEndCtx=f.after(this._current,"onEnd",b.hitch(this,"_onEnd"),!0);this._current.play.apply(this._current,arguments);return this},pause:function(){if(this._current){var v=f.after(this._current,"onPause",b.hitch(this,function(x){this._fire("onPause",arguments);v.remove()}),!0);this._current.pause()}return this},gotoPercent:function(v,x){this.pause();var p=this.duration*v;this._current=null;d.some(this._animations,function(h,t){if(p<=h.duration)return this._current=h,this._index=
t,!0;p-=h.duration;return!1},this);this._current&&this._current.gotoPercent(p/this._current.duration);x&&this.play();return this},stop:function(v){if(this._current){if(v){for(;this._index+1<this._animations.length;++this._index)this._animations[this._index].stop(!0);this._current=this._animations[this._index]}var x=f.after(this._current,"onStop",b.hitch(this,function(p){this._fire("onStop",arguments);x.remove()}),!0);this._current.stop()}return this},status:function(){return this._current?this._current.status():
"stopped"},destroy:function(){this.stop();this._onAnimateCtx&&this._onAnimateCtx.remove();this._onEndCtx&&this._onEndCtx.remove()}});b.extend(l,e);c.chain=function(v){return new l(b.isArray(v)?v:Array.prototype.slice.call(v,0))};var w=function(v){this._animations=v||[];this._connects=[];this.duration=this._finished=0;d.forEach(v,function(p){var h=p.duration;p.delay&&(h+=p.delay);this.duration<h&&(this.duration=h);this._connects.push(f.after(p,"onEnd",b.hitch(this,"_onEnd"),!0))},this);this._pseudoAnimation=
new n.Animation({curve:[0,1],duration:this.duration});var x=this;d.forEach("beforeBegin onBegin onPlay onAnimate onPause onStop onEnd".split(" "),function(p){x._connects.push(f.after(x._pseudoAnimation,p,function(){x._fire(p,arguments)},!0))})};b.extend(w,{_doAction:function(v,x){d.forEach(this._animations,function(p){p[v].apply(p,x)});return this},_onEnd:function(){++this._finished>this._animations.length&&this._fire("onEnd")},_call:function(v,x){var p=this._pseudoAnimation;p[v].apply(p,x)},play:function(v,
x){this._finished=0;this._doAction("play",arguments);this._call("play",arguments);return this},pause:function(){this._doAction("pause",arguments);this._call("pause",arguments);return this},gotoPercent:function(v,x){var p=this.duration*v;d.forEach(this._animations,function(h){h.gotoPercent(h.duration<p?1:p/h.duration,x)});this._call("gotoPercent",arguments);return this},stop:function(v){this._doAction("stop",arguments);this._call("stop",arguments);return this},status:function(){return this._pseudoAnimation.status()},
destroy:function(){this.stop();d.forEach(this._connects,function(v){v.remove()})}});b.extend(w,e);c.combine=function(v){return new w(b.isArray(v)?v:Array.prototype.slice.call(v,0))};c.wipeIn=function(v){var x=v.node=k.byId(v.node),p=x.style,h;v=n.animateProperty(b.mixin({properties:{height:{start:function(){h=p.overflow;p.overflow="hidden";if("hidden"==p.visibility||"none"==p.display)return p.height="1px",p.display="",p.visibility="",1;var r=g.get(x,"height");return Math.max(r,1)},end:function(){return x.scrollHeight}}}},
v));var t=function(){p.height="auto";p.overflow=h};f.after(v,"onStop",t,!0);f.after(v,"onEnd",t,!0);return v};c.wipeOut=function(v){var x=(v.node=k.byId(v.node)).style,p;v=n.animateProperty(b.mixin({properties:{height:{end:1}}},v));f.after(v,"beforeBegin",function(){p=x.overflow;x.overflow="hidden";x.display=""},!0);var h=function(){x.overflow=p;x.height="auto";x.display="none"};f.after(v,"onStop",h,!0);f.after(v,"onEnd",h,!0);return v};c.slideTo=function(v){var x=null,p=null,h=function(t){return function(){var r=
g.getComputedStyle(t),u=r.position;x="absolute"==u?t.offsetTop:parseInt(r.top)||0;p="absolute"==u?t.offsetLeft:parseInt(r.left)||0;"absolute"!=u&&"relative"!=u&&(r=q.position(t,!0),x=r.y,p=r.x,t.style.position="absolute",t.style.top=x+"px",t.style.left=p+"px")}}(v.node=k.byId(v.node));h();v=n.animateProperty(b.mixin({properties:{top:v.top||0,left:v.left||0}},v));f.after(v,"beforeBegin",h,!0);return v};return c})},"dijit/_base/manager":function(){define(["dojo/_base/array","dojo/_base/config","dojo/_base/lang",
"../registry","../main"],function(b,a,c,d,f){var n={};b.forEach("byId getUniqueId findWidgets _destroyAll byNode getEnclosingWidget".split(" "),function(k){n[k]=d[k]});c.mixin(n,{defaultDuration:a.defaultDuration||200});c.mixin(f,n);return f})},"dijit/_Widget":function(){define("dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/has dojo/_base/kernel dojo/_base/lang dojo/query dojo/ready ./registry ./_WidgetBase ./_OnDijitClickMixin ./_FocusMixin dojo/uacss ./hccss".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w){function v(){}function x(p){return function(h,t,r,u){return h&&"string"==typeof t&&h[t]==v?h.on(t.substring(2).toLowerCase(),k.hitch(r,u)):p.apply(c,arguments)}}b.around(c,"connect",x);n.connect&&b.around(n,"connect",x);b=d("dijit._Widget",[m,l,w],{onClick:v,onDblClick:v,onKeyDown:v,onKeyPress:v,onKeyUp:v,onMouseDown:v,onMouseMove:v,onMouseOut:v,onMouseOver:v,onMouseLeave:v,onMouseEnter:v,onMouseUp:v,constructor:function(p){this._toConnect={};for(var h in p)this[h]===
v&&(this._toConnect[h.replace(/^on/,"").toLowerCase()]=p[h],delete p[h])},postCreate:function(){this.inherited(arguments);for(var p in this._toConnect)this.on(p,this._toConnect[p]);delete this._toConnect},on:function(p,h){return this[this._onMap(p)]===v?c.connect(this.domNode,p.toLowerCase(),this,h):this.inherited(arguments)},_setFocusedAttr:function(p){this._focused=p;this._set("focused",p)},setAttribute:function(p,h){n.deprecated(this.declaredClass+"::setAttribute(attr, value) is deprecated. Use set() instead.",
"","2.0");this.set(p,h)},attr:function(p,h){return 2<=arguments.length||"object"===typeof p?this.set.apply(this,arguments):this.get(p)},getDescendants:function(){n.deprecated(this.declaredClass+"::getDescendants() is deprecated. Use getChildren() instead.","","2.0");return this.containerNode?g("[widgetId]",this.containerNode).map(e.byNode):[]},_onShow:function(){this.onShow()},onShow:function(){},onHide:function(){},onClose:function(){return!0}});f("dijit-legacy-requires")&&q(0,function(){require(["dijit/_base"])});
return b})},"dijit/_OnDijitClickMixin":function(){define("dojo/on dojo/_base/array dojo/keys dojo/_base/declare dojo/has ./a11yclick".split(" "),function(b,a,c,d,f,n){b=d("dijit._OnDijitClickMixin",null,{connect:function(k,g,q){return this.inherited(arguments,[k,"ondijitclick"==g?n:g,q])}});b.a11yclick=n;return b})},"dijit/a11yclick":function(){define(["dojo/keys","dojo/mouse","dojo/on","dojo/touch"],function(b,a,c,d){function f(g){if((g.keyCode===b.ENTER||g.keyCode===b.SPACE)&&!/input|button|textarea/i.test(g.target.nodeName))for(g=
g.target;g;g=g.parentNode)if(g.dojoClick)return!0}var n;c(document,"keydown",function(g){f(g)?(n=g.target,g.preventDefault()):n=null});c(document,"keyup",function(g){f(g)&&g.target==n&&(n=null,c.emit(g.target,"click",{cancelable:!0,bubbles:!0,ctrlKey:g.ctrlKey,shiftKey:g.shiftKey,metaKey:g.metaKey,altKey:g.altKey,_origType:g.type}))});var k=function(g,q){g.dojoClick=!0;return c(g,"click",q)};k.click=k;k.press=function(g,q){var e=c(g,d.press,function(l){("mousedown"!=l.type||a.isLeft(l))&&q(l)}),m=
c(g,"keydown",function(l){l.keyCode!==b.ENTER&&l.keyCode!==b.SPACE||q(l)});return{remove:function(){e.remove();m.remove()}}};k.release=function(g,q){var e=c(g,d.release,function(l){("mouseup"!=l.type||a.isLeft(l))&&q(l)}),m=c(g,"keyup",function(l){l.keyCode!==b.ENTER&&l.keyCode!==b.SPACE||q(l)});return{remove:function(){e.remove();m.remove()}}};k.move=d.move;return k})},"dijit/_FocusMixin":function(){define(["./focus","./_WidgetBase","dojo/_base/declare","dojo/_base/lang"],function(b,a,c,d){d.extend(a,
{focused:!1,onFocus:function(){},onBlur:function(){},_onFocus:function(){this.onFocus()},_onBlur:function(){this.onBlur()}});return c("dijit._FocusMixin",null,{_focusManager:b})})},"dijit/focus":function(){define("dojo/aspect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/Evented dojo/_base/lang dojo/on dojo/domReady dojo/sniff dojo/Stateful dojo/_base/window dojo/window ./a11y ./registry ./main".split(" "),function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h){var t,r,u=new (a([l,
k],{curNode:null,activeStack:[],constructor:function(){var z=g.hitch(this,function(A){c.isDescendant(this.curNode,A)&&this.set("curNode",null);c.isDescendant(this.prevNode,A)&&this.set("prevNode",null)});b.before(n,"empty",z);b.before(n,"destroy",z)},registerIframe:function(z){return this.registerWin(z.contentWindow,z)},registerWin:function(z,A){var C=this,E=z.document&&z.document.body;if(E){var B=q(z.document,"pointerdown",function(K){K&&K.target&&null==K.target.parentNode||C._onTouchNode(A||K.target,
"mouse")}),D=q(E,"focusin",function(K){if(K.target.tagName){var L=K.target.tagName.toLowerCase();"#document"!=L&&"body"!=L&&(x.isFocusable(K.target)?C._onFocusNode(A||K.target):C._onTouchNode(A||K.target))}}),F=q(E,"focusout",function(K){C._onBlurNode(A||K.target)});return{remove:function(){B.remove();D.remove();F.remove();E=B=D=F=null}}}},_onBlurNode:function(z){z=(new Date).getTime();z<t+100||(this._clearFocusTimer&&clearTimeout(this._clearFocusTimer),this._clearFocusTimer=setTimeout(g.hitch(this,
function(){this.set("prevNode",this.curNode);this.set("curNode",null)}),0),this._clearActiveWidgetsTimer&&clearTimeout(this._clearActiveWidgetsTimer),z<r+100||(this._clearActiveWidgetsTimer=setTimeout(g.hitch(this,function(){delete this._clearActiveWidgetsTimer;this._setStack([])}),0)))},_onTouchNode:function(z,A){r=(new Date).getTime();this._clearActiveWidgetsTimer&&(clearTimeout(this._clearActiveWidgetsTimer),delete this._clearActiveWidgetsTimer);f.contains(z,"dijitPopup")&&(z=z.firstChild);var C=
[];try{for(;z;){var E=d.get(z,"dijitPopupParent");if(E)z=p.byId(E).domNode;else if(z.tagName&&"body"==z.tagName.toLowerCase()){if(z===w.body())break;z=v.get(z.ownerDocument).frameElement}else{var B=z.getAttribute&&z.getAttribute("widgetId"),D=B&&p.byId(B);!D||"mouse"==A&&D.get("disabled")||C.unshift(B);z=z.parentNode}}}catch(F){}this._setStack(C,A)},_onFocusNode:function(z){z&&9!=z.nodeType&&(t=(new Date).getTime(),this._clearFocusTimer&&(clearTimeout(this._clearFocusTimer),delete this._clearFocusTimer),
this._onTouchNode(z),z!=this.curNode&&(this.set("prevNode",this.curNode),this.set("curNode",z)))},_setStack:function(z,A){var C=this.activeStack,E=C.length-1,B=z.length-1;if(z[B]!=C[E]){this.set("activeStack",z);var D;for(D=E;0<=D&&C[D]!=z[D];D--)if(E=p.byId(C[D]))E._hasBeenBlurred=!0,E.set("focused",!1),E._focusManager==this&&E._onBlur(A),this.emit("widget-blur",E,A);for(D++;D<=B;D++)if(E=p.byId(z[D]))E.set("focused",!0),E._focusManager==this&&E._onFocus(A),this.emit("widget-focus",E,A)}},focus:function(z){if(z)try{z.focus()}catch(A){}}}));
e(function(){var z=u.registerWin(v.get(document));m("ie")&&q(window,"unload",function(){z&&(z.remove(),z=null)})});h.focus=function(z){u.focus(z)};for(var y in u)/^_/.test(y)||(h.focus[y]="function"==typeof u[y]?g.hitch(u,y):u[y]);u.watch(function(z,A,C){h.focus[z]=C});return u})},"dijit/a11y":function(){define("dojo/_base/array dojo/dom dojo/dom-attr dojo/dom-style dojo/_base/lang dojo/sniff ./main".split(" "),function(b,a,c,d,f,n,k){var g={_isElementShown:function(q){var e=d.get(q);return"hidden"!=
e.visibility&&"collapsed"!=e.visibility&&"none"!=e.display&&"hidden"!=c.get(q,"type")},hasDefaultTabStop:function(q){switch(q.nodeName.toLowerCase()){case "a":return c.has(q,"href");case "area":case "button":case "input":case "object":case "select":case "textarea":return!0;case "iframe":try{var e=q.contentDocument;if("designMode"in e&&"on"==e.designMode)return!0;var m=e.body}catch(l){try{m=q.contentWindow.document.body}catch(w){return!1}}return m&&("true"==m.contentEditable||m.firstChild&&"true"==
m.firstChild.contentEditable);default:return"true"==q.contentEditable}},effectiveTabIndex:function(q){if(!c.get(q,"disabled"))return c.has(q,"tabIndex")?+c.get(q,"tabIndex"):g.hasDefaultTabStop(q)?0:void 0},isTabNavigable:function(q){return 0<=g.effectiveTabIndex(q)},isFocusable:function(q){return-1<=g.effectiveTabIndex(q)},_getTabNavigable:function(q){function e(z){return z&&"input"==z.tagName.toLowerCase()&&z.type&&"radio"==z.type.toLowerCase()&&z.name&&z.name.toLowerCase()}function m(z){return t[e(z)]||
z}var l,w,v,x,p,h,t={},r=g._isElementShown,u=g.effectiveTabIndex,y=function(z){for(z=z.firstChild;z;z=z.nextSibling)if(!(1!=z.nodeType||9>=n("ie")&&"HTML"!==z.scopeName)&&r(z)){var A=u(z);if(0<=A){if(0==A)l||(l=z),w=z;else if(0<A){if(!v||A<x)x=A,v=z;if(!p||A>=h)h=A,p=z}A=e(z);c.get(z,"checked")&&A&&(t[A]=z)}"SELECT"!=z.nodeName.toUpperCase()&&y(z)}};r(q)&&y(q);return{first:m(l),last:m(w),lowest:m(v),highest:m(p)}},getFirstInTabbingOrder:function(q,e){q=g._getTabNavigable(a.byId(q,e));return q.lowest?
q.lowest:q.first},getLastInTabbingOrder:function(q,e){q=g._getTabNavigable(a.byId(q,e));return q.last?q.last:q.highest}};f.mixin(k,g);return g})},"dojo/uacss":function(){define(["./dom-geometry","./_base/lang","./domReady","./sniff","./_base/window"],function(b,a,c,d,f){var n=f.doc.documentElement;f=d("ie");var k=d("opera"),g=Math.floor,q=b.boxModel.replace(/-/,"");k={dj_quirks:0,dj_opera:k,dj_khtml:0,dj_webkit:d("webkit"),dj_safari:d("safari"),dj_chrome:d("chrome"),dj_edge:1,dj_gecko:1,dj_ios:d("ios"),
dj_android:0};f&&(k.dj_ie=!0,k["dj_ie"+g(f)]=!0,k.dj_iequirks=0);k["dj_ff"+g(1)]=!0;k["dj_"+q]=!0;var e="",m;for(m in k)k[m]&&(e+=m+" ");n.className=a.trim(n.className+" "+e);c(function(){if(!b.isBodyLtr()){var l="dj_rtl dijitRtl "+e.replace(/ /g,"-rtl ");n.className=a.trim(n.className+" "+l+"dj_rtl dijitRtl "+e.replace(/ /g,"-rtl "))}});return d})},"dijit/hccss":function(){define(["dojo/dom-class","dojo/hccss","dojo/domReady","dojo/_base/window"],function(b,a,c,d){c(function(){a("highcontrast")&&
b.add(d.body(),"dijit_a11y")});return a})},"dojo/hccss":function(){define("require ./_base/config ./dom-class ./dom-style ./has ./domReady ./_base/window".split(" "),function(b,a,c,d,f,n,k){f.add("highcontrast",function(){var g=k.doc.createElement("div");try{g.style.cssText='border: 1px solid; border-color:red green; position: absolute; height: 5px; top: -999px;background-image: url("'+(a.blankGif||b.toUrl("./resources/blank.gif"))+'");';k.body().appendChild(g);var q=d.getComputedStyle(g),e=q.backgroundImage;
return q.borderTopColor==q.borderRightColor||e&&("none"==e||"url(invalid-url:)"==e)}catch(m){return console.warn("hccss: exception detecting high-contrast mode, document is likely hidden: "+m.toString()),!1}finally{8>=f("ie")?g.outerHTML="":k.body().removeChild(g)}});n(function(){f("highcontrast")&&c.add(k.body(),"dj_a11y")});return f})},"dijit/layout/_LayoutWidget":function(){define("dojo/_base/lang ../_Widget ../_Container ../_Contained ../Viewport dojo/_base/declare dojo/dom-class dojo/dom-geometry dojo/dom-style".split(" "),
function(b,a,c,d,f,n,k,g,q){return n("dijit.layout._LayoutWidget",[a,c,d],{baseClass:"dijitLayoutContainer",isLayoutContainer:!0,_setTitleAttr:null,buildRendering:function(){this.inherited(arguments);k.add(this.domNode,"dijitContainer")},startup:function(){if(!this._started){this.inherited(arguments);var e=this.getParent&&this.getParent();e&&e.isLayoutContainer||(this.resize(),this.own(f.on("resize",b.hitch(this,"resize"))))}},resize:function(e,m){var l=this.domNode;e&&g.setMarginBox(l,e);m=m||{};
b.mixin(m,e||{});"h"in m&&"w"in m||(m=b.mixin(g.getMarginBox(l),m));e=q.getComputedStyle(l);var w=g.getMarginExtents(l,e),v=g.getBorderExtents(l,e);m=this._borderBox={w:m.w-(w.w+v.w),h:m.h-(w.h+v.h)};w=g.getPadExtents(l,e);this._contentBox={l:q.toPixelValue(l,e.paddingLeft),t:q.toPixelValue(l,e.paddingTop),w:m.w-w.w,h:m.h-w.h};this.layout()},layout:function(){},_setupChild:function(e){k.add(e.domNode,this.baseClass+"-child "+(e.baseClass?this.baseClass+"-"+e.baseClass:""))},addChild:function(e,m){this.inherited(arguments);
this._started&&this._setupChild(e)},removeChild:function(e){k.remove(e.domNode,this.baseClass+"-child"+(e.baseClass?" "+this.baseClass+"-"+e.baseClass:""));this.inherited(arguments)}})})},"dijit/_Contained":function(){define(["dojo/_base/declare","./registry"],function(b,a){return b("dijit._Contained",null,{_getSibling:function(c){var d=this.getParent();return d&&d._getSiblingOfChild&&d._getSiblingOfChild(this,"previous"==c?-1:1)||null},getPreviousSibling:function(){return this._getSibling("previous")},
getNextSibling:function(){return this._getSibling("next")},getIndexInParent:function(){var c=this.getParent();return c&&c.getIndexOfChild?c.getIndexOfChild(this):-1}})})},"dijit/Viewport":function(){define(["dojo/Evented","dojo/on","dojo/domReady","dojo/sniff","dojo/window"],function(b,a,c,d,f){var n=new b,k;c(function(){var g=f.getBox();n._rlh=a(window,"resize",function(){var e=f.getBox();if(g.h!=e.h||g.w!=e.w)g=e,n.emit("resize")});if(8==d("ie")){var q=screen.deviceXDPI;setInterval(function(){screen.deviceXDPI!=
q&&(q=screen.deviceXDPI,n.emit("resize"))},500)}d("ios")&&(a(document,"focusin",function(e){k=e.target}),a(document,"focusout",function(e){k=null}))});n.getEffectiveBox=function(g){g=f.getBox(g);var q=k&&k.tagName&&k.tagName.toLowerCase();d("ios")&&k&&!k.readOnly&&("textarea"==q||"input"==q&&/^(color|email|number|password|search|tel|text|url)$/.test(k.type))&&(g.h*=0==orientation||180==orientation?.66:.4,q=k.getBoundingClientRect(),g.h=Math.max(g.h,q.top+q.height));return g};return n})},"dijit/Menu":function(){define("require dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/_base/window dojo/window ./popup ./DropDownMenu dojo/ready".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p){m("dijit-legacy-requires")&&p(0,function(){b(["dijit/MenuItem","dijit/PopupMenuItem","dijit/CheckedMenuItem","dijit/MenuSeparator"])});return c("dijit.Menu",x,{constructor:function(){this._bindings=[]},targetNodeIds:[],selector:"",contextMenuForWindow:!1,leftClickToOpen:!1,refocus:!0,postCreate:function(){this.contextMenuForWindow?this.bindDomNode(this.ownerDocumentBody):a.forEach(this.targetNodeIds,this.bindDomNode,this);this.inherited(arguments)},_iframeContentWindow:function(h){return w.get(this._iframeContentDocument(h))||
this._iframeContentDocument(h).__parent__||h.name&&document.frames[h.name]||null},_iframeContentDocument:function(h){return h.contentDocument||h.contentWindow&&h.contentWindow.document||h.name&&document.frames[h.name]&&document.frames[h.name].document||null},bindDomNode:function(h){h=d.byId(h,this.ownerDocument);if("iframe"==h.tagName.toLowerCase()){var t=h;var r=this._iframeContentWindow(t);r=l.body(r.document)}else r=h==l.body(this.ownerDocument)?this.ownerDocument.documentElement:h;var u={node:h,
iframe:t};f.set(h,"_dijitMenu"+this.id,this._bindings.push(u));var y=q.hitch(this,function(z){var A=this.selector,C=A?function(B){return e.selector(A,B)}:function(B){return B},E=this;return[e(z,C(this.leftClickToOpen?"click":"contextmenu"),function(B){B.stopPropagation();B.preventDefault();(new Date).getTime()<E._lastKeyDown+500||E._scheduleOpen(this,t,{x:B.pageX,y:B.pageY},B.target)}),e(z,C("keydown"),function(B){if(93==B.keyCode||B.shiftKey&&B.keyCode==g.F10||E.leftClickToOpen&&B.keyCode==g.SPACE)B.stopPropagation(),
B.preventDefault(),E._scheduleOpen(this,t,null,B.target),E._lastKeyDown=(new Date).getTime()})]});u.connects=r?y(r):[];t&&(u.onloadHandler=q.hitch(this,function(){var z=this._iframeContentWindow(t);z=l.body(z.document);u.connects=y(z)}),t.addEventListener?t.addEventListener("load",u.onloadHandler,!1):t.attachEvent("onload",u.onloadHandler))},unBindDomNode:function(h){try{var t=d.byId(h,this.ownerDocument)}catch(z){return}h="_dijitMenu"+this.id;if(t&&f.has(t,h)){for(var r=f.get(t,h)-1,u=this._bindings[r],
y;y=u.connects.pop();)y.remove();(y=u.iframe)&&(y.removeEventListener?y.removeEventListener("load",u.onloadHandler,!1):y.detachEvent("onload",u.onloadHandler));f.remove(t,h);delete this._bindings[r]}},_scheduleOpen:function(h,t,r,u){this._openTimer||(this._openTimer=this.defer(function(){delete this._openTimer;this._openMyself({target:u,delegatedTarget:h,iframe:t,coords:r})},1))},_openMyself:function(h){function t(){B.refocus&&D&&D.focus();v.close(B)}var r=h.target,u=h.iframe,y=h.coords,z=!y;this.currentTarget=
h.delegatedTarget;if(y){if(u){h=n.position(u,!0);r=this._iframeContentWindow(u);r=n.docScroll(r.document);var A=k.getComputedStyle(u),C=k.toPixelValue,E=(m("ie"),C(u,A.paddingLeft))+(m("ie"),0);u=(m("ie"),C(u,A.paddingTop))+(m("ie"),0);y.x+=h.x+E-r.x;y.y+=h.y+u-r.y}}else y=n.position(r,!0),y.x+=10,y.y+=10;var B=this;u=this._focusManager.get("prevNode");h=this._focusManager.get("curNode");var D=!h||d.isDescendant(h,this.domNode)?u:h;v.open({popup:this,x:y.x,y:y.y,onExecute:t,onCancel:t,orient:this.isLeftToRight()?
"L":"R"});this.focus();z||this.defer(function(){this._cleanUp(!0)});this._onBlur=function(){this.inherited("_onBlur",arguments);v.close(this)}},destroy:function(){a.forEach(this._bindings,function(h){h&&this.unBindDomNode(h.node)},this);this.inherited(arguments)}})})},"dijit/popup":function(){define("dojo/_base/array dojo/aspect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/keys dojo/_base/lang dojo/on ./place ./BackgroundIframe ./Viewport ./main dojo/touch".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p){function h(){this._popupWrapper&&(n.destroy(this._popupWrapper),delete this._popupWrapper)}c=c(null,{_stack:[],_beginZIndex:1E3,_idGen:1,_repositionAll:function(){if(this._firstAroundNode){var t=this._firstAroundPosition,r=k.position(this._firstAroundNode,!0),u=r.x-t.x;t=r.y-t.y;if(u||t)for(this._firstAroundPosition=r,r=0;r<this._stack.length;r++){var y=this._stack[r].wrapper.style;y.top=parseFloat(y.top)+t+"px";"auto"==y.right?y.left=parseFloat(y.left)+u+
"px":y.right=parseFloat(y.right)-u+"px"}this._aroundMoveListener=setTimeout(m.hitch(this,"_repositionAll"),u||t?10:50)}},_createWrapper:function(t){var r=t._popupWrapper,u=t.domNode;r||(r=n.create("div",{"class":"dijitPopup",style:{display:"none"},role:"region","aria-label":t["aria-label"]||t.label||t.name||t.id},t.ownerDocumentBody),r.appendChild(u),u=u.style,u.display="",u.visibility="",u.position="",u.top="0px",t._popupWrapper=r,a.after(t,"destroy",h,!0),"ontouchend"in document&&l(r,"touchend",
function(y){/^(input|button|textarea)$/i.test(y.target.tagName)||y.preventDefault()}),r.dojoClick=!0);return r},moveOffScreen:function(t){var r=this._createWrapper(t);t=k.isBodyLtr(t.ownerDocument);var u={visibility:"hidden",top:"-9999px",display:""};u[t?"left":"right"]="-9999px";u[t?"right":"left"]="auto";g.set(r,u);return r},hide:function(t){var r=this._createWrapper(t);g.set(r,{display:"none",height:"auto",overflowY:"visible",border:""});t=t.domNode;"_originalStyle"in t&&(t.style.cssText=t._originalStyle)},
getTopPopup:function(){for(var t=this._stack,r=t.length-1;0<r&&t[r].parent===t[r-1].widget;r--);return t[r]},open:function(t){for(var r=this._stack,u=t.popup,y=u.domNode,z=t.orient||["below","below-alt","above","above-alt"],A=t.parent?t.parent.isLeftToRight():k.isBodyLtr(u.ownerDocument),C=t.around,E=t.around&&t.around.id?t.around.id+"_dropdown":"popup_"+this._idGen++;r.length&&(!t.parent||!d.isDescendant(t.parent.domNode,r[r.length-1].widget.domNode));)this.close(r[r.length-1].widget);var B=this.moveOffScreen(u);
u.startup&&!u._started&&u.startup();var D=k.position(y);if("maxHeight"in t&&-1!=t.maxHeight)var F=t.maxHeight||Infinity;else{F=x.getEffectiveBox(this.ownerDocument);var K=C?k.position(C,!1):{y:t.y-(t.padding||0),h:2*(t.padding||0)};F=Math.floor(Math.max(K.y,F.h-(K.y+K.h)))}D.h>F&&(D=g.getComputedStyle(y),g.set(B,{overflowY:"scroll",height:F+"px",border:D.borderLeftWidth+" "+D.borderLeftStyle+" "+D.borderLeftColor}),y._originalStyle=y.style.cssText,y.style.border="none");f.set(B,{id:E,style:{zIndex:this._beginZIndex+
r.length},"class":"dijitPopup "+(u.baseClass||u["class"]||"").split(" ")[0]+"Popup",dijitPopupParent:t.parent?t.parent.id:""});0==r.length&&C&&(this._firstAroundNode=C,this._firstAroundPosition=k.position(C,!0),this._aroundMoveListener=setTimeout(m.hitch(this,"_repositionAll"),50));q("config-bgIframe")&&!u.bgIframe&&(u.bgIframe=new v(B));E=u.orient?m.hitch(u,"orient"):null;z=C?w.around(B,C,z,A,E):w.at(B,t,"R"==z?["TR","BR","TL","BL"]:["TL","BL","TR","BR"],t.padding,E);B.style.visibility="visible";
y.style.visibility="visible";y=[];y.push(l(B,"keydown",m.hitch(this,function(L){if(L.keyCode==e.ESCAPE&&t.onCancel)L.stopPropagation(),L.preventDefault(),t.onCancel();else if(L.keyCode==e.TAB&&(L.stopPropagation(),L.preventDefault(),(L=this.getTopPopup())&&L.onCancel))L.onCancel()})));u.onCancel&&t.onCancel&&y.push(u.on("cancel",t.onCancel));y.push(u.on(u.onExecute?"execute":"change",m.hitch(this,function(){var L=this.getTopPopup();if(L&&L.onExecute)L.onExecute()})));r.push({widget:u,wrapper:B,parent:t.parent,
onExecute:t.onExecute,onCancel:t.onCancel,onClose:t.onClose,handlers:y});if(u.onOpen)u.onOpen(z);return z},close:function(t){for(var r=this._stack;t&&b.some(r,function(C){return C.widget==t})||!t&&r.length;){var u=r.pop(),y=u.widget,z=u.onClose;y.bgIframe&&(y.bgIframe.destroy(),delete y.bgIframe);if(y.onClose)y.onClose();for(var A;A=u.handlers.pop();)A.remove();y&&y.domNode&&this.hide(y);z&&z()}0==r.length&&this._aroundMoveListener&&(clearTimeout(this._aroundMoveListener),this._firstAroundNode=this._firstAroundPosition=
this._aroundMoveListener=null)}});return p.popup=new c})},"dijit/place":function(){define("dojo/_base/array dojo/dom-geometry dojo/dom-style dojo/_base/kernel dojo/_base/window ./Viewport ./main".split(" "),function(b,a,c,d,f,n,k){function g(e,m,l,w){var v=n.getEffectiveBox(e.ownerDocument);e.parentNode&&"body"==String(e.parentNode.tagName).toLowerCase()||f.body(e.ownerDocument).appendChild(e);var x=null;b.some(m,function(t){var r=t.corner,u=t.pos,y=0,z={w:{L:v.l+v.w-u.x,R:u.x-v.l,M:v.w}[r.charAt(1)],
h:{T:v.t+v.h-u.y,B:u.y-v.t,M:v.h}[r.charAt(0)]},A=e.style;A.left=A.right="auto";l&&(y=l(e,t.aroundCorner,r,z,w),y="undefined"==typeof y?0:y);var C=e.style,E=C.display,B=C.visibility;"none"==C.display&&(C.visibility="hidden",C.display="");A=a.position(e);C.display=E;C.visibility=B;E={L:u.x,R:u.x-A.w,M:Math.max(v.l,Math.min(v.l+v.w,u.x+(A.w>>1))-A.w)}[r.charAt(1)];B={T:u.y,B:u.y-A.h,M:Math.max(v.t,Math.min(v.t+v.h,u.y+(A.h>>1))-A.h)}[r.charAt(0)];u=Math.max(v.l,E);C=Math.max(v.t,B);E=Math.min(v.l+v.w,
E+A.w)-u;B=Math.min(v.t+v.h,B+A.h)-C;y+=A.w-E+(A.h-B);if(null==x||y<x.overflow)x={corner:r,aroundCorner:t.aroundCorner,x:u,y:C,w:E,h:B,overflow:y,spaceAvailable:z};return!y});x.overflow&&l&&l(e,x.aroundCorner,x.corner,x.spaceAvailable,w);m=x.y;var p=x.x,h=f.body(e.ownerDocument);/relative|absolute/.test(c.get(h,"position"))&&(m-=c.get(h,"marginTop"),p-=c.get(h,"marginLeft"));h=e.style;h.top=m+"px";h.left=p+"px";h.right="auto";return x}var q={TL:"BR",TR:"BL",BL:"TR",BR:"TL"};return k.place={at:function(e,
m,l,w,v){l=b.map(l,function(x){var p={corner:x,aroundCorner:q[x],pos:{x:m.x,y:m.y}};w&&(p.pos.x+="L"==x.charAt(1)?w.x:-w.x,p.pos.y+="T"==x.charAt(0)?w.y:-w.y);return p});return g(e,l,v)},around:function(e,m,l,w,v){function x(D,F){B.push({aroundCorner:D,corner:F,pos:{x:{L:z,R:z+C,M:z+(C>>1)}[D.charAt(1)],y:{T:A,B:A+E,M:A+(E>>1)}[D.charAt(0)]}})}if("string"==typeof m||"offsetWidth"in m||"ownerSVGElement"in m){var p=a.position(m,!0);if(/^(above|below)/.test(l[0])){var h=a.getBorderExtents(m),t=m.firstChild?
a.getBorderExtents(m.firstChild):{t:0,l:0,b:0,r:0},r=a.getBorderExtents(e),u=e.firstChild?a.getBorderExtents(e.firstChild):{t:0,l:0,b:0,r:0};p.y+=Math.min(h.t+t.t,r.t+u.t);p.h-=Math.min(h.t+t.t,r.t+u.t)+Math.min(h.b+t.b,r.b+u.b)}}else p=m;if(m.parentNode)for(h="absolute"==c.getComputedStyle(m).position,m=m.parentNode;m&&1==m.nodeType&&"BODY"!=m.nodeName;){t=a.position(m,!0);r=c.getComputedStyle(m);/relative|absolute/.test(r.position)&&(h=!1);if(!h&&/hidden|auto|scroll/.test(r.overflow)){u=Math.min(p.y+
p.h,t.y+t.h);var y=Math.min(p.x+p.w,t.x+t.w);p.x=Math.max(p.x,t.x);p.y=Math.max(p.y,t.y);p.h=u-p.y;p.w=y-p.x}"absolute"==r.position&&(h=!0);m=m.parentNode}var z=p.x,A=p.y,C="w"in p?p.w:p.w=p.width,E="h"in p?p.h:(d.deprecated("place.around: dijit/place.__Rectangle: { x:"+z+", y:"+A+", height:"+p.height+", width:"+C+" } has been deprecated.  Please use { x:"+z+", y:"+A+", h:"+p.height+", w:"+C+" }","","2.0"),p.h=p.height),B=[];b.forEach(l,function(D){var F=w;switch(D){case "above-centered":x("TM","BM");
break;case "below-centered":x("BM","TM");break;case "after-centered":F=!F;case "before-centered":x(F?"ML":"MR",F?"MR":"ML");break;case "after":F=!F;case "before":x(F?"TL":"TR",F?"TR":"TL");x(F?"BL":"BR",F?"BR":"BL");break;case "below-alt":F=!F;case "below":x(F?"BL":"BR",F?"TL":"TR");x(F?"BR":"BL",F?"TR":"TL");break;case "above-alt":F=!F;case "above":x(F?"TL":"TR",F?"BL":"BR");x(F?"TR":"TL",F?"BR":"BL");break;default:x(D.aroundCorner,D.corner)}});e=g(e,B,v,{w:C,h:E});e.aroundNodePos=p;return e}}})},
"dijit/BackgroundIframe":function(){define("require ./main dojo/_base/config dojo/dom-construct dojo/dom-style dojo/_base/lang dojo/on dojo/sniff".split(" "),function(b,a,c,d,f,n,k,g){g.add("config-bgIframe",(g("ie")||0)&&!/IEMobile\/10\.0/.test(navigator.userAgent));var q=new function(){var e=[];this.pop=function(){if(e.length){var m=e.pop();m.style.display=""}else 9>g("ie")?(m=c.dojoBlankHtmlUrl||b.toUrl("dojo/resources/blank.html")||'javascript:""',m=document.createElement("\x3ciframe src\x3d'"+
m+"' role\x3d'presentation' style\x3d'position: absolute; left: 0px; top: 0px;z-index: -1; filter:Alpha(Opacity\x3d\"0\");'\x3e")):(m=d.create("iframe"),m.src='javascript:""',m.className="dijitBackgroundIframe",m.setAttribute("role","presentation"),f.set(m,"opacity",.1)),m.tabIndex=-1;return m};this.push=function(m){m.style.display="none";e.push(m)}};a.BackgroundIframe=function(e){if(!e.id)throw Error("no id");if(g("config-bgIframe")){var m=this.iframe=q.pop();e.appendChild(m);7>g("ie")?(this.resize(e),
this._conn=k(e,"resize",n.hitch(this,"resize",e))):f.set(m,{width:"100%",height:"100%"})}};n.extend(a.BackgroundIframe,{resize:function(e){this.iframe&&f.set(this.iframe,{width:e.offsetWidth+"px",height:e.offsetHeight+"px"})},destroy:function(){this._conn&&(this._conn.remove(),this._conn=null);this.iframe&&(this.iframe.parentNode.removeChild(this.iframe),q.push(this.iframe),delete this.iframe)}});return a.BackgroundIframe})},"dijit/DropDownMenu":function(){define(["dojo/_base/declare","dojo/keys",
"dojo/text!./templates/Menu.html","./_MenuBase"],function(b,a,c,d){return b("dijit.DropDownMenu",d,{templateString:c,baseClass:"dijitMenu",_onUpArrow:function(){this.focusPrev()},_onDownArrow:function(){this.focusNext()},_onRightArrow:function(f){this._moveToPopup(f);f.stopPropagation();f.preventDefault()},_onLeftArrow:function(f){if(this.parentMenu)if(this.parentMenu._isMenuBar)this.parentMenu.focusPrev();else this.onCancel(!1);else f.stopPropagation(),f.preventDefault()}})})},"dijit/_MenuBase":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/lang dojo/mouse dojo/on dojo/window ./a11yclick ./registry ./_Widget ./_CssStateMixin ./_KeyNavContainer ./_TemplatedMixin".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x){return a("dijit._MenuBase",[l,x,v,w],{selected:null,_setSelectedAttr:function(p){this.selected!=p&&(this.selected&&(this.selected._setSelected(!1),this._onChildDeselect(this.selected)),p&&p._setSelected(!0),this._set("selected",p))},activated:!1,_setActivatedAttr:function(p){f.toggle(this.domNode,"dijitMenuActive",p);f.toggle(this.domNode,"dijitMenuPassive",!p);this._set("activated",p)},parentMenu:null,popupDelay:500,passivePopupDelay:Infinity,autoFocus:!1,
childSelector:function(p){var h=m.byNode(p);return p.parentNode==this.containerNode&&h&&h.focus},postCreate:function(){var p=this,h="string"==typeof this.childSelector?this.childSelector:n.hitch(this,"childSelector");this.own(g(this.containerNode,g.selector(h,k.enter),function(){p.onItemHover(m.byNode(this))}),g(this.containerNode,g.selector(h,k.leave),function(){p.onItemUnhover(m.byNode(this))}),g(this.containerNode,g.selector(h,e),function(t){p.onItemClick(m.byNode(this),t);t.stopPropagation()}),
g(this.containerNode,g.selector(h,"focusin"),function(){p._onItemFocus(m.byNode(this))}));this.inherited(arguments)},onKeyboardSearch:function(p,h,t,r){this.inherited(arguments);if(p&&(-1==r||p.popup&&1==r))this.onItemClick(p,h)},_keyboardSearchCompare:function(p,h){return p.shortcutKey?h==p.shortcutKey.toLowerCase()?-1:0:this.inherited(arguments)?1:0},onExecute:function(){},onCancel:function(){},_moveToPopup:function(p){if(this.focusedChild&&this.focusedChild.popup&&!this.focusedChild.disabled)this.onItemClick(this.focusedChild,
p);else(p=this._getTopMenu())&&p._isMenuBar&&p.focusNext()},_onPopupHover:function(){this.set("selected",this.currentPopupItem);this._stopPendingCloseTimer()},onItemHover:function(p){this.activated?(this.set("selected",p),!p.popup||p.disabled||this.hover_timer||(this.hover_timer=this.defer(function(){this._openItemPopup(p)},this.popupDelay))):Infinity>this.passivePopupDelay&&(this.passive_hover_timer&&this.passive_hover_timer.remove(),this.passive_hover_timer=this.defer(function(){this.onItemClick(p,
{type:"click"})},this.passivePopupDelay));this._hoveredChild=p;p._set("hovering",!0)},_onChildDeselect:function(p){this._stopPopupTimer();this.currentPopupItem==p&&(this._stopPendingCloseTimer(),this._pendingClose_timer=this.defer(function(){this.currentPopupItem=this._pendingClose_timer=null;p._closePopup()},this.popupDelay))},onItemUnhover:function(p){this._hoveredChild==p&&(this._hoveredChild=null);this.passive_hover_timer&&(this.passive_hover_timer.remove(),this.passive_hover_timer=null);p._set("hovering",
!1)},_stopPopupTimer:function(){this.hover_timer&&(this.hover_timer=this.hover_timer.remove())},_stopPendingCloseTimer:function(){this._pendingClose_timer&&(this._pendingClose_timer=this._pendingClose_timer.remove())},_getTopMenu:function(){for(var p=this;p.parentMenu;p=p.parentMenu);return p},onItemClick:function(p,h){this.passive_hover_timer&&this.passive_hover_timer.remove();this.focusChild(p);if(p.disabled)return!1;p.popup?(this.set("selected",p),this.set("activated",!0),h=/^key/.test(h._origType||
h.type)||0==h.clientX&&0==h.clientY,this._openItemPopup(p,h)):(this.onExecute(),p._onClick?p._onClick(h):p.onClick(h))},_openItemPopup:function(p,h){if(p!=this.currentPopupItem){this.currentPopupItem&&(this._stopPendingCloseTimer(),this.currentPopupItem._closePopup());this._stopPopupTimer();var t=p.popup;t.parentMenu=this;this.own(this._mouseoverHandle=g.once(t.domNode,"mouseover",n.hitch(this,"_onPopupHover")));var r=this;p._openPopup({parent:this,orient:this._orient||["after","before"],onCancel:function(){h&&
r.focusChild(p);r._cleanUp()},onExecute:n.hitch(this,"_cleanUp",!0),onClose:function(){r._mouseoverHandle&&(r._mouseoverHandle.remove(),delete r._mouseoverHandle)}},h);this.currentPopupItem=p}},onOpen:function(){this.isShowingNow=!0;this.set("activated",!0)},onClose:function(){this.set("activated",!1);this.set("selected",null);this.isShowingNow=!1;this.parentMenu=null},_closeChild:function(){this._stopPopupTimer();this.currentPopupItem&&(this.focused&&(d.set(this.selected.focusNode,"tabIndex",this.tabIndex),
this.selected.focusNode.focus()),this.currentPopupItem._closePopup(),this.currentPopupItem=null)},_onItemFocus:function(p){if(this._hoveredChild&&this._hoveredChild!=p)this.onItemUnhover(this._hoveredChild);this.set("selected",p)},_onBlur:function(){this._cleanUp(!0);this.inherited(arguments)},_cleanUp:function(p){this._closeChild();"undefined"==typeof this.isShowingNow&&this.set("activated",!1);p&&this.set("selected",null)}})})},"dijit/_CssStateMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-class dojo/has dojo/_base/lang dojo/on dojo/domReady dojo/touch dojo/_base/window ./a11yclick ./registry".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l){a=a("dijit._CssStateMixin",[],{hovering:!1,active:!1,_applyAttributes:function(){this.inherited(arguments);b.forEach("disabled readOnly checked selected focused state hovering active _opened".split(" "),function(v){this.watch(v,n.hitch(this,"_setStateClass"))},this);for(var w in this.cssStateNodes||{})this._trackMouseState(this[w],this.cssStateNodes[w]);this._trackMouseState(this.domNode,this.baseClass);this._setStateClass()},_cssMouseEvent:function(w){if(!this.disabled)switch(w.type){case "mouseover":case "MSPointerOver":case "pointerover":this._set("hovering",
!0);this._set("active",this._mouseDown);break;case "mouseout":case "MSPointerOut":case "pointerout":this._set("hovering",!1);this._set("active",!1);break;case "mousedown":case "touchstart":case "MSPointerDown":case "pointerdown":case "keydown":this._set("active",!0);break;case "mouseup":case "dojotouchend":case "MSPointerUp":case "pointerup":case "keyup":this._set("active",!1)}},_setStateClass:function(){function w(r){v=v.concat(b.map(v,function(u){return u+r}),"dijit"+r)}var v=this.baseClass.split(" ");
this.isLeftToRight()||w("Rtl");var x="mixed"==this.checked?"Mixed":this.checked?"Checked":"";this.checked&&w(x);this.state&&w(this.state);this.selected&&w("Selected");this._opened&&w("Opened");this.disabled?w("Disabled"):this.readOnly?w("ReadOnly"):this.active?w("Active"):this.hovering&&w("Hover");this.focused&&w("Focused");x=this.stateNode||this.domNode;var p={};b.forEach(x.className.split(" "),function(r){p[r]=!0});"_stateClasses"in this&&b.forEach(this._stateClasses,function(r){delete p[r]});b.forEach(v,
function(r){p[r]=!0});var h=[],t;for(t in p)h.push(t);x.className=h.join(" ");this._stateClasses=v},_subnodeCssMouseEvent:function(w,v,x){function p(h){d.toggle(w,v+"Active",h)}if(!this.disabled&&!this.readOnly)switch(x.type){case "mouseover":case "MSPointerOver":case "pointerover":d.toggle(w,v+"Hover",!0);break;case "mouseout":case "MSPointerOut":case "pointerout":d.toggle(w,v+"Hover",!1);p(!1);break;case "mousedown":case "touchstart":case "MSPointerDown":case "pointerdown":case "keydown":p(!0);
break;case "mouseup":case "MSPointerUp":case "pointerup":case "dojotouchend":case "keyup":p(!1);break;case "focus":case "focusin":d.toggle(w,v+"Focused",!0);break;case "blur":case "focusout":d.toggle(w,v+"Focused",!1)}},_trackMouseState:function(w,v){w._cssState=v}});g(function(){function w(p,h,t){if(!t||!c.isDescendant(t,h))for(;h&&h!=t;h=h.parentNode)if(h._cssState){var r=l.getEnclosingWidget(h);r&&(h==r.domNode?r._cssMouseEvent(p):r._subnodeCssMouseEvent(h,h._cssState,p))}}var v=e.body(),x;k(v,
q.over,function(p){w(p,p.target,p.relatedTarget)});k(v,q.out,function(p){w(p,p.target,p.relatedTarget)});k(v,m.press,function(p){x=p.target;w(p,x)});k(v,m.release,function(p){w(p,x);x=null});k(v,"focusin, focusout",function(p){var h=p.target;if(h._cssState&&!h.getAttribute("widgetId")){var t=l.getEnclosingWidget(h);t&&t._subnodeCssMouseEvent(h,h._cssState,p)}})});return a})},"dijit/_KeyNavContainer":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/_base/kernel dojo/keys dojo/_base/lang ./registry ./_Container ./_FocusMixin ./_KeyNavMixin".split(" "),
function(b,a,c,d,f,n,k,g,q,e){return a("dijit._KeyNavContainer",[q,e,g],{connectKeyNavHandlers:function(m,l){var w=this._keyNavCodes={},v=n.hitch(this,"focusPrev"),x=n.hitch(this,"focusNext");b.forEach(m,function(p){w[p]=v});b.forEach(l,function(p){w[p]=x});w[f.HOME]=n.hitch(this,"focusFirstChild");w[f.END]=n.hitch(this,"focusLastChild")},startupKeyNavChildren:function(){d.deprecated("startupKeyNavChildren() call no longer needed","","2.0")},startup:function(){this.inherited(arguments);b.forEach(this.getChildren(),
n.hitch(this,"_startupChild"))},addChild:function(m,l){this.inherited(arguments);this._startupChild(m)},_startupChild:function(m){m.set("tabIndex","-1")},_getFirst:function(){var m=this.getChildren();return m.length?m[0]:null},_getLast:function(){var m=this.getChildren();return m.length?m[m.length-1]:null},focusNext:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,1))},focusPrev:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,-1),!0)},childSelector:function(m){return(m=
k.byNode(m))&&m.getParent()==this}})})},"dijit/_KeyNavMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dijit/registry dijit/_FocusMixin".split(" "),function(b,a,c,d,f,n,k,g){return a("dijit._KeyNavMixin",g,{tabIndex:"0",childSelector:null,postCreate:function(){this.inherited(arguments);c.set(this.domNode,"tabIndex",this.tabIndex);if(!this._keyNavCodes){var q=this._keyNavCodes={};q[d.HOME]=f.hitch(this,"focusFirstChild");q[d.END]=f.hitch(this,
"focusLastChild");q[this.isLeftToRight()?d.LEFT_ARROW:d.RIGHT_ARROW]=f.hitch(this,"_onLeftArrow");q[this.isLeftToRight()?d.RIGHT_ARROW:d.LEFT_ARROW]=f.hitch(this,"_onRightArrow");q[d.UP_ARROW]=f.hitch(this,"_onUpArrow");q[d.DOWN_ARROW]=f.hitch(this,"_onDownArrow")}var e=this;q="string"==typeof this.childSelector?this.childSelector:f.hitch(this,"childSelector");this.own(n(this.domNode,"keypress",f.hitch(this,"_onContainerKeypress")),n(this.domNode,"keydown",f.hitch(this,"_onContainerKeydown")),n(this.domNode,
"focus",f.hitch(this,"_onContainerFocus")),n(this.containerNode,n.selector(q,"focusin"),function(m){e._onChildFocus(k.getEnclosingWidget(this),m)}))},_onLeftArrow:function(){},_onRightArrow:function(){},_onUpArrow:function(){},_onDownArrow:function(){},focus:function(){this.focusFirstChild()},_getFirstFocusableChild:function(){return this._getNextFocusableChild(null,1)},_getLastFocusableChild:function(){return this._getNextFocusableChild(null,-1)},focusFirstChild:function(){this.focusChild(this._getFirstFocusableChild())},
focusLastChild:function(){this.focusChild(this._getLastFocusableChild())},focusChild:function(q,e){q&&(this.focusedChild&&q!==this.focusedChild&&this._onChildBlur(this.focusedChild),q.set("tabIndex",this.tabIndex),q.focus(e?"end":"start"))},_onContainerFocus:function(q){q.target!==this.domNode||this.focusedChild||this.focus()},_onFocus:function(){c.set(this.domNode,"tabIndex","-1");this.inherited(arguments)},_onBlur:function(q){c.set(this.domNode,"tabIndex",this.tabIndex);this.focusedChild&&(this.focusedChild.set("tabIndex",
"-1"),this.lastFocusedChild=this.focusedChild,this._set("focusedChild",null));this.inherited(arguments)},_onChildFocus:function(q){q&&q!=this.focusedChild&&(this.focusedChild&&!this.focusedChild._destroyed&&this.focusedChild.set("tabIndex","-1"),q.set("tabIndex",this.tabIndex),this.lastFocused=q,this._set("focusedChild",q))},_searchString:"",multiCharSearchDuration:1E3,onKeyboardSearch:function(q,e,m,l){q&&this.focusChild(q)},_keyboardSearchCompare:function(q,e){var m=q.domNode;q=(q.label||(m.focusNode?
m.focusNode.label:"")||m.innerText||m.textContent||"").replace(/^\s+/,"").substr(0,e.length).toLowerCase();return e.length&&q==e?-1:0},_isFormElement:function(q){return"INPUT"===q.tagName||"TEXTAREA"===q.tagName||"SELECT"===q.tagName||"BUTTON"===q.tagName},_onContainerKeydown:function(q){if(!this._isFormElement(document.activeElement)){var e=this._keyNavCodes[q.keyCode];e?(e(q,this.focusedChild),q.stopPropagation(),q.preventDefault(),this._searchString=""):q.keyCode!=d.SPACE||!this._searchTimer||
q.ctrlKey||q.altKey||q.metaKey||(q.stopImmediatePropagation(),q.preventDefault(),this._keyboardSearch(q," "))}},_onContainerKeypress:function(q){this._isFormElement(document.activeElement)||q.charCode<=d.SPACE||q.ctrlKey||q.altKey||q.metaKey||(q.preventDefault(),q.stopPropagation(),this._keyboardSearch(q,String.fromCharCode(q.charCode).toLowerCase()))},_keyboardSearch:function(q,e){var m=null,l,w=0;f.hitch(this,function(){this._searchTimer&&this._searchTimer.remove();this._searchString+=e;var v=/^(.)\1*$/.test(this._searchString)?
1:this._searchString.length;l=this._searchString.substr(0,v);this._searchTimer=this.defer(function(){this._searchTimer=null;this._searchString=""},this.multiCharSearchDuration);var x=this.focusedChild||null;if(1==v||!x)if(x=this._getNextFocusableChild(x,1),!x)return;v=x;do{var p=this._keyboardSearchCompare(x,l);p&&0==w++&&(m=x);if(-1==p){w=-1;break}x=this._getNextFocusableChild(x,1)}while(x&&x!=v)})();this.onKeyboardSearch(m,q,l,w)},_onChildBlur:function(){},_getNextFocusableChild:function(q,e){var m=
q;do{if(q)q=this._getNext(q,e);else if(q=this[0<e?"_getFirst":"_getLast"](),!q)break;if(null!=q&&q!=m&&q.isFocusable())return q}while(q!=m);return null},_getFirst:function(){return null},_getLast:function(){return null},_getNext:function(q,e){if(q)for(q=q.domNode;q;)if((q=q[0>e?"previousSibling":"nextSibling"])&&"getAttribute"in q){var m=k.byNode(q);if(m)return m}return null}})})},"dgrid/main":function(){define([],1)},"dgrid/OnDemandGrid":function(){define(["dojo/_base/declare","./Grid","./OnDemandList"],
function(b,a,c){return b("dgrid.OnDemandGrid",[a,c],{})})},"dgrid/Grid":function(){define("dojo/_base/kernel dojo/_base/declare dojo/on dojo/has put-selector/put ./List ./util/misc dojo/_base/sniff".split(" "),function(b,a,c,d,f,n,k){function g(m,l){l&&l.nodeType&&m.appendChild(l)}function q(m,l,w,v){if(this.formatter){v=this.formatter;var x=this.grid.formatterScope;w.innerHTML="string"===typeof v&&x?x[v](l,m):this.formatter(l,m)}else null!=l&&w.appendChild(document.createTextNode(l))}var e=8>d("ie")&&
!0;a=a("dgrid.Grid",n,{columns:null,cellNavigation:!0,tabableHeader:!0,showHeader:!0,column:function(m){return"object"!=typeof m?this.columns[m]:this.cell(m).column},listType:"grid",cell:function(m,l){if(m.column&&m.element)return m;m.target&&m.target.nodeType&&(m=m.target);if(m.nodeType){do{if(this._rowIdToObject[m.id])break;var w=m.columnId;if(w){l=w;var v=m;break}m=m.parentNode}while(m&&m!=this.domNode)}if(!v&&"undefined"!=typeof l){var x=this.row(m);if(w=x&&x.element){w=w.getElementsByTagName("td");
for(var p=0;p<w.length;p++)if(w[p].columnId==l){v=w[p];break}}}if(null!=m)return{row:x||this.row(m),column:l&&this.column(l),element:v}},createRowCells:function(m,l,w,v){var x=f("table.dgrid-row-table[role\x3dpresentation]"),p=9>d("ie")?f(x,"tbody"):x,h,t,r;w=w||this.subRows;var u=0;for(h=w.length;u<h;u++){var y=w[u];var z=f(p,"tr");y.className&&f(z,"."+y.className);var A=0;for(t=y.length;A<t;A++){var C=y[A];var E=C.id;var B=C.field?".field-"+k.escapeCssIdentifier(C.field,"-"):"";(r="function"===
typeof C.className?C.className(v):C.className)&&(B+="."+r);B=f(m+(".dgrid-cell.dgrid-cell-padding"+(E?".dgrid-column-"+k.escapeCssIdentifier(E,"-"):"")+B.replace(/ +/g,"."))+"[role\x3d"+("th"===m?"columnheader":"gridcell")+"]");B.columnId=E;e?(E=f(B,"!dgrid-cell-padding div.dgrid-cell-padding"),B.contents=E):E=B;if(r=C.colSpan)B.colSpan=r;if(r=C.rowSpan)B.rowSpan=r;l(E,C);z.appendChild(B)}}return x},left:function(m,l){m.element||(m=this.cell(m));return this.cell(this._move(m,-(l||1),"dgrid-cell"))},
right:function(m,l){m.element||(m=this.cell(m));return this.cell(this._move(m,l||1,"dgrid-cell"))},renderRow:function(m,l){var w=this.createRowCells("td",function(v,x){var p=m;x.get?p=x.get(m):"field"in x&&"_item"!=x.field&&(p=p[x.field]);x.renderCell?g(v,x.renderCell(m,p,v,l)):q.call(x,m,p,v,l)},l&&l.subRows,m);return f("div[role\x3drow]\x3e",w)},renderHeader:function(){var m=this,l=this.headerNode,w=l.childNodes.length;for(l.setAttribute("role","row");w--;)f(l.childNodes[w],"!");w=this.createRowCells("th",
function(v,x){var p=x.headerNode=v;e&&(v=v.parentNode);var h=x.field;h&&(v.field=h);x.renderHeaderCell?g(p,x.renderHeaderCell(p)):("label"in x||x.field)&&p.appendChild(document.createTextNode("label"in x?x.label:x.field));!1!==x.sortable&&h&&"_item"!=h&&(v.sortable=!0,v.className+=" dgrid-sortable")},this.subRows&&this.subRows.headerRows);this._rowIdToObject[w.id=this.id+"-header"]=this.columns;l.appendChild(w);this._sortListener&&this._sortListener.remove();this._sortListener=c(w,"click,keydown",
function(v){if("click"==v.type||32==v.keyCode||!d("opera")&&13==v.keyCode){var x=v.target,p,h;do if(x.sortable){var t=[{attribute:p=x.field||x.columnId,descending:(h=m._sort[0])&&h.attribute==p&&!h.descending}];p={bubbles:!0,cancelable:!0,grid:m,parentType:v.type,sort:t};c.emit(v.target,"dgrid-sort",p)&&(m._sortNode=x,m.set("sort",t));break}while((x=x.parentNode)&&x!=l)}})},resize:function(){var m=this.headerNode.firstChild,l=this.contentNode,w;this.inherited(arguments);if(!d("ie")||7<d("ie"))l.style.width=
"",l&&m&&(w=m.offsetWidth)!=l.offsetWidth&&(l.style.width=w+"px")},destroy:function(){this._destroyColumns();this._sortListener&&this._sortListener.remove();this.inherited(arguments)},_setSort:function(m,l){this.inherited(arguments);this.updateSortArrow(this._sort)},_findSortArrowParent:function(m){var l=this.columns,w;for(w in l){var v=l[w];if(v.field==m)return v.headerNode}},updateSortArrow:function(m,l){this._lastSortedArrow&&(f(this._lastSortedArrow,"\x3c!dgrid-sort-up!dgrid-sort-down"),f(this._lastSortedArrow,
"!"),delete this._lastSortedArrow);l&&(this._sort=m);if(m[0]&&(l=m[0].attribute,m=m[0].descending,l=this._sortNode||this._findSortArrowParent(l),delete this._sortNode,l)){l=l.contents||l;var w=this._lastSortedArrow=f("div.dgrid-sort-arrow.ui-icon[role\x3dpresentation]");w.innerHTML="\x26nbsp;";l.insertBefore(w,l.firstChild);f(l,m?".dgrid-sort-down":".dgrid-sort-up");this.resize()}},styleColumn:function(m,l){return this.addCssRule("#"+k.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-"+k.escapeCssIdentifier(m,
"-"),l)},_configColumns:function(m,l){var w=[],v=l instanceof Array;k.each(l,function(x,p){"string"==typeof x&&(l[p]=x={label:x});v||x.field||(x.field=p);p=x.id=x.id||(isNaN(p)?p:m+p);this._configColumn&&(this._configColumn(x,p,l,m),p=x.id);v&&(this.columns[p]=x);x.grid=this;"function"===typeof x.init&&x.init();w.push(x)},this);return v?l:w},_destroyColumns:function(){var m=this.subRows,l=m&&m.length,w,v;this.cleanup();for(w=0;w<l;w++){var x=0;for(v=m[w].length;x<v;x++){var p=m[w][x];"function"===
typeof p.destroy&&p.destroy()}}},configStructure:function(){var m=this.subRows,l=this._columns=this.columns;this.columns=!l||l instanceof Array?{}:l;if(m)for(l=0;l<m.length;l++)m[l]=this._configColumns(l+"-",m[l]);else this.subRows=[this._configColumns("",l)]},_getColumns:function(){return this._columns||this.columns},_setColumns:function(m){this._destroyColumns();this.subRows=null;this.columns=m;this._updateColumns()},_setSubRows:function(m){this._destroyColumns();this.subRows=m;this._updateColumns()},
setColumns:function(m){b.deprecated("setColumns(...)",'use set("columns", ...) instead',"dgrid 0.4");this.set("columns",m)},setSubRows:function(m){b.deprecated("setSubRows(...)",'use set("subRows", ...) instead',"dgrid 0.4");this.set("subRows",m)},_updateColumns:function(){this.configStructure();this.renderHeader();this.refresh();this._lastCollection&&this.renderArray(this._lastCollection);this._started&&(this._sort&&this._sort.length?this.updateSortArrow(this._sort):this.resize())}});a.appendIfNode=
g;a.defaultRenderCell=q;return a})},"put-selector/put":function(){(function(b){var a,c=/[-+,> ]/;b([],a=function(d,f){function n(m){function l(){h&&p&&h!=p&&(p==m&&(w||(w=c.test(y)&&d.createDocumentFragment()))?w:p).insertBefore(h,x||null)}for(var w,v,x,p,h,t=arguments,r=t[0],u=0;u<t.length;u++){var y=t[u];if("object"==typeof y){v=!1;if(y instanceof Array){h=d.createDocumentFragment();for(var z=0;z<y.length;z++)h.appendChild(n(y[z]));y=h}if(y.nodeType)h=y,l(),p=y,x=0;else for(z in y)h[z]=y[z]}else if(v)v=
!1,h.appendChild(d.createTextNode(y));else{1>u&&(m=null);v=!0;if(r=y.replace(k,function(A,C,E,B,D,F){C&&(l(),"-"==C||"+"==C?(p=(x=h||p).parentNode,h=null,"+"==C&&(x=x.nextSibling)):("\x3c"==C?p=h=(h||p).parentNode:(","==C?p=m:h&&(p=h),h=null),x=0),h&&(p=h));if((A=!E&&B)||!h&&(E||D))"$"==A?(A=t[++u],p.appendChild(d.createTextNode(A))):(A=A||n.defaultTag,(C=e&&t[u+1]&&t[u+1].name)&&(A="\x3c"+A+' name\x3d"'+C+'"\x3e'),h=q&&~(g=A.indexOf("|"))?d.createElementNS(q[A.slice(0,g)],A.slice(g+1)):d.createElement(A));
if(E)if("$"==B&&(B=t[++u]),"#"==E)h.id=B;else if(C=(A=h.className)&&(" "+A+" ").replace(" "+B+" "," "),"."==E)h.className=A?(C+B).substring(1):B;else if("!"==y){var K;e?n("div",h,"\x3c").innerHTML="":(K=h.parentNode)&&K.removeChild(h)}else C=C.substring(1,C.length-1),C!=A&&(h.className=C);D&&("$"==F&&(F=t[++u]),"style"==D?h.style.cssText=F:(E="!"==D.charAt(0)?(D=D.substring(1))&&"removeAttribute":"setAttribute",F=""===F?D:F,q&&~(g=D.indexOf("|"))?h[E+"NS"](q[D.slice(0,g)],D.slice(g+1),F):h[E](D,F)));
return""}))throw new SyntaxError("Unexpected char "+r+" in "+y);l();p=r=h||p}}m&&w&&m.appendChild(w);return r}c=f||c;var k=/(?:\s*([-+ ,<>]))?\s*(\.|!\.?|#)?([-\w\u00A0-\uFFFF%$|]+)?(?:\[([^\]=]+)=?['"]?([^\]'"]*)['"]?\])?/g,g,q=!1;d=d||document;var e="object"==typeof d.createElement;n.addNamespace=function(m,l){d.createElementNS?(q||(q={}))[m]=l:d.namespaces.add(m,l)};n.defaultTag="div";n.forDocument=a;return n})})(function(b,a,c){c=c||a;"function"===typeof define?define([],function(){return c()}):
"undefined"==typeof window?require("./node-html")(module,c):put=c()})},"dgrid/List":function(){define("dojo/_base/kernel dojo/_base/declare dojo/dom dojo/on dojo/query dojo/has ./util/misc dojo/has!touch?./TouchScroll xstyle/has-class put-selector/put dojo/_base/sniff xstyle/css!./css/dgrid.css".split(" "),function(b,a,c,d,f,n,k,g,q,e){function m(z,A){return f("#"+k.escapeCssIdentifier(z),A)[0]}function l(z,A){e(document.body,z,".dgrid-scrollbar-measure");A=z["offset"+A]-z["client"+A];z.className=
"";z.parentNode&&document.body.removeChild(z);return A}function w(z){var A=z?"."+z.replace(u,"."):"";this._class&&(A="!"+this._class.replace(u,"!")+A);e(this.domNode,A);this._class=z}function v(){return this._class}function x(){return{x:this.bodyNode.scrollLeft,y:this.bodyNode.scrollTop}}function p(z){"undefined"!==typeof z.x&&(this.bodyNode.scrollLeft=z.x);"undefined"!==typeof z.y&&(this.bodyNode.scrollTop=z.y)}q("mozilla","opera","webkit","ie","ie-6","ie-6-7","quirks","no-quirks","touch");var h,
t;n.add("dom-scrollbar-width",function(z,A,C){return l(C,"Width")});n.add("dom-scrollbar-height",function(z,A,C){return l(C,"Height")});n.add("dom-rtl-scrollbar-left",function(z,A,C){z=e("div");e(document.body,C,".dgrid-scrollbar-measure[dir\x3drtl]");e(C,z);A=!!n("ie")||z.offsetLeft>=n("dom-scrollbar-width");C.className="";C.parentNode&&document.body.removeChild(C);e(z,"!");C.removeAttribute("dir");return A});var r=0,u=/ +/g,y=7>n("ie")?function(){if(this._started){var z=document.documentElement;
var A=z.clientWidth;z=z.clientHeight;var C=this._prevWinDims||[];if(C[0]!==A||C[1]!==z)this.resize(),this._prevWinDims=[A,z]}}:function(){this._started&&this.resize()};return a("dgrid.List",n("touch")?g:null,{tabableHeader:!1,showHeader:!1,showFooter:!1,maintainOddEven:!0,cleanAddedRules:!0,useTouchScroll:null,addUiClasses:!0,shouldObserveStore:!0,cleanEmptyObservers:!0,highlightDuration:250,postscript:function(z,A){var C=this;(this._Row=function(E,B,D){this.id=E;this.data=B;this.element=D}).prototype.remove=
function(){C.removeRow(this.element)};A&&(this.srcNodeRef=A=A.nodeType?A:m(A));this.create(z,A)},listType:"list",create:function(z,A){A=this.domNode=A||e("div");if(z){this.params=z;a.safeMixin(this,z);var C=z["class"]||z.className||A.className;this._sort=z.sort||[];delete this.sort}else this._sort=[];this.observers=[];this._numObservers=0;this._listeners=[];this._rowIdToObject={};this.postMixInProperties&&this.postMixInProperties();this.id=A.id=A.id||this.id||"dgrid_"+r++;null===this.useTouchScroll&&
(this.useTouchScroll=!n("dom-scrollbar-width"));this.buildRendering();C&&w.call(this,C);this.postCreate();delete this.srcNodeRef;this.domNode.offsetHeight&&this.startup()},buildRendering:function(){var z=this.domNode,A=this.addUiClasses,C=this;var E=this.isRTL="rtl"==(document.body.dir||document.documentElement.dir||document.body.style.direction).toLowerCase();z.className="";e(z,"[role\x3dgrid].dgrid.dgrid-"+this.listType+(A?".ui-widget":""));var B=this.headerNode=e(z,"div.dgrid-header.dgrid-header-row"+
(A?".ui-widget-header":"")+(this.showHeader?"":".dgrid-header-hidden"));8>n("ie")&&e(z,"div.dgrid-spacer");var D=this.bodyNode=e(z,"div.dgrid-scroller");D.tabIndex=-1;this.headerScrollNode=e(z,"div.dgrid-header.dgrid-header-scroll.dgrid-scrollbar-width"+(A?".ui-widget-header":""));var F=this.footerNode=e("div.dgrid-footer"+(this.showFooter?"":".dgrid-footer-hidden"));e(z,F);E&&(z.className+=" dgrid-rtl"+(n("dom-rtl-scrollbar-left")?" dgrid-rtl-swap":""));d(D,"scroll",function(K){C.showHeader&&(B.scrollLeft=
K.scrollLeft||D.scrollLeft);K.stopPropagation();d.emit(z,"scroll",{scrollTarget:D})});this.configStructure();this.renderHeader();this.contentNode=this.touchNode=e(this.bodyNode,"div.dgrid-content"+(A?".ui-widget-content":""));this._listeners.push(this._resizeHandle=d(window,"resize",k.throttleDelayed(y,this)))},postCreate:n("touch")?function(){this.useTouchScroll&&this.inherited(arguments)}:function(){},startup:function(){this._started||(this.inherited(arguments),this._started=!0,this.resize(),this.set("sort",
this._sort))},configStructure:function(){},resize:function(){var z=this.bodyNode,A=this.headerNode,C=this.footerNode,E=A.offsetHeight,B=this.showFooter?C.offsetHeight:0,D=7>n("ie");this.headerScrollNode.style.height=z.style.marginTop=E+"px";z.style.marginBottom=B+"px";D&&(z.style.height="",z.style.height=Math.max(this.domNode.offsetHeight-E-B,0)+"px",B&&(C.style.bottom="1px",setTimeout(function(){C.style.bottom=""},0)));h||(h=n("dom-scrollbar-width"),t=n("dom-scrollbar-height"),n("ie")&&(h++,t++),
k.addCssRule(".dgrid-scrollbar-width","width: "+h+"px"),k.addCssRule(".dgrid-scrollbar-height","height: "+t+"px"),17==h||D||(k.addCssRule(".dgrid-header-row","right: "+h+"px"),k.addCssRule(".dgrid-rtl-swap .dgrid-header-row","left: "+h+"px")));D&&(A.style.width=z.clientWidth+"px",setTimeout(function(){A.scrollLeft=z.scrollLeft},0))},addCssRule:function(z,A){z=k.addCssRule(z,A);this.cleanAddedRules&&this._listeners.push(z);return z},on:function(z,A){return d(this.domNode,z,A)},cleanup:function(){var z=
this.observers,A;for(A in this._rowIdToObject)if(this._rowIdToObject[A]!=this.columns){var C=m(A,this.domNode);C&&this.removeRow(C,!0)}for(A=0;A<z.length;A++)(C=z[A])&&C.cancel();this.observers=[];this._numObservers=0;this.preload=null},destroy:function(){if(this._listeners){for(var z=this._listeners.length;z--;)this._listeners[z].remove();delete this._listeners}this._started=!1;this.cleanup();e(this.domNode,"!");this.useTouchScroll&&this.inherited(arguments)},refresh:function(){this.cleanup();this._rowIdToObject=
{};this._autoId=0;this.contentNode.innerHTML="";this.scrollTo({x:0,y:0})},newRow:function(z,A,C,E,B){if(A){var D=this.insertRow(z,A,C,E,B);e(D,".dgrid-highlight"+(this.addUiClasses?".ui-state-highlight":""));setTimeout(function(){e(D,"!dgrid-highlight!ui-state-highlight")},this.highlightDuration);return D}},adjustRowIndices:function(z){var A=z.rowIndex;if(-1<A){do-1<z.rowIndex&&(this.maintainOddEven&&-1<(z.className+" ").indexOf("dgrid-row ")&&e(z,"."+(1==A%2?"dgrid-row-odd":"dgrid-row-even")+"!"+
(0==A%2?"dgrid-row-odd":"dgrid-row-even")),z.rowIndex=A++);while((z=z.nextSibling)&&z.rowIndex!=A)}},renderArray:function(z,A,C){function E(){var W=arguments;if(-1<J)for(var H=0;H<W.length;H++){var S=W[H],I=M[S?0:M.length-1];if(I=I&&B(I)){var Q=I[S?"previousSibling":"nextSibling"];Q&&(Q=K.row(Q));Q&&Q.element!=I&&(S=S?"unshift":"push",z[S](Q.data),M[S](Q.element),C.count++)}}}function B(W){return!c.isDescendant(W,K.domNode)&&m(W.id)?K.row(W.id.slice(K.id.length+5)).element:W}function D(W){X=K.insertRow(W,
R,null,L++,C);X.observerIndex=J;return X}function F(W){U=W.slice(0);(O=A?A.parentNode:K.contentNode)&&O.parentNode&&(O!==K.contentNode||W.length)?(O.insertBefore(R,A||null),(X=W[W.length-1])&&K.adjustRowIndices(X)):G[J]&&K.cleanEmptyObservers&&K._onEmptyRender(J);M=W;P&&(P.rows=M)}C=C||{};var K=this,L=C.start||0,G=this.observers,O;A||(this._lastCollection=z);if(z.observe&&this.shouldObserveStore){K._numObservers++;var P=z.observe(function(W,H,S){var I;if(-1<H&&M[H]){var Q=M.splice(H,1)[0];Q.parentNode==
O&&((I=Q.nextSibling)&&H!=S&&I.rowIndex--,K.removeRow(Q));C.count--;K._processScroll&&K._processScroll()}if(-1<S){if(M.length)if(0===S)var N=(N=M[S])&&B(N);else{if(N=M[S-1])N=B(N),N=(N.connected||N).nextSibling}else N=K._getFirstRowSibling&&K._getFirstRowSibling(O);Q&&N&&Q.id===N.id&&(N=(N.connected||N).nextSibling);N&&!N.parentNode&&(N=m(N.id));Q=A&&A.parentNode||N&&N.parentNode||K.contentNode;if(Q=K.newRow(W,Q,N,C.start+S,C))if(Q.observerIndex=J,M.splice(S,0,Q),!I||S<H)I=(I=Q.previousSibling)&&
I.rowIndex+1!=Q.rowIndex&&0!=Q.rowIndex?I:Q;C.count++}0===H?E(1,1):H===z.length-(-1===S?0:1)&&E(0,0);H!=S&&I&&K.adjustRowIndices(I);K._onNotification(M,W,H,S)},!0);var J=G.push(P)-1}var R=document.createDocumentFragment(),X,U;if(z.map){var M=z.map(D,console.error);if(M.then)return z.then(function(W){z=W;return M.then(function(H){F(H);E(1,1,0,0);return U})})}else{M=[];for(var V=0,Y=z.length;V<Y;V++)M[V]=D(z[V])}F(M);E(1,1,0,0);return U},_onEmptyRender:function(z){"undefined"!==typeof z&&(this.observers[z].cancel(),
this.observers[z]=0,this._numObservers--)},_onNotification:function(z,A,C,E){},renderHeader:function(){},_autoId:0,insertRow:function(z,A,C,E,B){var D=B.parentId;D=this.id+"-row-"+(D?D+"-":"")+(this.store&&this.store.getIdentity?this.store.getIdentity(z):this._autoId++);var F=m(D,this.domNode),K=F&&F.previousSibling;F&&(F===C&&(C=(C.connected||C).nextSibling),this.removeRow(F));F=this.renderRow(z,B);F.className=(F.className||"")+" dgrid-row "+(1==E%2?"dgrid-row-odd":"dgrid-row-even")+(this.addUiClasses?
" ui-state-default":"");this._rowIdToObject[F.id=D]=z;A.insertBefore(F,C||null);K&&this.adjustRowIndices(K);F.rowIndex=E;return F},renderRow:function(z,A){return e("div",""+z)},removeRow:function(z,A){z=z.element||z;delete this._rowIdToObject[z.id];A||e(z,"!")},row:function(z){var A;if(z instanceof this._Row)return z;z.target&&z.target.nodeType&&(z=z.target);if(z.nodeType){do{var C=z.id;if(A=this._rowIdToObject[C])return new this._Row(C.substring(this.id.length+5),A,z);z=z.parentNode}while(z&&z!=
this.domNode)}else return"object"==typeof z?A=this.store.getIdentity(z):(A=z,z=this._rowIdToObject[this.id+"-row-"+A]),new this._Row(A,z,m(this.id+"-row-"+A,this.domNode))},cell:function(z){return{row:this.row(z)}},_move:function(z,A,C,E){var B;var D=B=z.element;A=A||1;do if(z=B[0>A?"previousSibling":"nextSibling"]){do if((B=z)&&-1<(B.className+" ").indexOf(C+" ")){D=B;A+=0>A?1:-1;break}while(z=(!E||!B.hidden)&&B[0>A?"lastChild":"firstChild"])}else if(B=B.parentNode,!B||B===this.bodyNode||B===this.headerNode)break;
while(A);return D},up:function(z,A,C){z.element||(z=this.row(z));return this.row(this._move(z,-(A||1),"dgrid-row",C))},down:function(z,A,C){z.element||(z=this.row(z));return this.row(this._move(z,A||1,"dgrid-row",C))},scrollTo:n("touch")?function(z){return this.useTouchScroll?this.inherited(arguments):p.call(this,z)}:p,getScrollPosition:n("touch")?function(){return this.useTouchScroll?this.inherited(arguments):x.call(this)}:x,get:function(z){var A="_get"+z.charAt(0).toUpperCase()+z.slice(1);return"function"===
typeof this[A]?this[A].apply(this,[].slice.call(arguments,1)):this[z]},set:function(z,A){if("object"===typeof z)for(var C in z)this.set(C,z[C]);else C="_set"+z.charAt(0).toUpperCase()+z.slice(1),"function"===typeof this[C]?this[C].apply(this,[].slice.call(arguments,1)):this[z]=A;return this},_getClass:v,_setClass:w,_getClassName:v,_setClassName:w,_setSort:function(z,A){this._sort="string"!=typeof z?z:[{attribute:z,descending:A}];this.refresh();this._lastCollection&&(z.length&&("string"!=typeof z&&
(A=z[0].descending,z=z[0].attribute),this._lastCollection.sort(function(C,E){C=C[z];E=E[z];void 0===C&&(C="");void 0===E&&(E="");return C==E?0:C>E==!A?1:-1})),this.renderArray(this._lastCollection))},sort:function(z,A){b.deprecated("sort(...)",'use set("sort", ...) instead',"dgrid 0.4");this.set("sort",z,A)},_getSort:function(){return this._sort},_setShowHeader:function(z){var A=this.headerNode;this.showHeader=z;e(A,(z?"!":".")+"dgrid-header-hidden");this.renderHeader();this.resize();z&&(A.scrollLeft=
this.getScrollPosition().x)},setShowHeader:function(z){b.deprecated("setShowHeader(...)",'use set("showHeader", ...) instead',"dgrid 0.4");this.set("showHeader",z)},_setShowFooter:function(z){this.showFooter=z;e(this.footerNode,(z?"!":".")+"dgrid-footer-hidden");this.resize()}})})},"dgrid/util/misc":function(){define(["dojo/has"],function(b){b.add("dom-contains",function(e,m,l){return!!l.contains});var a=[],c,d,f,n=/([^A-Za-z0-9_\u00A0-\uFFFF-])/g,k=setTimeout,g=clearTimeout;b.add("requestidlecallback",
function(e){return"function"===typeof e.requestIdleCallback});var q={defaultDelay:15,throttle:function(e,m,l){var w=!1;l=l||q.defaultDelay;return function(){w||(w=!0,e.apply(m,arguments),k(function(){w=!1},l))}},throttleDelayed:function(e,m,l){var w=!1;l=l||q.defaultDelay;return function(){if(!w){w=!0;var v=arguments;k(function(){w=!1;e.apply(m,v)},l)}}},debounce:function(e,m,l){var w;l=l||q.defaultDelay;return function(){w&&(g(w),w=null);var v=arguments;w=k(function(){w=null;e.apply(m,v)},l)}},each:function(e,
m,l){var w;if(e)if("number"===typeof e.length){var v=0;for(w=e.length;v<w;v++)m.call(l,e[v],v,e)}else for(v in e)m.call(l,e[v],v,e)},contains:function(e,m){return b("dom-contains")?e.contains(m):e.compareDocumentPosition(m)&8},addCssRule:function(e,m){c||(c=document.createElement("style"),document.getElementsByTagName("head")[0].appendChild(c),c=c.sheet||c.styleSheet,d=c.deleteRule?"deleteRule":"removeRule",f=c.cssRules?"cssRules":"rules");var l=a.length;a[l]=(c.cssRules||c.rules).length;c.addRule?
c.addRule(e,m):c.insertRule(e+"{"+m+"}",a[l]);return{get:function(w){return c[f][a[l]].style[w]},set:function(w,v){"undefined"!==typeof a[l]&&(c[f][a[l]].style[w]=v)},remove:function(){var w=a[l],v;if(void 0!==w){c[d](w);a[l]=void 0;var x=l+1;for(v=a.length;x<v;x++)a[x]>w&&a[x]--}}}},escapeCssIdentifier:function(e,m){return"string"===typeof e?e.replace(n,m||"\\$1"):e}};return q})},"xstyle/has-class":function(){define(["dojo/has"],function(b){var a={};return function(){for(var c,d=arguments,f=0;f<
d.length;f++)if(c=d[f],!a[c]){a[c]=!0;var n=c.match(/^(no-)?(.+?)((-[\d\.]+)(-[\d\.]+)?)?$/),k=b(n[2]),g=-n[4];(0<g?g<=k&&(-n[5]||g)>=k:!!k)==!n[1]&&(document.documentElement.className+=" has-"+c)}}})},"xstyle/css":function(){define(["require"],function(b){function a(c,d,f){var n=document.documentElement;c=n.insertBefore(document.createElement(c),n.firstChild);c.id=d;d=(c.currentStyle||getComputedStyle(c,null)||{})[f];n.removeChild(c);return d}return{load:function(c,d,f,n){function k(m){var l=a("x-parse",
null,"content"),w=m&&(m.sheet||m.styleSheet);l&&"none"!=l&&"normal"!=l?d([eval(l)],function(v){m?v.process(m,f):(v.processAll(),f(w))}):f(w)}var g=d.toUrl(c);if(g.match(/!$/)){var q={wait:!1};g=g.slice(0,-1)}var e=d.cache&&d.cache["url:"+g];if(null!=e)e.xCss&&(e=e.cssText),"string"==typeof e?b(["./core/load-css"],function(m){k(m.insertCss(e))}):k();else{if("none"==a("div",c.replace(/\//g,"-").replace(/\..*/,"")+"-loaded","display"))return k();b(["./core/load-css"],function(m){m(g,k,q)})}}}})},"dgrid/OnDemandList":function(){define("./List ./_StoreMixin dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/dom dojo/on ./util/misc put-selector/put".split(" "),
function(b,a,c,d,f,n,k,g,q){return c("dgrid.OnDemandList",[b,a],{minRowsPerPage:25,maxRowsPerPage:250,maxEmptySpace:Infinity,bufferRows:10,farOffRemoval:2E3,queryRowsOverlap:0,pagingMethod:"debounce",pagingDelay:g.defaultDelay,keepScrollPosition:!1,rowHeight:22,postCreate:function(){this.inherited(arguments);var e=this;k(this.bodyNode,"scroll",g[this.pagingMethod](function(m){e._processScroll(m)},null,this.pagingDelay))},destroy:function(){this.inherited(arguments);this._refreshTimeout&&clearTimeout(this._refreshTimeout)},
renderQuery:function(e,m){function l(y){q(u,"!");if(y)throw w._refreshDeferred&&(w._refreshDeferred.reject(y),delete w._refreshDeferred),y;}var w=this,v=m&&m.container||this.contentNode,x={query:e,count:0,options:m},p,h=this.preload,t,r={node:q(v,"div.dgrid-preload",{rowIndex:0}),count:0,query:e,next:x,options:m};r.node.style.height="0";x.node=p=q(v,"div.dgrid-preload");x.previous=r;p.rowIndex=this.minRowsPerPage;h?((x.next=h.next)&&p.offsetTop>=h.node.offsetTop?x.previous=h:(x.next=h,x.previous=
h.previous),x.previous.next=x,x.next.previous=x):this.preload=x;var u=q(p,"-div.dgrid-loading");q(u,"div.dgrid-below").innerHTML=this.loadingMessage;m=d.mixin(this.get("queryOptions"),m,{start:0,count:this.minRowsPerPage},"level"in e?{queryLevel:e.level}:null);this._trackError(function(){return t=e(m)});if("undefined"===typeof t)l();else return f.when(w.renderArray(t,p,m),function(y){return f.when("undefined"===typeof t.total?t.length:t.total,function(z){var A=y.length,C=p.parentNode,E=w.noDataNode;
q(u,"!");"queryLevel"in m||(w._total=z);0===z&&C&&(E&&(q(E,"!"),delete w.noDataNode),w.noDataNode=E=q("div.dgrid-no-data"),C.insertBefore(E,w._getFirstRowSibling(C)),E.innerHTML=w.noDataMessage);for(var B=E=0;B<A;B++)E+=w._calcRowHeight(y[B]);A&&E&&(w.rowHeight=E/A);E=w.rowHeight*w.bufferRows;E>w.farOffRemoval&&(w.farOffRemoval=E);z-=A;x.count=z;p.rowIndex=A;z?p.style.height=Math.min(z*w.rowHeight,w.maxEmptySpace)+"px":(p.style.display="none",m.count++);w._previousScrollPosition&&C&&C.offsetHeight&&
(w.scrollTo(w._previousScrollPosition),delete w._previousScrollPosition);w._processScroll();w._refreshDeferred&&(w._refreshDeferred.resolve(t),delete w._refreshDeferred);return y},l)},l),t},refresh:function(e){var m=this,l=e&&e.keepScrollPosition;"undefined"===typeof l&&(l=this.keepScrollPosition);l&&(this._previousScrollPosition=this.getScrollPosition());this.inherited(arguments);if(this.store){l=this._refreshDeferred=new f;var w=m.renderQuery(function(v){return m.store.query(m.query,v)});"undefined"===
typeof w&&l.reject();return l.then(function(v){m._refreshTimeout=setTimeout(function(){k.emit(m.domNode,"dgrid-refresh-complete",{bubbles:!0,cancelable:!1,grid:m,results:v});m._refreshTimeout=null},0);delete m._refreshDeferred;return v},function(v){delete m._refreshDeferred;throw v;})}},resize:function(){this.inherited(arguments);this._processScroll()},_getFirstRowSibling:function(e){return e.lastChild},_calcRowHeight:function(e){var m=e.nextSibling;return m&&!/\bdgrid-preload\b/.test(m.className)?
m.offsetTop-e.offsetTop:e.offsetHeight},lastScrollTop:0,_processScroll:function(e){function m(R,X,U,M){var V=v.farOffRemoval,Y=R.node;if(X>2*V){for(var W,H=Y[U],S=0,I=0,Q=[];W=H;){var N=v._calcRowHeight(W);if(S+N+V>X||0>H.className.indexOf("dgrid-row")&&0>H.className.indexOf("dgrid-loading"))break;H=W[U];S+=N;I+=W.count||1;v.removeRow(W,!0);Q.push(W)}R.count+=I;M?(Y.rowIndex-=I,l(R)):Y.style.height=Y.offsetHeight+S+"px";var T=q("div",Q);setTimeout(function(){q(T,"!")},1)}}function l(R,X){R.node.style.height=
Math.min(R.count*v.rowHeight,X?Infinity:v.maxEmptySpace)+"px"}function w(R,X){do R=X?R.next:R.previous;while(R&&!R.node.offsetWidth);return R}var v=this,x=v.bodyNode;e=e&&e.scrollTop||this.getScrollPosition().y;x=x.offsetHeight+e;var p=v.preload,h=v.lastScrollTop,t=v.bufferRows*v.rowHeight,r=t-v.rowHeight,u,y,z,A=!0;for(v.lastScrollTop=e;p&&!p.node.offsetWidth;)p=p.previous;for(;p&&p!=C;){var C=v.preload;v.preload=p;var E=p.node;var B=E.offsetTop;if(x+1+r<B)p=w(p,A=!1);else if(e-1-r>B+E.offsetHeight)p=
w(p,A=!0);else{var D=((E.rowIndex?e-t:x)-B)/v.rowHeight;B=(x-e+2*t)/v.rowHeight;B+=Math.min(Math.abs(Math.max(Math.min((e-h)*v.rowHeight,v.maxRowsPerPage/2),v.maxRowsPerPage/-2)),10);0==E.rowIndex&&(D-=B);D=Math.max(D,0);10>D&&0<D&&B+D<v.maxRowsPerPage&&(B+=Math.max(0,D),D=0);B=Math.min(Math.max(B,v.minRowsPerPage),v.maxRowsPerPage,p.count);if(0==B)p=w(p,A);else{B=Math.ceil(B);D=Math.min(Math.floor(D),p.count-B);var F=d.mixin(v.get("queryOptions"),p.options);p.count-=B;var K=E,L=v.queryRowsOverlap,
G=(0<E.rowIndex||E.offsetTop>e)&&p;if(G){var O=p.previous;O&&(m(O,e-(O.node.offsetTop+O.node.offsetHeight),"nextSibling"),0<D&&O.node==E.previousSibling?(D=Math.min(p.count,D),p.previous.count+=D,l(p.previous,!0),E.rowIndex+=D,L=0):B+=D,p.count-=D);F.start=E.rowIndex-L;F.count=Math.min(B+L,v.maxRowsPerPage);E.rowIndex=F.start+F.count}else{if(p.next)if(m(p.next,p.next.node.offsetTop-x,"previousSibling",!0),K=E.nextSibling,K==p.next.node)p.next.count+=p.count-D,p.next.node.rowIndex=D+B,l(p.next),p.count=
D,L=0;else var P=!0;F.start=p.count;F.count=Math.min(B+L,v.maxRowsPerPage)}P&&K&&K.offsetWidth&&(P=K.offsetTop);l(p);"level"in p.query&&(F.queryLevel=p.query.level);if("queryLevel"in F||!(F.start>v._total||0>F.count)){E=q(K,"-div.dgrid-loading[style\x3dheight:"+B*v.rowHeight+"px]");q(E,"div.dgrid-"+(G?"below":"above")).innerHTML=v.loadingMessage;E.count=B;var J=p.query(F);if(void 0===v._trackError(function(){return J})){q(E,"!");return}(function(R,X,U,M){z=f.when(v.renderArray(M,R,F),function(V){y=
M;K=R.nextSibling;q(R,"!");if(U&&K&&K.offsetWidth){var Y=v.getScrollPosition();v.scrollTo({x:Y.x,y:Y.y+K.offsetTop-U,preserveMomentum:!0})}f.when(M.total||M.length,function(W){"queryLevel"in F||(v._total=W);X&&(X.count=W-X.node.rowIndex,0===X.count&&F.count++,l(X))});v._processScroll();return V},function(V){q(R,"!");throw V;})}).call(this,E,G,P,J);p=p.previous}}}}z&&(u=this._refreshDeferred)&&(delete this._refreshDeferred,f.when(z,function(){u.resolve(y)}))},removeRow:function(e,m){if(e){var l=e.previousSibling,
w=e.nextSibling,v;if(v=l)v=l.observerIndex,v=null!=v?v:l.previousObserverIndex;l=v;if(v=w)v=w.observerIndex,v=null!=v?v:w.nextObserverIndex;w=e.observerIndex;e.observerIndex=void 0;m&&(e.nextObserverIndex=v,e.previousObserverIndex=l);if(this.cleanEmptyObservers&&-1<w&&w!==l&&w!==v&&(l=this.observers,v=l[w])){if(!m)for(var x=v.rows,p=0;p<x.length;p++)if(x[p]!=e&&n.isDescendant(x[p],this.domNode))return this.inherited(arguments);v.cancel();this._numObservers--;l[w]=0}}this.inherited(arguments)}})})},
"dgrid/_StoreMixin":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/on dojo/aspect put-selector/put".split(" "),function(b,a,c,d,f,n,k){function g(e){return e}function q(e){if("object"!==typeof e)e=Error(e);else if("cancel"===e.dojoType)return;e.grid=this;f.emit(this.domNode,"dgrid-error",{grid:this,error:e,cancelable:!0,bubbles:!0})&&console.error(e)}return a("dgrid._StoreMixin",null,{store:null,query:null,queryOptions:null,getBeforePut:!0,noDataMessage:"",
loadingMessage:"",constructor:function(){this.query={};this.queryOptions={};this.dirty={};this._updating={};this._columnsWithSet={};n.before(this,"configStructure",c.hitch(this,function(){this._columnsWithSet={}}))},postCreate:function(){this.inherited(arguments);this.store&&this._updateNotifyHandle(this.store)},destroy:function(){this.inherited(arguments);this._notifyHandle&&this._notifyHandle.remove()},_configColumn:function(e){e.set&&(this._columnsWithSet[e.field]=e);this.inherited(arguments)},
_updateNotifyHandle:function(e){this._notifyHandle&&(this._notifyHandle.remove(),delete this._notifyHandle);e&&"function"===typeof e.notify&&this.shouldObserveStore&&(this._notifyHandle=n.after(e,"notify",c.hitch(this,"_onNotify"),!0),(e=this.get("sort"))&&e.length||console.warn("Observable store detected, but no sort order specified. You may experience quirks when adding/updating items.  These can be resolved by setting a sort order on the list or grid."))},_setStore:function(e,m,l){this._updateNotifyHandle(e);
this.store=e;this.dirty={};this.set("query",m,l)},_setQuery:function(e,m){var l=m&&m.sort;this.query=void 0!==e?e:this.query;this.queryOptions=m||this.queryOptions;this._started&&(l?this.set("sort",l):this.refresh())},setStore:function(e,m,l){b.deprecated("setStore(...)",'use set("store", ...) instead',"dgrid 0.4");this.set("store",e,m,l)},setQuery:function(e,m){b.deprecated("setQuery(...)",'use set("query", ...) instead',"dgrid 0.4");this.set("query",e,m)},_getQueryOptions:function(){var e=c.delegate(this.queryOptions,
{});if("function"===typeof this._sort||this._sort.length)e.sort=this._sort;return e},_getQuery:function(){var e=this.query;return"object"==typeof e&&null!=e?c.delegate(e,{}):e},_setSort:function(e,m){this.store&&(this._lastCollection=null);this.inherited(arguments)},_onNotify:function(e,m){this.inherited(arguments);e&&1>this._numObservers&&this.refresh({keepScrollPosition:!0})},refresh:function(){var e=this.inherited(arguments);this.store||(this.noDataNode=k(this.contentNode,"div.dgrid-no-data"),
this.noDataNode.innerHTML=this.noDataMessage);return e},renderArray:function(){var e=this,m=this.inherited(arguments);this.store||d.when(m,function(l){l.length&&e.noDataNode&&k(e.noDataNode,"!")});return m},_onEmptyRender:function(){},insertRow:function(e,m,l,w,v){var x=this.store,p=this.dirty;x=x&&x.getIdentity(e);var h;x in p&&!(x in this._updating)&&(h=p[x]);h&&(e=c.delegate(e,h));return this.inherited(arguments)},updateDirty:function(e,m,l){var w=this.dirty,v=w[e];v||(v=w[e]={});v[m]=l},setDirty:function(e,
m,l){b.deprecated("setDirty(...)","use updateDirty() instead","dgrid 0.4");this.updateDirty(e,m,l)},save:function(){function e(r,u){return function(y){var z=m._columnsWithSet,A=m._updating,C;if("function"===typeof y.set)y.set(u);else for(C in u)y[C]=u[C];for(C in z){var E=z[C].set(y);void 0!==E&&(y[C]=E)}A[r]=!0;return d.when(l.put(y),function(){delete w[r];delete A[r]})}}var m=this,l=this.store,w=this.dirty,v=new d,x=v.promise,p=function(r){var u;return m.getBeforePut||!(u=m.row(r).data)?function(){return l.get(r)}:
function(){return u}},h;for(h in w){var t=e(h,w[h]);x=x.then(p(h)).then(t)}v.resolve();return x},revert:function(){this.dirty={};this.refresh()},_trackError:function(e){"string"==typeof e&&(e=c.hitch(this,e));try{var m=e()}catch(l){q.call(this,l)}return d.when(m,g,c.hitch(this,q))},newRow:function(){var e=this.inherited(arguments);this.noDataNode&&(k(this.noDataNode,"!"),delete this.noDataNode);return e},removeRow:function(e,m){var l={element:e};!m&&this.noDataMessage&&this.up(l).element===e&&this.down(l).element===
e&&(this.noDataNode=k(this.contentNode,"div.dgrid-no-data"),this.noDataNode.innerHTML=this.noDataMessage);return this.inherited(arguments)}})})},"dgrid/Selection":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/Deferred dojo/on dojo/has dojo/mouse dojo/aspect ./List dojo/has!touch?./util/touch put-selector/put dojo/query dojo/_base/sniff".split(" "),function(b,a,c,d,f,n,k,g,q,e){function m(h,t){t=h.unselectable=t?"on":"";h=h.getElementsByTagName("*");for(var r=h.length;--r;)"INPUT"!==
h[r].tagName&&"TEXTAREA"!==h[r].tagName&&(h[r].unselectable=t)}function l(h,t){var r=h.bodyNode,u=t?"text":"-moz-none";w&&"msUserSelect"!==w?r.style[w]=u:f("dom-selectstart")?t||h._selectstartHandle?t&&h._selectstartHandle&&(h._selectstartHandle.remove(),delete h._selectstartHandle):h._selectstartHandle=d(r,"selectstart",function(y){var z=y.target&&y.target.tagName;"INPUT"!==z&&"TEXTAREA"!==z&&y.preventDefault()}):(m(r,!t),t||h._unselectableHandle)?t&&h._unselectableHandle&&(h._unselectableHandle.remove(),
delete h._unselectableHandle):h._unselectableHandle=k.after(h,"renderRow",function(y){m(y,!0);return y})}f.add("dom-comparedocumentposition",function(h,t,r){return!!r.compareDocumentPosition});f.add("pointer",function(h){return"PointerEvent"in h?"pointer":"MSPointerEvent"in h?"MSPointer":!1});f.add("css-user-select",function(h,t,r){h=r.style;t=["Khtml","O","ms","Moz","Webkit"];r=t.length;var u="userSelect";do if("undefined"!==typeof h[u])return u;while(r--&&(u=t[r]+"UserSelect"));return!1});f.add("dom-selectstart",
"undefined"!==typeof document.onselectstart);var w=f("css-user-select"),v=(g=f("pointer"))&&"MS"===g.slice(0,2),x=g?g+(v?"Down":"down"):"mousedown",p=g?g+(v?"Up":"up"):"mouseup";"WebkitUserSelect"===w&&"undefined"!==typeof document.documentElement.style.msUserSelect&&(w=!1);return a("dgrid.Selection",null,{selectionDelegate:".dgrid-row",selectionEvents:x+","+p+",dgrid-cellfocusin",selectionTouchEvents:f("touch")?q.tap:null,deselectOnRefresh:!0,allowSelectAll:!1,selection:{},selectionMode:"extended",
allowTextSelection:void 0,_selectionTargetType:"rows",create:function(){this.selection={};return this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this._initSelectionEvents();var h=this.selectionMode;this.selectionMode="";this._setSelectionMode(h)},destroy:function(){this.inherited(arguments);this._selectstartHandle&&this._selectstartHandle.remove();this._unselectableHandle&&this._unselectableHandle.remove();this._removeDeselectSignals&&this._removeDeselectSignals()},_setSelectionMode:function(h){h!=
this.selectionMode&&(this.clearSelection(),this.selectionMode=h,this._selectionHandlerName="_"+h+"SelectionHandler",this._setAllowTextSelection(this.allowTextSelection))},setSelectionMode:function(h){b.deprecated("setSelectionMode(...)",'use set("selectionMode", ...) instead',"dgrid 0.4");this.set("selectionMode",h)},_setAllowTextSelection:function(h){"undefined"!==typeof h?l(this,h):l(this,"none"===this.selectionMode);this.allowTextSelection=h},_handleSelect:function(h,t){if(!n.isRight(h)&&this[this._selectionHandlerName]&&
this.allowSelect(this.row(t))&&("dgrid-cellfocusin"!==h.type||"mousedown"!==h.parentType)&&(h.type!==p||t==this._waitForMouseUp)){this._waitForMouseUp=null;this._selectionTriggerEvent=h;if(!h.keyCode||!h.ctrlKey||32==h.keyCode)if(!h.shiftKey&&h.type===x&&this.isSelected(t))this._waitForMouseUp=t;else this[this._selectionHandlerName](h,t);this._selectionTriggerEvent=null}},_singleSelectionHandler:function(h,t){h=h.keyCode?h.ctrlKey:h.metaKey;this._lastSelected===t?this.select(t,null,!h||!this.isSelected(t)):
(this.clearSelection(),this.select(t),this._lastSelected=t)},_multipleSelectionHandler:function(h,t){var r=this._lastSelected,u=h.keyCode?h.ctrlKey:h.metaKey;if(!h.shiftKey){var y=u?null:!0;r=null}this.select(t,r,y);r||(this._lastSelected=t)},_extendedSelectionHandler:function(h,t){if(h.metaKey||!this.isSelected(t)||1!==this.getSelectedCount())(2===h.button?this.isSelected(t):h.keyCode?h.ctrlKey:h.metaKey)||this.clearSelection(null,!0),this._multipleSelectionHandler(h,t)},_toggleSelectionHandler:function(h,
t){this.select(t,null,null)},_initSelectionEvents:function(){var h=this,t=this.contentNode,r=this.selectionDelegate;this._selectionEventQueues={deselect:[],select:[]};f("touch")&&!f("pointer")&&this.selectionTouchEvents?(d(t,q.selector(r,this.selectionTouchEvents),function(u){h._handleSelect(u,this);h._ignoreMouseSelect=this}),d(t,d.selector(r,this.selectionEvents),function(u){h._ignoreMouseSelect!==this?h._handleSelect(u,this):u.type===p&&(h._ignoreMouseSelect=null)})):d(t,d.selector(r,this.selectionEvents),
function(u){h._handleSelect(u,this)});this.addKeyHandler&&this.addKeyHandler(32,function(u){h._handleSelect(u,u.target)});if(this.allowSelectAll)this.on("keydown",function(u){u.metaKey&&65==u.keyCode&&!/\bdgrid-input\b/.test(u.target.className)&&(u.preventDefault(),h[h.allSelected?"clearSelection":"selectAll"]())});this._setStore&&k.after(this,"_setStore",function(){h._updateDeselectionAspect()});this._updateDeselectionAspect()},_updateDeselectionAspect:function(){function h(z,A,C){z=A||z&&z[t.idProperty||
"id"];if(null!=z&&(A=(z=t.row(z))&&t.selection[z.id]))t[C](z,null,A)}var t=this,r=this.store;this._removeDeselectSignals&&this._removeDeselectSignals();if(r&&r.notify){var u=k.before(r,"notify",function(z,A){z||h(z,A,"deselect")});var y=k.after(r,"notify",function(z,A){h(z,A,"select")},!0);this._removeDeselectSignals=function(){u.remove();y.remove()}}else u=k.before(this,"removeRow",function(z,A){A||(z=this.row(z))&&z.id in this.selection&&this.deselect(z)}),this._removeDeselectSignals=function(){u.remove()}},
allowSelect:function(h){return!0},_fireSelectionEvent:function(h){var t=this._selectionEventQueues[h],r=this._selectionTriggerEvent;var u={bubbles:!0,grid:this};r&&(u.parentType=r.type);u[this._selectionTargetType]=t;this._selectionEventQueues[h]=[];d.emit(this.contentNode,"dgrid-"+h,u)},_fireSelectionEvents:function(){var h=this._selectionEventQueues,t;for(t in h)h[t].length&&this._fireSelectionEvent(t)},_select:function(h,t,r){"undefined"===typeof r&&(r=!0);h.element||(h=this.row(h));if(!1===r||
this.allowSelect(h)){var u=this.selection;var y=!!u[h.id];null===r&&(r=!y);var z=h.element;r||this.allSelected?u[h.id]=r:delete this.selection[h.id];z&&(r?e(z,".dgrid-selected"+(this.addUiClasses?".ui-state-active":"")):e(z,"!dgrid-selected!ui-state-active"));r!==y&&z&&this._selectionEventQueues[(r?"":"de")+"select"].push(h);if(t)if(t.element||(t=this.row(t)),t){if(t=t.element)for(u=this._determineSelectionDirection(z,t),u||(t=document.getElementById(t.id),u=this._determineSelectionDirection(z,t));h.element!=
t&&(h=this[u](h));)this._select(h,null,r)}else this._lastSelected=z,console.warn("The selection range has been reset because the beginning of the selection is no longer in the DOM. If you are using OnDemandList, you may wish to increase farOffRemoval to avoid this, but note that keeping more nodes in the DOM may impact performance.")}},_determineSelectionDirection:f("dom-comparedocumentposition")?function(h,t){h=t.compareDocumentPosition(h);return h&1?!1:2===h?"down":"up"}:function(h,t){return 1>
t.sourceIndex?!1:t.sourceIndex>h.sourceIndex?"down":"up"},select:function(h,t,r){this._select(h,t,r);this._fireSelectionEvents()},deselect:function(h,t){this.select(h,t,!1)},clearSelection:function(h,t){this.allSelected=!1;for(var r in this.selection)h!==r&&this._select(r,null,!1);t||(this._lastSelected=null);this._fireSelectionEvents()},selectAll:function(){this.allSelected=!0;this.selection={};for(var h in this._rowIdToObject){var t=this.row(this._rowIdToObject[h]);this._select(t.id,null,!0)}this._fireSelectionEvents()},
getSelectedCount:function(){var h=0,t;for(t in this.selection)t&&(h+=1);return h},isSelected:function(h){if("undefined"===typeof h||null===h)return!1;h.element||(h=this.row(h));return h.id in this.selection?!!this.selection[h.id]:this.allSelected&&(!h.data||this.allowSelect(h))},refresh:function(){this.deselectOnRefresh&&this.clearSelection();this._lastSelected=null;return this.inherited(arguments)},renderArray:function(){var h=this,t=this.inherited(arguments);c.when(t,function(r){var u=h.selection,
y,z;for(y=0;y<r.length;y++){var A=h.row(r[y]);(z=A.id in u?u[A.id]:h.allSelected)&&h._select(A,null,z)}h._fireSelectionEvents()});return t}})})},"dojo/store/Memory":function(){define(["../_base/declare","./util/QueryResults","./util/SimpleQueryEngine"],function(b,a,c){return b("dojo.store.Memory",null,{constructor:function(d){for(var f in d)this[f]=d[f];this.setData(this.data||[])},data:null,idProperty:"id",index:null,queryEngine:c,get:function(d){return this.data[this.index[d]]},getIdentity:function(d){return d[this.idProperty]},
put:function(d,f){var n=this.data,k=this.index,g=this.idProperty;g=d[g]=f&&"id"in f?f.id:g in d?d[g]:Math.random();var q=n.length,e,m=g in k?"update":"add";if("update"===m){if(f&&!1===f.overwrite)throw Error("Object already exists");q=e=k[g]}f&&"before"in f?null==f.before?(f=n.length,"update"===m&&--f):(f=k[this.getIdentity(f.before)],e<f&&--f):f=q;f===e?n[f]=d:(void 0!==e&&n.splice(e,1),n.splice(f,0,d),this._rebuildIndex(void 0===e?f:Math.min(e,f)));return g},add:function(d,f){(f=f||{}).overwrite=
!1;return this.put(d,f)},remove:function(d){var f=this.index,n=this.data;if(d in f)return n.splice(f[d],1),this.index={},this._rebuildIndex(),!0},query:function(d,f){return a(this.queryEngine(d,f)(this.data))},setData:function(d){d.items?(this.idProperty=d.identifier||this.idProperty,d=this.data=d.items):this.data=d;this.index={};this._rebuildIndex()},_rebuildIndex:function(d){var f=this.data,n=f.length;for(d=d||0;d<n;d++)this.index[f[d][this.idProperty]]=d}})})},"dojo/store/util/QueryResults":function(){define(["../../_base/array",
"../../_base/lang","../../when"],function(b,a,c){var d=function(f){function n(g){f[g]=function(){var q=arguments,e=c(f,function(m){Array.prototype.unshift.call(q,m);return d(b[g].apply(b,q))});if("forEach"!==g||k)return e}}if(!f)return f;var k=!!f.then;k&&(f=a.delegate(f));n("forEach");n("filter");n("map");null==f.total&&(f.total=c(f,function(g){return g.length}));return f};a.setObject("dojo.store.util.QueryResults",d);return d})},"dojo/store/util/SimpleQueryEngine":function(){define(["../../_base/array"],
function(b){return function(a,c){function d(n){n=b.filter(n,a);var k=c&&c.sort;k&&n.sort("function"==typeof k?k:function(q,e){for(var m,l=0;m=k[l];l++){var w=q[m.attribute],v=e[m.attribute];w=null!=w?w.valueOf():w;v=null!=v?v.valueOf():v;if(w!=v)return!!m.descending==(null==w||w>v)?-1:1}return 0});if(c&&(c.start||c.count)){var g=n.length;n=n.slice(c.start||0,(c.start||0)+(c.count||Infinity));n.total=g}return n}switch(typeof a){default:throw Error("Can not query with a "+typeof a);case "object":case "undefined":var f=
a;a=function(n){for(var k in f){var g=f[k];if(g&&g.test){if(!g.test(n[k],n))return!1}else if(g!=n[k])return!1}return!0};break;case "string":if(!this[a])throw Error("No filter function "+a+" was found in store");a=this[a];case "function":}d.matches=a;return d}})},"dojo/dnd/Source":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom-class ../dom-geometry ../mouse ../ready ../topic ./common ./Selector ./Manager".split(" "),function(b,a,c,d,f,n,k,g,q,e,m,l){c.isAsync||
g(0,function(){require(["dojo/dnd/AutoSource","dojo/dnd/Target"])});var w=a("dojo.dnd.Source",m,{isSource:!0,horizontal:!1,copyOnly:!1,selfCopy:!1,selfAccept:!0,skipForm:!1,withHandles:!1,autoSync:!1,delay:0,accept:["text"],generateText:!0,constructor:function(v,x){d.mixin(this,d.mixin({},x));v=this.accept;if(v.length)for(this.accept={},x=0;x<v.length;++x)this.accept[v[x]]=1;this.mouseDown=this.isDragging=!1;this.targetBox=this.targetAnchor=null;this.before=!0;this._lastY=this._lastX=0;this.sourceState=
"";this.isSource&&f.add(this.node,"dojoDndSource");this.targetState="";this.accept&&f.add(this.node,"dojoDndTarget");this.horizontal&&f.add(this.node,"dojoDndHorizontal");this.topics=[q.subscribe("/dnd/source/over",d.hitch(this,"onDndSourceOver")),q.subscribe("/dnd/start",d.hitch(this,"onDndStart")),q.subscribe("/dnd/drop",d.hitch(this,"onDndDrop")),q.subscribe("/dnd/cancel",d.hitch(this,"onDndCancel"))]},checkAcceptance:function(v,x){if(this==v)return!this.copyOnly||this.selfAccept;for(var p=0;p<
x.length;++p){for(var h=v.getItem(x[p].id).type,t=!1,r=0;r<h.length;++r)if(h[r]in this.accept){t=!0;break}if(!t)return!1}return!0},copyState:function(v,x){if(v)return!0;2>arguments.length&&(x=this==l.manager().target);if(x){if(this.copyOnly)return this.selfCopy}else return this.copyOnly;return!1},destroy:function(){w.superclass.destroy.call(this);b.forEach(this.topics,function(v){v.remove()});this.targetAnchor=null},onMouseMove:function(v){if(!this.isDragging||"Disabled"!=this.targetState){w.superclass.onMouseMove.call(this,
v);var x=l.manager();if(!this.isDragging&&this.mouseDown&&this.isSource&&(Math.abs(v.pageX-this._lastX)>this.delay||Math.abs(v.pageY-this._lastY)>this.delay)){var p=this.getSelectedNodes();p.length&&x.startDrag(this,p,this.copyState(e.getCopyKeyState(v),!0))}this.isDragging&&(p=!1,this.current&&(this.targetBox&&this.targetAnchor==this.current||(this.targetBox=n.position(this.current,!0)),p=this.horizontal?v.pageX-this.targetBox.x<this.targetBox.w/2==n.isBodyLtr(this.current.ownerDocument):v.pageY-
this.targetBox.y<this.targetBox.h/2),this.current!=this.targetAnchor||p!=this.before)&&(this._markTargetAnchor(p),x.canDrop(!this.current||x.source!=this||!(this.current.id in this.selection)))}},onMouseDown:function(v){this.mouseDown||!this._legalMouseDown(v)||this.skipForm&&e.isFormElement(v)||(this.mouseDown=!0,this._lastX=v.pageX,this._lastY=v.pageY,w.superclass.onMouseDown.call(this,v))},onMouseUp:function(v){this.mouseDown&&(this.mouseDown=!1,w.superclass.onMouseUp.call(this,v))},onDndSourceOver:function(v){this!==
v?(this.mouseDown=!1,this.targetAnchor&&this._unmarkTargetAnchor()):this.isDragging&&(v=l.manager(),v.canDrop("Disabled"!=this.targetState&&(!this.current||v.source!=this||!(this.current.id in this.selection))))},onDndStart:function(v,x,p){this.autoSync&&this.sync();this.isSource&&this._changeState("Source",this==v?p?"Copied":"Moved":"");x=this.accept&&this.checkAcceptance(v,x);this._changeState("Target",x?"":"Disabled");this==v&&l.manager().overSource(this);this.isDragging=!0},onDndDrop:function(v,
x,p,h){if(this==h)this.onDrop(v,x,p);this.onDndCancel()},onDndCancel:function(){this.targetAnchor&&(this._unmarkTargetAnchor(),this.targetAnchor=null);this.before=!0;this.mouseDown=this.isDragging=!1;this._changeState("Source","");this._changeState("Target","")},onDrop:function(v,x,p){if(this!=v)this.onDropExternal(v,x,p);else this.onDropInternal(x,p)},onDropExternal:function(v,x,p){var h=this._normalizedCreator;this._normalizedCreator=this.creator?function(t,r){return h.call(this,v.getItem(t.id).data,
r)}:p?function(t){var r=v.getItem(t.id);t=t.cloneNode(!0);t.id=e.getUniqueId();return{node:t,data:r.data,type:r.type}}:function(t){var r=v.getItem(t.id);v.delItem(t.id);return{node:t,data:r.data,type:r.type}};this.selectNone();p||this.creator||v.selectNone();this.insertNodes(!0,x,this.before,this.current);!p&&this.creator&&v.deleteSelectedNodes();this._normalizedCreator=h},onDropInternal:function(v,x){var p=this._normalizedCreator;if(!(this.current&&this.current.id in this.selection)){if(x)this._normalizedCreator=
this.creator?function(h,t){return p.call(this,this.getItem(h.id).data,t)}:function(h){var t=this.getItem(h.id);h=h.cloneNode(!0);h.id=e.getUniqueId();return{node:h,data:t.data,type:t.type}};else{if(!this.current)return;this._normalizedCreator=function(h){var t=this.getItem(h.id);return{node:h,data:t.data,type:t.type}}}this._removeSelection();this.insertNodes(!0,v,this.before,this.current);this._normalizedCreator=p}},onDraggingOver:function(){},onDraggingOut:function(){},onOverEvent:function(){w.superclass.onOverEvent.call(this);
l.manager().overSource(this);if(this.isDragging&&"Disabled"!=this.targetState)this.onDraggingOver()},onOutEvent:function(){w.superclass.onOutEvent.call(this);l.manager().outSource(this);if(this.isDragging&&"Disabled"!=this.targetState)this.onDraggingOut()},_markTargetAnchor:function(v){if(this.current!=this.targetAnchor||this.before!=v)this.targetAnchor&&this._removeItemClass(this.targetAnchor,this.before?"Before":"After"),this.targetAnchor=this.current,this.targetBox=null,this.before=v,this.targetAnchor&&
this._addItemClass(this.targetAnchor,this.before?"Before":"After")},_unmarkTargetAnchor:function(){this.targetAnchor&&(this._removeItemClass(this.targetAnchor,this.before?"Before":"After"),this.targetBox=this.targetAnchor=null,this.before=!0)},_markDndStatus:function(v){this._changeState("Source",v?"Copied":"Moved")},_legalMouseDown:function(v){if("touchstart"!=v.type&&!k.isLeft(v))return!1;if(!this.withHandles)return!0;for(v=v.target;v&&v!==this.node;v=v.parentNode){if(f.contains(v,"dojoDndHandle"))return!0;
if(f.contains(v,"dojoDndItem")||f.contains(v,"dojoDndIgnore"))break}return!1}});return w})},"dojo/dnd/Selector":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom ../dom-construct ../mouse ../_base/NodeList ../on ../touch ./common ./Container".split(" "),function(b,a,c,d,f,n,k,g,q,e,m,l){var w=a("dojo.dnd.Selector",l,{constructor:function(v,x){x||(x={});this.singular=x.singular;this.autoSync=x.autoSync;this.selection={};this.anchor=null;this.simpleSelection=!1;
this.events.push(q(this.node,e.press,d.hitch(this,"onMouseDown")),q(this.node,e.release,d.hitch(this,"onMouseUp")))},singular:!1,getSelectedNodes:function(){var v=new g,x=m._empty,p;for(p in this.selection)p in x||v.push(f.byId(p));return v},selectNone:function(){return this._removeSelection()._removeAnchor()},selectAll:function(){this.forInItems(function(v,x){this._addItemClass(f.byId(x),"Selected");this.selection[x]=1},this);return this._removeAnchor()},deleteSelectedNodes:function(){var v=m._empty,
x;for(x in this.selection)if(!(x in v)){var p=f.byId(x);this.delItem(x);n.destroy(p)}this.anchor=null;this.selection={};return this},forInSelectedItems:function(v,x){x=x||c.global;var p=this.selection,h=m._empty,t;for(t in p)t in h||v.call(x,this.getItem(t),t,this)},sync:function(){w.superclass.sync.call(this);this.anchor&&!this.getItem(this.anchor.id)&&(this.anchor=null);var v=[],x=m._empty,p;for(p in this.selection)p in x||this.getItem(p)||v.push(p);b.forEach(v,function(h){delete this.selection[h]},
this);return this},insertNodes:function(v,x,p,h){var t=this._normalizedCreator;this._normalizedCreator=function(r,u){r=t.call(this,r,u);v?(this.anchor?this.anchor!=r.node&&(this._removeItemClass(r.node,"Anchor"),this._addItemClass(r.node,"Selected")):(this.anchor=r.node,this._removeItemClass(r.node,"Selected"),this._addItemClass(this.anchor,"Anchor")),this.selection[r.node.id]=1):(this._removeItemClass(r.node,"Selected"),this._removeItemClass(r.node,"Anchor"));return r};w.superclass.insertNodes.call(this,
x,p,h);this._normalizedCreator=t;return this},destroy:function(){w.superclass.destroy.call(this);this.selection=this.anchor=null},onMouseDown:function(v){this.autoSync&&this.sync();if(this.current)if(!this.singular&&!m.getCopyKeyState(v)&&!v.shiftKey&&this.current.id in this.selection)this.simpleSelection=!0,k.isLeft(v)&&(v.stopPropagation(),v.preventDefault());else{if(!this.singular&&v.shiftKey){m.getCopyKeyState(v)||this._removeSelection();var x=this.getAllNodes();if(x.length&&(this.anchor||(this.anchor=
x[0],this._addItemClass(this.anchor,"Anchor")),this.selection[this.anchor.id]=1,this.anchor!=this.current)){for(var p=0,h;p<x.length&&(h=x[p],h!=this.anchor&&h!=this.current);++p);for(++p;p<x.length;++p){h=x[p];if(h==this.anchor||h==this.current)break;this._addItemClass(h,"Selected");this.selection[h.id]=1}this._addItemClass(this.current,"Selected");this.selection[this.current.id]=1}}else this.singular?this.anchor==this.current?m.getCopyKeyState(v)&&this.selectNone():(this.selectNone(),this.anchor=
this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1):m.getCopyKeyState(v)?this.anchor==this.current?(delete this.selection[this.anchor.id],this._removeAnchor()):this.current.id in this.selection?(this._removeItemClass(this.current,"Selected"),delete this.selection[this.current.id]):(this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this._addItemClass(this.anchor,"Selected")),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=
1):this.current.id in this.selection||(this.selectNone(),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1);v.stopPropagation();v.preventDefault()}},onMouseUp:function(){this.simpleSelection&&(this.simpleSelection=!1,this.selectNone(),this.current&&(this.anchor=this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1))},onMouseMove:function(){this.simpleSelection=!1},onOverEvent:function(){this.onmousemoveEvent=q(this.node,
e.move,d.hitch(this,"onMouseMove"))},onOutEvent:function(){this.onmousemoveEvent&&(this.onmousemoveEvent.remove(),delete this.onmousemoveEvent)},_removeSelection:function(){var v=m._empty,x;for(x in this.selection)if(!(x in v)){var p=f.byId(x);p&&this._removeItemClass(p,"Selected")}this.selection={};return this},_removeAnchor:function(){this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this.anchor=null);return this}});return w})},"dojo/_base/NodeList":function(){define(["./kernel","../query",
"./array","./html","../NodeList-dom"],function(b,a,c){a=a.NodeList;var d=a.prototype;d.connect=a._adaptAsForEach(function(){return b.connect.apply(this,arguments)});d.coords=a._adaptAsMap(b.coords);a.events="blur focus change click error keydown keypress keyup load mousedown mouseenter mouseleave mousemove mouseout mouseover mouseup submit".split(" ");c.forEach(a.events,function(f){var n="on"+f;d[n]=function(k,g){return this.connect(n,k,g)}});return b.NodeList=a})},"dojo/dnd/Container":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../_base/window ../dom ../dom-class ../dom-construct ../Evented ../has ../on ../query ../touch ./common".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v){a=a("dojo.dnd.Container",q,{skipForm:!1,allowNested:!1,constructor:function(x,p){this.node=n.byId(x);p||(p={});this.creator=p.creator||null;this.skipForm=p.skipForm;this.parent=p.dropParent&&n.byId(p.dropParent);this.map={};this.current=null;this.containerState="";k.add(this.node,"dojoDndContainer");p&&p._skipStartup||this.startup();this.events=[m(this.node,w.over,d.hitch(this,"onMouseOver")),m(this.node,w.out,d.hitch(this,"onMouseOut")),m(this.node,"dragstart",
d.hitch(this,"onSelectStart")),m(this.node,"selectstart",d.hitch(this,"onSelectStart"))]},creator:function(){},getItem:function(x){return this.map[x]},setItem:function(x,p){this.map[x]=p},delItem:function(x){delete this.map[x]},forInItems:function(x,p){p=p||c.global;var h=this.map,t=v._empty,r;for(r in h)r in t||x.call(p,h[r],r,this);return p},clearItems:function(){this.map={}},getAllNodes:function(){return l((this.allowNested?"":"\x3e ")+".dojoDndItem",this.parent)},sync:function(){var x={};this.getAllNodes().forEach(function(p){if(p.id){var h=
this.getItem(p.id);if(h){x[p.id]=h;return}}else p.id=v.getUniqueId();h=p.getAttribute("dndType");var t=p.getAttribute("dndData");x[p.id]={data:t||p.innerHTML,type:h?h.split(/\s*,\s*/):["text"]}},this);this.map=x;return this},insertNodes:function(x,p,h){this.parent.firstChild?p?h||(h=this.parent.firstChild):h&&(h=h.nextSibling):h=null;if(h)for(p=0;p<x.length;++p){var t=this._normalizedCreator(x[p]);this.setItem(t.node.id,{data:t.data,type:t.type});h.parentNode.insertBefore(t.node,h)}else for(p=0;p<
x.length;++p)t=this._normalizedCreator(x[p]),this.setItem(t.node.id,{data:t.data,type:t.type}),this.parent.appendChild(t.node);return this},destroy:function(){b.forEach(this.events,function(x){x.remove()});this.clearItems();this.node=this.parent=this.current=null},markupFactory:function(x,p,h){x._skipStartup=!0;return new h(p,x)},startup:function(){if(!this.parent&&(this.parent=this.node,"table"==this.parent.tagName.toLowerCase())){var x=this.parent.getElementsByTagName("tbody");x&&x.length&&(this.parent=
x[0])}this.defaultCreator=v._defaultCreator(this.parent);this.sync()},onMouseOver:function(x){for(var p=x.relatedTarget;p&&p!=this.node;)try{p=p.parentNode}catch(h){p=null}p||(this._changeState("Container","Over"),this.onOverEvent());p=this._getChildByEvent(x);this.current!=p&&(this.current&&this._removeItemClass(this.current,"Over"),p&&this._addItemClass(p,"Over"),this.current=p)},onMouseOut:function(x){for(x=x.relatedTarget;x;){if(x==this.node)return;try{x=x.parentNode}catch(p){x=null}}this.current&&
(this._removeItemClass(this.current,"Over"),this.current=null);this._changeState("Container","");this.onOutEvent()},onSelectStart:function(x){this.withHandles||this.skipForm&&v.isFormElement(x)||(x.stopPropagation(),x.preventDefault())},onOverEvent:function(){},onOutEvent:function(){},_changeState:function(x,p){var h="dojoDnd"+x;x=x.toLowerCase()+"State";k.replace(this.node,h+p,h+this[x]);this[x]=p},_addItemClass:function(x,p){k.add(x,"dojoDndItem"+p)},_removeItemClass:function(x,p){k.remove(x,"dojoDndItem"+
p)},_getChildByEvent:function(x){if(x=x.target)for(var p=x.parentNode;p;x=p,p=x.parentNode)if((p==this.parent||this.allowNested)&&k.contains(x,"dojoDndItem"))return x;return null},_normalizedCreator:function(x,p){x=(this.creator||this.defaultCreator).call(this,x,p);d.isArray(x.type)||(x.type=["text"]);x.node.id||(x.node.id=v.getUniqueId());k.add(x.node,"dojoDndItem");return x}});v._createNode=function(x){return x?function(p){return g.create(x,{innerHTML:p})}:v._createSpan};v._createTrTd=function(x){var p=
g.create("tr");g.create("td",{innerHTML:x},p);return p};v._createSpan=function(x){return g.create("span",{innerHTML:x})};v._defaultCreatorNodes={ul:"li",ol:"li",div:"div",p:"div"};v._defaultCreator=function(x){x=x.tagName.toLowerCase();var p="tbody"==x||"thead"==x?v._createTrTd:v._createNode(v._defaultCreatorNodes[x]);return function(h,t){var r=h&&d.isObject(h);if(r&&h.tagName&&h.nodeType&&h.getAttribute){var u=h.getAttribute("dndData")||h.innerHTML;r=(r=h.getAttribute("dndType"))?r.split(/\s*,\s*/):
["text"]}else u=r&&h.data?h.data:h,r=r&&h.type?h.type:["text"],h=("avatar"==t?v._createSpan:p)(String(u));h.id||(h.id=v.getUniqueId());return{node:h,data:u,type:r}}};return a})},"dojo/dnd/Manager":function(){define("../_base/array ../_base/declare ../_base/lang ../_base/window ../dom-class ../Evented ../has ../keys ../on ../topic ../touch ./common ./autoscroll ./Avatar".split(" "),function(b,a,c,d,f,n,k,g,q,e,m,l,w,v){var x=a("dojo.dnd.Manager",[n],{constructor:function(){this.source=this.avatar=
null;this.nodes=[];this.copy=!0;this.target=null;this.canDropFlag=!1;this.events=[]},OFFSET_X:k("touch")?4:16,OFFSET_Y:k("touch")?4:16,overSource:function(p){this.avatar&&(this.target=p&&"Disabled"!=p.targetState?p:null,this.canDropFlag=!!this.target,this.avatar.update());e.publish("/dnd/source/over",p)},outSource:function(p){this.avatar?this.target==p&&(this.target=null,this.canDropFlag=!1,this.avatar.update(),e.publish("/dnd/source/over",null)):e.publish("/dnd/source/over",null)},startDrag:function(p,
h,t){function r(u){u.preventDefault();u.stopPropagation()}w.autoScrollStart(d.doc);this.source=p;this.nodes=h;this.copy=!!t;this.avatar=this.makeAvatar();d.body().appendChild(this.avatar.node);e.publish("/dnd/start",p,h,this.copy);this.events=[q(d.doc,m.move,c.hitch(this,"onMouseMove")),q(d.doc,m.release,c.hitch(this,"onMouseUp")),q(d.doc,"keydown",c.hitch(this,"onKeyDown")),q(d.doc,"keyup",c.hitch(this,"onKeyUp")),q(d.doc,"dragstart",r),q(d.body(),"selectstart",r)];p="dojoDnd"+(t?"Copy":"Move");
f.add(d.body(),p)},canDrop:function(p){p=!(!this.target||!p);this.canDropFlag!=p&&(this.canDropFlag=p,this.avatar.update())},stopDrag:function(){f.remove(d.body(),["dojoDndCopy","dojoDndMove"]);b.forEach(this.events,function(p){p.remove()});this.events=[];this.avatar.destroy();this.source=this.target=this.avatar=null;this.nodes=[]},makeAvatar:function(){return new v(this)},updateAvatar:function(){this.avatar.update()},onMouseMove:function(p){var h=this.avatar;h&&(w.autoScrollNodes(p),h=h.node.style,
h.left=p.pageX+this.OFFSET_X+"px",h.top=p.pageY+this.OFFSET_Y+"px",h=!!this.source.copyState(l.getCopyKeyState(p)),this.copy!=h&&this._setCopyStatus(h));k("touch")&&p.preventDefault()},onMouseUp:function(p){if(this.avatar){if(this.target&&this.canDropFlag){var h=!!this.source.copyState(l.getCopyKeyState(p));e.publish("/dnd/drop/before",this.source,this.nodes,h,this.target,p);e.publish("/dnd/drop",this.source,this.nodes,h,this.target,p)}else e.publish("/dnd/cancel");this.stopDrag()}},onKeyDown:function(p){if(this.avatar)switch(p.keyCode){case g.CTRL:p=
!!this.source.copyState(!0);this.copy!=p&&this._setCopyStatus(p);break;case g.ESCAPE:e.publish("/dnd/cancel"),this.stopDrag()}},onKeyUp:function(p){this.avatar&&p.keyCode==g.CTRL&&(p=!!this.source.copyState(!1),this.copy!=p&&this._setCopyStatus(p))},_setCopyStatus:function(p){this.copy=p;this.source._markDndStatus(this.copy);this.updateAvatar();f.replace(d.body(),"dojoDnd"+(this.copy?"Copy":"Move"),"dojoDnd"+(this.copy?"Move":"Copy"))}});l._manager=null;x.manager=l.manager=function(){l._manager||
(l._manager=new x);return l._manager};return x})},"dojo/dnd/Avatar":function(){define("../_base/declare ../_base/window ../dom ../dom-attr ../dom-class ../dom-construct ../hccss ../query".split(" "),function(b,a,c,d,f,n,k,g){return b("dojo.dnd.Avatar",null,{constructor:function(q){this.manager=q;this.construct()},construct:function(){var q=n.create("table",{"class":"dojoDndAvatar",style:{position:"absolute",zIndex:"1999",margin:"0px"}}),e=this.manager.source,m=n.create("tbody",null,q),l=n.create("tr",
null,m),w=n.create("td",null,l),v=Math.min(5,this.manager.nodes.length),x=0;k("highcontrast")&&n.create("span",{id:"a11yIcon",innerHTML:this.manager.copy?"+":"\x3c"},w);n.create("span",{innerHTML:e.generateText?this._generateText():""},w);for(d.set(l,{"class":"dojoDndAvatarHeader",style:{opacity:.9}});x<v;++x){if(e.creator)var p=e._normalizedCreator(e.getItem(this.manager.nodes[x].id).data,"avatar").node;else p=this.manager.nodes[x].cloneNode(!0),"tr"==p.tagName.toLowerCase()&&(l=n.create("table"),
n.create("tbody",null,l).appendChild(p),p=l);p.id="";l=n.create("tr",null,m);w=n.create("td",null,l);w.appendChild(p);d.set(l,{"class":"dojoDndAvatarItem",style:{opacity:(9-x)/10}})}this.node=q},destroy:function(){n.destroy(this.node);this.node=!1},update:function(){f.toggle(this.node,"dojoDndAvatarCanDrop",this.manager.canDropFlag);if(k("highcontrast")){var q=c.byId("a11yIcon"),e="+";this.manager.canDropFlag&&!this.manager.copy?e="\x3c ":this.manager.canDropFlag||this.manager.copy?this.manager.canDropFlag||
(e="x"):e="o";q.innerHTML=e}g("tr.dojoDndAvatarHeader td span"+(k("highcontrast")?" span":""),this.node).forEach(function(m){m.innerHTML=this.manager.source.generateText?this._generateText():""},this)},_generateText:function(){return this.manager.nodes.length.toString()}})})},"dijit/CheckedMenuItem":function(){define(["dojo/_base/declare","dojo/dom-class","./MenuItem","dojo/text!./templates/CheckedMenuItem.html","./hccss"],function(b,a,c,d){return b("dijit.CheckedMenuItem",c,{baseClass:"dijitMenuItem dijitCheckedMenuItem",
templateString:d,checked:!1,_setCheckedAttr:function(f){this.domNode.setAttribute("aria-checked",f?"true":"false");this._set("checked",f)},iconClass:"",role:"menuitemcheckbox",checkedChar:"\x26#10003;",onChange:function(){},_onClick:function(f){this.disabled||(this.set("checked",!this.checked),this.onChange(this.checked));this.onClick(f)}})})},"dijit/MenuItem":function(){define("dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/kernel dojo/sniff dojo/_base/lang ./_Widget ./_TemplatedMixin ./_Contained ./_CssStateMixin dojo/text!./templates/MenuItem.html".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l){k=b("dijit.MenuItem"+(n("dojo-bidi")?"_NoBidi":""),[g,q,e,m],{templateString:l,baseClass:"dijitMenuItem",label:"",_setLabelAttr:function(w){this._set("label",w);var v="";var x=w.search(/{\S}/);if(0<=x){v=w.charAt(x+1);var p=w.substr(0,x);w=w.substr(x+3);x=p+v+w;w=p+'\x3cspan class\x3d"dijitMenuItemShortcutKey"\x3e'+v+"\x3c/span\x3e"+w}else x=w;this.domNode.setAttribute("aria-label",x+" "+this.accelKey);this.containerNode.innerHTML=w;this._set("shortcutKey",v)},iconClass:"dijitNoIcon",
_setIconClassAttr:{node:"iconNode",type:"class"},accelKey:"",disabled:!1,_fillContent:function(w){!w||"label"in this.params||this._set("label",w.innerHTML)},buildRendering:function(){this.inherited(arguments);c.set(this.containerNode,"id",this.id+"_text");this.accelKeyNode&&c.set(this.accelKeyNode,"id",this.id+"_accel");a.setSelectable(this.domNode,!1)},onClick:function(){},focus:function(){try{8==n("ie")&&this.containerNode.focus(),this.focusNode.focus()}catch(w){}},_setSelected:function(w){d.toggle(this.domNode,
"dijitMenuItemSelected",w)},setLabel:function(w){f.deprecated("dijit.MenuItem.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");this.set("label",w)},setDisabled:function(w){f.deprecated("dijit.Menu.setDisabled() is deprecated.  Use set('disabled', bool) instead.","","2.0");this.set("disabled",w)},_setDisabledAttr:function(w){this.focusNode.setAttribute("aria-disabled",w?"true":"false");this._set("disabled",w)},_setAccelKeyAttr:function(w){this.accelKeyNode&&(this.accelKeyNode.style.display=
w?"":"none",this.accelKeyNode.innerHTML=w,c.set(this.containerNode,"colSpan",w?"1":"2"));this._set("accelKey",w)}});n("dojo-bidi")&&(k=b("dijit.MenuItem",k,{_setLabelAttr:function(w){this.inherited(arguments);"auto"===this.textDir&&this.applyTextDir(this.textDirNode)}}));return k})},"dijit/form/Select":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/i18n dojo/keys dojo/_base/lang dojo/on dojo/sniff ./_FormSelectWidget ../_HasDropDown ../DropDownMenu ../MenuItem ../MenuSeparator ../Tooltip ../_KeyNavMixin ../registry dojo/text!./templates/Select.html dojo/i18n!./nls/validate".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r){function u(z){return function(A){this._isLoaded?this.inherited(z,arguments):this.loadDropDown(g.hitch(this,z,A))}}var y=a("dijit.form._SelectMenu",w,{autoFocus:!0,buildRendering:function(){this.inherited(arguments);this.domNode.setAttribute("role","listbox")},postCreate:function(){this.inherited(arguments);this.own(q(this.domNode,"selectstart",function(z){z.preventDefault();z.stopPropagation()}))},focus:function(){var z=!1,A=this.parentWidget.value;
g.isArray(A)&&(A=A[A.length-1]);A&&b.forEach(this.parentWidget._getChildren(),function(C){C.option&&A===C.option.value&&(z=!0,this.focusChild(C,!1))},this);z||this.inherited(arguments)}});f=a("dijit.form.Select"+(e("dojo-bidi")?"_NoBidi":""),[m,l,h],{baseClass:"dijitSelect dijitValidationTextBox",templateString:r,_buttonInputDisabled:e("ie")?"disabled":"",required:!1,state:"",message:"",tooltipPosition:[],emptyLabel:"\x26#160;",_isLoaded:!1,_childrenLoaded:!1,labelType:"html",_fillContent:function(){this.inherited(arguments);
if(this.options.length&&!this.value&&this.srcNodeRef){var z=this.srcNodeRef.selectedIndex||0;this._set("value",this.options[0<=z?z:0].value)}this.dropDown=new y({id:this.id+"_menu",parentWidget:this});d.add(this.dropDown.domNode,this.baseClass.replace(/\s+|$/g,"Menu "))},_getMenuItemForOption:function(z){if(z.value||z.label){var A=g.hitch(this,"_setValueAttr",z);z=new v({option:z,label:("text"===this.labelType?(z.label||"").toString().replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):z.label)||this.emptyLabel,
onClick:A,ownerDocument:this.ownerDocument,dir:this.dir,textDir:this.textDir,disabled:z.disabled||!1});z.focusNode.setAttribute("role","option");return z}return new x({ownerDocument:this.ownerDocument})},_addOptionItem:function(z){this.dropDown&&this.dropDown.addChild(this._getMenuItemForOption(z))},_getChildren:function(){return this.dropDown?this.dropDown.getChildren():[]},focus:function(){if(!this.disabled&&this.focusNode.focus)try{this.focusNode.focus()}catch(z){}},focusChild:function(z){z&&this.set("value",
z.option)},_getFirst:function(){var z=this._getChildren();return z.length?z[0]:null},_getLast:function(){var z=this._getChildren();return z.length?z[z.length-1]:null},childSelector:function(z){return(z=t.byNode(z))&&z.getParent()==this.dropDown},onKeyboardSearch:function(z,A,C,E){z&&this.focusChild(z)},_loadChildren:function(z){if(!0===z)if(this.dropDown&&(delete this.dropDown.focusedChild,this.focusedChild=null),this.options.length)this.inherited(arguments);else{b.forEach(this._getChildren(),function(C){C.destroyRecursive()});
var A=new v({ownerDocument:this.ownerDocument,label:this.emptyLabel});this.dropDown.addChild(A)}else this._updateSelection();this._isLoaded=!1;this._childrenLoaded=!0;this._loadingStore||this._setValueAttr(this.value,!1)},_refreshState:function(){this._started&&this.validate(this.focused)},startup:function(){this.inherited(arguments);this._refreshState()},_setValueAttr:function(z){this.inherited(arguments);c.set(this.valueNode,"value",this.get("value"));this._refreshState()},_setNameAttr:"valueNode",
_setDisabledAttr:function(z){this.inherited(arguments);this._refreshState()},_setRequiredAttr:function(z){this._set("required",z);this.focusNode.setAttribute("aria-required",z);this._refreshState()},_setOptionsAttr:function(z){this._isLoaded=!1;this._set("options",z)},_setDisplay:function(z){z=("text"===this.labelType?(z||"").replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):z)||this.emptyLabel;this.containerNode.innerHTML='\x3cspan role\x3d"option" aria-selected\x3d"true" class\x3d"dijitReset dijitInline '+
this.baseClass.replace(/\s+|$/g,"Label ")+'"\x3e'+z+"\x3c/span\x3e"},validate:function(z){z=this.disabled||this.isValid(z);this._set("state",z?"":this._hasBeenBlurred?"Error":"Incomplete");this.focusNode.setAttribute("aria-invalid",z?"false":"true");var A=z?"":this._missingMsg;A&&this.focused&&this._hasBeenBlurred?p.show(A,this.domNode,this.tooltipPosition,!this.isLeftToRight()):p.hide(this.domNode);this._set("message",A);return z},isValid:function(){return!this.required||0===this.value||!/^\s*$/.test(this.value||
"")},reset:function(){this.inherited(arguments);p.hide(this.domNode);this._refreshState()},postMixInProperties:function(){this.inherited(arguments);this._missingMsg=n.getLocalization("dijit.form","validate",this.lang).missingMessage},postCreate:function(){this.inherited(arguments);this.own(q(this.domNode,"selectstart",function(A){A.preventDefault();A.stopPropagation()}));this.domNode.setAttribute("aria-expanded","false");var z=this._keyNavCodes;delete z[k.LEFT_ARROW];delete z[k.RIGHT_ARROW]},_setStyleAttr:function(z){this.inherited(arguments);
d.toggle(this.domNode,this.baseClass.replace(/\s+|$/g,"FixedWidth "),!!this.domNode.style.width)},isLoaded:function(){return this._isLoaded},loadDropDown:function(z){this._loadChildren(!0);this._isLoaded=!0;z()},destroy:function(z){this.dropDown&&!this.dropDown._destroyed&&(this.dropDown.destroyRecursive(z),delete this.dropDown);p.hide(this.domNode);this.inherited(arguments)},_onFocus:function(){this.validate(!0)},_onBlur:function(){p.hide(this.domNode);this.inherited(arguments);this.validate(!1)}});
e("dojo-bidi")&&(f=a("dijit.form.Select",f,{_setDisplay:function(z){this.inherited(arguments);this.applyTextDir(this.containerNode)}}));f._Menu=y;f.prototype._onContainerKeydown=u("_onContainerKeydown");f.prototype._onContainerKeypress=u("_onContainerKeypress");return f})},"dijit/form/_FormSelectWidget":function(){define("dojo/_base/array dojo/_base/Deferred dojo/aspect dojo/data/util/sorter dojo/_base/declare dojo/dom dojo/dom-class dojo/_base/kernel dojo/_base/lang dojo/query dojo/when dojo/store/util/QueryResults ./_FormValueWidget".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w){return f("dijit.form._FormSelectWidget",w,{multiple:!1,options:null,store:null,_setStoreAttr:function(v){this._created&&this._deprecatedSetStore(v)},query:null,_setQueryAttr:function(v){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{query:v})},queryOptions:null,_setQueryOptionsAttr:function(v){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{queryOptions:v})},labelAttr:"",onFetch:null,sortByLabel:!0,loadChildrenOnOpen:!1,
onLoadDeferred:null,getOptions:function(v){var x=this.options||[];if(null==v)return x;if(q.isArrayLike(v))return b.map(v,function(p){return this.getOptions(p)},this);q.isString(v)&&(v={value:v});q.isObject(v)&&(b.some(x,function(p,h){for(var t in v)if(!(t in p)||p[t]!=v[t])return!1;v=h;return!0})||(v=-1));return 0<=v&&v<x.length?x[v]:null},addOption:function(v){b.forEach(q.isArrayLike(v)?v:[v],function(x){x&&q.isObject(x)&&this.options.push(x)},this);this._loadChildren()},removeOption:function(v){v=
this.getOptions(q.isArrayLike(v)?v:[v]);b.forEach(v,function(x){x&&(this.options=b.filter(this.options,function(p){return p.value!==x.value||p.label!==x.label}),this._removeOptionItem(x))},this);this._loadChildren()},updateOption:function(v){b.forEach(q.isArrayLike(v)?v:[v],function(x){var p=this.getOptions({value:x.value}),h;if(p)for(h in x)p[h]=x[h]},this);this._loadChildren()},setStore:function(v,x,p){g.deprecated(this.declaredClass+"::setStore(store, selectedValue, fetchArgs) is deprecated. Use set('query', fetchArgs.query), set('queryOptions', fetchArgs.queryOptions), set('store', store), or set('value', selectedValue) instead.",
"","2.0");this._deprecatedSetStore(v,x,p)},_deprecatedSetStore:function(v,x,p){var h=this.store;p=p||{};if(h!==v){for(var t;t=this._notifyConnections.pop();)t.remove();v.get||(q.mixin(v,{_oldAPI:!0,get:function(r){var u=new a;this.fetchItemByIdentity({identity:r,onItem:function(y){u.resolve(y)},onError:function(y){u.reject(y)}});return u.promise},query:function(r,u){var y=new a(function(){z.abort&&z.abort()});y.total=new a;var z=this.fetch(q.mixin({query:r,onBegin:function(A){y.total.resolve(A)},
onComplete:function(A){y.resolve(A)},onError:function(A){y.reject(A)}},u));return new l(y)}}),v.getFeatures()["dojo.data.api.Notification"]&&(this._notifyConnections=[c.after(v,"onNew",q.hitch(this,"_onNewItem"),!0),c.after(v,"onDelete",q.hitch(this,"_onDeleteItem"),!0),c.after(v,"onSet",q.hitch(this,"_onSetItem"),!0)]));this._set("store",v)}this.options&&this.options.length&&this.removeOption(this.options);this._queryRes&&this._queryRes.close&&this._queryRes.close();this._observeHandle&&this._observeHandle.remove&&
(this._observeHandle.remove(),this._observeHandle=null);p.query&&this._set("query",p.query);p.queryOptions&&this._set("queryOptions",p.queryOptions);v&&v.query&&(this._loadingStore=!0,this.onLoadDeferred=new a,this._queryRes=v.query(this.query,this.queryOptions),m(this._queryRes,q.hitch(this,function(r){if(this.sortByLabel&&!p.sort&&r.length)if(v.getValue)r.sort(d.createSortFunction([{attribute:v.getLabelAttributes(r[0])[0]}],v));else{var u=this.labelAttr;r.sort(function(y,z){return y[u]>z[u]?1:z[u]>
y[u]?-1:0})}p.onFetch&&(r=p.onFetch.call(this,r,p));b.forEach(r,function(y){this._addOptionForItem(y)},this);this._queryRes.observe&&(this._observeHandle=this._queryRes.observe(q.hitch(this,function(y,z,A){z==A?this._onSetItem(y):(-1!=z&&this._onDeleteItem(y),-1!=A&&this._onNewItem(y))}),!0));this._loadingStore=!1;this.set("value","_pendingValue"in this?this._pendingValue:x);delete this._pendingValue;this.loadChildrenOnOpen?this._pseudoLoadChildren(r):this._loadChildren();this.onLoadDeferred.resolve(!0);
this.onSetStore()}),q.hitch(this,function(r){console.error("dijit.form.Select: "+r.toString());this.onLoadDeferred.reject(r)})));return h},_setValueAttr:function(v,x){this._onChangeActive||(x=null);if(this._loadingStore)this._pendingValue=v;else if(null!=v){v=q.isArrayLike(v)?b.map(v,function(t){return q.isObject(t)?t:{value:t}}):q.isObject(v)?[v]:[{value:v}];v=b.filter(this.getOptions(v),function(t){return t&&t.value});var p=this.getOptions()||[];this.multiple||v[0]&&v[0].value||!p.length||(v[0]=
p[0]);b.forEach(p,function(t){t.selected=b.some(v,function(r){return r.value===t.value})});p=b.map(v,function(t){return t.value});if("undefined"!=typeof p&&"undefined"!=typeof p[0]){var h=b.map(v,function(t){return t.label});this._setDisplay(this.multiple?h:h[0]);this.inherited(arguments,[this.multiple?p:p[0],x]);this._updateSelection()}}},_getDisplayedValueAttr:function(){var v=b.map([].concat(this.get("selectedOptions")),function(x){return x&&"label"in x?x.label:x?x.value:null},this);return this.multiple?
v:v[0]},_setDisplayedValueAttr:function(v){this.set("value",this.getOptions("string"==typeof v?{label:v}:v))},_loadChildren:function(){this._loadingStore||(b.forEach(this._getChildren(),function(v){v.destroyRecursive()}),b.forEach(this.options,this._addOptionItem,this),this._updateSelection())},_updateSelection:function(){this.focusedChild=null;this._set("value",this._getValueFromOpts());var v=[].concat(this.value);if(v&&v[0]){var x=this;b.forEach(this._getChildren(),function(p){var h=b.some(v,function(t){return p.option&&
t===p.option.value});h&&!x.multiple&&(x.focusedChild=p);k.toggle(p.domNode,this.baseClass.replace(/\s+|$/g,"SelectedOption "),h);p.domNode.setAttribute("aria-selected",h?"true":"false")},this)}},_getValueFromOpts:function(){var v=this.getOptions()||[];if(!this.multiple&&v.length){var x=b.filter(v,function(p){return p.selected})[0];if(x&&x.value)return x.value;v[0].selected=!0;return v[0].value}return this.multiple?b.map(b.filter(v,function(p){return p.selected}),function(p){return p.value})||[]:""},
_onNewItem:function(v,x){x&&x.parent||this._addOptionForItem(v)},_onDeleteItem:function(v){this.removeOption({value:this.store.getIdentity(v)})},_onSetItem:function(v){this.updateOption(this._getOptionObjForItem(v))},_getOptionObjForItem:function(v){var x=this.store,p=this.labelAttr&&this.labelAttr in v?v[this.labelAttr]:x.getLabel(v);return{value:p?x.getIdentity(v):null,label:p,item:v}},_addOptionForItem:function(v){var x=this.store;x.isItemLoaded&&!x.isItemLoaded(v)?x.loadItem({item:v,onItem:function(p){this._addOptionForItem(p)},
scope:this}):(v=this._getOptionObjForItem(v),this.addOption(v))},constructor:function(v){this._oValue=(v||{}).value||null;this._notifyConnections=[]},buildRendering:function(){this.inherited(arguments);n.setSelectable(this.focusNode,!1)},_fillContent:function(){this.options||(this.options=this.srcNodeRef?e("\x3e *",this.srcNodeRef).map(function(v){return"separator"===v.getAttribute("type")?{value:"",label:"",selected:!1,disabled:!1}:{value:v.getAttribute("data-"+g._scopeName+"-value")||v.getAttribute("value"),
label:String(v.innerHTML),selected:v.getAttribute("selected")||!1,disabled:v.getAttribute("disabled")||!1}},this):[]);this.value?this.multiple&&"string"==typeof this.value&&this._set("value",this.value.split(",")):this._set("value",this._getValueFromOpts())},postCreate:function(){this.inherited(arguments);c.after(this,"onChange",q.hitch(this,"_updateSelection"));var v=this.store;v&&(v.getIdentity||v.getFeatures()["dojo.data.api.Identity"])&&(this.store=null,this._deprecatedSetStore(v,this._oValue,
{query:this.query,queryOptions:this.queryOptions}));this._storeInitialized=!0},startup:function(){this._loadChildren();this.inherited(arguments)},destroy:function(){for(var v;v=this._notifyConnections.pop();)v.remove();this._queryRes&&this._queryRes.close&&this._queryRes.close();this._observeHandle&&this._observeHandle.remove&&(this._observeHandle.remove(),this._observeHandle=null);this.inherited(arguments)},_addOptionItem:function(){},_removeOptionItem:function(){},_setDisplay:function(){},_getChildren:function(){return[]},
_getSelectedOptionsAttr:function(){return this.getOptions({selected:!0})},_pseudoLoadChildren:function(){},onSetStore:function(){}})})},"dojo/data/util/sorter":function(){define(["../../_base/lang"],function(b){var a={};b.setObject("dojo.data.util.sorter",a);a.basicComparator=function(c,d){var f=-1;null===c&&(c=void 0);null===d&&(d=void 0);if(c==d)f=0;else if(c>d||null==c)f=1;return f};a.createSortFunction=function(c,d){function f(w,v,x,p){return function(h,t){h=p.getValue(h,w);t=p.getValue(t,w);
return v*x(h,t)}}for(var n=[],k,g=d.comparatorMap,q=a.basicComparator,e=0;e<c.length;e++){k=c[e];var m=k.attribute;if(m){k=k.descending?-1:1;var l=q;g&&("string"!==typeof m&&"toString"in m&&(m=m.toString()),l=g[m]||q);n.push(f(m,k,l,d))}}return function(w,v){for(var x=0;x<n.length;){var p=n[x++](w,v);if(0!==p)return p}return 0}};return a})},"dijit/form/_FormValueWidget":function(){define(["dojo/_base/declare","dojo/sniff","./_FormWidget","./_FormValueMixin"],function(b,a,c,d){return b("dijit.form._FormValueWidget",
[c,d],{_layoutHackIE7:function(){if(7==a("ie"))for(var f=this.domNode,n=f.parentNode,k=f.firstChild||f,g=k.style.filter,q=this;n&&0==n.clientHeight;)(function(){var e=q.connect(n,"onscroll",function(){q.disconnect(e);k.style.filter=(new Date).getMilliseconds();q.defer(function(){k.style.filter=g})})})(),n=n.parentNode}})})},"dijit/form/_FormWidget":function(){define("dojo/_base/declare dojo/sniff dojo/_base/kernel dojo/ready ../_Widget ../_CssStateMixin ../_TemplatedMixin ./_FormWidgetMixin".split(" "),
function(b,a,c,d,f,n,k,g){a("dijit-legacy-requires")&&d(0,function(){require(["dijit/form/_FormValueWidget"])});return b("dijit.form._FormWidget",[f,k,n,g],{setDisabled:function(q){c.deprecated("setDisabled("+q+") is deprecated. Use set('disabled',"+q+") instead.","","2.0");this.set("disabled",q)},setValue:function(q){c.deprecated("dijit.form._FormWidget:setValue("+q+") is deprecated.  Use set('value',"+q+") instead.","","2.0");this.set("value",q)},getValue:function(){c.deprecated(this.declaredClass+
"::getValue() is deprecated. Use get('value') instead.","","2.0");return this.get("value")},postMixInProperties:function(){this.nameAttrSetting=this.name?'name\x3d"'+this.name.replace(/"/g,"\x26quot;")+'"':"";this.inherited(arguments)}})})},"dijit/form/_FormWidgetMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/dom-style dojo/_base/lang dojo/mouse dojo/on dojo/sniff dojo/window ../a11y".split(" "),function(b,a,c,d,f,n,k,g,q,e){return a("dijit.form._FormWidgetMixin",
null,{name:"",alt:"",value:"",type:"text","aria-label":"focusNode",tabIndex:"0",_setTabIndexAttr:"focusNode",disabled:!1,intermediateChanges:!1,scrollOnFocus:!0,_setIdAttr:"focusNode",_setDisabledAttr:function(m){this._set("disabled",m);/^(button|input|select|textarea|optgroup|option|fieldset)$/i.test(this.focusNode.tagName)?c.set(this.focusNode,"disabled",m):this.focusNode.setAttribute("aria-disabled",m?"true":"false");this.valueNode&&c.set(this.valueNode,"disabled",m);m?(this._set("hovering",!1),
this._set("active",!1),m="tabIndex"in this.attributeMap?this.attributeMap.tabIndex:"_setTabIndexAttr"in this?this._setTabIndexAttr:"focusNode",b.forEach(f.isArray(m)?m:[m],function(l){l=this[l];g("webkit")||e.hasDefaultTabStop(l)?l.setAttribute("tabIndex","-1"):l.removeAttribute("tabIndex")},this)):""!=this.tabIndex&&this.set("tabIndex",this.tabIndex)},_onFocus:function(m){if("mouse"==m&&this.isFocusable())var l=this.own(k(this.focusNode,"focus",function(){w.remove();l.remove()}))[0],w=this.own(k(this.ownerDocumentBody,
"pointerup",f.hitch(this,function(v){w.remove();l.remove();this.focused&&("touchend"==v.type?this.defer("focus"):this.focus())})))[0];this.scrollOnFocus&&this.defer(function(){q.scrollIntoView(this.domNode)});this.inherited(arguments)},isFocusable:function(){return!this.disabled&&this.focusNode&&"none"!=d.get(this.domNode,"display")},focus:function(){if(!this.disabled&&this.focusNode.focus)try{this.focusNode.focus()}catch(m){}},compare:function(m,l){return"number"==typeof m&&"number"==typeof l?isNaN(m)&&
isNaN(l)?0:m-l:m>l?1:m<l?-1:0},onChange:function(){},_onChangeActive:!1,_handleOnChange:function(m,l){void 0!=this._lastValueReported||null!==l&&this._onChangeActive||(this._resetValue=this._lastValueReported=m);this._pendingOnChange=this._pendingOnChange||typeof m!=typeof this._lastValueReported||0!=this.compare(m,this._lastValueReported);(this.intermediateChanges||l||void 0===l)&&this._pendingOnChange&&(this._lastValueReported=m,this._pendingOnChange=!1,this._onChangeActive&&(this._onChangeHandle&&
this._onChangeHandle.remove(),this._onChangeHandle=this.defer(function(){this._onChangeHandle=null;this.onChange(m)})))},create:function(){this.inherited(arguments);this._onChangeActive=!0},destroy:function(){this._onChangeHandle&&(this._onChangeHandle.remove(),this.onChange(this._lastValueReported));this.inherited(arguments)}})})},"dijit/form/_FormValueMixin":function(){define("dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dojo/sniff ./_FormWidgetMixin".split(" "),function(b,
a,c,d,f,n,k){return b("dijit.form._FormValueMixin",k,{readOnly:!1,_setReadOnlyAttr:function(g){a.set(this.focusNode,"readOnly",g);this._set("readOnly",g)},postCreate:function(){this.inherited(arguments);void 0===this._resetValue&&(this._lastValueReported=this._resetValue=this.value)},_setValueAttr:function(g,q){this._handleOnChange(g,q)},_handleOnChange:function(g,q){this._set("value",g);this.inherited(arguments)},undo:function(){this._setValueAttr(this._lastValueReported,!1)},reset:function(){this._hasBeenBlurred=
!1;this._setValueAttr(this._resetValue,!0)}})})},"dijit/_HasDropDown":function(){define("dojo/_base/declare dojo/_base/Deferred dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/has dojo/keys dojo/_base/lang dojo/on dojo/touch ./registry ./focus ./popup ./_FocusMixin".split(" "),function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p){return b("dijit._HasDropDown",p,{_buttonNode:null,_arrowWrapperNode:null,_popupStateNode:null,_aroundNode:null,dropDown:null,autoWidth:!0,forceWidth:!1,maxHeight:-1,
dropDownPosition:["below","above"],_stopClickEvents:!0,_onDropDownMouseDown:function(h){this.disabled||this.readOnly||("MSPointerDown"!=h.type&&h.preventDefault(),this.own(m.once(this.ownerDocument,l.release,e.hitch(this,"_onDropDownMouseUp"))),this.toggleDropDown())},_onDropDownMouseUp:function(h){var t=this.dropDown,r=!1;if(h&&this._opened){var u=n.position(this._buttonNode,!0);if(!(h.pageX>=u.x&&h.pageX<=u.x+u.w&&h.pageY>=u.y&&h.pageY<=u.y+u.h)){for(u=h.target;u&&!r;)f.contains(u,"dijitPopup")?
r=!0:u=u.parentNode;if(r){u=h.target;if(t.onItemClick){for(var y;u&&!(y=w.byNode(u));)u=u.parentNode;if(y&&y.onClick&&y.getParent)y.getParent().onItemClick(y,h)}return}}}this._opened?t.focus&&(!1!==t.autoFocus||"mouseup"==h.type&&!this.hovering)&&(this._focusDropDownTimer=this.defer(function(){t.focus();delete this._focusDropDownTimer})):this.focus&&this.defer("focus")},_onDropDownClick:function(h){this._stopClickEvents&&(h.stopPropagation(),h.preventDefault())},buildRendering:function(){this.inherited(arguments);
this._buttonNode=this._buttonNode||this.focusNode||this.domNode;this._popupStateNode=this._popupStateNode||this.focusNode||this._buttonNode;var h={after:this.isLeftToRight()?"Right":"Left",before:this.isLeftToRight()?"Left":"Right",above:"Up",below:"Down",left:"Left",right:"Right"}[this.dropDownPosition[0]]||this.dropDownPosition[0]||"Down";f.add(this._arrowWrapperNode||this._buttonNode,"dijit"+h+"ArrowButton")},postCreate:function(){this.inherited(arguments);var h=this.focusNode||this.domNode;this.own(m(this._buttonNode,
l.press,e.hitch(this,"_onDropDownMouseDown")),m(this._buttonNode,"click",e.hitch(this,"_onDropDownClick")),m(h,"keydown",e.hitch(this,"_onKey")),m(h,"keyup",e.hitch(this,"_onKeyUp")))},destroy:function(){this._opened&&this.closeDropDown(!0);this.dropDown&&(this.dropDown._destroyed||this.dropDown.destroyRecursive(),delete this.dropDown);this.inherited(arguments)},_onKey:function(h){if(!this.disabled&&!this.readOnly){var t=this.dropDown,r=h.target;t&&this._opened&&t.handleKey&&!1===t.handleKey(h)?(h.stopPropagation(),
h.preventDefault()):t&&this._opened&&h.keyCode==q.ESCAPE?(this.closeDropDown(),h.stopPropagation(),h.preventDefault()):!this._opened&&(h.keyCode==q.DOWN_ARROW||(h.keyCode==q.ENTER||h.keyCode==q.SPACE&&(!this._searchTimer||h.ctrlKey||h.altKey||h.metaKey))&&("input"!==(r.tagName||"").toLowerCase()||r.type&&"text"!==r.type.toLowerCase()))&&(this._toggleOnKeyUp=!0,h.stopPropagation(),h.preventDefault())}},_onKeyUp:function(){if(this._toggleOnKeyUp){delete this._toggleOnKeyUp;this.toggleDropDown();var h=
this.dropDown;h&&h.focus&&this.defer(e.hitch(h,"focus"),1)}},_onBlur:function(){this.closeDropDown(!1);this.inherited(arguments)},isLoaded:function(){return!0},loadDropDown:function(h){h()},loadAndOpenDropDown:function(){var h=new a,t=e.hitch(this,function(){this.openDropDown();h.resolve(this.dropDown)});this.isLoaded()?t():this.loadDropDown(t);return h},toggleDropDown:function(){this.disabled||this.readOnly||(this._opened?this.closeDropDown(!0):this.loadAndOpenDropDown())},openDropDown:function(){var h=
this.dropDown,t=h.domNode,r=this._aroundNode||this.domNode,u=this,y=x.open({parent:this,popup:h,around:r,orient:this.dropDownPosition,maxHeight:this.maxHeight,onExecute:function(){u.closeDropDown(!0)},onCancel:function(){u.closeDropDown(!0)},onClose:function(){d.set(u._popupStateNode,"popupActive",!1);f.remove(u._popupStateNode,"dijitHasDropDownOpen");u._set("_opened",!1)}});if(this.forceWidth||this.autoWidth&&r.offsetWidth>h._popupWrapper.offsetWidth){r=r.offsetWidth-h._popupWrapper.offsetWidth;
var z={w:h.domNode.offsetWidth+r};this._origStyle=t.style.cssText;e.isFunction(h.resize)?h.resize(z):n.setMarginBox(t,z);"R"==y.corner[1]&&(h._popupWrapper.style.left=h._popupWrapper.style.left.replace("px","")-r+"px")}d.set(this._popupStateNode,"popupActive","true");f.add(this._popupStateNode,"dijitHasDropDownOpen");this._set("_opened",!0);this._popupStateNode.setAttribute("aria-expanded","true");this._popupStateNode.setAttribute("aria-owns",h.id);"presentation"===t.getAttribute("role")||t.getAttribute("aria-labelledby")||
t.setAttribute("aria-labelledby",this.id);return y},closeDropDown:function(h){this._focusDropDownTimer&&(this._focusDropDownTimer.remove(),delete this._focusDropDownTimer);this._opened&&(this._popupStateNode.setAttribute("aria-expanded","false"),h&&this.focus&&this.focus(),x.close(this.dropDown),this._opened=!1);this._origStyle&&(this.dropDown.domNode.style.cssText=this._origStyle,delete this._origStyle)}})})},"dijit/MenuSeparator":function(){define("dojo/_base/declare dojo/dom ./_WidgetBase ./_TemplatedMixin ./_Contained dojo/text!./templates/MenuSeparator.html".split(" "),
function(b,a,c,d,f,n){return b("dijit.MenuSeparator",[c,d,f],{templateString:n,buildRendering:function(){this.inherited(arguments);a.setSelectable(this.domNode,!1)},isFocusable:function(){return!1}})})},"dijit/Tooltip":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/fx dojo/dom dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/_base/lang dojo/mouse dojo/on dojo/sniff ./_base/manager ./place ./_Widget ./_TemplatedMixin ./BackgroundIframe dojo/text!./templates/Tooltip.html ./main".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t){function r(){}var u=a("dijit._MasterTooltip",[v,x],{duration:l.defaultDuration,templateString:h,postCreate:function(){this.ownerDocumentBody.appendChild(this.domNode);this.bgIframe=new p(this.domNode);this.fadeIn=c.fadeIn({node:this.domNode,duration:this.duration,onEnd:g.hitch(this,"_onShow")});this.fadeOut=c.fadeOut({node:this.domNode,duration:this.duration,onEnd:g.hitch(this,"_onHide")})},show:function(z,A,C,E,B,D,F){if(!this.aroundNode||this.aroundNode!==
A||this.containerNode.innerHTML!=z)if("playing"==this.fadeOut.status())this._onDeck=arguments;else{this.containerNode.innerHTML=z;B&&this.set("textDir",B);this.containerNode.align=E?"right":"left";var K=w.around(this.domNode,A,C&&C.length?C:y.defaultPosition,!E,g.hitch(this,"orient")),L=K.aroundNodePos;"M"==K.corner.charAt(0)&&"M"==K.aroundCorner.charAt(0)?(this.connectorNode.style.top=L.y+(L.h-this.connectorNode.offsetHeight>>1)-K.y+"px",this.connectorNode.style.left=""):"M"==K.corner.charAt(1)&&
"M"==K.aroundCorner.charAt(1)?this.connectorNode.style.left=L.x+(L.w-this.connectorNode.offsetWidth>>1)-K.x+"px":(this.connectorNode.style.left="",this.connectorNode.style.top="");k.set(this.domNode,"opacity",0);this.fadeIn.play();this.isShowingNow=!0;this.aroundNode=A;this.onMouseEnter=D||r;this.onMouseLeave=F||r}},orient:function(z,A,C,E,B){this.connectorNode.style.top="";var D=E.h;E=E.w;z.className="dijitTooltip "+{"MR-ML":"dijitTooltipRight","ML-MR":"dijitTooltipLeft","TM-BM":"dijitTooltipAbove",
"BM-TM":"dijitTooltipBelow","BL-TL":"dijitTooltipBelow dijitTooltipABLeft","TL-BL":"dijitTooltipAbove dijitTooltipABLeft","BR-TR":"dijitTooltipBelow dijitTooltipABRight","TR-BR":"dijitTooltipAbove dijitTooltipABRight","BR-BL":"dijitTooltipRight","BL-BR":"dijitTooltipLeft"}[A+"-"+C];this.domNode.style.width="auto";var F=n.position(this.domNode);m("ie")&&(F.w+=2);n.setMarginBox(this.domNode,{w:Math.min(Math.max(E,1),F.w)});"B"==C.charAt(0)&&"B"==A.charAt(0)?(z=n.position(z),A=this.connectorNode.offsetHeight,
z.h>D?(this.connectorNode.style.top=D-(B.h+A>>1)+"px",this.connectorNode.style.bottom=""):(this.connectorNode.style.bottom=Math.min(Math.max(B.h/2-A/2,0),z.h-A)+"px",this.connectorNode.style.top="")):(this.connectorNode.style.top="",this.connectorNode.style.bottom="");return Math.max(0,F.w-E)},_onShow:function(){m("ie")&&(this.domNode.style.filter="")},hide:function(z){this._onDeck&&this._onDeck[1]==z?this._onDeck=null:this.aroundNode===z&&(this.fadeIn.stop(),this.isShowingNow=!1,this.aroundNode=
null,this.fadeOut.play());this.onMouseEnter=this.onMouseLeave=r},_onHide:function(){this.domNode.style.cssText="";this.containerNode.innerHTML="";this._onDeck&&(this.show.apply(this,this._onDeck),this._onDeck=null)}});m("dojo-bidi")&&u.extend({_setAutoTextDir:function(z){this.applyTextDir(z);b.forEach(z.children,function(A){this._setAutoTextDir(A)},this)},_setTextDirAttr:function(z){this._set("textDir",z);"auto"==z?this._setAutoTextDir(this.containerNode):this.containerNode.dir=this.textDir}});t.showTooltip=
function(z,A,C,E,B,D,F){C&&(C=b.map(C,function(K){return{after:"after-centered",before:"before-centered"}[K]||K}));y._masterTT||(t._masterTT=y._masterTT=new u);return y._masterTT.show(z,A,C,E,B,D,F)};t.hideTooltip=function(z){return y._masterTT&&y._masterTT.hide(z)};var y=a("dijit.Tooltip",v,{label:"",showDelay:400,hideDelay:400,connectId:[],position:[],selector:"",_setConnectIdAttr:function(z){b.forEach(this._connections||[],function(A){b.forEach(A,function(C){C.remove()})},this);this._connectIds=
b.filter(g.isArrayLike(z)?z:z?[z]:[],function(A){return d.byId(A,this.ownerDocument)},this);this._connections=b.map(this._connectIds,function(A){A=d.byId(A,this.ownerDocument);var C=this.selector,E=C?function(D){return e.selector(C,D)}:function(D){return D},B=this;return[e(A,E(q.enter),function(){B._onHover(this)}),e(A,E("focusin"),function(){B._onHover(this)}),e(A,E(q.leave),g.hitch(B,"_onUnHover")),e(A,E("focusout"),g.hitch(B,"set","state","DORMANT"))]},this);this._set("connectId",z)},addTarget:function(z){z=
z.id||z;-1==b.indexOf(this._connectIds,z)&&this.set("connectId",this._connectIds.concat(z))},removeTarget:function(z){z=b.indexOf(this._connectIds,z.id||z);0<=z&&(this._connectIds.splice(z,1),this.set("connectId",this._connectIds))},buildRendering:function(){this.inherited(arguments);f.add(this.domNode,"dijitTooltipData")},startup:function(){this.inherited(arguments);var z=this.connectId;b.forEach(g.isArrayLike(z)?z:[z],this.addTarget,this)},getContent:function(z){return this.label||this.domNode.innerHTML},
state:"DORMANT",_setStateAttr:function(z){if(!(this.state==z||"SHOW TIMER"==z&&"SHOWING"==this.state||"HIDE TIMER"==z&&"DORMANT"==this.state)){this._hideTimer&&(this._hideTimer.remove(),delete this._hideTimer);this._showTimer&&(this._showTimer.remove(),delete this._showTimer);switch(z){case "DORMANT":this._connectNode&&(y.hide(this._connectNode),delete this._connectNode,this.onHide());break;case "SHOW TIMER":"SHOWING"!=this.state&&(this._showTimer=this.defer(function(){this.set("state","SHOWING")},
this.showDelay));break;case "SHOWING":var A=this.getContent(this._connectNode);if(!A){this.set("state","DORMANT");return}y.show(A,this._connectNode,this.position,!this.isLeftToRight(),this.textDir,g.hitch(this,"set","state","SHOWING"),g.hitch(this,"set","state","HIDE TIMER"));this.onShow(this._connectNode,this.position);break;case "HIDE TIMER":this._hideTimer=this.defer(function(){this.set("state","DORMANT")},this.hideDelay)}this._set("state",z)}},_onHover:function(z){this._connectNode&&z!=this._connectNode&&
this.set("state","DORMANT");this._connectNode=z;this.set("state","SHOW TIMER")},_onUnHover:function(z){this.set("state","HIDE TIMER")},open:function(z){this.set("state","DORMANT");this._connectNode=z;this.set("state","SHOWING")},close:function(){this.set("state","DORMANT")},onShow:function(){},onHide:function(){},destroy:function(){this.set("state","DORMANT");b.forEach(this._connections||[],function(z){b.forEach(z,function(A){A.remove()})},this);this.inherited(arguments)}});y._MasterTooltip=u;y.show=
t.showTooltip;y.hide=t.hideTooltip;y.defaultPosition=["after-centered","before-centered"];return y})},"dijit/form/NumberSpinner":function(){define(["dojo/_base/declare","dojo/keys","./_Spinner","./NumberTextBox"],function(b,a,c,d){return b("dijit.form.NumberSpinner",[c,d.Mixin],{baseClass:"dijitTextBox dijitSpinner dijitNumberTextBox",adjust:function(f,n){var k=this.constraints,g=isNaN(f),q=!isNaN(k.max),e=!isNaN(k.min);g&&0!=n&&(f=0<n?e?k.min:q?k.max:0:q?this.constraints.max:e?k.min:0);n=f+n;if(g||
isNaN(n))return f;q&&n>k.max&&(n=k.max);e&&n<k.min&&(n=k.min);return n},_onKeyDown:function(f){if(!(this.disabled||this.readOnly||f.keyCode!=a.HOME&&f.keyCode!=a.END||f.ctrlKey||f.altKey||f.metaKey||"undefined"==typeof this.get("value"))){var n=this.constraints[f.keyCode==a.HOME?"min":"max"];"number"==typeof n&&this._setValueAttr(n,!1);f.stopPropagation();f.preventDefault()}}})})},"dijit/form/_Spinner":function(){define("dojo/_base/declare dojo/keys dojo/_base/lang dojo/sniff dojo/mouse dojo/on ../typematic ./RangeBoundTextBox dojo/text!./templates/Spinner.html ./_TextBoxMixin".split(" "),
function(b,a,c,d,f,n,k,g,q,e){return b("dijit.form._Spinner",g,{defaultTimeout:500,minimumTimeout:10,timeoutChangeRate:.9,smallDelta:1,largeDelta:10,templateString:q,baseClass:"dijitTextBox dijitSpinner",cssStateNodes:{upArrowNode:"dijitUpArrowButton",downArrowNode:"dijitDownArrowButton"},adjust:function(m){return m},_arrowPressed:function(m,l,w){this.disabled||this.readOnly||(this._setValueAttr(this.adjust(this.get("value"),l*w),!1),e.selectInputText(this.textbox,this.textbox.value.length))},_arrowReleased:function(){this._wheelTimer=
null},_typematicCallback:function(m,l,w){var v=this.smallDelta;l==this.textbox&&(l=w.keyCode,v=l==a.PAGE_UP||l==a.PAGE_DOWN?this.largeDelta:this.smallDelta,l=l==a.UP_ARROW||l==a.PAGE_UP?this.upArrowNode:this.downArrowNode);-1==m?this._arrowReleased(l):this._arrowPressed(l,l==this.upArrowNode?1:-1,v)},_wheelTimer:null,_mouseWheeled:function(m){if(this.focused){m.stopPropagation();m.preventDefault();var l=m.wheelDelta/120;Math.floor(l)!=l&&(l=0<m.wheelDelta?1:-1);m=m.detail?-1*m.detail:l;if(0!==m){var w=
this[0<m?"upArrowNode":"downArrowNode"];this._arrowPressed(w,m,this.smallDelta);this._wheelTimer&&this._wheelTimer.remove();this._wheelTimer=this.defer(function(){this._arrowReleased(w)},50)}}},_setConstraintsAttr:function(m){this.inherited(arguments);this.focusNode&&(void 0!==this.constraints.min?this.focusNode.setAttribute("aria-valuemin",this.constraints.min):this.focusNode.removeAttribute("aria-valuemin"),void 0!==this.constraints.max?this.focusNode.setAttribute("aria-valuemax",this.constraints.max):
this.focusNode.removeAttribute("aria-valuemax"))},_setValueAttr:function(m,l){this.focusNode.setAttribute("aria-valuenow",m);this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this.own(n(this.domNode,f.wheel,c.hitch(this,"_mouseWheeled")),k.addListener(this.upArrowNode,this.textbox,{keyCode:a.UP_ARROW,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),k.addListener(this.downArrowNode,this.textbox,
{keyCode:a.DOWN_ARROW,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),k.addListener(this.upArrowNode,this.textbox,{keyCode:a.PAGE_UP,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),k.addListener(this.downArrowNode,this.textbox,{keyCode:a.PAGE_DOWN,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,
this.defaultTimeout,this.minimumTimeout))}})})},"dijit/typematic":function(){define("dojo/_base/array dojo/_base/connect dojo/_base/lang dojo/on dojo/sniff ./main".split(" "),function(b,a,c,d,f,n){var k=n.typematic={_fireEventAndReload:function(){this._timer=null;this._callback(++this._count,this._node,this._evt);this._currentTimeout=Math.max(0>this._currentTimeout?this._initialDelay:1<this._subsequentDelay?this._subsequentDelay:Math.round(this._currentTimeout*this._subsequentDelay),this._minDelay);
this._timer=setTimeout(c.hitch(this,"_fireEventAndReload"),this._currentTimeout)},trigger:function(g,q,e,m,l,w,v,x){if(l!=this._obj){this.stop();this._initialDelay=v||500;this._subsequentDelay=w||.9;this._minDelay=x||10;this._obj=l;this._node=e;this._count=this._currentTimeout=-1;this._callback=c.hitch(q,m);this._evt={faux:!0};for(var p in g)"layerX"!=p&&"layerY"!=p&&(q=g[p],"function"!=typeof q&&"undefined"!=typeof q&&(this._evt[p]=q));this._fireEventAndReload()}},stop:function(){this._timer&&(clearTimeout(this._timer),
this._timer=null);this._obj&&(this._callback(-1,this._node,this._evt),this._obj=null)},addKeyListener:function(g,q,e,m,l,w,v){var x="keyCode"in q?"keyCode":"charCode"in q?"charCode":"charOrCode",p=[d(g,"keyCode"in q?"keydown":"charCode"in q?"keypress":a._keypress,c.hitch(this,function(h){h[x]!=q[x]||void 0!==q.ctrlKey&&q.ctrlKey!=h.ctrlKey||void 0!==q.altKey&&q.altKey!=h.altKey||void 0!==q.metaKey&&q.metaKey!=(h.metaKey||!1)||void 0!==q.shiftKey&&q.shiftKey!=h.shiftKey?k._obj==q&&k.stop():(h.stopPropagation(),
h.preventDefault(),k.trigger(h,e,g,m,q,l,w,v))})),d(g,"keyup",c.hitch(this,function(){k._obj==q&&k.stop()}))];return{remove:function(){b.forEach(p,function(h){h.remove()})}}},addMouseListener:function(g,q,e,m,l,w){var v=[d(g,"mousedown",c.hitch(this,function(x){x.preventDefault();k.trigger(x,q,g,e,g,m,l,w)})),d(g,"mouseup",c.hitch(this,function(x){this._obj&&x.preventDefault();k.stop()})),d(g,"mouseout",c.hitch(this,function(x){this._obj&&x.preventDefault();k.stop()})),d(g,"dblclick",c.hitch(this,
function(x){x.preventDefault();9>f("ie")&&(k.trigger(x,q,g,e,g,m,l,w),setTimeout(c.hitch(this,k.stop),50))}))];return{remove:function(){b.forEach(v,function(x){x.remove()})}}},addListener:function(g,q,e,m,l,w,v,x){var p=[this.addKeyListener(q,e,m,l,w,v,x),this.addMouseListener(g,m,l,w,v,x)];return{remove:function(){b.forEach(p,function(h){h.remove()})}}}};return k})},"dijit/form/RangeBoundTextBox":function(){define(["dojo/_base/declare","dojo/i18n","./MappedTextBox","dojo/i18n!./nls/validate"],function(b,
a,c){return b("dijit.form.RangeBoundTextBox",c,{rangeMessage:"",rangeCheck:function(d,f){return("min"in f?0<=this.compare(d,f.min):!0)&&("max"in f?0>=this.compare(d,f.max):!0)},isInRange:function(){return this.rangeCheck(this.get("value"),this.constraints)},_isDefinitelyOutOfRange:function(){var d=this.get("value");if(null==d)return!1;var f=!1;"min"in this.constraints&&(f=this.constraints.min,f=0>this.compare(d,"number"==typeof f&&0<=f&&0!=d?0:f));!f&&"max"in this.constraints&&(f=this.constraints.max,
f=0<this.compare(d,"number"!=typeof f||0<f?f:0));return f},_isValidSubset:function(){return this.inherited(arguments)&&!this._isDefinitelyOutOfRange()},isValid:function(d){return this.inherited(arguments)&&(this._isEmpty(this.textbox.value)&&!this.required||this.isInRange(d))},getErrorMessage:function(d){var f=this.get("value");return null==f||""===f||"number"==typeof f&&isNaN(f)||this.isInRange(d)?this.inherited(arguments):this.rangeMessage},postMixInProperties:function(){this.inherited(arguments);
this.rangeMessage||(this.messages=a.getLocalization("dijit.form","validate",this.lang),this.rangeMessage=this.messages.rangeMessage)}})})},"dijit/form/MappedTextBox":function(){define(["dojo/_base/declare","dojo/sniff","dojo/dom-construct","./ValidationTextBox"],function(b,a,c,d){return b("dijit.form.MappedTextBox",d,{postMixInProperties:function(){this.inherited(arguments);this.nameAttrSetting=""},_setNameAttr:"valueNode",serialize:function(f){return f.toString?f.toString():""},toString:function(){var f=
this.filter(this.get("value"));return null!=f?"string"==typeof f?f:this.serialize(f,this.constraints):""},validate:function(){this.valueNode.value=this.toString();return this.inherited(arguments)},buildRendering:function(){this.inherited(arguments);this.valueNode=c.place("\x3cinput type\x3d'hidden'"+(this.name?' name\x3d"'+this.name.replace(/"/g,"\x26quot;")+'"':"")+"/\x3e",this.textbox,"after")},reset:function(){this.valueNode.value="";this.inherited(arguments)}})})},"dijit/form/ValidationTextBox":function(){define("dojo/_base/declare dojo/_base/kernel dojo/_base/lang dojo/i18n ./TextBox ../Tooltip dojo/text!./templates/ValidationTextBox.html dojo/i18n!./nls/validate".split(" "),
function(b,a,c,d,f,n,k){var g=b("dijit.form.ValidationTextBox",f,{templateString:k,required:!1,promptMessage:"",invalidMessage:"$_unset_$",missingMessage:"$_unset_$",message:"",constraints:{},pattern:".*",regExp:"",regExpGen:function(){},state:"",tooltipPosition:[],_deprecateRegExp:function(q,e){e!=g.prototype[q]&&(a.deprecated("ValidationTextBox id\x3d"+this.id+", set('"+q+"', ...) is deprecated.  Use set('pattern', ...) instead.","","2.0"),this.set("pattern",e))},_setRegExpGenAttr:function(q){this._deprecateRegExp("regExpGen",
q);this._set("regExpGen",this._computeRegexp)},_setRegExpAttr:function(q){this._deprecateRegExp("regExp",q)},_setValueAttr:function(){this.inherited(arguments);this._refreshState()},validator:function(q,e){return(new RegExp("^(?:"+this._computeRegexp(e)+")"+(this.required?"":"?")+"$")).test(q)&&(!this.required||!this._isEmpty(q))&&(this._isEmpty(q)||void 0!==this.parse(q,e))},_isValidSubset:function(){return 0==this.textbox.value.search(this._partialre)},isValid:function(){return this.validator(this.textbox.value,
this.get("constraints"))},_isEmpty:function(q){return(this.trim?/^\s*$/:/^$/).test(q)},getErrorMessage:function(){var q="$_unset_$"==this.invalidMessage?this.messages.invalidMessage:this.invalidMessage?this.invalidMessage:this.promptMessage,e="$_unset_$"==this.missingMessage?this.messages.missingMessage:this.missingMessage?this.missingMessage:q;return this.required&&this._isEmpty(this.textbox.value)?e:q},getPromptMessage:function(){return this.promptMessage},_maskValidSubsetError:!0,validate:function(q){var e=
"",m=this.disabled||this.isValid(q);m&&(this._maskValidSubsetError=!0);var l=this._isEmpty(this.textbox.value),w=!m&&q&&this._isValidSubset();this._set("state",m?"":((!this._hasBeenBlurred||q)&&l||w)&&(this._maskValidSubsetError||w&&!this._hasBeenBlurred&&q)?"Incomplete":"Error");this.focusNode.setAttribute("aria-invalid","Error"==this.state?"true":"false");"Error"==this.state?(this._maskValidSubsetError=q&&w,e=this.getErrorMessage(q)):"Incomplete"==this.state?(e=this.getPromptMessage(q),this._maskValidSubsetError=
!this._hasBeenBlurred||q):l&&(e=this.getPromptMessage(q));this.set("message",e);return m},displayMessage:function(q){q&&this.focused?n.show(q,this.domNode,this.tooltipPosition,!this.isLeftToRight()):n.hide(this.domNode)},_refreshState:function(){this._created&&this.validate(this.focused);this.inherited(arguments)},constructor:function(q){this.constraints=c.clone(this.constraints);this.baseClass+=" dijitValidationTextBox"},startup:function(){this.inherited(arguments);this._refreshState()},_setConstraintsAttr:function(q){!q.locale&&
this.lang&&(q.locale=this.lang);this._set("constraints",q);this._refreshState()},_setPatternAttr:function(q){this._set("pattern",q);this._refreshState()},_computeRegexp:function(q){var e=this.pattern;"function"==typeof e&&(e=e.call(this,q));if(e!=this._lastRegExp){var m="";this._lastRegExp=e;".*"!=e&&e.replace(/\\.|\[\]|\[.*?[^\\]{1}\]|\{.*?\}|\(\?[=:!]|./g,function(l){switch(l.charAt(0)){case "{":case "+":case "?":case "*":case "^":case "$":case "|":case "(":m+=l;break;case ")":m+="|$)";break;default:m+=
"(?:"+l+"|$)"}});try{"".search(m)}catch(l){m=this.pattern,console.warn("RegExp error in "+this.declaredClass+": "+this.pattern)}this._partialre="^(?:"+m+")$"}return e},postMixInProperties:function(){this.inherited(arguments);this.messages=d.getLocalization("dijit.form","validate",this.lang);this._setConstraintsAttr(this.constraints)},_setDisabledAttr:function(q){this.inherited(arguments);this._refreshState()},_setRequiredAttr:function(q){this._set("required",q);this.focusNode.setAttribute("aria-required",
q);this._refreshState()},_setMessageAttr:function(q){this._set("message",q);this.displayMessage(q)},reset:function(){this._maskValidSubsetError=!0;this.inherited(arguments)},_onBlur:function(){this.displayMessage("");this.inherited(arguments)},destroy:function(){n.hide(this.domNode);this.inherited(arguments)}});return g})},"dijit/form/TextBox":function(){define("dojo/_base/declare dojo/dom-construct dojo/dom-style dojo/_base/kernel dojo/_base/lang dojo/on dojo/sniff ./_FormValueWidget ./_TextBoxMixin dojo/text!./templates/TextBox.html ../main".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m){g=b("dijit.form.TextBox"+(k("dojo-bidi")?"_NoBidi":""),[g,q],{templateString:e,_singleNodeTemplate:'\x3cinput class\x3d"dijit dijitReset dijitLeft dijitInputField" data-dojo-attach-point\x3d"textbox,focusNode" autocomplete\x3d"off" type\x3d"${type}" ${!nameAttrSetting} /\x3e',_buttonInputDisabled:k("ie")?"disabled":"",baseClass:"dijitTextBox",postMixInProperties:function(){var l=this.type.toLowerCase();if(this.templateString&&"input"==this.templateString.toLowerCase()||
("hidden"==l||"file"==l)&&this.templateString==this.constructor.prototype.templateString)this.templateString=this._singleNodeTemplate;this.inherited(arguments)},postCreate:function(){this.inherited(arguments);9>k("ie")&&this.defer(function(){try{var l=c.getComputedStyle(this.domNode);if(l){var w=l.fontFamily;if(w){var v=this.domNode.getElementsByTagName("INPUT");if(v)for(l=0;l<v.length;l++)v[l].style.fontFamily=w}}}catch(x){}})},_setPlaceHolderAttr:function(l){this._set("placeHolder",l);this._phspan||
(this._attachPoints.push("_phspan"),this._phspan=a.create("span",{className:"dijitPlaceHolder dijitInputField"},this.textbox,"after"),this.own(n(this._phspan,"mousedown",function(w){w.preventDefault()}),n(this._phspan,"touchend, pointerup, MSPointerUp",f.hitch(this,function(){this.focus()}))));this._phspan.innerHTML="";this._phspan.appendChild(this._phspan.ownerDocument.createTextNode(l));this._updatePlaceHolder()},_onInput:function(l){this.inherited(arguments);this._updatePlaceHolder()},_updatePlaceHolder:function(){this._phspan&&
(this._phspan.style.display=this.placeHolder&&!this.textbox.value?"":"none")},_setValueAttr:function(l,w,v){this.inherited(arguments);this._updatePlaceHolder()},getDisplayedValue:function(){d.deprecated(this.declaredClass+"::getDisplayedValue() is deprecated. Use get('displayedValue') instead.","","2.0");return this.get("displayedValue")},setDisplayedValue:function(l){d.deprecated(this.declaredClass+"::setDisplayedValue() is deprecated. Use set('displayedValue', ...) instead.","","2.0");this.set("displayedValue",
l)},_onBlur:function(l){this.disabled||(this.inherited(arguments),this._updatePlaceHolder(),this.selectOnClick&&(this.textbox.selectionStart=this.textbox.selectionEnd=void 0))},_onFocus:function(l){this.disabled||this.readOnly||(this.inherited(arguments),this._updatePlaceHolder())}});9>k("ie")&&(g.prototype._isTextSelected=function(){var l=this.ownerDocument.selection.createRange();return l.parentElement()==this.textbox&&0<l.text.length},m._setSelectionRange=q._setSelectionRange=function(l,w,v){l.createTextRange&&
(l=l.createTextRange(),l.collapse(!0),l.moveStart("character",-99999),l.moveStart("character",w),l.moveEnd("character",v-w),l.select())});k("dojo-bidi")&&(g=b("dijit.form.TextBox",g,{_setPlaceHolderAttr:function(l){this.inherited(arguments);this.applyTextDir(this._phspan)}}));return g})},"dijit/form/_TextBoxMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/sniff dojo/keys dojo/_base/lang dojo/on ../main".split(" "),function(b,a,c,d,f,n,k,g){var q=a("dijit.form._TextBoxMixin"+
(d("dojo-bidi")?"_NoBidi":""),null,{trim:!1,uppercase:!1,lowercase:!1,propercase:!1,maxLength:"",selectOnClick:!1,placeHolder:"",_getValueAttr:function(){return this.parse(this.get("displayedValue"),this.constraints)},_setValueAttr:function(e,m,l){if(void 0!==e){var w=this.filter(e);"string"!=typeof l&&(l=null===w||"number"==typeof w&&isNaN(w)?"":this.filter(this.format(w,this.constraints)),0!=this.compare(w,this.filter(this.parse(l,this.constraints)))&&(l=null))}null==l||"number"==typeof l&&isNaN(l)||
this.textbox.value==l||(this.textbox.value=l,this._set("displayedValue",this.get("displayedValue")));this.inherited(arguments,[w,m])},displayedValue:"",_getDisplayedValueAttr:function(){return this.filter(this.textbox.value)},_setDisplayedValueAttr:function(e){null==e?e="":"string"!=typeof e&&(e=String(e));this.textbox.value=e;this._setValueAttr(this.get("value"),void 0);this._set("displayedValue",this.get("displayedValue"))},format:function(e){return null==e?"":e.toString?e.toString():e},parse:function(e){return e},
_refreshState:function(){},onInput:function(){},_onInput:function(e){this._lastInputEventValue=this.textbox.value;this._processInput(this._lastInputProducingEvent||e);delete this._lastInputProducingEvent;this.intermediateChanges&&this._handleOnChange(this.get("value"),!1)},_processInput:function(){this._refreshState();this._set("displayedValue",this.get("displayedValue"))},postCreate:function(){this.textbox.setAttribute("value",this.textbox.value);this.inherited(arguments);this.own(k(this.textbox,
"keydown, keypress, paste, cut, compositionend",n.hitch(this,function(e){if("keydown"==e.type&&229!=e.keyCode){var m=e.keyCode;switch(m){case f.SHIFT:case f.ALT:case f.CTRL:case f.META:case f.CAPS_LOCK:case f.NUM_LOCK:case f.SCROLL_LOCK:return}if(!e.ctrlKey&&!e.metaKey&&!e.altKey){switch(m){case f.NUMPAD_0:case f.NUMPAD_1:case f.NUMPAD_2:case f.NUMPAD_3:case f.NUMPAD_4:case f.NUMPAD_5:case f.NUMPAD_6:case f.NUMPAD_7:case f.NUMPAD_8:case f.NUMPAD_9:case f.NUMPAD_MULTIPLY:case f.NUMPAD_PLUS:case f.NUMPAD_ENTER:case f.NUMPAD_MINUS:case f.NUMPAD_PERIOD:case f.NUMPAD_DIVIDE:return}if(65<=
m&&90>=m||48<=m&&57>=m||m==f.SPACE)return;m=!1;for(var l in f)if(f[l]===e.keyCode){m=!0;break}if(!m)return}}(m=32<=e.charCode?String.fromCharCode(e.charCode):e.charCode)||(m=65<=e.keyCode&&90>=e.keyCode||48<=e.keyCode&&57>=e.keyCode||e.keyCode==f.SPACE?String.fromCharCode(e.keyCode):e.keyCode);m||(m=229);if("keypress"==e.type){if("string"!=typeof m)return;if("a"<=m&&"z">=m||"A"<=m&&"Z">=m||"0"<=m&&"9">=m||" "===m)if(e.ctrlKey||e.metaKey||e.altKey)return}var w={faux:!0},v;for(v in e)/^(layer[XY]|returnValue|keyLocation)$/.test(v)||
(l=e[v],"function"!=typeof l&&"undefined"!=typeof l&&(w[v]=l));n.mixin(w,{charOrCode:m,_wasConsumed:!1,preventDefault:function(){w._wasConsumed=!0;e.preventDefault()},stopPropagation:function(){e.stopPropagation()}});this._lastInputProducingEvent=w;!1===this.onInput(w)&&(w.preventDefault(),w.stopPropagation());if(!w._wasConsumed&&9>=d("ie"))switch(e.keyCode){case f.TAB:case f.ESCAPE:case f.DOWN_ARROW:case f.UP_ARROW:case f.LEFT_ARROW:case f.RIGHT_ARROW:break;default:e.keyCode==f.ENTER&&"textarea"!=
this.textbox.tagName.toLowerCase()||this.defer(function(){this.textbox.value!==this._lastInputEventValue&&k.emit(this.textbox,"input",{bubbles:!0})})}})),k(this.textbox,"input",n.hitch(this,"_onInput")),k(this.domNode,"keypress",function(e){e.stopPropagation()}))},_blankValue:"",filter:function(e){if(null===e)return this._blankValue;if("string"!=typeof e)return e;this.trim&&(e=n.trim(e));this.uppercase&&(e=e.toUpperCase());this.lowercase&&(e=e.toLowerCase());this.propercase&&(e=e.replace(/[^\s]+/g,
function(m){return m.substring(0,1).toUpperCase()+m.substring(1)}));return e},_setBlurValue:function(){this._setValueAttr(this.get("value"),!0)},_onBlur:function(e){this.disabled||(this._setBlurValue(),this.inherited(arguments))},_isTextSelected:function(){return this.textbox.selectionStart!=this.textbox.selectionEnd},_onFocus:function(e){this.disabled||this.readOnly||(this.selectOnClick&&"mouse"==e&&(this._selectOnClickHandle=k.once(this.domNode,"mouseup, touchend",n.hitch(this,function(m){this._isTextSelected()||
q.selectInputText(this.textbox)})),this.own(this._selectOnClickHandle),this.defer(function(){this._selectOnClickHandle&&(this._selectOnClickHandle.remove(),this._selectOnClickHandle=null)},500)),this.inherited(arguments),this._refreshState())},reset:function(){this.textbox.value="";this.inherited(arguments)}});d("dojo-bidi")&&(q=a("dijit.form._TextBoxMixin",q,{_setValueAttr:function(){this.inherited(arguments);this.applyTextDir(this.focusNode)},_setDisplayedValueAttr:function(){this.inherited(arguments);
this.applyTextDir(this.focusNode)},_onInput:function(){this.applyTextDir(this.focusNode);this.inherited(arguments)}}));q._setSelectionRange=g._setSelectionRange=function(e,m,l){e.setSelectionRange&&e.setSelectionRange(m,l)};q.selectInputText=g.selectInputText=function(e,m,l){e=c.byId(e);isNaN(m)&&(m=0);isNaN(l)&&(l=e.value?e.value.length:0);try{e.focus(),q._setSelectionRange(e,m,l)}catch(w){}};return q})},"dijit/form/NumberTextBox":function(){define("dojo/_base/declare dojo/_base/lang dojo/i18n dojo/string dojo/number ./RangeBoundTextBox".split(" "),
function(b,a,c,d,f,n){var k=function(q){q=q||{};var e=c.getLocalization("dojo.cldr","number",c.normalizeLocale(q.locale)),m=q.pattern?q.pattern:e[(q.type||"decimal")+"Format"];q="number"==typeof q.places?q.places:"string"===typeof q.places&&0<q.places.length?q.places.replace(/.*,/,""):-1!=m.indexOf(".")?m.split(".")[1].replace(/[^#0]/g,"").length:0;return{sep:e.decimal,places:q}},g=b("dijit.form.NumberTextBoxMixin",null,{pattern:function(q){return"("+(this.focused&&this.editOptions?this._regExpGenerator(a.delegate(q,
this.editOptions))+"|":"")+this._regExpGenerator(q)+")"},value:NaN,editOptions:{pattern:"#.######"},_formatter:f.format,_regExpGenerator:f.regexp,_decimalInfo:k(),postMixInProperties:function(){this.inherited(arguments);this._set("type","text")},_setConstraintsAttr:function(q){var e="number"==typeof q.places?q.places:0;e&&e++;"number"!=typeof q.max&&(q.max=9*Math.pow(10,15-e));"number"!=typeof q.min&&(q.min=-9*Math.pow(10,15-e));this.inherited(arguments,[q]);this.focusNode&&this.focusNode.value&&
!isNaN(this.value)&&this.set("value",this.value);this._decimalInfo=k(q)},_onFocus:function(q){if(!this.disabled&&!this.readOnly){var e=this.get("value");"number"!=typeof e||isNaN(e)||(e=this.format(e,this.constraints),void 0!==e&&(this.textbox.value=e,"mouse"!==q&&this.textbox.select()));this.inherited(arguments)}},format:function(q,e){var m=String(q);if("number"!=typeof q)return m;if(isNaN(q))return"";if(!("rangeCheck"in this&&this.rangeCheck(q,e))&&!1!==e.exponent&&/\de[-+]?\d/i.test(m))return m;
this.editOptions&&this.focused&&(e=a.mixin({},e,this.editOptions));return this._formatter(q,e)},_parser:f.parse,parse:function(q,e){var m=a.mixin({},e,this.editOptions&&this.focused?this.editOptions:{});if(this.focused&&null!=m.places){var l=m.places;l="number"===typeof l?l:Number(l.split(",").pop());m.places="0,"+l}m=this._parser(q,m);this.editOptions&&this.focused&&isNaN(m)&&(m=this._parser(q,e));return m},_getDisplayedValueAttr:function(){var q=this.inherited(arguments);return isNaN(q)?this.textbox.value:
q},filter:function(q){if(null==q||"string"==typeof q&&""==q)return NaN;"number"!=typeof q||isNaN(q)||0==q||(q=f.round(q,this._decimalInfo.places));return this.inherited(arguments,[q])},serialize:function(q,e){return"number"!=typeof q||isNaN(q)?"":this.inherited(arguments)},_setBlurValue:function(){var q=a.hitch(a.delegate(this,{focused:!0}),"get")("value");this._setValueAttr(q,!0)},_setValueAttr:function(q,e,m){if(void 0!==q&&void 0===m)if(m=String(q),"number"==typeof q)if(isNaN(q))m="";else{if("rangeCheck"in
this&&this.rangeCheck(q,this.constraints)||!1===this.constraints.exponent||!/\de[-+]?\d/i.test(m))m=void 0}else q?q=void 0:(m="",q=NaN);this.inherited(arguments,[q,e,m])},_getValueAttr:function(){var q=this.inherited(arguments);if(isNaN(q)&&""!==this.textbox.value){if(!1!==this.constraints.exponent&&/\de[-+]?\d/i.test(this.textbox.value)&&(new RegExp("^"+f._realNumberRegexp(a.delegate(this.constraints))+"$")).test(this.textbox.value))return q=Number(this.textbox.value),isNaN(q)?void 0:q}else return q},
isValid:function(q){if(!this.focused||this._isEmpty(this.textbox.value))return this.inherited(arguments);var e=this.get("value");return!isNaN(e)&&this.rangeCheck(e,this.constraints)?!1!==this.constraints.exponent&&/\de[-+]?\d/i.test(this.textbox.value)?!0:this.inherited(arguments):!1},_isValidSubset:function(){var q="number"==typeof this.constraints.min,e="number"==typeof this.constraints.max,m=this.get("value");if(isNaN(m)||!q&&!e)return this.inherited(arguments);var l=m|0,w=0>m,v=-1!=this.textbox.value.indexOf(this._decimalInfo.sep),
x=(this.maxLength||20)-this.textbox.value.length,p=v?this.textbox.value.split(this._decimalInfo.sep)[1].replace(/[^0-9]/g,""):"";l=v?l+"."+p:l+"";x=d.rep("9",x);v=m;w?v=Number(l+x):m=Number(l+x);return!(q&&m<this.constraints.min||e&&v>this.constraints.max)}});b=b("dijit.form.NumberTextBox",[n,g],{baseClass:"dijitTextBox dijitNumberTextBox"});b.Mixin=g;return b})},"dijit/ColorPalette":function(){define("require dojo/text!./templates/ColorPalette.html ./_Widget ./_TemplatedMixin ./_PaletteMixin ./hccss dojo/i18n dojo/_base/Color dojo/_base/declare dojo/dom-construct dojo/string dojo/i18n!dojo/nls/colors dojo/colors".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m){var l=q("dijit.ColorPalette",[c,d,f],{palette:"7x10",_palettes:{"7x10":["white seashell cornsilk lemonchiffon lightyellow palegreen paleturquoise lightcyan lavender plum".split(" "),"lightgray pink bisque moccasin khaki lightgreen lightseagreen lightskyblue cornflowerblue violet".split(" "),"silver lightcoral sandybrown orange palegoldenrod chartreuse mediumturquoise skyblue mediumslateblue orchid".split(" "),"gray red orangered darkorange yellow limegreen darkseagreen royalblue slateblue mediumorchid".split(" "),
"dimgray crimson chocolate coral gold forestgreen seagreen blue blueviolet darkorchid".split(" "),"darkslategray firebrick saddlebrown sienna olive green darkcyan mediumblue darkslateblue darkmagenta".split(" "),"black darkred maroon brown darkolivegreen darkgreen midnightblue navy indigo purple".split(" ")],"3x4":[["white","lime","green","blue"],["silver","yellow","fuchsia","navy"],["gray","red","purple","black"]]},templateString:a,baseClass:"dijitColorPalette",_dyeFactory:function(w,v,x,p){return new this._dyeClass(w,
v,x,p)},buildRendering:function(){this.inherited(arguments);this._dyeClass=q(l._Color,{palette:this.palette});this._preparePalette(this._palettes[this.palette],k.getLocalization("dojo","colors",this.lang))}});l._Color=q("dijit._Color",g,{template:"\x3cspan class\x3d'dijitInline dijitPaletteImg'\x3e\x3cimg src\x3d'${blankGif}' alt\x3d'${alt}' title\x3d'${title}' class\x3d'dijitColorPaletteSwatch' style\x3d'background-color: ${color}'/\x3e\x3c/span\x3e",hcTemplate:"\x3cspan class\x3d'dijitInline dijitPaletteImg' style\x3d'position: relative; overflow: hidden; height: 12px; width: 14px;'\x3e\x3cimg src\x3d'${image}' alt\x3d'${alt}' title\x3d'${title}' style\x3d'position: absolute; left: ${left}px; top: ${top}px; ${size}'/\x3e\x3c/span\x3e",
_imagePaths:{"7x10":b.toUrl("./themes/a11y/colors7x10.png"),"3x4":b.toUrl("./themes/a11y/colors3x4.png")},constructor:function(w,v,x,p){this._title=p;this._row=v;this._col=x;this.setColor(g.named[w])},getValue:function(){return this.toHex()},fillCell:function(w,v){v=m.substitute(n("highcontrast")?this.hcTemplate:this.template,{color:this.toHex(),blankGif:v,alt:this._title,title:this._title,image:this._imagePaths[this.palette].toString(),left:-20*this._col-5,top:-20*this._row-5,size:"7x10"==this.palette?
"height: 145px; width: 206px":"height: 64px; width: 86px"});e.place(v,w)}});return l})},"dijit/_PaletteMixin":function(){define("dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/keys dojo/_base/lang dojo/on ./_CssStateMixin ./a11yclick ./focus ./typematic".split(" "),function(b,a,c,d,f,n,k,g,q,e,m){return b("dijit._PaletteMixin",g,{defaultTimeout:500,timeoutChangeRate:.9,value:"",_selectedCell:-1,tabIndex:"0",cellClass:"dijitPaletteCell",dyeClass:null,_dyeFactory:function(l){return new ("string"==
typeof this.dyeClass?n.getObject(this.dyeClass):this.dyeClass)(l)},_preparePalette:function(l,w){this._cells=[];var v=this._blankGif;this.own(k(this.gridNode,q,n.hitch(this,"_onCellClick")));for(var x=0;x<l.length;x++)for(var p=d.create("tr",{tabIndex:"-1",role:"row"},this.gridNode),h=0;h<l[x].length;h++){var t=l[x][h];if(t){var r=this._dyeFactory(t,x,h,w[t]);t=d.create("td",{"class":this.cellClass,tabIndex:"-1",title:w[t],role:"gridcell"},p);r.fillCell(t,v);t.idx=this._cells.length;this._cells.push({node:t,
dye:r})}}this._xDim=l[0].length;this._yDim=l.length;var u={UP_ARROW:-this._xDim,DOWN_ARROW:this._xDim,RIGHT_ARROW:this.isLeftToRight()?1:-1,LEFT_ARROW:this.isLeftToRight()?-1:1},y;for(y in u)this.own(m.addKeyListener(this.domNode,{keyCode:f[y],ctrlKey:!1,altKey:!1,shiftKey:!1},this,function(){var z=u[y];return function(A){this._navigateByKey(z,A)}}(),this.timeoutChangeRate,this.defaultTimeout))},postCreate:function(){this.inherited(arguments);this._setCurrent(this._cells[0].node)},focus:function(){e.focus(this._currentFocus)},
_onCellClick:function(l){for(var w=l.target;"TD"!=w.tagName;){if(!w.parentNode||w==this.gridNode)return;w=w.parentNode}var v=this._getDye(w).getValue();this._setCurrent(w);e.focus(w);this._setValueAttr(v,!0);l.stopPropagation();l.preventDefault()},_setCurrent:function(l){"_currentFocus"in this&&a.set(this._currentFocus,"tabIndex","-1");(this._currentFocus=l)&&a.set(l,"tabIndex",this.tabIndex)},_setValueAttr:function(l,w){0<=this._selectedCell&&c.remove(this._cells[this._selectedCell].node,this.cellClass+
"Selected");this._selectedCell=-1;if(l)for(var v=0;v<this._cells.length;v++)if(l==this._cells[v].dye.getValue()){this._selectedCell=v;c.add(this._cells[v].node,this.cellClass+"Selected");break}this._set("value",0<=this._selectedCell?l:null);if(w||void 0===w)this.onChange(l)},onChange:function(){},_navigateByKey:function(l,w){-1!=w&&(l=this._currentFocus.idx+l,l<this._cells.length&&-1<l&&(l=this._cells[l].node,this._setCurrent(l),this.defer(n.hitch(e,"focus",l))))},_getDye:function(l){return this._cells[l.idx].dye}})})},
"dojo/colors":function(){define(["./_base/kernel","./_base/lang","./_base/Color","./_base/array"],function(b,a,c,d){var f={};a.setObject("dojo.colors",f);var n=function(g,q,e){0>e&&++e;1<e&&--e;var m=6*e;return 1>m?g+(q-g)*m:1>2*e?q:2>3*e?g+(q-g)*(2/3-e)*6:g};b.colorFromRgb=c.fromRgb=function(g,q){var e=g.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(e){g=e[2].split(/\s*,\s*/);var m=g.length;e=e[1];if("rgb"==e&&3==m||"rgba"==e&&4==m)return e=g[0],"%"==e.charAt(e.length-1)?(e=d.map(g,
function(v){return 2.56*parseFloat(v)}),4==m&&(e[3]=g[3]),c.fromArray(e,q)):c.fromArray(g,q);if("hsl"==e&&3==m||"hsla"==e&&4==m){e=(parseFloat(g[0])%360+360)%360/360;var l=parseFloat(g[1])/100,w=parseFloat(g[2])/100;l=.5>=w?w*(l+1):w+l-w*l;w=2*w-l;e=[256*n(w,l,e+1/3),256*n(w,l,e),256*n(w,l,e-1/3),1];4==m&&(e[3]=g[3]);return c.fromArray(e,q)}}return null};var k=function(g,q,e){g=Number(g);return isNaN(g)?e:g<q?q:g>e?e:g};c.prototype.sanitize=function(){this.r=Math.round(k(this.r,0,255));this.g=Math.round(k(this.g,
0,255));this.b=Math.round(k(this.b,0,255));this.a=k(this.a,0,1);return this};f.makeGrey=c.makeGrey=function(g,q){return c.fromArray([g,g,g,q])};a.mixin(c.named,{aliceblue:[240,248,255],antiquewhite:[250,235,215],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],blanchedalmond:[255,235,205],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,
149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,
0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],
lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,
0,255],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],oldlace:[253,245,230],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,
232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,
250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],whitesmoke:[245,245,245],yellowgreen:[154,205,50]});return c})},"dijit/form/HorizontalSlider":function(){define("dojo/_base/array dojo/_base/declare dojo/dnd/move dojo/_base/fx dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/sniff dojo/dnd/Moveable dojo/dnd/Mover dojo/query dojo/mouse dojo/on ../_base/manager ../focus ../typematic ./Button ./_FormValueWidget ../_Container dojo/text!./templates/HorizontalSlider.html".split(" "),
function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y){var z=a("dijit.form._SliderMover",m,{onMouseMove:function(A){var C=this.widget,E=C._abspos;E||(E=C._abspos=f.position(C.sliderBarContainer,!0),C._setPixelValue_=g.hitch(C,"_setPixelValue"),C._isReversed_=C._isReversed());A=A[C._mousePixelCoord]-E[C._startingPixelCoord];C._setPixelValue_(C._isReversed_?E[C._pixelCount]-A:A,E[C._pixelCount],!1)},destroy:function(A){m.prototype.destroy.apply(this,arguments);var C=this.widget;C._abspos=null;C._setValueAttr(C.value,
!0)}});c=a("dijit.form.HorizontalSlider",[r,u],{templateString:y,value:0,showButtons:!0,minimum:0,maximum:100,discreteValues:Infinity,pageIncrement:2,clickSelect:!0,slideDuration:x.defaultDuration,_setIdAttr:"",_setNameAttr:"valueNode",baseClass:"dijitSlider",cssStateNodes:{incrementButton:"dijitSliderIncrementButton",decrementButton:"dijitSliderDecrementButton",focusNode:"dijitSliderThumb"},_mousePixelCoord:"pageX",_pixelCount:"w",_startingPixelCoord:"x",_handleOffsetCoord:"left",_progressPixelSize:"width",
_onKeyUp:function(A){this.disabled||this.readOnly||A.altKey||A.ctrlKey||A.metaKey||this._setValueAttr(this.value,!0)},_onKeyDown:function(A){if(!(this.disabled||this.readOnly||A.altKey||A.ctrlKey||A.metaKey)){switch(A.keyCode){case k.HOME:this._setValueAttr(this.minimum,!1);break;case k.END:this._setValueAttr(this.maximum,!1);break;case this._descending||this.isLeftToRight()?k.RIGHT_ARROW:k.LEFT_ARROW:case !1===this._descending?k.DOWN_ARROW:k.UP_ARROW:case !1===this._descending?k.PAGE_DOWN:k.PAGE_UP:this.increment(A);
break;case this._descending||this.isLeftToRight()?k.LEFT_ARROW:k.RIGHT_ARROW:case !1===this._descending?k.UP_ARROW:k.DOWN_ARROW:case !1===this._descending?k.PAGE_UP:k.PAGE_DOWN:this.decrement(A);break;default:return}A.stopPropagation();A.preventDefault()}},_onHandleClick:function(A){this.disabled||this.readOnly||(q("ie")||p.focus(this.sliderHandle),A.stopPropagation(),A.preventDefault())},_isReversed:function(){return!this.isLeftToRight()},_onBarClick:function(A){if(!this.disabled&&!this.readOnly&&
this.clickSelect){p.focus(this.sliderHandle);A.stopPropagation();A.preventDefault();var C=f.position(this.sliderBarContainer,!0),E=A[this._mousePixelCoord]-C[this._startingPixelCoord];this._setPixelValue(this._isReversed()?C[this._pixelCount]-E:E,C[this._pixelCount],!0);this._movable.onMouseDown(A)}},_setPixelValue:function(A,C,E){if(!this.disabled&&!this.readOnly){var B=this.discreteValues;if(1>=B||Infinity==B)B=C;B--;this._setValueAttr(Math.max(Math.min((this.maximum-this.minimum)*Math.round(A/
(C/B))/B+this.minimum,this.maximum),this.minimum),E)}},_setValueAttr:function(A,C){this._set("value",A);this.valueNode.value=A;this.focusNode.setAttribute("aria-valuenow",A);this.inherited(arguments);var E=this.maximum>this.minimum?(A-this.minimum)/(this.maximum-this.minimum):0,B=!1===this._descending?this.remainingBar:this.progressBar,D=!1===this._descending?this.progressBar:this.remainingBar;this._inProgressAnim&&"stopped"!=this._inProgressAnim.status&&this._inProgressAnim.stop(!0);if(C&&0<this.slideDuration&&
B.style[this._progressPixelSize]){var F=this,K={},L=parseFloat(B.style[this._progressPixelSize]),G=this.slideDuration*(E-L/100);0!=G&&(0>G&&(G=0-G),K[this._progressPixelSize]={start:L,end:100*E,units:"%"},this._inProgressAnim=d.animateProperty({node:B,duration:G,onAnimate:function(O){D.style[F._progressPixelSize]=100-parseFloat(O[F._progressPixelSize])+"%"},onEnd:function(){delete F._inProgressAnim},properties:K}),this._inProgressAnim.play())}else B.style[this._progressPixelSize]=100*E+"%",D.style[this._progressPixelSize]=
100*(1-E)+"%"},_bumpValue:function(A,C){if(!(this.disabled||this.readOnly||this.maximum<=this.minimum)){var E=n.getComputedStyle(this.sliderBarContainer),B=f.getContentBox(this.sliderBarContainer,E);E=this.discreteValues;if(1>=E||Infinity==E)E=B[this._pixelCount];E--;A=Math.round((this.value-this.minimum)*E/(this.maximum-this.minimum))+A;0>A&&(A=0);A>E&&(A=E);A=A*(this.maximum-this.minimum)/E+this.minimum;this._setValueAttr(A,C)}},_onClkBumper:function(A){this.disabled||this.readOnly||!this.clickSelect||
this._setValueAttr(A,!0)},_onClkIncBumper:function(){this._onClkBumper(!1===this._descending?this.minimum:this.maximum)},_onClkDecBumper:function(){this._onClkBumper(!1===this._descending?this.maximum:this.minimum)},decrement:function(A){this._bumpValue(A.keyCode==k.PAGE_DOWN?-this.pageIncrement:-1)},increment:function(A){this._bumpValue(A.keyCode==k.PAGE_UP?this.pageIncrement:1)},_mouseWheeled:function(A){this.focused&&(A.stopPropagation(),A.preventDefault(),this._bumpValue(0>A.wheelDelta?-1:1,!0))},
startup:function(){this._started||(b.forEach(this.getChildren(),function(A){this[A.container]!=this.containerNode&&this[A.container].appendChild(A.domNode)},this),this.inherited(arguments))},_typematicCallback:function(A,C,E){if(-1==A)this._setValueAttr(this.value,!0);else this[C==(this._descending?this.incrementButton:this.decrementButton)?"decrement":"increment"](E)},buildRendering:function(){this.inherited(arguments);this.showButtons&&(this.incrementButton.style.display="",this.decrementButton.style.display=
"");var A=l('label[for\x3d"'+this.id+'"]');A.length&&(A[0].id||(A[0].id=this.id+"_label"),this.focusNode.setAttribute("aria-labelledby",A[0].id));this.focusNode.setAttribute("aria-valuemin",this.minimum);this.focusNode.setAttribute("aria-valuemax",this.maximum)},postCreate:function(){this.inherited(arguments);this.showButtons&&this.own(h.addMouseListener(this.decrementButton,this,"_typematicCallback",25,500),h.addMouseListener(this.incrementButton,this,"_typematicCallback",25,500));this.own(v(this.domNode,
w.wheel,g.hitch(this,"_mouseWheeled")));var A=a(z,{widget:this});this._movable=new e(this.sliderHandle,{mover:A});this._layoutHackIE7()},destroy:function(){this._movable.destroy();this._inProgressAnim&&"stopped"!=this._inProgressAnim.status&&this._inProgressAnim.stop(!0);this.inherited(arguments)}});c._Mover=z;return c})},"dijit/form/Button":function(){define("require dojo/_base/declare dojo/dom-class dojo/has dojo/_base/kernel dojo/_base/lang dojo/ready ./_FormWidget ./_ButtonMixin dojo/text!./templates/Button.html ../a11yclick".split(" "),
function(b,a,c,d,f,n,k,g,q,e){d("dijit-legacy-requires")&&k(0,function(){b(["dijit/form/DropDownButton","dijit/form/ComboButton","dijit/form/ToggleButton"])});k=a("dijit.form.Button"+(d("dojo-bidi")?"_NoBidi":""),[g,q],{showLabel:!0,iconClass:"dijitNoIcon",_setIconClassAttr:{node:"iconNode",type:"class"},baseClass:"dijitButton",templateString:e,_setValueAttr:"valueNode",_setNameAttr:function(m){this.valueNode&&this.valueNode.setAttribute("name",m)},postCreate:function(){this.inherited(arguments);
this._setLabelFromContainer()},_setLabelFromContainer:function(){this.containerNode&&!this.label&&(this.label=n.trim(this.containerNode.innerHTML),this.onLabelSet())},_setShowLabelAttr:function(m){this.containerNode&&c.toggle(this.containerNode,"dijitDisplayNone",!m);this._set("showLabel",m)},setLabel:function(m){f.deprecated("dijit.form.Button.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");this.set("label",m)},onLabelSet:function(){this.inherited(arguments);this.showLabel||
"title"in this.params||(this.titleNode.title=n.trim(this.containerNode.innerText||this.containerNode.textContent||""))}});d("dojo-bidi")&&(k=a("dijit.form.Button",k,{onLabelSet:function(){this.inherited(arguments);this.titleNode.title&&this.applyTextDir(this.titleNode,this.titleNode.title)},_setTextDirAttr:function(m){this._created&&this.textDir!=m&&(this._set("textDir",m),this._setLabelAttr(this.label))}}));return k})},"dijit/form/_ButtonMixin":function(){define(["dojo/_base/declare","dojo/dom",
"dojo/has","../registry"],function(b,a,c,d){var f=b("dijit.form._ButtonMixin"+(c("dojo-bidi")?"_NoBidi":""),null,{label:"",type:"button",__onClick:function(n){n.stopPropagation();n.preventDefault();this.disabled||this.valueNode.click(n);return!1},_onClick:function(n){if(this.disabled)return n.stopPropagation(),n.preventDefault(),!1;!1===this.onClick(n)&&n.preventDefault();var k=n.defaultPrevented;if(!k&&"submit"==this.type&&!(this.valueNode||this.focusNode).form)for(var g=this.domNode;g.parentNode;g=
g.parentNode){var q=d.byNode(g);if(q&&"function"==typeof q._onSubmit){q._onSubmit(n);n.preventDefault();k=!0;break}}return!k},postCreate:function(){this.inherited(arguments);a.setSelectable(this.focusNode,!1)},onClick:function(){return!0},_setLabelAttr:function(n){this._set("label",n);(this.containerNode||this.focusNode).innerHTML=n;this.onLabelSet()},onLabelSet:function(){}});c("dojo-bidi")&&(f=b("dijit.form._ButtonMixin",f,{onLabelSet:function(){this.inherited(arguments);this.applyTextDir(this.containerNode||
this.focusNode)}}));return f})},"dijit/form/HorizontalRule":function(){define(["dojo/_base/declare","../_Widget","../_TemplatedMixin"],function(b,a,c){return b("dijit.form.HorizontalRule",[a,c],{templateString:'\x3cdiv class\x3d"dijitRuleContainer dijitRuleContainerH"\x3e\x3c/div\x3e',count:3,container:"containerNode",ruleStyle:"",_positionPrefix:'\x3cdiv class\x3d"dijitRuleMark dijitRuleMarkH" style\x3d"left:',_positionSuffix:"%;",_suffix:'"\x3e\x3c/div\x3e',_genHTML:function(d){return this._positionPrefix+
d+this._positionSuffix+this.ruleStyle+this._suffix},_isHorizontal:!0,buildRendering:function(){this.inherited(arguments);if(1==this.count)var d=this._genHTML(50,0);else{var f,n=100/(this.count-1);if(!this._isHorizontal||this.isLeftToRight()){d=this._genHTML(0,0);for(f=1;f<this.count-1;f++)d+=this._genHTML(n*f,f);d+=this._genHTML(100,this.count-1)}else{d=this._genHTML(100,0);for(f=1;f<this.count-1;f++)d+=this._genHTML(100-n*f,f);d+=this._genHTML(0,this.count-1)}}this.domNode.innerHTML=d}})})},"dojo/_base/query":function(){define(["../query",
"./NodeList"],function(b){return b})},"dijit/form/CheckBox":function(){define("require dojo/_base/declare dojo/dom-attr dojo/has dojo/query dojo/ready ./ToggleButton ./_CheckBoxMixin dojo/text!./templates/CheckBox.html dojo/NodeList-dom ../a11yclick".split(" "),function(b,a,c,d,f,n,k,g,q){d("dijit-legacy-requires")&&n(0,function(){b(["dijit/form/RadioButton"])});return a("dijit.form.CheckBox",[k,g],{templateString:q,baseClass:"dijitCheckBox",_setValueAttr:function(e,m){"string"==typeof e&&(this.inherited(arguments),
e=!0);this._created&&this.set("checked",e,m)},_getValueAttr:function(){return this.checked&&this._get("value")},_setIconClassAttr:null,_setNameAttr:"focusNode",postMixInProperties:function(){this.inherited(arguments);this.checkedAttrSetting=""},_fillContent:function(){},_onFocus:function(){this.id&&f("label[for\x3d'"+this.id+"']").addClass("dijitFocusedLabel");this.inherited(arguments)},_onBlur:function(){this.id&&f("label[for\x3d'"+this.id+"']").removeClass("dijitFocusedLabel");this.inherited(arguments)}})})},
"dijit/form/ToggleButton":function(){define(["dojo/_base/declare","dojo/_base/kernel","./Button","./_ToggleButtonMixin"],function(b,a,c,d){return b("dijit.form.ToggleButton",[c,d],{baseClass:"dijitToggleButton",setChecked:function(f){a.deprecated("setChecked("+f+") is deprecated. Use set('checked',"+f+") instead.","","2.0");this.set("checked",f)}})})},"dijit/form/_ToggleButtonMixin":function(){define(["dojo/_base/declare","dojo/dom-attr"],function(b,a){return b("dijit.form._ToggleButtonMixin",null,
{checked:!1,_aria_attr:"aria-pressed",_onClick:function(c){var d=this.checked;this._set("checked",!d);var f=this.inherited(arguments);this.set("checked",f?this.checked:d);return f},_setCheckedAttr:function(c,d){this._set("checked",c);var f=this.focusNode||this.domNode;this._created&&a.get(f,"checked")!=!!c&&a.set(f,"checked",!!c);f.setAttribute(this._aria_attr,String(c));this._handleOnChange(c,d)},postCreate:function(){this.inherited(arguments);var c=this.focusNode||this.domNode;this.checked&&c.setAttribute("checked",
"checked");void 0===this._resetValue&&(this._lastValueReported=this._resetValue=this.checked)},reset:function(){this._hasBeenBlurred=!1;this.set("checked",this.params.checked||!1)}})})},"dijit/form/_CheckBoxMixin":function(){define(["dojo/_base/declare","dojo/dom-attr"],function(b,a){return b("dijit.form._CheckBoxMixin",null,{type:"checkbox",value:"on",readOnly:!1,_aria_attr:"aria-checked",_setReadOnlyAttr:function(c){this._set("readOnly",c);a.set(this.focusNode,"readOnly",c)},_setLabelAttr:void 0,
_getSubmitValue:function(c){return null==c||""===c?"on":c},_setValueAttr:function(c){c=this._getSubmitValue(c);this._set("value",c);a.set(this.focusNode,"value",c)},reset:function(){this.inherited(arguments);this._set("value",this._getSubmitValue(this.params.value));a.set(this.focusNode,"value",this.value)},_onClick:function(c){return this.readOnly?(c.stopPropagation(),c.preventDefault(),!1):this.inherited(arguments)}})})},"dijit/form/ComboBox":function(){define(["dojo/_base/declare","./ValidationTextBox",
"./ComboBoxMixin"],function(b,a,c){return b("dijit.form.ComboBox",[a,c],{})})},"dijit/form/ComboBoxMixin":function(){define("dojo/_base/declare dojo/Deferred dojo/_base/kernel dojo/_base/lang dojo/store/util/QueryResults ./_AutoCompleterMixin ./_ComboBoxMenu ../_HasDropDown dojo/text!./templates/DropDownBox.html".split(" "),function(b,a,c,d,f,n,k,g,q){return b("dijit.form.ComboBoxMixin",[g,n],{dropDownClass:k,hasDownArrow:!0,templateString:q,baseClass:"dijitTextBox dijitComboBox",cssStateNodes:{_buttonNode:"dijitDownArrowButton"},
_setHasDownArrowAttr:function(e){this._set("hasDownArrow",e);this._buttonNode.style.display=e?"":"none"},_showResultList:function(){this.displayMessage("");this.inherited(arguments)},_setStoreAttr:function(e){e.get||d.mixin(e,{_oldAPI:!0,get:function(m){var l=new a;this.fetchItemByIdentity({identity:m,onItem:function(w){l.resolve(w)},onError:function(w){l.reject(w)}});return l.promise},query:function(m,l){var w=new a(function(){v.abort&&v.abort()});w.total=new a;var v=this.fetch(d.mixin({query:m,
onBegin:function(x){w.total.resolve(x)},onComplete:function(x){w.resolve(x)},onError:function(x){w.reject(x)}},l));return f(w)}});this._set("store",e)},postMixInProperties:function(){var e=this.params.store||this.store;e&&this._setStoreAttr(e);this.inherited(arguments);if(!this.params.store&&this.store&&!this.store._oldAPI){var m=this.declaredClass;d.mixin(this.store,{getValue:function(l,w){c.deprecated(m+".store.getValue(item, attr) is deprecated for builtin store.  Use item.attr directly","","2.0");
return l[w]},getLabel:function(l){c.deprecated(m+".store.getLabel(item) is deprecated for builtin store.  Use item.label directly","","2.0");return l.name},fetch:function(l){c.deprecated(m+".store.fetch() is deprecated for builtin store.","Use store.query()","2.0");require(["dojo/data/ObjectStore"],d.hitch(this,function(w){(new w({objectStore:this})).fetch(l)}))}})}},buildRendering:function(){this.inherited(arguments);this.focusNode.setAttribute("aria-autocomplete",this.autoComplete?"both":"list")}})})},
"dijit/form/_AutoCompleterMixin":function(){define("dojo/aspect dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/query dojo/regexp dojo/sniff ./DataList ./_TextBoxMixin ./_SearchMixin".split(" "),function(b,a,c,d,f,n,k,g,q,e,m){a=a("dijit.form._AutoCompleterMixin",m,{item:null,autoComplete:!0,highlightMatch:"first",labelAttr:"",labelType:"text",maxHeight:-1,_stopClickEvents:!1,_getCaretPos:function(l){var w=0;if("number"==typeof l.selectionStart)w=l.selectionStart;else if(g("ie")){var v=
l.ownerDocument.selection.createRange().duplicate();l=l.createTextRange();v.move("character",0);l.move("character",0);try{l.setEndPoint("EndToEnd",v),w=String(l.text).replace(/\r/g,"").length}catch(x){}}return w},_setCaretPos:function(l,w){w=parseInt(w);e.selectInputText(l,w,w)},_setDisabledAttr:function(l){this.inherited(arguments);this.domNode.setAttribute("aria-disabled",l?"true":"false")},_onKey:function(l){if(!(32<=l.charCode)){var w=l.charCode||l.keyCode;if(w!=d.ALT&&w!=d.CTRL&&w!=d.META&&w!=
d.SHIFT){var v=this.dropDown,x=null;this._abortQuery();this.inherited(arguments);if(!(l.altKey||l.ctrlKey||l.metaKey))switch(this._opened&&(x=v.getHighlightedOption()),w){case d.PAGE_DOWN:case d.DOWN_ARROW:case d.PAGE_UP:case d.UP_ARROW:this._opened&&this._announceOption(x);l.stopPropagation();l.preventDefault();break;case d.ENTER:if(x){if(x==v.nextButton){this._nextSearch(1);l.stopPropagation();l.preventDefault();break}else if(x==v.previousButton){this._nextSearch(-1);l.stopPropagation();l.preventDefault();
break}l.stopPropagation();l.preventDefault()}else this._setBlurValue(),this._setCaretPos(this.focusNode,this.focusNode.value.length);case d.TAB:w=this.get("displayedValue");if(v&&(w==v._messages.previousMessage||w==v._messages.nextMessage))break;x&&this._selectOption(x);case d.ESCAPE:this._opened&&(this._lastQuery=null,this.closeDropDown())}}}},_autoCompleteText:function(l){var w=this.focusNode;e.selectInputText(w,w.value.length);var v=this.ignoreCase?"toLowerCase":"substr";0==l[v](0).indexOf(this.focusNode.value[v](0))?
(v=this.autoComplete?this._getCaretPos(w):w.value.length,v+1>w.value.length&&(w.value=l,e.selectInputText(w,v))):(w.value=l,e.selectInputText(w))},_openResultList:function(l,w,v){var x=this.dropDown.getHighlightedOption();this.dropDown.clearResultList();l.length||0!=v.start?(this._nextSearch=this.dropDown.onPage=f.hitch(this,function(p){l.nextPage(-1!==p);this.focus()}),this.dropDown.createOptions(l,v,f.hitch(this,"_getMenuLabelFromItem")),this._showResultList(),"direction"in v?(v.direction?this.dropDown.highlightFirstOption():
v.direction||this.dropDown.highlightLastOption(),x&&this._announceOption(this.dropDown.getHighlightedOption())):!this.autoComplete||this._prev_key_backspace||/^[*]+$/.test(w[this.searchAttr].toString())||this._announceOption(this.dropDown.containerNode.firstChild.nextSibling)):this.closeDropDown()},_showResultList:function(){this.closeDropDown(!0);this.openDropDown();this.domNode.setAttribute("aria-expanded","true")},loadDropDown:function(){this._startSearchAll()},isLoaded:function(){return!1},closeDropDown:function(){this._abortQuery();
this._opened&&(this.inherited(arguments),this.domNode.setAttribute("aria-expanded","false"))},_setBlurValue:function(){var l=this.get("displayedValue"),w=this.dropDown;!w||l!=w._messages.previousMessage&&l!=w._messages.nextMessage?"undefined"==typeof this.item?(this.item=null,this.set("displayedValue",l)):(this.value!=this._lastValueReported&&this._handleOnChange(this.value,!0),this._refreshState()):this._setValueAttr(this._lastValueReported,!0);this.focusNode.removeAttribute("aria-activedescendant")},
_setItemAttr:function(l,w,v){var x="";l&&(v||(v=this.store._oldAPI?this.store.getValue(l,this.searchAttr):l[this.searchAttr]),x=this._getValueField()!=this.searchAttr?this.store.getIdentity(l):v);this.set("value",x,w,v,l)},_announceOption:function(l){if(l){if(l==this.dropDown.nextButton||l==this.dropDown.previousButton){var w=l.innerHTML;this.item=void 0;this.value=""}else{var v=this.dropDown.items[l.getAttribute("item")];w=(this.store._oldAPI?this.store.getValue(v,this.searchAttr):v[this.searchAttr]).toString();
this.set("item",v,!1,w)}this.focusNode.value=this.focusNode.value.substring(0,this._lastInput.length);this.focusNode.setAttribute("aria-activedescendant",c.get(l,"id"));this._autoCompleteText(w)}},_selectOption:function(l){this.closeDropDown();l&&this._announceOption(l);this._setCaretPos(this.focusNode,this.focusNode.value.length);this._handleOnChange(this.value,!0);this.focusNode.removeAttribute("aria-activedescendant")},_startSearchAll:function(){this._startSearch("")},_startSearchFromInput:function(){this.item=
void 0;this.inherited(arguments)},_startSearch:function(l){if(!this.dropDown){var w=this.id+"_popup";this.dropDown=new (f.isString(this.dropDownClass)?f.getObject(this.dropDownClass,!1):this.dropDownClass)({onChange:f.hitch(this,this._selectOption),id:w,dir:this.dir,textDir:this.textDir})}this._lastInput=l;this.inherited(arguments)},_getValueField:function(){return this.searchAttr},postMixInProperties:function(){this.inherited(arguments);if(!this.store&&this.srcNodeRef&&(this.store=new q({},this.srcNodeRef),
!("value"in this.params))){var l=this.item=this.store.fetchSelectedItem();if(l){var w=this._getValueField();this.value=this.store._oldAPI?this.store.getValue(l,w):l[w]}}},postCreate:function(){var l=n('label[for\x3d"'+this.id+'"]');l.length&&(l[0].id||(l[0].id=this.id+"_label"),this.domNode.setAttribute("aria-labelledby",l[0].id));this.inherited(arguments);b.after(this,"onSearch",f.hitch(this,"_openResultList"),!0)},_getMenuLabelFromItem:function(l){l=this.labelFunc(l,this.store);var w=this.labelType;
"none"!=this.highlightMatch&&"text"==this.labelType&&this._lastInput&&(l=this.doHighlight(l,this._lastInput),w="html");return{html:"html"==w,label:l}},doHighlight:function(l,w){var v=(this.ignoreCase?"i":"")+("all"==this.highlightMatch?"g":""),x=this.queryExpr.indexOf("${0}");w=k.escapeString(w);return this._escapeHtml(l.replace(new RegExp((0==x?"^":"")+"("+w+")"+(x==this.queryExpr.length-4?"$":""),v),"\uffff$1\uffff")).replace(/\uFFFF([^\uFFFF]+)\uFFFF/g,'\x3cspan class\x3d"dijitComboBoxHighlightMatch"\x3e$1\x3c/span\x3e')},
_escapeHtml:function(l){return l=String(l).replace(/&/gm,"\x26amp;").replace(/</gm,"\x26lt;").replace(/>/gm,"\x26gt;").replace(/"/gm,"\x26quot;")},reset:function(){this.item=null;this.inherited(arguments)},labelFunc:function(l,w){return(w._oldAPI?w.getValue(l,this.labelAttr||this.searchAttr):l[this.labelAttr||this.searchAttr]).toString()},_setValueAttr:function(l,w,v,x){this._set("item",x||null);null==l&&(l="");this.inherited(arguments)}});g("dojo-bidi")&&a.extend({_setTextDirAttr:function(l){this.inherited(arguments);
this.dropDown&&this.dropDown._set("textDir",l)}});return a})},"dijit/form/DataList":function(){define("dojo/_base/declare dojo/dom dojo/_base/lang dojo/query dojo/store/Memory ../registry".split(" "),function(b,a,c,d,f,n){function k(g){return{id:g.value,value:g.value,name:c.trim(g.innerText||g.textContent||"")}}return b("dijit.form.DataList",f,{constructor:function(g,q){this.domNode=a.byId(q);c.mixin(this,g);this.id&&n.add(this);this.domNode.style.display="none";this.inherited(arguments,[{data:d("option",
this.domNode).map(k)}])},destroy:function(){n.remove(this.id)},fetchSelectedItem:function(){var g=d("\x3e option[selected]",this.domNode)[0]||d("\x3e option",this.domNode)[0];return g&&k(g)}})})},"dijit/form/_SearchMixin":function(){define("dojo/_base/declare dojo/keys dojo/_base/lang dojo/query dojo/string dojo/when ../registry".split(" "),function(b,a,c,d,f,n,k){return b("dijit.form._SearchMixin",null,{pageSize:Infinity,store:null,fetchProperties:{},query:{},list:"",_setListAttr:function(g){this._set("list",
g)},searchDelay:200,searchAttr:"name",queryExpr:"${0}*",ignoreCase:!0,_patternToRegExp:function(g){return new RegExp("^"+g.replace(/(\\.)|(\*)|(\?)|\W/g,function(q,e,m,l){return m?".*":l?".":e?e:"\\"+q})+"$",this.ignoreCase?"mi":"m")},_abortQuery:function(){this.searchTimer&&(this.searchTimer=this.searchTimer.remove());this._queryDeferHandle&&(this._queryDeferHandle=this._queryDeferHandle.remove());this._fetchHandle&&(this._fetchHandle.abort&&(this._cancelingQuery=!0,this._fetchHandle.abort(),this._cancelingQuery=
!1),this._fetchHandle.cancel&&(this._cancelingQuery=!0,this._fetchHandle.cancel(),this._cancelingQuery=!1),this._fetchHandle=null)},_processInput:function(g){if(!this.disabled&&!this.readOnly){g=g.charOrCode;this._prev_key_backspace=!1;if(g===a.DELETE||g===a.BACKSPACE)this._maskValidSubsetError=this._prev_key_backspace=!0;if(this.store)this.searchTimer=this.defer("_startSearchFromInput",1);else this.onSearch()}},onSearch:function(){},_startSearchFromInput:function(){this._startSearch(this.focusNode.value)},
_startSearch:function(g){this._abortQuery();var q=this,e=c.clone(this.query),m={start:0,count:this.pageSize,queryOptions:{ignoreCase:this.ignoreCase,deep:!0}},l=f.substitute(this.queryExpr,[g.replace(/([\\\*\?])/g,"\\$1")]),w=function(){var x=q._fetchHandle=q.store.query(e,m);q.disabled||q.readOnly||v!==q._lastQuery||n(x,function(p){q._fetchHandle=null;q.disabled||q.readOnly||v!==q._lastQuery||n(x.total,function(h){p.total=h;var t=q.pageSize;if(isNaN(t)||t>p.total)t=p.total;p.nextPage=function(r){m.direction=
r=!1!==r;m.count=t;r?(m.start+=p.length,m.start>=p.total&&(m.count=0)):(m.start-=t,0>m.start&&(m.count=Math.max(t+m.start,0),m.start=0));0>=m.count?(p.length=0,q.onSearch(p,e,m)):w()};q.onSearch(p,e,m)})},function(p){q._fetchHandle=null;q._cancelingQuery||console.error(q.declaredClass+" "+p.toString())})};c.mixin(m,this.fetchProperties);if(this.store._oldAPI)var v=l;else v=this._patternToRegExp(l),v.toString=function(){return l};this._lastQuery=e[this.searchAttr]=v;this._queryDeferHandle=this.defer(w,
this.searchDelay)},constructor:function(){this.query={};this.fetchProperties={}},postMixInProperties:function(){if(!this.store){var g=this.list;g&&(this.store=k.byId(g))}this.inherited(arguments)}})})},"dijit/form/_ComboBoxMenu":function(){define("dojo/_base/declare dojo/dom-class dojo/dom-style dojo/keys ../_WidgetBase ../_TemplatedMixin ./_ComboBoxMenuMixin ./_ListMouseMixin".split(" "),function(b,a,c,d,f,n,k,g){return b("dijit.form._ComboBoxMenu",[f,n,g,k],{templateString:"\x3cdiv class\x3d'dijitReset dijitMenu' data-dojo-attach-point\x3d'containerNode' style\x3d'overflow: auto; overflow-x: hidden;' role\x3d'listbox'\x3e\x3cdiv class\x3d'dijitMenuItem dijitMenuPreviousButton' data-dojo-attach-point\x3d'previousButton' role\x3d'option'\x3e\x3c/div\x3e\x3cdiv class\x3d'dijitMenuItem dijitMenuNextButton' data-dojo-attach-point\x3d'nextButton' role\x3d'option'\x3e\x3c/div\x3e\x3c/div\x3e",
baseClass:"dijitComboBoxMenu",postCreate:function(){this.inherited(arguments);this.isLeftToRight()||(a.add(this.previousButton,"dijitMenuItemRtl"),a.add(this.nextButton,"dijitMenuItemRtl"));this.containerNode.setAttribute("role","listbox")},_createMenuItem:function(){var q=this.ownerDocument.createElement("div");q.className="dijitReset dijitMenuItem"+(this.isLeftToRight()?"":" dijitMenuItemRtl");q.setAttribute("role","option");return q},onHover:function(q){a.add(q,"dijitMenuItemHover")},onUnhover:function(q){a.remove(q,
"dijitMenuItemHover")},onSelect:function(q){a.add(q,"dijitMenuItemSelected")},onDeselect:function(q){a.remove(q,"dijitMenuItemSelected")},_page:function(q){var e=0,m=this.domNode.scrollTop,l=c.get(this.domNode,"height");for(this.getHighlightedOption()||this.selectNextNode();e<l;){var w=this.getHighlightedOption();if(q){if(!w.previousSibling||"none"==w.previousSibling.style.display)break;this.selectPreviousNode()}else{if(!w.nextSibling||"none"==w.nextSibling.style.display)break;this.selectNextNode()}w=
this.domNode.scrollTop;e+=(w-m)*(q?-1:1);m=w}},handleKey:function(q){switch(q.keyCode){case d.DOWN_ARROW:return this.selectNextNode(),!1;case d.PAGE_DOWN:return this._page(!1),!1;case d.UP_ARROW:return this.selectPreviousNode(),!1;case d.PAGE_UP:return this._page(!0),!1;default:return!0}}})})},"dijit/form/_ComboBoxMenuMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/has dojo/i18n dojo/i18n!./nls/ComboBox".split(" "),function(b,a,c,d,f){var n=a("dijit.form._ComboBoxMenuMixin"+
(d("dojo-bidi")?"_NoBidi":""),null,{_messages:null,postMixInProperties:function(){this.inherited(arguments);this._messages=f.getLocalization("dijit.form","ComboBox",this.lang)},buildRendering:function(){this.inherited(arguments);this.previousButton.innerHTML=this._messages.previousMessage;this.nextButton.innerHTML=this._messages.nextMessage},_setValueAttr:function(k){this._set("value",k);this.onChange(k)},onClick:function(k){if(k==this.previousButton)this._setSelectedAttr(null),this.onPage(-1);else if(k==
this.nextButton)this._setSelectedAttr(null),this.onPage(1);else this.onChange(k)},onChange:function(){},onPage:function(){},onClose:function(){this._setSelectedAttr(null)},_createOption:function(k,g){var q=this._createMenuItem();k=g(k);k.html?q.innerHTML=k.label:q.appendChild(q.ownerDocument.createTextNode(k.label));""==q.innerHTML&&(q.innerHTML="\x26#160;");return q},createOptions:function(k,g,q){this.items=k;this.previousButton.style.display=0==g.start?"none":"";c.set(this.previousButton,"id",this.id+
"_prev");b.forEach(k,function(m,l){m=this._createOption(m,q);m.setAttribute("item",l);c.set(m,"id",this.id+l);this.nextButton.parentNode.insertBefore(m,this.nextButton)},this);var e=!1;k.total&&!k.total.then&&-1!=k.total?g.start+g.count<k.total?e=!0:g.start+g.count>k.total&&g.count==k.length&&(e=!0):g.count==k.length&&(e=!0);this.nextButton.style.display=e?"":"none";c.set(this.nextButton,"id",this.id+"_next")},clearResultList:function(){for(var k=this.containerNode;2<k.childNodes.length;)k.removeChild(k.childNodes[k.childNodes.length-
2]);this._setSelectedAttr(null)},highlightFirstOption:function(){this.selectFirstNode()},highlightLastOption:function(){this.selectLastNode()},selectFirstNode:function(){this.inherited(arguments);this.getHighlightedOption()==this.previousButton&&this.selectNextNode()},selectLastNode:function(){this.inherited(arguments);this.getHighlightedOption()==this.nextButton&&this.selectPreviousNode()},getHighlightedOption:function(){return this.selected}});d("dojo-bidi")&&(n=a("dijit.form._ComboBoxMenuMixin",
n,{_createOption:function(){var k=this.inherited(arguments);this.applyTextDir(k);return k}}));return n})},"dijit/form/_ListMouseMixin":function(){define(["dojo/_base/declare","dojo/on","dojo/touch","./_ListBase"],function(b,a,c,d){return b("dijit.form._ListMouseMixin",d,{postCreate:function(){this.inherited(arguments);this.domNode.dojoClick=!0;this._listConnect("click","_onClick");this._listConnect("mousedown","_onMouseDown");this._listConnect("mouseup","_onMouseUp");this._listConnect("mouseover",
"_onMouseOver");this._listConnect("mouseout","_onMouseOut")},_onClick:function(f,n){this._setSelectedAttr(n,!1);this._deferredClick&&this._deferredClick.remove();this._deferredClick=this.defer(function(){this._deferredClick=null;this.onClick(n)})},_onMouseDown:function(f,n){this._hoveredNode&&(this.onUnhover(this._hoveredNode),this._hoveredNode=null);this._isDragging=!0;this._setSelectedAttr(n,!1)},_onMouseUp:function(f,n){this._isDragging=!1;var k=this.selected,g=this._hoveredNode;k&&n==k?this.defer(function(){this._onClick(f,
k)}):g&&this.defer(function(){this._onClick(f,g)})},_onMouseOut:function(f,n){this._hoveredNode&&(this.onUnhover(this._hoveredNode),this._hoveredNode=null);this._isDragging&&(this._cancelDrag=(new Date).getTime()+1E3)},_onMouseOver:function(f,n){this._cancelDrag&&((new Date).getTime()>this._cancelDrag&&(this._isDragging=!1),this._cancelDrag=null);this._hoveredNode=n;this.onHover(n);this._isDragging&&this._setSelectedAttr(n,!1)}})})},"dijit/form/_ListBase":function(){define(["dojo/_base/declare","dojo/on",
"dojo/window"],function(b,a,c){return b("dijit.form._ListBase",null,{selected:null,_listConnect:function(d,f){var n=this;return n.own(a(n.containerNode,a.selector(function(k,g,q){return k.parentNode==q},d),function(k){n[f](k,this)}))},selectFirstNode:function(){for(var d=this.containerNode.firstChild;d&&"none"==d.style.display;)d=d.nextSibling;this._setSelectedAttr(d,!0)},selectLastNode:function(){for(var d=this.containerNode.lastChild;d&&"none"==d.style.display;)d=d.previousSibling;this._setSelectedAttr(d,
!0)},selectNextNode:function(){var d=this.selected;if(d){for(d=d.nextSibling;d&&"none"==d.style.display;)d=d.nextSibling;d?this._setSelectedAttr(d,!0):this.selectFirstNode()}else this.selectFirstNode()},selectPreviousNode:function(){var d=this.selected;if(d){for(d=d.previousSibling;d&&"none"==d.style.display;)d=d.previousSibling;d?this._setSelectedAttr(d,!0):this.selectLastNode()}else this.selectLastNode()},_setSelectedAttr:function(d,f){if(this.selected!=d){var n=this.selected;if(n)this.onDeselect(n);
d&&(f&&c.scrollIntoView(d),this.onSelect(d));this._set("selected",d)}else if(d)this.onSelect(d)}})})},"url:jimu/dijit/templates/LoadingShelter.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"loading-container"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"imgDiv" class\x3d"img-div"\x3e\r\n      \x3c/div\x3e\r\n      \x3cp data-dojo-attach-point\x3d"textNode"\x3e\x3c/p\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',"url:dijit/templates/Menu.html":'\x3ctable class\x3d"dijit dijitMenu dijitMenuPassive dijitReset dijitMenuTable" role\x3d"menu" tabIndex\x3d"${tabIndex}"\r\n\t   cellspacing\x3d"0"\x3e\r\n\t\x3ctbody class\x3d"dijitReset" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/tbody\x3e\r\n\x3c/table\x3e\r\n',
"url:dijit/templates/MenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"menuitem" tabIndex\x3d"-1"\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitIcon dijitMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,textDirNode"\r\n\t\trole\x3d"presentation"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"arrowWrapper" style\x3d"visibility: hidden"\x3e\r\n\t\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuExpand"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan class\x3d"dijitMenuExpandA11y"\x3e+\x3c/span\x3e\r\n\t\t\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/templates/CheckedMenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"${role}" tabIndex\x3d"-1" aria-checked\x3d"${checked}"\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuItemIcon dijitCheckedMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\t\x3cspan class\x3d"dijitMenuItemIconChar dijitCheckedMenuItemIconChar"\x3e${!checkedChar}\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,labelNode,textDirNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\x26#160;\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/templates/MenuSeparator.html":'\x3ctr class\x3d"dijitMenuSeparator" role\x3d"separator"\x3e\r\n\t\x3ctd class\x3d"dijitMenuSeparatorIconCell"\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorTop"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorBottom"\x3e\x3c/div\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd colspan\x3d"3" class\x3d"dijitMenuSeparatorLabelCell"\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorTop dijitMenuSeparatorLabel"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorBottom"\x3e\x3c/div\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/templates/Tooltip.html":'\x3cdiv class\x3d"dijitTooltip dijitTooltipLeft" id\x3d"dojoTooltip" data-dojo-attach-event\x3d"mouseenter:onMouseEnter,mouseleave:onMouseLeave"\r\n\t\x3e\x3cdiv class\x3d"dijitTooltipConnector" data-dojo-attach-point\x3d"connectorNode"\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitTooltipContainer dijitTooltipContents" data-dojo-attach-point\x3d"containerNode" role\x3d\'alert\'\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',"url:dijit/form/templates/Select.html":'\x3ctable class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tdata-dojo-attach-point\x3d"_buttonNode,tableNode,focusNode,_popupStateNode" cellspacing\x3d\'0\' cellpadding\x3d\'0\'\r\n\trole\x3d"listbox" aria-haspopup\x3d"true"\r\n\t\x3e\x3ctbody role\x3d"presentation"\x3e\x3ctr role\x3d"presentation"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitStretch dijitButtonContents" role\x3d"presentation"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitButtonText"  data-dojo-attach-point\x3d"containerNode,textDirNode" role\x3d"presentation"\x3e\x3c/div\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitValidationContainer"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\t\x3e\x3cinput type\x3d"hidden" ${!nameAttrSetting} data-dojo-attach-point\x3d"valueNode" value\x3d"${value}" aria-hidden\x3d"true"\r\n\t\t/\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer"\r\n\t\t\tdata-dojo-attach-point\x3d"titleNode" role\x3d"presentation"\r\n\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitArrowButtonInner" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t${_buttonInputDisabled}\r\n\t\t/\x3e\x3c/td\r\n\t\x3e\x3c/tr\x3e\x3c/tbody\r\n\x3e\x3c/table\x3e\r\n',
"url:dijit/form/templates/TextBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft" id\x3d"widget_${id}" role\x3d"presentation"\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputInner" data-dojo-attach-point\x3d\'textbox,focusNode\' autocomplete\x3d"off"\r\n\t\t\t${!nameAttrSetting} type\x3d\'${type}\'\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',"url:dijit/form/templates/ValidationTextBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}" role\x3d"presentation"\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputInner" data-dojo-attach-point\x3d\'textbox,focusNode\' autocomplete\x3d"off"\r\n\t\t\t${!nameAttrSetting} type\x3d\'${type}\'\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:dijit/form/templates/Spinner.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}" role\x3d"presentation"\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitButtonNode dijitSpinnerButtonContainer"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitSpinnerButtonInner" type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t/\x3e\x3cdiv class\x3d"dijitReset dijitLeft dijitButtonNode dijitArrowButton dijitUpArrowButton"\r\n\t\t\tdata-dojo-attach-point\x3d"upArrowNode"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitArrowButtonInner"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField" value\x3d"\x26#9650; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t\t${_buttonInputDisabled}\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\x3e\x3c/div\r\n\t\t\x3e\x3cdiv class\x3d"dijitReset dijitLeft dijitButtonNode dijitArrowButton dijitDownArrowButton"\r\n\t\t\tdata-dojo-attach-point\x3d"downArrowNode"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitArrowButtonInner"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t\t${_buttonInputDisabled}\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\x3e\x3c/div\r\n\t\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d\'dijitReset dijitInputInner\' data-dojo-attach-point\x3d"textbox,focusNode" type\x3d"${type}" data-dojo-attach-event\x3d"onkeydown:_onKeyDown"\r\n\t\t\trole\x3d"spinbutton" autocomplete\x3d"off" ${!nameAttrSetting}\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:dijit/templates/ColorPalette.html":'\x3cdiv class\x3d"dijitInline dijitColorPalette" role\x3d"grid"\x3e\r\n\t\x3ctable data-dojo-attach-point\x3d"paletteTableNode" class\x3d"dijitPaletteTable" cellSpacing\x3d"0" cellPadding\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\x3ctbody data-dojo-attach-point\x3d"gridNode"\x3e\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\x3c/div\x3e\r\n',"url:dijit/form/templates/Button.html":'\x3cspan class\x3d"dijit dijitReset dijitInline" role\x3d"presentation"\r\n\t\x3e\x3cspan class\x3d"dijitReset dijitInline dijitButtonNode"\r\n\t\tdata-dojo-attach-event\x3d"ondijitclick:__onClick" role\x3d"presentation"\r\n\t\t\x3e\x3cspan class\x3d"dijitReset dijitStretch dijitButtonContents"\r\n\t\t\tdata-dojo-attach-point\x3d"titleNode,focusNode"\r\n\t\t\trole\x3d"button" aria-labelledby\x3d"${id}_label"\r\n\t\t\t\x3e\x3cspan class\x3d"dijitReset dijitInline dijitIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\r\n\t\t\t\x3e\x3cspan class\x3d"dijitReset dijitToggleButtonIconChar"\x3e\x26#x25CF;\x3c/span\r\n\t\t\t\x3e\x3cspan class\x3d"dijitReset dijitInline dijitButtonText"\r\n\t\t\t\tid\x3d"${id}_label"\r\n\t\t\t\tdata-dojo-attach-point\x3d"containerNode"\r\n\t\t\t\x3e\x3c/span\r\n\t\t\x3e\x3c/span\r\n\t\x3e\x3c/span\r\n\t\x3e\x3cinput ${!nameAttrSetting} type\x3d"${type}" value\x3d"${value}" class\x3d"dijitOffScreen"\r\n\t\tdata-dojo-attach-event\x3d"onclick:_onClick"\r\n\t\ttabIndex\x3d"-1" aria-hidden\x3d"true" data-dojo-attach-point\x3d"valueNode"\r\n/\x3e\x3c/span\x3e\r\n',
"url:dijit/form/templates/HorizontalSlider.html":'\x3ctable class\x3d"dijit dijitReset dijitSlider dijitSliderH" cellspacing\x3d"0" cellpadding\x3d"0" border\x3d"0" rules\x3d"none" data-dojo-attach-event\x3d"onkeydown:_onKeyDown, onkeyup:_onKeyUp"\r\n\trole\x3d"presentation"\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\t\x3e\x3ctd data-dojo-attach-point\x3d"topDecoration" class\x3d"dijitReset dijitSliderDecoration dijitSliderDecorationT dijitSliderDecorationH"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerH"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderDecrementIconH" style\x3d"display:none" data-dojo-attach-point\x3d"decrementButton"\x3e\x3cspan class\x3d"dijitSliderButtonInner"\x3e-\x3c/span\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderBar dijitSliderBumper dijitSliderBumperH dijitSliderLeftBumper" data-dojo-attach-event\x3d"press:_onClkDecBumper"\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cinput data-dojo-attach-point\x3d"valueNode" type\x3d"hidden" ${!nameAttrSetting}\r\n\t\t\t/\x3e\x3cdiv class\x3d"dijitReset dijitSliderBarContainerH" role\x3d"presentation" data-dojo-attach-point\x3d"sliderBarContainer"\r\n\t\t\t\t\x3e\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"progressBar" class\x3d"dijitSliderBar dijitSliderBarH dijitSliderProgressBar dijitSliderProgressBarH" data-dojo-attach-event\x3d"press:_onBarClick"\r\n\t\t\t\t\t\x3e\x3cdiv class\x3d"dijitSliderMoveable dijitSliderMoveableH"\r\n\t\t\t\t\t\t\x3e\x3cdiv data-dojo-attach-point\x3d"sliderHandle,focusNode" class\x3d"dijitSliderImageHandle dijitSliderImageHandleH" data-dojo-attach-event\x3d"press:_onHandleClick" role\x3d"slider"\x3e\x3c/div\r\n\t\t\t\t\t\x3e\x3c/div\r\n\t\t\t\t\x3e\x3c/div\r\n\t\t\t\t\x3e\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"remainingBar" class\x3d"dijitSliderBar dijitSliderBarH dijitSliderRemainingBar dijitSliderRemainingBarH" data-dojo-attach-event\x3d"press:_onBarClick"\x3e\x3c/div\r\n\t\t\t\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderBar dijitSliderBumper dijitSliderBumperH dijitSliderRightBumper" data-dojo-attach-event\x3d"press:_onClkIncBumper"\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerH"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderIncrementIconH" style\x3d"display:none" data-dojo-attach-point\x3d"incrementButton"\x3e\x3cspan class\x3d"dijitSliderButtonInner"\x3e+\x3c/span\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\t\x3e\x3ctd data-dojo-attach-point\x3d"containerNode,bottomDecoration" class\x3d"dijitReset dijitSliderDecoration dijitSliderDecorationB dijitSliderDecorationH"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\x3e\x3c/table\x3e\r\n',
"url:dijit/form/templates/CheckBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline" role\x3d"presentation"\r\n\t\x3e\x3cinput\r\n\t \t${!nameAttrSetting} type\x3d"${type}" role\x3d"${type}" aria-checked\x3d"false" ${checkedAttrSetting}\r\n\t\tclass\x3d"dijitReset dijitCheckBoxInput"\r\n\t\tdata-dojo-attach-point\x3d"focusNode"\r\n\t \tdata-dojo-attach-event\x3d"ondijitclick:_onClick"\r\n/\x3e\x3c/div\x3e\r\n',"url:dijit/form/templates/DropDownBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}"\r\n\trole\x3d"combobox"\r\n\taria-haspopup\x3d"true"\r\n\tdata-dojo-attach-point\x3d"_popupStateNode"\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer\'\r\n\t\tdata-dojo-attach-point\x3d"_buttonNode" role\x3d"presentation"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitArrowButtonInner" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"button presentation" aria-hidden\x3d"true"\r\n\t\t\t${_buttonInputDisabled}\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d\'dijitReset dijitInputInner\' ${!nameAttrSetting} type\x3d"${type}" autocomplete\x3d"off"\r\n\t\t\tdata-dojo-attach-point\x3d"textbox,focusNode" role\x3d"textbox"\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"*now":function(b){b(['dojo/i18n!*preload*jimu/nls/main*["ar","bg","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sk","sl","sr","sv","th","tr","zh-cn","uk","vi","zh-hk","zh-tw","ROOT"]'])}}});
define("./ConfigManager ./LayoutManager ./DataManager dojo/_base/html dojo/_base/lang dojo/_base/array dojo/on dojo/mouse dojo/topic dojo/cookie dojo/Deferred dojo/promise/all dojo/io-query dojo/domReady! esri/config esri/request esri/core/urlUtils esri/identity/IdentityManager jimu/portalUrlUtils ./utils require dojo/i18n dojo/i18n!./nls/main dojo/ready".split(" "),function(b,a,c,d,f,n,k,g,q,e,m,l,w,v,x,p,h,t,r,u,y,z,A,C){function E(){var F=window.location.search;if(""===F)return{};F=w.queryToObject(F.substr(1));
for(var K in F)F[K]=u.sanitizeHTML(F[K]);return F}n={};q=u.getEsriConfigRequestObject();q.timeout=18E4;"function"!==typeof e.getAll&&(e.getAll=function(F){var K=[];(F=e(F))&&K.push(F);return K});window.jimuNls=A;t.setProtocolErrorHandler(function(){return!0});t=u.getAncestorWindow();var B=!1;try{B=0===t.location.href.indexOf("https://")}catch(F){}var D=/\/SceneServer\/layers\/\d+\/?$/;q.interceptors=[{before:function(F){F&&"object"===typeof F.requestOptions&&!F.requestOptions.content&&D.test(F.url)&&
(F.content={f:"json"});F.requestOptions.query&&F.requestOptions.query.printFlag&&(F.timeout=3E5);B&&(F.url=F.url.replace(/^http(s?):\/\//gi,"https://"));-1===F.url.indexOf("/queryRelatedRecords?")||u.isHostedService(F.url)||(F.url=F.url.replace("FeatureServer","MapServer"))}}];k(window,"mousedown",function(F){if(g.isMiddle(F))return F.preventDefault(),F.stopPropagation(),F.returnValue=!1});String.prototype.startWith=function(F){return this.substr(0,F.length)===F?!0:!1};String.prototype.endWith=function(F){return this.substr(this.length-
F.length,F.length)===F?!0:!1};"undefined"===typeof jimuConfig&&(jimuConfig={});jimuConfig=f.mixin({loadingId:"main-loading",loadingImageId:"app-loading",loadingGifId:"loading-gif",layoutId:"jimu-layout-manager",mapId:"map",mainPageId:"main-page",timeout:5E3,breakPoints:[600,1280]},jimuConfig);window.wabVersion="2.29";window.productVersion="2023 R03";n.initApp=function(){console.log("jimu.js init...");var F=E();c.getInstance();d.setStyle(jimuConfig.loadingId,"display","none");d.setStyle(jimuConfig.mainPageId,
"display","block");var K=a.getInstance({mapId:jimuConfig.mapId,urlParams:F},jimuConfig.layoutId);F=b.getInstance(F);K.startup();F.loadConfig();C(function(){setTimeout(function(){d.removeClass(document.body,"dj_a11y")},50)})};return n});